#!/bin/bash
# SPDX-License-Identifier: GPL-2.0
#
# Copyright 2020 Greg Kroah-Hartman <gregkh@linuxfoundation.org>
#
# init a git tree full of just the changelog entries for that specific kernel release
#

HOME="/home/gregkh/linux"
TMPDIR="/home/gregkh/tmp"
PREFIX="fixes_search_"

KERNEL_DIR="/home/gregkh/linux/gregkh"


txtund=$(tput sgr 0 1)    # Underline
txtbld=$(tput bold)       # Bold
txtred=$(tput setaf 1)    # Red
txtgrn=$(tput setaf 2)    # Green
txtylw=$(tput setaf 3)    # Yellow
txtblu=$(tput setaf 4)    # Blue
txtpur=$(tput setaf 5)    # Purple
txtcyn=$(tput setaf 6)    # Cyan
txtwht=$(tput setaf 7)    # White
txtrst=$(tput sgr0)       # Text reset


DEBUG=1
i=1
spin()
{
	sp="/-\|"
	printf "\b${sp:i++%${#sp}:1}"
}

logn()
{
	if [[ ${DEBUG} -ge 1 ]] ; then
		echo -n "$1"
	else
		spin
	fi
}
log()
{
	if [[ ${DEBUG} -ge 1 ]] ; then
		echo "$1"
	else
		spin
	fi
}
dbg()
{
	if [[ ${DEBUG} -ge 2 ]] ; then
		log "$1"
	fi
}



populate_version()
{
	OLD_VERSION=$1
	NEW_VERSION=$2

	mkdir "${NEW_VERSION}"
	pwd=$(pwd)

	logn "${txtgrn}Creating directory for kernel version ${txtylw}${NEW_VERSION}${txtrst}   "
	cd "${KERNEL_DIR}"
	for commit in $(git rev-list --reverse --no-merges v${OLD_VERSION}..v${NEW_VERSION}); do
		#log "${txtgrn}${commit}${txtrst}	"
		spin
		git log -1 --format='%B' "${commit}" > "${pwd}"/"${NEW_VERSION}"/${commit}
	done
	log ""

	cd "${pwd}"
}


populate_version 4.0 4.1
populate_version 4.1 4.2
populate_version 4.2 4.3
populate_version 4.3 4.4
populate_version 4.4 4.5
populate_version 4.5 4.6
populate_version 4.6 4.7
populate_version 4.7 4.8
populate_version 4.8 4.9
