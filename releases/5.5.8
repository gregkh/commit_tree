commit 97453d9b9b2b2356f4389824a9e77fd0c1899d4b
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Thu Mar 5 16:45:26 2020 +0100

    Linux 5.5.8

commit 65931e6cd4f5b89a657268b17dd30e9e034e4148
Author: Jim Mattson <jmattson@google.com>
Date:   Fri Dec 6 15:46:36 2019 -0800

    kvm: nVMX: VMWRITE checks unsupported field before read-only field
    
    commit 693e02cc24090c379217138719d9d84e50036b24 upstream.
    
    According to the SDM, VMWRITE checks to see if the secondary source
    operand corresponds to an unsupported VMCS field before it checks to
    see if the secondary source operand corresponds to a VM-exit
    information field and the processor does not support writing to
    VM-exit information fields.
    
    Fixes: 49f705c5324aa ("KVM: nVMX: Implement VMREAD and VMWRITE")
    Signed-off-by: Jim Mattson <jmattson@google.com>
    Cc: Paolo Bonzini <pbonzini@redhat.com>
    Reviewed-by: Peter Shier <pshier@google.com>
    Reviewed-by: Oliver Upton <oupton@google.com>
    Reviewed-by: Jon Cargille <jcargill@google.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 75ef7bf39e8cbc9cfec47af09799abcb14f8c85a
Author: Jim Mattson <jmattson@google.com>
Date:   Fri Dec 6 15:46:35 2019 -0800

    kvm: nVMX: VMWRITE checks VMCS-link pointer before VMCS field
    
    commit dd2d6042b7f4a5440705b4ffc6c4c2dba81a43b7 upstream.
    
    According to the SDM, a VMWRITE in VMX non-root operation with an
    invalid VMCS-link pointer results in VMfailInvalid before the validity
    of the VMCS field in the secondary source operand is checked.
    
    For consistency, modify both handle_vmwrite and handle_vmread, even
    though there was no problem with the latter.
    
    Fixes: 6d894f498f5d1 ("KVM: nVMX: vmread/vmwrite: Use shadow vmcs12 if running L2")
    Signed-off-by: Jim Mattson <jmattson@google.com>
    Cc: Liran Alon <liran.alon@oracle.com>
    Cc: Paolo Bonzini <pbonzini@redhat.com>
    Cc: Vitaly Kuznetsov <vkuznets@redhat.com>
    Reviewed-by: Peter Shier <pshier@google.com>
    Reviewed-by: Oliver Upton <oupton@google.com>
    Reviewed-by: Jon Cargille <jcargill@google.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ef4676680b04de58d54a62e96b3d529f14667bdf
Author: David Rientjes <rientjes@google.com>
Date:   Thu Jan 30 22:14:48 2020 -0800

    mm, thp: fix defrag setting if newline is not used
    
    commit f42f25526502d851d0e3ca1e46297da8aafce8a7 upstream.
    
    If thp defrag setting "defer" is used and a newline is *not* used when
    writing to the sysfs file, this is interpreted as the "defer+madvise"
    option.
    
    This is because we do prefix matching and if five characters are written
    without a newline, the current code ends up comparing to the first five
    bytes of the "defer+madvise" option and using that instead.
    
    Use the more appropriate sysfs_streq() that handles the trailing newline
    for us.  Since this doubles as a nice cleanup, do it in enabled_store()
    as well.
    
    The current implementation relies on prefix matching: the number of
    bytes compared is either the number of bytes written or the length of
    the option being compared.  With a newline, "defer\n" does not match
    "defer+"madvise"; without a newline, however, "defer" is considered to
    match "defer+madvise" (prefix matching is only comparing the first five
    bytes).  End result is that writing "defer" is broken unless it has an
    additional trailing character.
    
    This means that writing "madv" in the past would match and set
    "madvise".  With strict checking, that no longer is the case but it is
    unlikely anybody is currently doing this.
    
    Link: http://lkml.kernel.org/r/alpine.DEB.2.21.2001171411020.56385@chino.kir.corp.google.com
    Fixes: 21440d7eb904 ("mm, thp: add new defer+madvise defrag option")
    Signed-off-by: David Rientjes <rientjes@google.com>
    Suggested-by: Andrew Morton <akpm@linux-foundation.org>
    Acked-by: Vlastimil Babka <vbabka@suse.cz>
    Cc: Mel Gorman <mgorman@techsingularity.net>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e651690028f76938c6bf6670bc1ad863123dc38f
Author: Wei Yang <richardw.yang@linux.intel.com>
Date:   Thu Jan 30 22:14:29 2020 -0800

    mm/huge_memory.c: use head to check huge zero page
    
    commit cb829624867b5ab10bc6a7036d183b1b82bfe9f8 upstream.
    
    The page could be a tail page, if this is the case, this BUG_ON will
    never be triggered.
    
    Link: http://lkml.kernel.org/r/20200110032610.26499-1-richardw.yang@linux.intel.com
    Fixes: e9b61f19858a ("thp: reintroduce split_huge_page()")
    
    Signed-off-by: Wei Yang <richardw.yang@linux.intel.com>
    Acked-by: Kirill A. Shutemov <kirill.shutemov@linux.intel.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit adef9bfc3b35a512a2859d11558ba8227ace184e
Author: John Hubbard <jhubbard@nvidia.com>
Date:   Thu Jan 30 22:12:43 2020 -0800

    mm/gup: allow FOLL_FORCE for get_user_pages_fast()
    
    commit f4000fdf435b8301a11cf85237c561047f8c4c72 upstream.
    
    Commit 817be129e6f2 ("mm: validate get_user_pages_fast flags") allowed
    only FOLL_WRITE and FOLL_LONGTERM to be passed to get_user_pages_fast().
    This, combined with the fact that get_user_pages_fast() falls back to
    "slow gup", which *does* accept FOLL_FORCE, leads to an odd situation:
    if you need FOLL_FORCE, you cannot call get_user_pages_fast().
    
    There does not appear to be any reason for filtering out FOLL_FORCE.
    There is nothing in the _fast() implementation that requires that we
    avoid writing to the pages.  So it appears to have been an oversight.
    
    Fix by allowing FOLL_FORCE to be set for get_user_pages_fast().
    
    Link: http://lkml.kernel.org/r/20200107224558.2362728-9-jhubbard@nvidia.com
    Fixes: 817be129e6f2 ("mm: validate get_user_pages_fast flags")
    Signed-off-by: John Hubbard <jhubbard@nvidia.com>
    Reviewed-by: Leon Romanovsky <leonro@mellanox.com>
    Reviewed-by: Jan Kara <jack@suse.cz>
    Cc: Christoph Hellwig <hch@lst.de>
    Cc: Alex Williamson <alex.williamson@redhat.com>
    Cc: Aneesh Kumar K.V <aneesh.kumar@linux.ibm.com>
    Cc: Björn Töpel <bjorn.topel@intel.com>
    Cc: Daniel Vetter <daniel.vetter@ffwll.ch>
    Cc: Dan Williams <dan.j.williams@intel.com>
    Cc: Hans Verkuil <hverkuil-cisco@xs4all.nl>
    Cc: Ira Weiny <ira.weiny@intel.com>
    Cc: Jason Gunthorpe <jgg@mellanox.com>
    Cc: Jason Gunthorpe <jgg@ziepe.ca>
    Cc: Jens Axboe <axboe@kernel.dk>
    Cc: Jerome Glisse <jglisse@redhat.com>
    Cc: Jonathan Corbet <corbet@lwn.net>
    Cc: Kirill A. Shutemov <kirill@shutemov.name>
    Cc: Mauro Carvalho Chehab <mchehab@kernel.org>
    Cc: Mike Rapoport <rppt@linux.ibm.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit da891d069334137adeefb1cae0505957387642a2
Author: Vlastimil Babka <vbabka@suse.cz>
Date:   Thu Jan 30 22:12:03 2020 -0800

    mm/debug.c: always print flags in dump_page()
    
    commit 5b57b8f22709f07c0ab5921c94fd66e8c59c3e11 upstream.
    
    Commit 76a1850e4572 ("mm/debug.c: __dump_page() prints an extra line")
    inadvertently removed printing of page flags for pages that are neither
    anon nor ksm nor have a mapping.  Fix that.
    
    Using pr_cont() again would be a solution, but the commit explicitly
    removed its use.  Avoiding the danger of mixing up split lines from
    multiple CPUs might be beneficial for near-panic dumps like this, so fix
    this without reintroducing pr_cont().
    
    Link: http://lkml.kernel.org/r/9f884d5c-ca60-dc7b-219c-c081c755fab6@suse.cz
    Fixes: 76a1850e4572 ("mm/debug.c: __dump_page() prints an extra line")
    Signed-off-by: Vlastimil Babka <vbabka@suse.cz>
    Reported-by: Anshuman Khandual <anshuman.khandual@arm.com>
    Reported-by: Michal Hocko <mhocko@kernel.org>
    Acked-by: Michal Hocko <mhocko@suse.com>
    Cc: David Hildenbrand <david@redhat.com>
    Cc: Qian Cai <cai@lca.pw>
    Cc: Oscar Salvador <osalvador@suse.de>
    Cc: Mel Gorman <mgorman@techsingularity.net>
    Cc: Mike Rapoport <rppt@linux.ibm.com>
    Cc: Dan Williams <dan.j.williams@intel.com>
    Cc: Pavel Tatashin <pavel.tatashin@microsoft.com>
    Cc: Ralph Campbell <rcampbell@nvidia.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2b439fa649dd0a3eaa208b47478bf85520837332
Author: Waiman Long <longman@redhat.com>
Date:   Wed Dec 11 16:31:39 2019 -0500

    locking/lockdep: Fix lockdep_stats indentation problem
    
    commit a030f9767da1a6bbcec840fc54770eb11c2414b6 upstream.
    
    It was found that two lines in the output of /proc/lockdep_stats have
    indentation problem:
    
      # cat /proc/lockdep_stats
         :
       in-process chains:                   25057
       stack-trace entries:                137827 [max: 524288]
       number of stack traces:        7973
       number of stack hash chains:   6355
       combined max dependencies:      1356414598
       hardirq-safe locks:                     57
       hardirq-unsafe locks:                 1286
         :
    
    All the numbers displayed in /proc/lockdep_stats except the two stack
    trace numbers are formatted with a field with of 11. To properly align
    all the numbers, a field width of 11 is now added to the two stack
    trace numbers.
    
    Fixes: 8c779229d0f4 ("locking/lockdep: Report more stack trace statistics")
    Signed-off-by: Waiman Long <longman@redhat.com>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Reviewed-by: Bart Van Assche <bvanassche@acm.org>
    Link: https://lkml.kernel.org/r/20191211213139.29934-1-longman@redhat.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3bade9aa12a698936f5d20251c64dbb0a84ef6d5
Author: Christoph Hellwig <hch@lst.de>
Date:   Tue Jan 7 15:25:37 2020 -0800

    xfs: clear kernel only flags in XFS_IOC_ATTRMULTI_BY_HANDLE
    
    commit 953aa9d136f53e226448dbd801a905c28f8071bf upstream.
    
    Don't allow passing arbitrary flags as they change behavior including
    memory allocation that the call stack is not prepared for.
    
    Fixes: ddbca70cc45c ("xfs: allocate xattr buffer on demand")
    Signed-off-by: Christoph Hellwig <hch@lst.de>
    Reviewed-by: Darrick J. Wong <darrick.wong@oracle.com>
    Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ca5b8f55bef9df566d633f2c52c68eb639ab190f
Author: Bjorn Andersson <bjorn.andersson@linaro.org>
Date:   Fri Jan 24 09:59:34 2020 -0800

    clk: qcom: rpmh: Sort OF match table
    
    commit 9e0cda721d18f44f1cd74d3a426931d71c1f1b30 upstream.
    
    sc7180 was added to the end of the match table, sort the table.
    
    Fixes: eee28109f871 ("clk: qcom: clk-rpmh: Add support for RPMHCC for SC7180")
    Signed-off-by: Bjorn Andersson <bjorn.andersson@linaro.org>
    Link: https://lkml.kernel.org/r/20200124175934.3937473-1-bjorn.andersson@linaro.org
    Signed-off-by: Stephen Boyd <sboyd@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5b2670cc224124e8ed818ece6db05add3f0230b9
Author: Sameer Pujar <spujar@nvidia.com>
Date:   Thu Jun 20 21:21:59 2019 +0530

    bus: tegra-aconnect: Remove PM_CLK dependency
    
    commit 2f56acf818a08a9187ac8ec6e3d994fc13dc368d upstream.
    
    The ACONNECT bus driver does not use pm-clk interface anymore and hence
    the dependency can be removed from its Kconfig option.
    
    Fixes: 0d7dab926130 ("bus: tegra-aconnect: use devm_clk_*() helpers")
    Signed-off-by: Sameer Pujar <spujar@nvidia.com>
    Acked-by: Jon Hunter <jonathanh@nvidia.com>
    Signed-off-by: Thierry Reding <treding@nvidia.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 118593595681226431f0e1addee905fb115a3a99
Author: Matteo Croce <mcroce@redhat.com>
Date:   Thu Jan 30 20:10:19 2020 +0100

    netfilter: nf_flowtable: fix documentation
    
    commit 78e06cf430934fc3768c342cbebdd1013dcd6fa7 upstream.
    
    In the flowtable documentation there is a missing semicolon, the command
    as is would give this error:
    
        nftables.conf:5:27-33: Error: syntax error, unexpected devices, expecting newline or semicolon
                        hook ingress priority 0 devices = { br0, pppoe-data };
                                                ^^^^^^^
        nftables.conf:4:12-13: Error: invalid hook (null)
                flowtable ft {
                          ^^
    
    Fixes: 19b351f16fd9 ("netfilter: add flowtable documentation")
    Signed-off-by: Matteo Croce <mcroce@redhat.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8406f014447221564be53ea77c236c7267346509
Author: Xin Long <lucien.xin@gmail.com>
Date:   Fri Dec 13 16:53:05 2019 +0800

    netfilter: nft_tunnel: no need to call htons() when dumping ports
    
    commit cf3e204a1ca5442190018a317d9ec181b4639bd6 upstream.
    
    info->key.tp_src and tp_dst are __be16, when using nla_put_be16()
    to dump them, htons() is not needed, so remove it in this patch.
    
    Fixes: af308b94a2a4 ("netfilter: nf_tables: add tunnel support")
    Signed-off-by: Xin Long <lucien.xin@gmail.com>
    Reviewed-by: Simon Horman <simon.horman@netronome.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f8deaccc36ba761095281e9270069ec70eb05405
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Tue Jan 14 11:06:02 2020 -0800

    thermal: brcmstb_thermal: Do not use DT coefficients
    
    commit e1ff6fc22f19e2af8adbad618526b80067911d40 upstream.
    
    At the time the brcmstb_thermal driver and its binding were merged, the
    DT binding did not make the coefficients properties a mandatory one,
    therefore all users of the brcmstb_thermal driver out there have a non
    functional implementation with zero coefficients. Even if these
    properties were provided, the formula used for computation is incorrect.
    
    The coefficients are entirely process specific (right now, only 28nm is
    supported) and not board or SoC specific, it is therefore appropriate to
    hard code them in the driver given the compatibility string we are
    probed with which has to be updated whenever a new process is
    introduced.
    
    We remove the existing coefficients definition since subsequent patches
    are going to add support for a new process and will introduce new
    coefficients as well.
    
    Fixes: 9e03cf1b2dd5 ("thermal: add brcmstb AVS TMON driver")
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Reviewed-by: Amit Kucheria <amit.kucheria@linaro.org>
    Signed-off-by: Daniel Lezcano <daniel.lezcano@linaro.org>
    Link: https://lore.kernel.org/r/20200114190607.29339-2-f.fainelli@gmail.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a6cfd392981ebe58220ad000e8539cd2795a2334
Author: Linus Walleij <linus.walleij@linaro.org>
Date:   Tue Nov 19 08:46:50 2019 +0100

    thermal: db8500: Depromote debug print
    
    commit c56dcfa3d4d0f49f0c37cd24886aa86db7aa7f30 upstream.
    
    We are not interested in getting this debug print on our
    console all the time.
    
    Cc: Daniel Lezcano <daniel.lezcano@linaro.org>
    Cc: Stephan Gerhold <stephan@gerhold.net>
    Fixes: 6c375eccded4 ("thermal: db8500: Rewrite to be a pure OF sensor")
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Reviewed-by: Stephan Gerhold <stephan@gerhold.net>
    Signed-off-by: Daniel Lezcano <daniel.lezcano@linaro.org>
    Link: https://lore.kernel.org/r/20191119074650.2664-1-linus.walleij@linaro.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3d1bfcd638f7def7abed35ac38183271bb30925b
Author: Geert Uytterhoeven <geert@linux-m68k.org>
Date:   Mon Jan 13 11:51:56 2020 +0100

    ubifs: Fix ino_t format warnings in orphan_delete()
    
    commit 155fc6ba488a8bdfd1d3be3d7ba98c9cec2b2429 upstream.
    
    On alpha and s390x:
    
        fs/ubifs/debug.h:158:11: warning: format ‘%lu’ expects argument of type ‘long unsigned int’, but argument 4 has type ‘ino_t {aka unsigned int}’ [-Wformat=]
        ...
        fs/ubifs/orphan.c:132:3: note: in expansion of macro ‘dbg_gen’
           dbg_gen("deleted twice ino %lu", orph->inum);
        ...
        fs/ubifs/orphan.c:140:3: note: in expansion of macro ‘dbg_gen’
           dbg_gen("delete later ino %lu", orph->inum);
    
    __kernel_ino_t is "unsigned long" on most architectures, but not on
    alpha and s390x, where it is "unsigned int".  Hence when printing an
    ino_t, it should always be cast to "unsigned long" first.
    
    Fix this by re-adding the recently removed casts.
    
    Fixes: 8009ce956c3d2802 ("ubifs: Don't leak orphans on memory during commit")
    Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Richard Weinberger <richard@nod.at>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4f50dbf293c007ed55d565217061b798a0ce215a
Author: Neeraj Upadhyay <neeraju@codeaurora.org>
Date:   Tue Nov 19 11:50:52 2019 -0800

    rcu: Allow only one expedited GP to run concurrently with wakeups
    
    commit 4bc6b745e5cbefed92c48071e28a5f41246d0470 upstream.
    
    The current expedited RCU grace-period code expects that a task
    requesting an expedited grace period cannot awaken until that grace
    period has reached the wakeup phase.  However, it is possible for a long
    preemption to result in the waiting task never sleeping.  For example,
    consider the following sequence of events:
    
    1.      Task A starts an expedited grace period by invoking
            synchronize_rcu_expedited().  It proceeds normally up to the
            wait_event() near the end of that function, and is then preempted
            (or interrupted or whatever).
    
    2.      The expedited grace period completes, and a kworker task starts
            the awaken phase, having incremented the counter and acquired
            the rcu_state structure's .exp_wake_mutex.  This kworker task
            is then preempted or interrupted or whatever.
    
    3.      Task A resumes and enters wait_event(), which notes that the
            expedited grace period has completed, and thus doesn't sleep.
    
    4.      Task B starts an expedited grace period exactly as did Task A,
            complete with the preemption (or whatever delay) just before
            the call to wait_event().
    
    5.      The expedited grace period completes, and another kworker
            task starts the awaken phase, having incremented the counter.
            However, it blocks when attempting to acquire the rcu_state
            structure's .exp_wake_mutex because step 2's kworker task has
            not yet released it.
    
    6.      Steps 4 and 5 repeat, resulting in overflow of the rcu_node
            structure's ->exp_wq[] array.
    
    In theory, this is harmless.  Tasks waiting on the various ->exp_wq[]
    array will just be spuriously awakened, but they will just sleep again
    on noting that the rcu_state structure's ->expedited_sequence value has
    not advanced far enough.
    
    In practice, this wastes CPU time and is an accident waiting to happen.
    This commit therefore moves the rcu_exp_gp_seq_end() call that officially
    ends the expedited grace period (along with associate tracing) until
    after the ->exp_wake_mutex has been acquired.  This prevents Task A from
    awakening prematurely, thus preventing more than one expedited grace
    period from being in flight during a previous expedited grace period's
    wakeup phase.
    
    Fixes: 3b5f668e715b ("rcu: Overlap wakeups with next expedited grace period")
    Signed-off-by: Neeraj Upadhyay <neeraju@codeaurora.org>
    [ paulmck: Added updated comment. ]
    Signed-off-by: Paul E. McKenney <paulmck@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f442bbc84fe7d10efc9adbe9d725279451cee810
Author: Sean Christopherson <sean.j.christopherson@intel.com>
Date:   Wed Dec 18 13:55:06 2019 -0800

    KVM: x86: Remove spurious clearing of async #PF MSR
    
    commit 208050dac5ef4de5cb83ffcafa78499c94d0b5ad upstream.
    
    Remove a bogus clearing of apf.msr_val from kvm_arch_vcpu_destroy().
    
    apf.msr_val is only set to a non-zero value by kvm_pv_enable_async_pf(),
    which is only reachable by kvm_set_msr_common(), i.e. by writing
    MSR_KVM_ASYNC_PF_EN.  KVM does not autonomously write said MSR, i.e.
    can only be written via KVM_SET_MSRS or KVM_RUN.  Since KVM_SET_MSRS and
    KVM_RUN are vcpu ioctls, they require a valid vcpu file descriptor.
    kvm_arch_vcpu_destroy() is only called if KVM_CREATE_VCPU fails, and KVM
    declares KVM_CREATE_VCPU successful once the vcpu fd is installed and
    thus visible to userspace.  Ergo, apf.msr_val cannot be non-zero when
    kvm_arch_vcpu_destroy() is called.
    
    Fixes: 344d9588a9df0 ("KVM: Add PV MSR to enable asynchronous page faults delivery.")
    Signed-off-by: Sean Christopherson <sean.j.christopherson@intel.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 15d651c5df4469070866fb3448312809d5d92a75
Author: Sean Christopherson <sean.j.christopherson@intel.com>
Date:   Wed Dec 18 13:55:05 2019 -0800

    KVM: x86: Remove spurious kvm_mmu_unload() from vcpu destruction path
    
    commit 9d979c7e6ff43ca3200ffcb74f57415fd633a2da upstream.
    
    x86 does not load its MMU until KVM_RUN, which cannot be invoked until
    after vCPU creation succeeds.  Given that kvm_arch_vcpu_destroy() is
    called if and only if vCPU creation fails, it is impossible for the MMU
    to be loaded.
    
    Note, the bogus kvm_mmu_unload() call was added during an unrelated
    refactoring of vCPU allocation, i.e. was presumably added as an
    opportunstic "fix" for a perceived leak.
    
    Fixes: fb3f0f51d92d1 ("KVM: Dynamically allocate vcpus")
    Signed-off-by: Sean Christopherson <sean.j.christopherson@intel.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0eb2135e91839cb3199e44881e56e8b21bff8032
Author: Peter Xu <peterx@redhat.com>
Date:   Wed Dec 4 20:07:16 2019 +0100

    KVM: X86: Fix kvm_bitmap_or_dest_vcpus() to use irq shorthand
    
    commit b4b2963616bbd91ebb33148522552e1135de56ae upstream.
    
    The 3rd parameter of kvm_apic_match_dest() is the irq shorthand,
    rather than the irq delivery mode.
    
    Fixes: 7ee30bc132c6 ("KVM: x86: deliver KVM IOAPIC scan request to target vCPUs")
    Reviewed-by: Vitaly Kuznetsov <vkuznets@redhat.com>
    Signed-off-by: Peter Xu <peterx@redhat.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 82e61a265aed4a1be7dd06c25b0533cceab903e5
Author: Xiaochen Shen <xiaochen.shen@intel.com>
Date:   Thu Dec 12 04:05:05 2019 +0800

    x86/resctrl: Check monitoring static key in the MBM overflow handler
    
    commit 536a0d8e79fb928f2735db37dda95682b6754f9a upstream.
    
    Currently, there are three static keys in the resctrl file system:
    rdt_mon_enable_key and rdt_alloc_enable_key indicate if the monitoring
    feature and the allocation feature are enabled, respectively. The
    rdt_enable_key is enabled when either the monitoring feature or the
    allocation feature is enabled.
    
    If no monitoring feature is present (either hardware doesn't support a
    monitoring feature or the feature is disabled by the kernel command line
    option "rdt="), rdt_enable_key is still enabled but rdt_mon_enable_key
    is disabled.
    
    MBM is a monitoring feature. The MBM overflow handler intends to
    check if the monitoring feature is not enabled for fast return.
    
    So check the rdt_mon_enable_key in it instead of the rdt_enable_key as
    former is the more accurate check.
    
     [ bp: Massage commit message. ]
    
    Fixes: e33026831bdb ("x86/intel_rdt/mbm: Handle counter overflow")
    Signed-off-by: Xiaochen Shen <xiaochen.shen@intel.com>
    Signed-off-by: Borislav Petkov <bp@suse.de>
    Link: https://lkml.kernel.org/r/1576094705-13660-1-git-send-email-xiaochen.shen@intel.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 255780ee8eba4ddbc1ea7f38e2cd6cb88ff09401
Author: Cengiz Can <cengiz@kernel.wtf>
Date:   Mon Jan 20 17:15:54 2020 +0300

    perf maps: Add missing unlock to maps__insert() error case
    
    commit 85fc95d75970ee7dd8e01904e7fb1197c275ba6b upstream.
    
    `tools/perf/util/map.c` has a function named `maps__insert` that
    acquires a write lock if its in multithread context.
    
    Even though this lock is released when function successfully completes,
    there's a branch that is executed when `maps_by_name == NULL` that
    returns from this function without releasing the write lock.
    
    Added an `up_write` to release the lock when this happens.
    
    Fixes: a7c2b572e217 ("perf map_groups: Auto sort maps by name, if needed")
    Signed-off-by: Cengiz Can <cengiz@kernel.wtf>
    Cc: Adrian Hunter <adrian.hunter@intel.com>
    Cc: Jiri Olsa <jolsa@kernel.org>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Link: http://lore.kernel.org/lkml/20200120141553.23934-1-cengiz@kernel.wtf
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 75286e2d2228265e59f9ee0576cf6f941c3c6143
Author: Jiri Olsa <jolsa@kernel.org>
Date:   Mon Jan 13 11:43:57 2020 +0100

    perf ui gtk: Add missing zalloc object
    
    commit 604e2139a1026793b8c2172bd92c7e9d039a5cf0 upstream.
    
    When we moved zalloc.o to the library we missed gtk library which needs
    it compiled in, otherwise the missing __zfree symbol will cause the
    library to fail to load.
    
    Adding the zalloc object to the gtk library build.
    
    Fixes: 7f7c536f23e6 ("tools lib: Adopt zalloc()/zfree() from tools/perf")
    Signed-off-by: Jiri Olsa <jolsa@kernel.org>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Jelle van der Waa <jelle@vdwaa.nl>
    Cc: Michael Petlan <mpetlan@redhat.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Link: http://lore.kernel.org/lkml/20200113104358.123511-1-jolsa@kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c0a8d98fb0b9c7144b8f014e171622208fb92df4
Author: Arnaldo Carvalho de Melo <acme@redhat.com>
Date:   Mon Dec 16 13:22:33 2019 -0300

    perf hists browser: Restore ESC as "Zoom out" of DSO/thread/etc
    
    commit 3f7774033e6820d25beee5cf7aefa11d4968b951 upstream.
    
    We need to set actions->ms.map since 599a2f38a989 ("perf hists browser:
    Check sort keys before hot key actions"), as in that patch we bail out
    if map is NULL.
    
    Reviewed-by: Jiri Olsa <jolsa@kernel.org>
    Cc: Adrian Hunter <adrian.hunter@intel.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Fixes: 599a2f38a989 ("perf hists browser: Check sort keys before hot key actions")
    Link: https://lkml.kernel.org/n/tip-wp1ssoewy6zihwwexqpohv0j@git.kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6d680ef01de07fd2b240c0a76c140b2df93b4c60
Author: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Date:   Mon Nov 11 10:03:56 2019 +0100

    pwm: omap-dmtimer: put_device() after of_find_device_by_node()
    
    commit c7cb3a1dd53f63c64fb2b567d0be130b92a44d91 upstream.
    
    This was found by coccicheck:
    
            drivers/pwm/pwm-omap-dmtimer.c:304:2-8: ERROR: missing put_device;
            call of_find_device_by_node on line 255, but without a corresponding
            object release within this function.
    
    Reported-by: Markus Elfring <elfring@users.sourceforge.net>
    Fixes: 6604c6556db9 ("pwm: Add PWM driver for OMAP using dual-mode timers")
    Signed-off-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
    Signed-off-by: Thierry Reding <thierry.reding@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 05f4a6e5a615841f7cf87ae969cbc6ec499bb2b3
Author: Thomas Gleixner <tglx@linutronix.de>
Date:   Tue Jan 14 19:52:39 2020 +0100

    lib/vdso: Update coarse timekeeper unconditionally
    
    commit 9f24c540f7f8eb3a981528da9a9a636a5bdf5987 upstream.
    
    The low resolution parts of the VDSO, i.e.:
    
      clock_gettime(CLOCK_*_COARSE), clock_getres(), time()
    
    can be used even if there is no VDSO capable clocksource.
    
    But if an architecture opts out of the VDSO data update then this
    information becomes stale. This affects ARM when there is no architected
    timer available. The lack of update causes userspace to use stale data
    forever.
    
    Make the update of the low resolution parts unconditional and only skip
    the update of the high resolution parts if the architecture requests it.
    
    Fixes: 44f57d788e7d ("timekeeping: Provide a generic update_vsyscall() implementation")
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Link: https://lore.kernel.org/r/20200114185946.765577901@linutronix.de
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 993cc7831665fc732a6394d4ad84f093b16a2c6e
Author: Thomas Gleixner <tglx@linutronix.de>
Date:   Tue Jan 14 19:52:38 2020 +0100

    lib/vdso: Make __arch_update_vdso_data() logic understandable
    
    commit 9a6b55ac4a44060bcb782baf002859b2a2c63267 upstream.
    
    The function name suggests that this is a boolean checking whether the
    architecture asks for an update of the VDSO data, but it works the other
    way round. To spare further confusion invert the logic.
    
    Fixes: 44f57d788e7d ("timekeeping: Provide a generic update_vsyscall() implementation")
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Link: https://lore.kernel.org/r/20200114185946.656652824@linutronix.de
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8fa62cc9f2539147c0735850f571aca9cd09d0f1
Author: Masami Hiramatsu <mhiramat@kernel.org>
Date:   Wed Nov 27 14:57:04 2019 +0900

    kprobes: Set unoptimized flag after unoptimizing code
    
    commit f66c0447cca1281116224d474cdb37d6a18e4b5b upstream.
    
    Set the unoptimized flag after confirming the code is completely
    unoptimized. Without this fix, when a kprobe hits the intermediate
    modified instruction (the first byte is replaced by an INT3, but
    later bytes can still be a jump address operand) while unoptimizing,
    it can return to the middle byte of the modified code, which causes
    an invalid instruction exception in the kernel.
    
    Usually, this is a rare case, but if we put a probe on the function
    call while text patching, it always causes a kernel panic as below:
    
     # echo p text_poke+5 > kprobe_events
     # echo 1 > events/kprobes/enable
     # echo 0 > events/kprobes/enable
    
    invalid opcode: 0000 [#1] PREEMPT SMP PTI
     RIP: 0010:text_poke+0x9/0x50
     Call Trace:
      arch_unoptimize_kprobe+0x22/0x28
      arch_unoptimize_kprobes+0x39/0x87
      kprobe_optimizer+0x6e/0x290
      process_one_work+0x2a0/0x610
      worker_thread+0x28/0x3d0
      ? process_one_work+0x610/0x610
      kthread+0x10d/0x130
      ? kthread_park+0x80/0x80
      ret_from_fork+0x3a/0x50
    
    text_poke() is used for patching the code in optprobes.
    
    This can happen even if we blacklist text_poke() and other functions,
    because there is a small time window during which we show the intermediate
    code to other CPUs.
    
     [ mingo: Edited the changelog. ]
    
    Tested-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Masami Hiramatsu <mhiramat@kernel.org>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Steven Rostedt <rostedt@goodmis.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: bristot@redhat.com
    Fixes: 6274de4984a6 ("kprobes: Support delayed unoptimizing")
    Link: https://lkml.kernel.org/r/157483422375.25881.13508326028469515760.stgit@devnote2
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3920a764f2a7c6b890ec386a7f3768bfb55e261c
Author: Janne Karhunen <janne.karhunen@gmail.com>
Date:   Wed Jan 15 17:42:30 2020 +0200

    ima: ima/lsm policy rule loading logic bug fixes
    
    commit 483ec26eed42bf050931d9a5c5f9f0b5f2ad5f3b upstream.
    
    Keep the ima policy rules around from the beginning even if they appear
    invalid at the time of loading, as they may become active after an lsm
    policy load.  However, loading a custom IMA policy with unknown LSM
    labels is only safe after we have transitioned from the "built-in"
    policy rules to a custom IMA policy.
    
    Patch also fixes the rule re-use during the lsm policy reload and makes
    some prints a bit more human readable.
    
    Changelog:
    v4:
    - Do not allow the initial policy load refer to non-existing lsm rules.
    v3:
    - Fix too wide policy rule matching for non-initialized LSMs
    v2:
    - Fix log prints
    
    Fixes: b16942455193 ("ima: use the lsm policy update notifier")
    Cc: Casey Schaufler <casey@schaufler-ca.com>
    Reported-by: Mimi Zohar <zohar@linux.ibm.com>
    Signed-off-by: Janne Karhunen <janne.karhunen@gmail.com>
    Signed-off-by: Konsta Karsisto <konsta.karsisto@gmail.com>
    Signed-off-by: Mimi Zohar <zohar@linux.ibm.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 58131dfb303fec977ebba6dddd3c266bd6588a66
Author: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
Date:   Sun Jan 26 11:44:29 2020 +0100

    drivers: net: xgene: Fix the order of the arguments of 'alloc_etherdev_mqs()'
    
    commit 5a44c71ccda60a50073c5d7fe3f694cdfa3ab0c2 upstream.
    
    'alloc_etherdev_mqs()' expects first 'tx', then 'rx'. The semantic here
    looks reversed.
    
    Reorder the arguments passed to 'alloc_etherdev_mqs()' in order to keep
    the correct semantic.
    
    In fact, this is a no-op because both XGENE_NUM_[RT]X_RING are 8.
    
    Fixes: 107dec2749fe ("drivers: net: xgene: Add support for multiple queues")
    Signed-off-by: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 25bda0cba6f8c2db5e4bb0d117300ef4a84058b4
Author: Lijun Ou <oulijun@huawei.com>
Date:   Thu Jan 9 20:10:52 2020 +0800

    RDMA/hns: Bugfix for posting a wqe with sge
    
    commit 468d020e2f02867b8ec561461a1689cd4365e493 upstream.
    
    Driver should first check whether the sge is valid, then fill the valid
    sge and the caculated total into hardware, otherwise invalid sges will
    cause an error.
    
    Fixes: 52e3b42a2f58 ("RDMA/hns: Filter for zero length of sge in hip08 kernel mode")
    Fixes: 7bdee4158b37 ("RDMA/hns: Fill sq wqe context of ud type in hip08")
    Link: https://lore.kernel.org/r/1578571852-13704-1-git-send-email-liweihang@huawei.com
    Signed-off-by: Lijun Ou <oulijun@huawei.com>
    Signed-off-by: Weihang Li <liweihang@huawei.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e29cdb27c608eab37bec74860a6266252cdb18e5
Author: Yixian Liu <liuyixian@huawei.com>
Date:   Tue Dec 10 20:45:02 2019 +0800

    RDMA/hns: Simplify the calculation and usage of wqe idx for post verbs
    
    commit 4768820243d71d49f1044b3f911ac3d52bdb79af upstream.
    
    Currently, the wqe idx is calculated repeatly everywhere it is used.  This
    patch defines wqe_idx and calculated it only once, then just use it as
    needed.
    
    Fixes: 2d40788825ac ("RDMA/hns: Add support for processing send wr and receive wr")
    Link: https://lore.kernel.org/r/1575981902-5274-1-git-send-email-liweihang@hisilicon.com
    Signed-off-by: Yixian Liu <liuyixian@huawei.com>
    Signed-off-by: Weihang Li <liweihang@hisilicon.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3d6cf5c75ea54d338df3d89f2da56b98d4812011
Author: Chao Yu <chao@kernel.org>
Date:   Fri Dec 27 18:44:56 2019 +0800

    f2fs: fix to add swap extent correctly
    
    commit 3e5e479a39ce9ed60cd63f7565cc1d9da77c2a4e upstream.
    
    As Youling reported in mailing list:
    
    https://www.linuxquestions.org/questions/linux-newbie-8/the-file-system-f2fs-is-broken-4175666043/
    
    https://www.linux.org/threads/the-file-system-f2fs-is-broken.26490/
    
    There is a test case can corrupt f2fs image:
    - dd if=/dev/zero of=/swapfile bs=1M count=4096
    - chmod 600 /swapfile
    - mkswap /swapfile
    - swapon --discard /swapfile
    
    The root cause is f2fs_swap_activate() intends to return zero value
    to setup_swap_extents() to enable SWP_FS mode (swap file goes through
    fs), in this flow, setup_swap_extents() setups swap extent with wrong
    block address range, result in discard_swap() erasing incorrect address.
    
    Because f2fs_swap_activate() has pinned swapfile, its data block
    address will not change, it's safe to let swap to handle IO through
    raw device, so we can get rid of SWAP_FS mode and initial swap extents
    inside f2fs_swap_activate(), by this way, later discard_swap() can trim
    in right address range.
    
    Fixes: 4969c06a0d83 ("f2fs: support swap file w/ DIO")
    Signed-off-by: Chao Yu <yuchao0@huawei.com>
    Signed-off-by: Jaegeuk Kim <jaegeuk@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit aa7510886fcae01ee78a05f13e1dc1b9af5dc0d1
Author: Cheng Jian <cj.chengjian@huawei.com>
Date:   Fri Dec 13 10:45:30 2019 +0800

    sched/fair: Optimize select_idle_cpu
    
    commit 60588bfa223ff675b95f866249f90616613fbe31 upstream.
    
    select_idle_cpu() will scan the LLC domain for idle CPUs,
    it's always expensive. so the next commit :
    
            1ad3aaf3fcd2 ("sched/core: Implement new approach to scale select_idle_cpu()")
    
    introduces a way to limit how many CPUs we scan.
    
    But it consume some CPUs out of 'nr' that are not allowed
    for the task and thus waste our attempts. The function
    always return nr_cpumask_bits, and we can't find a CPU
    which our task is allowed to run.
    
    Cpumask may be too big, similar to select_idle_core(), use
    per_cpu_ptr 'select_idle_mask' to prevent stack overflow.
    
    Fixes: 1ad3aaf3fcd2 ("sched/core: Implement new approach to scale select_idle_cpu()")
    Signed-off-by: Cheng Jian <cj.chengjian@huawei.com>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Reviewed-by: Srikar Dronamraju <srikar@linux.vnet.ibm.com>
    Reviewed-by: Vincent Guittot <vincent.guittot@linaro.org>
    Reviewed-by: Valentin Schneider <valentin.schneider@arm.com>
    Link: https://lkml.kernel.org/r/20191213024530.28052-1-cj.chengjian@huawei.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 95c69fb5d1d258c6b70a2ca5d3364a710adf39c7
Author: Sean Christopherson <sean.j.christopherson@intel.com>
Date:   Thu Jan 9 15:56:18 2020 -0800

    KVM: Check for a bad hva before dropping into the ghc slow path
    
    commit fcfbc617547fc6d9552cb6c1c563b6a90ee98085 upstream.
    
    When reading/writing using the guest/host cache, check for a bad hva
    before checking for a NULL memslot, which triggers the slow path for
    handing cross-page accesses.  Because the memslot is nullified on error
    by __kvm_gfn_to_hva_cache_init(), if the bad hva is encountered after
    crossing into a new page, then the kvm_{read,write}_guest() slow path
    could potentially write/access the first chunk prior to detecting the
    bad hva.
    
    Arguably, performing a partial access is semantically correct from an
    architectural perspective, but that behavior is certainly not intended.
    In the original implementation, memslot was not explicitly nullified
    and therefore the partial access behavior varied based on whether the
    memslot itself was null, or if the hva was simply bad.  The current
    behavior was introduced as a seemingly unintentional side effect in
    commit f1b9dd5eb86c ("kvm: Disallow wraparound in
    kvm_gfn_to_hva_cache_init"), which justified the change with "since some
    callers don't check the return code from this function, it sit seems
    prudent to clear ghc->memslot in the event of an error".
    
    Regardless of intent, the partial access is dependent on _not_ checking
    the result of the cache initialization, which is arguably a bug in its
    own right, at best simply weird.
    
    Fixes: 8f964525a121 ("KVM: Allow cross page reads and writes from cached translations.")
    Cc: Jim Mattson <jmattson@google.com>
    Cc: Andrew Honig <ahonig@google.com>
    Signed-off-by: Sean Christopherson <sean.j.christopherson@intel.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 36a896ecbb65d53131d6e80f99344e9ff668e06b
Author: Tom Lendacky <thomas.lendacky@amd.com>
Date:   Thu Jan 9 17:42:16 2020 -0600

    KVM: SVM: Override default MMIO mask if memory encryption is enabled
    
    commit 52918ed5fcf05d97d257f4131e19479da18f5d16 upstream.
    
    The KVM MMIO support uses bit 51 as the reserved bit to cause nested page
    faults when a guest performs MMIO. The AMD memory encryption support uses
    a CPUID function to define the encryption bit position. Given this, it is
    possible that these bits can conflict.
    
    Use svm_hardware_setup() to override the MMIO mask if memory encryption
    support is enabled. Various checks are performed to ensure that the mask
    is properly defined and rsvd_bits() is used to generate the new mask (as
    was done prior to the change that necessitated this patch).
    
    Fixes: 28a1f3ac1d0c ("kvm: x86: Set highest physical address bits in non-present/reserved SPTEs")
    Suggested-by: Sean Christopherson <sean.j.christopherson@intel.com>
    Reviewed-by: Sean Christopherson <sean.j.christopherson@intel.com>
    Signed-off-by: Tom Lendacky <thomas.lendacky@amd.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7c901246c994af80ac5d272058c0e8242b5a18ad
Author: Jin Yao <yao.jin@linux.intel.com>
Date:   Wed Jan 8 03:17:45 2020 +0800

    perf report: Fix no libunwind compiled warning break s390 issue
    
    commit c3314a74f86dc00827e0945c8e5039fc3aebaa3c upstream.
    
    Commit 800d3f561659 ("perf report: Add warning when libunwind not
    compiled in") breaks the s390 platform. S390 uses libdw-dwarf-unwind for
    call chain unwinding and had no support for libunwind.
    
    So the warning "Please install libunwind development packages during the
    perf build." caused the confusion even if the call-graph is displayed
    correctly.
    
    This patch adds checking for HAVE_DWARF_SUPPORT, which is set when
    libdw-dwarf-unwind is compiled in.
    
    Fixes: 800d3f561659 ("perf report: Add warning when libunwind not compiled in")
    Signed-off-by: Jin Yao <yao.jin@linux.intel.com>
    Reviewed-by: Thomas Richter <tmricht@linux.ibm.com>
    Tested-by: Thomas Richter <tmricht@linux.ibm.com>
    Acked-by: Jiri Olsa <jolsa@redhat.com>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Andi Kleen <ak@linux.intel.com>
    Cc: Jin Yao <yao.jin@intel.com>
    Cc: Kan Liang <kan.liang@linux.intel.com>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Link: http://lore.kernel.org/lkml/20200107191745.18415-1-yao.jin@linux.intel.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f4850b7bce4180bb08782d677eb958ca5c771134
Author: Brian Norris <briannorris@chromium.org>
Date:   Mon Dec 9 16:39:11 2019 -0800

    mwifiex: delete unused mwifiex_get_intf_num()
    
    commit 1c9f329b084b7b8ea6d60d91a202e884cdcf6aae upstream.
    
    Commit 7afb94da3cd8 ("mwifiex: update set_mac_address logic") fixed the
    only user of this function, partly because the author seems to have
    noticed that, as written, it's on the borderline between highly
    misleading and buggy.
    
    Anyway, no sense in keeping dead code around: let's drop it.
    
    Fixes: 7afb94da3cd8 ("mwifiex: update set_mac_address logic")
    Signed-off-by: Brian Norris <briannorris@chromium.org>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 01af9acc8c69aada7914e33cc47290ae2c820207
Author: Brian Norris <briannorris@chromium.org>
Date:   Fri Dec 6 11:45:35 2019 -0800

    mwifiex: drop most magic numbers from mwifiex_process_tdls_action_frame()
    
    commit 70e5b8f445fd27fde0c5583460e82539a7242424 upstream.
    
    Before commit 1e58252e334d ("mwifiex: Fix heap overflow in
    mmwifiex_process_tdls_action_frame()"),
    mwifiex_process_tdls_action_frame() already had too many magic numbers.
    But this commit just added a ton more, in the name of checking for
    buffer overflows. That seems like a really bad idea.
    
    Let's make these magic numbers a little less magic, by
    (a) factoring out 'pos[1]' as 'ie_len'
    (b) using 'sizeof' on the appropriate source or destination fields where
        possible, instead of bare numbers
    (c) dropping redundant checks, per below.
    
    Regarding redundant checks: the beginning of the loop has this:
    
                    if (pos + 2 + pos[1] > end)
                            break;
    
    but then individual 'case's include stuff like this:
    
                            if (pos > end - 3)
                                    return;
                            if (pos[1] != 1)
                                    return;
    
    Note that the second 'return' (validating the length, pos[1]) combined
    with the above condition (ensuring 'pos + 2 + length' doesn't exceed
    'end'), makes the first 'return' (whose 'if' can be reworded as 'pos >
    end - pos[1] - 2') redundant. Rather than unwind the magic numbers
    there, just drop those conditions.
    
    Fixes: 1e58252e334d ("mwifiex: Fix heap overflow in mmwifiex_process_tdls_action_frame()")
    Signed-off-by: Brian Norris <briannorris@chromium.org>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 02ecee5f380fcbad9ce0e48ac088596d956c3f72
Author: Aleksa Sarai <cyphar@cyphar.com>
Date:   Sat Dec 7 01:13:26 2019 +1100

    namei: only return -ECHILD from follow_dotdot_rcu()
    
    commit 2b98149c2377bff12be5dd3ce02ae0506e2dd613 upstream.
    
    It's over-zealous to return hard errors under RCU-walk here, given that
    a REF-walk will be triggered for all other cases handling ".." under
    RCU.
    
    The original purpose of this check was to ensure that if a rename occurs
    such that a directory is moved outside of the bind-mount which the
    resolution started in, it would be detected and blocked to avoid being
    able to mess with paths outside of the bind-mount. However, triggering a
    new REF-walk is just as effective a solution.
    
    Cc: "Eric W. Biederman" <ebiederm@xmission.com>
    Fixes: 397d425dc26d ("vfs: Test for and handle paths that are unreachable from their mnt_root")
    Suggested-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Aleksa Sarai <cyphar@cyphar.com>
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9184d43bf6c9dfa337e1e7290ca89f894aa462ff
Author: Tuong Lien <tuong.t.lien@dektech.com.au>
Date:   Mon Feb 10 15:35:44 2020 +0700

    tipc: fix successful connect() but timed out
    
    commit 5391a87751a164b3194864126f3b016038abc9fe upstream.
    
    In commit 9546a0b7ce00 ("tipc: fix wrong connect() return code"), we
    fixed the issue with the 'connect()' that returns zero even though the
    connecting has failed by waiting for the connection to be 'ESTABLISHED'
    really. However, the approach has one drawback in conjunction with our
    'lightweight' connection setup mechanism that the following scenario
    can happen:
    
              (server)                        (client)
    
       +- accept()|                      |             wait_for_conn()
       |          |                      |connect() -------+
       |          |<-------[SYN]---------|                 > sleeping
       |          |                      *CONNECTING       |
       |--------->*ESTABLISHED           |                 |
                  |--------[ACK]-------->*ESTABLISHED      > wakeup()
            send()|--------[DATA]------->|\                > wakeup()
            send()|--------[DATA]------->| |               > wakeup()
              .   .          .           . |-> recvq       .
              .   .          .           . |               .
            send()|--------[DATA]------->|/                > wakeup()
           close()|--------[FIN]-------->*DISCONNECTING    |
                  *DISCONNECTING         |                 |
                  |                      ~~~~~~~~~~~~~~~~~~> schedule()
                                                           | wait again
                                                           .
                                                           .
                                                           | ETIMEDOUT
    
    Upon the receipt of the server 'ACK', the client becomes 'ESTABLISHED'
    and the 'wait_for_conn()' process is woken up but not run. Meanwhile,
    the server starts to send a number of data following by a 'close()'
    shortly without waiting any response from the client, which then forces
    the client socket to be 'DISCONNECTING' immediately. When the wait
    process is switched to be running, it continues to wait until the timer
    expires because of the unexpected socket state. The client 'connect()'
    will finally get ‘-ETIMEDOUT’ and force to release the socket whereas
    there remains the messages in its receive queue.
    
    Obviously the issue would not happen if the server had some delay prior
    to its 'close()' (or the number of 'DATA' messages is large enough),
    but any kind of delay would make the connection setup/shutdown "heavy".
    We solve this by simply allowing the 'connect()' returns zero in this
    particular case. The socket is already 'DISCONNECTING', so any further
    write will get '-EPIPE' but the socket is still able to read the
    messages existing in its receive queue.
    
    Note: This solution doesn't break the previous one as it deals with a
    different situation that the socket state is 'DISCONNECTING' but has no
    error (i.e. sk->sk_err = 0).
    
    Fixes: 9546a0b7ce00 ("tipc: fix wrong connect() return code")
    Acked-by: Ying Xue <ying.xue@windriver.com>
    Acked-by: Jon Maloy <jon.maloy@ericsson.com>
    Signed-off-by: Tuong Lien <tuong.t.lien@dektech.com.au>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c814e82373b1c74242dca1c9e0bd4445922cb317
Author: Arthur Kiyanovski <akiyano@amazon.com>
Date:   Tue Feb 11 15:17:49 2020 +0000

    net: ena: make ena rxfh support ETH_RSS_HASH_NO_CHANGE
    
    commit 470793a78ce344bd53d31e0c2d537f71ba957547 upstream.
    
    As the name suggests ETH_RSS_HASH_NO_CHANGE is received upon changing
    the key or indirection table using ethtool while keeping the same hash
    function.
    
    Also add a function for retrieving the current hash function from
    the ena-com layer.
    
    Fixes: 1738cd3ed342 ("net: ena: Add a driver for Amazon Elastic Network Adapters (ENA)")
    Signed-off-by: Sameeh Jubran <sameehj@amazon.com>
    Signed-off-by: Saeed Bshara <saeedb@amazon.com>
    Signed-off-by: Arthur Kiyanovski <akiyano@amazon.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cd1e0de2f1af40b2bc77cb53ef78549eb383a827
Author: Ursula Braun <ubraun@linux.ibm.com>
Date:   Fri Feb 14 08:59:00 2020 +0100

    net/smc: no peer ID in CLC decline for SMCD
    
    commit 369537c97024dca99303a8d4d6ab38b4f54d3909 upstream.
    
    Just SMCR requires a CLC Peer ID, but not SMCD. The field should be
    zero for SMCD.
    
    Fixes: c758dfddc1b5 ("net/smc: add SMC-D support in CLC messages")
    Signed-off-by: Ursula Braun <ubraun@linux.ibm.com>
    Signed-off-by: Karsten Graul <kgraul@linux.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0ace3dbb6d285dbd52c73049946f02e809291bde
Author: Michael Ellerman <mpe@ellerman.id.au>
Date:   Thu Feb 20 15:42:41 2020 +1100

    selftests: Install settings files to fix TIMEOUT failures
    
    commit b9167c8078c3527de6da241c8a1a75a9224ed90a upstream.
    
    Commit 852c8cbf34d3 ("selftests/kselftest/runner.sh: Add 45 second
    timeout per test") added a 45 second timeout for tests, and also added
    a way for tests to customise the timeout via a settings file.
    
    For example the ftrace tests take multiple minutes to run, so they
    were given longer in commit b43e78f65b1d ("tracing/selftests: Turn off
    timeout setting").
    
    This works when the tests are run from the source tree. However if the
    tests are installed with "make -C tools/testing/selftests install",
    the settings files are not copied into the install directory. When the
    tests are then run from the install directory the longer timeouts are
    not applied and the tests timeout incorrectly.
    
    So add the settings files to TEST_FILES of the appropriate Makefiles
    to cause the settings files to be installed using the existing install
    logic.
    
    Fixes: 852c8cbf34d3 ("selftests/kselftest/runner.sh: Add 45 second timeout per test")
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Shuah Khan <skhan@linuxfoundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 897244d49e81b0a83960e4dee8b3a79d00488ed6
Author: Dmitry Bogdanov <dbogdanov@marvell.com>
Date:   Fri Feb 14 18:44:58 2020 +0300

    net: atlantic: fix out of range usage of active_vlans array
    
    commit 5a292c89a84d49b598f8978f154bdda48b1072c0 upstream.
    
    fix static checker warning:
     drivers/net/ethernet/aquantia/atlantic/aq_filters.c:166 aq_check_approve_fvlan()
     error: passing untrusted data to 'test_bit()'
    
    Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
    Fixes: 7975d2aff5af: ("net: aquantia: add support of rx-vlan-filter offload")
    Signed-off-by: Dmitry Bogdanov <dbogdanov@marvell.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8943e79c928106f21596c25292798c15aa365fdd
Author: Pavel Belous <pbelous@marvell.com>
Date:   Fri Feb 14 18:44:57 2020 +0300

    net: atlantic: possible fault in transition to hibernation
    
    commit 52a22f4d6ff95e8bdca557765c04893eb5dd83fd upstream.
    
    during hibernation freeze, aq_nic_stop could be invoked
    on a stopped device. That may cause panic on access to
    not yet allocated vector/ring structures.
    
    Add a check to stop device if it is not yet stopped.
    
    Similiarly after freeze in hibernation thaw, aq_nic_start
    could be invoked on a not initialized net device.
    Result will be the same.
    
    Add a check to start device if it is initialized.
    In our case, this is the same as started.
    
    Fixes: 8aaa112a57c1 ("net: atlantic: refactoring pm logic")
    Signed-off-by: Pavel Belous <pbelous@marvell.com>
    Signed-off-by: Nikita Danilov <ndanilov@marvell.com>
    Signed-off-by: Igor Russkikh <irusskikh@marvell.com>
    Signed-off-by: Dmitry Bogdanov <dbogdanov@marvell.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cfde03060aa396a3b537781f81874d2a9ca0529e
Author: Pavel Belous <pbelous@marvell.com>
Date:   Fri Feb 14 18:44:56 2020 +0300

    net: atlantic: fix potential error handling
    
    commit 380ec5b9af7f0d57dbf6ac067fd9f33cff2fef71 upstream.
    
    Code inspection found that in case of mapping error we do return current
    'ret' value. But beside error, it is used to count number of descriptors
    allocated for the packet. In that case map_skb function could return '1'.
    
    Changing it to return zero (number of mapped descriptors for skb)
    
    Fixes: 018423e90bee ("net: ethernet: aquantia: Add ring support code")
    Signed-off-by: Pavel Belous <pbelous@marvell.com>
    Signed-off-by: Igor Russkikh <irusskikh@marvell.com>
    Signed-off-by: Dmitry Bogdanov <dbogdanov@marvell.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7b288eb4f7aeceee3980ba01f28fc341fbb90556
Author: Pavel Belous <pbelous@marvell.com>
Date:   Fri Feb 14 18:44:55 2020 +0300

    net: atlantic: fix use after free kasan warn
    
    commit a4980919ad6a7be548d499bc5338015e1a9191c6 upstream.
    
    skb->len is used to calculate statistics after xmit invocation.
    
    Under a stress load it may happen that skb will be xmited,
    rx interrupt will come and skb will be freed, all before xmit function
    is even returned.
    
    Eventually, skb->len will access unallocated area.
    
    Moving stats calculation into tx_clean routine.
    
    Fixes: 018423e90bee ("net: ethernet: aquantia: Add ring support code")
    Reported-by: Christophe Vu-Brugier <cvubrugier@fastmail.fm>
    Signed-off-by: Igor Russkikh <irusskikh@marvell.com>
    Signed-off-by: Pavel Belous <pbelous@marvell.com>
    Signed-off-by: Dmitry Bogdanov <dbogdanov@marvell.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 88436c02f5da586d08cfa2c227c3ec18d4ffcda9
Author: Nikita Danilov <ndanilov@marvell.com>
Date:   Fri Feb 14 18:44:54 2020 +0300

    net: atlantic: better loopback mode handling
    
    commit b42726fcf76e9367e524392e0ead7e672cc0791c upstream.
    
    Add checks to not enable multiple loopback modes simultaneously,
    It was also discovered that for dma loopback to function correctly
    promisc mode should be enabled on device.
    
    Fixes: ea4b4d7fc106 ("net: atlantic: loopback tests via private flags")
    Signed-off-by: Nikita Danilov <ndanilov@marvell.com>
    Signed-off-by: Igor Russkikh <irusskikh@marvell.com>
    Signed-off-by: Dmitry Bogdanov <dbogdanov@marvell.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 24df8caaee993cd97e16483429ba6c441faa642d
Author: Dmitry Bezrukov <dbezrukov@marvell.com>
Date:   Fri Feb 14 18:44:51 2020 +0300

    net: atlantic: checksum compat issue
    
    commit 15beab0a9d797be1b7c67458da007a62269be29a upstream.
    
    Yet another checksum offload compatibility issue was found.
    
    The known issue is that AQC HW marks tcp packets with 0xFFFF checksum
    as invalid (1). This is workarounded in driver, passing all the suspicious
    packets up to the stack for further csum validation.
    
    Another HW problem (2) is that it hides invalid csum of LRO aggregated
    packets inside of the individual descriptors. That was workarounded
    by forced scan of all LRO descriptors for checksum errors.
    
    However the scan logic was joint for both LRO and multi-descriptor
    packets (jumbos). And this causes the issue.
    
    We have to drop LRO packets with the detected bad checksum
    because of (2), but we have to pass jumbo packets to stack because of (1).
    
    When using windows tcp partner with jumbo frames but with LSO disabled
    driver discards such frames as bad checksummed. But only LRO frames
    should be dropped, not jumbos.
    
    On such a configurations tcp stream have a chance of drops and stucks.
    
    (1) 76f254d4afe2 ("net: aquantia: tcp checksum 0xffff being handled incorrectly")
    (2) d08b9a0a3ebd ("net: aquantia: do not pass lro session with invalid tcp checksum")
    
    Fixes: d08b9a0a3ebd ("net: aquantia: do not pass lro session with invalid tcp checksum")
    Signed-off-by: Dmitry Bezrukov <dbezrukov@marvell.com>
    Signed-off-by: Igor Russkikh <irusskikh@marvell.com>
    Signed-off-by: Dmitry Bogdanov <dbogdanov@marvell.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit eef6f7cb5a2e1c5162d8417d2541d134357eadb9
Author: Nikolay Aleksandrov <nikolay@cumulusnetworks.com>
Date:   Thu Feb 20 16:42:13 2020 +0200

    net: netlink: cap max groups which will be considered in netlink_bind()
    
    commit 3a20773beeeeadec41477a5ba872175b778ff752 upstream.
    
    Since nl_groups is a u32 we can't bind more groups via ->bind
    (netlink_bind) call, but netlink has supported more groups via
    setsockopt() for a long time and thus nlk->ngroups could be over 32.
    Recently I added support for per-vlan notifications and increased the
    groups to 33 for NETLINK_ROUTE which exposed an old bug in the
    netlink_bind() code causing out-of-bounds access on archs where unsigned
    long is 32 bits via test_bit() on a local variable. Fix this by capping the
    maximum groups in netlink_bind() to BITS_PER_TYPE(u32), effectively
    capping them at 32 which is the minimum of allocated groups and the
    maximum groups which can be bound via netlink_bind().
    
    CC: Christophe Leroy <christophe.leroy@c-s.fr>
    CC: Richard Guy Briggs <rgb@redhat.com>
    Fixes: 4f520900522f ("netlink: have netlink per-protocol bind function return an error code.")
    Reported-by: Erhard F. <erhard_f@mailbox.org>
    Signed-off-by: Nikolay Aleksandrov <nikolay@cumulusnetworks.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 227fb1306d0638a7bf1e9a97f033b07cc52def57
Author: Julian Wiedmann <jwi@linux.ibm.com>
Date:   Thu Feb 20 15:54:56 2020 +0100

    s390/qeth: fix off-by-one in RX copybreak check
    
    commit 54a61fbc020fd2e305680871c453abcf7fc0339b upstream.
    
    The RX copybreak is intended as the _max_ value where the frame's data
    should be copied. So for frame_len == copybreak, don't build an SG skb.
    
    Fixes: 4a71df50047f ("qeth: new qeth device driver")
    Signed-off-by: Julian Wiedmann <jwi@linux.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e912bd31c1dfcb13addf29ba44ebc13dba70dc18
Author: Alexandra Winter <wintera@linux.ibm.com>
Date:   Thu Feb 20 15:54:54 2020 +0100

    s390/qeth: vnicc Fix EOPNOTSUPP precedence
    
    commit 6f3846f0955308b6d1b219419da42b8de2c08845 upstream.
    
    When getting or setting VNICC parameters, the error code EOPNOTSUPP
    should have precedence over EBUSY.
    
    EBUSY is used because vnicc feature and bridgeport feature are mutually
    exclusive, which is a temporary condition.
    Whereas EOPNOTSUPP indicates that the HW does not support all or parts of
    the vnicc feature.
    This issue causes the vnicc sysfs params to show 'blocked by bridgeport'
    for HW that does not support VNICC at all.
    
    Fixes: caa1f0b10d18 ("s390/qeth: add VNICC enable/disable support")
    Signed-off-by: Alexandra Winter <wintera@linux.ibm.com>
    Signed-off-by: Julian Wiedmann <jwi@linux.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1258d9c2c6d7f5c57266d561662521540997b311
Author: Bijan Mottahedeh <bijan.mottahedeh@oracle.com>
Date:   Wed Feb 26 18:53:43 2020 -0800

    nvme-pci: Hold cq_poll_lock while completing CQEs
    
    commit 9515743bfb39c61aaf3d4f3219a645c8d1fe9a0e upstream.
    
    Completions need to consumed in the same order the controller submitted
    them, otherwise future completion entries may overwrite ones we haven't
    handled yet. Hold the nvme queue's poll lock while completing new CQEs to
    prevent another thread from freeing command tags for reuse out-of-order.
    
    Fixes: dabcefab45d3 ("nvme: provide optimized poll function for separate poll queues")
    Signed-off-by: Bijan Mottahedeh <bijan.mottahedeh@oracle.com>
    Reviewed-by: Sagi Grimberg <sagi@grimberg.me>
    Reviewed-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Keith Busch <kbusch@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6d69442d49895eb3234a02c99291f289e0ee7e78
Author: Peter Chen <peter.chen@nxp.com>
Date:   Sat Feb 1 14:13:44 2020 +0800

    usb: charger: assign specific number for enum value
    
    commit ca4b43c14cd88d28cfc6467d2fa075aad6818f1d upstream.
    
    To work properly on every architectures and compilers, the enum value
    needs to be specific numbers.
    
    Suggested-by: Greg KH <gregkh@linuxfoundation.org>
    Signed-off-by: Peter Chen <peter.chen@nxp.com>
    Link: https://lore.kernel.org/r/1580537624-10179-1-git-send-email-peter.chen@nxp.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 68c35699001ec9c3bfcb2fa80e6f47c26815cae7
Author: Haiyang Zhang <haiyangz@microsoft.com>
Date:   Fri Feb 21 08:32:18 2020 -0800

    hv_netvsc: Fix unwanted wakeup in netvsc_attach()
    
    commit f6f13c125e05603f68f5bf31f045b95e6d493598 upstream.
    
    When netvsc_attach() is called by operations like changing MTU, etc.,
    an extra wakeup may happen while netvsc_attach() calling
    rndis_filter_device_add() which sends rndis messages when queue is
    stopped in netvsc_detach(). The completion message will wake up queue 0.
    
    We can reproduce the issue by changing MTU etc., then the wake_queue
    counter from "ethtool -S" will increase beyond stop_queue counter:
         stop_queue: 0
         wake_queue: 1
    The issue causes queue wake up, and counter increment, no other ill
    effects in current code. So we didn't see any network problem for now.
    
    To fix this, initialize tx_disable to true, and set it to false when
    the NIC is ready to be attached or registered.
    
    Fixes: 7b2ee50c0cd5 ("hv_netvsc: common detach logic")
    Signed-off-by: Haiyang Zhang <haiyangz@microsoft.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cf4e9d0934e18f6f2dcc1943f7c46791b759aaa5
Author: Masahiro Yamada <masahiroy@kernel.org>
Date:   Sun Feb 23 04:04:31 2020 +0900

    kbuild: fix DT binding schema rule to detect command line changes
    
    commit 7a04960560640ac5b0b89461f7757322b57d0c7a upstream.
    
    This if_change_rule is not working properly; it cannot detect any
    command line change.
    
    The reason is because cmd-check in scripts/Kbuild.include compares
    $(cmd_$@) and $(cmd_$1), but cmd_dtc_dt_yaml does not exist here.
    
    For if_change_rule to work properly, the stem part of cmd_* and rule_*
    must match. Because this cmd_and_fixdep invokes cmd_dtc, this rule must
    be named rule_dtc.
    
    Fixes: 4f0e3a57d6eb ("kbuild: Add support for DT binding schema checks")
    Signed-off-by: Masahiro Yamada <masahiroy@kernel.org>
    Acked-by: Rob Herring <robh@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ae118f61b62aa8abd40abce6b8e3127349c97fcd
Author: Andrei Otcheretianski <andrei.otcheretianski@intel.com>
Date:   Fri Feb 21 10:47:20 2020 +0100

    mac80211: Remove a redundant mutex unlock
    
    commit 0daa63ed4c6c4302790ce67b7a90c0997ceb7514 upstream.
    
    The below-mentioned commit changed the code to unlock *inside*
    the function, but previously the unlock was *outside*. It failed
    to remove the outer unlock, however, leading to double unlock.
    
    Fix this.
    
    Fixes: 33483a6b88e4 ("mac80211: fix missing unlock on error in ieee80211_mark_sta_auth()")
    Signed-off-by: Andrei Otcheretianski <andrei.otcheretianski@intel.com>
    Link: https://lore.kernel.org/r/20200221104719.cce4741cf6eb.I671567b185c8a4c2409377e483fd149ce590f56d@changeid
    [rewrite commit message to better explain what happened]
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 733d5016f151b24ca6980f6b566a83f5079fee0b
Author: Johannes Berg <johannes.berg@intel.com>
Date:   Fri Feb 21 10:41:43 2020 +0100

    nl80211: fix potential leak in AP start
    
    commit 9951ebfcdf2b97dbb28a5d930458424341e61aa2 upstream.
    
    If nl80211_parse_he_obss_pd() fails, we leak the previously
    allocated ACL memory. Free it in this case.
    
    Fixes: 796e90f42b7e ("cfg80211: add support for parsing OBBS_PD attributes")
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Link: https://lore.kernel.org/r/20200221104142.835aba4cdd14.I1923b55ba9989c57e13978f91f40bfdc45e60cbd@changeid
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e7dbaa340cc3868d9b9490f44b4db30d54c62077
Author: Tina Zhang <tina.zhang@intel.com>
Date:   Fri Feb 21 10:32:34 2020 +0800

    drm/i915/gvt: Separate display reset from ALL_ENGINES reset
    
    commit 3eb55e6f753a379e293395de8d5f3be28351a7f8 upstream.
    
    ALL_ENGINES reset doesn't clobber display with the current gvt-g
    supported platforms. Thus ALL_ENGINES reset shouldn't reset the
    display engine registers emulated by gvt-g.
    
    This fixes guest warning like
    
    [ 14.622026] [drm] Initialized i915 1.6.0 20200114 for 0000:00:03.0 on minor 0
    [ 14.967917] fbcon: i915drmfb (fb0) is primary device
    [ 25.100188] [drm:drm_atomic_helper_wait_for_dependencies [drm_kms_helper]] E RROR [CRTC:51:pipe A] flip_done timed out
    [ 25.100860] -----------[ cut here ]-----------
    [ 25.100861] pll on state mismatch (expected 0, found 1)
    [ 25.101024] WARNING: CPU: 1 PID: 30 at drivers/gpu/drm/i915/display/intel_dis play.c:14382 verify_single_dpll_state.isra.115+0x28f/0x320 [i915]
    [ 25.101025] Modules linked in: intel_rapl_msr intel_rapl_common kvm_intel kvm irqbypass crct10dif_pclmul crc32_pclmul ghash_clmulni_intel i915 aesni_intel cr ypto_simd cryptd glue_helper cec rc_core video drm_kms_helper joydev drm input_l eds i2c_algo_bit serio_raw fb_sys_fops syscopyarea sysfillrect sysimgblt mac_hid qemu_fw_cfg sch_fq_codel parport_pc ppdev lp parport ip_tables x_tables autofs4 e1000 psmouse i2c_piix4 pata_acpi floppy
    [ 25.101052] CPU: 1 PID: 30 Comm: kworker/u4:1 Not tainted 5.5.0+ #1
    [ 25.101053] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1 .12.1-0-ga5cab58 04/01/2014
    [ 25.101055] Workqueue: events_unbound async_run_entry_fn
    [ 25.101092] RIP: 0010:verify_single_dpll_state.isra.115+0x28f/0x320 [i915]
    [ 25.101093] Code: e0 d9 ff e9 a3 fe ff ff 80 3d e9 c2 11 00 00 44 89 f6 48 c7 c7 c0 9d 88 c0 75 3b e8 eb df d9 ff e9 c7 fe ff ff e8 d1 e0 ae c4 <0f> 0b e9 7a fe ff ff 80 3d c0 c2 11 00 00 8d 71 41 89 c2 48 c7 c7
    [ 25.101093] RSP: 0018:ffffb1de80107878 EFLAGS: 00010286
    [ 25.101094] RAX: 0000000000000000 RBX: ffffb1de80107884 RCX: 0000000000000007
    [ 25.101095] RDX: 0000000000000000 RSI: 0000000000000002 RDI: ffff94fdfdd19740
    [ 25.101095] RBP: ffffb1de80107938 R08: 0000000d6bfdc7b4 R09: 000000000000002b
    [ 25.101096] R10: ffff94fdf82dc000 R11: 0000000000000225 R12: 00000000000001f8
    [ 25.101096] R13: ffff94fdb3ca6a90 R14: ffff94fdb3ca0000 R15: 0000000000000000
    [ 25.101097] FS: 0000000000000000(0000) GS:ffff94fdfdd00000(0000) knlGS:00000 00000000000
    [ 25.101098] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
    [ 25.101098] CR2: 00007fbc3e2be9c8 CR3: 000000003339a003 CR4: 0000000000360ee0
    [ 25.101101] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
    [ 25.101101] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
    [ 25.101102] Call Trace:
    [ 25.101139] intel_atomic_commit_tail+0xde4/0x1520 [i915]
    [ 25.101141] ? flush_workqueue_prep_pwqs+0xfa/0x130
    [ 25.101142] ? flush_workqueue+0x198/0x3c0
    [ 25.101174] intel_atomic_commit+0x2ad/0x320 [i915]
    [ 25.101209] drm_atomic_commit+0x4a/0x50 [drm]
    [ 25.101220] drm_client_modeset_commit_atomic+0x1c4/0x200 [drm]
    [ 25.101231] drm_client_modeset_commit_force+0x47/0x170 [drm]
    [ 25.101250] drm_fb_helper_restore_fbdev_mode_unlocked+0x4e/0xa0 [drm_kms_hel per]
    [ 25.101255] drm_fb_helper_set_par+0x2d/0x60 [drm_kms_helper]
    [ 25.101287] intel_fbdev_set_par+0x1a/0x40 [i915]
    [ 25.101289] ? con_is_visible+0x2e/0x60
    [ 25.101290] fbcon_init+0x378/0x600
    [ 25.101292] visual_init+0xd5/0x130
    [ 25.101296] do_bind_con_driver+0x217/0x430
    [ 25.101297] do_take_over_console+0x7d/0x1b0
    [ 25.101298] do_fbcon_takeover+0x5c/0xb0
    [ 25.101299] fbcon_fb_registered+0x199/0x1a0
    [ 25.101301] register_framebuffer+0x22c/0x330
    [ 25.101306] __drm_fb_helper_initial_config_and_unlock+0x31a/0x520 [drm_kms_h elper]
    [ 25.101311] drm_fb_helper_initial_config+0x35/0x40 [drm_kms_helper]
    [ 25.101341] intel_fbdev_initial_config+0x18/0x30 [i915]
    [ 25.101342] async_run_entry_fn+0x3c/0x150
    [ 25.101343] process_one_work+0x1fd/0x3f0
    [ 25.101344] worker_thread+0x34/0x410
    [ 25.101346] kthread+0x121/0x140
    [ 25.101346] ? process_one_work+0x3f0/0x3f0
    [ 25.101347] ? kthread_park+0x90/0x90
    [ 25.101350] ret_from_fork+0x35/0x40
    [ 25.101351] --[ end trace b5b47d44cd998ba1 ]--
    
    Fixes: 6294b61ba769 ("drm/i915/gvt: add missing display part reset for vGPU reset")
    Signed-off-by: Tina Zhang <tina.zhang@intel.com>
    Reviewed-by: Zhenyu Wang <zhenyuw@linux.intel.com>
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>
    Link: http://patchwork.freedesktop.org/patch/msgid/20200221023234.28635-1-tina.zhang@intel.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 01c4cfc9a5c660794a14de9ae851ea1d2ac0c44c
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Fri Feb 21 22:18:18 2020 +0000

    drm/i915: Avoid recursing onto active vma from the shrinker
    
    commit 238734262142075056653b4de091458e0ca858f2 upstream.
    
    We mark the vma as active while binding it in order to protect outselves
    from being shrunk under mempressure. This only works if we are strict in
    not attempting to shrink active objects.
    
    <6> [472.618968] Workqueue: events_unbound fence_work [i915]
    <4> [472.618970] Call Trace:
    <4> [472.618974]  ? __schedule+0x2e5/0x810
    <4> [472.618978]  schedule+0x37/0xe0
    <4> [472.618982]  schedule_preempt_disabled+0xf/0x20
    <4> [472.618984]  __mutex_lock+0x281/0x9c0
    <4> [472.618987]  ? mark_held_locks+0x49/0x70
    <4> [472.618989]  ? _raw_spin_unlock_irqrestore+0x47/0x60
    <4> [472.619038]  ? i915_vma_unbind+0xae/0x110 [i915]
    <4> [472.619084]  ? i915_vma_unbind+0xae/0x110 [i915]
    <4> [472.619122]  i915_vma_unbind+0xae/0x110 [i915]
    <4> [472.619165]  i915_gem_object_unbind+0x1dc/0x400 [i915]
    <4> [472.619208]  i915_gem_shrink+0x328/0x660 [i915]
    <4> [472.619250]  ? i915_gem_shrink_all+0x38/0x60 [i915]
    <4> [472.619282]  i915_gem_shrink_all+0x38/0x60 [i915]
    <4> [472.619325]  vm_alloc_page.constprop.25+0x1aa/0x240 [i915]
    <4> [472.619330]  ? rcu_read_lock_sched_held+0x4d/0x80
    <4> [472.619363]  ? __alloc_pd+0xb/0x30 [i915]
    <4> [472.619366]  ? module_assert_mutex_or_preempt+0xf/0x30
    <4> [472.619368]  ? __module_address+0x23/0xe0
    <4> [472.619371]  ? is_module_address+0x26/0x40
    <4> [472.619374]  ? static_obj+0x34/0x50
    <4> [472.619376]  ? lockdep_init_map+0x4d/0x1e0
    <4> [472.619407]  setup_page_dma+0xd/0x90 [i915]
    <4> [472.619437]  alloc_pd+0x29/0x50 [i915]
    <4> [472.619470]  __gen8_ppgtt_alloc+0x443/0x6b0 [i915]
    <4> [472.619503]  gen8_ppgtt_alloc+0xd7/0x300 [i915]
    <4> [472.619535]  ppgtt_bind_vma+0x2a/0xe0 [i915]
    <4> [472.619577]  __vma_bind+0x26/0x40 [i915]
    <4> [472.619611]  fence_work+0x1c/0x90 [i915]
    <4> [472.619617]  process_one_work+0x26a/0x620
    
    Fixes: 2850748ef876 ("drm/i915: Pull i915_vma_pin under the vm->mutex")
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Cc: Tvrtko Ursulin <tvrtko.ursulin@intel.com>
    Reviewed-by: Tvrtko Ursulin <tvrtko.ursulin@intel.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20200221221818.2861432-1-chris@chris-wilson.co.uk
    (cherry picked from commit 6f24e41022f28061368776ea1514db0a6e67a9b1)
    Signed-off-by: Jani Nikula <jani.nikula@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 78415deaea0534a2171b7b4b02e15288aa1ebeb0
Author: Tina Zhang <tina.zhang@intel.com>
Date:   Tue Feb 25 13:35:27 2020 +0800

    drm/i915/gvt: Fix orphan vgpu dmabuf_objs' lifetime
    
    commit b549c252b1292aea959cd9b83537fcb9384a6112 upstream.
    
    Deleting dmabuf item's list head after releasing its container can lead
    to KASAN-reported issue:
    
      BUG: KASAN: use-after-free in __list_del_entry_valid+0x15/0xf0
      Read of size 8 at addr ffff88818a4598a8 by task kworker/u8:3/13119
    
    So fix this issue by puting deleting dmabuf_objs ahead of releasing its
    container.
    
    Fixes: dfb6ae4e14bd6 ("drm/i915/gvt: Handle orphan dmabuf_objs")
    Signed-off-by: Tina Zhang <tina.zhang@intel.com>
    Reviewed-by: Zhenyu Wang <zhenyuw@linux.intel.com>
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>
    Link: http://patchwork.freedesktop.org/patch/msgid/20200225053527.8336-2-tina.zhang@intel.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5b9c534e6d3d3f66dad5f5db68326b28127f490d
Author: Mark Tomlinson <mark.tomlinson@alliedtelesis.co.nz>
Date:   Wed Feb 12 10:24:55 2020 +1300

    MIPS: cavium_octeon: Fix syncw generation.
    
    commit 97e914b7de3c943011779b979b8093fdc0d85722 upstream.
    
    The Cavium Octeon CPU uses a special sync instruction for implementing
    wmb, and due to a CPU bug, the instruction must appear twice. A macro
    had been defined to hide this:
    
     #define __SYNC_rpt(type)     (1 + (type == __SYNC_wmb))
    
    which was intended to evaluate to 2 for __SYNC_wmb, and 1 for any other
    type of sync. However, this expression is evaluated by the assembler,
    and not the compiler, and the result of '==' in the assembler is 0 or
    -1, not 0 or 1 as it is in C. The net result was wmb() producing no code
    at all. The simple fix in this patch is to change the '+' to '-'.
    
    Fixes: bf92927251b3 ("MIPS: barrier: Add __SYNC() infrastructure")
    Signed-off-by: Mark Tomlinson <mark.tomlinson@alliedtelesis.co.nz>
    Tested-by: Chris Packham <chris.packham@alliedtelesis.co.nz>
    Signed-off-by: Paul Burton <paulburton@kernel.org>
    Cc: linux-mips@vger.kernel.org
    Cc: linux-kernel@vger.kernel.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e85590f42106cc08cc53a33cad59f36501b2bb93
Author: Wolfram Sang <wsa@the-dreams.de>
Date:   Wed Feb 12 10:35:30 2020 +0100

    i2c: jz4780: silence log flood on txabrt
    
    commit 9e661cedcc0a072d91a32cb88e0515ea26e35711 upstream.
    
    The printout for txabrt is way too talkative and is highly annoying with
    scanning programs like 'i2cdetect'. Reduce it to the minimum, the rest
    can be gained by I2C core debugging and datasheet information. Also,
    make it a debug printout, it won't help the regular user.
    
    Fixes: ba92222ed63a ("i2c: jz4780: Add i2c bus controller driver for Ingenic JZ4780")
    Reported-by: H. Nikolaus Schaller <hns@goldelico.com>
    Tested-by: H. Nikolaus Schaller <hns@goldelico.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9a50d69d0f78339882e73a2f4f54e91b81f71cd7
Author: Gustavo A. R. Silva <gustavo@embeddedor.com>
Date:   Tue Feb 11 08:47:04 2020 -0600

    i2c: altera: Fix potential integer overflow
    
    commit 54498e8070e19e74498a72c7331348143e7e1f8c upstream.
    
    Factor out 100 from the equation and do 32-bit arithmetic (3 * clk_mhz / 10)
    instead of 64-bit.
    
    Notice that clk_mhz is MHz, so the multiplication will never wrap 32 bits
    and there is no need for div_u64().
    
    Addresses-Coverity: 1458369 ("Unintentional integer overflow")
    Fixes: 0560ad576268 ("i2c: altera: Add Altera I2C Controller driver")
    Suggested-by: David Laight <David.Laight@ACULAB.COM>
    Signed-off-by: Gustavo A. R. Silva <gustavo@embeddedor.com>
    Reviewed-by: Thor Thayer <thor.thayer@linux.intel.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7700ea8e6f68dbc44161758f2ad3b64ece920cf0
Author: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
Date:   Sun Feb 2 21:19:22 2020 +0100

    MIPS: VPE: Fix a double free and a memory leak in 'release_vpe()'
    
    commit bef8e2dfceed6daeb6ca3e8d33f9c9d43b926580 upstream.
    
    Pointer on the memory allocated by 'alloc_progmem()' is stored in
    'v->load_addr'. So this is this memory that should be freed by
    'release_progmem()'.
    
    'release_progmem()' is only a call to 'kfree()'.
    
    With the current code, there is both a double free and a memory leak.
    Fix it by passing the correct pointer to 'release_progmem()'.
    
    Fixes: e01402b115ccc ("More AP / SP bits for the 34K, the Malta bits and things. Still wants")
    Signed-off-by: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
    Signed-off-by: Paul Burton <paulburton@kernel.org>
    Cc: ralf@linux-mips.org
    Cc: linux-mips@vger.kernel.org
    Cc: linux-kernel@vger.kernel.org
    Cc: kernel-janitors@vger.kernel.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b41d6924d34d6003e9e2f040f6f80c3ee0e1b155
Author: Anup Patel <anup.patel@wdc.com>
Date:   Sun Feb 2 16:32:02 2020 +0530

    RISC-V: Don't enable all interrupts in trap_init()
    
    commit 6a1ce99dc4bde564e4a072936f9d41f4a439140e upstream.
    
    Historically, we have been enabling all interrupts for each
    HART in trap_init(). Ideally, we should only enable M-mode
    interrupts for M-mode kernel and S-mode interrupts for S-mode
    kernel in trap_init().
    
    Currently, we get suprious S-mode interrupts on Kendryte K210
    board running M-mode NO-MMU kernel because we are enabling all
    interrupts in trap_init(). To fix this, we only enable software
    and external interrupt in trap_init(). In future, trap_init()
    will only enable software interrupt and PLIC driver will enable
    external interrupt using CPU notifiers.
    
    Fixes: a4c3733d32a7 ("riscv: abstract out CSR names for supervisor vs machine mode")
    Signed-off-by: Anup Patel <anup.patel@wdc.com>
    Reviewed-by: Atish Patra <atish.patra@wdc.com>
    Tested-by: Palmer Dabbelt <palmerdabbelt@google.com> [QMEU virt machine with SMP]
    [Palmer: Move the Fixes up to a newer commit]
    Reviewed-by: Palmer Dabbelt <palmerdabbelt@google.com>
    Signed-off-by: Palmer Dabbelt <palmerdabbelt@google.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dc374cec2383c3a462ac0f6c95cea4007795e94f
Author: dan.carpenter@oracle.com <dan.carpenter@oracle.com>
Date:   Wed Jan 15 20:46:28 2020 +0300

    HID: hiddev: Fix race in in hiddev_disconnect()
    
    commit 5c02c447eaeda29d3da121a2e17b97ccaf579b51 upstream.
    
    Syzbot reports that "hiddev" is used after it's free in hiddev_disconnect().
    The hiddev_disconnect() function sets "hiddev->exist = 0;" so
    hiddev_release() can free it as soon as we drop the "existancelock"
    lock.  This patch moves the mutex_unlock(&hiddev->existancelock) until
    after we have finished using it.
    
    Reported-by: syzbot+784ccb935f9900cc7c9e@syzkaller.appspotmail.com
    Fixes: 7f77897ef2b6 ("HID: hiddev: fix potential use-after-free")
    Suggested-by: Alan Stern <stern@rowland.harvard.edu>
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit eb0cb1ade4b6fc9b78cdc1c48256f5c2c8e23872
Author: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
Date:   Wed Dec 4 04:35:25 2019 +0100

    HID: alps: Fix an error handling path in 'alps_input_configured()'
    
    commit 8d2e77b39b8fecb794e19cd006a12f90b14dd077 upstream.
    
    They are issues:
       - if 'input_allocate_device()' fails and return NULL, there is no need
         to free anything and 'input_free_device()' call is a no-op. It can
         be axed.
       - 'ret' is known to be 0 at this point, so we must set it to a
         meaningful value before returning
    
    Fixes: 2562756dde55 ("HID: add Alps I2C HID Touchpad-Stick support")
    Signed-off-by: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c3114a5a6d880aa93b7e0e1123d9c9381a8de2e7
Author: Cong Wang <xiyou.wangcong@gmail.com>
Date:   Sun Feb 2 20:30:52 2020 -0800

    netfilter: xt_hashlimit: reduce hashlimit_mutex scope for htable_put()
    
    commit c4a3922d2d20c710f827d3a115ee338e8d0467df upstream.
    
    It is unnecessary to hold hashlimit_mutex for htable_destroy()
    as it is already removed from the global hashtable and its
    refcount is already zero.
    
    Also, switch hinfo->use to refcount_t so that we don't have
    to hold the mutex until it reaches zero in htable_put().
    
    Reported-and-tested-by: syzbot+adf6c6c2be1c3a718121@syzkaller.appspotmail.com
    Acked-by: Florian Westphal <fw@strlen.de>
    Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d2997d64dfa65082236bca1efd596b6c935daf5e
Author: Jozsef Kadlecsik <kadlec@netfilter.org>
Date:   Sat Feb 22 12:01:43 2020 +0100

    netfilter: ipset: Fix forceadd evaluation path
    
    commit 8af1c6fbd9239877998c7f5a591cb2c88d41fb66 upstream.
    
    When the forceadd option is enabled, the hash:* types should find and replace
    the first entry in the bucket with the new one if there are no reuseable
    (deleted or timed out) entries. However, the position index was just not set
    to zero and remained the invalid -1 if there were no reuseable entries.
    
    Reported-by: syzbot+6a86565c74ebe30aea18@syzkaller.appspotmail.com
    Fixes: 23c42a403a9c ("netfilter: ipset: Introduction of new commands and protocol version 7")
    Signed-off-by: Jozsef Kadlecsik <kadlec@netfilter.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 54cd3ad4d9ccad89b986248a670eab359ef9b8dd
Author: Eugenio Pérez <eperezma@redhat.com>
Date:   Fri Feb 21 12:06:56 2020 +0100

    vhost: Check docket sk_family instead of call getname
    
    commit 42d84c8490f9f0931786f1623191fcab397c3d64 upstream.
    
    Doing so, we save one call to get data we already have in the struct.
    
    Also, since there is no guarantee that getname use sockaddr_ll
    parameter beyond its size, we add a little bit of security here.
    It should do not do beyond MAX_ADDR_LEN, but syzbot found that
    ax25_getname writes more (72 bytes, the size of full_sockaddr_ax25,
    versus 20 + 32 bytes of sockaddr_ll + MAX_ADDR_LEN in syzbot repro).
    
    Fixes: 3a4d5c94e9593 ("vhost_net: a kernel-level virtio server")
    Reported-by: syzbot+f2a62d07a5198c819c7b@syzkaller.appspotmail.com
    Signed-off-by: Eugenio Pérez <eperezma@redhat.com>
    Acked-by: Michael S. Tsirkin <mst@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 48b8949438afbf0779521f4f0df683d14a918525
Author: Ursula Braun <ubraun@linux.ibm.com>
Date:   Fri Feb 14 08:58:59 2020 +0100

    net/smc: transfer fasync_list in case of fallback
    
    commit 67f562e3e147750a02b2a91d21a163fc44a1d13e upstream.
    
    SMC does not work together with FASTOPEN. If sendmsg() is called with
    flag MSG_FASTOPEN in SMC_INIT state, the SMC-socket switches to
    fallback mode. To handle the previous ioctl FIOASYNC call correctly
    in this case, it is necessary to transfer the socket wait queue
    fasync_list to the internal TCP socket.
    
    Reported-by: syzbot+4b1fe8105f8044a26162@syzkaller.appspotmail.com
    Fixes: ee9dfbef02d18 ("net/smc: handle sockopts forcing fallback")
    Signed-off-by: Ursula Braun <ubraun@linux.ibm.com>
    Signed-off-by: Karsten Graul <kgraul@linux.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a469bab3386aebff33c59506f3a95e35b91118fd
Author: Jozsef Kadlecsik <kadlec@netfilter.org>
Date:   Tue Feb 11 23:20:43 2020 +0100

    netfilter: ipset: Fix "INFO: rcu detected stall in hash_xxx" reports
    
    commit f66ee0410b1c3481ee75e5db9b34547b4d582465 upstream.
    
    In the case of huge hash:* types of sets, due to the single spinlock of
    a set the processing of the whole set under spinlock protection could take
    too long.
    
    There were four places where the whole hash table of the set was processed
    from bucket to bucket under holding the spinlock:
    
    - During resizing a set, the original set was locked to exclude kernel side
      add/del element operations (userspace add/del is excluded by the
      nfnetlink mutex). The original set is actually just read during the
      resize, so the spinlocking is replaced with rcu locking of regions.
      However, thus there can be parallel kernel side add/del of entries.
      In order not to loose those operations a backlog is added and replayed
      after the successful resize.
    - Garbage collection of timed out entries was also protected by the spinlock.
      In order not to lock too long, region locking is introduced and a single
      region is processed in one gc go. Also, the simple timer based gc running
      is replaced with a workqueue based solution. The internal book-keeping
      (number of elements, size of extensions) is moved to region level due to
      the region locking.
    - Adding elements: when the max number of the elements is reached, the gc
      was called to evict the timed out entries. The new approach is that the gc
      is called just for the matching region, assuming that if the region
      (proportionally) seems to be full, then the whole set does. We could scan
      the other regions to check every entry under rcu locking, but for huge
      sets it'd mean a slowdown at adding elements.
    - Listing the set header data: when the set was defined with timeout
      support, the garbage collector was called to clean up timed out entries
      to get the correct element numbers and set size values. Now the set is
      scanned to check non-timed out entries, without actually calling the gc
      for the whole set.
    
    Thanks to Florian Westphal for helping me to solve the SOFTIRQ-safe ->
    SOFTIRQ-unsafe lock order issues during working on the patch.
    
    Reported-by: syzbot+4b0e9d4ff3cf117837e5@syzkaller.appspotmail.com
    Reported-by: syzbot+c27b8d5010f45c666ed1@syzkaller.appspotmail.com
    Reported-by: syzbot+68a806795ac89df3aa1c@syzkaller.appspotmail.com
    Fixes: 23c42a403a9c ("netfilter: ipset: Introduction of new commands and protocol version 7")
    Signed-off-by: Jozsef Kadlecsik <kadlec@netfilter.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f0c6b2b4efc1578b0bd5e86d04d5c802e6d2100e
Author: Jens Axboe <axboe@kernel.dk>
Date:   Thu Feb 27 14:17:49 2020 -0700

    io_uring: fix 32-bit compatability with sendmsg/recvmsg
    
    commit d876836204897b6d7d911f942084f69a1e9d5c4d upstream.
    
    We must set MSG_CMSG_COMPAT if we're in compatability mode, otherwise
    the iovec import for these commands will not do the right thing and fail
    the command with -EINVAL.
    
    Found by running the test suite compiled as 32-bit.
    
    Cc: stable@vger.kernel.org
    Fixes: aa1fa28fc73e ("io_uring: add support for recvmsg()")
    Fixes: 0fa03c624d8f ("io_uring: add support for sendmsg()")
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 473f1a9496a1871ab855be5f959684f1dea86bb0
Author: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Date:   Wed Feb 26 22:39:27 2020 +0100

    cpufreq: Fix policy initialization for internal governor drivers
    
    commit f5739cb0b56590d68d8df8a44659893b6d0084c3 upstream.
    
    Before commit 1e4f63aecb53 ("cpufreq: Avoid creating excessively
    large stack frames") the initial value of the policy field in struct
    cpufreq_policy set by the driver's ->init() callback was implicitly
    passed from cpufreq_init_policy() to cpufreq_set_policy() if the
    default governor was neither "performance" nor "powersave".  After
    that commit, however, cpufreq_init_policy() must take that case into
    consideration explicitly and handle it as appropriate, so make that
    happen.
    
    Fixes: 1e4f63aecb53 ("cpufreq: Avoid creating excessively large stack frames")
    Link: https://lore.kernel.org/linux-pm/39fb762880c27da110086741315ca8b111d781cd.camel@gmail.com/
    Reported-by: Artem Bityutskiy <dedekind1@gmail.com>
    Cc: 5.4+ <stable@vger.kernel.org> # 5.4+
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2e109ead38a3d63e730b44e9e6ab5498542acc5d
Author: Shirish S <shirish.s@amd.com>
Date:   Mon Jan 27 16:35:24 2020 +0530

    amdgpu/gmc_v9: save/restore sdpif regs during S3
    
    commit a3ed353cf8015ba84a0407a5dc3ffee038166ab0 upstream.
    
    fixes S3 issue with IOMMU + S/G  enabled @ 64M VRAM.
    
    Suggested-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Shirish S <shirish.s@amd.com>
    Reviewed-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6db1c5c69c74c3fb9611eabffeee06dce9436cf7
Author: Orson Zhai <orson.unisoc@gmail.com>
Date:   Fri Feb 21 01:37:04 2020 +0800

    Revert "PM / devfreq: Modify the device name as devfreq(X) for sysfs"
    
    commit 66d0e797bf095d407479c89952d42b1d96ef0a7f upstream.
    
    This reverts commit 4585fbcb5331fc910b7e553ad3efd0dd7b320d14.
    
    The name changing as devfreq(X) breaks some user space applications,
    such as Android HAL from Unisoc and Hikey [1].
    The device name will be changed unexpectly after every boot depending
    on module init sequence. It will make trouble to setup some system
    configuration like selinux for Android.
    
    So we'd like to revert it back to old naming rule before any better
    way being found.
    
    [1] https://lkml.org/lkml/2018/5/8/1042
    
    Cc: John Stultz <john.stultz@linaro.org>
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Cc: stable@vger.kernel.org
    Signed-off-by: Orson Zhai <orson.unisoc@gmail.com>
    Acked-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Chanwoo Choi <cw00.choi@samsung.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0d3552f4c609b98a27ca0f3a9f954f80e435856e
Author: Steven Rostedt (VMware) <rostedt@goodmis.org>
Date:   Thu Feb 20 15:38:01 2020 -0500

    tracing: Disable trace_printk() on post poned tests
    
    commit 78041c0c9e935d9ce4086feeff6c569ed88ddfd4 upstream.
    
    The tracing seftests checks various aspects of the tracing infrastructure,
    and one is filtering. If trace_printk() is active during a self test, it can
    cause the filtering to fail, which will disable that part of the trace.
    
    To keep the selftests from failing because of trace_printk() calls,
    trace_printk() checks the variable tracing_selftest_running, and if set, it
    does not write to the tracing buffer.
    
    As some tracers were registered earlier in boot, the selftest they triggered
    would fail because not all the infrastructure was set up for the full
    selftest. Thus, some of the tests were post poned to when their
    infrastructure was ready (namely file system code). The postpone code did
    not set the tracing_seftest_running variable, and could fail if a
    trace_printk() was added and executed during their run.
    
    Cc: stable@vger.kernel.org
    Fixes: 9afecfbb95198 ("tracing: Postpone tracer start-up tests till the system is more robust")
    Signed-off-by: Steven Rostedt (VMware) <rostedt@goodmis.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ed1832ea0518339d702a2212a0a7fd37f5d169c0
Author: Jan Kara <jack@suse.cz>
Date:   Thu Feb 6 15:28:12 2020 +0100

    blktrace: Protect q->blk_trace with RCU
    
    commit c780e86dd48ef6467a1146cf7d0fe1e05a635039 upstream.
    
    KASAN is reporting that __blk_add_trace() has a use-after-free issue
    when accessing q->blk_trace. Indeed the switching of block tracing (and
    thus eventual freeing of q->blk_trace) is completely unsynchronized with
    the currently running tracing and thus it can happen that the blk_trace
    structure is being freed just while __blk_add_trace() works on it.
    Protect accesses to q->blk_trace by RCU during tracing and make sure we
    wait for the end of RCU grace period when shutting down tracing. Luckily
    that is rare enough event that we can afford that. Note that postponing
    the freeing of blk_trace to an RCU callback should better be avoided as
    it could have unexpected user visible side-effects as debugfs files
    would be still existing for a short while block tracing has been shut
    down.
    
    Link: https://bugzilla.kernel.org/show_bug.cgi?id=205711
    CC: stable@vger.kernel.org
    Reviewed-by: Chaitanya Kulkarni <chaitanya.kulkarni@wdc.com>
    Reviewed-by: Ming Lei <ming.lei@redhat.com>
    Tested-by: Ming Lei <ming.lei@redhat.com>
    Reviewed-by: Bart Van Assche <bvanassche@acm.org>
    Reported-by: Tristan Madani <tristmd@gmail.com>
    Signed-off-by: Jan Kara <jack@suse.cz>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 22a4c63c859af2663bbd51af4f97e6103d1191b8
Author: Wolfram Sang <wsa@the-dreams.de>
Date:   Tue Feb 25 15:12:29 2020 +0100

    macintosh: therm_windtunnel: fix regression when instantiating devices
    
    commit 38b17afb0ebb9ecd41418d3c08bcf9198af4349d upstream.
    
    Removing attach_adapter from this driver caused a regression for at
    least some machines. Those machines had the sensors described in their
    DT, too, so they didn't need manual creation of the sensor devices. The
    old code worked, though, because manual creation came first. Creation of
    DT devices then failed later and caused error logs, but the sensors
    worked nonetheless because of the manually created devices.
    
    When removing attach_adaper, manual creation now comes later and loses
    the race. The sensor devices were already registered via DT, yet with
    another binding, so the driver could not be bound to it.
    
    This fix refactors the code to remove the race and only manually creates
    devices if there are no DT nodes present. Also, the DT binding is updated
    to match both, the DT and manually created devices. Because we don't
    know which device creation will be used at runtime, the code to start
    the kthread is moved to do_probe() which will be called by both methods.
    
    Fixes: 3e7bed52719d ("macintosh: therm_windtunnel: drop using attach_adapter")
    Link: https://bugzilla.kernel.org/show_bug.cgi?id=201723
    Reported-by: Erhard Furtner <erhard_f@mailbox.org>
    Tested-by: Erhard Furtner <erhard_f@mailbox.org>
    Acked-by: Michael Ellerman <mpe@ellerman.id.au> (powerpc)
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Cc: stable@kernel.org # v4.19+
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8794b041a3fa777df117c276c53223f1c09f341c
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Sat Feb 22 18:54:32 2020 +0100

    drm/radeon: Inline drm_get_pci_dev
    
    commit eb12c957735b582607e5842a06d1f4c62e185c1d upstream.
    
    It's the last user, and more importantly, it's the last non-legacy
    user of anything in drm_pci.c.
    
    The only tricky bit is the agp initialization. But a close look shows
    that radeon does not use the drm_agp midlayer (the main use of that is
    drm_bufs for legacy drivers), and instead could use the agp subsystem
    directly (like nouveau does already). Hence we can just pull this in
    too.
    
    A further step would be to entirely drop the use of drm_device->agp,
    but feels like too much churn just for this patch.
    
    Signed-off-by: Daniel Vetter <daniel.vetter@intel.com>
    Cc: Alex Deucher <alexander.deucher@amd.com>
    Cc: "Christian König" <christian.koenig@amd.com>
    Cc: "David (ChunMing) Zhou" <David1.Zhou@amd.com>
    Cc: amd-gfx@lists.freedesktop.org
    Reviewed-by: Alex Deucher <alexander.deucher@amd.com>
    Reviewed-by: Emil Velikov <emil.velikov@collabora.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d7b1f788c73bd81730d36dd628f9b9966c0fa663
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Sat Feb 22 18:54:31 2020 +0100

    drm/amdgpu: Drop DRIVER_USE_AGP
    
    commit 8a3bddf67ce88b96531fb22c5a75d7f4dc41d155 upstream.
    
    This doesn't do anything except auto-init drm_agp support when you
    call drm_get_pci_dev(). Which amdgpu stopped doing with
    
    commit b58c11314a1706bf094c489ef5cb28f76478c704
    Author: Alex Deucher <alexander.deucher@amd.com>
    Date:   Fri Jun 2 17:16:31 2017 -0400
    
        drm/amdgpu: drop deprecated drm_get_pci_dev and drm_put_dev
    
    No idea whether this was intentional or accidental breakage, but I
    guess anyone who manages to boot a this modern gpu behind an agp
    bridge deserves a price. A price I never expect anyone to ever collect
    :-)
    
    Cc: Alex Deucher <alexander.deucher@amd.com>
    Cc: "Christian König" <christian.koenig@amd.com>
    Cc: Hawking Zhang <Hawking.Zhang@amd.com>
    Cc: Xiaojie Yuan <xiaojie.yuan@amd.com>
    Cc: Evan Quan <evan.quan@amd.com>
    Cc: "Tianci.Yin" <tianci.yin@amd.com>
    Cc: "Marek Olšák" <marek.olsak@amd.com>
    Cc: Hans de Goede <hdegoede@redhat.com>
    Reviewed-by: Emil Velikov <emil.velikov@collabora.com>
    Reviewed-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Daniel Vetter <daniel.vetter@intel.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 84087542d6664ffc06c2561e9adb9768c0fbc5b7
Author: Johan Korsnes <jkorsnes@cisco.com>
Date:   Fri Jan 17 13:08:36 2020 +0100

    HID: core: increase HID report buffer size to 8KiB
    
    commit 84a4062632462c4320704fcdf8e99e89e94c0aba upstream.
    
    We have a HID touch device that reports its opens and shorts test
    results in HID buffers of size 8184 bytes. The maximum size of the HID
    buffer is currently set to 4096 bytes, causing probe of this device to
    fail. With this patch we increase the maximum size of the HID buffer to
    8192 bytes, making device probe and acquisition of said buffers succeed.
    
    Signed-off-by: Johan Korsnes <jkorsnes@cisco.com>
    Cc: Alan Stern <stern@rowland.harvard.edu>
    Cc: Armando Visconti <armando.visconti@st.com>
    Cc: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dcf901c35bd78924259c9820f71d2bbeb75a6c0c
Author: Johan Korsnes <jkorsnes@cisco.com>
Date:   Fri Jan 17 13:08:35 2020 +0100

    HID: core: fix off-by-one memset in hid_report_raw_event()
    
    commit 5ebdffd25098898aff1249ae2f7dbfddd76d8f8f upstream.
    
    In case a report is greater than HID_MAX_BUFFER_SIZE, it is truncated,
    but the report-number byte is not correctly handled. This results in a
    off-by-one in the following memset, causing a kernel Oops and ensuing
    system crash.
    
    Note: With commit 8ec321e96e05 ("HID: Fix slab-out-of-bounds read in
    hid_field_extract") I no longer hit the kernel Oops as we instead fail
    "controlled" at probe if there is a report too long in the HID
    report-descriptor. hid_report_raw_event() is an exported symbol, so
    presumabely we cannot always rely on this being the case.
    
    Fixes: 966922f26c7f ("HID: fix a crash in hid_report_raw_event()
                         function.")
    Signed-off-by: Johan Korsnes <jkorsnes@cisco.com>
    Cc: Armando Visconti <armando.visconti@st.com>
    Cc: Jiri Kosina <jkosina@suse.cz>
    Cc: Alan Stern <stern@rowland.harvard.edu>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e4c0a821d398f783da921d492b1a34be579ad577
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Sat Feb 1 12:56:48 2020 +0100

    HID: ite: Only bind to keyboard USB interface on Acer SW5-012 keyboard dock
    
    commit beae56192a2570578ae45050e73c5ff9254f63e6 upstream.
    
    Commit 8f18eca9ebc5 ("HID: ite: Add USB id match for Acer SW5-012 keyboard
    dock") added the USB id for the Acer SW5-012's keyboard dock to the
    hid-ite driver to fix the rfkill driver not working.
    
    Most keyboard docks with an ITE 8595 keyboard/touchpad controller have the
    "Wireless Radio Control" bits which need the special hid-ite driver on the
    second USB interface (the mouse interface) and their touchpad only supports
    mouse emulation, so using generic hid-input handling for anything but
    the "Wireless Radio Control" bits is fine. On these devices we simply bind
    to all USB interfaces.
    
    But unlike other ITE8595 using keyboard docks, the Acer Aspire Switch 10
    (SW5-012)'s touchpad not only does mouse emulation it also supports
    HID-multitouch and all the keys including the "Wireless Radio Control"
    bits have been moved to the first USB interface (the keyboard intf).
    
    So we need hid-ite to handle the first (keyboard) USB interface and have
    it NOT bind to the second (mouse) USB interface so that that can be
    handled by hid-multitouch.c and we get proper multi-touch support.
    
    This commit changes the hid_device_id for the SW5-012 keyboard dock to
    only match on hid devices from the HID_GROUP_GENERIC group, this way
    hid-ite will not bind the the mouse/multi-touch interface which has
    HID_GROUP_MULTITOUCH_WIN_8 as group.
    This fixes the regression to mouse-emulation mode introduced by adding
    the keyboard dock USB id.
    
    Cc: stable@vger.kernel.org
    Fixes: 8f18eca9ebc5 ("HID: ite: Add USB id match for Acer SW5-012 keyboard dock")
    Reported-by: Zdeněk Rampas <zdenda.rampas@gmail.com>
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9f202aadf75fd53c292b9c339abb8a4802783cb5
Author: Oliver Upton <oupton@google.com>
Date:   Sat Feb 29 11:30:14 2020 -0800

    KVM: VMX: check descriptor table exits on instruction emulation
    
    commit 86f7e90ce840aa1db407d3ea6e9b3a52b2ce923c upstream.
    
    KVM emulates UMIP on hardware that doesn't support it by setting the
    'descriptor table exiting' VM-execution control and performing
    instruction emulation. When running nested, this emulation is broken as
    KVM refuses to emulate L2 instructions by default.
    
    Correct this regression by allowing the emulation of descriptor table
    instructions if L1 hasn't requested 'descriptor table exiting'.
    
    Fixes: 07721feee46b ("KVM: nVMX: Don't emulate instructions in guest mode")
    Reported-by: Jan Kiszka <jan.kiszka@web.de>
    Cc: stable@vger.kernel.org
    Cc: Paolo Bonzini <pbonzini@redhat.com>
    Cc: Jim Mattson <jmattson@google.com>
    Signed-off-by: Oliver Upton <oupton@google.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 316b7a3d0d79fc9c993db4cbd0520157d13a21a9
Author: Mika Westerberg <mika.westerberg@linux.intel.com>
Date:   Wed Feb 12 17:59:40 2020 +0300

    ACPI: watchdog: Fix gas->access_width usage
    
    commit 2ba33a4e9e22ac4dda928d3e9b5978a3a2ded4e0 upstream.
    
    ACPI Generic Address Structure (GAS) access_width field is not in bytes
    as the driver seems to expect in few places so fix this by using the
    newly introduced macro ACPI_ACCESS_BYTE_WIDTH().
    
    Fixes: b1abf6fc4982 ("ACPI / watchdog: Fix off-by-one error at resource assignment")
    Fixes: 058dfc767008 ("ACPI / watchdog: Add support for WDAT hardware watchdog")
    Reported-by: Jean Delvare <jdelvare@suse.de>
    Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
    Reviewed-by: Jean Delvare <jdelvare@suse.de>
    Cc: 4.16+ <stable@vger.kernel.org> # 4.16+
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a3e4a7228a08768d1ac43f95d0bbd7575fd390e4
Author: Mika Westerberg <mika.westerberg@linux.intel.com>
Date:   Wed Feb 12 17:59:39 2020 +0300

    ACPICA: Introduce ACPI_ACCESS_BYTE_WIDTH() macro
    
    commit 1dade3a7048ccfc675650cd2cf13d578b095e5fb upstream.
    
    Sometimes it is useful to find the access_width field value in bytes and
    not in bits so add a helper that can be used for this purpose.
    
    Suggested-by: Jean Delvare <jdelvare@suse.de>
    Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
    Reviewed-by: Jean Delvare <jdelvare@suse.de>
    Cc: 4.16+ <stable@vger.kernel.org> # 4.16+
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ec2a01db62df18a4624e2ea6f4b849d2161f8378
Author: Paul Moore <paul@paul-moore.com>
Date:   Mon Feb 24 16:38:57 2020 -0500

    audit: always check the netlink payload length in audit_receive_msg()
    
    commit 756125289285f6e55a03861bf4b6257aa3d19a93 upstream.
    
    This patch ensures that we always check the netlink payload length
    in audit_receive_msg() before we take any action on the payload
    itself.
    
    Cc: stable@vger.kernel.org
    Reported-by: syzbot+399c44bf1f43b8747403@syzkaller.appspotmail.com
    Reported-by: syzbot+e4b12d8d202701f08b6d@syzkaller.appspotmail.com
    Signed-off-by: Paul Moore <paul@paul-moore.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4f3daed0c7ffee4756da2d8c6fb0d5027d97ec87
Author: Paul Moore <paul@paul-moore.com>
Date:   Sat Feb 22 20:36:47 2020 -0500

    audit: fix error handling in audit_data_to_entry()
    
    commit 2ad3e17ebf94b7b7f3f64c050ff168f9915345eb upstream.
    
    Commit 219ca39427bf ("audit: use union for audit_field values since
    they are mutually exclusive") combined a number of separate fields in
    the audit_field struct into a single union.  Generally this worked
    just fine because they are generally mutually exclusive.
    Unfortunately in audit_data_to_entry() the overlap can be a problem
    when a specific error case is triggered that causes the error path
    code to attempt to cleanup an audit_field struct and the cleanup
    involves attempting to free a stored LSM string (the lsm_str field).
    Currently the code always has a non-NULL value in the
    audit_field.lsm_str field as the top of the for-loop transfers a
    value into audit_field.val (both .lsm_str and .val are part of the
    same union); if audit_data_to_entry() fails and the audit_field
    struct is specified to contain a LSM string, but the
    audit_field.lsm_str has not yet been properly set, the error handling
    code will attempt to free the bogus audit_field.lsm_str value that
    was set with audit_field.val at the top of the for-loop.
    
    This patch corrects this by ensuring that the audit_field.val is only
    set when needed (it is cleared when the audit_field struct is
    allocated with kcalloc()).  It also corrects a few other issues to
    ensure that in case of error the proper error code is returned.
    
    Cc: stable@vger.kernel.org
    Fixes: 219ca39427bf ("audit: use union for audit_field values since they are mutually exclusive")
    Reported-by: syzbot+1f4d90ead370d72e450b@syzkaller.appspotmail.com
    Signed-off-by: Paul Moore <paul@paul-moore.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5e491ab8aa8649f0380d0b7c0cbb7b672486e691
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Fri Feb 28 12:22:56 2020 +0300

    ext4: potential crash on allocation error in ext4_alloc_flex_bg_array()
    
    commit 37b0b6b8b99c0e1c1f11abbe7cf49b6d03795b3f upstream.
    
    If sbi->s_flex_groups_allocated is zero and the first allocation fails
    then this code will crash.  The problem is that "i--" will set "i" to
    -1 but when we compare "i >= sbi->s_flex_groups_allocated" then the -1
    is type promoted to unsigned and becomes UINT_MAX.  Since UINT_MAX
    is more than zero, the condition is true so we call kvfree(new_groups[-1]).
    The loop will carry on freeing invalid memory until it crashes.
    
    Fixes: 7c990728b99e ("ext4: fix potential race between s_flex_groups online resizing and access")
    Reviewed-by: Suraj Jitindar Singh <surajjs@amazon.com>
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Cc: stable@kernel.org
    Link: https://lore.kernel.org/r/20200228092142.7irbc44yaz3by7nb@kili.mountain
    Signed-off-by: Theodore Ts'o <tytso@mit.edu>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 99f8a1bd959de6527232a3263bc047ca4f41d568
Author: Kees Cook <keescook@chromium.org>
Date:   Fri Feb 21 16:02:39 2020 -0800

    docs: Fix empty parallelism argument
    
    commit adc10f5b0a03606e30c704cff1f0283a696d0260 upstream.
    
    When there was no parallelism (no top-level -j arg and a pre-1.7
    sphinx-build), the argument passed would be empty ("") instead of just
    being missing, which would (understandably) badly confuse sphinx-build.
    Fix this by removing the quotes.
    
    Reported-by: Rafael J. Wysocki <rafael@kernel.org>
    Fixes: 51e46c7a4007 ("docs, parallelism: Rearrange how jobserver reservations are made")
    Cc: stable@vger.kernel.org  # v5.5 only
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Signed-off-by: Jonathan Corbet <corbet@lwn.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e9203993b5c39750ba5187a337b3ba01cc3de153
Author: Benjamin Block <bblock@linux.ibm.com>
Date:   Wed Feb 19 16:09:25 2020 +0100

    scsi: zfcp: fix wrong data and display format of SFP+ temperature
    
    commit a3fd4bfe85fbb67cf4ec1232d0af625ece3c508b upstream.
    
    When implementing support for retrieval of local diagnostic data from the
    FCP channel, the wrong data format was assumed for the temperature of the
    local SFP+ connector. The Fibre Channel Link Services (FC-LS-3)
    specification is not clear on the format of the stored integer, and only
    after consulting the SNIA specification SFF-8472 did we realize it is
    stored as two's complement. Thus, the used data and display format is
    wrong, and highly misleading for users when the temperature should drop
    below 0°C (however unlikely that may be).
    
    To fix this, change the data format in `struct fsf_qtcb_bottom_port` from
    unsigned to signed, and change the printf format string used to generate
    `zfcp_sysfs_adapter_diag_sfp_temperature_show()` from `%hu` to `%hd`.
    
    Link: https://lore.kernel.org/r/d6e3be5428da5c9490cfff4df7cae868bc9f1a7e.1582039501.git.bblock@linux.ibm.com
    Fixes: a10a61e807b0 ("scsi: zfcp: support retrieval of SFP Data via Exchange Port Data")
    Fixes: 6028f7c4cd87 ("scsi: zfcp: introduce sysfs interface for diagnostics of local SFP transceiver")
    Cc: <stable@vger.kernel.org> # 5.5+
    Reviewed-by: Jens Remus <jremus@linux.ibm.com>
    Reviewed-by: Fedor Loshakov <loshakov@linux.ibm.com>
    Reviewed-by: Steffen Maier <maier@linux.ibm.com>
    Signed-off-by: Benjamin Block <bblock@linux.ibm.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 968292f9b8e78a67af8aaeafec296ec2b01c3937
Author: Damien Le Moal <damien.lemoal@wdc.com>
Date:   Wed Feb 19 15:38:00 2020 +0900

    scsi: sd_sbc: Fix sd_zbc_report_zones()
    
    commit 51fdaa0490241e8cd41b40cbf43a336d1a014460 upstream.
    
    The block layer generic blk_revalidate_disk_zones() checks the validity of
    zone descriptors reported by a disk using the blk_revalidate_zone_cb()
    callback function executed for each zone descriptor. If a ZBC disk reports
    invalid zone descriptors, blk_revalidate_disk_zones() returns an error and
    sd_zbc_read_zones() changes the disk capacity to 0, which in turn results
    in the gendisk structure capacity to be set to 0. This all works well for
    the first revalidate pass on a disk and the block layer detects the
    capactiy change.
    
    On the second revalidate pass, blk_revalidate_disk_zones() is called again
    and sd_zbc_report_zones() executed to check the zones a second time.
    However, for this second pass, the gendisk capacity is now 0, which results
    in sd_zbc_report_zones() to do nothing and to report success and no
    zones. blk_revalidate_disk_zones() in turn returns success and sets the
    disk queue chunk_sectors limit with zero as no zones were checked, causing
    a oops to trigger on the BUG_ON(!is_power_of_2(chunk_sectors)) in
    blk_queue_chunk_sectors().
    
    Fix this by using the sdkp capacity field rather than the gendisk capacity
    for the report zones loop in sd_zbc_report_zones(). Also add a check to
    return immediately an error if the sdkp capacity is 0.  With this fix,
    invalid/buggy ZBC disk scan does not trigger a oops and are exposed with a
    0 capacity. This change also preserve the chance for the disk to be
    correctly revalidated on the second revalidate pass as the scsi disk
    structure capacity field is always set to the disk reported value when
    sd_zbc_report_zones() is called.
    
    Link: https://lore.kernel.org/r/20200219063800.880834-1-damien.lemoal@wdc.com
    Fixes: d41003513e61 ("block: rework zone reporting")
    Cc: Cc: <stable@vger.kernel.org> # v5.5
    Reviewed-by: Christoph Hellwig <hch@lst.de>
    Reviewed-by: Johannes Thumshirn <johannes.thumshirn@wdc.com>
    Signed-off-by: Damien Le Moal <damien.lemoal@wdc.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ba7d6a9f7f42ccbcc37829d9b997d8da4de9ffc1
Author: Keith Busch <kbusch@kernel.org>
Date:   Thu Feb 13 01:41:05 2020 +0900

    nvme/pci: move cqe check after device shutdown
    
    [ Upstream commit fa46c6fb5d61b1f17b06d7c6ef75478b576304c7 ]
    
    Many users have reported nvme triggered irq_startup() warnings during
    shutdown. The driver uses the nvme queue's irq to synchronize scanning
    for completions, and enabling an interrupt affined to only offline CPUs
    triggers the alarming warning.
    
    Move the final CQE check to after disabling the device and all
    registered interrupts have been torn down so that we do not have any
    IRQ to synchronize.
    
    Link: https://bugzilla.kernel.org/show_bug.cgi?id=206509
    Reviewed-by: Sagi Grimberg <sagi@grimberg.me>
    Reviewed-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Keith Busch <kbusch@kernel.org>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4b68fd306ec3825f963eb712945337049df97d41
Author: Nigel Kirkland <nigel.kirkland@broadcom.com>
Date:   Mon Feb 10 16:01:45 2020 -0800

    nvme: prevent warning triggered by nvme_stop_keep_alive
    
    [ Upstream commit 97b2512ad000a409b4073dd1a71e4157d76675cb ]
    
    Delayed keep alive work is queued on system workqueue and may be cancelled
    via nvme_stop_keep_alive from nvme_reset_wq, nvme_fc_wq or nvme_wq.
    
    Check_flush_dependency detects mismatched attributes between the work-queue
    context used to cancel the keep alive work and system-wq. Specifically
    system-wq does not have the WQ_MEM_RECLAIM flag, whereas the contexts used
    to cancel keep alive work have WQ_MEM_RECLAIM flag.
    
    Example warning:
    
      workqueue: WQ_MEM_RECLAIM nvme-reset-wq:nvme_fc_reset_ctrl_work [nvme_fc]
            is flushing !WQ_MEM_RECLAIM events:nvme_keep_alive_work [nvme_core]
    
    To avoid the flags mismatch, delayed keep alive work is queued on nvme_wq.
    
    However this creates a secondary concern where work and a request to cancel
    that work may be in the same work queue - namely err_work in the rdma and
    tcp transports, which will want to flush/cancel the keep alive work which
    will now be on nvme_wq.
    
    After reviewing the transports, it looks like err_work can be moved to
    nvme_reset_wq. In fact that aligns them better with transition into
    RESETTING and performing related reset work in nvme_reset_wq.
    
    Change nvme-rdma and nvme-tcp to perform err_work in nvme_reset_wq.
    
    Signed-off-by: Nigel Kirkland <nigel.kirkland@broadcom.com>
    Signed-off-by: James Smart <jsmart2021@gmail.com>
    Reviewed-by: Sagi Grimberg <sagi@grimberg.me>
    Reviewed-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Keith Busch <kbusch@kernel.org>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 8e78f2db52256535ee4e400ce10e4252746b5252
Author: Anton Eidelman <anton@lightbitslabs.com>
Date:   Mon Feb 10 10:37:18 2020 -0800

    nvme/tcp: fix bug on double requeue when send fails
    
    [ Upstream commit 2d570a7c0251c594489a2c16b82b14ae30345c03 ]
    
    When nvme_tcp_io_work() fails to send to socket due to
    connection close/reset, error_recovery work is triggered
    from nvme_tcp_state_change() socket callback.
    This cancels all the active requests in the tagset,
    which requeues them.
    
    The failed request, however, was ended and thus requeued
    individually as well unless send returned -EPIPE.
    Another return code to be treated the same way is -ECONNRESET.
    
    Double requeue caused BUG_ON(blk_queued_rq(rq))
    in blk_mq_requeue_request() from either the individual requeue
    of the failed request or the bulk requeue from
    blk_mq_tagset_busy_iter(, nvme_cancel_request, );
    
    Signed-off-by: Anton Eidelman <anton@lightbitslabs.com>
    Reviewed-by: Sagi Grimberg <sagi@grimberg.me>
    Signed-off-by: Keith Busch <kbusch@kernel.org>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4b4182a3e522b0780c0915336256bd59fd6d9c92
Author: Guangbin Huang <huangguangbin2@huawei.com>
Date:   Fri Feb 14 09:53:43 2020 +0800

    net: hns3: fix a copying IPv6 address error in hclge_fd_get_flow_tuples()
    
    [ Upstream commit 47327c9315b2f3ae4ab659457977a26669631f20 ]
    
    The IPv6 address defined in struct in6_addr is specified as
    big endian, but there is no specified endian in struct
    hclge_fd_rule_tuples, so it  will cause a problem if directly
    use memcpy() to copy ipv6 address between these two structures
    since this field in struct hclge_fd_rule_tuples is little endian.
    
    This patch fixes this problem by using be32_to_cpu() to convert
    endian of IPv6 address of struct in6_addr before copying.
    
    Fixes: d93ed94fbeaf ("net: hns3: add aRFS support for PF")
    Signed-off-by: Guangbin Huang <huangguangbin2@huawei.com>
    Signed-off-by: Huazhong Tan <tanhuazhong@huawei.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 7f82ac8267b30485ae87d3078a0f561615d40d28
Author: Yonglong Liu <liuyonglong@huawei.com>
Date:   Fri Feb 14 09:53:42 2020 +0800

    net: hns3: fix VF bandwidth does not take effect in some case
    
    [ Upstream commit 19eb1123b4e9337fe20b1763fec528f837ec6568 ]
    
    When enabling 4 TC after setting the bandwidth of VF, the bandwidth
    of VF will resume to default value, because of the qset resources
    changed in this case.
    
    This patch fixes it by using a fixed VF's qset resources according to
    HNAE3_MAX_TC macro.
    
    Fixes: ee9e44248f52 ("net: hns3: add support for configuring bandwidth of VF on the host")
    Signed-off-by: Yonglong Liu <liuyonglong@huawei.com>
    Signed-off-by: Huazhong Tan <tanhuazhong@huawei.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 89cf961f0ddb7dad58ed9a194aebdb19200b01eb
Author: Yufeng Mo <moyufeng@huawei.com>
Date:   Fri Feb 14 09:53:41 2020 +0800

    net: hns3: add management table after IMP reset
    
    [ Upstream commit d0db7ed397517c8b2be24a0d1abfa15df776908e ]
    
    In the current process, the management table is missing after the
    IMP reset. This patch adds the management table to the reset process.
    
    Fixes: f5aac71c0327 ("net: hns3: add manager table initialization for hardware")
    Signed-off-by: Yufeng Mo <moyufeng@huawei.com>
    Signed-off-by: Huazhong Tan <tanhuazhong@huawei.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 159770d4d3bbb6816f4c501bae619001ee29df1a
Author: Shay Bar <shay.bar@celeno.com>
Date:   Mon Feb 10 15:07:28 2020 +0200

    mac80211: fix wrong 160/80+80 MHz setting
    
    [ Upstream commit 33181ea7f5a62a17fbe55f0f73428ecb5e686be8 ]
    
    Before this patch, STA's would set new width of 160/80+80 MHz based on AP capability only.
    This is wrong because STA may not support > 80MHz BW.
    Fix is to verify STA has 160/80+80 MHz capability before increasing its width to > 80MHz.
    
    The "support_80_80" and "support_160" setting is based on:
    "Table 9-272 — Setting of the Supported Channel Width Set subfield and Extended NSS BW
    Support subfield at a STA transmitting the VHT Capabilities Information field"
    From "Draft P802.11REVmd_D3.0.pdf"
    
    Signed-off-by: Aviad Brikman <aviad.brikman@celeno.com>
    Signed-off-by: Shay Bar <shay.bar@celeno.com>
    Link: https://lore.kernel.org/r/20200210130728.23674-1-shay.bar@celeno.com
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d9fe1596f1345d155f936fffaa97bcdca41a6bb8
Author: Sergey Matyukevich <sergey.matyukevich.os@quantenna.com>
Date:   Thu Feb 13 13:16:16 2020 +0000

    cfg80211: add missing policy for NL80211_ATTR_STATUS_CODE
    
    [ Upstream commit ea75080110a4c1fa011b0a73cb8f42227143ee3e ]
    
    The nl80211_policy is missing for NL80211_ATTR_STATUS_CODE attribute.
    As a result, for strictly validated commands, it's assumed to not be
    supported.
    
    Signed-off-by: Sergey Matyukevich <sergey.matyukevich.os@quantenna.com>
    Link: https://lore.kernel.org/r/20200213131608.10541-2-sergey.matyukevich.os@quantenna.com
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 2919cdaed0b46836d04f571d626203513897118c
Author: Frank Sorenson <sorenson@redhat.com>
Date:   Wed Feb 12 15:31:48 2020 -0600

    cifs: Fix mode output in debugging statements
    
    [ Upstream commit f52aa79df43c4509146140de0241bc21a4a3b4c7 ]
    
    A number of the debug statements output file or directory mode
    in hex.  Change these to print using octal.
    
    Signed-off-by: Frank Sorenson <sorenson@redhat.com>
    Signed-off-by: Steve French <stfrench@microsoft.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 107b2648ed627f6f3cb648c382fd24b5e58dee25
Author: Jens Axboe <axboe@kernel.dk>
Date:   Tue Feb 11 06:30:06 2020 -0700

    io-wq: don't call kXalloc_node() with non-online node
    
    [ Upstream commit 7563439adfae153b20331f1567c8b5d0e5cbd8a7 ]
    
    Glauber reports a crash on init on a box he has:
    
     RIP: 0010:__alloc_pages_nodemask+0x132/0x340
     Code: 18 01 75 04 41 80 ce 80 89 e8 48 8b 54 24 08 8b 74 24 1c c1 e8 0c 48 8b 3c 24 83 e0 01 88 44 24 20 48 85 d2 0f 85 74 01 00 00 <3b> 77 08 0f 82 6b 01 00 00 48 89 7c 24 10 89 ea 48 8b 07 b9 00 02
     RSP: 0018:ffffb8be4d0b7c28 EFLAGS: 00010246
     RAX: 0000000000000000 RBX: 0000000000000000 RCX: 000000000000e8e8
     RDX: 0000000000000000 RSI: 0000000000000002 RDI: 0000000000002080
     RBP: 0000000000012cc0 R08: 0000000000000000 R09: 0000000000000002
     R10: 0000000000000dc0 R11: ffff995c60400100 R12: 0000000000000000
     R13: 0000000000012cc0 R14: 0000000000000001 R15: ffff995c60db00f0
     FS:  00007f4d115ca900(0000) GS:ffff995c60d80000(0000) knlGS:0000000000000000
     CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
     CR2: 0000000000002088 CR3: 00000017cca66002 CR4: 00000000007606e0
     DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
     DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
     PKRU: 55555554
     Call Trace:
      alloc_slab_page+0x46/0x320
      new_slab+0x9d/0x4e0
      ___slab_alloc+0x507/0x6a0
      ? io_wq_create+0xb4/0x2a0
      __slab_alloc+0x1c/0x30
      kmem_cache_alloc_node_trace+0xa6/0x260
      io_wq_create+0xb4/0x2a0
      io_uring_setup+0x97f/0xaa0
      ? io_remove_personalities+0x30/0x30
      ? io_poll_trigger_evfd+0x30/0x30
      do_syscall_64+0x5b/0x1c0
      entry_SYSCALL_64_after_hwframe+0x44/0xa9
     RIP: 0033:0x7f4d116cb1ed
    
    which is due to the 'wqe' and 'worker' allocation being node affine.
    But it isn't valid to call the node affine allocation if the node isn't
    online.
    
    Setup structures for even offline nodes, as usual, but skip them in
    terms of thread setup to not waste resources. If the node isn't online,
    just alloc memory with NUMA_NO_NODE.
    
    Reported-by: Glauber Costa <glauber@scylladb.com>
    Tested-by: Glauber Costa <glauber@scylladb.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 2049b433e082eee2ba0b347177cb32dde5a2d389
Author: Ben Shelton <benjamin.h.shelton@intel.com>
Date:   Thu Feb 6 01:20:12 2020 -0800

    ice: Use correct netif error function
    
    [ Upstream commit 1d8bd9927234081db15a1d42a7f99505244e3703 ]
    
    Use the correct netif_msg_[tx,rx]_error() function to determine whether to
    print the MDD event type.
    
    Signed-off-by: Ben Shelton <benjamin.h.shelton@intel.com>
    Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 6e4988a5f1f9f6915da7e2ab2da8590d066b4b8b
Author: Anirudh Venkataramanan <anirudh.venkataramanan@intel.com>
Date:   Thu Feb 6 01:20:09 2020 -0800

    ice: Use ice_pf_to_dev
    
    [ Upstream commit 9a946843ba5c173e259fef7a035feac994a65b59 ]
    
    Use ice_pf_to_dev(pf) instead of &pf->pdev->dev
    Use ice_pf_to_dev(vsi->back) instead of &vsi->back->pdev->dev
    When a pointer to the pf instance is available, use ice_pf_to_dev
    instead of ice_hw_to_dev
    
    Signed-off-by: Anirudh Venkataramanan <anirudh.venkataramanan@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 9c972ef17d6d0aa4a006ee81c328f1133e55daa8
Author: Bruce Allan <bruce.w.allan@intel.com>
Date:   Thu Feb 6 01:20:07 2020 -0800

    ice: update Unit Load Status bitmask to check after reset
    
    [ Upstream commit cf8fc2a0863f9ff27ebd2efcdb1f7d378b9fb8a6 ]
    
    After a reset the Unit Load Status bits in the GLNVM_ULD register to check
    for completion should be 0x7FF before continuing.  Update the mask to check
    (minus the three reserved bits that are always set).
    
    Signed-off-by: Bruce Allan <bruce.w.allan@intel.com>
    Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 21c3e746ca441ed50f8f8fc6631e6b594e6f2720
Author: Bruce Allan <bruce.w.allan@intel.com>
Date:   Thu Feb 6 01:20:06 2020 -0800

    ice: fix and consolidate logging of NVM/firmware version information
    
    [ Upstream commit fbf1e1f6988e70287b1bfcad4f655ca96b681929 ]
    
    Logging the firmware/NVM information during driver load is redundant since
    that information is also available via ethtool.  Move the functionality
    found in ice_nvm_version_str() directly into ice_get_drvinfo() and remove
    calling the former and logging that info during driver probe.  This also
    gets rid of a bug in ice_nvm_version_str() where it returns a pointer to
    a buffer which is free'ed when that function exits.
    
    Signed-off-by: Bruce Allan <bruce.w.allan@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c332e753426e8c5227dc25bd74243b2e50e5a1f5
Author: Brett Creeley <brett.creeley@intel.com>
Date:   Thu Feb 6 01:20:02 2020 -0800

    ice: Don't allow same value for Rx tail to be written twice
    
    [ Upstream commit 168983a8e19b89efd175661e53faa6246be363a0 ]
    
    Currently we compare the value we are about to write to the Rx tail
    register with the previous value of next_to_use. The problem with this
    is we only write tail on 8 descriptor boundaries, but next_to_use is
    updated whenever we clean Rx descriptors. Fix this by comparing the
    value we are about to write to tail with the previously written tail
    value. This will prevent duplicate Rx tail bumps.
    
    Signed-off-by: Brett Creeley <brett.creeley@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 7acf371968bbb24af5cd1331412dcfb3eeaeecd6
Author: Dave Ertman <david.m.ertman@intel.com>
Date:   Thu Feb 6 01:20:00 2020 -0800

    ice: Fix switch between FW and SW LLDP
    
    [ Upstream commit 53977ee47410885e7d4eee87d2c811a48a275150 ]
    
    When switching between FW and SW LLDP mode, the
    number of configured TLV apps in the driver's
    DCB configuration is getting out of synch with
    what lldpad thinks is configured.  This is causing
    a problem when shutting down lldpad.  The cleanup
    is trying to delete TLV apps that are not defined
    in the kernel.
    
    Since the driver is keeping an accurate account
    of the apps defined, use the drivers number of
    apps to determine if there is an app to delete.
    If the number of apps is <= 1, then do not
    attempt to delete.
    
    Signed-off-by: Dave Ertman <david.m.ertman@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 03a29f3d44e3fca6c108eda83f3a3f79e413b88d
Author: Arthur Kiyanovski <akiyano@amazon.com>
Date:   Tue Feb 11 15:17:51 2020 +0000

    net: ena: ena-com.c: prevent NULL pointer dereference
    
    [ Upstream commit c207979f5ae10ed70aff1bb13f39f0736973de99 ]
    
    comp_ctx can be NULL in a very rare case when an admin command is executed
    during the execution of ena_remove().
    
    The bug scenario is as follows:
    
    * ena_destroy_device() sets the comp_ctx to be NULL
    * An admin command is executed before executing unregister_netdev(),
      this can still happen because our device can still receive callbacks
      from the netdev infrastructure such as ethtool commands.
    * When attempting to access the comp_ctx, the bug occurs since it's set
      to NULL
    
    Fix:
    Added a check that comp_ctx is not NULL
    
    Fixes: 1738cd3ed342 ("net: ena: Add a driver for Amazon Elastic Network Adapters (ENA)")
    Signed-off-by: Sameeh Jubran <sameehj@amazon.com>
    Signed-off-by: Arthur Kiyanovski <akiyano@amazon.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 1f018b12dbf980d06d6d38f0469d4721a6bff967
Author: Sameeh Jubran <sameehj@amazon.com>
Date:   Tue Feb 11 15:17:50 2020 +0000

    net: ena: ethtool: use correct value for crc32 hash
    
    [ Upstream commit 886d2089276e40d460731765083a741c5c762461 ]
    
    Up till kernel 4.11 there was no enum defined for crc32 hash in ethtool,
    thus the xor enum was used for supporting crc32.
    
    Fixes: 1738cd3ed342 ("net: ena: Add a driver for Amazon Elastic Network Adapters (ENA)")
    Signed-off-by: Sameeh Jubran <sameehj@amazon.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit e83967dd4f63a38c0af558109fa24b906d97d968
Author: Arthur Kiyanovski <akiyano@amazon.com>
Date:   Tue Feb 11 15:17:48 2020 +0000

    net: ena: fix corruption of dev_idx_to_host_tbl
    
    [ Upstream commit e3f89f91e98ce07dc0f121a3b70d21aca749ba39 ]
    
    The function ena_com_ind_tbl_convert_from_device() has an overflow
    bug as explained below. Either way, this function is not needed at
    all since we don't retrieve the indirection table from the device
    at any point which means that this conversion is not needed.
    
    The bug:
    The for loop iterates over all io_sq_queues, when passing the actual
    number of used queues the io_sq_queues[i].idx equals 0 since they are
    uninitialized which results in the following code to be executed till
    the end of the loop:
    
    dev_idx_to_host_tbl[0] = i;
    
    This results dev_idx_to_host_tbl[0] in being equal to
    ENA_TOTAL_NUM_QUEUES - 1.
    
    Fixes: 1738cd3ed342 ("net: ena: Add a driver for Amazon Elastic Network Adapters (ENA)")
    Signed-off-by: Sameeh Jubran <sameehj@amazon.com>
    Signed-off-by: Arthur Kiyanovski <akiyano@amazon.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 2aec2558b24c8de1c0bd8270690d889c02d05cdb
Author: Arthur Kiyanovski <akiyano@amazon.com>
Date:   Tue Feb 11 15:17:47 2020 +0000

    net: ena: fix incorrectly saving queue numbers when setting RSS indirection table
    
    [ Upstream commit 92569fd27f5cb0ccbdf7c7d70044b690e89a0277 ]
    
    The indirection table has the indices of the Rx queues. When we store it
    during set indirection operation, we convert the indices to our internal
    representation of the indices.
    
    Our internal representation of the indices is: even indices for Tx and
    uneven indices for Rx, where every Tx/Rx pair are in a consecutive order
    starting from 0. For example if the driver has 3 queues (3 for Tx and 3
    for Rx) then the indices are as follows:
    0  1  2  3  4  5
    Tx Rx Tx Rx Tx Rx
    
    The BUG:
    The issue is that when we satisfy a get request for the indirection
    table, we don't convert the indices back to the original representation.
    
    The FIX:
    Simply apply the inverse function for the indices of the indirection
    table after we set it.
    
    Fixes: 1738cd3ed342 ("net: ena: Add a driver for Amazon Elastic Network Adapters (ENA)")
    Signed-off-by: Sameeh Jubran <sameehj@amazon.com>
    Signed-off-by: Arthur Kiyanovski <akiyano@amazon.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 911ffb9662763dc4bbc70af255797dce18016d3a
Author: Arthur Kiyanovski <akiyano@amazon.com>
Date:   Tue Feb 11 15:17:46 2020 +0000

    net: ena: rss: store hash function as values and not bits
    
    [ Upstream commit 4844470d472d660c26149ad764da2406adb13423 ]
    
    The device receives, stores and retrieves the hash function value as bits
    and not as their enum value.
    
    The bug:
    * In ena_com_set_hash_function() we set
      cmd.u.flow_hash_func.selected_func to the bit value of rss->hash_func.
     (1 << rss->hash_func)
    * In ena_com_get_hash_function() we retrieve the hash function and store
      it's bit value in rss->hash_func. (Now the bit value of rss->hash_func
      is stored in rss->hash_func instead of it's enum value)
    
    The fix:
    This commit fixes the issue by converting the retrieved hash function
    values from the device to the matching enum value of the set bit using
    ffs(). ffs() finds the first set bit's index in a word. Since the function
    returns 1 for the LSB's index, we need to subtract 1 from the returned
    value (note that BIT(0) is 1).
    
    Fixes: 1738cd3ed342 ("net: ena: Add a driver for Amazon Elastic Network Adapters (ENA)")
    Signed-off-by: Sameeh Jubran <sameehj@amazon.com>
    Signed-off-by: Arthur Kiyanovski <akiyano@amazon.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b191ef9395df7eccb7e1883464e9f2ef0f12f139
Author: Sameeh Jubran <sameehj@amazon.com>
Date:   Tue Feb 11 15:17:45 2020 +0000

    net: ena: rss: fix failure to get indirection table
    
    [ Upstream commit 0c8923c0a64fb5d14bebb9a9065d2dc25ac5e600 ]
    
    On old hardware, getting / setting the hash function is not supported while
    gettting / setting the indirection table is.
    
    This commit enables us to still show the indirection table on older
    hardwares by setting the hash function and key to NULL.
    
    Fixes: 1738cd3ed342 ("net: ena: Add a driver for Amazon Elastic Network Adapters (ENA)")
    Signed-off-by: Sameeh Jubran <sameehj@amazon.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit e9d66152affe2b93c737c5f9c3d016fadee542a3
Author: Sameeh Jubran <sameehj@amazon.com>
Date:   Tue Feb 11 15:17:44 2020 +0000

    net: ena: rss: do not allocate key when not supported
    
    [ Upstream commit 6a4f7dc82d1e3abd3feb0c60b5041056fcd9880c ]
    
    Currently we allocate the key whether the device supports setting the
    key or not. This commit adds a check to the allocation function and
    handles the error accordingly.
    
    Fixes: 1738cd3ed342 ("net: ena: Add a driver for Amazon Elastic Network Adapters (ENA)")
    Signed-off-by: Sameeh Jubran <sameehj@amazon.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5dfbf5d0aaa011b9afa6f1b1f798d36961a0b30a
Author: Arthur Kiyanovski <akiyano@amazon.com>
Date:   Tue Feb 11 15:17:43 2020 +0000

    net: ena: fix incorrect default RSS key
    
    [ Upstream commit 0d1c3de7b8c78a5e44b74b62ede4a63629f5d811 ]
    
    Bug description:
    When running "ethtool -x <if_name>" the key shows up as all zeros.
    
    When we use "ethtool -X <if_name> hfunc toeplitz hkey <some:random:key>" to
    set the key and then try to retrieve it using "ethtool -x <if_name>" then
    we return the correct key because we return the one we saved.
    
    Bug cause:
    We don't fetch the key from the device but instead return the key
    that we have saved internally which is by default set to zero upon
    allocation.
    
    Fix:
    This commit fixes the issue by initializing the key to a random value
    using netdev_rss_key_fill().
    
    Fixes: 1738cd3ed342 ("net: ena: Add a driver for Amazon Elastic Network Adapters (ENA)")
    Signed-off-by: Sameeh Jubran <sameehj@amazon.com>
    Signed-off-by: Arthur Kiyanovski <akiyano@amazon.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d57a0727e4d156eed125b4ac768748edf86f9f30
Author: Arthur Kiyanovski <akiyano@amazon.com>
Date:   Tue Feb 11 15:17:42 2020 +0000

    net: ena: add missing ethtool TX timestamping indication
    
    [ Upstream commit cf6d17fde93bdda23c9b02dd5906a12bf8c55209 ]
    
    Current implementation of the driver calls skb_tx_timestamp()to add a
    software tx timestamp to the skb, however the software-transmit capability
    is not reported in ethtool -T.
    
    This commit updates the ethtool structure to report the software-transmit
    capability in ethtool -T using the standard ethtool_op_get_ts_info().
    This function reports all software timestamping capabilities (tx and rx),
    as well as setting phc_index = -1. phc_index is the index of the PTP
    hardware clock device that will be used for hardware timestamps. Since we
    don't have such a device in ENA, using the default -1 value is the correct
    setting.
    
    Fixes: 1738cd3ed342 ("net: ena: Add a driver for Amazon Elastic Network Adapters (ENA)")
    Signed-off-by: Ezequiel Lara Gomez <ezegomez@amazon.com>
    Signed-off-by: Arthur Kiyanovski <akiyano@amazon.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 430456b36420344918bde3b703a2af38532f1d8a
Author: Arthur Kiyanovski <akiyano@amazon.com>
Date:   Tue Feb 11 15:17:41 2020 +0000

    net: ena: fix uses of round_jiffies()
    
    [ Upstream commit 2a6e5fa2f4c25b66c763428a3e65363214946931 ]
    
    >From the documentation of round_jiffies():
    "Rounds a time delta  in the future (in jiffies) up or down to
    (approximately) full seconds. This is useful for timers for which
    the exact time they fire does not matter too much, as long as
    they fire approximately every X seconds.
    By rounding these timers to whole seconds, all such timers will fire
    at the same time, rather than at various times spread out. The goal
    of this is to have the CPU wake up less, which saves power."
    
    There are 2 parts to this patch:
    ================================
    Part 1:
    -------
    In our case we need timer_service to be called approximately every
    X=1 seconds, and the exact time does not matter, so using round_jiffies()
    is the right way to go.
    
    Therefore we add round_jiffies() to the mod_timer() in ena_timer_service().
    
    Part 2:
    -------
    round_jiffies() is used in check_for_missing_keep_alive() when
    getting the jiffies of the expiration of the keep_alive timeout. Here it
    is actually a mistake to use round_jiffies() because we want the exact
    time when keep_alive should expire and not an approximate rounded time,
    which can cause early, false positive, timeouts.
    
    Therefore we remove round_jiffies() in the calculation of
    keep_alive_expired() in check_for_missing_keep_alive().
    
    Fixes: 82ef30f13be0 ("net: ena: add hardware hints capability to the driver")
    Fixes: 1738cd3ed342 ("net: ena: Add a driver for Amazon Elastic Network Adapters (ENA)")
    Signed-off-by: Arthur Kiyanovski <akiyano@amazon.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 93e37c070e02c6253a3da0e2ded666158797458e
Author: Arthur Kiyanovski <akiyano@amazon.com>
Date:   Tue Feb 11 15:17:40 2020 +0000

    net: ena: fix potential crash when rxfh key is NULL
    
    [ Upstream commit 91a65b7d3ed8450f31ab717a65dcb5f9ceb5ab02 ]
    
    When ethtool -X is called without an hkey, ena_com_fill_hash_function()
    is called with key=NULL, which is passed to memcpy causing a crash.
    
    This commit fixes this issue by checking key is not NULL.
    
    Fixes: 1738cd3ed342 ("net: ena: Add a driver for Amazon Elastic Network Adapters (ENA)")
    Signed-off-by: Sameeh Jubran <sameehj@amazon.com>
    Signed-off-by: Arthur Kiyanovski <akiyano@amazon.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c045a6efe264dd084398dbc380e49a6308a955e4
Author: Brett Creeley <brett.creeley@intel.com>
Date:   Mon Feb 10 10:59:18 2020 -0800

    i40e: Fix the conditional for i40e_vc_validate_vqs_bitmaps
    
    [ Upstream commit f27f37a04a69890ac85d9155f03ee2d23b678d8f ]
    
    Commit d9d6a9aed3f6 ("i40e: Fix virtchnl_queue_select bitmap
    validation") introduced a necessary change for verifying how queue
    bitmaps from the iavf driver get validated. Unfortunately, the
    conditional was reversed. Fix this.
    
    Fixes: d9d6a9aed3f6 ("i40e: Fix virtchnl_queue_select bitmap validation")
    Signed-off-by: Brett Creeley <brett.creeley@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 205def0154f660d9cfc70d92ef4dbbc0e76fb85b
Author: Thierry Reding <treding@nvidia.com>
Date:   Mon Feb 3 15:31:14 2020 +0100

    soc/tegra: fuse: Fix build with Tegra194 configuration
    
    [ Upstream commit 6f4ecbe284df5f22e386a640d9a4b32cede62030 ]
    
    If only Tegra194 support is enabled, the tegra30_fuse_read() and
    tegra30_fuse_init() function are not declared and cause a build failure.
    Add Tegra194 to the preprocessor guard to make sure these functions are
    available for Tegra194-only builds as well.
    
    Link: https://lore.kernel.org/r/20200203143114.3967295-1-thierry.reding@gmail.com
    Reported-by: kbuild test robot <lkp@intel.com>
    Signed-off-by: Thierry Reding <treding@nvidia.com>
    Signed-off-by: Olof Johansson <olof@lixom.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c18f1d46e5c3b33f82682f94daba69fb76ad662f
Author: Daniel Kolesa <daniel@octaforge.org>
Date:   Thu Feb 6 20:14:35 2020 +0100

    amdgpu: Prevent build errors regarding soft/hard-float FP ABI tags
    
    [ Upstream commit 416611d9b6eebaeae58ed26cc7d23131c69126b1 ]
    
    On PowerPC, the compiler will tag object files with whether they
    use hard or soft float FP ABI and whether they use 64 or 128-bit
    long double ABI. On systems with 64-bit long double ABI, a tag
    will get emitted whenever a double is used, as on those systems
    a long double is the same as a double. This will prevent linkage
    as other files are being compiled with hard-float.
    
    On ppc64, this code will never actually get used for the time
    being, as the only currently existing hardware using it are the
    Renoir APUs. Therefore, until this is testable and can be fixed
    properly, at least make sure the build will not fail.
    
    Signed-off-by: Daniel Kolesa <daniel@octaforge.org>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 14a97905f239b8df633f020db41e411a539a78fc
Author: Isabel Zhang <isabel.zhang@amd.com>
Date:   Mon Jan 27 10:57:16 2020 -0500

    drm/amd/display: Add initialitions for PLL2 clock source
    
    [ Upstream commit c134c3cabae46a56ab2e1f5e5fa49405e1758838 ]
    
    [Why]
    Starting from 14nm, the PLL is built into the PHY and the PLL is mapped
    to PHY on 1 to 1 basis. In the code, the DP port is mapped to a PLL that was not
    initialized. This causes DP to HDMI dongle to not light up the display.
    
    [How]
    Initializations added for PLL2 when creating resources.
    
    Signed-off-by: Isabel Zhang <isabel.zhang@amd.com>
    Reviewed-by: Eric Yang <eric.yang2@amd.com>
    Acked-by: Bhawanpreet Lakha <Bhawanpreet.Lakha@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 6ce152ace1273704b21bfd01390d538a3002c2b5
Author: Yongqiang Sun <yongqiang.sun@amd.com>
Date:   Thu Jan 23 16:30:15 2020 -0500

    drm/amd/display: Limit minimum DPPCLK to 100MHz.
    
    [ Upstream commit 6c81917a0485ee2a1be0dc23321ac10ecfd9578b ]
    
    [Why]
    Underflow is observed when plug in a 4K@60 monitor with
    1366x768 eDP due to DPPCLK is too low.
    
    [How]
    Limit minimum DPPCLK to 100MHz.
    
    Signed-off-by: Yongqiang Sun <yongqiang.sun@amd.com>
    Reviewed-by: Eric Yang <eric.yang2@amd.com>
    Acked-by: Bhawanpreet Lakha <Bhawanpreet.Lakha@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 10961b201af1d287c63a5be9679d7928347ca3bc
Author: Aric Cyr <aric.cyr@amd.com>
Date:   Tue Jan 21 22:50:13 2020 -0500

    drm/amd/display: Check engine is not NULL before acquiring
    
    [ Upstream commit 2b63d0ec0daf79ba503fa8bfa25e07dc3da274f3 ]
    
    [Why]
    Engine can be NULL in some cases, so we must not acquire it.
    
    [How]
    Check for NULL engine before acquiring.
    
    Signed-off-by: Aric Cyr <aric.cyr@amd.com>
    Reviewed-by: Harry Wentland <harry.wentland@amd.com>
    Acked-by: Bhawanpreet Lakha <Bhawanpreet.Lakha@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 909b6d55d18d41a0df22b9684f1536db8a6e9f63
Author: Krishnamraju Eraparaju <krishna2@chelsio.com>
Date:   Fri Feb 7 19:44:29 2020 +0530

    RDMA/siw: Remove unwanted WARN_ON in siw_cm_llp_data_ready()
    
    [ Upstream commit 663218a3e715fd9339d143a3e10088316b180f4f ]
    
    Warnings like below can fill up the dmesg while disconnecting RDMA
    connections.
    Hence, remove the unwanted WARN_ON.
    
      WARNING: CPU: 6 PID: 0 at drivers/infiniband/sw/siw/siw_cm.c:1229 siw_cm_llp_data_ready+0xc1/0xd0 [siw]
      RIP: 0010:siw_cm_llp_data_ready+0xc1/0xd0 [siw]
      Call Trace:
       <IRQ>
       tcp_data_queue+0x226/0xb40
       tcp_rcv_established+0x220/0x620
       tcp_v4_do_rcv+0x12a/0x1e0
       tcp_v4_rcv+0xb05/0xc00
       ip_local_deliver_finish+0x69/0x210
       ip_local_deliver+0x6b/0xe0
       ip_rcv+0x273/0x362
       __netif_receive_skb_core+0xb35/0xc30
       netif_receive_skb_internal+0x3d/0xb0
       napi_gro_frags+0x13b/0x200
       t4_ethrx_handler+0x433/0x7d0 [cxgb4]
       process_responses+0x318/0x580 [cxgb4]
       napi_rx_handler+0x14/0x100 [cxgb4]
       net_rx_action+0x149/0x3b0
       __do_softirq+0xe3/0x30a
       irq_exit+0x100/0x110
       do_IRQ+0x7f/0xe0
       common_interrupt+0xf/0xf
       </IRQ>
    
    Link: https://lore.kernel.org/r/20200207141429.27927-1-krishna2@chelsio.com
    Signed-off-by: Krishnamraju Eraparaju <krishna2@chelsio.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 9430a14fe90b2012d30b7f1a12e28ccd2c4f44a8
Author: Sung Lee <sung.lee@amd.com>
Date:   Wed Jan 15 11:55:06 2020 -0500

    drm/amd/display: Do not set optimized_require to false after plane disable
    
    [ Upstream commit df36f6cf23ada812930afa8ee76681d4ad307c61 ]
    
    [WHY]
    The optimized_require flag is needed to set watermarks and clocks lower
    in certain conditions. This flag is set to true and then set to false
    while programming front end in dcn20.
    
    [HOW]
    Do not set the flag to false while disabling plane.
    
    Signed-off-by: Sung Lee <sung.lee@amd.com>
    Reviewed-by: Tony Cheng <Tony.Cheng@amd.com>
    Acked-by: Bhawanpreet Lakha <Bhawanpreet.Lakha@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5dc310d85ac6718e9c3bac644cc0e1eaa3cfa46e
Author: Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
Date:   Mon Dec 16 11:08:47 2019 +0900

    ARM: dts: sti: fixup sound frame-inversion for stihxxx-b2120.dtsi
    
    [ Upstream commit f24667779b5348279e5e4328312a141a730a1fc7 ]
    
    frame-inversion is "flag" not "uint32".
    This patch fixup it.
    
    Signed-off-by: Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
    Reviewed-by: Patrice Chotard <patrice.chotard@st.com>
    Signed-off-by: Patrice Chotard <patrice.chotard@st.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit cb8757b965ba96da78ca1d3f42b8eeed19222476
Author: Xiubo Li <xiubli@redhat.com>
Date:   Mon Feb 3 21:28:25 2020 -0500

    ceph: do not execute direct write in parallel if O_APPEND is specified
    
    [ Upstream commit 8e4473bb50a1796c9c32b244e5dbc5ee24ead937 ]
    
    In O_APPEND & O_DIRECT mode, the data from different writers will
    be possibly overlapping each other since they take the shared lock.
    
    For example, both Writer1 and Writer2 are in O_APPEND and O_DIRECT
    mode:
    
              Writer1                         Writer2
    
         shared_lock()                   shared_lock()
         getattr(CAP_SIZE)               getattr(CAP_SIZE)
         iocb->ki_pos = EOF              iocb->ki_pos = EOF
         write(data1)
                                         write(data2)
         shared_unlock()                 shared_unlock()
    
    The data2 will overlap the data1 from the same file offset, the
    old EOF.
    
    Switch to exclusive lock instead when O_APPEND is specified.
    
    Signed-off-by: Xiubo Li <xiubli@redhat.com>
    Reviewed-by: Jeff Layton <jlayton@kernel.org>
    Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 77d4cb17f2cdaa9715fbbc32ff48f35c33e96767
Author: Kan Liang <kan.liang@linux.intel.com>
Date:   Tue Jan 28 10:31:19 2020 -0800

    perf/x86/msr: Add Tremont support
    
    [ Upstream commit 0aa0e0d6b34b89649e6b5882a7e025a0eb9bd832 ]
    
    Tremont is Intel's successor to Goldmont Plus. SMI_COUNT MSR is also
    supported.
    
    Signed-off-by: Kan Liang <kan.liang@linux.intel.com>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Reviewed-by: Andi Kleen <ak@linux.intel.com>
    Link: https://lkml.kernel.org/r/1580236279-35492-3-git-send-email-kan.liang@linux.intel.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 6cc3a4bc6bfd97acdc14cec3cc094ea637d84bd2
Author: Kan Liang <kan.liang@linux.intel.com>
Date:   Tue Jan 28 10:31:18 2020 -0800

    perf/x86/cstate: Add Tremont support
    
    [ Upstream commit ecf71fbccb9ac5cb964eb7de59bb9da3755b7885 ]
    
    Tremont is Intel's successor to Goldmont Plus. From the perspective of
    Intel cstate residency counters, there is nothing changed compared with
    Goldmont Plus and Goldmont.
    
    Share glm_cstates with Goldmont Plus and Goldmont.
    Update the comments for Tremont.
    
    Signed-off-by: Kan Liang <kan.liang@linux.intel.com>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Reviewed-by: Andi Kleen <ak@linux.intel.com>
    Link: https://lkml.kernel.org/r/1580236279-35492-2-git-send-email-kan.liang@linux.intel.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 190d0260568984fea7f9cdb8fcee15e1ca3ee285
Author: Kan Liang <kan.liang@linux.intel.com>
Date:   Tue Jan 28 10:31:17 2020 -0800

    perf/x86/intel: Add Elkhart Lake support
    
    [ Upstream commit eda23b387f6c4bb2971ac7e874a09913f533b22c ]
    
    Elkhart Lake also uses Tremont CPU. From the perspective of Intel PMU,
    there is nothing changed compared with Jacobsville.
    Share the perf code with Jacobsville.
    
    Signed-off-by: Kan Liang <kan.liang@linux.intel.com>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Reviewed-by: Andi Kleen <ak@linux.intel.com>
    Link: https://lkml.kernel.org/r/1580236279-35492-1-git-send-email-kan.liang@linux.intel.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d41406038d1e45a1b9ebbf9099f39e59ec0b29fb
Author: John Garry <john.garry@huawei.com>
Date:   Tue Feb 11 00:50:17 2020 +0800

    perf/smmuv3: Use platform_get_irq_optional() for wired interrupt
    
    [ Upstream commit 0ca2c0319a7bce0e152b51b866979d62dc261e48 ]
    
    Even though a SMMUv3 PMCG implementation may use an MSI as the form of
    interrupt source, the kernel would still complain that it does not find
    the wired (GSIV) interrupt in this case:
    
    root@(none)$ dmesg | grep arm-smmu-v3-pmcg | grep "not found"
    [   59.237219] arm-smmu-v3-pmcg arm-smmu-v3-pmcg.8.auto: IRQ index 0 not found
    [   59.322841] arm-smmu-v3-pmcg arm-smmu-v3-pmcg.9.auto: IRQ index 0 not found
    [   59.422155] arm-smmu-v3-pmcg arm-smmu-v3-pmcg.10.auto: IRQ index 0 not found
    [   59.539014] arm-smmu-v3-pmcg arm-smmu-v3-pmcg.11.auto: IRQ index 0 not found
    [   59.640329] arm-smmu-v3-pmcg arm-smmu-v3-pmcg.12.auto: IRQ index 0 not found
    [   59.743112] arm-smmu-v3-pmcg arm-smmu-v3-pmcg.13.auto: IRQ index 0 not found
    [   59.880577] arm-smmu-v3-pmcg arm-smmu-v3-pmcg.14.auto: IRQ index 0 not found
    [   60.017528] arm-smmu-v3-pmcg arm-smmu-v3-pmcg.15.auto: IRQ index 0 not found
    
    Use platform_get_irq_optional() to silence the warning.
    
    If neither interrupt source is found, then the driver will still warn that
    IRQ setup errored and the probe will fail.
    
    Reviewed-by: Robin Murphy <robin.murphy@arm.com>
    Signed-off-by: John Garry <john.garry@huawei.com>
    Signed-off-by: Will Deacon <will@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit f78942388b27d0cfd1ab9ed480f126bebbe5e167
Author: Trond Myklebust <trondmy@gmail.com>
Date:   Wed Feb 5 09:01:53 2020 -0500

    NFSv4: Fix races between open and dentry revalidation
    
    [ Upstream commit cf5b4059ba7197d6cef9c0e024979d178ed8c8ec ]
    
    We want to make sure that we revalidate the dentry if and only if
    we've done an OPEN by filename.
    In order to avoid races with remote changes to the directory on the
    server, we want to save the verifier before calling OPEN. The exception
    is if the server returned a delegation with our OPEN, as we then
    know that the filename can't have changed on the server.
    
    Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
    Reviewed-by: Benjamin Coddington <bcodding@gmail.com>
    Tested-by: Benjamin Coddington <bcodding@gmail.com>
    Signed-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit e45db443410b112e90db805e15191fe43302d44b
Author: Bjørn Mork <bjorn@mork.no>
Date:   Sat Feb 8 16:55:04 2020 +0100

    qmi_wwan: unconditionally reject 2 ep interfaces
    
    [ Upstream commit 00516d13d4cfa56ce39da144db2dbf08b09b9357 ]
    
    We have been using the fact that the QMI and DIAG functions
    usually are the only ones with class/subclass/protocol being
    ff/ff/ff on Quectel modems. This has allowed us to match the
    QMI function without knowing the exact interface number,
    which can vary depending on firmware configuration.
    
    The ability to silently reject the DIAG function, which is
    usually handled by the option driver, is important for this
    method to work.  This is done based on the knowledge that it
    has exactly 2 bulk endpoints.  QMI function control interfaces
    will have either 3 or 1 endpoint. This rule is universal so
    the quirk condition can be removed.
    
    The fixed layouts known from the Gobi1k and Gobi2k modems
    have been gradually replaced by more dynamic layouts, and
    many vendors now use configurable layouts without changing
    device IDs.  Renaming the class/subclass/protocol matching
    macro makes it more obvious that this is now not Quectel
    specific anymore.
    
    Cc: Kristian Evensen <kristian.evensen@gmail.com>
    Cc: Aleksander Morgado <aleksander@aleksander.es>
    Signed-off-by: Bjørn Mork <bjorn@mork.no>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 1f01c2e86563c88d2100da10af6047e41617a81c
Author: Bjørn Mork <bjorn@mork.no>
Date:   Sat Feb 8 15:50:36 2020 +0100

    qmi_wwan: re-add DW5821e pre-production variant
    
    [ Upstream commit 88bf54603f6f2c137dfee1abf6436ceac3528d2d ]
    
    Commit f25e1392fdb5 removed the support for the pre-production variant
    of the Dell DW5821e to avoid probing another USB interface unnecessarily.
    However, the pre-production samples are found in the wild, and this lack
    of support is causing problems for users of such samples.  It is therefore
    necessary to support both variants.
    
    Matching on both interfaces 0 and 1 is not expected to cause any problem
    with either variant, as only the QMI function will be probed successfully
    on either.  Interface 1 will be rejected based on the HID class for the
    production variant:
    
    T:  Bus=01 Lev=03 Prnt=04 Port=00 Cnt=01 Dev#= 16 Spd=480 MxCh= 0
    D:  Ver= 2.10 Cls=ef(misc ) Sub=02 Prot=01 MxPS=64 #Cfgs=  2
    P:  Vendor=413c ProdID=81d7 Rev=03.18
    S:  Manufacturer=DELL
    S:  Product=DW5821e Snapdragon X20 LTE
    S:  SerialNumber=0123456789ABCDEF
    C:  #Ifs= 6 Cfg#= 1 Atr=a0 MxPwr=500mA
    I:  If#= 0 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=ff Prot=ff Driver=qmi_wwan
    I:  If#= 1 Alt= 0 #EPs= 1 Cls=03(HID  ) Sub=00 Prot=00 Driver=usbhid
    I:  If#= 2 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=00 Prot=00 Driver=option
    I:  If#= 3 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=00 Prot=00 Driver=option
    I:  If#= 4 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=00 Prot=00 Driver=option
    I:  If#= 5 Alt= 0 #EPs= 2 Cls=ff(vend.) Sub=ff Prot=ff Driver=option
    
    And interface 0 will be rejected based on too few endpoints for the
    pre-production variant:
    
    T: Bus=01 Lev=02 Prnt=02 Port=03 Cnt=03 Dev#= 7 Spd=480 MxCh= 0
    D: Ver= 2.10 Cls=ef(misc ) Sub=02 Prot=01 MxPS=64 #Cfgs= 2
    P: Vendor=413c ProdID=81d7 Rev= 3.18
    S: Manufacturer=DELL
    S: Product=DW5821e Snapdragon X20 LTE
    S: SerialNumber=0123456789ABCDEF
    C: #Ifs= 5 Cfg#= 1 Atr=a0 MxPwr=500mA
    I: If#= 0 Alt= 0 #EPs= 2 Cls=ff(vend.) Sub=ff Prot=ff Driver=
    I: If#= 1 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=ff Prot=ff Driver=qmi_wwan
    I: If#= 2 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=00 Prot=00 Driver=option
    I: If#= 3 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=00 Prot=00 Driver=option
    I: If#= 4 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=00 Prot=00 Driver=option
    
    Fixes: f25e1392fdb5 ("qmi_wwan: fix interface number for DW5821e production firmware")
    Link: https://whrl.pl/Rf0vNk
    Reported-by: Lars Melin <larsm17@gmail.com>
    Cc: Aleksander Morgado <aleksander@aleksander.es>
    Signed-off-by: Bjørn Mork <bjorn@mork.no>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 83fa0be473775f47138dc82dc520b7b78df7cf9e
Author: Harald Freudenberger <freude@linux.ibm.com>
Date:   Fri Dec 20 16:02:54 2019 +0100

    s390/zcrypt: fix card and queue total counter wrap
    
    [ Upstream commit fcd98d4002539f1e381916fc1b6648938c1eac76 ]
    
    The internal statistic counters for the total number of
    requests processed per card and per queue used integers. So they do
    wrap after a rather huge amount of crypto requests processed. This
    patch introduces uint64 counters which should hold much longer but
    still may wrap. The sysfs attributes request_count for card and queue
    also used only %ld and now display the counter value with %llu.
    
    This is not a security relevant fix. The int overflow which happened
    is not in any way exploitable as a security breach.
    
    Signed-off-by: Harald Freudenberger <freude@linux.ibm.com>
    Signed-off-by: Vasily Gorbik <gor@linux.ibm.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 63279e24b2c0e91e3de9fa6c40cb2e3980f60971
Author: Stefano Garzarella <sgarzare@redhat.com>
Date:   Fri Feb 7 13:18:28 2020 +0100

    io_uring: flush overflowed CQ events in the io_uring_poll()
    
    [ Upstream commit 63e5d81f72af1bf370bf8a6745b0a8d71a7bb37d ]
    
    In io_uring_poll() we must flush overflowed CQ events before to
    check if there are CQ events available, to avoid missing events.
    
    We call the io_cqring_events() that checks and flushes any overflow
    and returns the number of CQ events available.
    
    Signed-off-by: Stefano Garzarella <sgarzare@redhat.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d8e629e3c5f7bb863b63a86688ea8f8bd0d0810e
Author: Sergey Matyukevich <sergey.matyukevich.os@quantenna.com>
Date:   Mon Feb 3 10:56:50 2020 +0000

    cfg80211: check wiphy driver existence for drvinfo report
    
    [ Upstream commit bfb7bac3a8f47100ebe7961bd14e924c96e21ca7 ]
    
    When preparing ethtool drvinfo, check if wiphy driver is defined
    before dereferencing it. Driver may not exist, e.g. if wiphy is
    attached to a virtual platform device.
    
    Signed-off-by: Sergey Matyukevich <sergey.matyukevich.os@quantenna.com>
    Link: https://lore.kernel.org/r/20200203105644.28875-1-sergey.matyukevich.os@quantenna.com
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 519906774d79d1e1119c165073f480d50150d3bb
Author: Johannes Berg <johannes.berg@intel.com>
Date:   Fri Jan 31 13:12:58 2020 +0200

    mac80211: consider more elements in parsing CRC
    
    [ Upstream commit a04564c99bb4a92f805a58e56b2d22cc4978f152 ]
    
    We only use the parsing CRC for checking if a beacon changed,
    and elements with an ID > 63 cannot be represented in the
    filter. Thus, like we did before with WMM and Cisco vendor
    elements, just statically add these forgotten items to the
    CRC:
     - WLAN_EID_VHT_OPERATION
     - WLAN_EID_OPMODE_NOTIF
    
    I guess that in most cases when VHT/HE operation change, the HT
    operation also changed, and so the change was picked up, but we
    did notice that pure operating mode notification changes were
    ignored.
    
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
    Link: https://lore.kernel.org/r/20200131111300.891737-22-luca@coelho.fi
    [restrict to VHT for the mac80211 branch]
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit eee97361b9abecc78b6f3980fda406c34f5f4ca6
Author: Jeff Moyer <jmoyer@redhat.com>
Date:   Wed Feb 5 14:15:58 2020 -0500

    dax: pass NOWAIT flag to iomap_apply
    
    [ Upstream commit 96222d53842dfe54869ec4e1b9d4856daf9105a2 ]
    
    fstests generic/471 reports a failure when run with MOUNT_OPTIONS="-o
    dax".  The reason is that the initial pwrite to an empty file with the
    RWF_NOWAIT flag set does not return -EAGAIN.  It turns out that
    dax_iomap_rw doesn't pass that flag through to iomap_apply.
    
    With this patch applied, generic/471 passes for me.
    
    Signed-off-by: Jeff Moyer <jmoyer@redhat.com>
    Reviewed-by: Christoph Hellwig <hch@lst.de>
    Reviewed-by: Jan Kara <jack@suse.cz>
    Link: https://lore.kernel.org/r/x49r1z86e1d.fsf@segfault.boston.devel.redhat.com
    Signed-off-by: Dan Williams <dan.j.williams@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 372f5d3a3812bb412221f2d103197b7ac1bb51ff
Author: Vincent Guittot <vincent.guittot@linaro.org>
Date:   Tue Jan 14 15:13:56 2020 +0100

    sched/fair: Prevent unlimited runtime on throttled group
    
    [ Upstream commit 2a4b03ffc69f2dedc6388e9a6438b5f4c133a40d ]
    
    When a running task is moved on a throttled task group and there is no
    other task enqueued on the CPU, the task can keep running using 100% CPU
    whatever the allocated bandwidth for the group and although its cfs rq is
    throttled. Furthermore, the group entity of the cfs_rq and its parents are
    not enqueued but only set as curr on their respective cfs_rqs.
    
    We have the following sequence:
    
    sched_move_task
      -dequeue_task: dequeue task and group_entities.
      -put_prev_task: put task and group entities.
      -sched_change_group: move task to new group.
      -enqueue_task: enqueue only task but not group entities because cfs_rq is
        throttled.
      -set_next_task : set task and group_entities as current sched_entity of
        their cfs_rq.
    
    Another impact is that the root cfs_rq runnable_load_avg at root rq stays
    null because the group_entities are not enqueued. This situation will stay
    the same until an "external" event triggers a reschedule. Let trigger it
    immediately instead.
    
    Signed-off-by: Vincent Guittot <vincent.guittot@linaro.org>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Acked-by: Ben Segall <bsegall@google.com>
    Link: https://lkml.kernel.org/r/1579011236-31256-1-git-send-email-vincent.guittot@linaro.org
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 390a6ab79e7c89ebb077fe73ec502c7dfa465213
Author: Peter Zijlstra (Intel) <peterz@infradead.org>
Date:   Sat Jan 11 04:53:39 2020 -0500

    timers/nohz: Update NOHZ load in remote tick
    
    [ Upstream commit ebc0f83c78a2d26384401ecf2d2fa48063c0ee27 ]
    
    The way loadavg is tracked during nohz only pays attention to the load
    upon entering nohz.  This can be particularly noticeable if full nohz is
    entered while non-idle, and then the cpu goes idle and stays that way for
    a long time.
    
    Use the remote tick to ensure that full nohz cpus report their deltas
    within a reasonable time.
    
    [ swood: Added changelog and removed recheck of stopped tick. ]
    
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Signed-off-by: Scott Wood <swood@redhat.com>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Link: https://lkml.kernel.org/r/1578736419-14628-3-git-send-email-swood@redhat.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 0dd2ae07c57c8c4fad59f160a5adbb3cf0ae9765
Author: Scott Wood <swood@redhat.com>
Date:   Sat Jan 11 04:53:38 2020 -0500

    sched/core: Don't skip remote tick for idle CPUs
    
    [ Upstream commit 488603b815a7514c7009e6fc339d74ed4a30f343 ]
    
    This will be used in the next patch to get a loadavg update from
    nohz cpus.  The delta check is skipped because idle_sched_class
    doesn't update se.exec_start.
    
    Signed-off-by: Scott Wood <swood@redhat.com>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Link: https://lkml.kernel.org/r/1578736419-14628-2-git-send-email-swood@redhat.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 28291b0124e7850055faab770d5ba2a07276b42a
Author: Sean Paul <seanpaul@chromium.org>
Date:   Tue Jan 21 11:18:48 2020 -0800

    drm/msm: Set dma maximum segment size for mdss
    
    [ Upstream commit db735fc4036bbe1fbe606819b5f0ff26cc76cdff ]
    
    Turning on CONFIG_DMA_API_DEBUG_SG results in the following error:
    
    [   12.078665] msm ae00000.mdss: DMA-API: mapping sg segment longer than device claims to support [len=3526656] [max=65536]
    [   12.089870] WARNING: CPU: 6 PID: 334 at /mnt/host/source/src/third_party/kernel/v4.19/kernel/dma/debug.c:1301 debug_dma_map_sg+0x1dc/0x318
    [   12.102655] Modules linked in: joydev
    [   12.106442] CPU: 6 PID: 334 Comm: frecon Not tainted 4.19.0 #2
    [   12.112450] Hardware name: Google Cheza (rev3+) (DT)
    [   12.117566] pstate: 60400009 (nZCv daif +PAN -UAO)
    [   12.122506] pc : debug_dma_map_sg+0x1dc/0x318
    [   12.126995] lr : debug_dma_map_sg+0x1dc/0x318
    [   12.131487] sp : ffffff800cc3ba80
    [   12.134913] x29: ffffff800cc3ba80 x28: 0000000000000000
    [   12.140395] x27: 0000000000000004 x26: 0000000000000004
    [   12.145868] x25: ffffff8008e55b18 x24: 0000000000000000
    [   12.151337] x23: 00000000ffffffff x22: ffffff800921c000
    [   12.156809] x21: ffffffc0fa75b080 x20: ffffffc0f7195090
    [   12.162280] x19: ffffffc0f1c53280 x18: 0000000000000000
    [   12.167749] x17: 0000000000000000 x16: 0000000000000000
    [   12.173218] x15: 0000000000000000 x14: 0720072007200720
    [   12.178689] x13: 0720072007200720 x12: 0720072007200720
    [   12.184161] x11: 0720072007200720 x10: 0720072007200720
    [   12.189641] x9 : ffffffc0f1fc6b60 x8 : 0000000000000000
    [   12.195110] x7 : ffffff8008132ce0 x6 : 0000000000000000
    [   12.200585] x5 : 0000000000000000 x4 : ffffff8008134734
    [   12.206058] x3 : ffffff800cc3b830 x2 : ffffffc0f1fc6240
    [   12.211532] x1 : 25045a74f48a7400 x0 : 25045a74f48a7400
    [   12.217006] Call trace:
    [   12.219535]  debug_dma_map_sg+0x1dc/0x318
    [   12.223671]  get_pages+0x19c/0x20c
    [   12.227177]  msm_gem_fault+0x64/0xfc
    [   12.230874]  __do_fault+0x3c/0x140
    [   12.234383]  __handle_mm_fault+0x70c/0xdb8
    [   12.238603]  handle_mm_fault+0xac/0xc4
    [   12.242473]  do_page_fault+0x1bc/0x3d4
    [   12.246342]  do_translation_fault+0x54/0x88
    [   12.250652]  do_mem_abort+0x60/0xf0
    [   12.254250]  el0_da+0x20/0x24
    [   12.257317] irq event stamp: 67260
    [   12.260828] hardirqs last  enabled at (67259): [<ffffff8008132d0c>] console_unlock+0x214/0x608
    [   12.269693] hardirqs last disabled at (67260): [<ffffff8008080e0c>] do_debug_exception+0x5c/0x178
    [   12.278820] softirqs last  enabled at (67256): [<ffffff8008081664>] __do_softirq+0x4d4/0x520
    [   12.287510] softirqs last disabled at (67249): [<ffffff80080be574>] irq_exit+0xa8/0x100
    [   12.295742] ---[ end trace e63cfc40c313ffab ]---
    
    The root of the problem is that the default segment size for sgt is
    (UINT_MAX & PAGE_MASK), and the default segment size for device dma is
    64K. As such, if you compare the 2, you would deduce that the sg segment
    will overflow the device's capacity. In reality, the hardware can
    accommodate the larger sg segments, it's just not initializing its max
    segment properly. This patch initializes the max segment size for the
    mdss device, which gets rid of that pesky warning.
    
    Reported-by: Stephen Boyd <swboyd@chromium.org>
    Tested-by: Stephen Boyd <swboyd@chromium.org>
    Tested-by: Sai Prakash Ranjan <saiprakash.ranjan@codeaurora.org>
    Reviewed-by: Rob Clark <robdclark@gmail.com>
    Signed-off-by: Sean Paul <seanpaul@chromium.org>
    Signed-off-by: Douglas Anderson <dianders@chromium.org>
    Link: https://patchwork.freedesktop.org/patch/msgid/20200121111813.REPOST.1.I92c66a35fb13f368095b05287bdabdbe88ca6922@changeid
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 6e9200a41c00d2595941d79525f663d0651abef3
Author: Corey Minyard <cminyard@mvista.com>
Date:   Mon Dec 23 10:42:19 2019 -0600

    ipmi:ssif: Handle a possible NULL pointer reference
    
    [ Upstream commit 6b8526d3abc02c08a2f888e8c20b7ac9e5776dfe ]
    
    In error cases a NULL can be passed to memcpy.  The length will always
    be zero, so it doesn't really matter, but go ahead and check for NULL,
    anyway, to be more precise and avoid static analysis errors.
    
    Reported-by: kbuild test robot <lkp@intel.com>
    Signed-off-by: Corey Minyard <cminyard@mvista.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a8d2610a4413066faa15b3d47b6342eba4600b19
Author: Eric Dumazet <edumazet@google.com>
Date:   Wed Feb 12 20:58:26 2020 -0800

    net: rtnetlink: fix bugs in rtnl_alt_ifname()
    
    [ Upstream commit 44bfa9c5e5f06c72540273813e4c66beb5a8c213 ]
    
    Since IFLA_ALT_IFNAME is an NLA_STRING, we have no
    guarantee it is nul terminated.
    
    We should use nla_strdup() instead of kstrdup(), since this
    helper will make sure not accessing out-of-bounds data.
    
    BUG: KMSAN: uninit-value in strlen+0x5e/0xa0 lib/string.c:535
    CPU: 1 PID: 19157 Comm: syz-executor.5 Not tainted 5.5.0-rc5-syzkaller #0
    Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
    Call Trace:
     __dump_stack lib/dump_stack.c:77 [inline]
     dump_stack+0x1c9/0x220 lib/dump_stack.c:118
     kmsan_report+0xf7/0x1e0 mm/kmsan/kmsan_report.c:118
     __msan_warning+0x58/0xa0 mm/kmsan/kmsan_instr.c:215
     strlen+0x5e/0xa0 lib/string.c:535
     kstrdup+0x7f/0x1a0 mm/util.c:59
     rtnl_alt_ifname net/core/rtnetlink.c:3495 [inline]
     rtnl_linkprop+0x85d/0xc00 net/core/rtnetlink.c:3553
     rtnl_newlinkprop+0x9d/0xb0 net/core/rtnetlink.c:3568
     rtnetlink_rcv_msg+0x1153/0x1570 net/core/rtnetlink.c:5424
     netlink_rcv_skb+0x451/0x650 net/netlink/af_netlink.c:2477
     rtnetlink_rcv+0x50/0x60 net/core/rtnetlink.c:5442
     netlink_unicast_kernel net/netlink/af_netlink.c:1302 [inline]
     netlink_unicast+0xf9e/0x1100 net/netlink/af_netlink.c:1328
     netlink_sendmsg+0x1248/0x14d0 net/netlink/af_netlink.c:1917
     sock_sendmsg_nosec net/socket.c:639 [inline]
     sock_sendmsg net/socket.c:659 [inline]
     ____sys_sendmsg+0x12b6/0x1350 net/socket.c:2330
     ___sys_sendmsg net/socket.c:2384 [inline]
     __sys_sendmsg+0x451/0x5f0 net/socket.c:2417
     __do_sys_sendmsg net/socket.c:2426 [inline]
     __se_sys_sendmsg+0x97/0xb0 net/socket.c:2424
     __x64_sys_sendmsg+0x4a/0x70 net/socket.c:2424
     do_syscall_64+0xb8/0x160 arch/x86/entry/common.c:296
     entry_SYSCALL_64_after_hwframe+0x44/0xa9
    RIP: 0033:0x45b3b9
    Code: ad b6 fb ff c3 66 2e 0f 1f 84 00 00 00 00 00 66 90 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 0f 83 7b b6 fb ff c3 66 2e 0f 1f 84 00 00 00 00
    RSP: 002b:00007ff1c7b1ac78 EFLAGS: 00000246 ORIG_RAX: 000000000000002e
    RAX: ffffffffffffffda RBX: 00007ff1c7b1b6d4 RCX: 000000000045b3b9
    RDX: 0000000000000000 RSI: 0000000020000040 RDI: 0000000000000003
    RBP: 000000000075bf20 R08: 0000000000000000 R09: 0000000000000000
    R10: 0000000000000000 R11: 0000000000000246 R12: 00000000ffffffff
    R13: 00000000000009cb R14: 00000000004cb3dd R15: 000000000075bf2c
    
    Uninit was created at:
     kmsan_save_stack_with_flags mm/kmsan/kmsan.c:144 [inline]
     kmsan_internal_poison_shadow+0x66/0xd0 mm/kmsan/kmsan.c:127
     kmsan_slab_alloc+0x8a/0xe0 mm/kmsan/kmsan_hooks.c:82
     slab_alloc_node mm/slub.c:2774 [inline]
     __kmalloc_node_track_caller+0xb40/0x1200 mm/slub.c:4382
     __kmalloc_reserve net/core/skbuff.c:141 [inline]
     __alloc_skb+0x2fd/0xac0 net/core/skbuff.c:209
     alloc_skb include/linux/skbuff.h:1049 [inline]
     netlink_alloc_large_skb net/netlink/af_netlink.c:1174 [inline]
     netlink_sendmsg+0x7d3/0x14d0 net/netlink/af_netlink.c:1892
     sock_sendmsg_nosec net/socket.c:639 [inline]
     sock_sendmsg net/socket.c:659 [inline]
     ____sys_sendmsg+0x12b6/0x1350 net/socket.c:2330
     ___sys_sendmsg net/socket.c:2384 [inline]
     __sys_sendmsg+0x451/0x5f0 net/socket.c:2417
     __do_sys_sendmsg net/socket.c:2426 [inline]
     __se_sys_sendmsg+0x97/0xb0 net/socket.c:2424
     __x64_sys_sendmsg+0x4a/0x70 net/socket.c:2424
     do_syscall_64+0xb8/0x160 arch/x86/entry/common.c:296
     entry_SYSCALL_64_after_hwframe+0x44/0xa9
    
    Fixes: 36fbf1e52bd3 ("net: rtnetlink: add linkprop commands to add and delete alternative ifnames")
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Cc: Jiri Pirko <jiri@mellanox.com>
    Reported-by: syzbot <syzkaller@googlegroups.com>
    Reviewed-by: Jiri Pirko <jiri@mellanox.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b1224761fce3899708f2715b5d32aa28ce6c3139
Author: Alexandre Belloni <alexandre.belloni@bootlin.com>
Date:   Wed Feb 19 15:15:51 2020 +0100

    net: macb: Properly handle phylink on at91rm9200
    
    [ Upstream commit ac2fcfa9fd26db67d7000677c05629c34cc94564 ]
    
    at91ether_init was handling the phy mode and speed but since the switch to
    phylink, the NCFGR register got overwritten by macb_mac_config(). The issue
    is that the RM9200_RMII bit and the MACB_CLK_DIV32 field are cleared
    but never restored as they conflict with the PAE, GBE and PCSSEL bits.
    
    Add new capability to differentiate between EMAC and the other versions of
    the IP and use it to set and avoid clearing the relevant bits.
    
    Also, this fixes a NULL pointer dereference in macb_mac_link_up as the EMAC
    doesn't use any rings/bufffers/queues.
    
    Fixes: 7897b071ac3b ("net: macb: convert to phylink")
    Signed-off-by: Alexandre Belloni <alexandre.belloni@bootlin.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 453c6a72ccea37b4d5e14d9fb14a01888ddedfab
Author: Eric Dumazet <edumazet@google.com>
Date:   Fri Feb 14 07:53:53 2020 -0800

    net: add strict checks in netdev_name_node_alt_destroy()
    
    [ Upstream commit e08ad80551b4b33c02f2fce1522f6c227d3976cf ]
    
    netdev_name_node_alt_destroy() does a lookup over all
    device names of a namespace.
    
    We need to make sure the name belongs to the device
    of interest, and that we do not destroy its primary
    name, since we rely on it being not deleted :
    dev->name_node would indeed point to freed memory.
    
    syzbot report was the following :
    
    BUG: KASAN: use-after-free in dev_net include/linux/netdevice.h:2206 [inline]
    BUG: KASAN: use-after-free in mld_force_mld_version net/ipv6/mcast.c:1172 [inline]
    BUG: KASAN: use-after-free in mld_in_v2_mode_only net/ipv6/mcast.c:1180 [inline]
    BUG: KASAN: use-after-free in mld_in_v1_mode+0x203/0x230 net/ipv6/mcast.c:1190
    Read of size 8 at addr ffff88809886c588 by task swapper/1/0
    
    CPU: 1 PID: 0 Comm: swapper/1 Not tainted 5.6.0-rc1-syzkaller #0
    Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
    Call Trace:
     <IRQ>
     __dump_stack lib/dump_stack.c:77 [inline]
     dump_stack+0x197/0x210 lib/dump_stack.c:118
     print_address_description.constprop.0.cold+0xd4/0x30b mm/kasan/report.c:374
     __kasan_report.cold+0x1b/0x32 mm/kasan/report.c:506
     kasan_report+0x12/0x20 mm/kasan/common.c:641
     __asan_report_load8_noabort+0x14/0x20 mm/kasan/generic_report.c:135
     dev_net include/linux/netdevice.h:2206 [inline]
     mld_force_mld_version net/ipv6/mcast.c:1172 [inline]
     mld_in_v2_mode_only net/ipv6/mcast.c:1180 [inline]
     mld_in_v1_mode+0x203/0x230 net/ipv6/mcast.c:1190
     mld_send_initial_cr net/ipv6/mcast.c:2083 [inline]
     mld_dad_timer_expire+0x24/0x230 net/ipv6/mcast.c:2118
     call_timer_fn+0x1ac/0x780 kernel/time/timer.c:1404
     expire_timers kernel/time/timer.c:1449 [inline]
     __run_timers kernel/time/timer.c:1773 [inline]
     __run_timers kernel/time/timer.c:1740 [inline]
     run_timer_softirq+0x6c3/0x1790 kernel/time/timer.c:1786
     __do_softirq+0x262/0x98c kernel/softirq.c:292
     invoke_softirq kernel/softirq.c:373 [inline]
     irq_exit+0x19b/0x1e0 kernel/softirq.c:413
     exiting_irq arch/x86/include/asm/apic.h:546 [inline]
     smp_apic_timer_interrupt+0x1a3/0x610 arch/x86/kernel/apic/apic.c:1146
     apic_timer_interrupt+0xf/0x20 arch/x86/entry/entry_64.S:829
     </IRQ>
    RIP: 0010:native_safe_halt+0xe/0x10 arch/x86/include/asm/irqflags.h:61
    Code: 68 73 c5 f9 eb 8a cc cc cc cc cc cc e9 07 00 00 00 0f 00 2d 94 be 59 00 f4 c3 66 90 e9 07 00 00 00 0f 00 2d 84 be 59 00 fb f4 <c3> cc 55 48 89 e5 41 57 41 56 41 55 41 54 53 e8 de 2a 74 f9 e8 09
    RSP: 0018:ffffc90000d3fd68 EFLAGS: 00000282 ORIG_RAX: ffffffffffffff13
    RAX: 1ffffffff136761a RBX: ffff8880a99fc340 RCX: 0000000000000000
    RDX: dffffc0000000000 RSI: 0000000000000006 RDI: ffff8880a99fcbd4
    RBP: ffffc90000d3fd98 R08: ffff8880a99fc340 R09: 0000000000000000
    R10: 0000000000000000 R11: 0000000000000000 R12: dffffc0000000000
    R13: ffffffff8aa5a1c0 R14: 0000000000000000 R15: 0000000000000001
     arch_cpu_idle+0xa/0x10 arch/x86/kernel/process.c:686
     default_idle_call+0x84/0xb0 kernel/sched/idle.c:94
     cpuidle_idle_call kernel/sched/idle.c:154 [inline]
     do_idle+0x3c8/0x6e0 kernel/sched/idle.c:269
     cpu_startup_entry+0x1b/0x20 kernel/sched/idle.c:361
     start_secondary+0x2f4/0x410 arch/x86/kernel/smpboot.c:264
     secondary_startup_64+0xa4/0xb0 arch/x86/kernel/head_64.S:242
    
    Allocated by task 10229:
     save_stack+0x23/0x90 mm/kasan/common.c:72
     set_track mm/kasan/common.c:80 [inline]
     __kasan_kmalloc mm/kasan/common.c:515 [inline]
     __kasan_kmalloc.constprop.0+0xcf/0xe0 mm/kasan/common.c:488
     kasan_kmalloc+0x9/0x10 mm/kasan/common.c:529
     __do_kmalloc_node mm/slab.c:3616 [inline]
     __kmalloc_node+0x4e/0x70 mm/slab.c:3623
     kmalloc_node include/linux/slab.h:578 [inline]
     kvmalloc_node+0x68/0x100 mm/util.c:574
     kvmalloc include/linux/mm.h:645 [inline]
     kvzalloc include/linux/mm.h:653 [inline]
     alloc_netdev_mqs+0x98/0xe40 net/core/dev.c:9797
     rtnl_create_link+0x22d/0xaf0 net/core/rtnetlink.c:3047
     __rtnl_newlink+0xf9f/0x1790 net/core/rtnetlink.c:3309
     rtnl_newlink+0x69/0xa0 net/core/rtnetlink.c:3377
     rtnetlink_rcv_msg+0x45e/0xaf0 net/core/rtnetlink.c:5438
     netlink_rcv_skb+0x177/0x450 net/netlink/af_netlink.c:2477
     rtnetlink_rcv+0x1d/0x30 net/core/rtnetlink.c:5456
     netlink_unicast_kernel net/netlink/af_netlink.c:1302 [inline]
     netlink_unicast+0x59e/0x7e0 net/netlink/af_netlink.c:1328
     netlink_sendmsg+0x91c/0xea0 net/netlink/af_netlink.c:1917
     sock_sendmsg_nosec net/socket.c:652 [inline]
     sock_sendmsg+0xd7/0x130 net/socket.c:672
     __sys_sendto+0x262/0x380 net/socket.c:1998
     __do_compat_sys_socketcall net/compat.c:771 [inline]
     __se_compat_sys_socketcall net/compat.c:719 [inline]
     __ia32_compat_sys_socketcall+0x530/0x710 net/compat.c:719
     do_syscall_32_irqs_on arch/x86/entry/common.c:337 [inline]
     do_fast_syscall_32+0x27b/0xe16 arch/x86/entry/common.c:408
     entry_SYSENTER_compat+0x70/0x7f arch/x86/entry/entry_64_compat.S:139
    
    Freed by task 10229:
     save_stack+0x23/0x90 mm/kasan/common.c:72
     set_track mm/kasan/common.c:80 [inline]
     kasan_set_free_info mm/kasan/common.c:337 [inline]
     __kasan_slab_free+0x102/0x150 mm/kasan/common.c:476
     kasan_slab_free+0xe/0x10 mm/kasan/common.c:485
     __cache_free mm/slab.c:3426 [inline]
     kfree+0x10a/0x2c0 mm/slab.c:3757
     __netdev_name_node_alt_destroy+0x1ff/0x2a0 net/core/dev.c:322
     netdev_name_node_alt_destroy+0x57/0x80 net/core/dev.c:334
     rtnl_alt_ifname net/core/rtnetlink.c:3518 [inline]
     rtnl_linkprop.isra.0+0x575/0x6f0 net/core/rtnetlink.c:3567
     rtnl_dellinkprop+0x46/0x60 net/core/rtnetlink.c:3588
     rtnetlink_rcv_msg+0x45e/0xaf0 net/core/rtnetlink.c:5438
     netlink_rcv_skb+0x177/0x450 net/netlink/af_netlink.c:2477
     rtnetlink_rcv+0x1d/0x30 net/core/rtnetlink.c:5456
     netlink_unicast_kernel net/netlink/af_netlink.c:1302 [inline]
     netlink_unicast+0x59e/0x7e0 net/netlink/af_netlink.c:1328
     netlink_sendmsg+0x91c/0xea0 net/netlink/af_netlink.c:1917
     sock_sendmsg_nosec net/socket.c:652 [inline]
     sock_sendmsg+0xd7/0x130 net/socket.c:672
     ____sys_sendmsg+0x753/0x880 net/socket.c:2343
     ___sys_sendmsg+0x100/0x170 net/socket.c:2397
     __sys_sendmsg+0x105/0x1d0 net/socket.c:2430
     __compat_sys_sendmsg net/compat.c:642 [inline]
     __do_compat_sys_sendmsg net/compat.c:649 [inline]
     __se_compat_sys_sendmsg net/compat.c:646 [inline]
     __ia32_compat_sys_sendmsg+0x7a/0xb0 net/compat.c:646
     do_syscall_32_irqs_on arch/x86/entry/common.c:337 [inline]
     do_fast_syscall_32+0x27b/0xe16 arch/x86/entry/common.c:408
     entry_SYSENTER_compat+0x70/0x7f arch/x86/entry/entry_64_compat.S:139
    
    The buggy address belongs to the object at ffff88809886c000
     which belongs to the cache kmalloc-4k of size 4096
    The buggy address is located 1416 bytes inside of
     4096-byte region [ffff88809886c000, ffff88809886d000)
    The buggy address belongs to the page:
    page:ffffea0002621b00 refcount:1 mapcount:0 mapping:ffff8880aa402000 index:0x0 compound_mapcount: 0
    flags: 0xfffe0000010200(slab|head)
    raw: 00fffe0000010200 ffffea0002610d08 ffffea0002607608 ffff8880aa402000
    raw: 0000000000000000 ffff88809886c000 0000000100000001 0000000000000000
    page dumped because: kasan: bad access detected
    
    Memory state around the buggy address:
     ffff88809886c480: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
     ffff88809886c500: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
    >ffff88809886c580: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
                          ^
     ffff88809886c600: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
     ffff88809886c680: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
    
    Fixes: 36fbf1e52bd3 ("net: rtnetlink: add linkprop commands to add and delete alternative ifnames")
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Reported-by: syzbot <syzkaller@googlegroups.com>
    Cc: Jiri Pirko <jiri@mellanox.com>
    Acked-by: Jiri Pirko <jiri@mellanox.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 62fb796c55cc7966fc0b5459cd2896c804369df9
Author: Shannon Nelson <snelson@pensando.io>
Date:   Wed Feb 19 14:59:42 2020 -0800

    ionic: fix fw_status read
    
    [ Upstream commit 68b759a75d6257759d1e37ff13f2d0659baf1112 ]
    
    The fw_status field is only 8 bits, so fix the read.  Also,
    we only want to look at the one status bit, to allow for future
    use of the other bits, and watch for a bad PCI read.
    
    Fixes: 97ca486592c0 ("ionic: add heartbeat check")
    Signed-off-by: Shannon Nelson <snelson@pensando.io>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fa07a0ad5f5f750771931a668f8fdc8a620aff96
Author: Benjamin Poirier <bpoirier@cumulusnetworks.com>
Date:   Wed Feb 12 10:41:07 2020 +0900

    ipv6: Fix nlmsg_flags when splitting a multipath route
    
    [ Upstream commit afecdb376bd81d7e16578f0cfe82a1aec7ae18f3 ]
    
    When splitting an RTA_MULTIPATH request into multiple routes and adding the
    second and later components, we must not simply remove NLM_F_REPLACE but
    instead replace it by NLM_F_CREATE. Otherwise, it may look like the netlink
    message was malformed.
    
    For example,
            ip route add 2001:db8::1/128 dev dummy0
            ip route change 2001:db8::1/128 nexthop via fe80::30:1 dev dummy0 \
                    nexthop via fe80::30:2 dev dummy0
    results in the following warnings:
    [ 1035.057019] IPv6: RTM_NEWROUTE with no NLM_F_CREATE or NLM_F_REPLACE
    [ 1035.057517] IPv6: NLM_F_CREATE should be set when creating new route
    
    This patch makes the nlmsg sequence look equivalent for __ip6_ins_rt() to
    what it would get if the multipath route had been added in multiple netlink
    operations:
            ip route add 2001:db8::1/128 dev dummy0
            ip route change 2001:db8::1/128 nexthop via fe80::30:1 dev dummy0
            ip route append 2001:db8::1/128 nexthop via fe80::30:2 dev dummy0
    
    Fixes: 27596472473a ("ipv6: fix ECMP route replacement")
    Signed-off-by: Benjamin Poirier <bpoirier@cumulusnetworks.com>
    Reviewed-by: Michal Kubecek <mkubecek@suse.cz>
    Reviewed-by: David Ahern <dsahern@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 364aa44adc18040f09b3fefda7e1c7199179c3b1
Author: Benjamin Poirier <bpoirier@cumulusnetworks.com>
Date:   Wed Feb 12 10:41:06 2020 +0900

    ipv6: Fix route replacement with dev-only route
    
    [ Upstream commit e404b8c7cfb31654c9024d497cec58a501501692 ]
    
    After commit 27596472473a ("ipv6: fix ECMP route replacement") it is no
    longer possible to replace an ECMP-able route by a non ECMP-able route.
    For example,
            ip route add 2001:db8::1/128 via fe80::1 dev dummy0
            ip route replace 2001:db8::1/128 dev dummy0
    does not work as expected.
    
    Tweak the replacement logic so that point 3 in the log of the above commit
    becomes:
    3. If the new route is not ECMP-able, and no matching non-ECMP-able route
    exists, replace matching ECMP-able route (if any) or add the new route.
    
    We can now summarize the entire replace semantics to:
    When doing a replace, prefer replacing a matching route of the same
    "ECMP-able-ness" as the replace argument. If there is no such candidate,
    fallback to the first route found.
    
    Fixes: 27596472473a ("ipv6: fix ECMP route replacement")
    Signed-off-by: Benjamin Poirier <bpoirier@cumulusnetworks.com>
    Reviewed-by: Michal Kubecek <mkubecek@suse.cz>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2a8c1dc105c0d28a2365fcf16c5c9d2317f2a7f1
Author: Taehee Yoo <ap420073@gmail.com>
Date:   Sat Feb 15 10:50:40 2020 +0000

    bonding: fix lockdep warning in bond_get_stats()
    
    [ Upstream commit b3e80d44f5b1b470dd9e2dbc6816e63a5c519709 ]
    
    In the "struct bonding", there is stats_lock.
    This lock protects "bond_stats" in the "struct bonding".
    bond_stats is updated in the bond_get_stats() and this function would be
    executed concurrently. So, the lock is needed.
    
    Bonding interfaces would be nested.
    So, either stats_lock should use dynamic lockdep class key or stats_lock
    should be used by spin_lock_nested(). In the current code, stats_lock is
    using a dynamic lockdep class key.
    But there is no updating stats_lock_key routine So, lockdep warning
    will occur.
    
    Test commands:
        ip link add bond0 type bond
        ip link add bond1 type bond
        ip link set bond0 master bond1
        ip link set bond0 nomaster
        ip link set bond1 master bond0
    
    Splat looks like:
    [   38.420603][  T957] 5.5.0+ #394 Not tainted
    [   38.421074][  T957] ------------------------------------------------------
    [   38.421837][  T957] ip/957 is trying to acquire lock:
    [   38.422399][  T957] ffff888063262cd8 (&bond->stats_lock_key#2){+.+.}, at: bond_get_stats+0x90/0x4d0 [bonding]
    [   38.423528][  T957]
    [   38.423528][  T957] but task is already holding lock:
    [   38.424526][  T957] ffff888065fd2cd8 (&bond->stats_lock_key){+.+.}, at: bond_get_stats+0x90/0x4d0 [bonding]
    [   38.426075][  T957]
    [   38.426075][  T957] which lock already depends on the new lock.
    [   38.426075][  T957]
    [   38.428536][  T957]
    [   38.428536][  T957] the existing dependency chain (in reverse order) is:
    [   38.429475][  T957]
    [   38.429475][  T957] -> #1 (&bond->stats_lock_key){+.+.}:
    [   38.430273][  T957]        _raw_spin_lock+0x30/0x70
    [   38.430812][  T957]        bond_get_stats+0x90/0x4d0 [bonding]
    [   38.431451][  T957]        dev_get_stats+0x1ec/0x270
    [   38.432088][  T957]        bond_get_stats+0x1a5/0x4d0 [bonding]
    [   38.432767][  T957]        dev_get_stats+0x1ec/0x270
    [   38.433322][  T957]        rtnl_fill_stats+0x44/0xbe0
    [   38.433866][  T957]        rtnl_fill_ifinfo+0xeb2/0x3720
    [   38.434474][  T957]        rtmsg_ifinfo_build_skb+0xca/0x170
    [   38.435081][  T957]        rtmsg_ifinfo_event.part.33+0x1b/0xb0
    [   38.436848][  T957]        rtnetlink_event+0xcd/0x120
    [   38.437455][  T957]        notifier_call_chain+0x90/0x160
    [   38.438067][  T957]        netdev_change_features+0x74/0xa0
    [   38.438708][  T957]        bond_compute_features.isra.45+0x4e6/0x6f0 [bonding]
    [   38.439522][  T957]        bond_enslave+0x3639/0x47b0 [bonding]
    [   38.440225][  T957]        do_setlink+0xaab/0x2ef0
    [   38.440786][  T957]        __rtnl_newlink+0x9c5/0x1270
    [   38.441463][  T957]        rtnl_newlink+0x65/0x90
    [   38.442075][  T957]        rtnetlink_rcv_msg+0x4a8/0x890
    [   38.442774][  T957]        netlink_rcv_skb+0x121/0x350
    [   38.443451][  T957]        netlink_unicast+0x42e/0x610
    [   38.444282][  T957]        netlink_sendmsg+0x65a/0xb90
    [   38.444992][  T957]        ____sys_sendmsg+0x5ce/0x7a0
    [   38.445679][  T957]        ___sys_sendmsg+0x10f/0x1b0
    [   38.446365][  T957]        __sys_sendmsg+0xc6/0x150
    [   38.447007][  T957]        do_syscall_64+0x99/0x4f0
    [   38.447668][  T957]        entry_SYSCALL_64_after_hwframe+0x49/0xbe
    [   38.448538][  T957]
    [   38.448538][  T957] -> #0 (&bond->stats_lock_key#2){+.+.}:
    [   38.449554][  T957]        __lock_acquire+0x2d8d/0x3de0
    [   38.450148][  T957]        lock_acquire+0x164/0x3b0
    [   38.450711][  T957]        _raw_spin_lock+0x30/0x70
    [   38.451292][  T957]        bond_get_stats+0x90/0x4d0 [bonding]
    [   38.451950][  T957]        dev_get_stats+0x1ec/0x270
    [   38.452425][  T957]        bond_get_stats+0x1a5/0x4d0 [bonding]
    [   38.453362][  T957]        dev_get_stats+0x1ec/0x270
    [   38.453825][  T957]        rtnl_fill_stats+0x44/0xbe0
    [   38.454390][  T957]        rtnl_fill_ifinfo+0xeb2/0x3720
    [   38.456257][  T957]        rtmsg_ifinfo_build_skb+0xca/0x170
    [   38.456998][  T957]        rtmsg_ifinfo_event.part.33+0x1b/0xb0
    [   38.459351][  T957]        rtnetlink_event+0xcd/0x120
    [   38.460086][  T957]        notifier_call_chain+0x90/0x160
    [   38.460829][  T957]        netdev_change_features+0x74/0xa0
    [   38.461752][  T957]        bond_compute_features.isra.45+0x4e6/0x6f0 [bonding]
    [   38.462705][  T957]        bond_enslave+0x3639/0x47b0 [bonding]
    [   38.463476][  T957]        do_setlink+0xaab/0x2ef0
    [   38.464141][  T957]        __rtnl_newlink+0x9c5/0x1270
    [   38.464897][  T957]        rtnl_newlink+0x65/0x90
    [   38.465522][  T957]        rtnetlink_rcv_msg+0x4a8/0x890
    [   38.466215][  T957]        netlink_rcv_skb+0x121/0x350
    [   38.466895][  T957]        netlink_unicast+0x42e/0x610
    [   38.467583][  T957]        netlink_sendmsg+0x65a/0xb90
    [   38.468285][  T957]        ____sys_sendmsg+0x5ce/0x7a0
    [   38.469202][  T957]        ___sys_sendmsg+0x10f/0x1b0
    [   38.469884][  T957]        __sys_sendmsg+0xc6/0x150
    [   38.470587][  T957]        do_syscall_64+0x99/0x4f0
    [   38.471245][  T957]        entry_SYSCALL_64_after_hwframe+0x49/0xbe
    [   38.472093][  T957]
    [   38.472093][  T957] other info that might help us debug this:
    [   38.472093][  T957]
    [   38.473438][  T957]  Possible unsafe locking scenario:
    [   38.473438][  T957]
    [   38.474898][  T957]        CPU0                    CPU1
    [   38.476234][  T957]        ----                    ----
    [   38.480171][  T957]   lock(&bond->stats_lock_key);
    [   38.480808][  T957]                                lock(&bond->stats_lock_key#2);
    [   38.481791][  T957]                                lock(&bond->stats_lock_key);
    [   38.482754][  T957]   lock(&bond->stats_lock_key#2);
    [   38.483416][  T957]
    [   38.483416][  T957]  *** DEADLOCK ***
    [   38.483416][  T957]
    [   38.484505][  T957] 3 locks held by ip/957:
    [   38.485048][  T957]  #0: ffffffffbccf6230 (rtnl_mutex){+.+.}, at: rtnetlink_rcv_msg+0x457/0x890
    [   38.486198][  T957]  #1: ffff888065fd2cd8 (&bond->stats_lock_key){+.+.}, at: bond_get_stats+0x90/0x4d0 [bonding]
    [   38.487625][  T957]  #2: ffffffffbc9254c0 (rcu_read_lock){....}, at: bond_get_stats+0x5/0x4d0 [bonding]
    [   38.488897][  T957]
    [   38.488897][  T957] stack backtrace:
    [   38.489646][  T957] CPU: 1 PID: 957 Comm: ip Not tainted 5.5.0+ #394
    [   38.490497][  T957] Hardware name: innotek GmbH VirtualBox/VirtualBox, BIOS VirtualBox 12/01/2006
    [   38.492810][  T957] Call Trace:
    [   38.493219][  T957]  dump_stack+0x96/0xdb
    [   38.493709][  T957]  check_noncircular+0x371/0x450
    [   38.494344][  T957]  ? lookup_address+0x60/0x60
    [   38.494923][  T957]  ? print_circular_bug.isra.35+0x310/0x310
    [   38.495699][  T957]  ? hlock_class+0x130/0x130
    [   38.496334][  T957]  ? __lock_acquire+0x2d8d/0x3de0
    [   38.496979][  T957]  __lock_acquire+0x2d8d/0x3de0
    [   38.497607][  T957]  ? register_lock_class+0x14d0/0x14d0
    [   38.498333][  T957]  ? check_chain_key+0x236/0x5d0
    [   38.499003][  T957]  lock_acquire+0x164/0x3b0
    [   38.499800][  T957]  ? bond_get_stats+0x90/0x4d0 [bonding]
    [   38.500706][  T957]  _raw_spin_lock+0x30/0x70
    [   38.501435][  T957]  ? bond_get_stats+0x90/0x4d0 [bonding]
    [   38.502311][  T957]  bond_get_stats+0x90/0x4d0 [bonding]
    [ ... ]
    
    But, there is another problem.
    The dynamic lockdep class key is protected by RTNL, but bond_get_stats()
    would be called outside of RTNL.
    So, it would use an invalid dynamic lockdep class key.
    
    In order to fix this issue, stats_lock uses spin_lock_nested() instead of
    a dynamic lockdep key.
    The bond_get_stats() calls bond_get_lowest_level_rcu() to get the correct
    nest level value, which will be used by spin_lock_nested().
    The "dev->lower_level" indicates lower nest level value, but this value
    is invalid outside of RTNL.
    So, bond_get_lowest_level_rcu() returns valid lower nest level value in
    the RCU critical section.
    bond_get_lowest_level_rcu() will be work only when LOCKDEP is enabled.
    
    Fixes: 089bca2caed0 ("bonding: use dynamic lockdep key instead of subclass")
    Signed-off-by: Taehee Yoo <ap420073@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e1f582d8bb94d849932d6d8aa138691c196096c7
Author: Taehee Yoo <ap420073@gmail.com>
Date:   Sat Feb 15 10:50:21 2020 +0000

    net: export netdev_next_lower_dev_rcu()
    
    [ Upstream commit 7151affeef8d527f50b4b68a871fd28bd660023f ]
    
    netdev_next_lower_dev_rcu() will be used to implement a function,
    which is to walk all lower interfaces.
    There are already functions that they walk their lower interface.
    (netdev_walk_all_lower_dev_rcu, netdev_walk_all_lower_dev()).
    But, there would be cases that couldn't be covered by given
    netdev_walk_all_lower_dev_{rcu}() function.
    So, some modules would want to implement own function,
    which is to walk all lower interfaces.
    
    In the next patch, netdev_next_lower_dev_rcu() will be used.
    In addition, this patch removes two unused prototypes in netdevice.h.
    
    Signed-off-by: Taehee Yoo <ap420073@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4a3ce9e0d2e770c5955ba6a0db8743d610e3b4fb
Author: Taehee Yoo <ap420073@gmail.com>
Date:   Sat Feb 15 10:50:08 2020 +0000

    bonding: add missing netdev_update_lockdep_key()
    
    [ Upstream commit 064ff66e2bef84f1153087612032b5b9eab005bd ]
    
    After bond_release(), netdev_update_lockdep_key() should be called.
    But both ioctl path and attribute path don't call
    netdev_update_lockdep_key().
    This patch adds missing netdev_update_lockdep_key().
    
    Test commands:
        ip link add bond0 type bond
        ip link add bond1 type bond
        ifenslave bond0 bond1
        ifenslave -d bond0 bond1
        ifenslave bond1 bond0
    
    Splat looks like:
    [   29.501182][ T1046] WARNING: possible circular locking dependency detected
    [   29.501945][ T1039] hardirqs last disabled at (1962): [<ffffffffac6c807f>] handle_mm_fault+0x13f/0x700
    [   29.503442][ T1046] 5.5.0+ #322 Not tainted
    [   29.503447][ T1046] ------------------------------------------------------
    [   29.504277][ T1039] softirqs last  enabled at (1180): [<ffffffffade00678>] __do_softirq+0x678/0x981
    [   29.505443][ T1046] ifenslave/1046 is trying to acquire lock:
    [   29.505886][ T1039] softirqs last disabled at (1169): [<ffffffffac19c18a>] irq_exit+0x17a/0x1a0
    [   29.509997][ T1046] ffff88805d5da280 (&dev->addr_list_lock_key#3){+...}, at: dev_mc_sync_multiple+0x95/0x120
    [   29.511243][ T1046]
    [   29.511243][ T1046] but task is already holding lock:
    [   29.512192][ T1046] ffff8880460f2280 (&dev->addr_list_lock_key#4){+...}, at: bond_enslave+0x4482/0x47b0 [bonding]
    [   29.514124][ T1046]
    [   29.514124][ T1046] which lock already depends on the new lock.
    [   29.514124][ T1046]
    [   29.517297][ T1046]
    [   29.517297][ T1046] the existing dependency chain (in reverse order) is:
    [   29.518231][ T1046]
    [   29.518231][ T1046] -> #1 (&dev->addr_list_lock_key#4){+...}:
    [   29.519076][ T1046]        _raw_spin_lock+0x30/0x70
    [   29.519588][ T1046]        dev_mc_sync_multiple+0x95/0x120
    [   29.520208][ T1046]        bond_enslave+0x448d/0x47b0 [bonding]
    [   29.520862][ T1046]        bond_option_slaves_set+0x1a3/0x370 [bonding]
    [   29.521640][ T1046]        __bond_opt_set+0x1ff/0xbb0 [bonding]
    [   29.522438][ T1046]        __bond_opt_set_notify+0x2b/0xf0 [bonding]
    [   29.523251][ T1046]        bond_opt_tryset_rtnl+0x92/0xf0 [bonding]
    [   29.524082][ T1046]        bonding_sysfs_store_option+0x8a/0xf0 [bonding]
    [   29.524959][ T1046]        kernfs_fop_write+0x276/0x410
    [   29.525620][ T1046]        vfs_write+0x197/0x4a0
    [   29.526218][ T1046]        ksys_write+0x141/0x1d0
    [   29.526818][ T1046]        do_syscall_64+0x99/0x4f0
    [   29.527430][ T1046]        entry_SYSCALL_64_after_hwframe+0x49/0xbe
    [   29.528265][ T1046]
    [   29.528265][ T1046] -> #0 (&dev->addr_list_lock_key#3){+...}:
    [   29.529272][ T1046]        __lock_acquire+0x2d8d/0x3de0
    [   29.529935][ T1046]        lock_acquire+0x164/0x3b0
    [   29.530638][ T1046]        _raw_spin_lock+0x30/0x70
    [   29.531187][ T1046]        dev_mc_sync_multiple+0x95/0x120
    [   29.531790][ T1046]        bond_enslave+0x448d/0x47b0 [bonding]
    [   29.532451][ T1046]        bond_option_slaves_set+0x1a3/0x370 [bonding]
    [   29.533163][ T1046]        __bond_opt_set+0x1ff/0xbb0 [bonding]
    [   29.533789][ T1046]        __bond_opt_set_notify+0x2b/0xf0 [bonding]
    [   29.534595][ T1046]        bond_opt_tryset_rtnl+0x92/0xf0 [bonding]
    [   29.535500][ T1046]        bonding_sysfs_store_option+0x8a/0xf0 [bonding]
    [   29.536379][ T1046]        kernfs_fop_write+0x276/0x410
    [   29.537057][ T1046]        vfs_write+0x197/0x4a0
    [   29.537640][ T1046]        ksys_write+0x141/0x1d0
    [   29.538251][ T1046]        do_syscall_64+0x99/0x4f0
    [   29.538870][ T1046]        entry_SYSCALL_64_after_hwframe+0x49/0xbe
    [   29.539659][ T1046]
    [   29.539659][ T1046] other info that might help us debug this:
    [   29.539659][ T1046]
    [   29.540953][ T1046]  Possible unsafe locking scenario:
    [   29.540953][ T1046]
    [   29.541883][ T1046]        CPU0                    CPU1
    [   29.542540][ T1046]        ----                    ----
    [   29.543209][ T1046]   lock(&dev->addr_list_lock_key#4);
    [   29.543880][ T1046]                                lock(&dev->addr_list_lock_key#3);
    [   29.544873][ T1046]                                lock(&dev->addr_list_lock_key#4);
    [   29.545863][ T1046]   lock(&dev->addr_list_lock_key#3);
    [   29.546525][ T1046]
    [   29.546525][ T1046]  *** DEADLOCK ***
    [   29.546525][ T1046]
    [   29.547542][ T1046] 5 locks held by ifenslave/1046:
    [   29.548196][ T1046]  #0: ffff88806044c478 (sb_writers#5){.+.+}, at: vfs_write+0x3bb/0x4a0
    [   29.549248][ T1046]  #1: ffff88805af00890 (&of->mutex){+.+.}, at: kernfs_fop_write+0x1cf/0x410
    [   29.550343][ T1046]  #2: ffff88805b8b54b0 (kn->count#157){.+.+}, at: kernfs_fop_write+0x1f2/0x410
    [   29.551575][ T1046]  #3: ffffffffaecf4cf0 (rtnl_mutex){+.+.}, at: bond_opt_tryset_rtnl+0x5f/0xf0 [bonding]
    [   29.552819][ T1046]  #4: ffff8880460f2280 (&dev->addr_list_lock_key#4){+...}, at: bond_enslave+0x4482/0x47b0 [bonding]
    [   29.554175][ T1046]
    [   29.554175][ T1046] stack backtrace:
    [   29.554907][ T1046] CPU: 0 PID: 1046 Comm: ifenslave Not tainted 5.5.0+ #322
    [   29.555854][ T1046] Hardware name: innotek GmbH VirtualBox/VirtualBox, BIOS VirtualBox 12/01/2006
    [   29.557064][ T1046] Call Trace:
    [   29.557504][ T1046]  dump_stack+0x96/0xdb
    [   29.558054][ T1046]  check_noncircular+0x371/0x450
    [   29.558723][ T1046]  ? print_circular_bug.isra.35+0x310/0x310
    [   29.559486][ T1046]  ? hlock_class+0x130/0x130
    [   29.560100][ T1046]  ? __lock_acquire+0x2d8d/0x3de0
    [   29.560761][ T1046]  __lock_acquire+0x2d8d/0x3de0
    [   29.561366][ T1046]  ? register_lock_class+0x14d0/0x14d0
    [   29.562045][ T1046]  ? find_held_lock+0x39/0x1d0
    [   29.562641][ T1046]  lock_acquire+0x164/0x3b0
    [   29.563199][ T1046]  ? dev_mc_sync_multiple+0x95/0x120
    [   29.563872][ T1046]  _raw_spin_lock+0x30/0x70
    [   29.564464][ T1046]  ? dev_mc_sync_multiple+0x95/0x120
    [   29.565146][ T1046]  dev_mc_sync_multiple+0x95/0x120
    [   29.565793][ T1046]  bond_enslave+0x448d/0x47b0 [bonding]
    [   29.566487][ T1046]  ? bond_update_slave_arr+0x940/0x940 [bonding]
    [   29.567279][ T1046]  ? bstr_printf+0xc20/0xc20
    [   29.567857][ T1046]  ? stack_trace_consume_entry+0x160/0x160
    [   29.568614][ T1046]  ? deactivate_slab.isra.77+0x2c5/0x800
    [   29.569320][ T1046]  ? check_chain_key+0x236/0x5d0
    [   29.569939][ T1046]  ? sscanf+0x93/0xc0
    [   29.570442][ T1046]  ? vsscanf+0x1e20/0x1e20
    [   29.571003][ T1046]  bond_option_slaves_set+0x1a3/0x370 [bonding]
    [ ... ]
    
    Fixes: ab92d68fc22f ("net: core: add generic lockdep keys")
    Signed-off-by: Taehee Yoo <ap420073@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a57313078778c65adbf8f6a3fd5cdfc8886b2a23
Author: Vasundhara Volam <vasundhara-v.volam@broadcom.com>
Date:   Thu Feb 20 17:26:35 2020 -0500

    bnxt_en: Issue PCIe FLR in kdump kernel to cleanup pending DMAs.
    
    [ Upstream commit 8743db4a9acfd51f805ac0c87bcaae92c42d1061 ]
    
    If crashed kernel does not shutdown the NIC properly, PCIe FLR
    is required in the kdump kernel in order to initialize all the
    functions properly.
    
    Fixes: d629522e1d66 ("bnxt_en: Reduce memory usage when running in kdump kernel.")
    Signed-off-by: Vasundhara Volam <vasundhara-v.volam@broadcom.com>
    Signed-off-by: Michael Chan <michael.chan@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d8b24115f1fdf42ec688f6d11e6092d2cd246f72
Author: Vasundhara Volam <vasundhara-v.volam@broadcom.com>
Date:   Thu Feb 20 17:26:34 2020 -0500

    bnxt_en: Improve device shutdown method.
    
    [ Upstream commit 5567ae4a8d569d996d0d88d0eceb76205e4c7ce5 ]
    
    Especially when bnxt_shutdown() is called during kexec, we need to
    disable MSIX and disable Bus Master to completely quiesce the device.
    Make these 2 calls unconditionally in the shutdown method.
    
    Fixes: c20dc142dd7b ("bnxt_en: Disable bus master during PCI shutdown and driver unload.")
    Signed-off-by: Vasundhara Volam <vasundhara-v.volam@broadcom.com>
    Signed-off-by: Michael Chan <michael.chan@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 04f1991d9ca964cca75dd365d40486b4a37faa3a
Author: Xin Long <lucien.xin@gmail.com>
Date:   Tue Feb 18 12:07:53 2020 +0800

    sctp: move the format error check out of __sctp_sf_do_9_1_abort
    
    [ Upstream commit 245709ec8be89af46ea7ef0444c9c80913999d99 ]
    
    When T2 timer is to be stopped, the asoc should also be deleted,
    otherwise, there will be no chance to call sctp_association_free
    and the asoc could last in memory forever.
    
    However, in sctp_sf_shutdown_sent_abort(), after adding the cmd
    SCTP_CMD_TIMER_STOP for T2 timer, it may return error due to the
    format error from __sctp_sf_do_9_1_abort() and miss adding
    SCTP_CMD_ASSOC_FAILED where the asoc will be deleted.
    
    This patch is to fix it by moving the format error check out of
    __sctp_sf_do_9_1_abort(), and do it before adding the cmd
    SCTP_CMD_TIMER_STOP for T2 timer.
    
    Thanks Hangbin for reporting this issue by the fuzz testing.
    
    v1->v2:
      - improve the comment in the code as Marcelo's suggestion.
    
    Fixes: 96ca468b86b0 ("sctp: check invalid value of length parameter in error cause")
    Reported-by: Hangbin Liu <liuhangbin@gmail.com>
    Acked-by: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>
    Signed-off-by: Xin Long <lucien.xin@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c6ed56cd0b1c9610d7ec61e4cf2f26231526e5a9
Author: Willem de Bruijn <willemb@google.com>
Date:   Wed Feb 19 14:16:32 2020 -0500

    udp: rehash on disconnect
    
    [ Upstream commit 303d0403b8c25e994e4a6e45389e173cf8706fb5 ]
    
    As of the below commit, udp sockets bound to a specific address can
    coexist with one bound to the any addr for the same port.
    
    The commit also phased out the use of socket hashing based only on
    port (hslot), in favor of always hashing on {addr, port} (hslot2).
    
    The change broke the following behavior with disconnect (AF_UNSPEC):
    
        server binds to 0.0.0.0:1337
        server connects to 127.0.0.1:80
        server disconnects
        client connects to 127.0.0.1:1337
        client sends "hello"
        server reads "hello"        // times out, packet did not find sk
    
    On connect the server acquires a specific source addr suitable for
    routing to its destination. On disconnect it reverts to the any addr.
    
    The connect call triggers a rehash to a different hslot2. On
    disconnect, add the same to return to the original hslot2.
    
    Skip this step if the socket is going to be unhashed completely.
    
    Fixes: 4cdeeee9252a ("net: udp: prefer listeners bound to an address")
    Reported-by: Pavel Roskin <plroskin@gmail.com>
    Signed-off-by: Willem de Bruijn <willemb@google.com>
    Reviewed-by: Eric Dumazet <edumazet@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5a7c6c4402b81088c80acf15d48276a1aa771ae6
Author: Paolo Abeni <pabeni@redhat.com>
Date:   Tue Feb 18 18:15:44 2020 +0100

    Revert "net: dev: introduce support for sch BYPASS for lockless qdisc"
    
    [ Upstream commit 379349e9bc3b42b8b2f8f7a03f64a97623fff323 ]
    
    This reverts commit ba27b4cdaaa66561aaedb2101876e563738d36fe
    
    Ahmed reported ouf-of-order issues bisected to commit ba27b4cdaaa6
    ("net: dev: introduce support for sch BYPASS for lockless qdisc").
    I can't find any working solution other than a plain revert.
    
    This will introduce some minor performance regressions for
    pfifo_fast qdisc. I plan to address them in net-next with more
    indirect call wrapper boilerplate for qdiscs.
    
    Reported-by: Ahmad Fatoum <a.fatoum@pengutronix.de>
    Fixes: ba27b4cdaaa6 ("net: dev: introduce support for sch BYPASS for lockless qdisc")
    Signed-off-by: Paolo Abeni <pabeni@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 85098275e56dc47e61382097c0e9519e65df1f5d
Author: Michal Kalderon <michal.kalderon@marvell.com>
Date:   Mon Feb 17 13:37:18 2020 +0200

    qede: Fix race between rdma destroy workqueue and link change event
    
    [ Upstream commit af6565adb02d3129d3fae4d9d5da945abaf4417a ]
    
    If an event is added while the rdma workqueue is being destroyed
    it could lead to several races, list corruption, null pointer
    dereference during queue_work or init_queue.
    This fixes the race between the two flows which can occur during
    shutdown.
    
    A kref object and a completion object are added to the rdma_dev
    structure, these are initialized before the workqueue is created.
    The refcnt is used to indicate work is being added to the
    workqueue and ensures the cleanup flow won't start while we're in
    the middle of adding the event.
    Once the work is added, the refcnt is decreased and the cleanup flow
    is safe to run.
    
    Fixes: cee9fbd8e2e ("qede: Add qedr framework")
    Signed-off-by: Ariel Elior <ariel.elior@marvell.com>
    Signed-off-by: Michal Kalderon <michal.kalderon@marvell.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2ca12c1c8a07206ccc85c67626d1a808ccfd39e1
Author: Dmitry Osipenko <digetx@gmail.com>
Date:   Wed Feb 19 18:01:22 2020 +0300

    nfc: pn544: Fix occasional HW initialization failure
    
    [ Upstream commit c3331d2fe3fd4d5e321f2467d01f72de7edfb5d0 ]
    
    The PN544 driver checks the "enable" polarity during of driver's probe and
    it's doing that by turning ON and OFF NFC with different polarities until
    enabling succeeds. It takes some time for the hardware to power-down, and
    thus, to deassert the IRQ that is raised by turning ON the hardware.
    Since the delay after last power-down of the polarity-checking process is
    missed in the code, the interrupt may trigger immediately after installing
    the IRQ handler (right after the checking is done), which results in IRQ
    handler trying to touch the disabled HW and ends with marking NFC as
    'DEAD' during of the driver's probe:
    
      pn544_hci_i2c 1-002a: NFC: nfc_en polarity : active high
      pn544_hci_i2c 1-002a: NFC: invalid len byte
      shdlc: llc_shdlc_recv_frame: NULL Frame -> link is dead
    
    This patch fixes the occasional NFC initialization failure on Nexus 7
    device.
    
    Signed-off-by: Dmitry Osipenko <digetx@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2d6f0a339ff7cac30451d552fe9757b8d67afbd6
Author: Rohit Maheshwari <rohitm@chelsio.com>
Date:   Wed Feb 19 09:40:22 2020 +0530

    net/tls: Fix to avoid gettig invalid tls record
    
    [ Upstream commit 06f5201c6392f998a49ca9c9173e2930c8eb51d8 ]
    
    Current code doesn't check if tcp sequence number is starting from (/after)
    1st record's start sequnce number. It only checks if seq number is before
    1st record's end sequnce number. This problem will always be a possibility
    in re-transmit case. If a record which belongs to a requested seq number is
    already deleted, tls_get_record will start looking into list and as per the
    check it will look if seq number is before the end seq of 1st record, which
    will always be true and will return 1st record always, it should in fact
    return NULL.
    As part of the fix, start looking each record only if the sequence number
    lies in the list else return NULL.
    There is one more check added, driver look for the start marker record to
    handle tcp packets which are before the tls offload start sequence number,
    hence return 1st record if the record is tls start marker and seq number is
    before the 1st record's starting sequence number.
    
    Fixes: e8f69799810c ("net/tls: Add generic NIC offload infrastructure")
    Signed-off-by: Rohit Maheshwari <rohitm@chelsio.com>
    Reviewed-by: Jakub Kicinski <kuba@kernel.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b1ae7c2e5af86dc3b29340fe6c34138d4a256877
Author: Jason Baron <jbaron@akamai.com>
Date:   Mon Feb 17 15:38:09 2020 -0500

    net: sched: correct flower port blocking
    
    [ Upstream commit 8a9093c79863b58cc2f9874d7ae788f0d622a596 ]
    
    tc flower rules that are based on src or dst port blocking are sometimes
    ineffective due to uninitialized stack data. __skb_flow_dissect() extracts
    ports from the skb for tc flower to match against. However, the port
    dissection is not done when when the FLOW_DIS_IS_FRAGMENT bit is set in
    key_control->flags. All callers of __skb_flow_dissect(), zero-out the
    key_control field except for fl_classify() as used by the flower
    classifier. Thus, the FLOW_DIS_IS_FRAGMENT may be set on entry to
    __skb_flow_dissect(), since key_control is allocated on the stack
    and may not be initialized.
    
    Since key_basic and key_control are present for all flow keys, let's
    make sure they are initialized.
    
    Fixes: 62230715fd24 ("flow_dissector: do not dissect l4 ports for fragments")
    Co-developed-by: Eric Dumazet <edumazet@google.com>
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Acked-by: Cong Wang <xiyou.wangcong@gmail.com>
    Signed-off-by: Jason Baron <jbaron@akamai.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1f9634875c3ed519823a6151df1a8f7c277d51b7
Author: Arun Parameswaran <arun.parameswaran@broadcom.com>
Date:   Fri Feb 14 13:47:46 2020 -0800

    net: phy: restore mdio regs in the iproc mdio driver
    
    commit 6f08e98d62799e53c89dbf2c9a49d77e20ca648c upstream.
    
    The mii management register in iproc mdio block
    does not have a retention register so it is lost on suspend.
    Save and restore value of register while resuming from suspend.
    
    Fixes: bb1a619735b4 ("net: phy: Initialize mdio clock at probe function")
    Signed-off-by: Arun Parameswaran <arun.parameswaran@broadcom.com>
    Signed-off-by: Scott Branden <scott.branden@broadcom.com>
    Reviewed-by: Andrew Lunn <andrew@lunn.ch>
    Reviewed-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cf7a483b433aacca3eb5f2746c513f09e7ae6462
Author: Horatiu Vultur <horatiu.vultur@microchip.com>
Date:   Mon Feb 17 09:31:33 2020 +0100

    net: mscc: fix in frame extraction
    
    [ Upstream commit a81541041ceb55bcec9a8bb8ad3482263f0a205a ]
    
    Each extracted frame on Ocelot has an IFH. The frame and IFH are extracted
    by reading chuncks of 4 bytes from a register.
    
    In case the IFH and frames were read corretly it would try to read the next
    frame. In case there are no more frames in the queue, it checks if there
    were any previous errors and in that case clear the queue. But this check
    will always succeed also when there are no errors. Because when extracting
    the IFH the error is checked against 4(number of bytes read) and then the
    error is set only if the extraction of the frame failed. So in a happy case
    where there are no errors the err variable is still 4. So it could be
    a case where after the check that there are no more frames in the queue, a
    frame will arrive in the queue but because the error is not reseted, it
    would try to flush the queue. So the frame will be lost.
    
    The fix consist in resetting the error after reading the IFH.
    
    Signed-off-by: Horatiu Vultur <horatiu.vultur@microchip.com>
    Acked-by: Alexandre Belloni <alexandre.belloni@bootlin.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b4443982e1a57132982a9de761e5acb1309f1236
Author: Alexandre Belloni <alexandre.belloni@bootlin.com>
Date:   Wed Feb 12 17:45:38 2020 +0100

    net: macb: ensure interface is not suspended on at91rm9200
    
    [ Upstream commit e6a41c23df0d5da01540d2abef41591589c0b4be ]
    
    Because of autosuspend, at91ether_start is called with clocks disabled.
    Ensure that pm_runtime doesn't suspend the interface as soon as it is
    opened as there is no pm_runtime support is the other relevant parts of the
    platform support for at91rm9200.
    
    Fixes: d54f89af6cc4 ("net: macb: Add pm runtime support")
    Signed-off-by: Alexandre Belloni <alexandre.belloni@bootlin.com>
    Reviewed-by: Claudiu Beznea <claudiu.beznea@microchip.com>
    Acked-by: Nicolas Ferre <nicolas.ferre@microchip.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bc7eac21e3047bceb3bc18a6db4e688e0a1aefb5
Author: Jethro Beekman <jethro@fortanix.com>
Date:   Wed Feb 12 16:43:41 2020 +0100

    net: fib_rules: Correctly set table field when table number exceeds 8 bits
    
    [ Upstream commit 540e585a79e9d643ede077b73bcc7aa2d7b4d919 ]
    
    In 709772e6e06564ed94ba740de70185ac3d792773, RT_TABLE_COMPAT was added to
    allow legacy software to deal with routing table numbers >= 256, but the
    same change to FIB rule queries was overlooked.
    
    Signed-off-by: Jethro Beekman <jethro@fortanix.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6d307b020e1ed50bf68e07a11090fd9de81c3b12
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Fri Feb 14 15:26:19 2020 -0800

    net: dsa: b53: Ensure the default VID is untagged
    
    [ Upstream commit d965a5432d4c3e6b9c3d2bc1d4a800013bbf76f6 ]
    
    We need to ensure that the default VID is untagged otherwise the switch
    will be sending tagged frames and the results can be problematic. This
    is especially true with b53 switches that use VID 0 as their default
    VLAN since VID 0 has a special meaning.
    
    Fixes: fea83353177a ("net: dsa: b53: Fix default VLAN ID")
    Fixes: 061f6a505ac3 ("net: dsa: Add ndo_vlan_rx_{add, kill}_vid implementation")
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6d8244491872e2c2f023f6db936eadeba91bfbfb
Author: Aristeu Rozanski <aris@redhat.com>
Date:   Wed Dec 4 16:23:25 2019 -0500

    EDAC: skx_common: downgrade message importance on missing PCI device
    
    [ Upstream commit 854bb48018d5da261d438b2232fa683bdb553979 ]
    
    Both skx_edac and i10nm_edac drivers are loaded based on the matching CPU being
    available which leads the module to be automatically loaded in virtual machines
    as well. That will fail due the missing PCI devices. In both drivers the first
    function to make use of the PCI devices is skx_get_hi_lo() will simply print
    
            EDAC skx: Can't get tolm/tohm
    
    for each CPU core, which is noisy. This patch makes it a debug message.
    
    Signed-off-by: Aristeu Rozanski <aris@redhat.com>
    Signed-off-by: Tony Luck <tony.luck@intel.com>
    Link: https://lore.kernel.org/r/20191204212325.c4k47p5hrnn3vpb5@redhat.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>
