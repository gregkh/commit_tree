commit dc4ba5be1babd3b3ec905751a30df89a5899a7a9
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Fri Jan 17 19:47:17 2020 +0100

    Linux 4.19.97

commit e5d0adee67fe5686dcd8763437f318c6917475f9
Author: Kai Li <li.kai4@h3c.com>
Date:   Sat Jan 4 13:00:18 2020 -0800

    ocfs2: call journal flush to mark journal as empty after journal recovery when mount
    
    [ Upstream commit 397eac17f86f404f5ba31d8c3e39ec3124b39fd3 ]
    
    If journal is dirty when mount, it will be replayed but jbd2 sb log tail
    cannot be updated to mark a new start because journal->j_flag has
    already been set with JBD2_ABORT first in journal_init_common.
    
    When a new transaction is committed, it will be recored in block 1
    first(journal->j_tail is set to 1 in journal_reset).  If emergency
    restart happens again before journal super block is updated
    unfortunately, the new recorded trans will not be replayed in the next
    mount.
    
    The following steps describe this procedure in detail.
    1. mount and touch some files
    2. these transactions are committed to journal area but not checkpointed
    3. emergency restart
    4. mount again and its journals are replayed
    5. journal super block's first s_start is 1, but its s_seq is not updated
    6. touch a new file and its trans is committed but not checkpointed
    7. emergency restart again
    8. mount and journal is dirty, but trans committed in 6 will not be
    replayed.
    
    This exception happens easily when this lun is used by only one node.
    If it is used by multi-nodes, other node will replay its journal and its
    journal super block will be updated after recovery like what this patch
    does.
    
    ocfs2_recover_node->ocfs2_replay_journal.
    
    The following jbd2 journal can be generated by touching a new file after
    journal is replayed, and seq 15 is the first valid commit, but first seq
    is 13 in journal super block.
    
    logdump:
      Block 0: Journal Superblock
      Seq: 0   Type: 4 (JBD2_SUPERBLOCK_V2)
      Blocksize: 4096   Total Blocks: 32768   First Block: 1
      First Commit ID: 13   Start Log Blknum: 1
      Error: 0
      Feature Compat: 0
      Feature Incompat: 2 block64
      Feature RO compat: 0
      Journal UUID: 4ED3822C54294467A4F8E87D2BA4BC36
      FS Share Cnt: 1   Dynamic Superblk Blknum: 0
      Per Txn Block Limit    Journal: 0    Data: 0
    
      Block 1: Journal Commit Block
      Seq: 14   Type: 2 (JBD2_COMMIT_BLOCK)
    
      Block 2: Journal Descriptor
      Seq: 15   Type: 1 (JBD2_DESCRIPTOR_BLOCK)
      No. Blocknum        Flags
       0. 587             none
      UUID: 00000000000000000000000000000000
       1. 8257792         JBD2_FLAG_SAME_UUID
       2. 619             JBD2_FLAG_SAME_UUID
       3. 24772864        JBD2_FLAG_SAME_UUID
       4. 8257802         JBD2_FLAG_SAME_UUID
       5. 513             JBD2_FLAG_SAME_UUID JBD2_FLAG_LAST_TAG
      ...
      Block 7: Inode
      Inode: 8257802   Mode: 0640   Generation: 57157641 (0x3682809)
      FS Generation: 2839773110 (0xa9437fb6)
      CRC32: 00000000   ECC: 0000
      Type: Regular   Attr: 0x0   Flags: Valid
      Dynamic Features: (0x1) InlineData
      User: 0 (root)   Group: 0 (root)   Size: 7
      Links: 1   Clusters: 0
      ctime: 0x5de5d870 0x11104c61 -- Tue Dec  3 11:37:20.286280801 2019
      atime: 0x5de5d870 0x113181a1 -- Tue Dec  3 11:37:20.288457121 2019
      mtime: 0x5de5d870 0x11104c61 -- Tue Dec  3 11:37:20.286280801 2019
      dtime: 0x0 -- Thu Jan  1 08:00:00 1970
      ...
      Block 9: Journal Commit Block
      Seq: 15   Type: 2 (JBD2_COMMIT_BLOCK)
    
    The following is journal recovery log when recovering the upper jbd2
    journal when mount again.
    
    syslog:
      ocfs2: File system on device (252,1) was not unmounted cleanly, recovering it.
      fs/jbd2/recovery.c:(do_one_pass, 449): Starting recovery pass 0
      fs/jbd2/recovery.c:(do_one_pass, 449): Starting recovery pass 1
      fs/jbd2/recovery.c:(do_one_pass, 449): Starting recovery pass 2
      fs/jbd2/recovery.c:(jbd2_journal_recover, 278): JBD2: recovery, exit status 0, recovered transactions 13 to 13
    
    Due to first commit seq 13 recorded in journal super is not consistent
    with the value recorded in block 1(seq is 14), journal recovery will be
    terminated before seq 15 even though it is an unbroken commit, inode
    8257802 is a new file and it will be lost.
    
    Link: http://lkml.kernel.org/r/20191217020140.2197-1-li.kai4@h3c.com
    Signed-off-by: Kai Li <li.kai4@h3c.com>
    Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
    Reviewed-by: Changwei Ge <gechangwei@live.cn>
    Cc: Mark Fasheh <mark@fasheh.com>
    Cc: Joel Becker <jlbec@evilplan.org>
    Cc: Junxiao Bi <junxiao.bi@oracle.com>
    Cc: Gang He <ghe@suse.com>
    Cc: Jun Piao <piaojun@huawei.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit dab02b0aedb06e339d4b35961dd4890118c69570
Author: Nick Desaulniers <ndesaulniers@google.com>
Date:   Sat Jan 4 13:00:02 2020 -0800

    hexagon: work around compiler crash
    
    [ Upstream commit 63e80314ab7cf4783526d2e44ee57a90514911c9 ]
    
    Clang cannot translate the string "r30" into a valid register yet.
    
    Link: https://github.com/ClangBuiltLinux/linux/issues/755
    Link: http://lkml.kernel.org/r/20191028155722.23419-1-ndesaulniers@google.com
    Signed-off-by: Nick Desaulniers <ndesaulniers@google.com>
    Suggested-by: Sid Manning <sidneym@quicinc.com>
    Reviewed-by: Brian Cain <bcain@codeaurora.org>
    Cc: Allison Randal <allison@lohutok.net>
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Cc: Richard Fontana <rfontana@redhat.com>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 246d487edd89c94a7773c354dc8a0904d530a60d
Author: Nick Desaulniers <ndesaulniers@google.com>
Date:   Sat Jan 4 12:59:59 2020 -0800

    hexagon: parenthesize registers in asm predicates
    
    [ Upstream commit 780a0cfda9006a9a22d6473c2d4c527f5c68eb2e ]
    
    Hexagon requires that register predicates in assembly be parenthesized.
    
    Link: https://github.com/ClangBuiltLinux/linux/issues/754
    Link: http://lkml.kernel.org/r/20191209222956.239798-3-ndesaulniers@google.com
    Signed-off-by: Nick Desaulniers <ndesaulniers@google.com>
    Suggested-by: Sid Manning <sidneym@codeaurora.org>
    Acked-by: Brian Cain <bcain@codeaurora.org>
    Cc: Lee Jones <lee.jones@linaro.org>
    Cc: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Cc: Tuowen Zhao <ztuowen@gmail.com>
    Cc: Mika Westerberg <mika.westerberg@linux.intel.com>
    Cc: Luis Chamberlain <mcgrof@kernel.org>
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Cc: Alexios Zavras <alexios.zavras@intel.com>
    Cc: Allison Randal <allison@lohutok.net>
    Cc: Will Deacon <will@kernel.org>
    Cc: Richard Fontana <rfontana@redhat.com>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Boqun Feng <boqun.feng@gmail.com>
    Cc: Ingo Molnar <mingo@redhat.com>
    Cc: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 10d55ea6136b4116623297df3bd156981cc87f7e
Author: Alexander.Barabash@dell.com <Alexander.Barabash@dell.com>
Date:   Wed Dec 25 17:55:30 2019 +0000

    ioat: ioat_alloc_ring() failure handling.
    
    [ Upstream commit b0b5ce1010ffc50015eaec72b0028aaae3f526bb ]
    
    If dma_alloc_coherent() returns NULL in ioat_alloc_ring(), ring
    allocation must not proceed.
    
    Until now, if the first call to dma_alloc_coherent() in
    ioat_alloc_ring() returned NULL, the processing could proceed, failing
    with NULL-pointer dereferencing further down the line.
    
    Signed-off-by: Alexander Barabash <alexander.barabash@dell.com>
    Acked-by: Dave Jiang <dave.jiang@intel.com>
    Link: https://lore.kernel.org/r/75e9c0e84c3345d693c606c64f8b9ab5@x13pwhopdag1307.AMER.DELL.COM
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 64f2737186ce085477f4f977797cb221291538bb
Author: John Stultz <john.stultz@linaro.org>
Date:   Wed Dec 18 19:09:06 2019 +0000

    dmaengine: k3dma: Avoid null pointer traversal
    
    [ Upstream commit 2f42e05b942fe2fbfb9bbc6e34e1dd8c3ce4f3a4 ]
    
    In some cases we seem to submit two transactions in a row, which
    causes us to lose track of the first. If we then cancel the
    request, we may still get an interrupt, which traverses a null
    ds_run value.
    
    So try to avoid starting a new transaction if the ds_run value
    is set.
    
    While this patch avoids the null pointer crash, I've had some
    reports of the k3dma driver still getting confused, which
    suggests the ds_run/ds_done value handling still isn't quite
    right. However, I've not run into an issue recently with it
    so I think this patch is worth pushing upstream to avoid the
    crash.
    
    Signed-off-by: John Stultz <john.stultz@linaro.org>
    [add ss tag]
    Link: https://lore.kernel.org/r/20191218190906.6641-1-john.stultz@linaro.org
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 71e878ac1c8646be007494ca20368db17ee65193
Author: Ben Dooks (Codethink) <ben.dooks@codethink.co.uk>
Date:   Tue Dec 17 11:53:09 2019 +0000

    drm/arm/mali: make malidp_mw_connector_helper_funcs static
    
    [ Upstream commit ac2917b01992c098b8d4e6837115e3ca347fdd90 ]
    
    The malidp_mw_connector_helper_funcs is not referenced by name
    outside of the file it is in, so make it static to avoid the
    following warning:
    
    drivers/gpu/drm/arm/malidp_mw.c:59:41: warning: symbol 'malidp_mw_connector_helper_funcs' was not declared. Should it be static?
    
    Signed-off-by: Ben Dooks (Codethink) <ben.dooks@codethink.co.uk>
    Signed-off-by: Liviu Dudau <Liviu.Dudau@arm.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20191217115309.2133503-1-ben.dooks@codethink.co.uk
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4c9544c0bd25609a0ebde5e22067d52d2fb26f7d
Author: Jouni Hogander <jouni.hogander@unikie.com>
Date:   Mon Dec 9 14:37:07 2019 +0200

    MIPS: Prevent link failure with kcov instrumentation
    
    [ Upstream commit a4a3893114a41e365274d5fab5d9ff5acc235ff0 ]
    
    __sanitizer_cov_trace_pc() is not linked in and causing link
    failure if KCOV_INSTRUMENT is enabled. Fix this by disabling
    instrumentation for compressed image.
    
    Signed-off-by: Jouni Hogander <jouni.hogander@unikie.com>
    Signed-off-by: Paul Burton <paulburton@kernel.org>
    Cc: Lukas Bulwahn <lukas.bulwahn@gmail.com>
    Cc: linux-mips@vger.kernel.org
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 60af5786db7ebc2431a4f477da3e56b2cf2a8ca5
Author: Vladimir Kondratiev <vladimir.kondratiev@intel.com>
Date:   Sun Nov 24 16:07:31 2019 +0200

    mips: cacheinfo: report shared CPU map
    
    [ Upstream commit 3b1313eb32c499d46dc4c3e896d19d9564c879c4 ]
    
    Report L1 caches as shared per core; L2 - per cluster.
    
    This fixes "perf" that went crazy if shared_cpu_map attribute not
    reported on sysfs, in form of
    
    /sys/devices/system/cpu/cpu*/cache/index*/shared_cpu_list
    /sys/devices/system/cpu/cpu*/cache/index*/shared_cpu_map
    
    Signed-off-by: Vladimir Kondratiev <vladimir.kondratiev@intel.com>
    Signed-off-by: Paul Burton <paulburton@kernel.org>
    Cc: Ralf Baechle <ralf@linux-mips.org>
    Cc: James Hogan <jhogan@kernel.org>
    Cc: linux-mips@vger.kernel.org
    Cc: linux-kernel@vger.kernel.org
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a9a5fd928285d228bfc7cd4ee80f48c481cb466f
Author: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date:   Wed Dec 11 11:28:57 2019 -0500

    rseq/selftests: Turn off timeout setting
    
    [ Upstream commit af9cb29c5488381083b0b5ccdfb3cd931063384a ]
    
    As the rseq selftests can run for a long period of time, disable the
    timeout that the general selftests have.
    
    Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
    Cc: Shuah Khan <skhan@linuxfoundation.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: Peter Zijlstra (Intel) <peterz@infradead.org>
    Cc: "Paul E. McKenney" <paulmck@linux.ibm.com>
    Cc: Boqun Feng <boqun.feng@gmail.com>
    Cc: "H . Peter Anvin" <hpa@zytor.com>
    Cc: Paul Turner <pjt@google.com>
    Cc: Dmitry Vyukov <dvyukov@google.com>
    Signed-off-by: Shuah Khan <skhan@linuxfoundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 9b3d33b38d06fb44a425d30d92971fe26071d9b0
Author: Shuah Khan <skhan@linuxfoundation.org>
Date:   Thu Dec 12 18:56:06 2019 -0700

    selftests: firmware: Fix it to do root uid check and skip
    
    [ Upstream commit c65e41538b04e0d64a673828745a00cb68a24371 ]
    
    firmware attempts to load test modules that require root access
    and fail. Fix it to check for root uid and exit with skip code
    instead.
    
    Before this fix:
    
    selftests: firmware: fw_run_tests.sh
    modprobe: ERROR: could not insert 'test_firmware': Operation not permitted
    You must have the following enabled in your kernel:
    CONFIG_TEST_FIRMWARE=y
    CONFIG_FW_LOADER=y
    CONFIG_FW_LOADER_USER_HELPER=y
    CONFIG_IKCONFIG=y
    CONFIG_IKCONFIG_PROC=y
    not ok 1 selftests: firmware: fw_run_tests.sh # SKIP
    
    With this fix:
    
    selftests: firmware: fw_run_tests.sh
    skip all tests: must be run as root
    not ok 1 selftests: firmware: fw_run_tests.sh # SKIP
    
    Signed-off-by: Shuah Khan <skhan@linuxfoundation.org>
    Reviwed-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Shuah Khan <skhan@linuxfoundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit decbe8411b3013352f4d71be3f55e780abd8b844
Author: Varun Prakash <varun@chelsio.com>
Date:   Wed Dec 18 19:15:31 2019 +0530

    scsi: libcxgbi: fix NULL pointer dereference in cxgbi_device_destroy()
    
    [ Upstream commit 71482fde704efdd8c3abe0faf34d922c61e8d76b ]
    
    If cxgb4i_ddp_init() fails then cdev->cdev2ppm will be NULL, so add a check
    for NULL pointer before dereferencing it.
    
    Link: https://lore.kernel.org/r/1576676731-3068-1-git-send-email-varun@chelsio.com
    Signed-off-by: Varun Prakash <varun@chelsio.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5b5206bc359c13e4799bc1602b7c543f9babefff
Author: Johnson CH Chen (陳昭勳) <JohnsonCH.Chen@moxa.com>
Date:   Tue Nov 26 06:51:11 2019 +0000

    gpio: mpc8xxx: Add platform device to gpiochip->parent
    
    [ Upstream commit 322f6a3182d42df18059a89c53b09d33919f755e ]
    
    Dear Linus Walleij,
    
    In old kernels, some APIs still try to use parent->of_node from struct gpio_chip,
    and it could be resulted in kernel panic because parent is NULL. Adding platform
    device to gpiochip->parent can fix this problem.
    
    Signed-off-by: Johnson Chen <johnsonch.chen@moxa.com>
    Link: https://patchwork.kernel.org/patch/11234609
    Link: https://lore.kernel.org/r/HK0PR01MB3521489269F76467DFD7843FFA450@HK0PR01MB3521.apcprd01.prod.exchangelabs.com
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5e003f9eeb1768d65920e82aa6023845cb9343b6
Author: Chuhong Yuan <hslester96@gmail.com>
Date:   Wed Nov 6 00:00:43 2019 +0800

    rtc: brcmstb-waketimer: add missed clk_disable_unprepare
    
    commit 94303f8930ed78aea0f189b703c9d79fff9555d7 upstream.
    
    This driver forgets to disable and unprepare clock when remove.
    Add a call to clk_disable_unprepare to fix it.
    
    Fixes: c4f07ecee22e ("rtc: brcmstb-waketimer: Add Broadcom STB wake-timer")
    Signed-off-by: Chuhong Yuan <hslester96@gmail.com>
    Acked-by: Florian Fainelli <f.fainelli@gmail.com>
    Link: https://lore.kernel.org/r/20191105160043.20018-1-hslester96@gmail.com
    Signed-off-by: Alexandre Belloni <alexandre.belloni@bootlin.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f899dc31f1fcf9121fc314cf9f64e18184d6f811
Author: Kars de Jong <jongk@linux-m68k.org>
Date:   Sat Nov 16 12:05:48 2019 +0100

    rtc: msm6242: Fix reading of 10-hour digit
    
    commit e34494c8df0cd96fc432efae121db3212c46ae48 upstream.
    
    The driver was reading the wrong register as the 10-hour digit due to
    a misplaced ')'. It was in fact reading the 1-second digit register due
    to this bug.
    
    Also remove the use of a magic number for the hour mask and use the define
    for it which was already present.
    
    Fixes: 4f9b9bba1dd1 ("rtc: Add an RTC driver for the Oki MSM6242")
    Tested-by: Kars de Jong <jongk@linux-m68k.org>
    Signed-off-by: Kars de Jong <jongk@linux-m68k.org>
    Link: https://lore.kernel.org/r/20191116110548.8562-1-jongk@linux-m68k.org
    Reviewed-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Alexandre Belloni <alexandre.belloni@bootlin.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ec8f4deac77773fff7f45c1516f7e9a5895ab210
Author: Chao Yu <chao@kernel.org>
Date:   Thu Nov 7 17:29:00 2019 +0800

    f2fs: fix potential overflow
    
    commit 1f0d5c911b64165c9754139a26c8c2fad352c132 upstream.
    
    We expect 64-bit calculation result from below statement, however
    in 32-bit machine, looped left shift operation on pgoff_t type
    variable may cause overflow issue, fix it by forcing type cast.
    
    page->index << PAGE_SHIFT;
    
    Fixes: 26de9b117130 ("f2fs: avoid unnecessary updating inode during fsync")
    Fixes: 0a2aa8fbb969 ("f2fs: refactor __exchange_data_block for speed up")
    Signed-off-by: Chao Yu <yuchao0@huawei.com>
    Signed-off-by: Jaegeuk Kim <jaegeuk@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3d3ea9d7979d25caf05fc919c678a0ff14c8859a
Author: Nathan Chancellor <natechancellor@gmail.com>
Date:   Tue Oct 22 17:47:03 2019 -0700

    rtlwifi: Remove unnecessary NULL check in rtl_regd_init
    
    commit 091c6e9c083f7ebaff00b37ad13562d51464d175 upstream.
    
    When building with Clang + -Wtautological-pointer-compare:
    
    drivers/net/wireless/realtek/rtlwifi/regd.c:389:33: warning: comparison
    of address of 'rtlpriv->regd' equal to a null pointer is always false
    [-Wtautological-pointer-compare]
            if (wiphy == NULL || &rtlpriv->regd == NULL)
                                  ~~~~~~~~~^~~~    ~~~~
    1 warning generated.
    
    The address of an array member is never NULL unless it is the first
    struct member so remove the unnecessary check. This was addressed in
    the staging version of the driver in commit f986978b32b3 ("Staging:
    rtlwifi: remove unnecessary NULL check").
    
    While we are here, fix the following checkpatch warning:
    
    CHECK: Comparison to NULL could be written "!wiphy"
    35: FILE: drivers/net/wireless/realtek/rtlwifi/regd.c:389:
    +       if (wiphy == NULL)
    
    Fixes: 0c8173385e54 ("rtl8192ce: Add new driver")
    Link:https://github.com/ClangBuiltLinux/linux/issues/750
    Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
    Acked-by: Ping-Ke Shih <pkshih@realtek.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f6e10f70c21a3c0ade721a637464772daad85045
Author: Mans Rullgard <mans@mansr.com>
Date:   Fri Oct 18 17:35:04 2019 +0200

    spi: atmel: fix handling of cs_change set on non-last xfer
    
    commit fed8d8c7a6dc2a76d7764842853d81c770b0788e upstream.
    
    The driver does the wrong thing when cs_change is set on a non-last
    xfer in a message.  When cs_change is set, the driver deactivates the
    CS and leaves it off until a later xfer again has cs_change set whereas
    it should be briefly toggling CS off and on again.
    
    This patch brings the behaviour of the driver back in line with the
    documentation and common sense.  The delay of 10 us is the same as is
    used by the default spi_transfer_one_message() function in spi.c.
    [gregory: rebased on for-5.5 from spi tree]
    Fixes: 8090d6d1a415 ("spi: atmel: Refactor spi-atmel to use SPI framework queue")
    Signed-off-by: Mans Rullgard <mans@mansr.com>
    Acked-by: Nicolas Ferre <nicolas.ferre@atmel.com>
    Signed-off-by: Gregory CLEMENT <gregory.clement@bootlin.com>
    Link: https://lore.kernel.org/r/20191018153504.4249-1-gregory.clement@bootlin.com
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 35c5980366da11dd867de8a2e28db3df81a410a4
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Wed Oct 30 21:53:03 2019 +0300

    mtd: spi-nor: fix silent truncation in spi_nor_read_raw()
    
    commit 3d63ee5deb466fd66ed6ffb164a87ce36425cf36 upstream.
    
    spi_nor_read_raw() assigns the result of 'ssize_t spi_nor_read_data()'
    to the 'int ret' variable, while 'ssize_t' is a 64-bit type and *int*
    is a 32-bit type on the 64-bit machines. This silent truncation isn't
    really valid, so fix up the variable's type.
    
    Fixes: f384b352cbf0 ("mtd: spi-nor: parse Serial Flash Discoverable Parameters (SFDP) tables")
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Signed-off-by: Tudor Ambarus <tudor.ambarus@microchip.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8dbdf414cd962176b0d6d7a20d21c79772a99d5f
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Wed Oct 30 21:48:59 2019 +0300

    mtd: spi-nor: fix silent truncation in spi_nor_read()
    
    commit a719a75a7761e4139dd099330d9fe3589d844f9b upstream.
    
    spi_nor_read() assigns the result of 'ssize_t spi_nor_read_data()'
    to the 'int ret' variable, while 'ssize_t' is a 64-bit type and *int*
    is a 32-bit type on the 64-bit machines. This silent truncation isn't
    really valid, so fix up the variable's type.
    
    Fixes: 59451e1233bd ("mtd: spi-nor: change return value of read/write")
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Signed-off-by: Tudor Ambarus <tudor.ambarus@microchip.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 70001d927817454eecd0514efa0c3702096a3b1a
Author: Yong Wu <yong.wu@mediatek.com>
Date:   Mon Nov 4 15:01:02 2019 +0800

    iommu/mediatek: Correct the flush_iotlb_all callback
    
    commit 2009122f1d83dd8375572661961eab1e7e86bffe upstream.
    
    Use the correct tlb_flush_all instead of the original one.
    
    Fixes: 4d689b619445 ("iommu/io-pgtable-arm-v7s: Convert to IOMMU API TLB sync")
    Signed-off-by: Yong Wu <yong.wu@mediatek.com>
    Reviewed-by: Robin Murphy <robin.murphy@arm.com>
    Signed-off-by: Joerg Roedel <jroedel@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 426a2565ab34c1aeb7d65d656a35a8fedfbeef3f
Author: Seung-Woo Kim <sw0312.kim@samsung.com>
Date:   Fri Oct 18 07:20:52 2019 -0300

    media: exynos4-is: Fix recursive locking in isp_video_release()
    
    commit 704c6c80fb471d1bb0ef0d61a94617d1d55743cd upstream.
    
    >From isp_video_release(), &isp->video_lock is held and subsequent
    vb2_fop_release() tries to lock vdev->lock which is same with the
    previous one. Replace vb2_fop_release() with _vb2_fop_release() to
    fix the recursive locking.
    
    Fixes: 1380f5754cb0 ("[media] videobuf2: Add missing lock held on vb2_fop_release")
    Signed-off-by: Seung-Woo Kim <sw0312.kim@samsung.com>
    Reviewed-by: Sylwester Nawrocki <s.nawrocki@samsung.com>
    Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e6e1409d3c2b05b4e4c992b740a3b4e224b741e4
Author: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
Date:   Fri Sep 13 16:06:47 2019 -0300

    media: v4l: cadence: Fix how unsued lanes are handled in 'csi2rx_start()'
    
    commit 2eca8e4c1df4864b937752c3aa2f7925114f4806 upstream.
    
    The 2nd parameter of 'find_first_zero_bit()' is a number of bits, not of
    bytes. So use 'csi2rx->max_lanes' instead of 'sizeof(lanes_used)'.
    
    Fixes: 1fc3b37f34f6 ("media: v4l: cadence: Add Cadence MIPI-CSI2 RX driver")
    Signed-off-by: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
    Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 83072371129dd709b9bad761a630e4a2f9d48feb
Author: Niklas Söderlund <niklas.soderlund+renesas@ragnatech.se>
Date:   Wed Sep 4 18:54:04 2019 -0300

    media: rcar-vin: Fix incorrect return statement in rvin_try_format()
    
    commit a0862a40364e2f87109317e31c51c9d7bc89e33f upstream.
    
    While refactoring code the return statement became corrupted, fix it by
    returning the correct return code.
    
    Reported-by: Kieran Bingham <kieran.bingham+renesas@ideasonboard.com>
    Fixes: 897e371389e77514 ("media: rcar-vin: simplify how formats are set and reset"
    Signed-off-by: Niklas Söderlund <niklas.soderlund+renesas@ragnatech.se>
    Reviewed-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
    Reviewed-by: Kieran Bingham <kieran.bingham+renesas@ideasonboard.com>
    Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a0a3fb1e90413d6ae1cc88b1731a9ebafe670e8c
Author: Janusz Krzysztofik <jmkrzyszt@gmail.com>
Date:   Tue Sep 3 17:11:41 2019 -0300

    media: ov6650: Fix .get_fmt() V4L2_SUBDEV_FORMAT_TRY support
    
    commit 39034bb0c26b76a2c3abc54aa28c185f18b40c2f upstream.
    
    Commit da298c6d98d5 ("[media] v4l2: replace video op g_mbus_fmt by pad
    op get_fmt") converted a former ov6650_g_fmt() video operation callback
    to an ov6650_get_fmt() pad operation callback.  However, the converted
    function disregards a format->which flag that pad operations should
    obey and always returns active frame format settings.
    
    That can be fixed by always responding to V4L2_SUBDEV_FORMAT_TRY with
    -EINVAL, or providing the response from a pad config argument, likely
    updated by a former user call to V4L2_SUBDEV_FORMAT_TRY .set_fmt().
    Since implementation of the latter is trivial, go for it.
    
    Fixes: da298c6d98d5 ("[media] v4l2: replace video op g_mbus_fmt by pad op get_fmt")
    Signed-off-by: Janusz Krzysztofik <jmkrzyszt@gmail.com>
    Signed-off-by: Sakari Ailus <sakari.ailus@linux.intel.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3c5e8a308cef5fc857aa0077c07fec046dde51ab
Author: Janusz Krzysztofik <jmkrzyszt@gmail.com>
Date:   Tue Sep 3 17:11:40 2019 -0300

    media: ov6650: Fix some format attributes not under control
    
    commit 1c6a2b63095154bbf9e8f38d79487a728331bf65 upstream.
    
    User arguments passed to .get/set_fmt() pad operation callbacks may
    contain unsupported values.  The driver takes control over frame size
    and pixel code as well as colorspace and field attributes but has never
    cared for remainig format attributes, i.e., ycbcr_enc, quantization
    and xfer_func, introduced by commit 11ff030c7365 ("[media]
    v4l2-mediabus: improve colorspace support").  Fix it.
    
    Set up a static v4l2_mbus_framefmt structure with attributes
    initialized to reasonable defaults and use it for updating content of
    user provided arguments.  In case of V4L2_SUBDEV_FORMAT_ACTIVE,
    postpone frame size update, now performed from inside ov6650_s_fmt()
    helper, util the user argument is first updated in ov6650_set_fmt() with
    default frame format content.  For V4L2_SUBDEV_FORMAT_TRY, don't copy
    all attributes to pad config, only those handled by the driver, then
    fill the response with the default frame format updated with resulting
    pad config format code and frame size.
    
    Fixes: 11ff030c7365 ("[media] v4l2-mediabus: improve colorspace support")
    Signed-off-by: Janusz Krzysztofik <jmkrzyszt@gmail.com>
    Signed-off-by: Sakari Ailus <sakari.ailus@linux.intel.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d99a75da7859931b4e1ec18ee32052cfac0f8045
Author: Janusz Krzysztofik <jmkrzyszt@gmail.com>
Date:   Tue Sep 3 17:11:39 2019 -0300

    media: ov6650: Fix incorrect use of JPEG colorspace
    
    commit 12500731895ef09afc5b66b86b76c0884fb9c7bf upstream.
    
    Since its initial submission, the driver selects V4L2_COLORSPACE_JPEG
    for supported formats other than V4L2_MBUS_FMT_SBGGR8_1X8.  According
    to v4l2-compliance test program, V4L2_COLORSPACE_JPEG applies
    exclusively to V4L2_PIX_FMT_JPEG.  Since the sensor does not support
    JPEG format, fix it to always select V4L2_COLORSPACE_SRGB.
    
    Fixes: 2f6e2404799a ("[media] SoC Camera: add driver for OV6650 sensor")
    Signed-off-by: Janusz Krzysztofik <jmkrzyszt@gmail.com>
    Signed-off-by: Sakari Ailus <sakari.ailus@linux.intel.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d207bc81a0b314ff1158637cc4f7a81429984924
Author: Peng Fan <peng.fan@nxp.com>
Date:   Wed Nov 13 05:37:42 2019 +0000

    tty: serial: pch_uart: correct usage of dma_unmap_sg
    
    commit 74887542fdcc92ad06a48c0cca17cdf09fc8aa00 upstream.
    
    Per Documentation/DMA-API-HOWTO.txt,
    To unmap a scatterlist, just call:
            dma_unmap_sg(dev, sglist, nents, direction);
    
    .. note::
    
            The 'nents' argument to the dma_unmap_sg call must be
            the _same_ one you passed into the dma_map_sg call,
            it should _NOT_ be the 'count' value _returned_ from the
            dma_map_sg call.
    
    However in the driver, priv->nent is directly assigned with value
    returned from dma_map_sg, and dma_unmap_sg use priv->nent for unmap,
    this breaks the API usage.
    
    So introduce a new entry orig_nent to remember 'nents'.
    
    Fixes: da3564ee027e ("pch_uart: add multi-scatter processing")
    Signed-off-by: Peng Fan <peng.fan@nxp.com>
    Link: https://lore.kernel.org/r/1573623259-6339-1-git-send-email-peng.fan@nxp.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8dc7267338d4f761dfaa5b450f1d43d6f03e1494
Author: Peng Fan <peng.fan@nxp.com>
Date:   Thu Nov 7 06:42:53 2019 +0000

    tty: serial: imx: use the sg count from dma_map_sg
    
    commit 596fd8dffb745afcebc0ec6968e17fe29f02044c upstream.
    
    The dmaengine_prep_slave_sg needs to use sg count returned
    by dma_map_sg, not use sport->dma_tx_nents, because the return
    value of dma_map_sg is not always same with "nents".
    
    Fixes: b4cdc8f61beb ("serial: imx: add DMA support for imx6q")
    Signed-off-by: Peng Fan <peng.fan@nxp.com>
    Link: https://lore.kernel.org/r/1573108875-26530-1-git-send-email-peng.fan@nxp.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cd85fa3367143fa4c5cc2067dea7a64850ac9e11
Author: Oliver O'Halloran <oohall@gmail.com>
Date:   Mon Nov 18 17:55:53 2019 +1100

    powerpc/powernv: Disable native PCIe port management
    
    commit 9d72dcef891030545f39ad386a30cf91df517fb2 upstream.
    
    On PowerNV the PCIe topology is (currently) managed by the powernv platform
    code in Linux in cooperation with the platform firmware. Linux's native
    PCIe port service drivers operate independently of both and this can cause
    problems.
    
    The main issue is that the portbus driver will conflict with the platform
    specific hotplug driver (pnv_php) over ownership of the MSI used to notify
    the host when a hotplug event occurs. The portbus driver claims this MSI on
    behalf of the individual port services because the same interrupt is used
    for hotplug events, PMEs (on root ports), and link bandwidth change
    notifications. The portbus driver will always claim the interrupt even if
    the individual port service drivers, such as pciehp, are compiled out.
    
    The second, bigger, problem is that the hotplug port service driver
    fundamentally does not work on PowerNV. The platform assumes that all
    PCI devices have a corresponding arch-specific handle derived from the DT
    node for the device (pci_dn) and without one the platform will not allow
    a PCI device to be enabled. This problem is largely due to historical
    baggage, but it can't be resolved without significant re-factoring of the
    platform PCI support.
    
    We can fix these problems in the interim by setting the
    "pcie_ports_disabled" flag during platform initialisation. The flag
    indicates the platform owns the PCIe ports which stops the portbus driver
    from being registered.
    
    This does have the side effect of disabling all port services drivers
    that is: AER, PME, BW notifications, hotplug, and DPC. However, this is
    not a huge disadvantage on PowerNV since these services are either unused
    or handled through other means.
    
    Fixes: 66725152fb9f ("PCI/hotplug: PowerPC PowerNV PCI hotplug driver")
    Signed-off-by: Oliver O'Halloran <oohall@gmail.com>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Link: https://lore.kernel.org/r/20191118065553.30362-1-oohall@gmail.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 76c39f864bd7cd47332af859a2dd974b19d7623d
Author: Bjorn Helgaas <bhelgaas@google.com>
Date:   Wed Nov 6 15:30:48 2019 -0600

    PCI/PTM: Remove spurious "d" from granularity message
    
    commit 127a7709495db52a41012deaebbb7afc231dad91 upstream.
    
    The granularity message has an extra "d":
    
      pci 0000:02:00.0: PTM enabled, 4dns granularity
    
    Remove the "d" so the message is simply "PTM enabled, 4ns granularity".
    
    Fixes: 8b2ec318eece ("PCI: Add PTM clock granularity information")
    Link: https://lore.kernel.org/r/20191106222420.10216-2-helgaas@kernel.org
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Reviewed-by: Andrew Murray <andrew.murray@arm.com>
    Cc: Jonathan Yong <jonathan.yong@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 186d51d4fa88bddeff65327c0bd730c6487a3b39
Author: Niklas Cassel <niklas.cassel@linaro.org>
Date:   Wed Sep 4 18:03:38 2019 +0200

    PCI: dwc: Fix find_next_bit() usage
    
    commit 1137e61dcb99f7f8b54e77ed83f68b5b485a3e34 upstream.
    
    find_next_bit() takes a parameter of size long, and performs arithmetic
    that assumes that the argument is of size long.
    
    Therefore we cannot pass a u32, since this will cause find_next_bit()
    to read outside the stack buffer and will produce the following print:
    BUG: KASAN: stack-out-of-bounds in find_next_bit+0x38/0xb0
    
    Fixes: 1b497e6493c4 ("PCI: dwc: Fix uninitialized variable in dw_handle_msi_irq()")
    Tested-by: Bjorn Andersson <bjorn.andersson@linaro.org>
    Signed-off-by: Niklas Cassel <niklas.cassel@linaro.org>
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Reviewed-by: Andrew Murray <andrew.murray@arm.com>
    Acked-by: Gustavo Pimentel <gustavo.pimentel@synopsys.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 731afe8a9712687fa63bfe0bc35fd9b4cc4438e1
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Mon Jun 3 23:06:00 2019 +0200

    compat_ioctl: handle SIOCOUTQNSD
    
    commit 9d7bf41fafa5b5ddd4c13eb39446b0045f0a8167 upstream.
    
    Unlike the normal SIOCOUTQ, SIOCOUTQNSD was never handled in compat
    mode. Add it to the common socket compat handler along with similar
    ones.
    
    Fixes: 2f4e1b397097 ("tcp: ioctl type SIOCOUTQNSD returns amount of data not sent")
    Cc: Eric Dumazet <edumazet@google.com>
    Cc: netdev@vger.kernel.org
    Cc: "David S. Miller" <davem@davemloft.net>
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3ed0260339986918553d8c81ce8e7df796325ee1
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Mon Jun 3 22:03:44 2019 +0200

    af_unix: add compat_ioctl support
    
    commit 5f6beb9e0f633f3cc845cdd67973c506372931b4 upstream.
    
    The af_unix protocol family has a custom ioctl command (inexplicibly
    based on SIOCPROTOPRIVATE), but never had a compat_ioctl handler for
    32-bit applications.
    
    Since all commands are compatible here, add a trivial wrapper that
    performs the compat_ptr() conversion for SIOCOUTQ/SIOCINQ.  SIOCUNIXFILE
    does not use the argument, but it doesn't hurt to also use compat_ptr()
    here.
    
    Fixes: ba94f3088b79 ("unix: add ioctl to open a unix socket file with O_PATH")
    Cc: netdev@vger.kernel.org
    Cc: "David S. Miller" <davem@davemloft.net>
    Cc: Eric Dumazet <edumazet@google.com>
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 09cc894da5e6e223ce0b94b2b9e64937a5110d6e
Author: Loic Poulain <loic.poulain@linaro.org>
Date:   Wed Dec 12 18:13:26 2018 +0100

    arm64: dts: apq8096-db820c: Increase load on l21 for SDCARD
    
    commit e38161bd325ea541ef2f258d8e28281077dde524 upstream.
    
    In the same way as for msm8974-hammerhead, l21 load, used for SDCARD
    VMMC, needs to be increased in order to prevent any voltage drop issues
    (due to limited current) happening with some SDCARDS or during specific
    operations (e.g. write).
    
    Reviewed-by: Bjorn Andersson <bjorn.andersson@linaro.org>
    Fixes: 660a9763c6a9 (arm64: dts: qcom: db820c: Add pm8994 regulator node)
    Signed-off-by: Loic Poulain <loic.poulain@linaro.org>
    Signed-off-by: Bjorn Andersson <bjorn.andersson@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 818684e3c26268d47ca5e34dd2d0dd01c36ef7a4
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Fri Mar 15 13:46:11 2019 +0100

    scsi: sd: enable compat ioctls for sed-opal
    
    commit 142b2ac82e31c174936c5719fa12ae28f51a55b7 upstream.
    
    The sed_ioctl() function is written to be compatible between
    32-bit and 64-bit processes, however compat mode is only
    wired up for nvme, not for sd.
    
    Add the missing call to sed_ioctl() in sd_compat_ioctl().
    
    Fixes: d80210f25ff0 ("sd: add support for TCG OPAL self encrypting disks")
    Cc: linux-scsi@vger.kernel.org
    Cc: "James E.J. Bottomley" <jejb@linux.ibm.com>
    Cc: "Martin K. Petersen" <martin.petersen@oracle.com>
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3a71ff82084c56d116c48b466b4ab78e4ed9c4a9
Author: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Date:   Wed Nov 20 15:37:39 2019 +0200

    pinctrl: lewisburg: Update pin list according to v1.1v6
    
    commit e66ff71fd0dba36a53f91f39e4da6c7b84764f2e upstream.
    
    Version 1.1v6 of pin list has some changes in pin names for Intel Lewisburg.
    
    Update the driver accordingly.
    
    Note, it reveals the bug in the driver that misses two pins in GPP_L and
    has rather two extra ones. That's why the ordering of some groups is changed.
    
    Fixes: e480b745386e ("pinctrl: intel: Add Intel Lewisburg GPIO support")
    Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Link: https://lore.kernel.org/r/20191120133739.54332-1-andriy.shevchenko@linux.intel.com
    Acked-by: Mika Westerberg <mika.westerberg@linux.intel.com>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7be50e3b1a0085c47eaf0b2928d4930d1288189e
Author: Colin Ian King <colin.king@canonical.com>
Date:   Fri Sep 20 14:20:30 2019 +0200

    pinctl: ti: iodelay: fix error checking on pinctrl_count_index_with_args call
    
    commit 5ff8aca906f3a7a7db79fad92f2a4401107ef50d upstream.
    
    The call to pinctrl_count_index_with_args checks for a -EINVAL return
    however this function calls pinctrl_get_list_and_count and this can
    return -ENOENT. Rather than check for a specific error, fix this by
    checking for any error return to catch the -ENOENT case.
    
    Addresses-Coverity: ("Improper use of negative")
    Fixes: 003910ebc83b ("pinctrl: Introduce TI IOdelay configuration driver")
    Signed-off-by: Colin Ian King <colin.king@canonical.com>
    Link: https://lore.kernel.org/r/20190920122030.14340-1-colin.king@canonical.com
    Acked-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 90391551afd8126afde0784133d77aa27f641a05
Author: Marian Mihailescu <mihailescu2m@gmail.com>
Date:   Tue Oct 29 11:20:25 2019 +1030

    clk: samsung: exynos5420: Preserve CPU clocks configuration during suspend/resume
    
    commit e21be0d1d7bd7f78a77613f6bcb6965e72b22fc1 upstream.
    
    Save and restore top PLL related configuration registers for big (APLL)
    and LITTLE (KPLL) cores during suspend/resume cycle. So far, CPU clocks
    were reset to default values after suspend/resume cycle and performance
    after system resume was affected when performance governor has been selected.
    
    Fixes: 773424326b51 ("clk: samsung: exynos5420: add more registers to restore list")
    Signed-off-by: Marian Mihailescu <mihailescu2m@gmail.com>
    Signed-off-by: Sylwester Nawrocki <s.nawrocki@samsung.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 66aa7e8ba443a06a0202063f1542eda5f408d465
Author: Alexander Usyskin <alexander.usyskin@intel.com>
Date:   Tue Oct 8 03:57:34 2019 +0300

    mei: fix modalias documentation
    
    commit 73668309215285366c433489de70d31362987be9 upstream.
    
    mei client bus added the client protocol version to the device alias,
    but ABI documentation was not updated.
    
    Fixes: b26864cad1c9 (mei: bus: add client protocol version to the device alias)
    Signed-off-by: Alexander Usyskin <alexander.usyskin@intel.com>
    Signed-off-by: Tomas Winkler <tomas.winkler@intel.com>
    Link: https://lore.kernel.org/r/20191008005735.12707-1-tomas.winkler@intel.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 48e5b2ceaf0e8fb89b6592b778baa199f3df11d0
Author: Alexandru Ardelean <alexandru.ardelean@analog.com>
Date:   Fri Nov 1 11:35:03 2019 +0200

    iio: imu: adis16480: assign bias value only if operation succeeded
    
    commit 9b742763d9d4195e823ae6ece760c9ed0500c1dc upstream.
    
    This was found only after the whole thing with the inline functions, but
    the compiler actually found something. The value of the `bias` (in
    adis16480_get_calibbias()) should only be set if the read operation was
    successful.
    
    No actual known problem occurs as users of this function all
    ultimately check the return value.  Hence probably not stable material.
    
    Fixes: 2f3abe6cbb6c9 ("iio:imu: Add support for the ADIS16480 and similar IMUs")
    Signed-off-by: Alexandru Ardelean <alexandru.ardelean@analog.com>
    Signed-off-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit da84bc4ff519197eae1b50ace0b3354561ceb624
Author: Trond Myklebust <trond.myklebust@hammerspace.com>
Date:   Wed Nov 13 09:39:36 2019 +0100

    NFSv4.x: Drop the slot if nfs4_delegreturn_prepare waits for layoutreturn
    
    commit 5326de9e94bedcf7366e7e7625d4deb8c1f1ca8a upstream.
    
    If nfs4_delegreturn_prepare needs to wait for a layoutreturn to complete
    then make sure we drop the sequence slot if we hold it.
    
    Fixes: 1c5bd76d17cc ("pNFS: Enable layoutreturn operation for return-on-close")
    Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 04b173066116b523c8bc5957e4e105865b3f7a33
Author: Trond Myklebust <trond.myklebust@hammerspace.com>
Date:   Fri Oct 4 17:01:54 2019 -0400

    NFSv2: Fix a typo in encode_sattr()
    
    commit ad97a995d8edff820d4238bd0dfc69f440031ae6 upstream.
    
    Encode the mtime correctly.
    
    Fixes: 95582b0083883 ("vfs: change inode times to use struct timespec64")
    Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 02d72fbeeae5b5d36da28462acd9698edccbb9b2
Author: Ard Biesheuvel <ardb@kernel.org>
Date:   Sat Nov 9 18:09:26 2019 +0100

    crypto: virtio - implement missing support for output IVs
    
    commit 500e6807ce93b1fdc7d5b827c5cc167cc35630db upstream.
    
    In order to allow for CBC to be chained, which is something that the
    CTS template relies upon, implementations of CBC need to pass the
    IV to be used for subsequent invocations via the IV buffer. This was
    not implemented yet for virtio-crypto so implement it now.
    
    Fixes: dbaf0624ffa5 ("crypto: add virtio-crypto driver")
    Cc: "Michael S. Tsirkin" <mst@redhat.com>
    Cc: Jason Wang <jasowang@redhat.com>
    Cc: Gonglei <arei.gonglei@huawei.com>
    Cc: virtualization@lists.linux-foundation.org
    Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f1e47dcc65e4198f7028a0fd3d012fc250568847
Author: Chuck Lever <chuck.lever@oracle.com>
Date:   Fri Jan 3 11:52:17 2020 -0500

    xprtrdma: Fix completion wait during device removal
    
    commit 13cb886c591f341a8759f175292ddf978ef903a1 upstream.
    
    I've found that on occasion, "rmmod <dev>" will hang while if an NFS
    is under load.
    
    Ensure that ri_remove_done is initialized only just before the
    transport is woken up to force a close. This avoids the completion
    possibly getting initialized again while the CM event handler is
    waiting for a wake-up.
    
    Fixes: bebd031866ca ("xprtrdma: Support unplugging an HCA from under an NFS mount")
    Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
    Signed-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b1152098d409d020b8ab494f24945fe81cf508ef
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Mon Jan 6 15:42:18 2020 +0100

    platform/x86: GPD pocket fan: Use default values when wrong modparams are given
    
    commit 6ae01050e49f0080ae30575d9b45a6d4a3d7ee23 upstream.
    
    Use our default values when wrong module-parameters are given, instead of
    refusing to load. Refusing to load leaves the fan at the BIOS default
    setting, which is "Off". The CPU's thermal throttling should protect the
    system from damage, but not-loading is really not the best fallback in this
    case.
    
    This commit fixes this by re-setting module-parameter values to their
    defaults if they are out of range, instead of failing the probe with
    -EINVAL.
    
    Cc: stable@vger.kernel.org
    Cc: Jason Anderson <jasona.594@gmail.com>
    Reported-by: Jason Anderson <jasona.594@gmail.com>
    Fixes: 594ce6db326e ("platform/x86: GPD pocket fan: Use a min-speed of 2 while charging")
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d847154df490d018cb850dbc17b621260b10d1e3
Author: Jian-Hong Pan <jian-hong@endlessm.com>
Date:   Mon Dec 30 16:30:45 2019 +0800

    platform/x86: asus-wmi: Fix keyboard brightness cannot be set to 0
    
    commit 176a7fca81c5090a7240664e3002c106d296bf31 upstream.
    
    Some of ASUS laptops like UX431FL keyboard backlight cannot be set to
    brightness 0. According to ASUS' information, the brightness should be
    0x80 ~ 0x83. This patch fixes it by following the logic.
    
    Fixes: e9809c0b9670 ("asus-wmi: add keyboard backlight support")
    Signed-off-by: Jian-Hong Pan <jian-hong@endlessm.com>
    Reviewed-by: Daniel Drake <drake@endlessm.com>
    Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e61a25a897db10686e2e0fc34689b2c01365e352
Author: Xiang Chen <chenxiang66@hisilicon.com>
Date:   Thu Jan 9 09:12:24 2020 +0800

    scsi: sd: Clear sdkp->protection_type if disk is reformatted without PI
    
    commit 465f4edaecc6c37f81349233e84d46246bcac11a upstream.
    
    If an attached disk with protection information enabled is reformatted
    to Type 0 the revalidation code does not clear the original protection
    type and subsequent accesses will keep setting RDPROTECT/WRPROTECT.
    
    Set the protection type to 0 if the disk reports PROT_EN=0 in READ
    CAPACITY(16).
    
    [mkp: commit desc]
    
    Fixes: fe542396da73 ("[SCSI] sd: Ensure we correctly disable devices with unknown protection type")
    Link: https://lore.kernel.org/r/1578532344-101668-1-git-send-email-chenxiang66@hisilicon.com
    Signed-off-by: Xiang Chen <chenxiang66@hisilicon.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a8d900e8ce47bd46279b763945383335bbdab7ed
Author: James Bottomley <James.Bottomley@HansenPartnership.com>
Date:   Wed Jan 8 17:21:32 2020 -0800

    scsi: enclosure: Fix stale device oops with hot replug
    
    commit 529244bd1afc102ab164429d338d310d5d65e60d upstream.
    
    Doing an add/remove/add on a SCSI device in an enclosure leads to an oops
    caused by poisoned values in the enclosure device list pointers.  The
    reason is because we are keeping the enclosure device across the enclosed
    device add/remove/add but the current code is doing a
    device_add/device_del/device_add on it.  This is the wrong thing to do in
    sysfs, so fix it by not doing a device_del on the enclosure device simply
    because of a hot remove of the drive in the slot.
    
    [mkp: added missing email addresses]
    
    Fixes: 43d8eb9cfd0a ("[SCSI] ses: add support for enclosure component hot removal")
    Link: https://lore.kernel.org/r/1578532892.3852.10.camel@HansenPartnership.com
    Signed-off-by: James Bottomley <James.Bottomley@HansenPartnership.com>
    Reported-by: Luo Jiaxing <luojiaxing@huawei.com>
    Tested-by: John Garry <john.garry@huawei.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6a02b3d19e914f23f76ffd8fe8cdb25f8e80d434
Author: Bart Van Assche <bvanassche@acm.org>
Date:   Tue Nov 5 13:46:32 2019 -0800

    RDMA/srpt: Report the SCSI residual to the initiator
    
    commit e88982ad1bb12db699de96fbc07096359ef6176c upstream.
    
    The code added by this patch is similar to the code that already exists in
    ibmvscsis_determine_resid(). This patch has been tested by running the
    following command:
    
    strace sg_raw -r 1k /dev/sdb 12 00 00 00 60 00 -o inquiry.bin |&
        grep resid=
    
    Link: https://lore.kernel.org/r/20191105214632.183302-1-bvanassche@acm.org
    Fixes: a42d985bd5b2 ("ib_srpt: Initial SRP Target merge for v3.3-rc1")
    Signed-off-by: Bart Van Assche <bvanassche@acm.org>
    Acked-by: Honggang Li <honli@redhat.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d872c9fcea1c3f674b7016d407cf7d0999c8754d
Author: Leon Romanovsky <leon@kernel.org>
Date:   Tue Oct 29 07:57:21 2019 +0200

    RDMA/mlx5: Return proper error value
    
    commit 546d30099ed204792083f043cd7e016de86016a3 upstream.
    
    Returned value from mlx5_mr_cache_alloc() is checked to be error or real
    pointer. Return proper error code instead of NULL which is not checked
    later.
    
    Fixes: 81713d3788d2 ("IB/mlx5: Add implicit MR support")
    Link: https://lore.kernel.org/r/20191029055721.7192-1-leon@kernel.org
    Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
    Reviewed-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 60dc79d678541a055076ac2cbef571e5d881334c
Author: Goldwyn Rodrigues <rgoldwyn@suse.com>
Date:   Wed Sep 11 11:45:15 2019 -0500

    btrfs: simplify inode locking for RWF_NOWAIT
    
    commit 9cf35f673583ccc9f3e2507498b3079d56614ad3 upstream.
    
    This is similar to 942491c9e6d6 ("xfs: fix AIM7 regression"). Apparently
    our current rwsem code doesn't like doing the trylock, then lock for
    real scheme. This causes extra contention on the lock and can be
    measured eg. by AIM7 benchmark.  So change our read/write methods to
    just do the trylock for the RWF_NOWAIT case.
    
    Fixes: edf064e7c6fe ("btrfs: nowait aio support")
    Signed-off-by: Goldwyn Rodrigues <rgoldwyn@suse.com>
    Reviewed-by: David Sterba <dsterba@suse.com>
    [ update changelog ]
    Signed-off-by: David Sterba <dsterba@suse.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8c2cdfb2c81bb533b9e6a3874ee5399102c4c580
Author: Christian König <christian.koenig@amd.com>
Date:   Wed Apr 10 11:43:43 2019 +0200

    drm/ttm: fix incrementing the page pointer for huge pages
    
    commit 453393369dc9806d2455151e329c599684762428 upstream.
    
    When we increment the counter we need to increment the pointer as well.
    
    Signed-off-by: Christian König <christian.koenig@amd.com>
    Fixes: e16858a7e6e7 drm/ttm: fix start page for huge page check in ttm_put_pages()
    Reviewed-by: Michel Dänzer <michel.daenzer@amd.com>
    Acked-by: Huang Rui <ray.huang@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Cc: Zubin Mithra <zsm@chromium.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 83a88fb92950ef34b9924c39ff7554ae92c9af69
Author: Christian König <christian.koenig@amd.com>
Date:   Tue Apr 2 09:29:35 2019 +0200

    drm/ttm: fix start page for huge page check in ttm_put_pages()
    
    commit ac1e516d5a4c56bf0cb4a3dfc0672f689131cfd4 upstream.
    
    The first page entry is always the same with itself.
    
    Signed-off-by: Christian König <christian.koenig@amd.com>
    Reviewed-by: Michel Dänzer <michel.daenzer@amd.com>
    Reviewed-by: Junwei Zhang <Jerry.Zhang@amd.com>
    Reviewed-by: Huang Rui <ray.huang@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Cc: Zubin Mithra <zsm@chromium.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a51dfaa20868ff6c17b03d19fbc0815553ed336b
Author: David Howells <dhowells@redhat.com>
Date:   Wed Dec 11 08:06:08 2019 +0000

    afs: Fix missing cell comparison in afs_test_super()
    
    commit 106bc79843c3c6f4f00753d1f46e54e815f99377 upstream.
    
    Fix missing cell comparison in afs_test_super().  Without this, any pair
    volumes that have the same volume ID will share a superblock, no matter the
    cell, unless they're in different network namespaces.
    
    Normally, most users will only deal with a single cell and so they won't
    see this.  Even if they do look into a second cell, they won't see a
    problem unless they happen to hit a volume with the same ID as one they've
    already got mounted.
    
    Before the patch:
    
        # ls /afs/grand.central.org/archive
        linuxdev/  mailman/  moin/  mysql/  pipermail/  stage/  twiki/
        # ls /afs/kth.se/
        linuxdev/  mailman/  moin/  mysql/  pipermail/  stage/  twiki/
        # cat /proc/mounts | grep afs
        none /afs afs rw,relatime,dyn,autocell 0 0
        #grand.central.org:root.cell /afs/grand.central.org afs ro,relatime 0 0
        #grand.central.org:root.archive /afs/grand.central.org/archive afs ro,relatime 0 0
        #grand.central.org:root.archive /afs/kth.se afs ro,relatime 0 0
    
    After the patch:
    
        # ls /afs/grand.central.org/archive
        linuxdev/  mailman/  moin/  mysql/  pipermail/  stage/  twiki/
        # ls /afs/kth.se/
        admin/        common/  install/  OldFiles/  service/  system/
        bakrestores/  home/    misc/     pkg/       src/      wsadmin/
        # cat /proc/mounts | grep afs
        none /afs afs rw,relatime,dyn,autocell 0 0
        #grand.central.org:root.cell /afs/grand.central.org afs ro,relatime 0 0
        #grand.central.org:root.archive /afs/grand.central.org/archive afs ro,relatime 0 0
        #kth.se:root.cell /afs/kth.se afs ro,relatime 0 0
    
    Fixes: ^1da177e4c3f4 ("Linux-2.6.12-rc2")
    Reported-by: Carsten Jacobi <jacobi@de.ibm.com>
    Signed-off-by: David Howells <dhowells@redhat.com>
    Reviewed-by: Marc Dionne <marc.dionne@auristor.com>
    Tested-by: Jonathan Billings <jsbillings@jsbillings.org>
    cc: Todd DeSantis <atd@us.ibm.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b524247efb99f27cbde4fbe8dd7b9caa88ae438b
Author: Nathan Chancellor <natechancellor@gmail.com>
Date:   Tue Dec 17 20:04:51 2019 -0700

    cifs: Adjust indentation in smb2_open_file
    
    commit 7935799e041ae10d380d04ea23868240f082bd11 upstream.
    
    Clang warns:
    
    ../fs/cifs/smb2file.c:70:3: warning: misleading indentation; statement
    is not part of the previous 'if' [-Wmisleading-indentation]
             if (oparms->tcon->use_resilient) {
             ^
    ../fs/cifs/smb2file.c:66:2: note: previous statement is here
            if (rc)
            ^
    1 warning generated.
    
    This warning occurs because there is a space after the tab on this line.
    Remove it so that the indentation is consistent with the Linux kernel
    coding style and clang no longer warns.
    
    Fixes: 592fafe644bf ("Add resilienthandles mount parm")
    Link: https://github.com/ClangBuiltLinux/linux/issues/826
    Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
    Signed-off-by: Steve French <stfrench@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 433e220d61e0ada76ca7c7ffdf154c445cf57542
Author: Alexandra Winter <wintera@linux.ibm.com>
Date:   Mon Dec 23 15:03:24 2019 +0100

    s390/qeth: Fix vnicc_is_in_use if rx_bcast not set
    
    commit e8a66d800471e2df7f0b484e2e46898b21d1fa82 upstream.
    
    Symptom: After vnicc/rx_bcast has been manually set to 0,
            bridge_* sysfs parameters can still be set or written.
    Only occurs on HiperSockets, as OSA doesn't support changing rx_bcast.
    
    Vnic characteristics and bridgeport settings are mutually exclusive.
    rx_bcast defaults to 1, so manually setting it to 0 should disable
    bridge_* parameters.
    
    Instead it makes sense here to check the supported mask. If the card
    does not support vnicc at all, bridge commands are always allowed.
    
    Fixes: caa1f0b10d18 ("s390/qeth: add VNICC enable/disable support")
    Signed-off-by: Alexandra Winter <wintera@linux.ibm.com>
    Signed-off-by: Julian Wiedmann <jwi@linux.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 82338445b99e80a7e275b22ff8db539852287126
Author: Alexandra Winter <wintera@linux.ibm.com>
Date:   Mon Dec 23 15:03:23 2019 +0100

    s390/qeth: fix false reporting of VNIC CHAR config failure
    
    commit 68c57bfd52836e31bff33e5e1fc64029749d2c35 upstream.
    
    Symptom: Error message "Configuring the VNIC characteristics failed"
    in dmesg whenever an OSA interface on z15 is set online.
    
    The VNIC characteristics get re-programmed when setting a L2 device
    online. This follows the selected 'wanted' characteristics - with the
    exception that the INVISIBLE characteristic unconditionally gets
    switched off.
    
    For devices that don't support INVISIBLE (ie. OSA), the resulting
    IO failure raises a noisy error message
    ("Configuring the VNIC characteristics failed").
    For IQD, INVISIBLE is off by default anyways.
    
    So don't unnecessarily special-case the INVISIBLE characteristic, and
    thereby suppress the misleading error message on OSA devices.
    
    Fixes: caa1f0b10d18 ("s390/qeth: add VNICC enable/disable support")
    Signed-off-by: Alexandra Winter <wintera@linux.ibm.com>
    Reviewed-by: Julian Wiedmann <jwi@linux.ibm.com>
    Signed-off-by: Julian Wiedmann <jwi@linux.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit eaf7b9d12ae9ae35e60eeaec55ef46db071e2c4b
Author: Taehee Yoo <ap420073@gmail.com>
Date:   Sun Dec 22 11:27:08 2019 +0000

    hsr: reset network header when supervision frame is created
    
    commit 3ed0a1d563903bdb4b4c36c58c4d9c1bcb23a6e6 upstream.
    
    The supervision frame is L2 frame.
    When supervision frame is created, hsr module doesn't set network header.
    If tap routine is enabled, dev_queue_xmit_nit() is called and it checks
    network_header. If network_header pointer wasn't set(or invalid),
    it resets network_header and warns.
    In order to avoid unnecessary warning message, resetting network_header
    is needed.
    
    Test commands:
        ip netns add nst
        ip link add veth0 type veth peer name veth1
        ip link add veth2 type veth peer name veth3
        ip link set veth1 netns nst
        ip link set veth3 netns nst
        ip link set veth0 up
        ip link set veth2 up
        ip link add hsr0 type hsr slave1 veth0 slave2 veth2
        ip a a 192.168.100.1/24 dev hsr0
        ip link set hsr0 up
        ip netns exec nst ip link set veth1 up
        ip netns exec nst ip link set veth3 up
        ip netns exec nst ip link add hsr1 type hsr slave1 veth1 slave2 veth3
        ip netns exec nst ip a a 192.168.100.2/24 dev hsr1
        ip netns exec nst ip link set hsr1 up
        tcpdump -nei veth0
    
    Splat looks like:
    [  175.852292][    C3] protocol 88fb is buggy, dev veth0
    
    Fixes: f421436a591d ("net/hsr: Add support for the High-availability Seamless Redundancy protocol (HSRv0)")
    Signed-off-by: Taehee Yoo <ap420073@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d64bec6c20016261ab69720e12e3f5a11911e825
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Wed Nov 27 10:59:19 2019 +0100

    gpio: Fix error message on out-of-range GPIO in lookup table
    
    commit d935bd50dd14a7714cbdba9a76435dbb56edb1ae upstream.
    
    When a GPIO offset in a lookup table is out-of-range, the printed error
    message (1) does not include the actual out-of-range value, and (2)
    contains an off-by-one error in the upper bound.
    
    Avoid user confusion by also printing the actual GPIO offset, and
    correcting the upper bound of the range.
    While at it, use "%u" for unsigned int.
    
    Sample impact:
    
        -requested GPIO 0 is out of range [0..32] for chip e6052000.gpio
        +requested GPIO 0 (45) is out of range [0..31] for chip e6052000.gpio
    
    Fixes: 2a3cf6a3599e9015 ("gpiolib: return -ENOENT if no GPIO mapping exists")
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Link: https://lore.kernel.org/r/20191127095919.4214-1-geert+renesas@glider.be
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d2cbb83ce8eae44f1d22012244887c09a926f876
Author: Jon Derrick <jonathan.derrick@intel.com>
Date:   Tue Dec 31 13:24:19 2019 -0700

    iommu: Remove device link to group on failure
    
    commit 7d4e6ccd1fb09dbfbc49746ca82bd5c25ad4bfe4 upstream.
    
    This adds the missing teardown step that removes the device link from
    the group when the device addition fails.
    
    Signed-off-by: Jon Derrick <jonathan.derrick@intel.com>
    Fixes: 797a8b4d768c5 ("iommu: Handle default domain attach failure")
    Reviewed-by: Lu Baolu <baolu.lu@linux.intel.com>
    Signed-off-by: Joerg Roedel <jroedel@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 44ce3acf595d4575fbae1f26dd0ad1e4e75d7bf0
Author: Swapna Manupati <swapna.manupati@xilinx.com>
Date:   Thu Dec 26 17:42:11 2019 +0530

    gpio: zynq: Fix for bug in zynq_gpio_restore_context API
    
    commit 36f2e7207f21a83ca0054116191f119ac64583ab upstream.
    
    This patch writes the inverse value of Interrupt Mask Status
    register into the Interrupt Enable register in
    zynq_gpio_restore_context API to fix the bug.
    
    Fixes: e11de4de28c0 ("gpio: zynq: Add support for suspend resume")
    Signed-off-by: Swapna Manupati <swapna.manupati@xilinx.com>
    Signed-off-by: Michal Simek <michal.simek@xilinx.com>
    Signed-off-by: Srinivas Neeli <srinivas.neeli@xilinx.com>
    Link: https://lore.kernel.org/r/1577362338-28744-2-git-send-email-srinivas.neeli@xilinx.com
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 077ac6b1a6b2d1ae2b8a9b5ebb534e794525c334
Author: Peter Ujfalusi <peter.ujfalusi@ti.com>
Date:   Tue Jan 7 10:45:44 2020 +0200

    mtd: onenand: omap2: Pass correct flags for prep_dma_memcpy
    
    commit 8bcef0d54067077cf9a6cb129022c77559926e8c upstream.
    
    The commit converting the driver to DMAengine was missing the flags for
    the memcpy prepare call.
    It went unnoticed since the omap-dma driver was ignoring them.
    
    Fixes: 3ed6a4d1de2c5 (" mtd: onenand: omap2: Convert to use dmaengine for memcp")
    Reported-by: Aaro Koskinen <aaro.koskinen@iki.fi>
    Signed-off-by: Peter Ujfalusi <peter.ujfalusi@ti.com>
    Tested-by: H. Nikolaus Schaller <hns@goldelico.com>
    Tested-by: Aaro Koskinen <aaro.koskinen@iki.fi>
    Signed-off-by: Miquel Raynal <miquel.raynal@bootlin.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7835b07257bb005c67a0d6e585db0d12c4c468a0
Author: Olivier Moysan <olivier.moysan@st.com>
Date:   Wed Dec 4 16:43:32 2019 +0100

    ASoC: stm32: spdifrx: fix race condition in irq handler
    
    commit 86e1956af4c863d653136fd6e5694adf2054dbaa upstream.
    
    When snd_pcm_stop() is called in interrupt routine,
    substream context may have already been released.
    Add protection on substream context.
    
    Fixes: 03e4d5d56fa5 ("ASoC: stm32: Add SPDIFRX support")
    
    Signed-off-by: Olivier Moysan <olivier.moysan@st.com>
    Link: https://lore.kernel.org/r/20191204154333.7152-3-olivier.moysan@st.com
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5063469c3d8a7c8d6f1a714ea287250a0e1b3956
Author: Olivier Moysan <olivier.moysan@st.com>
Date:   Wed Dec 4 16:43:31 2019 +0100

    ASoC: stm32: spdifrx: fix inconsistent lock state
    
    commit 2859b1784031b5709446af8f6039c467f136e67d upstream.
    
    In current spdifrx driver locks may be requested as follows:
    - request lock on iec capture control, when starting synchronization.
    - request lock in interrupt context, when spdifrx stop is called
    from IRQ handler.
    
    Take lock with IRQs disabled, to avoid the possible deadlock.
    
    Lockdep report:
    [   74.278059] ================================
    [   74.282306] WARNING: inconsistent lock state
    [   74.290120] --------------------------------
    ...
    [   74.314373]        CPU0
    [   74.314377]        ----
    [   74.314381]   lock(&(&spdifrx->lock)->rlock);
    [   74.314396]   <Interrupt>
    [   74.314400]     lock(&(&spdifrx->lock)->rlock);
    
    Fixes: 03e4d5d56fa5 ("ASoC: stm32: Add SPDIFRX support")
    
    Signed-off-by: Olivier Moysan <olivier.moysan@st.com>
    Link: https://lore.kernel.org/r/20191204154333.7152-2-olivier.moysan@st.com
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 57f633cfe3fbb97fec335de7906b9c5065a3c42c
Author: Daniel Baluta <daniel.baluta@nxp.com>
Date:   Wed Dec 4 17:13:33 2019 +0200

    ASoC: soc-core: Set dpcm_playback / dpcm_capture
    
    commit 218fe9b7ec7f32c10a07539365488d80af7b0084 upstream.
    
    When converting a normal link to a DPCM link we need
    to set dpcm_playback / dpcm_capture otherwise playback/capture
    streams will not be created resulting in errors like this:
    
    [   36.039111]  sai1-wm8960-hifi: ASoC: no backend playback stream
    
    Fixes: a655de808cbde ("ASoC: core: Allow topology to override machine driver FE DAI link config")
    Signed-off-by: Daniel Baluta <daniel.baluta@nxp.com>
    Link: https://lore.kernel.org/r/20191204151333.26625-1-daniel.baluta@nxp.com
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 10dfea16e4469165d3e997322384f994012d209a
Author: Selvin Xavier <selvin.xavier@broadcom.com>
Date:   Mon Nov 25 00:39:30 2019 -0800

    RDMA/bnxt_re: Fix Send Work Entry state check while polling completions
    
    commit c5275723580922e5f3264f96751337661a153c7d upstream.
    
    Some adapters need a fence Work Entry to handle retransmission.  Currently
    the driver checks for this condition, only if the Send queue entry is
    signalled. Implement the condition check, irrespective of the signalled
    state of the Work queue entries
    
    Failure to add the fence can result in access to memory that is already
    marked as completed, triggering data corruption, transmission failure,
    IOMMU failures, etc.
    
    Fixes: 9152e0b722b2 ("RDMA/bnxt_re: HW workarounds for handling specific conditions")
    Link: https://lore.kernel.org/r/1574671174-5064-3-git-send-email-selvin.xavier@broadcom.com
    Signed-off-by: Selvin Xavier <selvin.xavier@broadcom.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fef9e988729778dca5d724e42c68cc76df9c80b2
Author: Selvin Xavier <selvin.xavier@broadcom.com>
Date:   Mon Nov 25 00:39:29 2019 -0800

    RDMA/bnxt_re: Avoid freeing MR resources if dereg fails
    
    commit 9a4467a6b282a299b932608ac2c9034f8415359f upstream.
    
    The driver returns an error code for MR dereg, but frees the MR structure.
    When the MR dereg is retried due to previous error, the system crashes as
    the structure is already freed.
    
      BUG: unable to handle kernel NULL pointer dereference at 00000000000001b8
      PGD 0 P4D 0
      Oops: 0000 [#1] SMP PTI
      CPU: 7 PID: 12178 Comm: ib_send_bw Kdump: loaded Not tainted 4.18.0-124.el8.x86_64 #1
      Hardware name: Dell Inc. PowerEdge R430/03XKDV, BIOS 1.1.10 03/10/2015
      RIP: 0010:__dev_printk+0x2a/0x70
      Code: 0f 1f 44 00 00 49 89 d1 48 85 f6 0f 84 f6 2b 00 00 4c 8b 46 70 4d 85 c0 75 04 4c 8b
    46 10 48 8b 86 a8 00 00 00 48 85 c0 74 16 <48> 8b 08 0f be 7f 01 48 c7 c2 13 ac ac 83 83 ef 30 e9 10 fe ff ff
      RSP: 0018:ffffaf7c04607a60 EFLAGS: 00010006
      RAX: 00000000000001b8 RBX: ffffa0010c91c488 RCX: 0000000000000246
      RDX: ffffaf7c04607a68 RSI: ffffa0010c91caa8 RDI: ffffffff83a788eb
      RBP: ffffaf7c04607ac8 R08: 0000000000000000 R09: ffffaf7c04607a68
      R10: 0000000000000000 R11: 0000000000000001 R12: ffffaf7c04607b90
      R13: 000000000000000e R14: 0000000000000000 R15: 00000000ffffa001
      FS:  0000146fa1f1cdc0(0000) GS:ffffa0012fac0000(0000) knlGS:0000000000000000
      CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
      CR2: 00000000000001b8 CR3: 000000007680a003 CR4: 00000000001606e0
      Call Trace:
       dev_err+0x6c/0x90
       ? dev_printk_emit+0x4e/0x70
       bnxt_qplib_rcfw_send_message+0x594/0x660 [bnxt_re]
       ? dev_err+0x6c/0x90
       bnxt_qplib_free_mrw+0x80/0xe0 [bnxt_re]
       bnxt_re_dereg_mr+0x2e/0xd0 [bnxt_re]
       ib_dereg_mr+0x2f/0x50 [ib_core]
       destroy_hw_idr_uobject+0x20/0x70 [ib_uverbs]
       uverbs_destroy_uobject+0x2e/0x170 [ib_uverbs]
       __uverbs_cleanup_ufile+0x6e/0x90 [ib_uverbs]
       uverbs_destroy_ufile_hw+0x61/0x130 [ib_uverbs]
       ib_uverbs_close+0x1f/0x80 [ib_uverbs]
       __fput+0xb7/0x230
       task_work_run+0x8a/0xb0
       do_exit+0x2da/0xb40
    ...
      RIP: 0033:0x146fa113a387
      Code: Bad RIP value.
      RSP: 002b:00007fff945d1478 EFLAGS: 00000246 ORIG_RAX: ffffffffffffff02
      RAX: 0000000000000000 RBX: 000055a248908d70 RCX: 0000000000000000
      RDX: 0000146fa1f2b000 RSI: 0000000000000001 RDI: 000055a248906488
      RBP: 000055a248909630 R08: 0000000000010000 R09: 0000000000000000
      R10: 0000000000000000 R11: 0000000000000000 R12: 000055a248906488
      R13: 0000000000000001 R14: 0000000000000000 R15: 000055a2489095f0
    
    Do not free the MR structures, when driver returns error to the stack.
    
    Fixes: 872f3578241d ("RDMA/bnxt_re: Add support for MRs with Huge pages")
    Link: https://lore.kernel.org/r/1574671174-5064-2-git-send-email-selvin.xavier@broadcom.com
    Signed-off-by: Selvin Xavier <selvin.xavier@broadcom.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1c7e48bf27ce3ff4fb98cf0458ba80194448d0a7
Author: Ran Bi <ran.bi@mediatek.com>
Date:   Wed Dec 11 17:43:54 2019 +0800

    rtc: mt6397: fix alarm register overwrite
    
    commit 653997eeecef95c3ead4fba1b2d27e6a5854d6cd upstream.
    
    Alarm registers high byte was reserved for other functions.
    This add mask in alarm registers operation functions.
    This also fix error condition in interrupt handler.
    
    Fixes: fc2979118f3f ("rtc: mediatek: Add MT6397 RTC driver")
    
    Signed-off-by: Ran Bi <ran.bi@mediatek.com>
    Signed-off-by: Hsin-Hsiung Wang <hsin-hsiung.wang@mediatek.com>
    Link: https://lore.kernel.org/r/1576057435-3561-6-git-send-email-hsin-hsiung.wang@mediatek.com
    Signed-off-by: Alexandre Belloni <alexandre.belloni@bootlin.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit afb89cd5f2ba2d5d04b85b2692a9a3d86b6fabd7
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Tue Jan 14 18:39:37 2020 +0000

    drm/i915: Fix use-after-free when destroying GEM context
    
    This patch is a simplified fix to address a use-after-free in 4.14.x and
    4.19.x stable kernels. The flaw is already fixed upstream, starting in
    5.2, by commit 7dc40713618c ("drm/i915: Introduce a mutex for
    file_priv->context_idr") as part of a more complex patch series that
    isn't appropriate for backporting to stable kernels.
    
    Expand mutex coverage, while destroying the GEM context, to include the
    GEM context lookup step. This fixes a use-after-free detected by KASAN:
    
     ==================================================================
     BUG: KASAN: use-after-free in i915_ppgtt_close+0x2ca/0x2f0
     Write of size 1 at addr ffff8881368a8368 by task i915-poc/3124
    
     CPU: 0 PID: 3124 Comm: i915-poc Not tainted 4.14.164 #1
     Hardware name: HP HP Elite x2 1012 G1 /80FC, BIOS N85 Ver. 01.20 04/05/2017
     Call Trace:
      dump_stack+0xcd/0x12e
      ? _atomic_dec_and_lock+0x1b2/0x1b2
      ? i915_ppgtt_close+0x2ca/0x2f0
      ? printk+0x8f/0xab
      ? show_regs_print_info+0x53/0x53
      ? i915_ppgtt_close+0x2ca/0x2f0
      print_address_description+0x65/0x270
      ? i915_ppgtt_close+0x2ca/0x2f0
      kasan_report+0x251/0x340
      i915_ppgtt_close+0x2ca/0x2f0
      ? __radix_tree_insert+0x3f0/0x3f0
      ? i915_ppgtt_init_hw+0x7c0/0x7c0
      context_close+0x42e/0x680
      ? i915_gem_context_release+0x230/0x230
      ? kasan_kmalloc+0xa0/0xd0
      ? radix_tree_delete_item+0x1d4/0x250
      ? radix_tree_lookup+0x10/0x10
      ? inet_recvmsg+0x4b0/0x4b0
      ? kasan_slab_free+0x88/0xc0
      i915_gem_context_destroy_ioctl+0x236/0x300
      ? i915_gem_context_create_ioctl+0x360/0x360
      ? drm_dev_printk+0x1d0/0x1d0
      ? memcpy+0x34/0x50
      ? i915_gem_context_create_ioctl+0x360/0x360
      drm_ioctl_kernel+0x1b0/0x2b0
      ? drm_ioctl_permit+0x2a0/0x2a0
      ? avc_ss_reset+0xd0/0xd0
      drm_ioctl+0x6fe/0xa20
      ? i915_gem_context_create_ioctl+0x360/0x360
      ? drm_getstats+0x20/0x20
      ? put_unused_fd+0x260/0x260
      do_vfs_ioctl+0x189/0x12d0
      ? ioctl_preallocate+0x280/0x280
      ? selinux_file_ioctl+0x3a7/0x680
      ? selinux_bprm_set_creds+0xe30/0xe30
      ? security_file_ioctl+0x69/0xa0
      ? selinux_bprm_set_creds+0xe30/0xe30
      SyS_ioctl+0x6f/0x80
      ? __sys_sendmmsg+0x4a0/0x4a0
      ? do_vfs_ioctl+0x12d0/0x12d0
      do_syscall_64+0x214/0x5f0
      ? __switch_to_asm+0x31/0x60
      ? __switch_to_asm+0x25/0x60
      ? __switch_to_asm+0x31/0x60
      ? syscall_return_slowpath+0x2c0/0x2c0
      ? copy_overflow+0x20/0x20
      ? __switch_to_asm+0x25/0x60
      ? syscall_return_via_sysret+0x2a/0x7a
      ? prepare_exit_to_usermode+0x200/0x200
      ? __switch_to_asm+0x31/0x60
      ? __switch_to_asm+0x31/0x60
      ? __switch_to_asm+0x25/0x60
      ? __switch_to_asm+0x25/0x60
      ? __switch_to_asm+0x31/0x60
      ? __switch_to_asm+0x25/0x60
      ? __switch_to_asm+0x31/0x60
      ? __switch_to_asm+0x31/0x60
      ? __switch_to_asm+0x25/0x60
      entry_SYSCALL_64_after_hwframe+0x3d/0xa2
     RIP: 0033:0x7f7fda5115d7
     RSP: 002b:00007f7eec317ec8 EFLAGS: 00000286 ORIG_RAX: 0000000000000010
     RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f7fda5115d7
     RDX: 000055b306db9188 RSI: 000000004008646e RDI: 0000000000000003
     RBP: 00007f7eec317ef0 R08: 00007f7eec318700 R09: 0000000000000000
     R10: 0000000000000000 R11: 0000000000000286 R12: 00007f7eec317fc0
     R13: 0000000000000000 R14: 0000000000000000 R15: 00007ffd8007ade0
    
     Allocated by task 2898:
      save_stack+0x32/0xb0
      kasan_kmalloc+0xa0/0xd0
      kmem_cache_alloc_trace+0x5e/0x180
      i915_ppgtt_create+0xab/0x2510
      i915_gem_create_context+0x981/0xf90
      i915_gem_context_create_ioctl+0x1d7/0x360
      drm_ioctl_kernel+0x1b0/0x2b0
      drm_ioctl+0x6fe/0xa20
      do_vfs_ioctl+0x189/0x12d0
      SyS_ioctl+0x6f/0x80
      do_syscall_64+0x214/0x5f0
      entry_SYSCALL_64_after_hwframe+0x3d/0xa2
    
     Freed by task 104:
      save_stack+0x32/0xb0
      kasan_slab_free+0x72/0xc0
      kfree+0x88/0x190
      i915_ppgtt_release+0x24e/0x460
      i915_gem_context_free+0x90/0x480
      contexts_free_worker+0x54/0x80
      process_one_work+0x876/0x14e0
      worker_thread+0x1b8/0xfd0
      kthread+0x2f8/0x3c0
      ret_from_fork+0x35/0x40
    
     The buggy address belongs to the object at ffff8881368a8000
      which belongs to the cache kmalloc-8192 of size 8192
     The buggy address is located 872 bytes inside of
      8192-byte region [ffff8881368a8000, ffff8881368aa000)
     The buggy address belongs to the page:
     page:ffffea0004da2a00 count:1 mapcount:0 mapping:          (null) index:0x0 compound_mapcount: 0
     flags: 0x200000000008100(slab|head)
     raw: 0200000000008100 0000000000000000 0000000000000000 0000000100030003
     raw: dead000000000100 dead000000000200 ffff88822a002280 0000000000000000
     page dumped because: kasan: bad access detected
    
     Memory state around the buggy address:
      ffff8881368a8200: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
      ffff8881368a8280: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
     >ffff8881368a8300: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
                                                               ^
      ffff8881368a8380: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
      ffff8881368a8400: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
     ==================================================================
    
    Fixes: 1acfc104cdf8 ("drm/i915: Enable rcu-only context lookups")
    Reported-by: 罗权 <luoquan@qianxin.com>
    Cc: Chris Wilson <chris@chris-wilson.co.uk>
    Cc: Jon Bloomfield <jon.bloomfield@intel.com>
    Cc: stable@vger.kernel.org # 4.14.x
    Cc: stable@vger.kernel.org # 4.19.x
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e58c590c772eb5dc5a3603c5aef4148f47ab2e20
Author: YueHaibing <yuehaibing@huawei.com>
Date:   Mon Apr 1 09:35:54 2019 +0800

    dccp: Fix memleak in __feat_register_sp
    
    commit 1d3ff0950e2b40dc861b1739029649d03f591820 upstream.
    
    If dccp_feat_push_change fails, we forget free the mem
    which is alloced by kmemdup in dccp_feat_clone_sp_val.
    
    Reported-by: Hulk Robot <hulkci@huawei.com>
    Fixes: e8ef967a54f4 ("dccp: Registration routines for changing feature values")
    Reviewed-by: Mukesh Ojha <mojha@codeaurora.org>
    Signed-off-by: YueHaibing <yuehaibing@huawei.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Ben Hutchings <ben.hutchings@codethink.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d203ff6a3059b7fc3a9b48048eaf5641ed7fda2c
Author: Navid Emamdoost <navid.emamdoost@gmail.com>
Date:   Tue Sep 10 17:21:19 2019 -0500

    RDMA: Fix goto target to release the allocated memory
    
    commit 4a9d46a9fe14401f21df69cea97c62396d5fb053 upstream.
    
    In bnxt_re_create_srq(), when ib_copy_to_udata() fails allocated memory
    should be released by goto fail.
    
    Fixes: 37cb11acf1f7 ("RDMA/bnxt_re: Add SRQ support for Broadcom adapters")
    Link: https://lore.kernel.org/r/20190910222120.16517-1-navid.emamdoost@gmail.com
    Signed-off-by: Navid Emamdoost <navid.emamdoost@gmail.com>
    Reviewed-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Ben Hutchings <ben.hutchings@codethink.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6e41dd9731e13b0bdf2f57f84b9d25d009bd9f87
Author: Navid Emamdoost <navid.emamdoost@gmail.com>
Date:   Fri Sep 27 15:56:04 2019 -0500

    iwlwifi: pcie: fix memory leaks in iwl_pcie_ctxt_info_gen3_init
    
    commit 0f4f199443faca715523b0659aa536251d8b978f upstream.
    
    In iwl_pcie_ctxt_info_gen3_init there are cases that the allocated dma
    memory is leaked in case of error.
    
    DMA memories prph_scratch, prph_info, and ctxt_info_gen3 are allocated
    and initialized to be later assigned to trans_pcie. But in any error case
    before such assignment the allocated memories should be released.
    
    First of such error cases happens when iwl_pcie_init_fw_sec fails.
    Current implementation correctly releases prph_scratch. But in two
    sunsequent error cases where dma_alloc_coherent may fail, such
    releases are missing.
    
    This commit adds release for prph_scratch when allocation for
    prph_info fails, and adds releases for prph_scratch and prph_info when
    allocation for ctxt_info_gen3 fails.
    
    Fixes: 2ee824026288 ("iwlwifi: pcie: support context information for 22560 devices")
    Signed-off-by: Navid Emamdoost <navid.emamdoost@gmail.com>
    Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
    Signed-off-by: Ben Hutchings <ben.hutchings@codethink.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 09044a4a142404799e519def0bbfcc98fa68c677
Author: Navid Emamdoost <navid.emamdoost@gmail.com>
Date:   Thu Sep 12 23:23:27 2019 -0500

    iwlwifi: dbg_ini: fix memory leak in alloc_sgtable
    
    commit b4b814fec1a5a849383f7b3886b654a13abbda7d upstream.
    
    In alloc_sgtable if alloc_page fails, the alocated table should be
    released.
    
    Signed-off-by: Navid Emamdoost <navid.emamdoost@gmail.com>
    Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
    Signed-off-by: Ben Hutchings <ben.hutchings@codethink.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0648766cb7d336e5932278c316aef6aac35d60ab
Author: Vandana BN <bnvandana@gmail.com>
Date:   Wed May 22 04:34:15 2019 -0400

    media: usb:zr364xx:Fix KASAN:null-ptr-deref Read in zr364xx_vidioc_querycap
    
    commit 5d2e73a5f80a5b5aff3caf1ec6d39b5b3f54b26e upstream.
    
    SyzKaller hit the null pointer deref while reading from uninitialized
    udev->product in zr364xx_vidioc_querycap().
    
    ==================================================================
    BUG: KASAN: null-ptr-deref in read_word_at_a_time+0xe/0x20
    include/linux/compiler.h:274
    Read of size 1 at addr 0000000000000000 by task v4l_id/5287
    
    CPU: 1 PID: 5287 Comm: v4l_id Not tainted 5.1.0-rc3-319004-g43151d6 #6
    Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS
    Google 01/01/2011
    Call Trace:
      __dump_stack lib/dump_stack.c:77 [inline]
      dump_stack+0xe8/0x16e lib/dump_stack.c:113
      kasan_report.cold+0x5/0x3c mm/kasan/report.c:321
      read_word_at_a_time+0xe/0x20 include/linux/compiler.h:274
      strscpy+0x8a/0x280 lib/string.c:207
      zr364xx_vidioc_querycap+0xb5/0x210 drivers/media/usb/zr364xx/zr364xx.c:706
      v4l_querycap+0x12b/0x340 drivers/media/v4l2-core/v4l2-ioctl.c:1062
      __video_do_ioctl+0x5bb/0xb40 drivers/media/v4l2-core/v4l2-ioctl.c:2874
      video_usercopy+0x44e/0xf00 drivers/media/v4l2-core/v4l2-ioctl.c:3056
      v4l2_ioctl+0x14e/0x1a0 drivers/media/v4l2-core/v4l2-dev.c:364
      vfs_ioctl fs/ioctl.c:46 [inline]
      file_ioctl fs/ioctl.c:509 [inline]
      do_vfs_ioctl+0xced/0x12f0 fs/ioctl.c:696
      ksys_ioctl+0xa0/0xc0 fs/ioctl.c:713
      __do_sys_ioctl fs/ioctl.c:720 [inline]
      __se_sys_ioctl fs/ioctl.c:718 [inline]
      __x64_sys_ioctl+0x74/0xb0 fs/ioctl.c:718
      do_syscall_64+0xcf/0x4f0 arch/x86/entry/common.c:290
      entry_SYSCALL_64_after_hwframe+0x49/0xbe
    RIP: 0033:0x7f3b56d8b347
    Code: 90 90 90 48 8b 05 f1 fa 2a 00 64 c7 00 26 00 00 00 48 c7 c0 ff ff ff
    ff c3 90 90 90 90 90 90 90 90 90 90 b8 10 00 00 00 0f 05 <48> 3d 01 f0 ff
    ff 73 01 c3 48 8b 0d c1 fa 2a 00 31 d2 48 29 c2 64
    RSP: 002b:00007ffe005d5d68 EFLAGS: 00000202 ORIG_RAX: 0000000000000010
    RAX: ffffffffffffffda RBX: 0000000000000003 RCX: 00007f3b56d8b347
    RDX: 00007ffe005d5d70 RSI: 0000000080685600 RDI: 0000000000000003
    RBP: 0000000000000000 R08: 0000000000000000 R09: 0000000000000000
    R10: 0000000000000000 R11: 0000000000000202 R12: 0000000000400884
    R13: 00007ffe005d5ec0 R14: 0000000000000000 R15: 0000000000000000
    ==================================================================
    
    For this device udev->product is not initialized and accessing it causes a NULL pointer deref.
    
    The fix is to check for NULL before strscpy() and copy empty string, if
    product is NULL
    
    Reported-by: syzbot+66010012fd4c531a1a96@syzkaller.appspotmail.com
    Signed-off-by: Vandana BN <bnvandana@gmail.com>
    Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    [bwh: Backported to 4.19: This function uses strlcpy() instead of strscpy()]
    Signed-off-by: Ben Hutchings <ben.hutchings@codethink.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4124927e36b7753efb6faf1a508e2bc6783343cf
Author: Sheng Yong <shengyong1@huawei.com>
Date:   Mon Jan 7 15:02:34 2019 +0800

    f2fs: check if file namelen exceeds max value
    
    commit 720db068634c91553a8e1d9a0fcd8c7050e06d2b upstream.
    
    Dentry bitmap is not enough to detect incorrect dentries. So this patch
    also checks the namelen value of a dentry.
    
    Signed-off-by: Gong Chen <gongchen4@huawei.com>
    Signed-off-by: Sheng Yong <shengyong1@huawei.com>
    Reviewed-by: Chao Yu <yuchao0@huawei.com>
    Signed-off-by: Jaegeuk Kim <jaegeuk@kernel.org>
    Signed-off-by: Ben Hutchings <ben.hutchings@codethink.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1137c1d4b1c19a6a567d82415c2d2c0ea8a8686d
Author: Jaegeuk Kim <jaegeuk@kernel.org>
Date:   Wed Nov 14 12:40:30 2018 -0800

    f2fs: check memory boundary by insane namelen
    
    commit 4e240d1bab1ead280ddf5eb05058dba6bbd57d10 upstream.
    
    If namelen is corrupted to have very long value, fill_dentries can copy
    wrong memory area.
    
    Reviewed-by: Chao Yu <yuchao0@huawei.com>
    Signed-off-by: Jaegeuk Kim <jaegeuk@kernel.org>
    Signed-off-by: Ben Hutchings <ben.hutchings@codethink.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2d57c0a67e331549ebab59432300fc1b1ed5cf84
Author: Ben Hutchings <ben.hutchings@codethink.co.uk>
Date:   Mon Jan 13 23:20:07 2020 +0000

    f2fs: Move err variable to function scope in f2fs_fill_dentries()
    
    This is preparation for the following backported fixes.  It was done
    upstream as part of commit e1293bdfa01d "f2fs: plug readahead IO in
    readdir()", the rest of which does not seem suitable for stable.
    
    Cc: Jaegeuk Kim <jaegeuk@kernel.org>
    Cc: Chao Yu <yuchao0@huawei.com>
    Signed-off-by: Ben Hutchings <ben.hutchings@codethink.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8f483142b0bb278f67eabccbe3d6a0e8c45284ad
Author: Jouni Malinen <jouni@codeaurora.org>
Date:   Wed Sep 11 16:03:05 2019 +0300

    mac80211: Do not send Layer 2 Update frame before authorization
    
    commit 3e493173b7841259a08c5c8e5cbe90adb349da7e upstream.
    
    The Layer 2 Update frame is used to update bridges when a station roams
    to another AP even if that STA does not transmit any frames after the
    reassociation. This behavior was described in IEEE Std 802.11F-2003 as
    something that would happen based on MLME-ASSOCIATE.indication, i.e.,
    before completing 4-way handshake. However, this IEEE trial-use
    recommended practice document was published before RSN (IEEE Std
    802.11i-2004) and as such, did not consider RSN use cases. Furthermore,
    IEEE Std 802.11F-2003 was withdrawn in 2006 and as such, has not been
    maintained amd should not be used anymore.
    
    Sending out the Layer 2 Update frame immediately after association is
    fine for open networks (and also when using SAE, FT protocol, or FILS
    authentication when the station is actually authenticated by the time
    association completes). However, it is not appropriate for cases where
    RSN is used with PSK or EAP authentication since the station is actually
    fully authenticated only once the 4-way handshake completes after
    authentication and attackers might be able to use the unauthenticated
    triggering of Layer 2 Update frame transmission to disrupt bridge
    behavior.
    
    Fix this by postponing transmission of the Layer 2 Update frame from
    station entry addition to the point when the station entry is marked
    authorized. Similarly, send out the VLAN binding update only if the STA
    entry has already been authorized.
    
    Signed-off-by: Jouni Malinen <jouni@codeaurora.org>
    Reviewed-by: Johannes Berg <johannes@sipsolutions.net>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Ben Hutchings <ben.hutchings@codethink.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 85fa006ff2508946474e3f648e4be55fa8b44def
Author: Dedy Lansky <dlansky@codeaurora.org>
Date:   Sun Jul 29 14:59:16 2018 +0300

    cfg80211/mac80211: make ieee80211_send_layer2_update a public function
    
    commit 30ca1aa536211f5ac3de0173513a7a99a98a97f3 upstream.
    
    Make ieee80211_send_layer2_update() a common function so other drivers
    can re-use it.
    
    Signed-off-by: Dedy Lansky <dlansky@codeaurora.org>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    [bwh: Backported to 4.19 as dependency of commit 3e493173b784
     "mac80211: Do not send Layer 2 Update frame before authorization"]
    Signed-off-by: Ben Hutchings <ben.hutchings@codethink.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e5caf1d5ff187eff5f23c145b72300187041b46f
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Tue May 14 15:41:42 2019 -0700

    fs/select: avoid clang stack usage warning
    
    commit ad312f95d41c9de19313c51e388c4984451c010f upstream.
    
    The select() implementation is carefully tuned to put a sensible amount
    of data on the stack for holding a copy of the user space fd_set, but
    not too large to risk overflowing the kernel stack.
    
    When building a 32-bit kernel with clang, we need a little more space
    than with gcc, which often triggers a warning:
    
      fs/select.c:619:5: error: stack frame size of 1048 bytes in function 'core_sys_select' [-Werror,-Wframe-larger-than=]
      int core_sys_select(int n, fd_set __user *inp, fd_set __user *outp,
    
    I experimentally found that for 32-bit ARM, reducing the maximum stack
    usage by 64 bytes keeps us reliably under the warning limit again.
    
    Link: http://lkml.kernel.org/r/20190307090146.1874906-1-arnd@arndb.de
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Reviewed-by: Andi Kleen <ak@linux.intel.com>
    Cc: Nick Desaulniers <ndesaulniers@google.com>
    Cc: Alexander Viro <viro@zeniv.linux.org.uk>
    Cc: Christoph Hellwig <hch@lst.de>
    Cc: Eric Dumazet <edumazet@google.com>
    Cc: "Darrick J. Wong" <darrick.wong@oracle.com>
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Miles Chen <miles.chen@mediatek.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 81f7503fb41bf734bfc7ce2d38bb537d3c15214b
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Thu Mar 7 16:58:35 2019 +0100

    ethtool: reduce stack usage with clang
    
    commit 3499e87ea0413ee5b2cc028f4c8ed4d424bc7f98 upstream.
    
    clang inlines the dev_ethtool() more aggressively than gcc does, leading
    to a larger amount of used stack space:
    
    net/core/ethtool.c:2536:24: error: stack frame size of 1216 bytes in function 'dev_ethtool' [-Werror,-Wframe-larger-than=]
    
    Marking the sub-functions that require the most stack space as
    noinline_for_stack gives us reasonable behavior on all compilers.
    
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Reviewed-by: Michal Kubecek <mkubecek@suse.cz>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Miles Chen <miles.chen@mediatek.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 30db8e400c4db194df58562ed884fa79899834e5
Author: Jiri Kosina <jkosina@suse.cz>
Date:   Fri Jan 10 15:32:51 2020 +0100

    HID: hidraw, uhid: Always report EPOLLOUT
    
    [ Upstream commit 9e635c2851df6caee651e589fbf937b637973c91 ]
    
    hidraw and uhid device nodes are always available for writing so we should
    always report EPOLLOUT and EPOLLWRNORM bits, not only in the cases when
    there is nothing to read.
    
    Reported-by: Linus Torvalds <torvalds@linux-foundation.org>
    Fixes: be54e7461ffdc ("HID: uhid: Fix returning EPOLLOUT from uhid_char_poll")
    Fixes: 9f3b61dc1dd7b ("HID: hidraw: Fix returning EPOLLOUT from hidraw_poll")
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b62df58cd6afa9fe2d19987e66b11b43b1763935
Author: Marcel Holtmann <marcel@holtmann.org>
Date:   Wed Dec 4 03:37:13 2019 +0100

    HID: hidraw: Fix returning EPOLLOUT from hidraw_poll
    
    [ Upstream commit 9f3b61dc1dd7b81e99e7ed23776bb64a35f39e1a ]
    
    When polling a connected /dev/hidrawX device, it is useful to get the
    EPOLLOUT when writing is possible. Since writing is possible as soon as
    the device is connected, always return it.
    
    Right now EPOLLOUT is only returned when there are also input reports
    are available. This works if devices start sending reports when
    connected, but some HID devices might need an output report first before
    sending any input reports. This change will allow using EPOLLOUT here as
    well.
    
    Fixes: 378b80370aa1 ("hidraw: Return EPOLLOUT from hidraw_poll")
    Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
    Cc: stable@vger.kernel.org
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d2178fc8fda3e045dab9f916c045b408bbd0d006
Author: Fabian Henneke <fabian.henneke@gmail.com>
Date:   Tue Jul 9 13:03:37 2019 +0200

    hidraw: Return EPOLLOUT from hidraw_poll
    
    [ Upstream commit 378b80370aa1fe50f9c48a3ac8af3e416e73b89f ]
    
    Always return EPOLLOUT from hidraw_poll when a device is connected.
    This is safe since writes are always possible (but will always block).
    
    hidraw does not support non-blocking writes and instead always calls
    blocking backend functions on write requests. Hence, so far, a call to
    poll never returned EPOLLOUT, which confuses tools like socat.
    
    Signed-off-by: Fabian Henneke <fabian.henneke@gmail.com>
    In-reply-to: <CA+hv5qkyis03CgYTWeWX9cr0my-d2Oe+aZo+mjmWRXgjrGqyrw@mail.gmail.com>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Sasha Levin <sashal@kernel.org>
