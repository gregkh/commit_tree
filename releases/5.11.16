commit e2d9bf3473cc6eed316d69500df52854233bce00
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Wed Apr 21 13:13:29 2021 +0200

    Linux 5.11.16
    
    Tested-by: Fox Chen <foxhlchen@gmail.com>
    Tested-by: Jason Self <jason@bluehome.net>
    Tested-by: Shuah Khan <skhan@linuxfoundation.org>
    Tested-by: Guenter Roeck <linux@roeck-us.net>
    Tested-by: Jon Hunter <jonathanh@nvidia.com>
    Tested-by: Linux Kernel Functional Testing <lkft@linaro.org>
    Link: https://lore.kernel.org/r/20210419130530.166331793@linuxfoundation.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8a39972ed3cec42163abc71787d7fc11bf316c78
Author: Daniel Borkmann <daniel@iogearbox.net>
Date:   Wed Mar 24 11:25:39 2021 +0100

    bpf: Move sanitize_val_alu out of op switch
    
    commit f528819334881fd622fdadeddb3f7edaed8b7c9b upstream.
    
    Add a small sanitize_needed() helper function and move sanitize_val_alu()
    out of the main opcode switch. In upcoming work, we'll move sanitize_ptr_alu()
    as well out of its opcode switch so this helps to streamline both.
    
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Reviewed-by: John Fastabend <john.fastabend@gmail.com>
    Acked-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5cba7ca00dae28bec6e13684b7a0ec83c64cd72e
Author: Daniel Borkmann <daniel@iogearbox.net>
Date:   Tue Mar 23 09:30:01 2021 +0100

    bpf: Improve verifier error messages for users
    
    commit a6aaece00a57fa6f22575364b3903dfbccf5345d upstream.
    
    Consolidate all error handling and provide more user-friendly error messages
    from sanitize_ptr_alu() and sanitize_val_alu().
    
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Reviewed-by: John Fastabend <john.fastabend@gmail.com>
    Acked-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4aa1f14c519b96c66b63fb16122d6c3a04680bc6
Author: Daniel Borkmann <daniel@iogearbox.net>
Date:   Tue Mar 23 09:04:10 2021 +0100

    bpf: Rework ptr_limit into alu_limit and add common error path
    
    commit b658bbb844e28f1862867f37e8ca11a8e2aa94a3 upstream.
    
    Small refactor with no semantic changes in order to consolidate the max
    ptr_limit boundary check.
    
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Reviewed-by: John Fastabend <john.fastabend@gmail.com>
    Acked-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 82975b044a332bea038b13621b6ac7549b75d0ae
Author: Fredrik Strupe <fredrik@strupe.net>
Date:   Mon Apr 5 21:52:05 2021 +0100

    ARM: 9071/1: uprobes: Don't hook on thumb instructions
    
    commit d2f7eca60b29006285d57c7035539e33300e89e5 upstream.
    
    Since uprobes is not supported for thumb, check that the thumb bit is
    not set when matching the uprobes instruction hooks.
    
    The Arm UDF instructions used for uprobes triggering
    (UPROBE_SWBP_ARM_INSN and UPROBE_SS_ARM_INSN) coincidentally share the
    same encoding as a pair of unallocated 32-bit thumb instructions (not
    UDF) when the condition code is 0b1111 (0xf). This in effect makes it
    possible to trigger the uprobes functionality from thumb, and at that
    using two unallocated instructions which are not permanently undefined.
    
    Signed-off-by: Fredrik Strupe <fredrik@strupe.net>
    Cc: stable@vger.kernel.org
    Fixes: c7edc9e326d5 ("ARM: add uprobes support")
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit af2bb00759b8810ec652a57d73158baf5a7b3a59
Author: Daniel Borkmann <daniel@iogearbox.net>
Date:   Mon Mar 22 15:45:52 2021 +0100

    bpf: Move off_reg into sanitize_ptr_alu
    
    [ Upstream commit 6f55b2f2a1178856c19bbce2f71449926e731914 ]
    
    Small refactor to drag off_reg into sanitize_ptr_alu(), so we later on can
    use off_reg for generalizing some of the checks for all pointer types.
    
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Reviewed-by: John Fastabend <john.fastabend@gmail.com>
    Acked-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 1611010fa388974b61cd6362c49d3fd1e31e2126
Author: Daniel Borkmann <daniel@iogearbox.net>
Date:   Tue Mar 23 08:51:02 2021 +0100

    bpf: Ensure off_reg has no mixed signed bounds for all types
    
    [ Upstream commit 24c109bb1537c12c02aeed2d51a347b4d6a9b76e ]
    
    The mixed signed bounds check really belongs into retrieve_ptr_limit()
    instead of outside of it in adjust_ptr_min_max_vals(). The reason is
    that this check is not tied to PTR_TO_MAP_VALUE only, but to all pointer
    types that we handle in retrieve_ptr_limit() and given errors from the latter
    propagate back to adjust_ptr_min_max_vals() and lead to rejection of the
    program, it's a better place to reside to avoid anything slipping through
    for future types. The reason why we must reject such off_reg is that we
    otherwise would not be able to derive a mask, see details in 9d7eceede769
    ("bpf: restrict unknown scalars of mixed signed bounds for unprivileged").
    
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Reviewed-by: John Fastabend <john.fastabend@gmail.com>
    Acked-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 0c197aa38386054d3e9c3379c682608db0151439
Author: Heiner Kallweit <hkallweit1@gmail.com>
Date:   Wed Apr 14 10:47:10 2021 +0200

    r8169: don't advertise pause in jumbo mode
    
    [ Upstream commit 453a77894efa4d9b6ef9644d74b9419c47ac427c ]
    
    It has been reported [0] that using pause frames in jumbo mode impacts
    performance. There's no available chip documentation, but vendor
    drivers r8168 and r8125 don't advertise pause in jumbo mode. So let's
    do the same, according to Roman it fixes the issue.
    
    [0] https://bugzilla.kernel.org/show_bug.cgi?id=212617
    
    Fixes: 9cf9b84cc701 ("r8169: make use of phy_set_asym_pause")
    Reported-by: Roman Mamedov <rm+bko@romanrm.net>
    Tested-by: Roman Mamedov <rm+bko@romanrm.net>
    Signed-off-by: Heiner Kallweit <hkallweit1@gmail.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 2923483afcbf549c40e499ef5496519d8653e09c
Author: Heiner Kallweit <hkallweit1@gmail.com>
Date:   Sat Jan 9 23:01:18 2021 +0100

    r8169: tweak max read request size for newer chips also in jumbo mtu mode
    
    [ Upstream commit 5e00e16cb98935bcf06f51931876d898c226f65c ]
    
    So far we don't increase the max read request size if we switch to
    jumbo mode before bringing up the interface for the first time.
    Let's change this.
    
    Signed-off-by: Heiner Kallweit <hkallweit1@gmail.com>
    Signed-off-by: Jakub Kicinski <kuba@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 86463b30e4ef70c4551a94cb68b5a667c2e00846
Author: Walter Wu <walter-zh.wu@mediatek.com>
Date:   Fri Apr 16 15:46:00 2021 -0700

    kasan: remove redundant config option
    
    [ Upstream commit 02c587733c8161355a43e6e110c2e29bd0acff72 ]
    
    CONFIG_KASAN_STACK and CONFIG_KASAN_STACK_ENABLE both enable KASAN stack
    instrumentation, but we should only need one config, so that we remove
    CONFIG_KASAN_STACK_ENABLE and make CONFIG_KASAN_STACK workable.  see [1].
    
    When enable KASAN stack instrumentation, then for gcc we could do no
    prompt and default value y, and for clang prompt and default value n.
    
    This patch fixes the following compilation warning:
    
      include/linux/kasan.h:333:30: warning: 'CONFIG_KASAN_STACK' is not defined, evaluates to 0 [-Wundef]
    
    [akpm@linux-foundation.org: fix merge snafu]
    
    Link: https://bugzilla.kernel.org/show_bug.cgi?id=210221 [1]
    Link: https://lkml.kernel.org/r/20210226012531.29231-1-walter-zh.wu@mediatek.com
    Fixes: d9b571c885a8 ("kasan: fix KASAN_STACK dependency for HW_TAGS")
    Signed-off-by: Walter Wu <walter-zh.wu@mediatek.com>
    Suggested-by: Dmitry Vyukov <dvyukov@google.com>
    Reviewed-by: Nathan Chancellor <natechancellor@gmail.com>
    Acked-by: Arnd Bergmann <arnd@arndb.de>
    Reviewed-by: Andrey Konovalov <andreyknvl@google.com>
    Cc: Andrey Ryabinin <ryabinin.a.a@gmail.com>
    Cc: Dmitry Vyukov <dvyukov@google.com>
    Cc: Alexander Potapenko <glider@google.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit cb9febcf7d8b3e1e18380d66972d8f632dc1a988
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Fri Apr 16 15:45:57 2021 -0700

    kasan: fix hwasan build for gcc
    
    [ Upstream commit 5c595ac4c776c44b5c59de22ab43b3fe256d9fbb ]
    
    gcc-11 adds support for -fsanitize=kernel-hwaddress, so it becomes
    possible to enable CONFIG_KASAN_SW_TAGS.
    
    Unfortunately this fails to build at the moment, because the
    corresponding command line arguments use llvm specific syntax.
    
    Change it to use the cc-param macro instead, which works on both clang
    and gcc.
    
    [elver@google.com: fixup for "kasan: fix hwasan build for gcc"]
      Link: https://lkml.kernel.org/r/YHQZVfVVLE/LDK2v@elver.google.com
    
    Link: https://lkml.kernel.org/r/20210323124112.1229772-1-arnd@kernel.org
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Marco Elver <elver@google.com>
    Reviewed-by: Marco Elver <elver@google.com>
    Acked-by: Andrey Konovalov <andreyknvl@gmail.com>
    Cc: Masahiro Yamada <masahiroy@kernel.org>
    Cc: Michal Marek <michal.lkml@markovi.net>
    Cc: Andrey Ryabinin <ryabinin.a.a@gmail.com>
    Cc: Nathan Chancellor <nathan@kernel.org>
    Cc: Nick Desaulniers <ndesaulniers@google.com>
    Cc: Alexander Potapenko <glider@google.com>
    Cc: Dmitry Vyukov <dvyukov@google.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit ce541d7b59566a0d94c7c99bfb5d34b050e6af70
Author: Reiji Watanabe <reijiw@google.com>
Date:   Tue Apr 13 15:47:40 2021 +0000

    KVM: VMX: Don't use vcpu->run->internal.ndata as an array index
    
    [ Upstream commit 04c4f2ee3f68c9a4bf1653d15f1a9a435ae33f7a ]
    
    __vmx_handle_exit() uses vcpu->run->internal.ndata as an index for
    an array access.  Since vcpu->run is (can be) mapped to a user address
    space with a writer permission, the 'ndata' could be updated by the
    user process at anytime (the user process can set it to outside the
    bounds of the array).
    So, it is not safe that __vmx_handle_exit() uses the 'ndata' that way.
    
    Fixes: 1aa561b1a4c0 ("kvm: x86: Add "last CPU" to some KVM_EXIT information")
    Signed-off-by: Reiji Watanabe <reijiw@google.com>
    Reviewed-by: Jim Mattson <jmattson@google.com>
    Message-Id: <20210413154739.490299-1-reijiw@google.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 49988daf77889eada955daec694a83601104750d
Author: Sean Christopherson <seanjc@google.com>
Date:   Fri Nov 6 17:03:12 2020 +0800

    KVM: VMX: Convert vcpu_vmx.exit_reason to a union
    
    [ Upstream commit 8e53324021645f820a01bf8aa745711c802c8542 ]
    
    Convert vcpu_vmx.exit_reason from a u32 to a union (of size u32).  The
    full VM_EXIT_REASON field is comprised of a 16-bit basic exit reason in
    bits 15:0, and single-bit modifiers in bits 31:16.
    
    Historically, KVM has only had to worry about handling the "failed
    VM-Entry" modifier, which could only be set in very specific flows and
    required dedicated handling.  I.e. manually stripping the FAILED_VMENTRY
    bit was a somewhat viable approach.  But even with only a single bit to
    worry about, KVM has had several bugs related to comparing a basic exit
    reason against the full exit reason store in vcpu_vmx.
    
    Upcoming Intel features, e.g. SGX, will add new modifier bits that can
    be set on more or less any VM-Exit, as opposed to the significantly more
    restricted FAILED_VMENTRY, i.e. correctly handling everything in one-off
    flows isn't scalable.  Tracking exit reason in a union forces code to
    explicitly choose between consuming the full exit reason and the basic
    exit, and is a convenient way to document and access the modifiers.
    
    No functional change intended.
    
    Cc: Xiaoyao Li <xiaoyao.li@intel.com>
    Signed-off-by: Sean Christopherson <sean.j.christopherson@intel.com>
    Signed-off-by: Chenyi Qiang <chenyi.qiang@intel.com>
    Message-Id: <20201106090315.18606-2-chenyi.qiang@intel.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4ccdc6c6cae38b91c871293fb0ed8c6845a61b51
Author: Daniel Borkmann <daniel@iogearbox.net>
Date:   Tue Mar 23 08:32:59 2021 +0100

    bpf: Use correct permission flag for mixed signed bounds arithmetic
    
    [ Upstream commit 9601148392520e2e134936e76788fc2a6371e7be ]
    
    We forbid adding unknown scalars with mixed signed bounds due to the
    spectre v1 masking mitigation. Hence this also needs bypass_spec_v1
    flag instead of allow_ptr_leaks.
    
    Fixes: 2c78ee898d8f ("bpf: Implement CAP_BPF")
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Reviewed-by: John Fastabend <john.fastabend@gmail.com>
    Acked-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 8428409389cb52aa9eb548dcce9c9c22f66ca5aa
Author: Jernej Skrabec <jernej.skrabec@siol.net>
Date:   Tue Mar 30 20:42:18 2021 +0200

    arm64: dts: allwinner: h6: beelink-gs1: Remove ext. 32 kHz osc reference
    
    [ Upstream commit 7a2f6e69e9c1060a7a09c1f8322ccb8d942b3078 ]
    
    Although every Beelink GS1 seems to have external 32768 Hz oscillator,
    it works only on one from four tested. There are more reports of RTC
    issues elsewhere, like Armbian forum.
    
    One Beelink GS1 owner read RTC osc status register on Android which
    shipped with the box. Reported value indicated problems with external
    oscillator.
    
    In order to fix RTC and related issues (HDMI-CEC and suspend/resume with
    Crust) on all boards, switch to internal oscillator.
    
    Fixes: 32507b868119 ("arm64: dts: allwinner: h6: Move ext. oscillator to board DTs")
    Signed-off-by: Jernej Skrabec <jernej.skrabec@siol.net>
    Tested-by: Clément Péron <peron.clem@gmail.com>
    Signed-off-by: Maxime Ripard <maxime@cerno.tech>
    Link: https://lore.kernel.org/r/20210330184218.279738-1-jernej.skrabec@siol.net
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit e07270abefa23bdcd5382723d8efcadae15a47ca
Author: Andre Przywara <andre.przywara@arm.com>
Date:   Tue Mar 16 14:42:19 2021 +0000

    arm64: dts: allwinner: Fix SD card CD GPIO for SOPine systems
    
    [ Upstream commit 3dd4ce4185df6798dcdcc3669bddb35899d7d5e1 ]
    
    Commit 941432d00768 ("arm64: dts: allwinner: Drop non-removable from
    SoPine/LTS SD card") enabled the card detect GPIO for the SOPine module,
    along the way with the Pine64-LTS, which share the same base .dtsi.
    
    However while both boards indeed have a working CD GPIO on PF6, the
    polarity is different: the SOPine modules uses a "push-pull" socket,
    which has an active-high switch, while the Pine64-LTS use the more
    traditional push-push socket and the common active-low switch.
    
    Fix the polarity in the sopine.dtsi, and overwrite it in the LTS
    board .dts, to make the SD card work again on systems using SOPine
    modules.
    
    Fixes: 941432d00768 ("arm64: dts: allwinner: Drop non-removable from SoPine/LTS SD card")
    Reported-by: Ashley <contact@victorianfox.com>
    Signed-off-by: Andre Przywara <andre.przywara@arm.com>
    Signed-off-by: Maxime Ripard <maxime@cerno.tech>
    Link: https://lore.kernel.org/r/20210316144219.5973-1-andre.przywara@arm.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 54a424316487e4d40f8c55b771c9d17e2f3b6077
Author: Tony Lindgren <tony@atomide.com>
Date:   Wed Mar 31 09:27:41 2021 +0300

    ARM: OMAP2+: Fix uninitialized sr_inst
    
    [ Upstream commit fc85dc42a38405099f97aa2af709fe9504a82508 ]
    
    Fix uninitialized sr_inst.
    
    Fixes: fbfa463be8dc ("ARM: OMAP2+: Fix smartreflex init regression after dropping legacy data")
    Reported-by: kernel test robot <lkp@intel.com>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c3efce8cc9807339633ee30e39882f4c8626ee1d
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Thu Mar 25 10:26:21 2021 +0000

    ARM: footbridge: fix PCI interrupt mapping
    
    [ Upstream commit 30e3b4f256b4e366a61658c294f6a21b8626dda7 ]
    
    Since commit 30fdfb929e82 ("PCI: Add a call to pci_assign_irq() in
    pci_device_probe()"), the PCI code will call the IRQ mapping function
    whenever a PCI driver is probed. If these are marked as __init, this
    causes an oops if a PCI driver is loaded or bound after the kernel has
    initialised.
    
    Fixes: 30fdfb929e82 ("PCI: Add a call to pci_assign_irq() in pci_device_probe()")
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 82940b38d6dac7d0709ea665b1eb149df176c4d2
Author: Vladimir Murzin <vladimir.murzin@arm.com>
Date:   Thu Mar 11 13:32:16 2021 +0100

    ARM: 9069/1: NOMMU: Fix conversion for_each_membock() to for_each_mem_range()
    
    [ Upstream commit 45c2f70cba3a7eff34574103b2e2b901a5f771aa ]
    
    for_each_mem_range() uses a loop variable, yet looking into code it is
    not just iteration counter but more complex entity which encodes
    information about memblock. Thus condition i == 0 looks fragile.
    Indeed, it broke boot of R-class platforms since it never took i == 0
    path (due to i was set to 1). Fix that with restoring original flag
    check.
    
    Fixes: b10d6bca8720 ("arch, drivers: replace for_each_membock() with for_each_mem_range()")
    Signed-off-by: Vladimir Murzin <vladimir.murzin@arm.com>
    Acked-by: Mike Rapoport <rppt@linux.ibm.com>
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5965ac11b1d5fcb38464728931649cd9df79c7c9
Author: Ard Biesheuvel <ardb@kernel.org>
Date:   Wed Feb 17 20:26:23 2021 +0100

    ARM: 9063/1: mm: reduce maximum number of CPUs if DEBUG_KMAP_LOCAL is enabled
    
    [ Upstream commit d624833f5984d484c5e3196f34b926f9e71dafee ]
    
    The debugging code for kmap_local() doubles the number of per-CPU fixmap
    slots allocated for kmap_local(), in order to use half of them as guard
    regions. This causes the fixmap region to grow downwards beyond the start
    of its reserved window if the supported number of CPUs is large, and collide
    with the newly added virtual DT mapping right below it, which is obviously
    not good.
    
    One manifestation of this is EFI boot on a kernel built with NR_CPUS=32
    and CONFIG_DEBUG_KMAP_LOCAL=y, which may pass the FDT in highmem, resulting
    in block entries below the fixmap region that the fixmap code misidentifies
    as fixmap table entries, and subsequently tries to dereference using a
    phys-to-virt translation that is only valid for lowmem. This results in a
    cryptic splat such as the one below.
    
      ftrace: allocating 45548 entries in 89 pages
      8<--- cut here ---
      Unable to handle kernel paging request at virtual address fc6006f0
      pgd = (ptrval)
      [fc6006f0] *pgd=80000040207003, *pmd=00000000
      Internal error: Oops: a06 [#1] SMP ARM
      Modules linked in:
      CPU: 0 PID: 0 Comm: swapper Not tainted 5.11.0+ #382
      Hardware name: Generic DT based system
      PC is at cpu_ca15_set_pte_ext+0x24/0x30
      LR is at __set_fixmap+0xe4/0x118
      pc : [<c041ac9c>]    lr : [<c04189d8>]    psr: 400000d3
      sp : c1601ed8  ip : 00400000  fp : 00800000
      r10: 0000071f  r9 : 00421000  r8 : 00c00000
      r7 : 00c00000  r6 : 0000071f  r5 : ffade000  r4 : 4040171f
      r3 : 00c00000  r2 : 4040171f  r1 : c041ac78  r0 : fc6006f0
      Flags: nZcv  IRQs off  FIQs off  Mode SVC_32  ISA ARM  Segment none
      Control: 30c5387d  Table: 40203000  DAC: 00000001
      Process swapper (pid: 0, stack limit = 0x(ptrval))
    
    So let's limit CONFIG_NR_CPUS to 16 when CONFIG_DEBUG_KMAP_LOCAL=y. Also,
    fix the BUILD_BUG_ON() check that was supposed to catch this, by checking
    whether the region grows below the start address rather than above the end
    address.
    
    Fixes: 2a15ba82fa6ca3f3 ("ARM: highmem: Switch to generic kmap atomic")
    Reported-by: Peter Robinson <pbrobinson@gmail.com>
    Tested-by: Peter Robinson <pbrobinson@gmail.com>
    Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
    Acked-by: Thomas Gleixner <tglx@linutronix.de>
    Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4ff3e4054f5dd5b8e4677f9847957684e4e90875
Author: Tony Lindgren <tony@atomide.com>
Date:   Wed Mar 24 12:23:58 2021 +0200

    ARM: OMAP2+: Fix warning for omap_init_time_of()
    
    [ Upstream commit a3efe3f6d0eb64363f74af4b0e8ba6d19415cef2 ]
    
    Fix warning: no previous prototype for 'omap_init_time_of'.
    
    Fixes: e69b4e1a7577 ("ARM: OMAP2+: Add omap_init_time_of()")
    Reported-by: kernel test robot <lkp@intel.com>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 069013bf21528514f537eca0ec70529db4720132
Author: Eric Dumazet <edumazet@google.com>
Date:   Tue Apr 13 05:41:35 2021 -0700

    gro: ensure frag0 meets IP header alignment
    
    commit 38ec4944b593fd90c5ef42aaaa53e66ae5769d04 upstream.
    
    After commit 0f6925b3e8da ("virtio_net: Do not pull payload in skb->head")
    Guenter Roeck reported one failure in his tests using sh architecture.
    
    After much debugging, we have been able to spot silent unaligned accesses
    in inet_gro_receive()
    
    The issue at hand is that upper networking stacks assume their header
    is word-aligned. Low level drivers are supposed to reserve NET_IP_ALIGN
    bytes before the Ethernet header to make that happen.
    
    This patch hardens skb_gro_reset_offset() to not allow frag0 fast-path
    if the fragment is not properly aligned.
    
    Some arches like x86, arm64 and powerpc do not care and define NET_IP_ALIGN
    as 0, this extra check will be a NOP for them.
    
    Note that if frag0 is not used, GRO will call pskb_may_pull()
    as many times as needed to pull network and transport headers.
    
    Fixes: 0f6925b3e8da ("virtio_net: Do not pull payload in skb->head")
    Fixes: 78a478d0efd9 ("gro: Inline skb_gro_header and cache frag0 virtual address")
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Reported-by: Guenter Roeck <linux@roeck-us.net>
    Cc: Xuan Zhuo <xuanzhuo@linux.alibaba.com>
    Cc: "Michael S. Tsirkin" <mst@redhat.com>
    Cc: Jason Wang <jasowang@redhat.com>
    Acked-by: Michael S. Tsirkin <mst@redhat.com>
    Tested-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 90dcade68e7bd330db8e9ba0e99075de2cf7e9ab
Author: Vinay Kumar Yadav <vinay.yadav@chelsio.com>
Date:   Thu Apr 15 13:17:48 2021 +0530

    ch_ktls: do not send snd_una update to TCB in middle
    
    commit e8a4155567b3c903f49cbf89b8017e9cc22c4fe4 upstream.
    
    snd_una update should not be done when the same skb is being
    sent out.chcr_short_record_handler() sends it again even
    though SND_UNA update is already sent for the skb in
    chcr_ktls_xmit(), which causes mismatch in un-acked
    TCP seq number, later causes problem in sending out
    complete record.
    
    Fixes: 429765a149f1 ("chcr: handle partial end part of a record")
    Signed-off-by: Vinay Kumar Yadav <vinay.yadav@chelsio.com>
    Signed-off-by: Rohit Maheshwari <rohitm@chelsio.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 40fd9f767aa539e3fd0342b96ea21341f8000176
Author: Vinay Kumar Yadav <vinay.yadav@chelsio.com>
Date:   Thu Apr 15 13:17:47 2021 +0530

    ch_ktls: tcb close causes tls connection failure
    
    commit 21d8c25e3f4b9052a471ced8f47b531956eb9963 upstream.
    
    HW doesn't need marking TCB closed. This TCB state change
    sometimes causes problem to the new connection which gets
    the same tid.
    
    Fixes: 34aba2c45024 ("cxgb4/chcr : Register to tls add and del callback")
    Signed-off-by: Vinay Kumar Yadav <vinay.yadav@chelsio.com>
    Signed-off-by: Rohit Maheshwari <rohitm@chelsio.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dfe77fe16897c7e3ddc6f9e76a0365be02b1b774
Author: Vinay Kumar Yadav <vinay.yadav@chelsio.com>
Date:   Thu Apr 15 13:17:46 2021 +0530

    ch_ktls: fix device connection close
    
    commit bc16efd2430652f894ae34b1de5eccc3bf0d2810 upstream.
    
    When sge queue is full and chcr_ktls_xmit_wr_complete()
    returns failure, skb is not freed if it is not the last tls record in
    this skb, causes refcount never gets freed and tls_dev_del()
    never gets called on this connection.
    
    Fixes: 5a4b9fe7fece ("cxgb4/chcr: complete record tx handling")
    Signed-off-by: Vinay Kumar Yadav <vinay.yadav@chelsio.com>
    Signed-off-by: Rohit Maheshwari <rohitm@chelsio.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8348665d4181c68b0ca1205b48e1753d78bc810f
Author: Vinay Kumar Yadav <vinay.yadav@chelsio.com>
Date:   Thu Apr 15 13:17:45 2021 +0530

    ch_ktls: Fix kernel panic
    
    commit 1a73e427b824133940c2dd95ebe26b6dce1cbf10 upstream.
    
    Taking page refcount is not ideal and causes kernel panic
    sometimes. It's better to take tx_ctx lock for the complete
    skb transmit, to avoid page cleanup if ACK received in middle.
    
    Fixes: 5a4b9fe7fece ("cxgb4/chcr: complete record tx handling")
    Signed-off-by: Vinay Kumar Yadav <vinay.yadav@chelsio.com>
    Signed-off-by: Rohit Maheshwari <rohitm@chelsio.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f5df8dbbc3e5b3938779f5fb003a9a7bbc19bfa0
Author: Lijun Pan <lijunp213@gmail.com>
Date:   Wed Apr 14 02:46:16 2021 -0500

    ibmvnic: remove duplicate napi_schedule call in open function
    
    commit 7c451f3ef676c805a4b77a743a01a5c21a250a73 upstream.
    
    Remove the unnecessary napi_schedule() call in __ibmvnic_open() since
    interrupt_rx() calls napi_schedule_prep/__napi_schedule during every
    receive interrupt.
    
    Fixes: ed651a10875f ("ibmvnic: Updated reset handling")
    Signed-off-by: Lijun Pan <lijunp213@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4ba852fd216cc64a3d708efbe1f910003091252a
Author: Lijun Pan <lijunp213@gmail.com>
Date:   Wed Apr 14 02:46:15 2021 -0500

    ibmvnic: remove duplicate napi_schedule call in do_reset function
    
    commit d3a6abccbd272aea7dc2c6f984bb5a2c11278e44 upstream.
    
    During adapter reset, do_reset/do_hard_reset calls ibmvnic_open(),
    which will calls napi_schedule if previous state is VNIC_CLOSED
    (i.e, the reset case, and "ifconfig down" case). So there is no need
    for do_reset to call napi_schedule again at the end of the function
    though napi_schedule will neglect the request if napi is already
    scheduled.
    
    Fixes: ed651a10875f ("ibmvnic: Updated reset handling")
    Signed-off-by: Lijun Pan <lijunp213@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c3e1d486a0b8a6b3f3460ef786744abe173d3de7
Author: Lijun Pan <lijunp213@gmail.com>
Date:   Wed Apr 14 02:46:14 2021 -0500

    ibmvnic: avoid calling napi_disable() twice
    
    commit 0775ebc4cf8554bdcd2c212669a0868ab68df5c0 upstream.
    
    __ibmvnic_open calls napi_disable without checking whether NAPI polling
    has already been disabled or not. This could cause napi_disable
    being called twice, which could generate deadlock. For example,
    the first napi_disable will spin until NAPI_STATE_SCHED is cleared
    by napi_complete_done, then set it again.
    When napi_disable is called the second time, it will loop infinitely
    because no dev->poll will be running to clear NAPI_STATE_SCHED.
    
    To prevent above scenario from happening, call ibmvnic_napi_disable()
    which checks if napi is disabled or not before calling napi_disable.
    
    Fixes: bfc32f297337 ("ibmvnic: Move resource initialization to its own routine")
    Suggested-by: Thomas Falcon <tlfalcon@linux.ibm.com>
    Signed-off-by: Lijun Pan <lijunp213@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5664c892a82064cdb35d0bbeb7081d4922082939
Author: John Paul Adrian Glaubitz <glaubitz () physik ! fu-berlin ! de>
Date:   Fri Apr 16 15:46:12 2021 -0700

    ia64: tools: remove inclusion of ia64-specific version of errno.h header
    
    commit 17786fea414393813b56e33a1a01b2dfa03c0915 upstream.
    
    There is no longer an ia64-specific version of the errno.h header below
    arch/ia64/include/uapi/asm/, so trying to build tools/bpf fails with:
    
        CC       /usr/src/linux/tools/bpf/bpftool/btf_dumper.o
      In file included from /usr/src/linux/tools/include/linux/err.h:8,
                       from btf_dumper.c:11:
      /usr/src/linux/tools/include/uapi/asm/errno.h:13:10: fatal error: ../../../arch/ia64/include/uapi/asm/errno.h: No such file or directory
         13 | #include "../../../arch/ia64/include/uapi/asm/errno.h"
            |          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      compilation terminated.
    
    Thus, just remove the inclusion of the ia64-specific errno.h so that the
    build will use the generic errno.h header on this target which was used
    there anyway as the ia64-specific errno.h was just a wrapper for the
    generic header.
    
    Fixes: c25f867ddd00 ("ia64: remove unneeded uapi asm-generic wrappers")
    Signed-off-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6462711489954116fd1bda1ca17c2de788a5d6c5
Author: Randy Dunlap <rdunlap@infradead.org>
Date:   Fri Apr 16 15:46:06 2021 -0700

    ia64: remove duplicate entries in generic_defconfig
    
    commit 19d000d93303e05bd7b1326e3de9df05a41b25b5 upstream.
    
    Fix ia64 generic_defconfig duplicate entries, as warned by:
    
      arch/ia64/configs/generic_defconfig: warning: override: reassigning to symbol ATA:  => 58
      arch/ia64/configs/generic_defconfig: warning: override: reassigning to symbol ATA_PIIX:  => 59
    
    These 2 symbols still have the same value as in the removed lines.
    
    Link: https://lkml.kernel.org/r/20210411020255.18052-1-rdunlap@infradead.org
    Fixes: c331649e6371 ("ia64: Use libata instead of the legacy ide driver in defconfigs")
    Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
    Reported-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Reviewed-by: Christoph Hellwig <hch@lst.de>
    Cc: Tony Luck <tony.luck@intel.com>
    Cc: Fenghua Yu <fenghua.yu@intel.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 82aa7596eec035446c51205d4de5f00fe629f528
Author: Jakub Kicinski <kuba@kernel.org>
Date:   Tue Apr 13 20:46:14 2021 -0700

    ethtool: pause: make sure we init driver stats
    
    commit 16756d3e77ad58cd07e36cbed724aa13ae5a0278 upstream.
    
    The intention was for pause statistics to not be reported
    when driver does not have the relevant callback (only
    report an empty netlink nest). What happens currently
    we report all 0s instead. Make sure statistics are
    initialized to "not set" (which is -1) so the dumping
    code skips them.
    
    Fixes: 9a27a33027f2 ("ethtool: add standard pause stats")
    Signed-off-by: Jakub Kicinski <kuba@kernel.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3f4b85c3cac6b39bbc6da921d9afee7daaaee3b6
Author: Jason Xing <xingwanli@kuaishou.com>
Date:   Wed Apr 14 10:34:28 2021 +0800

    i40e: fix the panic when running bpf in xdpdrv mode
    
    commit 4e39a072a6a0fc422ba7da5e4336bdc295d70211 upstream.
    
    Fix this panic by adding more rules to calculate the value of @rss_size_max
    which could be used in allocating the queues when bpf is loaded, which,
    however, could cause the failure and then trigger the NULL pointer of
    vsi->rx_rings. Prio to this fix, the machine doesn't care about how many
    cpus are online and then allocates 256 queues on the machine with 32 cpus
    online actually.
    
    Once the load of bpf begins, the log will go like this "failed to get
    tracking for 256 queues for VSI 0 err -12" and this "setup of MAIN VSI
    failed".
    
    Thus, I attach the key information of the crash-log here.
    
    BUG: unable to handle kernel NULL pointer dereference at
    0000000000000000
    RIP: 0010:i40e_xdp+0xdd/0x1b0 [i40e]
    Call Trace:
    [2160294.717292]  ? i40e_reconfig_rss_queues+0x170/0x170 [i40e]
    [2160294.717666]  dev_xdp_install+0x4f/0x70
    [2160294.718036]  dev_change_xdp_fd+0x11f/0x230
    [2160294.718380]  ? dev_disable_lro+0xe0/0xe0
    [2160294.718705]  do_setlink+0xac7/0xe70
    [2160294.719035]  ? __nla_parse+0xed/0x120
    [2160294.719365]  rtnl_newlink+0x73b/0x860
    
    Fixes: 41c445ff0f48 ("i40e: main driver core")
    Co-developed-by: Shujin Li <lishujin@kuaishou.com>
    Signed-off-by: Shujin Li <lishujin@kuaishou.com>
    Signed-off-by: Jason Xing <xingwanli@kuaishou.com>
    Reviewed-by: Jesse Brandeburg <jesse.brandeburg@intel.com>
    Acked-by: Jesper Dangaard Brouer <brouer@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5d328093979ab37f5f9f661380c31e347076aba6
Author: Lijun Pan <lijunp213@gmail.com>
Date:   Tue Apr 13 03:33:25 2021 -0500

    ibmvnic: correctly use dev_consume/free_skb_irq
    
    commit ca09bf7bb109a37a7ff05f230bb3fa3627e6625f upstream.
    
    It is more correct to use dev_kfree_skb_irq when packets are dropped,
    and to use dev_consume_skb_irq when packets are consumed.
    
    Fixes: 0d973388185d ("ibmvnic: Introduce xmit_more support using batched subCRQ hcalls")
    Suggested-by: Thomas Falcon <tlfalcon@linux.ibm.com>
    Signed-off-by: Lijun Pan <lijunp213@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1ccdf1bed140820240e383ba0accc474ffc7f006
Author: Jonathon Reinhart <jonathon.reinhart@gmail.com>
Date:   Tue Apr 13 03:08:48 2021 -0400

    net: Make tcp_allowed_congestion_control readonly in non-init netns
    
    commit 97684f0970f6e112926de631fdd98d9693c7e5c1 upstream.
    
    Currently, tcp_allowed_congestion_control is global and writable;
    writing to it in any net namespace will leak into all other net
    namespaces.
    
    tcp_available_congestion_control and tcp_allowed_congestion_control are
    the only sysctls in ipv4_net_table (the per-netns sysctl table) with a
    NULL data pointer; their handlers (proc_tcp_available_congestion_control
    and proc_allowed_congestion_control) have no other way of referencing a
    struct net. Thus, they operate globally.
    
    Because ipv4_net_table does not use designated initializers, there is no
    easy way to fix up this one "bad" table entry. However, the data pointer
    updating logic shouldn't be applied to NULL pointers anyway, so we
    instead force these entries to be read-only.
    
    These sysctls used to exist in ipv4_table (init-net only), but they were
    moved to the per-net ipv4_net_table, presumably without realizing that
    tcp_allowed_congestion_control was writable and thus introduced a leak.
    
    Because the intent of that commit was only to know (i.e. read) "which
    congestion algorithms are available or allowed", this read-only solution
    should be sufficient.
    
    The logic added in recent commit
    31c4d2f160eb: ("net: Ensure net namespace isolation of sysctls")
    does not and cannot check for NULL data pointers, because
    other table entries (e.g. /proc/sys/net/netfilter/nf_log/) have
    .data=NULL but use other methods (.extra2) to access the struct net.
    
    Fixes: 9cb8e048e5d9 ("net/ipv4/sysctl: show tcp_{allowed, available}_congestion_control in non-initial netns")
    Signed-off-by: Jonathon Reinhart <jonathon.reinhart@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 93e2742631b19032283869e90e44cfb99bd2d2c6
Author: Christophe Leroy <christophe.leroy@csgroup.eu>
Date:   Fri Apr 16 15:46:20 2021 -0700

    mm: ptdump: fix build failure
    
    commit 458376913d86bed2fb781b4952eb6861675ef3be upstream.
    
    READ_ONCE() cannot be used for reading PTEs.  Use ptep_get() instead, to
    avoid the following errors:
    
        CC      mm/ptdump.o
      In file included from <command-line>:
      mm/ptdump.c: In function 'ptdump_pte_entry':
      include/linux/compiler_types.h:320:38: error: call to '__compiletime_assert_207' declared with attribute error: Unsupported access size for {READ,WRITE}_ONCE().
        320 |  _compiletime_assert(condition, msg, __compiletime_assert_, __COUNTER__)
            |                                      ^
      include/linux/compiler_types.h:301:4: note: in definition of macro '__compiletime_assert'
        301 |    prefix ## suffix();    \
            |    ^~~~~~
      include/linux/compiler_types.h:320:2: note: in expansion of macro '_compiletime_assert'
        320 |  _compiletime_assert(condition, msg, __compiletime_assert_, __COUNTER__)
            |  ^~~~~~~~~~~~~~~~~~~
      include/asm-generic/rwonce.h:36:2: note: in expansion of macro 'compiletime_assert'
         36 |  compiletime_assert(__native_word(t) || sizeof(t) == sizeof(long long), \
            |  ^~~~~~~~~~~~~~~~~~
      include/asm-generic/rwonce.h:49:2: note: in expansion of macro 'compiletime_assert_rwonce_type'
         49 |  compiletime_assert_rwonce_type(x);    \
            |  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      mm/ptdump.c:114:14: note: in expansion of macro 'READ_ONCE'
        114 |  pte_t val = READ_ONCE(*pte);
            |              ^~~~~~~~~
      make[2]: *** [mm/ptdump.o] Error 1
    
    See commit 481e980a7c19 ("mm: Allow arches to provide ptep_get()") and
    commit c0e1c8c22beb ("powerpc/8xx: Provide ptep_get() with 16k pages")
    for details.
    
    Link: https://lkml.kernel.org/r/912b349e2bcaa88939904815ca0af945740c6bd4.1618478922.git.christophe.leroy@csgroup.eu
    Fixes: 30d621f6723b ("mm: add generic ptdump")
    Signed-off-by: Christophe Leroy <christophe.leroy@csgroup.eu>
    Cc: Steven Price <steven.price@arm.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fda73b12e5998c54c495be89a5b94208d9d92696
Author: Hristo Venev <hristo@venev.name>
Date:   Mon Apr 12 20:41:17 2021 +0300

    net: ip6_tunnel: Unregister catch-all devices
    
    commit 941ea91e87a6e879ed82dad4949f6234f2702bec upstream.
    
    Similarly to the sit case, we need to remove the tunnels with no
    addresses that have been moved to another network namespace.
    
    Fixes: 0bd8762824e73 ("ip6tnl: add x-netns support")
    Signed-off-by: Hristo Venev <hristo@venev.name>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6d43717ad3b86865cf664ff4361ed1d347b9a939
Author: Hristo Venev <hristo@venev.name>
Date:   Mon Apr 12 20:41:16 2021 +0300

    net: sit: Unregister catch-all devices
    
    commit 610f8c0fc8d46e0933955ce13af3d64484a4630a upstream.
    
    A sit interface created without a local or a remote address is linked
    into the `sit_net::tunnels_wc` list of its original namespace. When
    deleting a network namespace, delete the devices that have been moved.
    
    The following script triggers a null pointer dereference if devices
    linked in a deleted `sit_net` remain:
    
        for i in `seq 1 30`; do
            ip netns add ns-test
            ip netns exec ns-test ip link add dev veth0 type veth peer veth1
            ip netns exec ns-test ip link add dev sit$i type sit dev veth0
            ip netns exec ns-test ip link set dev sit$i netns $$
            ip netns del ns-test
        done
        for i in `seq 1 30`; do
            ip link del dev sit$i
        done
    
    Fixes: 5e6700b3bf98f ("sit: add support of x-netns")
    Signed-off-by: Hristo Venev <hristo@venev.name>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9083a6b487cc4b50128c2106bb382676e56ed6de
Author: Pali Rohár <pali@kernel.org>
Date:   Mon Apr 12 18:57:39 2021 +0200

    net: phy: marvell: fix detection of PHY on Topaz switches
    
    commit 1fe976d308acb6374c899a4ee8025a0a016e453e upstream.
    
    Since commit fee2d546414d ("net: phy: marvell: mv88e6390 temperature
    sensor reading"), Linux reports the temperature of Topaz hwmon as
    constant -75°C.
    
    This is because switches from the Topaz family (88E6141 / 88E6341) have
    the address of the temperature sensor register different from Peridot.
    
    This address is instead compatible with 88E1510 PHYs, as was used for
    Topaz before the above mentioned commit.
    
    Create a new mapping table between switch family and PHY ID for families
    which don't have a model number. And define PHY IDs for Topaz and Peridot
    families.
    
    Create a new PHY ID and a new PHY driver for Topaz's internal PHY.
    The only difference from Peridot's PHY driver is the HWMON probing
    method.
    
    Prior this change Topaz's internal PHY is detected by kernel as:
    
      PHY [...] driver [Marvell 88E6390] (irq=63)
    
    And afterwards as:
    
      PHY [...] driver [Marvell 88E6341 Family] (irq=63)
    
    Signed-off-by: Pali Rohár <pali@kernel.org>
    BugLink: https://github.com/globalscaletechnologies/linux/issues/1
    Fixes: fee2d546414d ("net: phy: marvell: mv88e6390 temperature sensor reading")
    Reviewed-by: Marek Behún <kabel@kernel.org>
    Reviewed-by: Andrew Lunn <andrew@lunn.ch>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit af0785cd3589653854b24cee6705d3d7a3c87faf
Author: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
Date:   Sun Apr 11 11:02:08 2021 +0200

    net: davicom: Fix regulator not turned off on failed probe
    
    commit 31457db3750c0b0ed229d836f2609fdb8a5b790e upstream.
    
    When the probe fails, we must disable the regulator that was previously
    enabled.
    
    This patch is a follow-up to commit ac88c531a5b3
    ("net: davicom: Fix regulator not turned off on failed probe") which missed
    one case.
    
    Fixes: 7994fe55a4a2 ("dm9000: Add regulator and reset support to dm9000")
    Signed-off-by: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit efe85cdd9a6aaa28bf29f4e7d04a89d90ccfce57
Author: Aya Levin <ayal@nvidia.com>
Date:   Sun Apr 11 09:33:12 2021 +0300

    net/mlx5e: Fix setting of RS FEC mode
    
    commit 7a320c9db3e73fb6c4f9a331087df9df18767221 upstream.
    
    Change register setting from bit number to bit mask.
    
    Fixes: b5ede32d3329 ("net/mlx5e: Add support for FEC modes based on 50G per lane links")
    Signed-off-by: Aya Levin <ayal@nvidia.com>
    Reviewed-by: Eran Ben Elisha <eranbe@nvidia.com>
    Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 47d8de3c226574a3ddb8b87d0c152028d1bafef4
Author: Pablo Neira Ayuso <pablo@netfilter.org>
Date:   Sat Apr 10 21:29:38 2021 +0200

    netfilter: nftables: clone set element expression template
    
    commit 4d8f9065830e526c83199186c5f56a6514f457d2 upstream.
    
    memcpy() breaks when using connlimit in set elements. Use
    nft_expr_clone() to initialize the connlimit expression list, otherwise
    connlimit garbage collector crashes when walking on the list head copy.
    
    [  493.064656] Workqueue: events_power_efficient nft_rhash_gc [nf_tables]
    [  493.064685] RIP: 0010:find_or_evict+0x5a/0x90 [nf_conncount]
    [  493.064694] Code: 2b 43 40 83 f8 01 77 0d 48 c7 c0 f5 ff ff ff 44 39 63 3c 75 df 83 6d 18 01 48 8b 43 08 48 89 de 48 8b 13 48 8b 3d ee 2f 00 00 <48> 89 42 08 48 89 10 48 b8 00 01 00 00 00 00 ad de 48 89 03 48 83
    [  493.064699] RSP: 0018:ffffc90000417dc0 EFLAGS: 00010297
    [  493.064704] RAX: 0000000000000000 RBX: ffff888134f38410 RCX: 0000000000000000
    [  493.064708] RDX: 0000000000000000 RSI: ffff888134f38410 RDI: ffff888100060cc0
    [  493.064711] RBP: ffff88812ce594a8 R08: ffff888134f38438 R09: 00000000ebb9025c
    [  493.064714] R10: ffffffff8219f838 R11: 0000000000000017 R12: 0000000000000001
    [  493.064718] R13: ffffffff82146740 R14: ffff888134f38410 R15: 0000000000000000
    [  493.064721] FS:  0000000000000000(0000) GS:ffff88840e440000(0000) knlGS:0000000000000000
    [  493.064725] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
    [  493.064729] CR2: 0000000000000008 CR3: 00000001330aa002 CR4: 00000000001706e0
    [  493.064733] Call Trace:
    [  493.064737]  nf_conncount_gc_list+0x8f/0x150 [nf_conncount]
    [  493.064746]  nft_rhash_gc+0x106/0x390 [nf_tables]
    
    Reported-by: Laura Garcia Liebana <nevola@gmail.com>
    Fixes: 409444522976 ("netfilter: nf_tables: add elements with stateful expressions")
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1bb3ee4259936cc3b2d80a4a480bbb4868575071
Author: Eric Dumazet <edumazet@google.com>
Date:   Fri Apr 9 08:49:39 2021 -0700

    netfilter: nft_limit: avoid possible divide error in nft_limit_init
    
    commit b895bdf5d643b6feb7c60856326dd4feb6981560 upstream.
    
    div_u64() divides u64 by u32.
    
    nft_limit_init() wants to divide u64 by u64, use the appropriate
    math function (div64_u64)
    
    divide error: 0000 [#1] PREEMPT SMP KASAN
    CPU: 1 PID: 8390 Comm: syz-executor188 Not tainted 5.12.0-rc4-syzkaller #0
    Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
    RIP: 0010:div_u64_rem include/linux/math64.h:28 [inline]
    RIP: 0010:div_u64 include/linux/math64.h:127 [inline]
    RIP: 0010:nft_limit_init+0x2a2/0x5e0 net/netfilter/nft_limit.c:85
    Code: ef 4c 01 eb 41 0f 92 c7 48 89 de e8 38 a5 22 fa 4d 85 ff 0f 85 97 02 00 00 e8 ea 9e 22 fa 4c 0f af f3 45 89 ed 31 d2 4c 89 f0 <49> f7 f5 49 89 c6 e8 d3 9e 22 fa 48 8d 7d 48 48 b8 00 00 00 00 00
    RSP: 0018:ffffc90009447198 EFLAGS: 00010246
    RAX: 0000000000000000 RBX: 0000200000000000 RCX: 0000000000000000
    RDX: 0000000000000000 RSI: ffffffff875152e6 RDI: 0000000000000003
    RBP: ffff888020f80908 R08: 0000200000000000 R09: 0000000000000000
    R10: ffffffff875152d8 R11: 0000000000000000 R12: ffffc90009447270
    R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
    FS:  000000000097a300(0000) GS:ffff8880b9d00000(0000) knlGS:0000000000000000
    CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
    CR2: 00000000200001c4 CR3: 0000000026a52000 CR4: 00000000001506e0
    DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
    DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
    Call Trace:
     nf_tables_newexpr net/netfilter/nf_tables_api.c:2675 [inline]
     nft_expr_init+0x145/0x2d0 net/netfilter/nf_tables_api.c:2713
     nft_set_elem_expr_alloc+0x27/0x280 net/netfilter/nf_tables_api.c:5160
     nf_tables_newset+0x1997/0x3150 net/netfilter/nf_tables_api.c:4321
     nfnetlink_rcv_batch+0x85a/0x21b0 net/netfilter/nfnetlink.c:456
     nfnetlink_rcv_skb_batch net/netfilter/nfnetlink.c:580 [inline]
     nfnetlink_rcv+0x3af/0x420 net/netfilter/nfnetlink.c:598
     netlink_unicast_kernel net/netlink/af_netlink.c:1312 [inline]
     netlink_unicast+0x533/0x7d0 net/netlink/af_netlink.c:1338
     netlink_sendmsg+0x856/0xd90 net/netlink/af_netlink.c:1927
     sock_sendmsg_nosec net/socket.c:654 [inline]
     sock_sendmsg+0xcf/0x120 net/socket.c:674
     ____sys_sendmsg+0x6e8/0x810 net/socket.c:2350
     ___sys_sendmsg+0xf3/0x170 net/socket.c:2404
     __sys_sendmsg+0xe5/0x1b0 net/socket.c:2433
     do_syscall_64+0x2d/0x70 arch/x86/entry/common.c:46
     entry_SYSCALL_64_after_hwframe+0x44/0xae
    
    Fixes: c26844eda9d4 ("netfilter: nf_tables: Fix nft limit burst handling")
    Fixes: 3e0f64b7dd31 ("netfilter: nft_limit: fix packet ratelimiting")
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Diagnosed-by: Luigi Rizzo <lrizzo@google.com>
    Reported-by: syzbot <syzkaller@googlegroups.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1adb584434c7d3aefdd87123979ecd01db7337c7
Author: wenxu <wenxu@ucloud.cn>
Date:   Fri Apr 9 13:33:48 2021 +0800

    net/mlx5e: fix ingress_ifindex check in mlx5e_flower_parse_meta
    
    commit e3e0f9b279705154b951d579dc3d8b7041710e24 upstream.
    
    In the nft_offload there is the mate flow_dissector with no
    ingress_ifindex but with ingress_iftype that only be used
    in the software. So if the mask of ingress_ifindex in meta is
    0, this meta check should be bypass.
    
    Fixes: 6d65bc64e232 ("net/mlx5e: Add mlx5e_flower_parse_meta support")
    Signed-off-by: wenxu <wenxu@ucloud.cn>
    Acked-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cfe9101a6a8fb4237510c02c1a4db0aec8622edd
Author: Claudiu Beznea <claudiu.beznea@microchip.com>
Date:   Wed Apr 14 14:20:29 2021 +0300

    net: macb: fix the restore of cmp registers
    
    commit a714e27ea8bdee2b238748029d31472d0a65b611 upstream.
    
    Commit a14d273ba159 ("net: macb: restore cmp registers on resume path")
    introduces the restore of CMP registers on resume path. In case the IP
    doesn't support type 2 screeners (zero on DCFG8 register) the
    struct macb::rx_fs_list::list is not initialized and thus the
    list_for_each_entry(item, &bp->rx_fs_list.list, list) loop introduced in
    commit a14d273ba159 ("net: macb: restore cmp registers on resume path")
    will access an uninitialized list leading to crash. Thus, initialize
    the struct macb::rx_fs_list::list without taking into account if the
    IP supports type 2 screeners or not.
    
    Fixes: a14d273ba159 ("net: macb: restore cmp registers on resume path")
    Signed-off-by: Claudiu Beznea <claudiu.beznea@microchip.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c3bf7238c40837f7ad2325ccfdbbf21ea811dc47
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Thu Mar 25 12:48:22 2021 +0100

    drm/i915/display/vlv_dsi: Do not skip panel_pwr_cycle_delay when disabling the panel
    
    commit aee6f25e9c911323aa89a200e1bb160c1613ed3d upstream.
    
    After the recently added commit fe0f1e3bfdfe ("drm/i915: Shut down
    displays gracefully on reboot"), the DSI panel on a Cherry Trail based
    Predia Basic tablet would no longer properly light up after reboot.
    
    I've managed to reproduce this without rebooting by doing:
    chvt 3; echo 1 > /sys/class/graphics/fb0/blank;\
    echo 0 > /sys/class/graphics/fb0/blank
    
    Which rapidly turns the panel off and back on again.
    
    The vlv_dsi.c code uses an intel_dsi_msleep() helper for the various delays
    used for panel on/off, since starting with MIPI-sequences version >= 3 the
    delays are already included inside the MIPI-sequences.
    
    The problems exposed by the "Shut down displays gracefully on reboot"
    change, show that using this helper for the panel_pwr_cycle_delay is
    not the right thing to do. This has not been noticed until now because
    normally the panel never is cycled off and directly on again in quick
    succession.
    
    Change the msleep for the panel_pwr_cycle_delay to a normal msleep()
    call to avoid the panel staying black after a quick off + on cycle.
    
    Cc: Ville Syrjälä <ville.syrjala@linux.intel.com>
    Fixes: fe0f1e3bfdfe ("drm/i915: Shut down displays gracefully on reboot")
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Reviewed-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20210325114823.44922-1-hdegoede@redhat.com
    (cherry picked from commit 2878b29fc25a0dac0e1c6c94177f07c7f94240f0)
    Signed-off-by: Rodrigo Vivi <rodrigo.vivi@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b33f7e0d5e86e1c758d76838ef7e831d99b176bf
Author: Ciara Loftus <ciara.loftus@intel.com>
Date:   Thu Apr 8 05:20:09 2021 +0000

    libbpf: Fix potential NULL pointer dereference
    
    commit afd0be7299533bb2e2b09104399d8a467ecbd2c5 upstream.
    
    Wait until after the UMEM is checked for null to dereference it.
    
    Fixes: 43f1bc1efff1 ("libbpf: Restore umem state after socket create failure")
    Signed-off-by: Ciara Loftus <ciara.loftus@intel.com>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Link: https://lore.kernel.org/bpf/20210408052009.7844-1-ciara.loftus@intel.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f40de00794a4cb3dc4b1a6e03f4b918ac5f44b99
Author: Florian Westphal <fw@strlen.de>
Date:   Wed Apr 7 21:43:40 2021 +0200

    netfilter: arp_tables: add pre_exit hook for table unregister
    
    commit d163a925ebbc6eb5b562b0f1d72c7e817aa75c40 upstream.
    
    Same problem that also existed in iptables/ip(6)tables, when
    arptable_filter is removed there is no longer a wait period before the
    table/ruleset is free'd.
    
    Unregister the hook in pre_exit, then remove the table in the exit
    function.
    This used to work correctly because the old nf_hook_unregister API
    did unconditional synchronize_net.
    
    The per-net hook unregister function uses call_rcu instead.
    
    Fixes: b9e69e127397 ("netfilter: xtables: don't hook tables by default")
    Signed-off-by: Florian Westphal <fw@strlen.de>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f4e3e823b19785425ae550b5034a306d60d6c8f9
Author: Florian Westphal <fw@strlen.de>
Date:   Wed Apr 7 21:43:39 2021 +0200

    netfilter: bridge: add pre_exit hooks for ebtable unregistration
    
    commit 7ee3c61dcd28bf6e290e06ad382f13511dc790e9 upstream.
    
    Just like ip/ip6/arptables, the hooks have to be removed, then
    synchronize_rcu() has to be called to make sure no more packets are being
    processed before the ruleset data is released.
    
    Place the hook unregistration in the pre_exit hook, then call the new
    ebtables pre_exit function from there.
    
    Years ago, when first netns support got added for netfilter+ebtables,
    this used an older (now removed) netfilter hook unregister API, that did
    a unconditional synchronize_rcu().
    
    Now that all is done with call_rcu, ebtable_{filter,nat,broute} pernet exit
    handlers may free the ebtable ruleset while packets are still in flight.
    
    This can only happens on module removal, not during netns exit.
    
    The new function expects the table name, not the table struct.
    
    This is because upcoming patch set (targeting -next) will remove all
    net->xt.{nat,filter,broute}_table instances, this makes it necessary
    to avoid external references to those member variables.
    
    The existing APIs will be converted, so follow the upcoming scheme of
    passing name + hook type instead.
    
    Fixes: aee12a0a3727e ("ebtables: remove nf_hook_register usage")
    Signed-off-by: Florian Westphal <fw@strlen.de>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e839472af6d78521a96f35e0f71532f8f0209030
Author: Vaibhav Jain <vaibhav@linux.ibm.com>
Date:   Fri Apr 2 14:55:55 2021 +0530

    libnvdimm/region: Fix nvdimm_has_flush() to handle ND_REGION_ASYNC
    
    commit a2948b17f6b936fc52f86c0f92c46d2f91928b79 upstream.
    
    In case a platform doesn't provide explicit flush-hints but provides an
    explicit flush callback via ND_REGION_ASYNC region flag, then
    nvdimm_has_flush() still returns '0' indicating that writes do not
    require flushing. This happens on PPC64 with patch at [1] applied, where
    'deep_flush' of a region was denied even though an explicit flush
    function was provided.
    
    Fix this by adding a condition to nvdimm_has_flush() to test for the
    ND_REGION_ASYNC flag on the region and see if a 'region->flush' callback
    is assigned.
    
    Link: http://lore.kernel.org/r/161703936121.36.7260632399582101498.stgit@e1fbed493c87 [1]
    Fixes: c5d4355d10d4 ("libnvdimm: nd_region flush callback support")
    Reported-by: Shivaprasad G Bhat <sbhat@linux.ibm.com>
    Signed-off-by: Vaibhav Jain <vaibhav@linux.ibm.com>
    Link: https://lore.kernel.org/r/20210402092555.208590-1-vaibhav@linux.ibm.com
    Signed-off-by: Dan Williams <dan.j.williams@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3b9431ae9000f06538f3ceb0eb1eeedb524047d1
Author: Colin Ian King <colin.king@canonical.com>
Date:   Wed Mar 31 15:46:28 2021 +0100

    ice: Fix potential infinite loop when using u8 loop counter
    
    commit ef963ae427aa4669905e0a96b3bd9d44dc85db32 upstream.
    
    A for-loop is using a u8 loop counter that is being compared to
    a u32 cmp_dcbcfg->numapp to check for the end of the loop. If
    cmp_dcbcfg->numapp is larger than 255 then the counter j will wrap
    around to zero and hence an infinite loop occurs. Fix this by making
    counter j the same type as cmp_dcbcfg->numapp.
    
    Addresses-Coverity: ("Infinite loop")
    Fixes: aeac8ce864d9 ("ice: Recognize 860 as iSCSI port in CEE mode")
    Signed-off-by: Colin Ian King <colin.king@canonical.com>
    Tested-by: Tony Brelinski <tonyx.brelinski@intel.com>
    Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 97df84f588f8b22c5acfc74912208f816d7f8a61
Author: Pablo Neira Ayuso <pablo@netfilter.org>
Date:   Wed Mar 31 01:04:45 2021 +0200

    netfilter: conntrack: do not print icmpv6 as unknown via /proc
    
    commit fbea31808ca124dd73ff6bb1e67c9af4607c3e32 upstream.
    
    /proc/net/nf_conntrack shows icmpv6 as unknown.
    
    Fixes: 09ec82f5af99 ("netfilter: conntrack: remove protocol name from l4proto struct")
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3dae5a4ca42d4058184e2dd018c4fed35aa5b207
Author: Pablo Neira Ayuso <pablo@netfilter.org>
Date:   Tue Mar 30 16:24:11 2021 +0200

    netfilter: flowtable: fix NAT IPv6 offload mangling
    
    commit 0e07e25b481aa021e4b48085ecb8a049e9614510 upstream.
    
    Fix out-of-bound access in the address array.
    
    Fixes: 5c27d8d76ce8 ("netfilter: nf_flow_table_offload: add IPv6 support")
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f1b4be4a753caa4056496f679d70550d0c11a264
Author: Yongxin Liu <yongxin.liu@windriver.com>
Date:   Mon Mar 22 15:14:48 2021 +0800

    ixgbe: fix unbalanced device enable/disable in suspend/resume
    
    commit debb9df311582c83fe369baa35fa4b92e8a9c58a upstream.
    
    pci_disable_device() called in __ixgbe_shutdown() decreases
    dev->enable_cnt by 1. pci_enable_device_mem() which increases
    dev->enable_cnt by 1, was removed from ixgbe_resume() in commit
    6f82b2558735 ("ixgbe: use generic power management"). This caused
    unbalanced increase/decrease. So add pci_enable_device_mem() back.
    
    Fix the following call trace.
    
      ixgbe 0000:17:00.1: disabling already-disabled device
      Call Trace:
       __ixgbe_shutdown+0x10a/0x1e0 [ixgbe]
       ixgbe_suspend+0x32/0x70 [ixgbe]
       pci_pm_suspend+0x87/0x160
       ? pci_pm_freeze+0xd0/0xd0
       dpm_run_callback+0x42/0x170
       __device_suspend+0x114/0x460
       async_suspend+0x1f/0xa0
       async_run_entry_fn+0x3c/0xf0
       process_one_work+0x1dd/0x410
       worker_thread+0x34/0x3f0
       ? cancel_delayed_work+0x90/0x90
       kthread+0x14c/0x170
       ? kthread_park+0x90/0x90
       ret_from_fork+0x1f/0x30
    
    Fixes: 6f82b2558735 ("ixgbe: use generic power management")
    Signed-off-by: Yongxin Liu <yongxin.liu@windriver.com>
    Tested-by: Dave Switzer <david.switzer@intel.com>
    Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 758d19098df4b0bbca9f40d6ae6c82c9c18b9bba
Author: Alexander Duyck <alexanderduyck@fb.com>
Date:   Mon Mar 8 12:41:56 2021 -0800

    ixgbe: Fix NULL pointer dereference in ethtool loopback test
    
    commit 31166efb1cee348eb6314e9c0095d84cbeb66b9d upstream.
    
    The ixgbe driver currently generates a NULL pointer dereference when
    performing the ethtool loopback test. This is due to the fact that there
    isn't a q_vector associated with the test ring when it is setup as
    interrupts are not normally added to the test rings.
    
    To address this I have added code that will check for a q_vector before
    returning a napi_id value. If a q_vector is not present it will return a
    value of 0.
    
    Fixes: b02e5a0ebb17 ("xsk: Propagate napi_id to XDP socket Rx path")
    Signed-off-by: Alexander Duyck <alexanderduyck@fb.com>
    Acked-by: Björn Töpel <bjorn.topel@intel.com>
    Tested-by: Dave Switzer <david.switzer@intel.com>
    Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7687606c9442c957061bdf57076d59a08c667aa2
Author: Zack Rusin <zackr@vmware.com>
Date:   Thu Jan 14 18:38:16 2021 -0500

    drm/vmwgfx: Make sure we unpin no longer needed buffers
    
    commit ab4d9913632b1e5ffcf3365783e98718b3c83c7f upstream.
    
    We were not correctly unpinning no longer needed buffers. In particular
    vmw_buffer_object, which is internally often pinned on creation wasn't
    unpinned on destruction and none of the internal MOB buffers were
    unpinned before being put back. Technically this existed for a
    long time but commit 57fcd550eb15 ("drm/ttm: Warn on pinning without
    holding a reference") introduced a WARN_ON which was filling up the
    kernel logs rather quickly.
    
    Quite frankly internal usage of vmw_buffer_object and in general
    pinning needs to be refactored in vmwgfx but for now this makes
    it work.
    
    Signed-off-by: Zack Rusin <zackr@vmware.com>
    Reviewed-by: Martin Krastev <krastevm@vmware.com>
    Reviewed-by: Roland Scheidegger <sroland@vmware.com>
    Fixes: 57fcd550eb15 ("drm/ttm: Warn on pinning without holding a reference")
    Link: https://patchwork.freedesktop.org/patch/414984/?series=86052&rev=1
    Cc: Huang Rui <ray.huang@amd.com>
    Cc: Christian König <christian.koenig@amd.com>
    Cc: Daniel Vetter <daniel.vetter@intel.com>
    Cc: Christian Koenig <christian.koenig@amd.com>
    Cc: dri-devel@lists.freedesktop.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ad7693165885918b524a8a721788aa5bf591ba72
Author: Jolly Shah <jollys@google.com>
Date:   Thu Mar 18 15:56:32 2021 -0700

    scsi: libsas: Reset num_scatter if libata marks qc as NODATA
    
    commit 176ddd89171ddcf661862d90c5d257877f7326d6 upstream.
    
    When the cache_type for the SCSI device is changed, the SCSI layer issues a
    MODE_SELECT command. The caching mode details are communicated via a
    request buffer associated with the SCSI command with data direction set as
    DMA_TO_DEVICE (scsi_mode_select()). When this command reaches the libata
    layer, as a part of generic initial setup, libata layer sets up the
    scatterlist for the command using the SCSI command (ata_scsi_qc_new()).
    This command is then translated by the libata layer into
    ATA_CMD_SET_FEATURES (ata_scsi_mode_select_xlat()). The libata layer treats
    this as a non-data command (ata_mselect_caching()), since it only needs an
    ATA taskfile to pass the caching on/off information to the device. It does
    not need the scatterlist that has been setup, so it does not perform
    dma_map_sg() on the scatterlist (ata_qc_issue()). Unfortunately, when this
    command reaches the libsas layer (sas_ata_qc_issue()), libsas layer sees it
    as a non-data command with a scatterlist. It cannot extract the correct DMA
    length since the scatterlist has not been mapped with dma_map_sg() for a
    DMA operation. When this partially constructed SAS task reaches pm80xx
    LLDD, it results in the following warning:
    
    "pm80xx_chip_sata_req 6058: The sg list address
    start_addr=0x0000000000000000 data_len=0x0end_addr_high=0xffffffff
    end_addr_low=0xffffffff has crossed 4G boundary"
    
    Update libsas to handle ATA non-data commands separately so num_scatter and
    total_xfer_len remain 0.
    
    Link: https://lore.kernel.org/r/20210318225632.2481291-1-jollys@google.com
    Fixes: 53de092f47ff ("scsi: libsas: Set data_dir as DMA_NONE if libata marks qc as NODATA")
    Tested-by: Luo Jiaxing <luojiaxing@huawei.com>
    Reviewed-by: John Garry <john.garry@huawei.com>
    Signed-off-by: Jolly Shah <jollys@google.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c4548b80026e044072bdc8e600fc72de060c1d7f
Author: Kefeng Wang <wangkefeng.wang@huawei.com>
Date:   Mon Mar 29 11:13:07 2021 +0800

    riscv: Fix spelling mistake "SPARSEMEM" to "SPARSMEM"
    
    commit 199fc6b8dee7d6d50467a57e0dc7e3e1b7d59966 upstream.
    
    There is a spelling mistake when SPARSEMEM Kconfig copy.
    
    Fixes: a5406a7ff56e ("riscv: Correct SPARSEMEM configuration")
    Cc: stable@vger.kernel.org
    Signed-off-by: Kefeng Wang <wangkefeng.wang@huawei.com>
    Signed-off-by: Palmer Dabbelt <palmerdabbelt@google.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 71904b25a825ee72510a11d6775ff07e46e1d8c3
Author: Christian A. Ehrhardt <lk@c--e.de>
Date:   Mon Apr 12 23:41:24 2021 +0200

    vfio/pci: Add missing range check in vfio_pci_mmap
    
    commit 909290786ea335366e21d7f1ed5812b90f2f0a92 upstream.
    
    When mmaping an extra device region verify that the region index
    derived from the mmap offset is valid.
    
    Fixes: a15b1883fee1 ("vfio_pci: Allow mapping extra regions")
    Cc: stable@vger.kernel.org
    Signed-off-by: Christian A. Ehrhardt <lk@c--e.de>
    Message-Id: <20210412214124.GA241759@lisa.in-ulm.de>
    Reviewed-by: David Gibson <david@gibson.dropbear.id.au>
    Reviewed-by: Cornelia Huck <cohuck@redhat.com>
    Signed-off-by: Alex Williamson <alex.williamson@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ac3b3ce195e17ca9c3affad87586f642e39f71ee
Author: Nathan Chancellor <nathan@kernel.org>
Date:   Tue Apr 13 17:08:04 2021 -0700

    arm64: alternatives: Move length validation in alternative_{insn, endif}
    
    commit 22315a2296f4c251fa92aec45fbbae37e9301b6c upstream.
    
    After commit 2decad92f473 ("arm64: mte: Ensure TIF_MTE_ASYNC_FAULT is
    set atomically"), LLVM's integrated assembler fails to build entry.S:
    
    <instantiation>:5:7: error: expected assembly-time absolute expression
     .org . - (664b-663b) + (662b-661b)
          ^
    <instantiation>:6:7: error: expected assembly-time absolute expression
     .org . - (662b-661b) + (664b-663b)
          ^
    
    The root cause is LLVM's assembler has a one-pass design, meaning it
    cannot figure out these instruction lengths when the .org directive is
    outside of the subsection that they are in, which was changed by the
    .arch_extension directive added in the above commit.
    
    Apply the same fix from commit 966a0acce2fc ("arm64/alternatives: move
    length validation inside the subsection") to the alternative_endif
    macro, shuffling the .org directives so that the length validation
    happen will always happen in the same subsections. alternative_insn has
    not shown any issue yet but it appears that it could have the same issue
    in the future so just preemptively change it.
    
    Fixes: f7b93d42945c ("arm64/alternatives: use subsections for replacement sequences")
    Cc: <stable@vger.kernel.org> # 5.8.x
    Link: https://github.com/ClangBuiltLinux/linux/issues/1347
    Signed-off-by: Nathan Chancellor <nathan@kernel.org>
    Reviewed-by: Sami Tolvanen <samitolvanen@google.com>
    Tested-by: Sami Tolvanen <samitolvanen@google.com>
    Reviewed-by: Nick Desaulniers <ndesaulniers@google.com>
    Tested-by: Nick Desaulniers <ndesaulniers@google.com>
    Link: https://lore.kernel.org/r/20210414000803.662534-1-nathan@kernel.org
    Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cda174aa2654680c15ef29f1f75d60002c617c51
Author: Catalin Marinas <catalin.marinas@arm.com>
Date:   Fri Apr 9 18:37:10 2021 +0100

    arm64: mte: Ensure TIF_MTE_ASYNC_FAULT is set atomically
    
    commit 2decad92f4731fac9755a083fcfefa66edb7d67d upstream.
    
    The entry from EL0 code checks the TFSRE0_EL1 register for any
    asynchronous tag check faults in user space and sets the
    TIF_MTE_ASYNC_FAULT flag. This is not done atomically, potentially
    racing with another CPU calling set_tsk_thread_flag().
    
    Replace the non-atomic ORR+STR with an STSET instruction. While STSET
    requires ARMv8.1 and an assembler that understands LSE atomics, the MTE
    feature is part of ARMv8.5 and already requires an updated assembler.
    
    Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
    Fixes: 637ec831ea4f ("arm64: mte: Handle synchronous and asynchronous tag check faults")
    Cc: <stable@vger.kernel.org> # 5.10.x
    Reported-by: Will Deacon <will@kernel.org>
    Cc: Will Deacon <will@kernel.org>
    Cc: Vincenzo Frascino <vincenzo.frascino@arm.com>
    Cc: Mark Rutland <mark.rutland@arm.com>
    Link: https://lore.kernel.org/r/20210409173710.18582-1-catalin.marinas@arm.com
    Signed-off-by: Will Deacon <will@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5cc75d2cb7c35983cbd1e31dc3ed16bd52bc6bc6
Author: Peter Collingbourne <pcc@google.com>
Date:   Thu Apr 1 09:51:10 2021 -0700

    arm64: fix inline asm in load_unaligned_zeropad()
    
    commit 185f2e5f51c2029efd9dd26cceb968a44fe053c6 upstream.
    
    The inline asm's addr operand is marked as input-only, however in
    the case where an exception is taken it may be modified by the BIC
    instruction on the exception path. Fix the problem by using a temporary
    register as the destination register for the BIC instruction.
    
    Signed-off-by: Peter Collingbourne <pcc@google.com>
    Cc: stable@vger.kernel.org
    Link: https://linux-review.googlesource.com/id/I84538c8a2307d567b4f45bb20b715451005f9617
    Link: https://lore.kernel.org/r/20210401165110.3952103-1-pcc@google.com
    Signed-off-by: Will Deacon <will@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit af49daedef2ae6f756cbc8acb99eede4299e34b2
Author: Ville Syrjälä <ville.syrjala@linux.intel.com>
Date:   Sat Mar 27 02:59:45 2021 +0200

    drm/i915: Don't zero out the Y plane's watermarks
    
    commit bf52dc49ba0101f648b4c3ea26b812061406b0d4 upstream.
    
    Don't zero out the watermarks for the Y plane since we've already
    computed them when computing the UV plane's watermarks (since the
    UV plane always appears before ethe Y plane when iterating through
    the planes).
    
    This leads to allocating no DDB for the Y plane since .min_ddb_alloc
    also gets zeroed. And that of course leads to underruns when scanning
    out planar formats.
    
    Cc: stable@vger.kernel.org
    Cc: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
    Fixes: dbf71381d733 ("drm/i915: Nuke intel_atomic_crtc_state_for_each_plane_state() from skl+ wm code")
    Signed-off-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20210327005945.4929-1-ville.syrjala@linux.intel.com
    Reviewed-by: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
    (cherry picked from commit f99b805fb9413ff007ca0b6add871737664117dd)
    Signed-off-by: Rodrigo Vivi <rodrigo.vivi@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fe64bbc7e49afe44db9c960d2dc60f09a018bcf9
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Sat Apr 17 09:27:04 2021 -0700

    readdir: make sure to verify directory entry for legacy interfaces too
    
    commit 0c93ac69407d63a85be0129aa55ffaec27ffebd3 upstream.
    
    This does the directory entry name verification for the legacy
    "fillonedir" (and compat) interface that goes all the way back to the
    dark ages before we had a proper dirent, and the readdir() system call
    returned just a single entry at a time.
    
    Nobody should use this interface unless you still have binaries from
    1991, but let's do it right.
    
    This came up during discussions about unsafe_copy_to_user() and proper
    checking of all the inputs to it, as the networking layer is looking to
    use it in a few new places.  So let's make sure the _old_ users do it
    all right and proper, before we add new ones.
    
    See also commit 8a23eb804ca4 ("Make filldir[64]() verify the directory
    entry filename is valid") which did the proper modern interfaces that
    people actually use. It had a note:
    
        Note that I didn't bother adding the checks to any legacy interfaces
        that nobody uses.
    
    which this now corrects.  Note that we really don't care about POSIX and
    the presense of '/' in a directory entry, but verify_dirent_name() also
    ends up doing the proper name length verification which is what the
    input checking discussion was about.
    
    [ Another option would be to remove the support for this particular very
      old interface: any binaries that use it are likely a.out binaries, and
      they will no longer run anyway since we removed a.out binftm support
      in commit eac616557050 ("x86: Deprecate a.out support").
    
      But I'm not sure which came first: getdents() or ELF support, so let's
      pretend somebody might still have a working binary that uses the
      legacy readdir() case.. ]
    
    Link: https://lore.kernel.org/lkml/CAHk-=wjbvzCAhAtvG0d81W5o0-KT5PPTHhfJ5ieDFq+bGtgOYg@mail.gmail.com/
    Acked-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 832132a64f6e307fcf40295956ab7a053c604c6b
Author: Jaegeuk Kim <jaegeuk@kernel.org>
Date:   Wed Apr 14 08:28:28 2021 -0700

    dm verity fec: fix misaligned RS roots IO
    
    commit 8ca7cab82bda4eb0b8064befeeeaa38106cac637 upstream.
    
    commit df7b59ba9245 ("dm verity: fix FEC for RS roots unaligned to
    block size") introduced the possibility for misaligned roots IO
    relative to the underlying device's logical block size. E.g. Android's
    default RS roots=2 results in dm_bufio->block_size=1024, which causes
    the following EIO if the logical block size of the device is 4096,
    given v->data_dev_block_bits=12:
    
    E sd 0    : 0:0:0: [sda] tag#30 request not aligned to the logical block size
    E blk_update_request: I/O error, dev sda, sector 10368424 op 0x0:(READ) flags 0x0 phys_seg 1 prio class 0
    E device-mapper: verity-fec: 254:8: FEC 9244672: parity read failed (block 18056): -5
    
    Fix this by onlu using f->roots for dm_bufio blocksize IFF it is
    aligned to v->data_dev_block_bits.
    
    Fixes: df7b59ba9245 ("dm verity: fix FEC for RS roots unaligned to block size")
    Cc: stable@vger.kernel.org
    Signed-off-by: Jaegeuk Kim <jaegeuk@google.com>
    Signed-off-by: Mike Snitzer <snitzer@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bcadf2728205fd228e95e5eae0896765a0fa2577
Author: Ping Cheng <pinglinux@gmail.com>
Date:   Thu Mar 11 11:30:09 2021 -0800

    HID: wacom: set EV_KEY and EV_ABS only for non-HID_GENERIC type of devices
    
    commit 276559d8d02c2709281578976ca2f53bc62063d4 upstream.
    
    Valid HID_GENERIC type of devices set EV_KEY and EV_ABS by wacom_map_usage.
    When *_input_capabilities are reached, those devices should already have
    their proper EV_* set. EV_KEY and EV_ABS only need to be set for
    non-HID_GENERIC type of devices in *_input_capabilities.
    
    Devices that don't support HID descitoprs will pass back to hid-input for
    registration without being accidentally rejected by the introduction of
    patch: "Input: refuse to register absolute devices without absinfo"
    
    Fixes: 6ecfe51b4082 ("Input: refuse to register absolute devices without absinfo")
    Signed-off-by: Ping Cheng <ping.cheng@wacom.com>
    Reviewed-by: Jason Gerecke <Jason.Gerecke@wacom.com>
    Tested-by: Juan Garrido <Juan.Garrido@wacom.com>
    CC: stable@vger.kernel.org
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 393630da5d8b78158ab58ab22ce47091be71c2c3
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Tue Mar 23 09:56:34 2021 -0700

    Input: i8042 - fix Pegatron C15B ID entry
    
    commit daa58c8eec0a65ac8e2e77ff3ea8a233d8eec954 upstream.
    
    The Zenbook Flip entry that was added overwrites a previous one
    because of a typo:
    
    In file included from drivers/input/serio/i8042.h:23,
                     from drivers/input/serio/i8042.c:131:
    drivers/input/serio/i8042-x86ia64io.h:591:28: error: initialized field overwritten [-Werror=override-init]
      591 |                 .matches = {
          |                            ^
    drivers/input/serio/i8042-x86ia64io.h:591:28: note: (near initialization for 'i8042_dmi_noselftest_table[0].matches')
    
    Add the missing separator between the two.
    
    Fixes: b5d6e7ab7fe7 ("Input: i8042 - add ASUS Zenbook Flip to noselftest list")
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Reviewed-by: Hans de Goede <hdegoede@redhat.com>
    Reviewed-by: Marcos Paulo de Souza <mpdesouza@suse.com>
    Link: https://lore.kernel.org/r/20210323130623.2302402-1-arnd@kernel.org
    Cc: stable@vger.kernel.org
    Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1adc21f3ce36db70c6d25d4060b39e729ae37d9f
Author: Caleb Connolly <caleb@connolly.tech>
Date:   Sun Mar 7 15:12:22 2021 -0800

    Input: s6sy761 - fix coordinate read bit shift
    
    commit 30b3f68715595dee7fe4d9bd91a2252c3becdf0a upstream.
    
    The touch coordinate register contains the following:
    
            byte 3             byte 2             byte 1
    +--------+--------+ +-----------------+ +-----------------+
    |        |        | |                 | |                 |
    | X[3:0] | Y[3:0] | |     Y[11:4]     | |     X[11:4]     |
    |        |        | |                 | |                 |
    +--------+--------+ +-----------------+ +-----------------+
    
    Bytes 2 and 1 need to be shifted left by 4 bits, the least significant
    nibble of each is stored in byte 3. Currently they are only
    being shifted by 3 causing the reported coordinates to be incorrect.
    
    This matches downstream examples, and has been confirmed on my
    device (OnePlus 7 Pro).
    
    Fixes: 0145a7141e59 ("Input: add support for the Samsung S6SY761 touchscreen")
    Signed-off-by: Caleb Connolly <caleb@connolly.tech>
    Reviewed-by: Andi Shyti <andi@etezian.org>
    Link: https://lore.kernel.org/r/20210305185710.225168-1-caleb@connolly.tech
    Cc: stable@vger.kernel.org
    Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 59b5f3e478dbcb4c384cf0888d6cc9f5cad79f2f
Author: Or Cohen <orcohen@paloaltonetworks.com>
Date:   Tue Apr 13 21:10:31 2021 +0300

    net/sctp: fix race condition in sctp_destroy_sock
    
    commit b166a20b07382b8bc1dcee2a448715c9c2c81b5b upstream.
    
    If sctp_destroy_sock is called without sock_net(sk)->sctp.addr_wq_lock
    held and sp->do_auto_asconf is true, then an element is removed
    from the auto_asconf_splist without any proper locking.
    
    This can happen in the following functions:
    1. In sctp_accept, if sctp_sock_migrate fails.
    2. In inet_create or inet6_create, if there is a bpf program
       attached to BPF_CGROUP_INET_SOCK_CREATE which denies
       creation of the sctp socket.
    
    The bug is fixed by acquiring addr_wq_lock in sctp_destroy_sock
    instead of sctp_close.
    
    This addresses CVE-2021-23133.
    
    Reported-by: Or Cohen <orcohen@paloaltonetworks.com>
    Reviewed-by: Xin Long <lucien.xin@gmail.com>
    Fixes: 610236587600 ("bpf: Add new cgroup attach type to enable sock modifications")
    Signed-off-by: Or Cohen <orcohen@paloaltonetworks.com>
    Acked-by: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 09c8c8e8187a31a5d4e68372c081cda2f566ccd5
Author: Julian Braha <julianbraha@gmail.com>
Date:   Fri Apr 9 13:27:47 2021 -0700

    lib: fix kconfig dependency on ARCH_WANT_FRAME_POINTERS
    
    [ Upstream commit 7d37cb2c912dc5c25ffac784a4f9b98c06c6bd08 ]
    
    When LATENCYTOP, LOCKDEP, or FAULT_INJECTION_STACKTRACE_FILTER is
    enabled and ARCH_WANT_FRAME_POINTERS is disabled, Kbuild gives a warning
    such as:
    
      WARNING: unmet direct dependencies detected for FRAME_POINTER
        Depends on [n]: DEBUG_KERNEL [=y] && (M68K || UML || SUPERH) || ARCH_WANT_FRAME_POINTERS [=n] || MCOUNT [=n]
        Selected by [y]:
        - LATENCYTOP [=y] && DEBUG_KERNEL [=y] && STACKTRACE_SUPPORT [=y] && PROC_FS [=y] && !MIPS && !PPC && !S390 && !MICROBLAZE && !ARM && !ARC && !X86
    
    Depending on ARCH_WANT_FRAME_POINTERS causes a recursive dependency
    error.  ARCH_WANT_FRAME_POINTERS is to be selected by the architecture,
    and is not supposed to be overridden by other config options.
    
    Link: https://lkml.kernel.org/r/20210329165329.27994-1-julianbraha@gmail.com
    Signed-off-by: Julian Braha <julianbraha@gmail.com>
    Cc: Andreas Schwab <schwab@linux-m68k.org>
    Cc: Geert Uytterhoeven <geert@linux-m68k.org>
    Cc: Necip Fazil Yildiran <fazilyildiran@gmail.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 97e21a73a1839e1ef867b4352db45cffae5c9cb5
Author: A. Cody Schuffelen <schuffelen@google.com>
Date:   Thu Mar 18 13:04:19 2021 -0700

    virt_wifi: Return micros for BSS TSF values
    
    [ Upstream commit b57aa17f07c9270e576ef7df09f142978b5a75f0 ]
    
    cfg80211_inform_bss expects to receive a TSF value, but is given the
    time since boot in nanoseconds. TSF values are expected to be at
    microsecond scale rather than nanosecond scale.
    
    Signed-off-by: A. Cody Schuffelen <schuffelen@google.com>
    Link: https://lore.kernel.org/r/20210318200419.1421034-1-schuffelen@google.com
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 7cfe824f681e1aaac34ea64bb4def8a77801b672
Author: Seevalamuthu Mariappan <seevalam@codeaurora.org>
Date:   Fri Mar 19 19:48:52 2021 +0530

    mac80211: clear sta->fast_rx when STA removed from 4-addr VLAN
    
    [ Upstream commit dd0b45538146cb6a54d6da7663b8c3afd16ebcfd ]
    
    In some race conditions, with more clients and traffic configuration,
    below crash is seen when making the interface down. sta->fast_rx wasn't
    cleared when STA gets removed from 4-addr AP_VLAN interface. The crash is
    due to try accessing 4-addr AP_VLAN interface's net_device (fast_rx->dev)
    which has been deleted already.
    
    Resolve this by clearing sta->fast_rx pointer when STA removes
    from a 4-addr VLAN.
    
    [  239.449529] Unable to handle kernel NULL pointer dereference at virtual address 00000004
    [  239.449531] pgd = 80204000
    ...
    [  239.481496] CPU: 1 PID: 0 Comm: swapper/1 Not tainted 4.4.60 #227
    [  239.481591] Hardware name: Generic DT based system
    [  239.487665] task: be05b700 ti: be08e000 task.ti: be08e000
    [  239.492360] PC is at get_rps_cpu+0x2d4/0x31c
    [  239.497823] LR is at 0xbe08fc54
    ...
    [  239.778574] [<80739740>] (get_rps_cpu) from [<8073cb10>] (netif_receive_skb_internal+0x8c/0xac)
    [  239.786722] [<8073cb10>] (netif_receive_skb_internal) from [<8073d578>] (napi_gro_receive+0x48/0xc4)
    [  239.795267] [<8073d578>] (napi_gro_receive) from [<c7b83e8c>] (ieee80211_mark_rx_ba_filtered_frames+0xbcc/0x12d4 [mac80211])
    [  239.804776] [<c7b83e8c>] (ieee80211_mark_rx_ba_filtered_frames [mac80211]) from [<c7b84d4c>] (ieee80211_rx_napi+0x7b8/0x8c8 [mac8
                0211])
    [  239.815857] [<c7b84d4c>] (ieee80211_rx_napi [mac80211]) from [<c7f63d7c>] (ath11k_dp_process_rx+0x7bc/0x8c8 [ath11k])
    [  239.827757] [<c7f63d7c>] (ath11k_dp_process_rx [ath11k]) from [<c7f5b6c4>] (ath11k_dp_service_srng+0x2c0/0x2e0 [ath11k])
    [  239.838484] [<c7f5b6c4>] (ath11k_dp_service_srng [ath11k]) from [<7f55b7dc>] (ath11k_ahb_ext_grp_napi_poll+0x20/0x84 [ath11k_ahb]
                )
    [  239.849419] [<7f55b7dc>] (ath11k_ahb_ext_grp_napi_poll [ath11k_ahb]) from [<8073ce1c>] (net_rx_action+0xe0/0x28c)
    [  239.860945] [<8073ce1c>] (net_rx_action) from [<80324868>] (__do_softirq+0xe4/0x228)
    [  239.871269] [<80324868>] (__do_softirq) from [<80324c48>] (irq_exit+0x98/0x108)
    [  239.879080] [<80324c48>] (irq_exit) from [<8035c59c>] (__handle_domain_irq+0x90/0xb4)
    [  239.886114] [<8035c59c>] (__handle_domain_irq) from [<8030137c>] (gic_handle_irq+0x50/0x94)
    [  239.894100] [<8030137c>] (gic_handle_irq) from [<803024c0>] (__irq_svc+0x40/0x74)
    
    Signed-off-by: Seevalamuthu Mariappan <seevalam@codeaurora.org>
    Link: https://lore.kernel.org/r/1616163532-3881-1-git-send-email-seevalam@codeaurora.org
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 3818d816c51edcc32d334eeca525e2624c884b86
Author: Qingqing Zhuo <qingqing.zhuo@amd.com>
Date:   Thu Mar 25 03:44:11 2021 -0400

    drm/amd/display: Add missing mask for DCN3
    
    [ Upstream commit df7232c4c676be29f1cf45058ec156c1183539ff ]
    
    [Why]
    DCN3 is not reusing DCN1 mask_sh_list, causing
    SURFACE_FLIP_INT_MASK missing in the mapping.
    
    [How]
    Add the corresponding entry to DCN3 list.
    
    Signed-off-by: Qingqing Zhuo <qingqing.zhuo@amd.com>
    Reviewed-by: Nicholas Kazlauskas <Nicholas.Kazlauskas@amd.com>
    Acked-by: Qingqing Zhuo <qingqing.zhuo@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit f3f4b9a7546610a789480658bb6444124a47fd11
Author: Guenter Roeck <linux@roeck-us.net>
Date:   Mon Apr 5 21:29:22 2021 -0700

    pcnet32: Use pci_resource_len to validate PCI resource
    
    [ Upstream commit 66c3f05ddc538ee796321210c906b6ae6fc0792a ]
    
    pci_resource_start() is not a good indicator to determine if a PCI
    resource exists or not, since the resource may start at address 0.
    This is seen when trying to instantiate the driver in qemu for riscv32
    or riscv64.
    
    pci 0000:00:01.0: reg 0x10: [io  0x0000-0x001f]
    pci 0000:00:01.0: reg 0x14: [mem 0x00000000-0x0000001f]
    ...
    pcnet32: card has no PCI IO resources, aborting
    
    Use pci_resouce_len() instead.
    
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 6aaa6355809bd4a1b59e50e3b676b70659cfd516
Author: Alexander Aring <aahringo@redhat.com>
Date:   Sun Apr 4 20:30:52 2021 -0400

    net: ieee802154: forbid monitor for add llsec seclevel
    
    [ Upstream commit 9ec87e322428d4734ac647d1a8e507434086993d ]
    
    This patch forbids to add llsec seclevel for monitor interfaces which we
    don't support yet. Otherwise we will access llsec mib which isn't
    initialized for monitors.
    
    Signed-off-by: Alexander Aring <aahringo@redhat.com>
    Link: https://lore.kernel.org/r/20210405003054.256017-14-aahringo@redhat.com
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit eacb3f44f1418c285cae1b776cf72cdf63fb3d8d
Author: Alexander Aring <aahringo@redhat.com>
Date:   Sun Apr 4 20:30:51 2021 -0400

    net: ieee802154: stop dump llsec seclevels for monitors
    
    [ Upstream commit 4c9b4f55ad1f5a4b6206ac4ea58f273126d21925 ]
    
    This patch stops dumping llsec seclevels for monitors which we don't
    support yet. Otherwise we will access llsec mib which isn't initialized
    for monitors.
    
    Signed-off-by: Alexander Aring <aahringo@redhat.com>
    Link: https://lore.kernel.org/r/20210405003054.256017-13-aahringo@redhat.com
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 192f6284c9a5cf53bd5fd7de4594747cea5b6cb3
Author: Alexander Aring <aahringo@redhat.com>
Date:   Sun Apr 4 20:30:50 2021 -0400

    net: ieee802154: forbid monitor for del llsec devkey
    
    [ Upstream commit 6fb8045319ef172dc88a8142e7f8b58c7608137e ]
    
    This patch forbids to del llsec devkey for monitor interfaces which we
    don't support yet. Otherwise we will access llsec mib which isn't
    initialized for monitors.
    
    Signed-off-by: Alexander Aring <aahringo@redhat.com>
    Link: https://lore.kernel.org/r/20210405003054.256017-12-aahringo@redhat.com
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 913966fddd3156205d646f52ce86e7d942b8535c
Author: Alexander Aring <aahringo@redhat.com>
Date:   Sun Apr 4 20:30:49 2021 -0400

    net: ieee802154: forbid monitor for add llsec devkey
    
    [ Upstream commit a347b3b394868fef15b16f143719df56184be81d ]
    
    This patch forbids to add llsec devkey for monitor interfaces which we
    don't support yet. Otherwise we will access llsec mib which isn't
    initialized for monitors.
    
    Signed-off-by: Alexander Aring <aahringo@redhat.com>
    Link: https://lore.kernel.org/r/20210405003054.256017-11-aahringo@redhat.com
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 515043d3cace32e207b79388c16823ebe03a90e0
Author: Alexander Aring <aahringo@redhat.com>
Date:   Sun Apr 4 20:30:48 2021 -0400

    net: ieee802154: stop dump llsec devkeys for monitors
    
    [ Upstream commit 080d1a57a94d93e70f84b7a360baa351388c574f ]
    
    This patch stops dumping llsec devkeys for monitors which we don't support
    yet. Otherwise we will access llsec mib which isn't initialized for
    monitors.
    
    Signed-off-by: Alexander Aring <aahringo@redhat.com>
    Link: https://lore.kernel.org/r/20210405003054.256017-10-aahringo@redhat.com
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5ce48add3c1c6b7ad70d902f5f8294a3fb7d7b2a
Author: Alexander Aring <aahringo@redhat.com>
Date:   Sun Apr 4 20:30:47 2021 -0400

    net: ieee802154: forbid monitor for del llsec dev
    
    [ Upstream commit ad8f9de1f3566686af35b1c6b43240726541da61 ]
    
    This patch forbids to del llsec dev for monitor interfaces which we
    don't support yet. Otherwise we will access llsec mib which isn't
    initialized for monitors.
    
    Signed-off-by: Alexander Aring <aahringo@redhat.com>
    Link: https://lore.kernel.org/r/20210405003054.256017-9-aahringo@redhat.com
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 392cb23ff9b843760ce5e6fdea223ae725967884
Author: Alexander Aring <aahringo@redhat.com>
Date:   Sun Apr 4 20:30:46 2021 -0400

    net: ieee802154: forbid monitor for add llsec dev
    
    [ Upstream commit 5303f956b05a2886ff42890908156afaec0f95ac ]
    
    This patch forbids to add llsec dev for monitor interfaces which we
    don't support yet. Otherwise we will access llsec mib which isn't
    initialized for monitors.
    
    Signed-off-by: Alexander Aring <aahringo@redhat.com>
    Link: https://lore.kernel.org/r/20210405003054.256017-8-aahringo@redhat.com
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 67229182aac8b9c1e3f773f07f539f341d907619
Author: Alexander Aring <aahringo@redhat.com>
Date:   Sun Apr 4 20:30:45 2021 -0400

    net: ieee802154: stop dump llsec devs for monitors
    
    [ Upstream commit 5582d641e6740839c9b83efd1fbf9bcd00b6f5fc ]
    
    This patch stops dumping llsec devs for monitors which we don't support
    yet. Otherwise we will access llsec mib which isn't initialized for
    monitors.
    
    Signed-off-by: Alexander Aring <aahringo@redhat.com>
    Link: https://lore.kernel.org/r/20210405003054.256017-7-aahringo@redhat.com
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit baf6c8d17116452e341b8b3794647c36ac19102f
Author: Alexander Aring <aahringo@redhat.com>
Date:   Sun Apr 4 20:30:44 2021 -0400

    net: ieee802154: forbid monitor for del llsec key
    
    [ Upstream commit b6e2949544a183f590ae6f3ef2d1aaaa2c44e38a ]
    
    This patch forbids to del llsec key for monitor interfaces which we
    don't support yet. Otherwise we will access llsec mib which isn't
    initialized for monitors.
    
    Signed-off-by: Alexander Aring <aahringo@redhat.com>
    Link: https://lore.kernel.org/r/20210405003054.256017-6-aahringo@redhat.com
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 3d89b833bba2df8366a0a5aa7b5313a9ff943af0
Author: Alexander Aring <aahringo@redhat.com>
Date:   Sun Apr 4 20:30:43 2021 -0400

    net: ieee802154: forbid monitor for add llsec key
    
    [ Upstream commit 08470c5453339369bd3d590c4cbb0b5961cdcbb6 ]
    
    This patch forbids to add llsec key for monitor interfaces which we
    don't support yet. Otherwise we will access llsec mib which isn't
    initialized for monitors.
    
    Signed-off-by: Alexander Aring <aahringo@redhat.com>
    Link: https://lore.kernel.org/r/20210405003054.256017-5-aahringo@redhat.com
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 18feecdfff091a59fbf46ba27b8a5e18db130a4d
Author: Alexander Aring <aahringo@redhat.com>
Date:   Sun Apr 4 20:30:42 2021 -0400

    net: ieee802154: stop dump llsec keys for monitors
    
    [ Upstream commit fb3c5cdf88cd504ef11d59e8d656f4bc896c6922 ]
    
    This patch stops dumping llsec keys for monitors which we don't support
    yet. Otherwise we will access llsec mib which isn't initialized for
    monitors.
    
    Signed-off-by: Alexander Aring <aahringo@redhat.com>
    Link: https://lore.kernel.org/r/20210405003054.256017-4-aahringo@redhat.com
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 694a2909c986f979120da6c0f63290e09195ad2a
Author: Matt Chen <matt.chen@intel.com>
Date:   Fri Mar 26 12:57:19 2021 +0200

    iwlwifi: add support for Qu with AX201 device
    
    [ Upstream commit 97195d3cad852063208a1cd4f4d073459547a415 ]
    
    Add this specific Samsung AX201 sku to driver so it can be
    detected and initialized successfully.
    
    Signed-off-by: Matt Chen <matt.chen@intel.com>
    Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Link: https://lore.kernel.org/r/iwlwifi.20210326125611.30b622037714.Id9fd709cf1c8261c097bbfd7453f6476077dcafc@changeid
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 67819bebd1c70389cce18f2f9daba7e4bef192a2
Author: Martin Wilck <mwilck@suse.com>
Date:   Thu Apr 1 11:11:05 2021 +0200

    scsi: scsi_transport_srp: Don't block target in SRP_PORT_LOST state
    
    [ Upstream commit 5cd0f6f57639c5afbb36100c69281fee82c95ee7 ]
    
    rport_dev_loss_timedout() sets the rport state to SRP_PORT_LOST and the
    SCSI target state to SDEV_TRANSPORT_OFFLINE. If this races with
    srp_reconnect_work(), a warning is printed:
    
    Mar 27 18:48:07 ictm1604s01h4 kernel: dev_loss_tmo expired for SRP port-18:1 / host18.
    Mar 27 18:48:07 ictm1604s01h4 kernel: ------------[ cut here ]------------
    Mar 27 18:48:07 ictm1604s01h4 kernel: scsi_internal_device_block(18:0:0:100) failed: ret = -22
    Mar 27 18:48:07 ictm1604s01h4 kernel: Call Trace:
    Mar 27 18:48:07 ictm1604s01h4 kernel:  ? scsi_target_unblock+0x50/0x50 [scsi_mod]
    Mar 27 18:48:07 ictm1604s01h4 kernel:  starget_for_each_device+0x80/0xb0 [scsi_mod]
    Mar 27 18:48:07 ictm1604s01h4 kernel:  target_block+0x24/0x30 [scsi_mod]
    Mar 27 18:48:07 ictm1604s01h4 kernel:  device_for_each_child+0x57/0x90
    Mar 27 18:48:07 ictm1604s01h4 kernel:  srp_reconnect_rport+0xe4/0x230 [scsi_transport_srp]
    Mar 27 18:48:07 ictm1604s01h4 kernel:  srp_reconnect_work+0x40/0xc0 [scsi_transport_srp]
    
    Avoid this by not trying to block targets for rports in SRP_PORT_LOST
    state.
    
    Link: https://lore.kernel.org/r/20210401091105.8046-1-mwilck@suse.com
    Reviewed-by: Bart Van Assche <bvanassche@acm.org>
    Signed-off-by: Martin Wilck <mwilck@suse.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4640c9ac82624b07e8e325dc489df476d9b39232
Author: Alexander Shiyan <shc_work@mail.ru>
Date:   Fri Apr 2 11:14:05 2021 +0300

    ASoC: fsl_esai: Fix TDM slot setup for I2S mode
    
    [ Upstream commit e7a48c710defa0e0fef54d42b7d9e4ab596e2761 ]
    
    When using the driver in I2S TDM mode, the fsl_esai_startup()
    function rewrites the number of slots previously set by the
    fsl_esai_set_dai_tdm_slot() function to 2.
    To fix this, let's use the saved slot count value or, if TDM
    is not used and the number of slots is not set, the driver will use
    the default value (2), which is set by fsl_esai_probe().
    
    Signed-off-by: Alexander Shiyan <shc_work@mail.ru>
    Acked-by: Nicolin Chen <nicoleotsuka@gmail.com>
    Link: https://lore.kernel.org/r/20210402081405.9892-1-shc_work@mail.ru
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 3eaf50dad6d135c57f5dae2dd78c20c25ccf5dbd
Author: Rob Clark <robdclark@chromium.org>
Date:   Wed Mar 24 18:23:52 2021 -0700

    drm/msm: Fix a5xx/a6xx timestamps
    
    [ Upstream commit 9fbd3088351b92e8c2cef6e37a39decb12a8d5bb ]
    
    They were reading a counter that was configured to ALWAYS_COUNT (ie.
    cycles that the GPU is doing something) rather than ALWAYS_ON.  This
    isn't the thing that userspace is looking for.
    
    Signed-off-by: Rob Clark <robdclark@chromium.org>
    Acked-by: Jordan Crouse <jordan@cosmicpenguin.net>
    Message-Id: <20210325012358.1759770-2-robdclark@gmail.com>
    Signed-off-by: Rob Clark <robdclark@chromium.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit cca23e554060ac4046833a06dfe53a2d7a6180fc
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Mon Mar 8 16:34:21 2021 +0100

    ARM: omap1: fix building with clang IAS
    
    [ Upstream commit 28399a5a6d569c9bdb612345e4933046ca37cde5 ]
    
    The clang integrated assembler fails to build one file with
    a complex asm instruction:
    
    arch/arm/mach-omap1/ams-delta-fiq-handler.S:249:2: error: invalid instruction, any one of the following would fix this:
     mov r10, #(1 << (((NR_IRQS_LEGACY + 12) - NR_IRQS_LEGACY) % 32)) @ set deferred_fiq bit
     ^
    arch/arm/mach-omap1/ams-delta-fiq-handler.S:249:2: note: instruction requires: armv6t2
     mov r10, #(1 << (((NR_IRQS_LEGACY + 12) - NR_IRQS_LEGACY) % 32)) @ set deferred_fiq bit
     ^
    arch/arm/mach-omap1/ams-delta-fiq-handler.S:249:2: note: instruction requires: thumb2
     mov r10, #(1 << (((NR_IRQS_LEGACY + 12) - NR_IRQS_LEGACY) % 32)) @ set deferred_fiq bit
     ^
    
    The problem is that 'NR_IRQS_LEGACY' is not defined here. Apparently
    gas does not care because we first add and then subtract this number,
    leading to the immediate value to be the same regardless of the
    specific definition of NR_IRQS_LEGACY.
    
    Neither the way that 'gas' just silently builds this file, nor the
    way that clang IAS makes nonsensical suggestions for how to fix it
    is great. Fortunately there is an easy fix, which is to #include
    the header that contains the definition.
    
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Acked-by: Tony Lindgren <tony@atomide.com>
    Link: https://lore.kernel.org/r/20210308153430.2530616-1-arnd@kernel.org'
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4e00eefec82ae892ffd312b4facb4ff1a7395e36
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Tue Mar 23 14:18:05 2021 +0100

    ARM: keystone: fix integer overflow warning
    
    [ Upstream commit 844b85dda2f569943e1e018fdd63b6f7d1d6f08e ]
    
    clang warns about an impossible condition when building with 32-bit
    phys_addr_t:
    
    arch/arm/mach-keystone/keystone.c:79:16: error: result of comparison of constant 51539607551 with expression of type 'phys_addr_t' (aka 'unsigned int') is always false [-Werror,-Wtautological-constant-out-of-range-compare]
                mem_end   > KEYSTONE_HIGH_PHYS_END) {
                ~~~~~~~   ^ ~~~~~~~~~~~~~~~~~~~~~~
    arch/arm/mach-keystone/keystone.c:78:16: error: result of comparison of constant 34359738368 with expression of type 'phys_addr_t' (aka 'unsigned int') is always true [-Werror,-Wtautological-constant-out-of-range-compare]
            if (mem_start < KEYSTONE_HIGH_PHYS_START ||
                ~~~~~~~~~ ^ ~~~~~~~~~~~~~~~~~~~~~~~~
    
    Change the temporary variable to a fixed-size u64 to avoid the warning.
    
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Reviewed-by: Nathan Chancellor <nathan@kernel.org>
    Acked-by: Santosh Shilimkar <ssantosh@kernel.org>
    Link: https://lore.kernel.org/r/20210323131814.2751750-1-arnd@kernel.org'
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit dfd1a6ab600475db5a95eae38b42c66ee0ca1ebc
Author: Christophe Leroy <christophe.leroy@csgroup.eu>
Date:   Wed Mar 31 14:07:04 2021 +0000

    powerpc/signal32: Fix Oops on sigreturn with unmapped VDSO
    
    [ Upstream commit acca57217c688c5bbbd5140974533d81e8757cc9 ]
    
    PPC32 encounters a KUAP fault when trying to handle a signal with
    VDSO unmapped.
    
            Kernel attempted to read user page (7fc07ec0) - exploit attempt? (uid: 0)
            BUG: Unable to handle kernel data access on read at 0x7fc07ec0
            Faulting instruction address: 0xc00111d4
            Oops: Kernel access of bad area, sig: 11 [#1]
            BE PAGE_SIZE=16K PREEMPT CMPC885
            CPU: 0 PID: 353 Comm: sigreturn_vdso Not tainted 5.12.0-rc4-s3k-dev-01553-gb30c310ea220 #4814
            NIP:  c00111d4 LR: c0005a28 CTR: 00000000
            REGS: cadb3dd0 TRAP: 0300   Not tainted  (5.12.0-rc4-s3k-dev-01553-gb30c310ea220)
            MSR:  00009032 <EE,ME,IR,DR,RI>  CR: 48000884  XER: 20000000
            DAR: 7fc07ec0 DSISR: 88000000
            GPR00: c0007788 cadb3e90 c28d4a40 7fc07ec0 7fc07ed0 000004e0 7fc07ce0 00000000
            GPR08: 00000001 00000001 7fc07ec0 00000000 28000282 1001b828 100a0920 00000000
            GPR16: 100cac0c 100b0000 105c43a4 105c5685 100d0000 100d0000 100d0000 100b2e9e
            GPR24: ffffffff 105c43c8 00000000 7fc07ec8 cadb3f40 cadb3ec8 c28d4a40 00000000
            NIP [c00111d4] flush_icache_range+0x90/0xb4
            LR [c0005a28] handle_signal32+0x1bc/0x1c4
            Call Trace:
            [cadb3e90] [100d0000] 0x100d0000 (unreliable)
            [cadb3ec0] [c0007788] do_notify_resume+0x260/0x314
            [cadb3f20] [c000c764] syscall_exit_prepare+0x120/0x184
            [cadb3f30] [c00100b4] ret_from_syscall+0xc/0x28
            --- interrupt: c00 at 0xfe807f8
            NIP:  0fe807f8 LR: 10001060 CTR: c0139378
            REGS: cadb3f40 TRAP: 0c00   Not tainted  (5.12.0-rc4-s3k-dev-01553-gb30c310ea220)
            MSR:  0000d032 <EE,PR,ME,IR,DR,RI>  CR: 28000482  XER: 20000000
    
            GPR00: 00000025 7fc081c0 77bb1690 00000000 0000000a 28000482 00000001 0ff03a38
            GPR08: 0000d032 00006de5 c28d4a40 00000009 88000482 1001b828 100a0920 00000000
            GPR16: 100cac0c 100b0000 105c43a4 105c5685 100d0000 100d0000 100d0000 100b2e9e
            GPR24: ffffffff 105c43c8 00000000 77ba7628 10002398 10010000 10002124 00024000
            NIP [0fe807f8] 0xfe807f8
            LR [10001060] 0x10001060
            --- interrupt: c00
            Instruction dump:
            38630010 7c001fac 38630010 4200fff0 7c0004ac 4c00012c 4e800020 7c001fac
            2c0a0000 38630010 4082ffcc 4bffffe4 <7c00186c> 2c070000 39430010 4082ff8c
            ---[ end trace 3973fb72b049cb06 ]---
    
    This is because flush_icache_range() is called on user addresses.
    
    The same problem was detected some time ago on PPC64. It was fixed by
    enabling KUAP in commit 59bee45b9712 ("powerpc/mm: Fix missing KUAP
    disable in flush_coherent_icache()").
    
    PPC32 doesn't use flush_coherent_icache() and fallbacks on
    clean_dcache_range() and invalidate_icache_range().
    
    We could fix it similarly by enabling user access in those functions,
    but this is overkill for just flushing two instructions.
    
    The two instructions are 8 bytes aligned, so a single dcbst/icbi is
    enough to flush them. Do like __patch_instruction() and inline
    a dcbst followed by an icbi just after the write of the instructions,
    while user access is still allowed. The isync is not required because
    rfi will be used to return to user.
    
    icbi() is handled as a read so read-write user access is needed.
    
    Signed-off-by: Christophe Leroy <christophe.leroy@csgroup.eu>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Link: https://lore.kernel.org/r/bde9154e5351a5ac7bca3d59cdb5a5e8edacbb79.1617199569.git.christophe.leroy@csgroup.eu
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 6e1585a0783baa89524bc3fe8315e684d370ec72
Author: Tong Zhu <zhutong@amazon.com>
Date:   Fri Mar 19 14:33:37 2021 -0400

    neighbour: Disregard DEAD dst in neigh_update
    
    [ Upstream commit d47ec7a0a7271dda08932d6208e4ab65ab0c987c ]
    
    After a short network outage, the dst_entry is timed out and put
    in DST_OBSOLETE_DEAD. We are in this code because arp reply comes
    from this neighbour after network recovers. There is a potential
    race condition that dst_entry is still in DST_OBSOLETE_DEAD.
    With that, another neighbour lookup causes more harm than good.
    
    In best case all packets in arp_queue are lost. This is
    counterproductive to the original goal of finding a better path
    for those packets.
    
    I observed a worst case with 4.x kernel where a dst_entry in
    DST_OBSOLETE_DEAD state is associated with loopback net_device.
    It leads to an ethernet header with all zero addresses.
    A packet with all zero source MAC address is quite deadly with
    mac80211, ath9k and 802.11 block ack.  It fails
    ieee80211_find_sta_by_ifaddr in ath9k (xmit.c). Ath9k flushes tx
    queue (ath_tx_complete_aggr). BAW (block ack window) is not
    updated. BAW logic is damaged and ath9k transmission is disabled.
    
    Signed-off-by: Tong Zhu <zhutong@amazon.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 3071afa7a8fb0f4004981efa282106505408bee3
Author: Jiri Olsa <jolsa@kernel.org>
Date:   Fri Mar 26 11:59:00 2021 +0100

    bpf: Take module reference for trampoline in module
    
    [ Upstream commit 861de02e5f3f2a104eecc5af1d248cb7bf8c5f75 ]
    
    Currently module can be unloaded even if there's a trampoline
    register in it. It's easily reproduced by running in parallel:
    
      # while :; do ./test_progs -t module_attach; done
      # while :; do rmmod bpf_testmod; sleep 0.5; done
    
    Taking the module reference in case the trampoline's ip is
    within the module code. Releasing it when the trampoline's
    ip is unregistered.
    
    Signed-off-by: Jiri Olsa <jolsa@kernel.org>
    Signed-off-by: Alexei Starovoitov <ast@kernel.org>
    Link: https://lore.kernel.org/bpf/20210326105900.151466-1-jolsa@kernel.org
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit adaf914b7928a464ca15ae8d8cbd8e55b6b5554d
Author: Lv Yunlong <lyl2019@mail.ustc.edu.cn>
Date:   Mon Mar 22 18:46:56 2021 -0700

    gpu/xen: Fix a use after free in xen_drm_drv_init
    
    [ Upstream commit 52762efa2b256ed1c5274e5177cbd52ee11a2f6a ]
    
    In function displback_changed, has the call chain
    displback_connect(front_info)->xen_drm_drv_init(front_info).
    We can see that drm_info is assigned to front_info->drm_info
    and drm_info is freed in fail branch in xen_drm_drv_init().
    
    Later displback_disconnect(front_info) is called and it calls
    xen_drm_drv_fini(front_info) cause a use after free by
    drm_info = front_info->drm_info statement.
    
    My patch has done two things. First fixes the fail label which
    drm_info = kzalloc() failed and still free the drm_info.
    Second sets front_info->drm_info to NULL to avoid uaf.
    
    Signed-off-by: Lv Yunlong <lyl2019@mail.ustc.edu.cn>
    Reviewed-by: Oleksandr Andrushchenko <oleksandr_andrushchenko@epam.com>
    Signed-off-by: Oleksandr Andrushchenko <oleksandr_andrushchenko@epam.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20210323014656.10068-1-lyl2019@mail.ustc.edu.cn
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 10c717b978a992fd925bb58e210af46bdeade3e2
Author: Daniel Mack <daniel@zonque.org>
Date:   Wed Mar 24 14:05:36 2021 +0100

    net: axienet: allow setups without MDIO
    
    [ Upstream commit de9c7854e6e1589f639c6352112956d08243b659 ]
    
    In setups with fixed-link settings there is no mdio node in DTS.
    axienet_probe() already handles that gracefully but lp->mii_bus is
    then NULL.
    
    Fix code that tries to blindly grab the MDIO lock by introducing two helper
    functions that make the locking conditional.
    
    Signed-off-by: Daniel Mack <daniel@zonque.org>
    Reviewed-by: Radhey Shyam Pandey <radhey.shyam.pandey@xilinx.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit f4d949ed4958ddf0a3622bad0fde548ec62381ca
Author: Ryan Lee <ryans.lee@maximintegrated.com>
Date:   Wed Mar 24 20:35:54 2021 -0700

    ASoC: max98373: Added 30ms turn on/off time delay
    
    [ Upstream commit 3a27875e91fb9c29de436199d20b33f9413aea77 ]
    
    Amp requires 10 ~ 30ms for the power ON and OFF.
    Added 30ms delay for stability.
    
    Signed-off-by: Ryan Lee <ryans.lee@maximintegrated.com>
    Link: https://lore.kernel.org/r/20210325033555.29377-2-ryans.lee@maximintegrated.com
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit cb2959861b9f44a48668358ea235922fcfce832e
Author: Ryan Lee <ryans.lee@maximintegrated.com>
Date:   Wed Mar 24 20:35:53 2021 -0700

    ASoC: max98373: Changed amp shutdown register as volatile
    
    [ Upstream commit a23f9099ff1541f15704e96b784d3846d2a4483d ]
    
    0x20FF(amp global enable) register was defined as non-volatile,
    but it is not. Overheating, overcurrent can cause amp shutdown
    in hardware.
    'regmap_write' compare register readback value before writing
    to avoid same value writing. 'regmap_read' just read cache
    not actual hardware value for the non-volatile register.
    When amp is internally shutdown by some reason, next 'AMP ON'
    command can be ignored because regmap think amp is already ON.
    
    Signed-off-by: Ryan Lee <ryans.lee@maximintegrated.com>
    Link: https://lore.kernel.org/r/20210325033555.29377-1-ryans.lee@maximintegrated.com
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 39bc1efe43b086e55019d765a8eb2952b6b89392
Author: Xin Long <lucien.xin@gmail.com>
Date:   Fri Mar 19 18:27:58 2021 +0800

    xfrm: BEET mode doesn't support fragments for inner packets
    
    [ Upstream commit 68dc022d04eb0fd60a540e242dcb11ec1bee07e2 ]
    
    BEET mode replaces the IP(6) Headers with new IP(6) Headers when sending
    packets. However, when it's a fragment before the replacement, currently
    kernel keeps the fragment flag and replace the address field then encaps
    it with ESP. It would cause in RX side the fragments to get reassembled
    before decapping with ESP, which is incorrect.
    
    In Xiumei's testing, these fragments went over an xfrm interface and got
    encapped with ESP in the device driver, and the traffic was broken.
    
    I don't have a good way to fix it, but only to warn this out in dmesg.
    
    Reported-by: Xiumei Mu <xmu@redhat.com>
    Signed-off-by: Xin Long <lucien.xin@gmail.com>
    Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit e553ea86aad38784b92ae0a59a79137236e513a7
Author: Jiri Kosina <jkosina@suse.cz>
Date:   Tue Mar 2 11:26:55 2021 +0100

    iwlwifi: Fix softirq/hardirq disabling in iwl_pcie_enqueue_hcmd()
    
    [ Upstream commit 2800aadc18a64c96b051bcb7da8a7df7d505db3f ]
    
    It's possible for iwl_pcie_enqueue_hcmd() to be called with hard IRQs
    disabled (e.g. from LED core). We can't enable BHs in such a situation.
    
    Turn the unconditional BH-enable/BH-disable code into
    hardirq-disable/conditional-enable.
    
    This fixes the warning below.
    
     WARNING: CPU: 1 PID: 1139 at kernel/softirq.c:178 __local_bh_enable_ip+0xa5/0xf0
     CPU: 1 PID: 1139 Comm: NetworkManager Not tainted 5.12.0-rc1-00004-gb4ded168af79 #7
     Hardware name: LENOVO 20K5S22R00/20K5S22R00, BIOS R0IET38W (1.16 ) 05/31/2017
     RIP: 0010:__local_bh_enable_ip+0xa5/0xf0
     Code: f7 69 e8 ee 23 14 00 fb 66 0f 1f 44 00 00 65 8b 05 f0 f4 f7 69 85 c0 74 3f 48 83 c4 08 5b c3 65 8b 05 9b fe f7 69 85 c0 75 8e <0f> 0b eb 8a 48 89 3c 24 e8 4e 20 14 00 48 8b 3c 24 eb 91 e8 13 4e
     RSP: 0018:ffffafd580b13298 EFLAGS: 00010046
     RAX: 0000000000000000 RBX: 0000000000000201 RCX: 0000000000000000
     RDX: 0000000000000003 RSI: 0000000000000201 RDI: ffffffffc1272389
     RBP: ffff96517ae4c018 R08: 0000000000000001 R09: 0000000000000000
     R10: ffffafd580b13178 R11: 0000000000000001 R12: ffff96517b060000
     R13: 0000000000000000 R14: ffffffff80000000 R15: 0000000000000001
     FS:  00007fc604ebefc0(0000) GS:ffff965267480000(0000) knlGS:0000000000000000
     CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
     CR2: 000055fb3fef13b2 CR3: 0000000109112004 CR4: 00000000003706e0
     Call Trace:
      ? _raw_spin_unlock_bh+0x1f/0x30
      iwl_pcie_enqueue_hcmd+0x5d9/0xa00 [iwlwifi]
      iwl_trans_txq_send_hcmd+0x6c/0x430 [iwlwifi]
      iwl_trans_send_cmd+0x88/0x170 [iwlwifi]
      ? lock_acquire+0x277/0x3d0
      iwl_mvm_send_cmd+0x32/0x80 [iwlmvm]
      iwl_mvm_led_set+0xc2/0xe0 [iwlmvm]
      ? led_trigger_event+0x46/0x70
      led_trigger_event+0x46/0x70
      ieee80211_do_open+0x5c5/0xa20 [mac80211]
      ieee80211_open+0x67/0x90 [mac80211]
      __dev_open+0xd4/0x150
      __dev_change_flags+0x19e/0x1f0
      dev_change_flags+0x23/0x60
      do_setlink+0x30d/0x1230
      ? lock_is_held_type+0xb4/0x120
      ? __nla_validate_parse.part.7+0x57/0xcb0
      ? __lock_acquire+0x2e1/0x1a50
      __rtnl_newlink+0x560/0x910
      ? __lock_acquire+0x2e1/0x1a50
      ? __lock_acquire+0x2e1/0x1a50
      ? lock_acquire+0x277/0x3d0
      ? sock_def_readable+0x5/0x290
      ? lock_is_held_type+0xb4/0x120
      ? find_held_lock+0x2d/0x90
      ? sock_def_readable+0xb3/0x290
      ? lock_release+0x166/0x2a0
      ? lock_is_held_type+0x90/0x120
      rtnl_newlink+0x47/0x70
      rtnetlink_rcv_msg+0x25c/0x470
      ? netlink_deliver_tap+0x97/0x3e0
      ? validate_linkmsg+0x350/0x350
      netlink_rcv_skb+0x50/0x100
      netlink_unicast+0x1b2/0x280
      netlink_sendmsg+0x336/0x450
      sock_sendmsg+0x5b/0x60
      ____sys_sendmsg+0x1ed/0x250
      ? copy_msghdr_from_user+0x5c/0x90
      ___sys_sendmsg+0x88/0xd0
      ? lock_is_held_type+0xb4/0x120
      ? find_held_lock+0x2d/0x90
      ? lock_release+0x166/0x2a0
      ? __fget_files+0xfe/0x1d0
      ? __sys_sendmsg+0x5e/0xa0
      __sys_sendmsg+0x5e/0xa0
      ? lockdep_hardirqs_on_prepare+0xd9/0x170
      do_syscall_64+0x33/0x80
      entry_SYSCALL_64_after_hwframe+0x44/0xae
     RIP: 0033:0x7fc605c9572d
     Code: 28 89 54 24 1c 48 89 74 24 10 89 7c 24 08 e8 da ee ff ff 8b 54 24 1c 48 8b 74 24 10 41 89 c0 8b 7c 24 08 b8 2e 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 33 44 89 c7 48 89 44 24 08 e8 2e ef ff ff 48
     RSP: 002b:00007fffc83789f0 EFLAGS: 00000293 ORIG_RAX: 000000000000002e
     RAX: ffffffffffffffda RBX: 000055ef468570c0 RCX: 00007fc605c9572d
     RDX: 0000000000000000 RSI: 00007fffc8378a30 RDI: 000000000000000c
     RBP: 0000000000000010 R08: 0000000000000000 R09: 0000000000000000
     R10: 0000000000000000 R11: 0000000000000293 R12: 0000000000000000
     R13: 00007fffc8378b80 R14: 00007fffc8378b7c R15: 0000000000000000
     irq event stamp: 170785
     hardirqs last  enabled at (170783): [<ffffffff9609a8c2>] __local_bh_enable_ip+0x82/0xf0
     hardirqs last disabled at (170784): [<ffffffff96a8613d>] _raw_read_lock_irqsave+0x8d/0x90
     softirqs last  enabled at (170782): [<ffffffffc1272389>] iwl_pcie_enqueue_hcmd+0x5d9/0xa00 [iwlwifi]
     softirqs last disabled at (170785): [<ffffffffc1271ec6>] iwl_pcie_enqueue_hcmd+0x116/0xa00 [iwlwifi]
    
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Tested-by: Sedat Dilek <sedat.dilek@gmail.com> # LLVM/Clang v12.0.0-rc3
    Acked-by: Luca Coelho <luciano.coelho@intel.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Link: https://lore.kernel.org/r/nycvar.YFH.7.76.2103021125430.12405@cbobk.fhfr.pm
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 36eb5f72868cdc7974dd4968fbafbb68bef1e760
Author: Wang Qing <wangqing@vivo.com>
Date:   Mon Mar 1 20:05:48 2021 +0800

    arc: kernel: Return -EFAULT if copy_to_user() fails
    
    [ Upstream commit 46e152186cd89d940b26726fff11eb3f4935b45a ]
    
    The copy_to_user() function returns the number of bytes remaining to be
    copied, but we want to return -EFAULT if the copy doesn't complete.
    
    Signed-off-by: Wang Qing <wangqing@vivo.com>
    Signed-off-by: Vineet Gupta <vgupta@synopsys.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 7ed40be99f453f80de2cf744190efef70a858a52
Author: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>
Date:   Sun Mar 21 15:49:13 2021 +0900

    lockdep: Add a missing initialization hint to the "INFO: Trying to register non-static key" message
    
    [ Upstream commit 3a85969e9d912d5dd85362ee37b5f81266e00e77 ]
    
    Since this message is printed when dynamically allocated spinlocks (e.g.
    kzalloc()) are used without initialization (e.g. spin_lock_init()),
    suggest to developers to check whether initialization functions for objects
    were called, before making developers wonder what annotation is missing.
    
    [ mingo: Minor tweaks to the message. ]
    
    Signed-off-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Link: https://lore.kernel.org/r/20210321064913.4619-1-penguin-kernel@I-love.SAKURA.ne.jp
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 8439ea06a586106f0617b0d500d5239f53a8ec3c
Author: Dimitar Dimitrov <dimitar@dinux.eu>
Date:   Wed Dec 30 12:50:05 2020 +0200

    remoteproc: pru: Fix loading of GNU Binutils ELF
    
    [ Upstream commit e6d9423d31b2f9bdd0220fd0584e3bb6ed2c4e52 ]
    
    PRU port of GNU Binutils lacks support for separate address spaces.
    PRU IRAM addresses are marked with artificial offset to differentiate
    them from DRAM addresses. Hence remoteproc must mask IRAM addresses
    coming from GNU ELF in order to get the true hardware address.
    
    PRU firmware used for testing was the example in:
      https://github.com/dinuxbg/pru-gcc-examples/tree/master/blinking-led/pru
    
    Signed-off-by: Dimitar Dimitrov <dimitar@dinux.eu>
    Link: https://lore.kernel.org/r/20201230105005.30492-1-dimitar@dinux.eu
    Signed-off-by: Bjorn Andersson <bjorn.andersson@linaro.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit ed8041768d4d937b7e05b087e877c6a90f9907b1
Author: Tony Lindgren <tony@atomide.com>
Date:   Mon Mar 8 11:30:45 2021 +0200

    ARM: dts: Fix moving mmc devices with aliases for omap4 & 5
    
    [ Upstream commit 77335a040178a0456d4eabc8bf17a7ca3ee4a327 ]
    
    Fix moving mmc devices with dts aliases as discussed on the lists.
    Without this we now have internal eMMC mmc1 show up as mmc2 compared
    to the earlier order of devices.
    
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 1693e0528f61f62678b9334d99b7ee783f5fbc59
Author: Tony Lindgren <tony@atomide.com>
Date:   Mon Mar 8 11:26:25 2021 +0200

    ARM: dts: Drop duplicate sha2md5_fck to fix clk_disable race
    
    [ Upstream commit 140a776833957539c84301dbdb4c3013876de118 ]
    
    We have a duplicate legacy clock defined for sha2md5_fck that can
    sometimes race with clk_disable() with the dts configured clock
    for OMAP4_SHA2MD5_CLKCTRL when unused clocks are disabled during
    boot causing an "Unhandled fault: imprecise external abort".
    
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 446d890dcea1b979f4007134c9c991e2de8b2859
Author: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Date:   Tue Apr 13 16:01:00 2021 +0200

    ACPI: x86: Call acpi_boot_table_init() after acpi_table_upgrade()
    
    [ Upstream commit 6998a8800d73116187aad542391ce3b2dd0f9e30 ]
    
    Commit 1a1c130ab757 ("ACPI: tables: x86: Reserve memory occupied by
    ACPI tables") attempted to address an issue with reserving the memory
    occupied by ACPI tables, but it broke the initrd-based table override
    mechanism relied on by multiple users.
    
    To restore the initrd-based ACPI table override functionality, move
    the acpi_boot_table_init() invocation in setup_arch() on x86 after
    the acpi_table_upgrade() one.
    
    Fixes: 1a1c130ab757 ("ACPI: tables: x86: Reserve memory occupied by ACPI tables")
    Reported-by: Hans de Goede <hdegoede@redhat.com>
    Tested-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit f7dc8f5619165e1fa3383d0c2519f502d9e2a1a9
Author: Dave Jiang <dave.jiang@intel.com>
Date:   Mon Apr 12 09:02:36 2021 -0700

    dmaengine: idxd: fix wq cleanup of WQCFG registers
    
    [ Upstream commit ea9aadc06a9f10ad20a90edc0a484f1147d88a7a ]
    
    A pre-release silicon erratum workaround where wq reset does not clear
    WQCFG registers was leaked into upstream code. Use wq reset command
    instead of blasting the MMIO region. This also address an issue where
    we clobber registers in future devices.
    
    Fixes: da32b28c95a7 ("dmaengine: idxd: cleanup workqueue config after disabling")
    Reported-by: Shreenivaas Devarajan <shreenivaas.devarajan@intel.com>
    Signed-off-by: Dave Jiang <dave.jiang@intel.com>
    Link: https://lore.kernel.org/r/161824330020.881560.16375921906426627033.stgit@djiang5-desk3.ch.intel.com
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c84b8982d7aa9b4717dc36a1c6cbc93ee153b500
Author: Dave Jiang <dave.jiang@intel.com>
Date:   Mon Apr 12 09:23:27 2021 -0700

    dmaengine: idxd: clear MSIX permission entry on shutdown
    
    [ Upstream commit 6df0e6c57dfc064af330071f372f11aa8c584997 ]
    
    Add disabling/clearing of MSIX permission entries on device shutdown to
    mirror the enabling of the MSIX entries on probe. Current code left the
    MSIX enabled and the pasid entries still programmed at device shutdown.
    
    Fixes: 8e50d392652f ("dmaengine: idxd: Add shared workqueue support")
    Signed-off-by: Dave Jiang <dave.jiang@intel.com>
    Link: https://lore.kernel.org/r/161824457969.882533.6020239898682672311.stgit@djiang5-desk3.ch.intel.com
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d3e9ffcd89f3a577223142c9bc6368cae685ea31
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Tue Mar 23 16:19:59 2021 +0300

    dmaengine: plx_dma: add a missing put_device() on error path
    
    [ Upstream commit 07503e6aefe4a6efd777062191944a14f03b3a18 ]
    
    Add a missing put_device(&pdev->dev) if the call to
    dma_async_device_register(dma); fails.
    
    Fixes: 905ca51e63be ("dmaengine: plx-dma: Introduce PLX DMA engine PCI driver skeleton")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Reviewed-by: Logan Gunthorpe <logang@deltatee.com>
    Link: https://lore.kernel.org/r/YFnq/0IQzixtAbC1@mwanda
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b566faa2e4719fc8bd70ab0be475923213fdf635
Author: Lv Yunlong <lyl2019@mail.ustc.edu.cn>
Date:   Tue Mar 30 18:44:58 2021 -0700

    dmaengine: Fix a double free in dma_async_device_register
    
    [ Upstream commit ea45b6008f8095db0cc09ad6e03c7785c2986197 ]
    
    In the first list_for_each_entry() macro of dma_async_device_register,
    it gets the chan from list and calls __dma_async_device_channel_register
    (..,chan). We can see that chan->local is allocated by alloc_percpu() and
    it is freed chan->local by free_percpu(chan->local) when
    __dma_async_device_channel_register() failed.
    
    But after __dma_async_device_channel_register() failed, the caller will
    goto err_out and freed the chan->local in the second time by free_percpu().
    
    The cause of this problem is forget to set chan->local to NULL when
    chan->local was freed in __dma_async_device_channel_register(). My
    patch sets chan->local to NULL when the callee failed to avoid double free.
    
    Fixes: d2fb0a0438384 ("dmaengine: break out channel registration")
    Signed-off-by: Lv Yunlong <lyl2019@mail.ustc.edu.cn>
    Reviewed-by: Dave Jiang <dave.jiang@intel.com>
    Link: https://lore.kernel.org/r/20210331014458.3944-1-lyl2019@mail.ustc.edu.cn
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d9c0069955f042815e9860cbaa8dabc9a0e06ed8
Author: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Date:   Wed Mar 24 16:17:57 2021 +0200

    dmaengine: dw: Make it dependent to HAS_IOMEM
    
    [ Upstream commit 88cd1d6191b13689094310c2405394e4ce36d061 ]
    
    Some architectures do not provide devm_*() APIs. Hence make the driver
    dependent on HAVE_IOMEM.
    
    Fixes: dbde5c2934d1 ("dw_dmac: use devm_* functions to simplify code")
    Reported-by: kernel test robot <lkp@intel.com>
    Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Link: https://lore.kernel.org/r/20210324141757.24710-1-andriy.shevchenko@linux.intel.com
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 05b7791c4c4aa8304368fdc55ae911f6b34e7281
Author: Dave Jiang <dave.jiang@intel.com>
Date:   Wed Apr 7 12:59:47 2021 -0700

    dmaengine: idxd: fix wq size store permission state
    
    [ Upstream commit 0fff71c5a311e1264988179f7dcc217fda15fadd ]
    
    WQ size can only be changed when the device is disabled. Current code
    allows change when device is enabled but wq is disabled. Change the check
    to detect device state.
    
    Fixes: c52ca478233c ("dmaengine: idxd: add configuration component of driver")
    Signed-off-by: Dave Jiang <dave.jiang@intel.com>
    Link: https://lore.kernel.org/r/161782558755.107710.18138252584838406025.stgit@djiang5-desk3.ch.intel.com
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 60673d3fd69595ebc78213cb6a1617db923d4dcf
Author: Dave Jiang <dave.jiang@intel.com>
Date:   Mon Mar 22 16:37:29 2021 -0700

    dmaengine: idxd: fix opcap sysfs attribute output
    
    [ Upstream commit ea6a5735d2a61b938a302eb3629272342a9e7c46 ]
    
    The operation capability register is 256bits. The current output only
    prints out the first 64bits. Fix to output the entire 256bits. The current
    code omits operation caps from IAX devices.
    
    Fixes: c52ca478233c ("dmaengine: idxd: add configuration component of driver")
    Reported-by: Lucas Van <lucas.van@intel.com>
    Signed-off-by: Dave Jiang <dave.jiang@intel.com>
    Link: https://lore.kernel.org/r/161645624963.2003736.829798666998490151.stgit@djiang5-desk3.ch.intel.com
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 7f9b39e7e4e817498aa0072b6e47367052053d80
Author: Dave Jiang <dave.jiang@intel.com>
Date:   Mon Mar 22 16:36:25 2021 -0700

    dmaengine: idxd: fix delta_rec and crc size field for completion record
    
    [ Upstream commit 4ac823e9cd85f66da274c951d21bf9f6b714b729 ]
    
    The delta_rec_size and crc_val in the completion record should
    be 32bits and not 16bits.
    
    Fixes: bfe1d56091c1 ("dmaengine: idxd: Init and probe for Intel data accelerators")
    Reported-by: Nikhil Rao <nikhil.rao@intel.com>
    Signed-off-by: Dave Jiang <dave.jiang@intel.com>
    Link: https://lore.kernel.org/r/161645618572.2003490.14466173451736323035.stgit@djiang5-desk3.ch.intel.com
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 02981a44a0e402089775416371bd2e0c935685f8
Author: Dave Jiang <dave.jiang@intel.com>
Date:   Tue Feb 16 17:13:42 2021 -0700

    dmaengine: idxd: Fix clobbering of SWERR overflow bit on writeback
    
    [ Upstream commit ea941ac294d75d0ace50797aebf0056f6f8f7a7f ]
    
    Current code blindly writes over the SWERR and the OVERFLOW bits. Write
    back the bits actually read instead so the driver avoids clobbering the
    OVERFLOW bit that comes after the register is read.
    
    Fixes: bfe1d56091c1 ("dmaengine: idxd: Init and probe for Intel data accelerators")
    Reported-by: Sanjay Kumar <sanjay.k.kumar@intel.com>
    Signed-off-by: Dave Jiang <dave.jiang@intel.com>
    Link: https://lore.kernel.org/r/161352082229.3511254.1002151220537623503.stgit@djiang5-desk3.ch.intel.com
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 95cd2562fadafac349e8f39d676fc486e63e560b
Author: Matti Vaittinen <matti.vaittinen@fi.rohmeurope.com>
Date:   Mon Mar 29 14:41:12 2021 +0300

    gpio: sysfs: Obey valid_mask
    
    [ Upstream commit 23cf00ddd2e1aacf1873e43f5e0c519c120daf7a ]
    
    Do not allow exporting GPIOs which are set invalid
    by the driver's valid mask.
    
    Fixes: 726cb3ba4969 ("gpiolib: Support 'gpio-reserved-ranges' property")
    Signed-off-by: Matti Vaittinen <matti.vaittinen@fi.rohmeurope.com>
    Reviewed-by: Andy Shevchenko <andy.shevchenko@gmail.com>
    Signed-off-by: Bartosz Golaszewski <bgolaszewski@baylibre.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit f9440331a84cc72f51352b230a925adf8379aed8
Author: Fabian Vogt <fabian@ritter-vogt.de>
Date:   Tue Mar 23 10:45:55 2021 -0700

    Input: nspire-keypad - enable interrupts only when opened
    
    [ Upstream commit 69d5ff3e9e51e23d5d81bf48480aa5671be67a71 ]
    
    The driver registers an interrupt handler in _probe, but didn't configure
    them until later when the _open function is called. In between, the keypad
    can fire an IRQ due to touchpad activity, which the handler ignores. This
    causes the kernel to disable the interrupt, blocking the keypad from
    working.
    
    Fix this by disabling interrupts before registering the handler.
    Additionally, disable them in _close, so that they're only enabled while
    open.
    
    Fixes: fc4f31461892 ("Input: add TI-Nspire keypad support")
    Signed-off-by: Fabian Vogt <fabian@ritter-vogt.de>
    Link: https://lore.kernel.org/r/3383725.iizBOSrK1V@linux-e202.suse.de
    Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d3eaed9a417da18504bf6542f851b4df4da794ea
Author: Hauke Mehrtens <hauke@hauke-m.de>
Date:   Tue Mar 9 01:01:07 2021 +0100

    mtd: rawnand: mtk: Fix WAITRDY break condition and timeout
    
    [ Upstream commit 2fb164f0ce95e504e2688b4f984893c29ebd19ab ]
    
    This fixes NAND_OP_WAITRDY_INSTR operation in the driver. Without this
    change the driver waits till the system is busy, but we should wait till
    the busy flag is cleared. The readl_poll_timeout() function gets a break
    condition, not a wait condition.
    
    In addition fix the timeout. The timeout_ms is given in ms, but the
    readl_poll_timeout() function takes the timeout in us. Multiple the
    given timeout by 1000 to convert it.
    
    Without this change, the driver does not work at all, it doesn't even
    identify the NAND chip.
    
    Fixes: 5197360f9e09 ("mtd: rawnand: mtk: Convert the driver to exec_op()")
    Signed-off-by: Hauke Mehrtens <hauke@hauke-m.de>
    Reviewed-by: Boris Brezillon <boris.brezillon@collabora.com>
    Signed-off-by: Miquel Raynal <miquel.raynal@bootlin.com>
    Link: https://lore.kernel.org/linux-mtd/20210309000107.1368404-1-hauke@hauke-m.de
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 6a3432139cc792b4d9fa96f7cc420e9a20eb8365
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Thu Jan 28 13:12:19 2021 +0100

    AMD_SFH: Add DMI quirk table for BIOS-es which don't set the activestatus bits
    
    [ Upstream commit 25615e454a0ec198254f17d2ed79b607cb755d0e ]
    
    Some BIOS-es do not initialize the activestatus bits of the AMD_P2C_MSG3
    register. This cause the AMD_SFH driver to not register any sensors even
    though the laptops in question do have sensors.
    
    Add a DMI quirk-table for specifying sensor-mask overrides based on
    DMI match, to make the sensors work OOTB on these laptop models.
    
    BugLink: https://bugzilla.kernel.org/show_bug.cgi?id=199715
    BugLink: https://bugzilla.redhat.com/show_bug.cgi?id=1651886
    Fixes: 4f567b9f8141 ("SFH: PCIe driver to add support of AMD sensor fusion hub")
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Acked-by: Sandeep Singh <sandeep.singh@amd.com
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 096515a2b4944afe602823e606d51798fb415baf
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Thu Jan 28 13:12:18 2021 +0100

    AMD_SFH: Add sensor_mask module parameter
    
    [ Upstream commit 952f7d10c6b1685c6700fb24cf4ecbcf26ede77e ]
    
    Add a sensor_mask module parameter which can be used to override the
    sensor-mask read from the activestatus bits of the AMD_P2C_MSG3
    registers. Some BIOS-es do not program the activestatus bits, leading
    to the AMD-SFH driver not registering any HID devices even though the
    laptop in question does actually have sensors.
    
    While at it also fix the wrong indentation of the MAGNO_EN define.
    
    BugLink: https://bugzilla.kernel.org/show_bug.cgi?id=199715
    BugLink: https://bugzilla.redhat.com/show_bug.cgi?id=1651886
    Fixes: 4f567b9f8141 ("SFH: PCIe driver to add support of AMD sensor fusion hub")
    Suggested-by: Richard Neumann <mail@richard-neumann.de>
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Acked-by: Sandeep Singh <sandeep.singh@amd.com
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 9c82226d06c4c8667475098667a0d30cc61b6131
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Thu Jan 28 13:12:17 2021 +0100

    AMD_SFH: Removed unused activecontrolstatus member from the amd_mp2_dev struct
    
    [ Upstream commit a9e54f4b62dcfed4432a5a89b1cd5903737f6e83 ]
    
    This value is only used once inside amd_mp2_get_sensor_num(),
    so there is no need to store this in the amd_mp2_dev struct,
    amd_mp2_get_sensor_num() can simple use a local variable for this.
    
    Fixes: 4f567b9f8141 ("SFH: PCIe driver to add support of AMD sensor fusion hub")
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Acked-by: Sandeep Singh <sandeep.singh@amd.com
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Sasha Levin <sashal@kernel.org>
