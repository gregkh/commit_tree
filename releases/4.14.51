commit 33445c07cd45541410fb4cabd08b10827764c07f
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Thu Jun 21 04:03:02 2018 +0900

    Linux 4.14.51

commit 40c809774c692877b1167003d9807f7aaa46ad2b
Author: Eric Dumazet <edumazet@google.com>
Date:   Sun Dec 10 17:55:02 2017 -0800

    tcp: do not overshoot window_clamp in tcp_rcv_space_adjust()
    
    commit 02db55718d53f9d426cee504c27fb768e9ed4ffe upstream.
    
    While rcvbuf is properly clamped by tcp_rmem[2], rcvwin
    is left to a potentially too big value.
    
    It has no serious effect, since :
    1) tcp_grow_window() has very strict checks.
    2) window_clamp can be mangled by user space to any value anyway.
    
    tcp_init_buffer_space() and companions use tcp_full_space(),
    we use tcp_win_from_space() to avoid reloading sk->sk_rcvbuf
    
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Acked-by: Soheil Hassas Yeganeh <soheil@google.com>
    Acked-by: Wei Wang <weiwan@google.com>
    Acked-by: Neal Cardwell <ncardwell@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Cc: Benjamin Gilbert <benjamin.gilbert@coreos.com>
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7ab8fc065fff258d0b2c5e48e529fd780905db45
Author: Liu Bo <bo.li.liu@oracle.com>
Date:   Fri Jun 15 02:39:04 2018 +0000

    Btrfs: make raid6 rebuild retry more
    
    [ Upstream commit 8810f7517a3bc4ca2d41d022446d3f5fd6b77c09 ]
    
    There is a scenario that can end up with rebuild process failing to
    return good content, i.e.
    suppose that all disks can be read without problems and if the content
    that was read out doesn't match its checksum, currently for raid6
    btrfs at most retries twice,
    
    - the 1st retry is to rebuild with all other stripes, it'll eventually
      be a raid5 xor rebuild,
    - if the 1st fails, the 2nd retry will deliberately fail parity p so
      that it will do raid6 style rebuild,
    
    however, the chances are that another non-parity stripe content also
    has something corrupted, so that the above retries are not able to
    return correct content, and users will think of this as data loss.
    More seriouly, if the loss happens on some important internal btree
    roots, it could refuse to mount.
    
    This extends btrfs to do more retries and each retry fails only one
    stripe.  Since raid6 can tolerate 2 disk failures, if there is one
    more failure besides the failure on which we're recovering, this can
    always work.
    
    The worst case is to retry as many times as the number of raid6 disks,
    but given the fact that such a scenario is really rare in practice,
    it's still acceptable.
    
    Signed-off-by: Liu Bo <bo.li.liu@oracle.com>
    Signed-off-by: David Sterba <dsterba@suse.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6bf89b7c6b319259f7991a424187ab2647db6424
Author: Liu Bo <bo.li.liu@oracle.com>
Date:   Fri Jun 15 02:39:02 2018 +0000

    Btrfs: fix scrub to repair raid6 corruption
    
    [ Upstream commit 762221f095e3932669093466aaf4b85ed9ad2ac1 ]
    
    The raid6 corruption is that,
    suppose that all disks can be read without problems and if the content
    that was read out doesn't match its checksum, currently for raid6
    btrfs at most retries twice,
    
    - the 1st retry is to rebuild with all other stripes, it'll eventually
      be a raid5 xor rebuild,
    - if the 1st fails, the 2nd retry will deliberately fail parity p so
      that it will do raid6 style rebuild,
    
    however, the chances are that another non-parity stripe content also
    has something corrupted, so that the above retries are not able to
    return correct content.
    
    We've fixed normal reads to rebuild raid6 correctly with more retries
    in Patch "Btrfs: make raid6 rebuild retry more"[1], this is to fix
    scrub to do the exactly same rebuild process.
    
    [1]: https://patchwork.kernel.org/patch/10091755/
    
    Signed-off-by: Liu Bo <bo.li.liu@oracle.com>
    Signed-off-by: David Sterba <dsterba@suse.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit db5f02cc70a8251e103241cc230e01392729739c
Author: Sasha Levin <Alexander.Levin@microsoft.com>
Date:   Fri Jun 15 02:39:01 2018 +0000

    Revert "Btrfs: fix scrub to repair raid6 corruption"
    
    This reverts commit d91bb7c6988bd6450284c762b33f2e1ea3fe7c97.
    
    This commit used an incorrect log message.
    
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Reported-by: Ben Hutchings <ben.hutchings@codethink.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5e4b5b7194d3d561e8791c167eb1e671b96ca575
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Wed Apr 11 18:24:01 2018 +0100

    ARM: kexec: fix kdump register saving on panic()
    
    [ Upstream commit 2d7b3c64431245c95b05a441669c074da10db943 ]
    
    When a panic() occurs, the kexec code uses smp_send_stop() to stop
    the other CPUs, but this results in the CPU register state not being
    saved, and gdb is unable to inspect the state of other CPUs.
    
    Commit 0ee59413c967 ("x86/panic: replace smp_send_stop() with kdump
    friendly version in panic path") addressed the issue on x86, but
    ignored other architectures.  Address the issue on ARM by splitting
    out the crash stop implementation to crash_smp_send_stop() and
    adding the necessary protection.
    
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bb7a554ae7454ba921d3d59d9480e90c117f97d3
Author: Łukasz Stelmach <l.stelmach@samsung.com>
Date:   Wed Apr 4 08:46:58 2018 +0100

    ARM: 8758/1: decompressor: restore r1 and r2 just before jumping to the kernel
    
    [ Upstream commit f2ae9de019e4e2807d812ec4fe1df7c34788a0a0 ]
    
    The hypervisor setup before __enter_kernel destroys the value
    sotred in r1. The value needs to be restored just before the jump.
    
    Fixes: 6b52f7bdb888 ("ARM: hyp-stub: Use r1 for the soft-restart address")
    Signed-off-by: Łukasz Stelmach <l.stelmach@samsung.com>
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c7d7e3f62dbe0908213a922a714961ec56628c21
Author: Łukasz Stelmach <l.stelmach@samsung.com>
Date:   Tue Apr 3 09:04:57 2018 +0100

    ARM: 8753/1: decompressor: add a missing parameter to the addruart macro
    
    [ Upstream commit e07e3c33b9c0b5751ade624f44325c9bf2487ea6 ]
    
    In commit 639da5ee374b ("ARM: add an extra temp register to the low
    level debugging addruart macro") an additional temporary register was
    added to the addruart macro, but the decompressor code wasn't updated.
    
    Fixes: 639da5ee374b ("ARM: add an extra temp register to the low level debugging addruart macro")
    Signed-off-by: Łukasz Stelmach <l.stelmach@samsung.com>
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 823e02ea7be553c9a2dddffe72ac3bc88c6a3933
Author: Mark Rutland <mark.rutland@arm.com>
Date:   Fri May 18 16:08:41 2018 +0200

    efi/libstub/arm64: Handle randomized TEXT_OFFSET
    
    [ Upstream commit 4f74d72aa7067e75af92fbab077e6d7d0210be66 ]
    
    When CONFIG_RANDOMIZE_TEXT_OFFSET=y, TEXT_OFFSET is an arbitrary
    multiple of PAGE_SIZE in the interval [0, 2MB).
    
    The EFI stub does not account for the potential misalignment of
    TEXT_OFFSET relative to EFI_KIMG_ALIGN, and produces a randomized
    physical offset which is always a round multiple of EFI_KIMG_ALIGN.
    This may result in statically allocated objects whose alignment exceeds
    PAGE_SIZE to appear misaligned in memory. This has been observed to
    result in spurious stack overflow reports and failure to make use of
    the IRQ stacks, and theoretically could result in a number of other
    issues.
    
    We can OR in the low bits of TEXT_OFFSET to ensure that we have the
    necessary offset (and hence preserve the misalignment of TEXT_OFFSET
    relative to EFI_KIMG_ALIGN), so let's do that.
    
    Reported-by: Kim Phillips <kim.phillips@arm.com>
    Tested-by: Kim Phillips <kim.phillips@arm.com>
    [ardb: clarify comment and commit log, drop unneeded parens]
    Signed-off-by: Mark Rutland <mark.rutland@arm.com>
    Signed-off-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: linux-efi@vger.kernel.org
    Fixes: 6f26b3671184c36d ("arm64: kaslr: increase randomization granularity")
    Link: http://lkml.kernel.org/r/20180518140841.9731-2-ard.biesheuvel@linaro.org
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3f5c7add0d0f568e30c7b645175ef2edd5c9bebb
Author: Helge Deller <deller@gmx.de>
Date:   Fri May 18 16:12:12 2018 +0200

    parisc: Move setup_profiling_timer() out of init section
    
    [ Upstream commit 01f56832cfb6fcc204e7203f46841b6185ebd574 ]
    
    No other architecture has setup_profiling_timer() in the init section,
    thus on parisc we face this section mismatch warning:
     Reference from the function devm_device_add_group() to the function .init.text:setup_profiling_timer()
    
    Signed-off-by: Helge Deller <deller@gmx.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 588977742078d730aca04fb9eacdbfcae8873316
Author: Mathieu Malaterre <malat@debian.org>
Date:   Wed May 16 22:09:02 2018 +0200

    sched/deadline: Make the grub_reclaim() function static
    
    [ Upstream commit 3febfc8a219a036633b57a34c6678e21b6a0580d ]
    
    Since the grub_reclaim() function can be made static, make it so.
    
    Silences the following GCC warning (W=1):
    
      kernel/sched/deadline.c:1120:5: warning: no previous prototype for ‘grub_reclaim’ [-Wmissing-prototypes]
    
    Signed-off-by: Mathieu Malaterre <malat@debian.org>
    Acked-by: Peter Zijlstra <peterz@infradead.org>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Link: http://lkml.kernel.org/r/20180516200902.959-1-malat@debian.org
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fb49d19ed9da82f26d3e43122ddaf8bf31a122bd
Author: Mathieu Malaterre <malat@debian.org>
Date:   Wed May 16 21:53:47 2018 +0200

    sched/debug: Move the print_rt_rq() and print_dl_rq() declarations to kernel/sched/sched.h
    
    [ Upstream commit f6a3463063f42d9fb2c78f386437a822e0ad1792 ]
    
    In the following commit:
    
      6b55c9654fcc ("sched/debug: Move print_cfs_rq() declaration to kernel/sched/sched.h")
    
    the print_cfs_rq() prototype was added to <kernel/sched/sched.h>,
    right next to the prototypes for print_cfs_stats(), print_rt_stats()
    and print_dl_stats().
    
    Finish this previous commit and also move related prototypes for
    print_rt_rq() and print_dl_rq().
    
    Remove existing extern declarations now that they not needed anymore.
    
    Silences the following GCC warning, triggered by W=1:
    
      kernel/sched/debug.c:573:6: warning: no previous prototype for ‘print_rt_rq’ [-Wmissing-prototypes]
      kernel/sched/debug.c:603:6: warning: no previous prototype for ‘print_dl_rq’ [-Wmissing-prototypes]
    
    Signed-off-by: Mathieu Malaterre <malat@debian.org>
    Acked-by: Peter Zijlstra <peterz@infradead.org>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Srikar Dronamraju <srikar@linux.vnet.ibm.com>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Link: http://lkml.kernel.org/r/20180516195348.30426-1-malat@debian.org
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 96ef5c44149479f13b8943a556f4193d126e1222
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Wed May 16 17:00:26 2018 +0300

    drm/dumb-buffers: Integer overflow in drm_mode_create_ioctl()
    
    [ Upstream commit 2b6207291b7b277a5df9d1aab44b56815a292dba ]
    
    There is a comment here which says that DIV_ROUND_UP() and that's where
    the problem comes from.  Say you pick:
    
            args->bpp = UINT_MAX - 7;
            args->width = 4;
            args->height = 1;
    
    The integer overflow in DIV_ROUND_UP() means "cpp" is UINT_MAX / 8 and
    because of how we picked args->width that means cpp < UINT_MAX / 4.
    
    I've fixed it by preventing the integer overflow in DIV_ROUND_UP().  I
    removed the check for !cpp because it's not possible after this change.
    I also changed all the 0xffffffffU references to U32_MAX.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Link: https://patchwork.freedesktop.org/patch/msgid/20180516140026.GA19340@mwanda
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 77a60e752ec8d2b0b507d55f7a5aa36e6c8c15e7
Author: Waiman Long <longman@redhat.com>
Date:   Tue May 15 17:49:51 2018 -0400

    locking/percpu-rwsem: Annotate rwsem ownership transfer by setting RWSEM_OWNER_UNKNOWN
    
    [ Upstream commit 5a817641f68a6399a5fac8b7d2da67a73698ffed ]
    
    The filesystem freezing code needs to transfer ownership of a rwsem
    embedded in a percpu-rwsem from the task that does the freezing to
    another one that does the thawing by calling percpu_rwsem_release()
    after freezing and percpu_rwsem_acquire() before thawing.
    
    However, the new rwsem debug code runs afoul with this scheme by warning
    that the task that releases the rwsem isn't the one that acquires it,
    as reported by Amir Goldstein:
    
      DEBUG_LOCKS_WARN_ON(sem->owner != get_current())
      WARNING: CPU: 1 PID: 1401 at /home/amir/build/src/linux/kernel/locking/rwsem.c:133 up_write+0x59/0x79
    
      Call Trace:
       percpu_up_write+0x1f/0x28
       thaw_super_locked+0xdf/0x120
       do_vfs_ioctl+0x270/0x5f1
       ksys_ioctl+0x52/0x71
       __x64_sys_ioctl+0x16/0x19
       do_syscall_64+0x5d/0x167
       entry_SYSCALL_64_after_hwframe+0x49/0xbe
    
    To work properly with the rwsem debug code, we need to annotate that the
    rwsem ownership is unknown during the tranfer period until a brave soul
    comes forward to acquire the ownership. During that period, optimistic
    spinning will be disabled.
    
    Reported-by: Amir Goldstein <amir73il@gmail.com>
    Tested-by: Amir Goldstein <amir73il@gmail.com>
    Signed-off-by: Waiman Long <longman@redhat.com>
    Acked-by: Peter Zijlstra <peterz@infradead.org>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Davidlohr Bueso <dave@stgolabs.net>
    Cc: Jan Kara <jack@suse.cz>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Matthew Wilcox <willy@infradead.org>
    Cc: Oleg Nesterov <oleg@redhat.com>
    Cc: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
    Cc: Theodore Y. Ts'o <tytso@mit.edu>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: Will Deacon <will.deacon@arm.com>
    Cc: linux-fsdevel@vger.kernel.org
    Link: http://lkml.kernel.org/r/1526420991-21213-3-git-send-email-longman@redhat.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b3f84e48786d5696153917f7d93a0e3a5c21b294
Author: Waiman Long <longman@redhat.com>
Date:   Tue May 15 17:49:50 2018 -0400

    locking/rwsem: Add a new RWSEM_ANONYMOUSLY_OWNED flag
    
    [ Upstream commit d7d760efad70c7a030725499bf9f342f04af24dd ]
    
    There are use cases where a rwsem can be acquired by one task, but
    released by another task. In thess cases, optimistic spinning may need
    to be disabled.  One example will be the filesystem freeze/thaw code
    where the task that freezes the filesystem will acquire a write lock
    on a rwsem and then un-owns it before returning to userspace. Later on,
    another task will come along, acquire the ownership, thaw the filesystem
    and release the rwsem.
    
    Bit 0 of the owner field was used to designate that it is a reader
    owned rwsem. It is now repurposed to mean that the owner of the rwsem
    is not known. If only bit 0 is set, the rwsem is reader owned. If bit
    0 and other bits are set, it is writer owned with an unknown owner.
    One such value for the latter case is (-1L). So we can set owner to 1 for
    reader-owned, -1 for writer-owned. The owner is unknown in both cases.
    
    To handle transfer of rwsem ownership, the higher level code should
    set the owner field to -1 to indicate a write-locked rwsem with unknown
    owner.  Optimistic spinning will be disabled in this case.
    
    Once the higher level code figures who the new owner is, it can then
    set the owner field accordingly.
    
    Tested-by: Amir Goldstein <amir73il@gmail.com>
    Signed-off-by: Waiman Long <longman@redhat.com>
    Acked-by: Peter Zijlstra <peterz@infradead.org>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Davidlohr Bueso <dave@stgolabs.net>
    Cc: Jan Kara <jack@suse.cz>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Matthew Wilcox <willy@infradead.org>
    Cc: Oleg Nesterov <oleg@redhat.com>
    Cc: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
    Cc: Theodore Y. Ts'o <tytso@mit.edu>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: Will Deacon <will.deacon@arm.com>
    Cc: linux-fsdevel@vger.kernel.org
    Link: http://lkml.kernel.org/r/1526420991-21213-2-git-send-email-longman@redhat.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c5746752bdbe4e7c6512d581dce5cc4ebc45ae75
Author: Stefan Agner <stefan@agner.ch>
Date:   Wed Apr 18 14:49:08 2018 +0200

    clk: imx6ull: use OSC clock during AXI rate change
    
    [ Upstream commit 2e5be528ab0182ad4b42b9feea3b80f85f37179b ]
    
    On i.MX6 ULL using PLL3 seems to cause a freeze when setting
    the parent to IMX6UL_CLK_PLL3_USB_OTG. This only seems to appear
    since commit 6f9575e55632 ("clk: imx: Add CLK_IS_CRITICAL flag
    for busy divider and busy mux"), probably because the clock is
    now forced to be on.
    
    Fixes: 6f9575e55632("clk: imx: Add CLK_IS_CRITICAL flag for busy divider and busy mux")
    Signed-off-by: Stefan Agner <stefan@agner.ch>
    Signed-off-by: Stephen Boyd <sboyd@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0c5dfa51caf77461da90b3af1f1ec28490255bc0
Author: Sekhar Nori <nsekhar@ti.com>
Date:   Fri May 11 20:51:36 2018 +0530

    ARM: davinci: board-dm646x-evm: set VPIF capture card name
    
    [ Upstream commit bb7298a7e87cf3430eb62be8746e5d7a07ca9d7c ]
    
    VPIF capture driver expects card name to be set since it
    uses it without checking for NULL. The commit which
    introduced VPIF display and capture support added card
    name only for display, not for capture.
    
    Set it in platform data to probe driver successfully.
    
    While at it, also fix the display card name to something more
    appropriate.
    
    Fixes: 85609c1ccda6 ("DaVinci: DM646x - platform changes for vpif capture and display drivers")
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit eb6b0d6987fc58c5dc79abba8a82e1fe999ef602
Author: Sekhar Nori <nsekhar@ti.com>
Date:   Fri May 11 20:51:35 2018 +0530

    ARM: davinci: board-dm646x-evm: pass correct I2C adapter id for VPIF
    
    [ Upstream commit 7d46899d57f8b61eb28701d9a4043b71e3392c26 ]
    
    commit a16cb91ad9c4 ("[media] media: vpif: use a configurable
    i2c_adapter_id for vpif display") removed hardcoded I2C adaptor
    setting in VPIF driver, but missed updating platform data passed
    from DM646x board.
    
    Fix it.
    
    Fixes: a16cb91ad9c4 ("[media] media: vpif: use a configurable i2c_adapter_id for vpif display")
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ae7418dd09f9879b21fb7b8c8ddb2e3ce8d4523d
Author: Sekhar Nori <nsekhar@ti.com>
Date:   Fri May 11 20:51:34 2018 +0530

    ARM: davinci: dm646x: fix timer interrupt generation
    
    [ Upstream commit 73d4337ed9ceddef4b2f0e226634d5f985aa2d1c ]
    
    commit b38434145b34 ("ARM: davinci: irqs: Correct McASP1 TX interrupt
    definition for DM646x") inadvertently removed priority setting for
    timer0_12 (bottom half of timer0). This timer is used as clockevent.
    
    When INTPRIn register setting for an interrupt is left at 0, it is
    mapped to FIQ by the AINTC causing the timer interrupt to not get
    generated.
    
    Fix it by including an entry for timer0_12 in interrupt priority map
    array. While at it, move the clockevent comment to the right place.
    
    Fixes: b38434145b34 ("ARM: davinci: irqs: Correct McASP1 TX interrupt definition for DM646x")
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit daf6bdb29d55325d49bb00bacda154e91b374975
Author: Peter Rosin <peda@axentia.se>
Date:   Wed May 9 21:47:48 2018 +0200

    i2c: viperboard: return message count on master_xfer success
    
    [ Upstream commit 35cd67a0caf767aba472452865dcb4471fcce2b1 ]
    
    Returning zero is wrong in this case.
    
    Signed-off-by: Peter Rosin <peda@axentia.se>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Fixes: 174a13aa8669 ("i2c: Add viperboard i2c master driver")
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cbfe697cdba95c055830f4e04cb4d30a4fdd6be1
Author: Peter Rosin <peda@axentia.se>
Date:   Wed May 9 21:46:30 2018 +0200

    i2c: pmcmsp: fix error return from master_xfer
    
    [ Upstream commit 12d9bbc5a7f347eaa65ff2a9d34995cadc05eb1b ]
    
    Returning -1 (-EPERM) is not appropriate here, go with -EIO.
    
    Signed-off-by: Peter Rosin <peda@axentia.se>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Fixes: 1b144df1d7d6 ("i2c: New PMC MSP71xx TWI bus driver")
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0c1885743a9bdd554d20c368d775142224abdff9
Author: Peter Rosin <peda@axentia.se>
Date:   Wed May 9 21:46:29 2018 +0200

    i2c: pmcmsp: return message count on master_xfer success
    
    [ Upstream commit de9a8634f1cb4560a35696d472cc7f1383d9b866 ]
    
    Returning zero is wrong in this case.
    
    Signed-off-by: Peter Rosin <peda@axentia.se>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Fixes: 1b144df1d7d6 ("i2c: New PMC MSP71xx TWI bus driver")
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7416dd78ad9a5c1e254d293cf5e3fee8656665cc
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Thu May 10 14:24:20 2018 +0100

    ARM: keystone: fix platform_domain_notifier array overrun
    
    [ Upstream commit 9954b80b8c0e8abc98e17bba0fccd9876211ceaa ]
    
    platform_domain_notifier contains a variable sized array, which the
    pm_clk_notify() notifier treats as a NULL terminated array:
    
         for (con_id = clknb->con_ids; *con_id; con_id++)
                 pm_clk_add(dev, *con_id);
    
    Omitting the initialiser for con_ids means that the array is zero
    sized, and there is no NULL terminator.  This leads to pm_clk_notify()
    overrunning into what ever structure follows, which may not be NULL.
    This leads to an oops:
    
    Unable to handle kernel NULL pointer dereference at virtual address 0000008c
    pgd = c0003000
    [0000008c] *pgd=80000800004003c, *pmd=00000000c
    Internal error: Oops: 206 [#1] PREEMPT SMP ARM
    Modules linked in:c
    CPU: 0 PID: 1 Comm: swapper/0 Not tainted 4.16.0+ #9
    Hardware name: Keystone
    PC is at strlen+0x0/0x34
    LR is at kstrdup+0x18/0x54
    pc : [<c0623340>]    lr : [<c0111d6c>]    psr: 20000013
    sp : eec73dc0  ip : eed780c0  fp : 00000001
    r10: 00000000  r9 : 00000000  r8 : eed71e10
    r7 : 0000008c  r6 : 0000008c  r5 : 014000c0  r4 : c03a6ff4
    r3 : c09445d0  r2 : 00000000  r1 : 014000c0  r0 : 0000008c
    Flags: nzCv  IRQs on  FIQs on  Mode SVC_32  ISA ARM  Segment user
    Control: 30c5387d  Table: 00003000  DAC: fffffffd
    Process swapper/0 (pid: 1, stack limit = 0xeec72210)
    Stack: (0xeec73dc0 to 0xeec74000)
    ...
    [<c0623340>] (strlen) from [<c0111d6c>] (kstrdup+0x18/0x54)
    [<c0111d6c>] (kstrdup) from [<c03a6ff4>] (__pm_clk_add+0x58/0x120)
    [<c03a6ff4>] (__pm_clk_add) from [<c03a731c>] (pm_clk_notify+0x64/0xa8)
    [<c03a731c>] (pm_clk_notify) from [<c004614c>] (notifier_call_chain+0x44/0x84)
    [<c004614c>] (notifier_call_chain) from [<c0046320>] (__blocking_notifier_call_chain+0x48/0x60)
    [<c0046320>] (__blocking_notifier_call_chain) from [<c0046350>] (blocking_notifier_call_chain+0x18/0x20)
    [<c0046350>] (blocking_notifier_call_chain) from [<c0390234>] (device_add+0x36c/0x534)
    [<c0390234>] (device_add) from [<c047fc00>] (of_platform_device_create_pdata+0x70/0xa4)
    [<c047fc00>] (of_platform_device_create_pdata) from [<c047fea0>] (of_platform_bus_create+0xf0/0x1ec)
    [<c047fea0>] (of_platform_bus_create) from [<c047fff8>] (of_platform_populate+0x5c/0xac)
    [<c047fff8>] (of_platform_populate) from [<c08b1f04>] (of_platform_default_populate_init+0x8c/0xa8)
    [<c08b1f04>] (of_platform_default_populate_init) from [<c000a78c>] (do_one_initcall+0x3c/0x164)
    [<c000a78c>] (do_one_initcall) from [<c087bd9c>] (kernel_init_freeable+0x10c/0x1d0)
    [<c087bd9c>] (kernel_init_freeable) from [<c0628db0>] (kernel_init+0x8/0xf0)
    [<c0628db0>] (kernel_init) from [<c00090d8>] (ret_from_fork+0x14/0x3c)
    Exception stack(0xeec73fb0 to 0xeec73ff8)
    3fa0:                                     00000000 00000000 00000000 00000000
    3fc0: 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
    3fe0: 00000000 00000000 00000000 00000000 00000013 00000000
    Code: e3520000 1afffff7 e12fff1e c0801730 (e5d02000)
    ---[ end trace cafa8f148e262e80 ]---
    
    Fix this by adding the necessary initialiser.
    
    Fixes: fc20ffe1213b ("ARM: keystone: add PM domain support for clock management")
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Acked-by: Santosh Shilimkar <ssantosh@kernel.org>
    Signed-off-by: Olof Johansson <olof@lixom.net>
    
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a187b9c72d0cc71d30abfc6e2a5e692a897177bb
Author: Daniel Glöckner <dg@emlix.com>
Date:   Mon May 14 09:40:05 2018 -0500

    usb: musb: fix remote wakeup racing with suspend
    
    [ Upstream commit ebc3dd688cd988754a304147753b13e58de1b5a1 ]
    
    It has been observed that writing 0xF2 to the power register while it
    reads as 0xF4 results in the register having the value 0xF0, i.e. clearing
    RESUME and setting SUSPENDM in one go does not work. It might also violate
    the USB spec to transition directly from resume to suspend, especially
    when not taking T_DRSMDN into account. But this is what happens when a
    remote wakeup occurs between SetPortFeature USB_PORT_FEAT_SUSPEND on the
    root hub and musb_bus_suspend being called.
    
    This commit returns -EBUSY when musb_bus_suspend is called while remote
    wakeup is signalled and thus avoids to reset the RESUME bit. Ignoring
    this error when musb_port_suspend is called from musb_hub_control is ok.
    
    Signed-off-by: Daniel Glöckner <dg@emlix.com>
    Signed-off-by: Bin Liu <b-liu@ti.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 634b9e0aabd92d2b6f0df7580b60fd0921b1c578
Author: David Howells <dhowells@redhat.com>
Date:   Thu May 10 23:10:40 2018 +0100

    afs: Fix the non-encryption of calls
    
    [ Upstream commit 4776cab43fd3111618112737a257dc3ef368eddd ]
    
    Some AFS servers refuse to accept unencrypted traffic, so can't be accessed
    with kAFS.  Set the AF_RXRPC security level to encrypt client calls to deal
    with this.
    
    Note that incoming service calls are set by the remote client and so aren't
    affected by this.
    
    This requires an AF_RXRPC patch to pass the value set by setsockopt to calls
    begun by the kernel.
    
    Signed-off-by: David Howells <dhowells@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a92a286361572e65988e37ac7c5da91a04e26a01
Author: Ben Hutchings <ben@decadent.org.uk>
Date:   Thu May 10 19:20:54 2018 +0100

    mtd: Fix comparison in map_word_andequal()
    
    [ Upstream commit ea739a287f4f16d6250bea779a1026ead79695f2 ]
    
    Commit 9e343e87d2c4 ("mtd: cfi: convert inline functions to macros")
    changed map_word_andequal() into a macro, but also changed the right
    hand side of the comparison from val3 to val2.  Change it back to use
    val3 on the right hand side.
    
    Thankfully this did not cause a regression because all callers
    currently pass the same argument for val2 and val3.
    
    Fixes: 9e343e87d2c4 ("mtd: cfi: convert inline functions to macros")
    Signed-off-by: Ben Hutchings <ben@decadent.org.uk>
    Signed-off-by: Boris Brezillon <boris.brezillon@bootlin.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9b9ac282bad9a0463a9dbc7cd4c9de30c03ca5f9
Author: Dave Hansen <dave.hansen@linux.intel.com>
Date:   Wed May 9 10:13:56 2018 -0700

    x86/pkeys/selftests: Add a test for pkey 0
    
    [ Upstream commit 3488a600d90bcaf061b104dbcfbdc8d99b398312 ]
    
    Protection key 0 is the default key for all memory and will
    not normally come back from pkey_alloc().  But, you might
    still want pass it to mprotect_pkey().
    
    This check ensures that you can use pkey 0.
    
    Signed-off-by: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Dave Hansen <dave.hansen@intel.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Michael Ellermen <mpe@ellerman.id.au>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Ram Pai <linuxram@us.ibm.com>
    Cc: Shuah Khan <shuah@kernel.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: linux-mm@kvack.org
    Link: http://lkml.kernel.org/r/20180509171356.9E40B254@viggo.jf.intel.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b1f192a9e0cd3591142841731e01e5d9eb1c793d
Author: Dave Hansen <dave.hansen@linux.intel.com>
Date:   Wed May 9 10:13:54 2018 -0700

    x86/pkeys/selftests: Save off 'prot' for allocations
    
    [ Upstream commit acb25d761d6f2f64e785ccefc71e54f244f1eda4 ]
    
    This makes it possible to to tell what 'prot' a given allocation
    is supposed to have.  That way, if we want to change just the
    pkey, we know what 'prot' to pass to mprotect_pkey().
    
    Also, keep a record of the most recent allocation so the tests
    can easily find it.
    
    Signed-off-by: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Dave Hansen <dave.hansen@intel.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Michael Ellermen <mpe@ellerman.id.au>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Ram Pai <linuxram@us.ibm.com>
    Cc: Shuah Khan <shuah@kernel.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: linux-mm@kvack.org
    Link: http://lkml.kernel.org/r/20180509171354.AA23E228@viggo.jf.intel.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cdfdffcaa8f99139f4b5e49790b4465a64a85839
Author: Dave Hansen <dave.hansen@linux.intel.com>
Date:   Wed May 9 10:13:52 2018 -0700

    x86/pkeys/selftests: Fix pointer math
    
    [ Upstream commit 3d64f4ed15c3c53dba4c514bf59c334464dee373 ]
    
    We dump out the entire area of the siginfo where the si_pkey_ptr is
    supposed to be.  But, we do some math on the poitner, which is a u32.
    We intended to do byte math, not u32 math on the pointer.
    
    Cast it over to a u8* so it works.
    
    Also, move this block of code to below th si_code check.  It doesn't
    hurt anything, but the si_pkey field is gibberish for other signal
    types.
    
    Signed-off-by: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Dave Hansen <dave.hansen@intel.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Michael Ellermen <mpe@ellerman.id.au>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Ram Pai <linuxram@us.ibm.com>
    Cc: Shuah Khan <shuah@kernel.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: linux-mm@kvack.org
    Link: http://lkml.kernel.org/r/20180509171352.9BE09819@viggo.jf.intel.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2dd0e5d62a6b167cc3889d05da37b293bc21f2f0
Author: Dave Hansen <dave.hansen@linux.intel.com>
Date:   Wed May 9 10:13:50 2018 -0700

    x86/pkeys/selftests: Fix pkey exhaustion test off-by-one
    
    [ Upstream commit f50b4878329ab61d8e05796f655adeb6f5fb57c6 ]
    
    In our "exhaust all pkeys" test, we make sure that there
    is the expected number available.  Turns out that the
    test did not cover the execute-only key, but discussed
    it anyway.  It did *not* discuss the test-allocated
    key.
    
    Now that we have a test for the mprotect(PROT_EXEC) case,
    this off-by-one issue showed itself.  Correct the off-by-
    one and add the explanation for the case we missed.
    
    Signed-off-by: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Dave Hansen <dave.hansen@intel.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Michael Ellermen <mpe@ellerman.id.au>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Ram Pai <linuxram@us.ibm.com>
    Cc: Shuah Khan <shuah@kernel.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: linux-mm@kvack.org
    Link: http://lkml.kernel.org/r/20180509171350.E1656B95@viggo.jf.intel.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 63bdea73bd5283ee66df1a3aa1cebd34a2dc181f
Author: Dave Hansen <dave.hansen@linux.intel.com>
Date:   Wed May 9 10:13:48 2018 -0700

    x86/pkeys/selftests: Add PROT_EXEC test
    
    [ Upstream commit 6af17cf89e99b64cf1f660bf848755442ab2f047 ]
    
    Under the covers, implement executable-only memory with
    protection keys when userspace calls mprotect(PROT_EXEC).
    
    But, we did not have a selftest for that.  Now we do.
    
    Signed-off-by: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Dave Hansen <dave.hansen@intel.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Michael Ellermen <mpe@ellerman.id.au>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Ram Pai <linuxram@us.ibm.com>
    Cc: Shuah Khan <shuah@kernel.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: linux-mm@kvack.org
    Link: http://lkml.kernel.org/r/20180509171348.9EEE4BEF@viggo.jf.intel.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1fcd226878b3f8eb838dab7bef6d423cdec6035c
Author: Dave Hansen <dave.hansen@linux.intel.com>
Date:   Wed May 9 10:13:47 2018 -0700

    x86/pkeys/selftests: Factor out "instruction page"
    
    [ Upstream commit 3fcd2b2d928904cbf30b01e2c5e4f1dd2f9ab262 ]
    
    We currently have an execute-only test, but it is for
    the explicit mprotect_pkey() interface.  We will soon
    add a test for the implicit mprotect(PROT_EXEC)
    enterface.  We need this code in both tests.
    
    Signed-off-by: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Dave Hansen <dave.hansen@intel.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Michael Ellermen <mpe@ellerman.id.au>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Ram Pai <linuxram@us.ibm.com>
    Cc: Shuah Khan <shuah@kernel.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: linux-mm@kvack.org
    Link: http://lkml.kernel.org/r/20180509171347.C64AB733@viggo.jf.intel.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 777d513aaaf620dab38bbbbb32d4191e18714c89
Author: Dave Hansen <dave.hansen@linux.intel.com>
Date:   Wed May 9 10:13:46 2018 -0700

    x86/pkeys/selftests: Allow faults on unknown keys
    
    [ Upstream commit 7e7fd67ca39335a49619729821efb7cbdd674eb0 ]
    
    The exec-only pkey is allocated inside the kernel and userspace
    is not told what it is.  So, allow PK faults to occur that have
    an unknown key.
    
    Signed-off-by: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Dave Hansen <dave.hansen@intel.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Michael Ellermen <mpe@ellerman.id.au>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Ram Pai <linuxram@us.ibm.com>
    Cc: Shuah Khan <shuah@kernel.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: linux-mm@kvack.org
    Link: http://lkml.kernel.org/r/20180509171345.7FC7DA00@viggo.jf.intel.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9545530701c9031ac5431f388ad82b28acc3fc75
Author: Dave Hansen <dave.hansen@linux.intel.com>
Date:   Wed May 9 10:13:42 2018 -0700

    x86/pkeys/selftests: Remove dead debugging code, fix dprint_in_signal
    
    [ Upstream commit a50093d60464dd51d1ae0c2267b0abe9e1de77f3 ]
    
    There is some noisy debug code at the end of the signal handler.  It was
    disabled by an early, unconditional "return".  However, that return also
    hid a dprint_in_signal=0, which kept dprint_in_signal=1 and effectively
    locked us into permanent dprint_in_signal=1 behavior.
    
    Remove the return and the dead code, fixing dprint_in_signal.
    
    Signed-off-by: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Dave Hansen <dave.hansen@intel.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Michael Ellermen <mpe@ellerman.id.au>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Ram Pai <linuxram@us.ibm.com>
    Cc: Shuah Khan <shuah@kernel.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: linux-mm@kvack.org
    Link: http://lkml.kernel.org/r/20180509171342.846B9B2E@viggo.jf.intel.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8b9f3a7404d79ebcdf2a8491ea37d5b1b851ac6a
Author: Dave Hansen <dave.hansen@linux.intel.com>
Date:   Wed May 9 10:13:40 2018 -0700

    x86/pkeys/selftests: Stop using assert()
    
    [ Upstream commit 86b9eea230edf4c67d4d4a70fba9b74505867a25 ]
    
    If we use assert(), the program "crashes".  That can be scary to users,
    so stop doing it.  Just exit with a >0 exit code instead.
    
    Signed-off-by: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Dave Hansen <dave.hansen@intel.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Michael Ellermen <mpe@ellerman.id.au>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Ram Pai <linuxram@us.ibm.com>
    Cc: Shuah Khan <shuah@kernel.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: linux-mm@kvack.org
    Link: http://lkml.kernel.org/r/20180509171340.E63EF7DA@viggo.jf.intel.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 477c024fb33ab5fd9bc139495fe6323191e513df
Author: Dave Hansen <dave.hansen@linux.intel.com>
Date:   Wed May 9 10:13:38 2018 -0700

    x86/pkeys/selftests: Give better unexpected fault error messages
    
    [ Upstream commit 55556b0b2016806b2e16a20b62d143383983a34a ]
    
    do_not_expect_pk_fault() is a helper that we call when we do not expect
    a PK fault to have occurred.  But, it is a function, which means that
    it obscures the line numbers from pkey_assert().  It also gives no
    details.
    
    Replace it with an implementation that gives nice line numbers and
    also lets callers pass in a more descriptive message about what
    happened that caused the unexpected fault.
    
    Signed-off-by: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Dave Hansen <dave.hansen@intel.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Michael Ellermen <mpe@ellerman.id.au>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Ram Pai <linuxram@us.ibm.com>
    Cc: Shuah Khan <shuah@kernel.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: linux-mm@kvack.org
    Link: http://lkml.kernel.org/r/20180509171338.55D13B64@viggo.jf.intel.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4824a6473b8553a503af02376157b099f03ef8e8
Author: Andy Lutomirski <luto@kernel.org>
Date:   Tue May 8 10:28:35 2018 -0700

    x86/selftests: Add mov_to_ss test
    
    [ Upstream commit 59c2a7226fc5130032021c99f05ad5c0a56551cd ]
    
    This exercises a nasty corner case of the x86 ISA.
    
    Signed-off-by: Andy Lutomirski <luto@kernel.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Link: http://lkml.kernel.org/r/67e08b69817171da8026e0eb3af0214b06b4d74f.1525800455.git.luto@kernel.org
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c25b160c8da6f3c20a5eed95f98f76bf2c26c55e
Author: Ingo Molnar <mingo@kernel.org>
Date:   Mon May 14 10:59:08 2018 +0200

    x86/mpx/selftests: Adjust the self-test to fresh distros that export the MPX ABI
    
    [ Upstream commit 73bb4d6cd192b8629c5125aaada9892d9fc986b6 ]
    
    Fix this warning:
    
      mpx-mini-test.c:422:0: warning: "SEGV_BNDERR" redefined
    
    Cc: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: akpm@linux-foundation.org
    Cc: dave.hansen@intel.com
    Cc: linux-mm@kvack.org
    Cc: linuxram@us.ibm.com
    Cc: mpe@ellerman.id.au
    Cc: shakeelb@google.com
    Cc: shuah@kernel.org
    Link: http://lkml.kernel.org/r/20180514085908.GA12798@gmail.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2361f1f4fff26781386536379d117aa1c0218ad5
Author: Ingo Molnar <mingo@kernel.org>
Date:   Mon May 14 10:56:23 2018 +0200

    x86/pkeys/selftests: Adjust the self-test to fresh distros that export the pkeys ABI
    
    [ Upstream commit 0fb96620dce351608aa82eed5942e2f58b07beda ]
    
    Ubuntu 18.04 started exporting pkeys details in header files, resulting
    in build failures and warnings in the pkeys self-tests:
    
      protection_keys.c:232:0: warning: "SEGV_BNDERR" redefined
      protection_keys.c:387:5: error: conflicting types for ‘pkey_get’
      protection_keys.c:409:5: error: conflicting types for ‘pkey_set’
      ...
    
    Fix these namespace conflicts and double definitions, plus also
    clean up the ABI definitions to make it all a bit more readable ...
    
    Cc: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: akpm@linux-foundation.org
    Cc: dave.hansen@intel.com
    Cc: linux-mm@kvack.org
    Cc: linuxram@us.ibm.com
    Cc: mpe@ellerman.id.au
    Cc: shakeelb@google.com
    Cc: shuah@kernel.org
    Link: http://lkml.kernel.org/r/20180514085623.GB7094@gmail.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 847f0cacf21eb0f575acbf06e7314466347be841
Author: Ingo Molnar <mingo@kernel.org>
Date:   Mon May 14 10:15:54 2018 +0200

    objtool, kprobes/x86: Sync the latest <asm/insn.h> header with tools/objtool/arch/x86/include/asm/insn.h
    
    [ Upstream commit 4fe875e4bd3cae85ae6f6eaf77f63fabe613b66e ]
    
    The following commit:
    
      ee6a7354a362: kprobes/x86: Prohibit probing on exception masking instructions
    
    Modified <asm/insn.h>, adding the insn_masking_exception() function.
    
    Sync the tooling version of the header to it, to fix this warning:
    
      Warning: synced file at 'tools/objtool/arch/x86/include/asm/insn.h' differs from latest kernel version at 'arch/x86/include/asm/insn.h'
    
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Josh Poimboeuf <jpoimboe@redhat.com>
    Cc: Masami Hiramatsu <mhiramat@kernel.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: Ricardo Neri <ricardo.neri-calderon@linux.intel.com>
    Cc: Francis Deslauriers <francis.deslauriers@efficios.com>
    Cc: Oleg Nesterov <oleg@redhat.com>
    Cc: Alexei Starovoitov <ast@kernel.org>
    Cc: Steven Rostedt <rostedt@goodmis.org>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: "H . Peter Anvin" <hpa@zytor.com>
    Cc: Yonghong Song <yhs@fb.com>
    Cc: Borislav Petkov <bp@suse.de>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: "David S . Miller" <davem@davemloft.net>
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5aaee3e9ef32913ed77eb8fe4e9b51b5ace32a67
Author: Masami Hiramatsu <mhiramat@kernel.org>
Date:   Wed May 9 21:58:45 2018 +0900

    uprobes/x86: Prohibit probing on MOV SS instruction
    
    [ Upstream commit 13ebe18c94f5b0665c01ae7fad2717ae959f4212 ]
    
    Since MOV SS and POP SS instructions will delay the exceptions until the
    next instruction is executed, single-stepping on it by uprobes must be
    prohibited.
    
    uprobe already rejects probing on POP SS (0x1f), but allows probing on MOV
    SS (0x8e and reg == 2).  This checks the target instruction and if it is
    MOV SS or POP SS, returns -ENOTSUPP to reject probing.
    
    Signed-off-by: Masami Hiramatsu <mhiramat@kernel.org>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Acked-by: Oleg Nesterov <oleg@redhat.com>
    Cc: Ricardo Neri <ricardo.neri-calderon@linux.intel.com>
    Cc: Francis Deslauriers <francis.deslauriers@efficios.com>
    Cc: Alexei Starovoitov <ast@kernel.org>
    Cc: Steven Rostedt <rostedt@goodmis.org>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: "H . Peter Anvin" <hpa@zytor.com>
    Cc: Yonghong Song <yhs@fb.com>
    Cc: Borislav Petkov <bp@suse.de>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: "David S . Miller" <davem@davemloft.net>
    Link: https://lkml.kernel.org/r/152587072544.17316.5950935243917346341.stgit@devbox
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ba202cd5a1f045609c43058b2aeddd6fb341f236
Author: Masami Hiramatsu <mhiramat@kernel.org>
Date:   Wed May 9 21:58:15 2018 +0900

    kprobes/x86: Prohibit probing on exception masking instructions
    
    [ Upstream commit ee6a7354a3629f9b65bc18dbe393503e9440d6f5 ]
    
    Since MOV SS and POP SS instructions will delay the exceptions until the
    next instruction is executed, single-stepping on it by kprobes must be
    prohibited.
    
    However, kprobes usually executes those instructions directly on trampoline
    buffer (a.k.a. kprobe-booster), except for the kprobes which has
    post_handler. Thus if kprobe user probes MOV SS with post_handler, it will
    do single-stepping on the MOV SS.
    
    This means it is safe that if it is used via ftrace or perf/bpf since those
    don't use the post_handler.
    
    Anyway, since the stack switching is a rare case, it is safer just
    rejecting kprobes on such instructions.
    
    Signed-off-by: Masami Hiramatsu <mhiramat@kernel.org>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Cc: Ricardo Neri <ricardo.neri-calderon@linux.intel.com>
    Cc: Francis Deslauriers <francis.deslauriers@efficios.com>
    Cc: Oleg Nesterov <oleg@redhat.com>
    Cc: Alexei Starovoitov <ast@kernel.org>
    Cc: Steven Rostedt <rostedt@goodmis.org>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: "H . Peter Anvin" <hpa@zytor.com>
    Cc: Yonghong Song <yhs@fb.com>
    Cc: Borislav Petkov <bp@suse.de>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: "David S . Miller" <davem@davemloft.net>
    Link: https://lkml.kernel.org/r/152587069574.17316.3311695234863248641.stgit@devbox
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 12ddc2639e31d96f5b136a84baf7d2b312db5519
Author: Ashish Samant <ashish.samant@oracle.com>
Date:   Fri May 11 16:02:07 2018 -0700

    ocfs2: take inode cluster lock before moving reflinked inode from orphan dir
    
    [ Upstream commit e4383029201470523c3ffe339bd7d57e9b4a7d65 ]
    
    While reflinking an inode, we create a new inode in orphan directory,
    then take EX lock on it, reflink the original inode to orphan inode and
    release EX lock.  Once the lock is released another node could request
    it in EX mode from ocfs2_recover_orphans() which causes downconvert of
    the lock, on this node, to NL mode.
    
    Later we attempt to initialize security acl for the orphan inode and
    move it to the reflink destination.  However, while doing this we dont
    take EX lock on the inode.  This could potentially cause problems
    because we could be starting transaction, accessing journal and
    modifying metadata of the inode while holding NL lock and with another
    node holding EX lock on the inode.
    
    Fix this by taking orphan inode cluster lock in EX mode before
    initializing security and moving orphan inode to reflink destination.
    Use the __tracker variant while taking inode lock to avoid recursive
    locking in the ocfs2_init_security_and_acl() call chain.
    
    Link: http://lkml.kernel.org/r/1523475107-7639-1-git-send-email-ashish.samant@oracle.com
    Signed-off-by: Ashish Samant <ashish.samant@oracle.com>
    Reviewed-by: Joseph Qi <jiangqi903@gmail.com>
    Reviewed-by: Junxiao Bi <junxiao.bi@oracle.com>
    Acked-by: Jun Piao <piaojun@huawei.com>
    Cc: Mark Fasheh <mark@fasheh.com>
    Cc: Joel Becker <jlbec@evilplan.org>
    Cc: Changwei Ge <ge.changwei@h3c.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 553495752c8241ef0a4a2c2fc3a5c8298899ec81
Author: Laura Abbott <labbott@redhat.com>
Date:   Fri May 11 16:01:57 2018 -0700

    proc/kcore: don't bounds check against address 0
    
    [ Upstream commit 3955333df9a50e8783d115613a397ae55d905080 ]
    
    The existing kcore code checks for bad addresses against __va(0) with
    the assumption that this is the lowest address on the system.  This may
    not hold true on some systems (e.g.  arm64) and produce overflows and
    crashes.  Switch to using other functions to validate the address range.
    
    It's currently only seen on arm64 and it's not clear if anyone wants to
    use that particular combination on a stable release.  So this is not
    urgent for stable.
    
    Link: http://lkml.kernel.org/r/20180501201143.15121-1-labbott@redhat.com
    Signed-off-by: Laura Abbott <labbott@redhat.com>
    Tested-by: Dave Anderson <anderson@redhat.com>
    Cc: Kees Cook <keescook@chromium.org>
    Cc: Ard Biesheuvel <ard.biesheuvel@linaro.org>
    Cc: Ingo Molnar <mingo@kernel.org>
    Cc: Andi Kleen <andi@firstfloor.org>
    Cc: Alexey Dobriyan <adobriyan@gmail.com>a
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 20e557fb26cae647f13b4973c47293d691ff5666
Author: Jeffrey Hugo <jhugo@codeaurora.org>
Date:   Fri May 11 16:01:42 2018 -0700

    init: fix false positives in W+X checking
    
    [ Upstream commit ae646f0b9ca135b87bc73ff606ef996c3029780a ]
    
    load_module() creates W+X mappings via __vmalloc_node_range() (from
    layout_and_allocate()->move_module()->module_alloc()) by using
    PAGE_KERNEL_EXEC.  These mappings are later cleaned up via
    "call_rcu_sched(&freeinit->rcu, do_free_init)" from do_init_module().
    
    This is a problem because call_rcu_sched() queues work, which can be run
    after debug_checkwx() is run, resulting in a race condition.  If hit,
    the race results in a nasty splat about insecure W+X mappings, which
    results in a poor user experience as these are not the mappings that
    debug_checkwx() is intended to catch.
    
    This issue is observed on multiple arm64 platforms, and has been
    artificially triggered on an x86 platform.
    
    Address the race by flushing the queued work before running the
    arch-defined mark_rodata_ro() which then calls debug_checkwx().
    
    Link: http://lkml.kernel.org/r/1525103946-29526-1-git-send-email-jhugo@codeaurora.org
    Fixes: e1a58320a38d ("x86/mm: Warn on W^X mappings")
    Signed-off-by: Jeffrey Hugo <jhugo@codeaurora.org>
    Reported-by: Timur Tabi <timur@codeaurora.org>
    Reported-by: Jan Glauber <jan.glauber@caviumnetworks.com>
    Acked-by: Kees Cook <keescook@chromium.org>
    Acked-by: Ingo Molnar <mingo@kernel.org>
    Acked-by: Will Deacon <will.deacon@arm.com>
    Acked-by: Laura Abbott <labbott@redhat.com>
    Cc: Mark Rutland <mark.rutland@arm.com>
    Cc: Ard Biesheuvel <ard.biesheuvel@linaro.org>
    Cc: Catalin Marinas <catalin.marinas@arm.com>
    Cc: Stephen Smalley <sds@tycho.nsa.gov>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 86900754306e7e4eafbd050e4405f292cf4458f3
Author: Roman Mashak <mrv@mojatatu.com>
Date:   Fri May 11 10:55:09 2018 -0400

    net sched actions: fix invalid pointer dereferencing if skbedit flags missing
    
    [ Upstream commit af5d01842fe1fbfb9f5e1c1d957ba02ab6f4569a ]
    
    When application fails to pass flags in netlink TLV for a new skbedit action,
    the kernel results in the following oops:
    
    [    8.307732] BUG: unable to handle kernel paging request at 0000000000021130
    [    8.309167] PGD 80000000193d1067 P4D 80000000193d1067 PUD 180e0067 PMD 0
    [    8.310595] Oops: 0000 [#1] SMP PTI
    [    8.311334] Modules linked in: kvm_intel kvm irqbypass crct10dif_pclmul crc32_pclmul ghash_clmulni_intel pcbc aesni_intel aes_x86_64 crypto_simd cryptd glue_helper serio_raw
    [    8.314190] CPU: 1 PID: 397 Comm: tc Not tainted 4.17.0-rc3+ #357
    [    8.315252] RIP: 0010:__tcf_idr_release+0x33/0x140
    [    8.316203] RSP: 0018:ffffa0718038f840 EFLAGS: 00010246
    [    8.317123] RAX: 0000000000000001 RBX: 0000000000021100 RCX: 0000000000000000
    [    8.319831] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000021100
    [    8.321181] RBP: 0000000000000000 R08: 000000000004adf8 R09: 0000000000000122
    [    8.322645] R10: 0000000000000000 R11: ffffffff9e5b01ed R12: 0000000000000000
    [    8.324157] R13: ffffffff9e0d3cc0 R14: 0000000000000000 R15: 0000000000000000
    [    8.325590] FS:  00007f591292e700(0000) GS:ffff8fcf5bc40000(0000) knlGS:0000000000000000
    [    8.327001] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
    [    8.327987] CR2: 0000000000021130 CR3: 00000000180e6004 CR4: 00000000001606a0
    [    8.329289] Call Trace:
    [    8.329735]  tcf_skbedit_init+0xa7/0xb0
    [    8.330423]  tcf_action_init_1+0x362/0x410
    [    8.331139]  ? try_to_wake_up+0x44/0x430
    [    8.331817]  tcf_action_init+0x103/0x190
    [    8.332511]  tc_ctl_action+0x11a/0x220
    [    8.333174]  rtnetlink_rcv_msg+0x23d/0x2e0
    [    8.333902]  ? _cond_resched+0x16/0x40
    [    8.334569]  ? __kmalloc_node_track_caller+0x5b/0x2c0
    [    8.335440]  ? rtnl_calcit.isra.31+0xf0/0xf0
    [    8.336178]  netlink_rcv_skb+0xdb/0x110
    [    8.336855]  netlink_unicast+0x167/0x220
    [    8.337550]  netlink_sendmsg+0x2a7/0x390
    [    8.338258]  sock_sendmsg+0x30/0x40
    [    8.338865]  ___sys_sendmsg+0x2c5/0x2e0
    [    8.339531]  ? pagecache_get_page+0x27/0x210
    [    8.340271]  ? filemap_fault+0xa2/0x630
    [    8.340943]  ? page_add_file_rmap+0x108/0x200
    [    8.341732]  ? alloc_set_pte+0x2aa/0x530
    [    8.342573]  ? finish_fault+0x4e/0x70
    [    8.343332]  ? __handle_mm_fault+0xbc1/0x10d0
    [    8.344337]  ? __sys_sendmsg+0x53/0x80
    [    8.345040]  __sys_sendmsg+0x53/0x80
    [    8.345678]  do_syscall_64+0x4f/0x100
    [    8.346339]  entry_SYSCALL_64_after_hwframe+0x44/0xa9
    [    8.347206] RIP: 0033:0x7f591191da67
    [    8.347831] RSP: 002b:00007fff745abd48 EFLAGS: 00000246 ORIG_RAX: 000000000000002e
    [    8.349179] RAX: ffffffffffffffda RBX: 00007fff745abe70 RCX: 00007f591191da67
    [    8.350431] RDX: 0000000000000000 RSI: 00007fff745abdc0 RDI: 0000000000000003
    [    8.351659] RBP: 000000005af35251 R08: 0000000000000001 R09: 0000000000000000
    [    8.352922] R10: 00000000000005f1 R11: 0000000000000246 R12: 0000000000000000
    [    8.354183] R13: 00007fff745afed0 R14: 0000000000000001 R15: 00000000006767c0
    [    8.355400] Code: 41 89 d4 53 89 f5 48 89 fb e8 aa 20 fd ff 85 c0 0f 84 ed 00
    00 00 48 85 db 0f 84 cf 00 00 00 40 84 ed 0f 85 cd 00 00 00 45 84 e4 <8b> 53 30
    74 0d 85 d2 b8 ff ff ff ff 0f 8f b3 00 00 00 8b 43 2c
    [    8.358699] RIP: __tcf_idr_release+0x33/0x140 RSP: ffffa0718038f840
    [    8.359770] CR2: 0000000000021130
    [    8.360438] ---[ end trace 60c66be45dfc14f0 ]---
    
    The caller calls action's ->init() and passes pointer to "struct tc_action *a",
    which later may be initialized to point at the existing action, otherwise
    "struct tc_action *a" is still invalid, and therefore dereferencing it is an
    error as happens in tcf_idr_release, where refcnt is decremented.
    
    So in case of missing flags tcf_idr_release must be called only for
    existing actions.
    
    v2:
        - prepare patch for net tree
    
    Fixes: 5e1567aeb7fe ("net sched: skbedit action fix late binding")
    Signed-off-by: Roman Mashak <mrv@mojatatu.com>
    Acked-by: Cong Wang <xiyou.wangcong@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 55e95f9ad712f43756393bfc1369ddade995ef26
Author: Emil Tantilov <emil.s.tantilov@intel.com>
Date:   Thu Apr 19 17:06:57 2018 -0700

    ixgbe: return error on unsupported SFP module when resetting
    
    [ Upstream commit bbb2707623f3ccc48695da2433f06d7c38193451 ]
    
    Add check for unsupported module and return the error code.
    This fixes a Coverity hit due to unused return status from setup_sfp.
    
    Signed-off-by: Emil Tantilov <emil.s.tantilov@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 33d1c29e935ef72dbcaf0eeeb67b6cb0788fa045
Author: Marian Rotariu <mrotariu@bitdefender.com>
Date:   Mon Apr 30 12:23:01 2018 +0300

    x86: Delay skip of emulated hypercall instruction
    
    [ Upstream commit 6356ee0c9602004e0a3b4b2dad68ee2ee9385b17 ]
    
    The IP increment should be done after the hypercall emulation, after
    calling the various handlers. In this way, these handlers can accurately
    identify the the IP of the VMCALL if they need it.
    
    This patch keeps the same functionality for the Hyper-V handler which does
    not use the return code of the standard kvm_skip_emulated_instruction()
    call.
    
    Signed-off-by: Marian Rotariu <mrotariu@bitdefender.com>
    [Hyper-V hypercalls also need kvm_skip_emulated_instruction() - Paolo]
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ce44a4d5db630728a5a20cf833afeafe1dce88f6
Author: Wanpeng Li <wanpengli@tencent.com>
Date:   Thu Apr 26 17:55:03 2018 -0700

    KVM: Extend MAX_IRQ_ROUTES to 4096 for all archs
    
    [ Upstream commit ddc9cfb79c1096a0855839631c091aa7e9602052 ]
    
    Our virtual machines make use of device assignment by configuring
    12 NVMe disks for high I/O performance. Each NVMe device has 129
    MSI-X Table entries:
    Capabilities: [50] MSI-X: Enable+ Count=129 Masked-Vector table: BAR=0 offset=00002000
    The windows virtual machines fail to boot since they will map the number of
    MSI-table entries that the NVMe hardware reported to the bus to msi routing
    table, this will exceed the 1024. This patch extends MAX_IRQ_ROUTES to 4096
    for all archs, in the future this might be extended again if needed.
    
    Reviewed-by: Cornelia Huck <cohuck@redhat.com>
    Cc: Paolo Bonzini <pbonzini@redhat.com>
    Cc: Radim KrÄmÃ¡Å™ <rkrcmar@redhat.com>
    Cc: Cornelia Huck <cohuck@redhat.com>
    Cc: Christian Borntraeger <borntraeger@de.ibm.com>
    Signed-off-by: Wanpeng Li <wanpengli@tencent.com>
    Signed-off-by: Tonny Lu <tonnylu@tencent.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 29475c404b56f4ff03d99e35b9258dc6dbf8f4b1
Author: David Howells <dhowells@redhat.com>
Date:   Thu May 10 23:26:01 2018 +0100

    rxrpc: Fix the min security level for kernel calls
    
    [ Upstream commit 93864fc3ffcc4bf70e96cfb5cc6e941630419ad0 ]
    
    Fix the kernel call initiation to set the minimum security level for kernel
    initiated calls (such as from kAFS) from the sockopt value.
    
    Fixes: 19ffa01c9c45 ("rxrpc: Use structs to hold connection params and protocol info")
    Signed-off-by: David Howells <dhowells@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b2abd2b98afccb8dfa9d0e51ab8f77e574ad7756
Author: David Howells <dhowells@redhat.com>
Date:   Thu May 10 23:26:00 2018 +0100

    rxrpc: Fix error reception on AF_INET6 sockets
    
    [ Upstream commit f2aeed3a591ff29a82495eeaa92ac4780bad7487 ]
    
    AF_RXRPC tries to turn on IP_RECVERR and IP_MTU_DISCOVER on the UDP socket
    it just opened for communications with the outside world, regardless of the
    type of socket.  Unfortunately, this doesn't work with an AF_INET6 socket.
    
    Fix this by turning on IPV6_RECVERR and IPV6_MTU_DISCOVER instead if the
    socket is of the AF_INET6 family.
    
    Without this, kAFS server and address rotation doesn't work correctly
    because the algorithm doesn't detect received network errors.
    
    Fixes: 75b54cb57ca3 ("rxrpc: Add IPv6 support")
    Signed-off-by: David Howells <dhowells@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b5b3188098b3c438534c083243777bc685bb0627
Author: Michal Kalderon <Michal.Kalderon@cavium.com>
Date:   Tue May 8 21:29:19 2018 +0300

    qede: Fix gfp flags sent to rdma event node allocation
    
    [ Upstream commit 090477e4acb31c5dd674940c7c01d4f16bd1ac41 ]
    
    A previous commit 4609adc27175 ("qede: Fix qedr link update")
    added a flow that could allocate rdma event objects from an
    interrupt path (link notification). Therefore the kzalloc call
    should be done with GFP_ATOMIC.
    
    fixes: 4609adc27175 ("qede: Fix qedr link update")
    Signed-off-by: Michal Kalderon <Michal.Kalderon@cavium.com>
    Signed-off-by: Sudarsana Kalluru <Sudarsana.Kalluru@cavium.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6618d064bacad3bef642825263eb4e8edcc55142
Author: Michal Kalderon <Michal.Kalderon@cavium.com>
Date:   Tue May 8 21:29:18 2018 +0300

    qed: Fix l2 initializations over iWARP personality
    
    [ Upstream commit af6858ee423a309d93054c361c61099b8eb12bbf ]
    
    If qede driver was loaded on a device configured for iWARP
    the l2 mutex wouldn't be allocated, and some l2 related
    resources wouldn't be freed.
    
    fixes: c851a9dc4359 ("qed: Introduce iWARP personality")
    Signed-off-by: Michal Kalderon <Michal.Kalderon@cavium.com>
    Signed-off-by: Sudarsana Kalluru <Sudarsana.Kalluru@cavium.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dc5af7b0de98ce376fb7d34035749e71c081a7ff
Author: Ying Xue <ying.xue@windriver.com>
Date:   Tue May 8 21:44:06 2018 +0800

    tipc: eliminate KMSAN uninit-value in strcmp complaint
    
    [ Upstream commit 94f6a80c0c11828cb7b3d79294459dd8d761ca89 ]
    
    When we get link properties through netlink interface with
    tipc_nl_node_get_link(), we don't validate TIPC_NLA_LINK_NAME
    attribute at all, instead we directly use it. As a consequence,
    KMSAN detected the TIPC_NLA_LINK_NAME attribute was an uninitialized
    value, and then posted the following complaint:
    
    ==================================================================
    BUG: KMSAN: uninit-value in strcmp+0xf7/0x160 lib/string.c:329
    CPU: 1 PID: 4527 Comm: syz-executor655 Not tainted 4.16.0+ #87
    Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS
    Google 01/01/2011
    Call Trace:
      __dump_stack lib/dump_stack.c:17 [inline]
      dump_stack+0x185/0x1d0 lib/dump_stack.c:53
      kmsan_report+0x142/0x240 mm/kmsan/kmsan.c:1067
      __msan_warning_32+0x6c/0xb0 mm/kmsan/kmsan_instr.c:683
      strcmp+0xf7/0x160 lib/string.c:329
      tipc_nl_node_get_link+0x220/0x6f0 net/tipc/node.c:1881
      genl_family_rcv_msg net/netlink/genetlink.c:599 [inline]
      genl_rcv_msg+0x1686/0x1810 net/netlink/genetlink.c:624
      netlink_rcv_skb+0x378/0x600 net/netlink/af_netlink.c:2447
      genl_rcv+0x63/0x80 net/netlink/genetlink.c:635
      netlink_unicast_kernel net/netlink/af_netlink.c:1311 [inline]
      netlink_unicast+0x166b/0x1740 net/netlink/af_netlink.c:1337
      netlink_sendmsg+0x1048/0x1310 net/netlink/af_netlink.c:1900
      sock_sendmsg_nosec net/socket.c:630 [inline]
      sock_sendmsg net/socket.c:640 [inline]
      ___sys_sendmsg+0xec0/0x1310 net/socket.c:2046
      __sys_sendmsg net/socket.c:2080 [inline]
      SYSC_sendmsg+0x2a3/0x3d0 net/socket.c:2091
      SyS_sendmsg+0x54/0x80 net/socket.c:2087
      do_syscall_64+0x309/0x430 arch/x86/entry/common.c:287
      entry_SYSCALL_64_after_hwframe+0x3d/0xa2
    RIP: 0033:0x445589
    RSP: 002b:00007fb7ee66cdb8 EFLAGS: 00000246 ORIG_RAX: 000000000000002e
    RAX: ffffffffffffffda RBX: 00000000006dac24 RCX: 0000000000445589
    RDX: 0000000000000000 RSI: 0000000020023000 RDI: 0000000000000003
    RBP: 00000000006dac20 R08: 0000000000000000 R09: 0000000000000000
    R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000000
    R13: 00007fffa2bf3f3f R14: 00007fb7ee66d9c0 R15: 0000000000000001
    
    Uninit was created at:
      kmsan_save_stack_with_flags mm/kmsan/kmsan.c:278 [inline]
      kmsan_internal_poison_shadow+0xb8/0x1b0 mm/kmsan/kmsan.c:188
      kmsan_kmalloc+0x94/0x100 mm/kmsan/kmsan.c:314
      kmsan_slab_alloc+0x11/0x20 mm/kmsan/kmsan.c:321
      slab_post_alloc_hook mm/slab.h:445 [inline]
      slab_alloc_node mm/slub.c:2737 [inline]
      __kmalloc_node_track_caller+0xaed/0x11c0 mm/slub.c:4369
      __kmalloc_reserve net/core/skbuff.c:138 [inline]
      __alloc_skb+0x2cf/0x9f0 net/core/skbuff.c:206
      alloc_skb include/linux/skbuff.h:984 [inline]
      netlink_alloc_large_skb net/netlink/af_netlink.c:1183 [inline]
      netlink_sendmsg+0x9a6/0x1310 net/netlink/af_netlink.c:1875
      sock_sendmsg_nosec net/socket.c:630 [inline]
      sock_sendmsg net/socket.c:640 [inline]
      ___sys_sendmsg+0xec0/0x1310 net/socket.c:2046
      __sys_sendmsg net/socket.c:2080 [inline]
      SYSC_sendmsg+0x2a3/0x3d0 net/socket.c:2091
      SyS_sendmsg+0x54/0x80 net/socket.c:2087
      do_syscall_64+0x309/0x430 arch/x86/entry/common.c:287
      entry_SYSCALL_64_after_hwframe+0x3d/0xa2
    ==================================================================
    
    To quiet the complaint, TIPC_NLA_LINK_NAME attribute has been
    validated in tipc_nl_node_get_link() before it's used.
    
    Reported-by: syzbot+df0257c92ffd4fcc58cd@syzkaller.appspotmail.com
    Signed-off-by: Ying Xue <ying.xue@windriver.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6ca2fa569d65a7a4b0fbc1aada8fd373cd4a0790
Author: Mathieu Malaterre <malat@debian.org>
Date:   Sat May 5 21:54:05 2018 +0200

    agp: uninorth: make two functions static
    
    [ Upstream commit dec60f3a9b7251f2657d743d96ba9a83dca02351 ]
    
    Both ‘uninorth_remove_memory’ and ‘null_cache_flush’ can be made
    static. So make them.
    
    Silence the following gcc warning (W=1):
    
      drivers/char/agp/uninorth-agp.c:198:5: warning: no previous prototype for ‘uninorth_remove_memory’ [-Wmissing-prototypes]
    
    and
    
      drivers/char/agp/uninorth-agp.c:473:6: warning: no previous prototype for ‘null_cache_flush’ [-Wmissing-prototypes]
    
    Signed-off-by: Mathieu Malaterre <malat@debian.org>
    Signed-off-by: Dave Airlie <airlied@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8223298c5075c9fb0ae4b10274124c35cd6ea120
Author: Paulo Alcantara <palcantara@suse.de>
Date:   Fri May 4 11:25:26 2018 -0300

    cifs: smb2ops: Fix listxattr() when there are no EAs
    
    [ Upstream commit ae2cd7fb478b8da707906ee1706ae1379968a8f9 ]
    
    As per listxattr(2):
    
           On success, a nonnegative number is returned indicating the size
           of the extended attribute name list.  On failure, -1 is returned
           and errno  is set appropriately.
    
    In SMB1, when the server returns an empty EA list through a listxattr(),
    it will correctly return 0 as there are no EAs for the given file.
    
    However, in SMB2+, it returns -ENODATA in listxattr() which is wrong since
    the request and response were sent successfully, although there's no actual
    EA for the given file.
    
    This patch fixes listxattr() for SMB2+ by returning 0 in cifs_listxattr()
    when the server returns an empty list of EAs.
    
    Signed-off-by: Paulo Alcantara <palcantara@suse.de>
    Reviewed-by: Aurelien Aptel <aaptel@suse.com>
    Signed-off-by: Steve French <smfrench@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fcc0315abc95076062cfe59b9933d08fdcad2781
Author: David Gilhooley <dgilhooley@nvidia.com>
Date:   Tue May 8 15:49:42 2018 -0700

    arm64: Add MIDR encoding for NVIDIA CPUs
    
    [ Upstream commit 1b06bd8dd95f7a19ab33fdf0f477c94950822ab3 ]
    
    This patch adds the MIDR encodings for NVIDIA as well as
    the Denver and Carmel CPUs used in Tegra SoCs.
    
    Signed-off-by: David Gilhooley <dgilhooley@nvidia.com>
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 56068475a7f02f7fb7afdb941cc6e6b53d6f3a91
Author: Jakob Unterwurzacher <jakob.unterwurzacher@theobroma-systems.com>
Date:   Wed Apr 18 16:10:03 2018 +0200

    can: dev: increase bus-off message severity
    
    [ Upstream commit 71c23a821c6bcacba71a094efe49ee689605906b ]
    
    bus-off is usually caused by hardware malfunction or configuration error
    (baud rate mismatch) and causes a complete loss of communication.
    
    Increase the "bus-off" message's severity from netdev_dbg() to
    netdev_info() to make it visible to the user.
    
    A can interface going into bus-off is similar in severity to ethernet's
    "Link is Down" message, which is also printed at info level.
    
    It is debatable whether the the "restarted" message should also be
    changed to netdev_info() to make the interface state changes
    comprehensible from the kernel log. I have chosen to keep the
    "restarted" message at dbg for now as the "bus-off" message should be
    enough for the user to notice and investigate the problem.
    
    Signed-off-by: Jakob Unterwurzacher <jakob.unterwurzacher@theobroma-systems.com>
    Cc: linux-can@vger.kernel.org
    Cc: linux-kernel@vger.kernel.org
    Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4dc2437cdd6b6c6a745500ac647dc3cd66a0e2ee
Author: Igor Russkikh <igor.russkikh@aquantia.com>
Date:   Mon May 7 16:10:38 2018 +0300

    net: aquantia: driver should correctly declare vlan_features bits
    
    [ Upstream commit 8c61ab7f111a2b29d051348b9cb9a39804ebf1f8 ]
    
    In particular, not reporting SG forced skbs to be linear for vlan
    interfaces over atlantic NIC.
    
    With this fix it is possible to enable SG feature on device and
    therefore optimize performance.
    
    Reported-by: Ma Yuying <yuma@redhat.com>
    Signed-off-by: Igor Russkikh <igor.russkikh@aquantia.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a951cf4da8964e4f8797b48e9c805abac4c7b1d9
Author: van der Linden, Frank <fllinden@amazon.com>
Date:   Fri May 4 16:11:00 2018 -0400

    x86/xen: Reset VCPU0 info pointer after shared_info remap
    
    [ Upstream commit d1ecfa9d1f402366b1776fbf84e635678a51414f ]
    
    This patch fixes crashes during boot for HVM guests on older (pre HVM
    vector callback) Xen versions. Without this, current kernels will always
    fail to boot on those Xen versions.
    
    Sample stack trace:
    
       BUG: unable to handle kernel paging request at ffffffffff200000
       IP: __xen_evtchn_do_upcall+0x1e/0x80
       PGD 1e0e067 P4D 1e0e067 PUD 1e10067 PMD 235c067 PTE 0
        Oops: 0002 [#1] SMP PTI
       Modules linked in:
       CPU: 0 PID: 512 Comm: kworker/u2:0 Not tainted 4.14.33-52.13.amzn1.x86_64 #1
       Hardware name: Xen HVM domU, BIOS 3.4.3.amazon 11/11/2016
       task: ffff88002531d700 task.stack: ffffc90000480000
       RIP: 0010:__xen_evtchn_do_upcall+0x1e/0x80
       RSP: 0000:ffff880025403ef0 EFLAGS: 00010046
       RAX: ffffffff813cc760 RBX: ffffffffff200000 RCX: ffffc90000483ef0
       RDX: ffff880020540a00 RSI: ffff880023c78000 RDI: 000000000000001c
       RBP: 0000000000000001 R08: 0000000000000000 R09: 0000000000000000
       R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
       R13: ffff880025403f5c R14: 0000000000000000 R15: 0000000000000000
       FS:  0000000000000000(0000) GS:ffff880025400000(0000) knlGS:0000000000000000
       CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
       CR2: ffffffffff200000 CR3: 0000000001e0a000 CR4: 00000000000006f0
        Call Trace:
       <IRQ>
       do_hvm_evtchn_intr+0xa/0x10
       __handle_irq_event_percpu+0x43/0x1a0
       handle_irq_event_percpu+0x20/0x50
       handle_irq_event+0x39/0x60
       handle_fasteoi_irq+0x80/0x140
       handle_irq+0xaf/0x120
       do_IRQ+0x41/0xd0
       common_interrupt+0x7d/0x7d
       </IRQ>
    
    During boot, the HYPERVISOR_shared_info page gets remapped to make it work
    with KASLR. This means that any pointer derived from it needs to be
    adjusted.
    
    The only value that this applies to is the vcpu_info pointer for VCPU 0.
    For PV and HVM with the callback vector feature, this gets done via the
    smp_ops prepare_boot_cpu callback. Older Xen versions do not support the
    HVM callback vector, so there is no Xen-specific smp_ops set up in that
    scenario. So, the vcpu_info pointer for VCPU 0 never gets set to the proper
    value, and the first reference of it will be bad. Fix this by resetting it
    immediately after the remap.
    
    Signed-off-by: Frank van der Linden <fllinden@amazon.com>
    Reviewed-by: Eduardo Valentin <eduval@amazon.com>
    Reviewed-by: Alakesh Haloi <alakeshh@amazon.com>
    Reviewed-by: Vallish Vaidyeshwara <vallish@amazon.com>
    Reviewed-by: Boris Ostrovsky <boris.ostrovsky@oracle.com>
    Cc: Juergen Gross <jgross@suse.com>
    Cc: Boris Ostrovsky <boris.ostrovsky@oracle.com>
    Cc: xen-devel@lists.xenproject.org
    Signed-off-by: Boris Ostrovsky <boris.ostrovsky@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ba29f3738e86f4e69cc8470a60a62e21d492475d
Author: Sara Sharon <sara.sharon@intel.com>
Date:   Fri Apr 20 13:49:19 2018 +0300

    mac80211: use timeout from the AddBA response instead of the request
    
    [ Upstream commit 914eac248d876f9c00cd1792ffec3d182c863f13 ]
    
    2016 spec, section 10.24.2 specifies that the block ack
    timeout in the ADD BA request is advisory.
    
    That means we should check the value in the response and
    act upon it (same as buffer size).
    
    Signed-off-by: Sara Sharon <sara.sharon@intel.com>
    Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e4bd54eb87c820b3e2da9a9701896d6ac1bae6f6
Author: Clément Péron <peron.clem@gmail.com>
Date:   Thu May 3 17:32:07 2018 +0200

    ARM: dts: cygnus: fix irq type for arm global timer
    
    [ Upstream commit 675c7215aacf54242b2e8bc64bab698abbe764db ]
    
    As per ARM documentation
    PPI(0) ID27 - global timer interrupt is rising-edge sensitive.
    
    set IRQ triggering type to IRQ_TYPE_EDGE_RISING for ARM Global timers.
    
    Fixes: c9ad7bc5fe3 ("ARM: dts: Enable Broadcom Cygnus SoC")
    Signed-off-by: Clément Péron <peron.clem@gmail.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 36166445a922a50343bec7f193f243390e9e0680
Author: Mathieu Malaterre <malat@debian.org>
Date:   Sat May 5 22:00:37 2018 +0200

    driver core: add __printf verification to __ata_ehi_pushv_desc
    
    [ Upstream commit 0d74d872c3f8b9cb3d096fb932a063b43b37f188 ]
    
    __printf is useful to verify format and arguments. Remove the following
    warning (with W=1):
    
      drivers/ata/libata-eh.c:183:10: warning: function might be possible candidate for ‘gnu_printf’ format attribute [-Wsuggest-attribute=format]
    
    Signed-off-by: Mathieu Malaterre <malat@debian.org>
    Signed-off-by: Tejun Heo <tj@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bc707b2d950b549b6071f39fe269291ec6031d5a
Author: Tomi Valkeinen <tomi.valkeinen@ti.com>
Date:   Wed May 2 12:11:59 2018 +0300

    drm/omap: handle alloc failures in omap_connector
    
    [ Upstream commit 47aaaec818dfd1009d1358974a2931f05dd57203 ]
    
    Handle memory allocation failures in omap_connector to avoid NULL
    derefs.
    
    Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20180502091159.7071-5-tomi.valkeinen@ti.com
    Reviewed-by: Benoit Parrot <bparrot@ti.com>
    Reviewed-by: Peter Ujfalusi <peter.ujfalusi@ti.com>
    Signed-off-by: Sean Paul <seanpaul@chromium.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 771f573cc158884bae8cf22d1a5627c396aa868f
Author: Tomi Valkeinen <tomi.valkeinen@ti.com>
Date:   Wed May 2 12:11:56 2018 +0300

    drm/omap: check return value from soc_device_match
    
    [ Upstream commit 4d6cb5e2fee52af17001e92950f0894304706ee4 ]
    
    soc_device_match() can return NULL, so add a check and fail if
    soc_device_match() fails.
    
    Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20180502091159.7071-2-tomi.valkeinen@ti.com
    Reviewed-by: Benoit Parrot <bparrot@ti.com>
    Reviewed-by: Peter Ujfalusi <peter.ujfalusi@ti.com>
    Signed-off-by: Sean Paul <seanpaul@chromium.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a490d0570df2d7fe7ffe40e4049c7846677aa078
Author: Tomi Valkeinen <tomi.valkeinen@ti.com>
Date:   Thu Mar 29 13:40:37 2018 +0300

    drm/omap: fix possible NULL ref issue in tiler_reserve_2d
    
    [ Upstream commit 6a0f0c55619f0b82a677cab72e77c3444a5eee58 ]
    
    tiler_reserve_2d allocates memory but does not check if it got the
    memory. Add the check and return ENOMEM on failure.
    
    Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20180329104038.29154-2-tomi.valkeinen@ti.com
    Reviewed-by: Emil Velikov <emil.velikov@collabora.com>
    Reviewed-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
    Signed-off-by: Sean Paul <seanpaul@chromium.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9631f32b61dcdaf4f52976f3706364f470cfcca0
Author: Tomi Valkeinen <tomi.valkeinen@ti.com>
Date:   Thu Mar 29 13:40:36 2018 +0300

    drm/omap: fix uninitialized ret variable
    
    [ Upstream commit 77eeac24b10fc84d3ffd5b11a897dff88dde244d ]
    
    audio_config function for both HDMI4 and HDMI5 return uninitialized
    value as the error code if the display is not currently enabled. For
    some reason this has not caused any issues.
    
    Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20180329104038.29154-1-tomi.valkeinen@ti.com
    Reviewed-by: Emil Velikov <emil.velikov@collabora.com>
    Reviewed-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
    Signed-off-by: Sean Paul <seanpaul@chromium.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ca3c09a74945bfa9db326cee60601f60237e5606
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Wed Apr 18 17:29:37 2018 +0300

    drm/omap: silence unititialized variable warning
    
    [ Upstream commit 4a9fbfcab19d3f71ad2bf0bcb653c4ee84e69c7f ]
    
    Smatch complains that "area_free" could be used without being
    initialized.  This code is several years old and premusably works fine
    so this can't be a very serious bug.  But it's easy enough to silence
    the warning.  If "area_free" is false at the end of the function then
    we return -ENOMEM.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20180418142937.GA13828@mwanda
    Signed-off-by: Sean Paul <seanpaul@chromium.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6ad69952d50d719ec9fbf3062e50d47b3e314231
Author: Ilan Peer <ilan.peer@intel.com>
Date:   Fri Apr 20 13:49:20 2018 +0300

    mac80211: Adjust SAE authentication timeout
    
    [ Upstream commit 407879b690ba3a6bf29be896d02dad63463bd1c0 ]
    
    The IEEE P802.11-REVmd D1.0 specification updated the SAE authentication
    timeout to be 2000 milliseconds (see dot11RSNASAERetransPeriod). Update
    the SAE timeout setting accordingly.
    
    While at it, reduce some code duplication in the timeout configuration.
    
    Signed-off-by: Ilan Peer <ilan.peer@intel.com>
    Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 46d6ee12fa9dc094193b06be3d4db236cfa564a9
Author: Etienne Carriere <etienne.carriere@linaro.org>
Date:   Sun Apr 29 14:22:29 2018 +0200

    tee: check shm references are consistent in offset/size
    
    [ Upstream commit ab9d3db5b320a052452b9cd035599ee3c84bbee9 ]
    
    This change prevents userland from referencing TEE shared memory
    outside the area initially allocated by its owner. Prior this change an
    application could not reference or access memory it did not own but
    it could reference memory not explicitly allocated by owner but still
    allocated to the owner due to the memory allocation granule.
    
    Reported-by: Alexandre Jutras <alexandre.jutras@nxp.com>
    Signed-off-by: Etienne Carriere <etienne.carriere@linaro.org>
    Signed-off-by: Jens Wiklander <jens.wiklander@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d40e177f29ab6fd3cc4ddd261d785c3e5b1a2918
Author: Rich Felker <dalias@libc.org>
Date:   Sat May 5 16:40:23 2018 -0400

    sh: fix build failure for J2 cpu with SMP disabled
    
    [ Upstream commit 6cb465972c4eb6741b3094a58a65e527fc63c100 ]
    
    The sh asm/smp.h defines a fallback hard_smp_processor_id macro for
    the !SMP case, but linux/smp.h never includes asm/smp.h in the !SMP
    case.
    
    Signed-off-by: Rich Felker <dalias@libc.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0742396317a0a0e41ab47e9de10cd6f16317f049
Author: Peter Zijlstra <peterz@infradead.org>
Date:   Mon Apr 30 14:51:01 2018 +0200

    sched/core: Introduce set_special_state()
    
    [ Upstream commit b5bf9a90bbebffba888c9144c5a8a10317b04064 ]
    
    Gaurav reported a perceived problem with TASK_PARKED, which turned out
    to be a broken wait-loop pattern in __kthread_parkme(), but the
    reported issue can (and does) in fact happen for states that do not do
    condition based sleeps.
    
    When the 'current->state = TASK_RUNNING' store of a previous
    (concurrent) try_to_wake_up() collides with the setting of a 'special'
    sleep state, we can loose the sleep state.
    
    Normal condition based wait-loops are immune to this problem, but for
    sleep states that are not condition based are subject to this problem.
    
    There already is a fix for TASK_DEAD. Abstract that and also apply it
    to TASK_STOPPED and TASK_TRACED, both of which are also without
    condition based wait-loop.
    
    Reported-by: Gaurav Kohli <gkohli@codeaurora.org>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Reviewed-by: Oleg Nesterov <oleg@redhat.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a614eaa465f78767cfe6c5580c9741d73a228964
Author: Rob Herring <robh@kernel.org>
Date:   Thu May 3 13:09:44 2018 -0500

    spi: bcm2835aux: ensure interrupts are enabled for shared handler
    
    [ Upstream commit bc519d9574618e47a0c788000fb78da95e18d953 ]
    
    The BCM2835 AUX SPI has a shared interrupt line (with AUX UART).
    Downstream fixes this with an AUX irqchip to demux the IRQ sources and a
    DT change which breaks compatibility with older kernels. The AUX irqchip
    was already rejected for upstream[1] and the DT change would break
    working systems if the DTB is updated to a newer one. The latter issue
    was brought to my attention by Alex Graf.
    
    The root cause however is a bug in the shared handler. Shared handlers
    must check that interrupts are actually enabled before servicing the
    interrupt. Add a check that the TXEMPTY or IDLE interrupts are enabled.
    
    [1] https://patchwork.kernel.org/patch/9781221/
    
    Cc: Alexander Graf <agraf@suse.de>
    Cc: Marc Zyngier <marc.zyngier@arm.com>
    Cc: Mark Brown <broonie@kernel.org>
    Cc: Eric Anholt <eric@anholt.net>
    Cc: Stefan Wahren <stefan.wahren@i2se.com>
    Cc: Florian Fainelli <f.fainelli@gmail.com>
    Cc: Ray Jui <rjui@broadcom.com>
    Cc: Scott Branden <sbranden@broadcom.com>
    Cc: bcm-kernel-feedback-list@broadcom.com
    Cc: linux-spi@vger.kernel.org
    Cc: linux-rpi-kernel@lists.infradead.org
    Cc: linux-arm-kernel@lists.infradead.org
    Signed-off-by: Rob Herring <robh@kernel.org>
    Reviewed-by: Eric Anholt <eric@anholt.net>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 373a625cb3c49d72800ac7b2ac00f1d66ba7457f
Author: Parav Pandit <parav@mellanox.com>
Date:   Wed May 2 13:18:59 2018 +0300

    RDMA/cma: Do not query GID during QP state transition to RTR
    
    [ Upstream commit 9aa169213d1166d30ae357a44abbeae93459339d ]
    
    When commit [1] was added, SGID was queried to derive the SMAC address.
    Then, later on during a refactor [2], SMAC was no longer needed. However,
    the now useless GID query remained.  Then during additional code changes
    later on, the GID query was being done in such a way that it caused iWARP
    queries to start breaking.  Remove the useless GID query and resolve the
    iWARP breakage at the same time.
    
    This is discussed in [3].
    
    [1] commit dd5f03beb4f7 ("IB/core: Ethernet L2 attributes in verbs/cm structures")
    [2] commit 5c266b2304fb ("IB/cm: Remove the usage of smac and vid of qp_attr and cm_av")
    [3] https://www.spinics.net/lists/linux-rdma/msg63951.html
    
    Suggested-by: Shiraz Saleem <shiraz.saleem@intel.com>
    Signed-off-by: Parav Pandit <parav@mellanox.com>
    Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3c54e919bd4f41417b601448b73fa2c0aafb47d0
Author: Sebastian Sanchez <sebastian.sanchez@intel.com>
Date:   Tue May 1 05:36:13 2018 -0700

    IB/hfi1: Fix memory leak in exception path in get_irq_affinity()
    
    [ Upstream commit 59482a14918b282ca2a98f38c69da5ebeb1107d2 ]
    
    When IRQ affinity is set and the interrupt type is unknown, a cpu
    mask allocated within the function is never freed. Fix this memory
    leak by allocating memory within the scope where it is used.
    
    Reviewed-by: Mike Marciniszyn <mike.marciniszyn@intel.com>
    Reviewed-by: Michael J. Ruhl <michael.j.ruhl@intel.com>
    Signed-off-by: Sebastian Sanchez <sebastian.sanchez@intel.com>
    Signed-off-by: Dennis Dalessandro <dennis.dalessandro@intel.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 77662d35b8c5e95ad498c253d434c37e137a2eda
Author: Michael J. Ruhl <michael.j.ruhl@intel.com>
Date:   Tue May 1 05:35:43 2018 -0700

    IB/hfi1 Use correct type for num_user_context
    
    [ Upstream commit 5da9e742be44d9b7c68b1bf6e1aaf46a1aa7a52b ]
    
    The module parameter num_user_context is defined as 'int' and
    defaults to -1.  The module_param_named() says that it is uint.
    
    Correct module_param_named() type information and update the modinfo
    text to reflect the default value.
    
    Reviewed-by: Dennis Dalessandro <dennis.dalessandro@intel.com>
    Signed-off-by: Michael J. Ruhl <michael.j.ruhl@intel.com>
    Signed-off-by: Dennis Dalessandro <dennis.dalessandro@intel.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 194feed06bcea86a804d2a547f34f1033faa728f
Author: Stefan Raspl <stefan.raspl@linux.ibm.com>
Date:   Thu May 3 17:57:39 2018 +0200

    smc: fix sendpage() call
    
    [ Upstream commit bda27ff5c4526f80a7620a94ecfe8dca153e3696 ]
    
    The sendpage() call grabs the sock lock before calling the default
    implementation - which tries to grab it once again.
    
    Signed-off-by: Stefan Raspl <raspl@linux.ibm.com>
    Signed-off-by: Ursula Braun <ubraun@linux.ibm.com><
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9c0f528f6bf0abcea8291d620117b8b49fb48ab5
Author: Janusz Krzysztofik <jmkrzyszt@gmail.com>
Date:   Wed May 2 20:32:03 2018 +0200

    ARM: OMAP1: ams-delta: fix deferred_fiq handler
    
    [ Upstream commit baf64250b4a513bf4ac226fd938692dc1836f4f6 ]
    
    The deferred_fiq handler used to limit hardware operations to IRQ
    unmask only, relying on gpio-omap assigned handler performing the ACKs.
    Since commit 80ac93c27441 ("gpio: omap: Fix lost edge interrupts") this
    is no longer the case as handle_edge_irq() has been replaced with
    handle_simmple_irq() which doesn't touch the hardware.
    
    Add single ACK operation per each active IRQ pin to the handler. While
    being at it, move unmask operation out of irq_counter loop so it is
    also called only once for each active IRQ pin.
    
    Fixes: 80ac93c27441 ("gpio: omap: Fix lost edge interrupts")
    Signed-off-by: Janusz Krzysztofik <jmkrzyszt@gmail.com>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ac5e86401fea34255dcc65f791d927bf8f84673b
Author: Keith Busch <keith.busch@intel.com>
Date:   Tue Apr 17 14:42:44 2018 -0600

    nvme: Set integrity flag for user passthrough commands
    
    [ Upstream commit f31a21103c03bb62846409fdc60cc9faf2398cfb ]
    
    If the command a separate metadata buffer attached, the request needs
    to have the integrity flag set so the driver knows to map it.
    
    Signed-off-by: Keith Busch <keith.busch@intel.com>
    Reviewed-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b19122a48f01544456f4b4efe423b9aa7c21be6d
Author: Chengguang Xu <cgxu519@gmx.com>
Date:   Sat Apr 14 20:06:19 2018 +0800

    nvme: fix potential memory leak in option parsing
    
    [ Upstream commit 59a2f3f00fd744dbad22593f47552037d3154ca6 ]
    
    When specifying same string type option several times,
    current option parsing may cause memory leak. Hence,
    call kfree for previous one in this case.
    
    Signed-off-by: Chengguang Xu <cgxu519@gmx.com>
    Reviewed-by: Christoph Hellwig <hch@lst.de>
    Reviewed-by: Sagi Grimberg <sagi@grimberg.me>
    Signed-off-by: Keith Busch <keith.busch@intel.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 665d3c7f1e506ed9310e3038ab0966520fa5749a
Author: Changbin Du <changbin.du@intel.com>
Date:   Fri Apr 20 13:29:55 2018 +0800

    iommu/vt-d: fix shift-out-of-bounds in bug checking
    
    [ Upstream commit 0dfc0c792d691f8056f38b5c30789f504be0e467 ]
    
    It allows to flush more than 4GB of device TLBs. So the mask should be
    64bit wide. UBSAN captured this fault as below.
    
    [    3.760024] ================================================================================
    [    3.768440] UBSAN: Undefined behaviour in drivers/iommu/dmar.c:1348:3
    [    3.774864] shift exponent 64 is too large for 32-bit type 'int'
    [    3.780853] CPU: 2 PID: 0 Comm: swapper/2 Tainted: G     U            4.17.0-rc1+ #89
    [    3.788661] Hardware name: Dell Inc. OptiPlex 7040/0Y7WYT, BIOS 1.2.8 01/26/2016
    [    3.796034] Call Trace:
    [    3.798472]  <IRQ>
    [    3.800479]  dump_stack+0x90/0xfb
    [    3.803787]  ubsan_epilogue+0x9/0x40
    [    3.807353]  __ubsan_handle_shift_out_of_bounds+0x10e/0x170
    [    3.812916]  ? qi_flush_dev_iotlb+0x124/0x180
    [    3.817261]  qi_flush_dev_iotlb+0x124/0x180
    [    3.821437]  iommu_flush_dev_iotlb+0x94/0xf0
    [    3.825698]  iommu_flush_iova+0x10b/0x1c0
    [    3.829699]  ? fq_ring_free+0x1d0/0x1d0
    [    3.833527]  iova_domain_flush+0x25/0x40
    [    3.837448]  fq_flush_timeout+0x55/0x160
    [    3.841368]  ? fq_ring_free+0x1d0/0x1d0
    [    3.845200]  ? fq_ring_free+0x1d0/0x1d0
    [    3.849034]  call_timer_fn+0xbe/0x310
    [    3.852696]  ? fq_ring_free+0x1d0/0x1d0
    [    3.856530]  run_timer_softirq+0x223/0x6e0
    [    3.860625]  ? sched_clock+0x5/0x10
    [    3.864108]  ? sched_clock+0x5/0x10
    [    3.867594]  __do_softirq+0x1b5/0x6f5
    [    3.871250]  irq_exit+0xd4/0x130
    [    3.874470]  smp_apic_timer_interrupt+0xb8/0x2f0
    [    3.879075]  apic_timer_interrupt+0xf/0x20
    [    3.883159]  </IRQ>
    [    3.885255] RIP: 0010:poll_idle+0x60/0xe7
    [    3.889252] RSP: 0018:ffffb1b201943e30 EFLAGS: 00000246 ORIG_RAX: ffffffffffffff13
    [    3.896802] RAX: 0000000080200000 RBX: 000000000000008e RCX: 000000000000001f
    [    3.903918] RDX: 0000000000000000 RSI: 000000002819aa06 RDI: 0000000000000000
    [    3.911031] RBP: ffff9e93c6b33280 R08: 00000010f717d567 R09: 000000000010d205
    [    3.918146] R10: ffffb1b201943df8 R11: 0000000000000001 R12: 00000000e01b169d
    [    3.925260] R13: 0000000000000000 R14: ffffffffb12aa400 R15: 0000000000000000
    [    3.932382]  cpuidle_enter_state+0xb4/0x470
    [    3.936558]  do_idle+0x222/0x310
    [    3.939779]  cpu_startup_entry+0x78/0x90
    [    3.943693]  start_secondary+0x205/0x2e0
    [    3.947607]  secondary_startup_64+0xa5/0xb0
    [    3.951783] ================================================================================
    
    Signed-off-by: Changbin Du <changbin.du@intel.com>
    Signed-off-by: Joerg Roedel <jroedel@suse.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d98905c00c4c348eae88a5c195c611e2e1f23fc5
Author: Bhadram Varka <vbhadram@nvidia.com>
Date:   Wed May 2 20:44:40 2018 +0530

    arm64: tegra: Make BCM89610 PHY interrupt as active low
    
    [ Upstream commit 9df50ba76ac1485b844beffa1f3f5d9659d9cdaf ]
    
    Need to configure PHY interrupt as active low for P3310 Tegra186
    platform otherwise it results in spurious interrupts.
    
    This issue wasn't seen before because the generic PHY driver without
    interrupt support was used.
    
    Signed-off-by: Bhadram Varka <vbhadram@nvidia.com>
    Signed-off-by: Thierry Reding <treding@nvidia.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 61ca60932d52536944d56880032fc7a9ca305557
Author: Peter Zijlstra <peterz@infradead.org>
Date:   Mon Apr 30 14:50:22 2018 +0200

    kthread, sched/wait: Fix kthread_parkme() wait-loop
    
    [ Upstream commit 741a76b350897604c48fb12beff1c9b77724dc96 ]
    
    Gaurav reported a problem with __kthread_parkme() where a concurrent
    try_to_wake_up() could result in competing stores to ->state which,
    when the TASK_PARKED store got lost bad things would happen.
    
    The comment near set_current_state() actually mentions this competing
    store, but only mentions the case against TASK_RUNNING. This same
    store, with different timing, can happen against a subsequent !RUNNING
    store.
    
    This normally is not a problem, because as per that same comment, the
    !RUNNING state store is inside a condition based wait-loop:
    
      for (;;) {
        set_current_state(TASK_UNINTERRUPTIBLE);
        if (!need_sleep)
          break;
        schedule();
      }
      __set_current_state(TASK_RUNNING);
    
    If we loose the (first) TASK_UNINTERRUPTIBLE store to a previous
    (concurrent) wakeup, the schedule() will NO-OP and we'll go around the
    loop once more.
    
    The problem here is that the TASK_PARKED store is not inside the
    KTHREAD_SHOULD_PARK condition wait-loop.
    
    There is a genuine issue with sleeps that do not have a condition;
    this is addressed in a subsequent patch.
    
    Reported-by: Gaurav Kohli <gkohli@codeaurora.org>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Reviewed-by: Oleg Nesterov <oleg@redhat.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e7a65e899d521eba676a1e652f9bf48d67722a18
Author: Peter Zijlstra <peterz@infradead.org>
Date:   Fri Apr 20 11:50:05 2018 +0200

    stop_machine, sched: Fix migrate_swap() vs. active_balance() deadlock
    
    [ Upstream commit 0b26351b910fb8fe6a056f8a1bbccabe50c0e19f ]
    
    Matt reported the following deadlock:
    
    CPU0                                    CPU1
    
    schedule(.prev=migrate/0)               <fault>
      pick_next_task()                        ...
        idle_balance()                          migrate_swap()
          active_balance()                        stop_two_cpus()
                                                    spin_lock(stopper0->lock)
                                                    spin_lock(stopper1->lock)
                                                    ttwu(migrate/0)
                                                      smp_cond_load_acquire() -- waits for schedule()
            stop_one_cpu(1)
              spin_lock(stopper1->lock) -- waits for stopper lock
    
    Fix this deadlock by taking the wakeups out from under stopper->lock.
    This allows the active_balance() to queue the stop work and finish the
    context switch, which in turn allows the wakeup from migrate_swap() to
    observe the context and complete the wakeup.
    
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Reported-by: Matt Fleming <matt@codeblueprint.co.uk>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Acked-by: Matt Fleming <matt@codeblueprint.co.uk>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Michal Hocko <mhocko@suse.com>
    Cc: Mike Galbraith <umgwanakikbuti@gmail.com>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Link: http://lkml.kernel.org/r/20180420095005.GH4064@hirez.programming.kicks-ass.net
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a814d1101042d117069de12ba6a0ba152ac3f79a
Author: Helge Deller <deller@gmx.de>
Date:   Fri Apr 20 23:19:17 2018 +0200

    parisc: drivers.c: Fix section mismatches
    
    [ Upstream commit b819439fea305a0bfd6ca23a7994fd1a8847c0d8 ]
    
    Fix two section mismatches in drivers.c:
    1) Section mismatch in reference from the function alloc_tree_node() to
       the function .init.text:create_tree_node().
    2) Section mismatch in reference from the function walk_native_bus() to
       the function .init.text:alloc_pa_dev().
    
    Signed-off-by: Helge Deller <deller@gmx.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 609377d79e7578fc977ef02381febcc71a7a810a
Author: Daniel Borkmann <daniel@iogearbox.net>
Date:   Wed May 2 20:12:22 2018 +0200

    bpf, x64: fix memleak when not converging after image
    
    [ Upstream commit 3aab8884c9eb99189a3569ac4e6b205371c9ac0b ]
    
    While reviewing x64 JIT code, I noticed that we leak the prior allocated
    JIT image in the case where proglen != oldproglen during the JIT passes.
    Prior to the commit e0ee9c12157d ("x86: bpf_jit: fix two bugs in eBPF JIT
    compiler") we would just break out of the loop, and using the image as the
    JITed prog since it could only shrink in size anyway. After e0ee9c12157d,
    we would bail out to out_addrs label where we free addrs and jit_data but
    not the image coming from bpf_jit_binary_alloc().
    
    Fixes: e0ee9c12157d ("x86: bpf_jit: fix two bugs in eBPF JIT compiler")
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Acked-by: Alexei Starovoitov <ast@kernel.org>
    Acked-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 666776d5f45d478ef97b087ebc9ca0f52e55fdc5
Author: Jim Gill <jgill@vmware.com>
Date:   Fri Apr 20 19:04:47 2018 -0700

    scsi: vmw-pvscsi: return DID_BUS_BUSY for adapter-initated aborts
    
    [ Upstream commit f4b024271ae3e9786e5d6f1c05b01b57a74e1d6d ]
    
    The vmw_pvscsi driver returns DID_ABORT for commands aborted internally
    by the adapter, leading to the filesystem going read-only. Change the
    result to DID_BUS_BUSY, causing the kernel to retry the command.
    
    Signed-off-by: Jim Gill <jgill@vmware.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 09e12b91d12c03c31fee65ab7e4052b7f14e006b
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Fri Apr 6 16:28:23 2018 +0200

    hexagon: export csum_partial_copy_nocheck
    
    [ Upstream commit 330e261c35dfb969c48f996dbbc8b334b5ee8d9d ]
    
    This is needed to link ipv6 as a loadable module, which in turn happens
    in allmodconfig.
    
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Richard Kuo <rkuo@codeaurora.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8794fff6f4d9d48c6638b05f8de6bda8919b1748
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Fri Apr 6 16:28:22 2018 +0200

    hexagon: add memset_io() helper
    
    [ Upstream commit a57ab96ef9dde231d4d46edba4d5f73720edc16a ]
    
    We already have memcpy_toio(), but not memset_io(), so let's
    add the obvious version to allow building an allmodconfig kernel
    without errors like
    
    drivers/gpu/drm/ttm/ttm_bo_util.c: In function 'ttm_bo_move_memcpy':
    drivers/gpu/drm/ttm/ttm_bo_util.c:390:3: error: implicit declaration of function 'memset_io' [-Werror=implicit-function-declaration]
    
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Richard Kuo <rkuo@codeaurora.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 960fe000b1d3228394f930a824eeb1a401c2cdd9
Author: Nick Dyer <nick@shmanahar.org>
Date:   Tue May 1 11:40:18 2018 -0700

    Input: atmel_mxt_ts - fix the firmware update
    
    [ Upstream commit 068bdb67ef74df0ad1627b7247a163e3e252ac11 ]
    
    The automatic update mechanism will trigger an update if the
    info block CRCs are different between maxtouch configuration
    file (maxtouch.cfg) and chip.
    
    The driver compared the CRCs without retrieving the chip CRC,
    resulting always in a failure and firmware flashing action
    triggered. Fix this issue by retrieving the chip info block
    CRC before the check.
    
    Note that this solution has the benefit that by reading the
    information block and the object table into a contiguous region
    of memory, we can verify the checksum at probe time. This means
    we make sure that we are indeed talking to a chip that supports
    object protocol correctly.
    
    Using this patch on a kevin chromebook, the touchscreen and
    touchpad drivers are able to match the CRC:
    
      atmel_mxt_ts 3-004b: Family: 164 Variant: 14 Firmware V2.3.AA Objects: 40
      atmel_mxt_ts 5-004a: Family: 164 Variant: 17 Firmware V2.0.AA Objects: 31
      atmel_mxt_ts 3-004b: Resetting device
      atmel_mxt_ts 5-004a: Resetting device
      atmel_mxt_ts 3-004b: Config CRC 0x573E89: OK
      atmel_mxt_ts 3-004b: Touchscreen size X4095Y2729
      input: Atmel maXTouch Touchscreen as /devices/platform/ff130000.i2c/i2c-3/3-004b/input/input5
      atmel_mxt_ts 5-004a: Config CRC 0x0AF6BA: OK
      atmel_mxt_ts 5-004a: Touchscreen size X1920Y1080
      input: Atmel maXTouch Touchpad as /devices/platform/ff140000.i2c/i2c-5/5-004a/input/input6
    
    Signed-off-by: Nick Dyer <nick.dyer@shmanahar.org>
    Acked-by: Benson Leung <bleung@chromium.org>
    [Ezequiel: minor patch massage]
    Signed-off-by: Ezequiel Garcia <ezequiel@collabora.com>
    Tested-by: Sebastian Reichel <sebastian.reichel@collabora.co.uk>
    Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f8d7147cb60ffafe2363592cca2daee75a6a8530
Author: Adam Ford <aford173@gmail.com>
Date:   Tue May 1 08:58:53 2018 -0500

    ARM: dts: logicpd-som-lv: Fix Audio Mute
    
    [ Upstream commit 95e59fc3c3fa3187a07a75f40b21637deb4bd12d ]
    
    The Audio has worked, but the mute pin has a weak pulldown which alows
    some of the audio signal to pass very quietly.  This patch fixes
    that so the mute pin is actively driven high for mute or low for normal
    operation.
    
    Fixes: ab8dd3aed011 ("ARM: DTS: Add minimal Support for Logic
    PD DM3730 SOM-LV")
    
    Signed-off-by: Adam Ford <aford173@gmail.com>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8c4511032ac1d3087906415a770beb75ad198493
Author: Adam Ford <aford173@gmail.com>
Date:   Mon Apr 30 18:24:34 2018 -0500

    ARM: dts: logicpd-som-lv: Fix WL127x Startup Issues
    
    [ Upstream commit 189822cbcbf3ea37c26a15612d8f922c440bc0e0 ]
    
    The VAUX3 rail from the PMIC powers a clock driver which clocks
    the WL127x. This corrects a bug which did not correctly associate
    the vin-supply with the proper power rail.
    
    This also fixes a typo in the pinmuxing to properly configure the
    interrupt pin.
    
    Fixes: ab8dd3aed011 ("ARM: DTS: Add minimal Support for Logic PD
    DM3730 SOM-LV")
    
    Signed-off-by: Adam Ford <aford173@gmail.com>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 691f0a6b3b098511e98e7f4df30f8fa0d26b2868
Author: Tero Kristo <t-kristo@ti.com>
Date:   Fri Mar 9 11:50:20 2018 +0200

    ARM: OMAP2+: powerdomain: use raw_smp_processor_id() for trace
    
    [ Upstream commit 33e9572483031a79ad0a4468064675144d9269ec ]
    
    smp_processor_id() checks preemption if CONFIG_DEBUG_PREEMPT is enabled,
    causing a warning dump during boot:
    
    [    5.042377] BUG: using smp_processor_id() in preemptible [00000000] code: swapper/0/1
    [    5.050281] caller is pwrdm_set_next_pwrst+0x48/0x88
    [    5.055330] CPU: 1 PID: 1 Comm: swapper/0 Not tainted 4.14.24-g57341df0b4 #1
    
    Use the raw_smp_processor_id() for the trace instead, this value does
    not need to be perfectly correct. The alternative of disabling preempt
    is too heavy weight operation to be applied in PM hot path for just
    tracing purposes.
    
    Signed-off-by: Tero Kristo <t-kristo@ti.com>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 061a560f3293e06c72f4c36219e5bd4153c8cc6a
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Wed Apr 25 09:49:38 2018 +0200

    dt-bindings: panel: lvds: Fix path to display timing bindings
    
    [ Upstream commit f130307054a59ca21d2396f386be77ebd2e8ca96 ]
    
    Fixes: 14da3ed8dd08c581 ("devicetree/bindings: display: Document common
    panel properties")
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Reviewed-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
    Signed-off-by: Rob Herring <robh@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b1ac1ca7352dc59d1710fa14468e36b73ba454e0
Author: Sekhar Nori <nsekhar@ti.com>
Date:   Wed Apr 25 14:53:23 2018 +0530

    ARM: davinci: board-dm355-evm: fix broken networking
    
    [ Upstream commit 5c054de228dd6d97bf8e38962bd118953b66e5a0 ]
    
    Since commit 09f3756bb9a8 ("dm9000: Return an ERR_PTR() in all
    error conditions of dm9000_parse_dt()"), passing either non-NULL
    platform data or device-tree for dm9000 driver to probe is
    mandatory.
    
    DM335 board was using none, so networking failed to initialize.
    Fix it by passing non-NULL (but empty) platform data.
    
    Fixes: 09f3756bb9a8 ("dm9000: Return an ERR_PTR() in all error conditions of dm9000_parse_dt()")
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 034a9e9b235efa6ab98b67cd0bac57496d702589
Author: Sekhar Nori <nsekhar@ti.com>
Date:   Tue Apr 24 20:05:06 2018 +0530

    ARM: davinci: board-omapl138-hawk: fix GPIO numbers for MMC/SD lookup
    
    [ Upstream commit d45622c0eaa5992a1a2248cbe93e1ff7a2da7be4 ]
    
    commit c4dc56be7e26 ("ARM: davinci: fix the GPIO lookup for omapl138-hawk")
    fixed the GPIO chip name for look-up of MMC/SD CD and WP pins, but forgot
    to change the GPIO numbers passed.
    
    The GPIO numbers are not offsets from within a 32 GPIO bank. Fix the
    GPIO numbers as well as remove the misleading comment.
    
    Fixes: c4dc56be7e26 ("ARM: davinci: fix the GPIO lookup for omapl138-hawk")
    Reviewed-by: David Lechner <david@lechnology.com>
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0bf4a2db29648e1a7df776de41b1177aa7a037f2
Author: Sekhar Nori <nsekhar@ti.com>
Date:   Tue Apr 24 20:05:04 2018 +0530

    ARM: davinci: board-da850-evm: fix GPIO lookup for MMC/SD
    
    [ Upstream commit 67c6b6ff221f807180aea6dd597246f87e1dd98a ]
    
    The GPIO chip is called davinci_gpio.0 in legacy mode. Fix it, so that
    mmc can correctly lookup the wp and cp gpios. Also fix the GPIO numbers
    as they are not offsets within a bank.
    
    Note that it is the gpio-davinci driver that sets the gpiochip label to
    davinci_gpio.0.
    
    Fixes: bdf0e8364fd3 ("ARM: davinci: da850-evm: use gpio descriptor for mmc pins")
    Reviewed-by: David Lechner <david@lechnology.com>
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 38ffd4d581ff5448926dc72fc25e1cecb817de27
Author: Sekhar Nori <nsekhar@ti.com>
Date:   Tue Apr 24 20:05:03 2018 +0530

    ARM: davinci: board-da830-evm: fix GPIO lookup for MMC/SD
    
    [ Upstream commit 51e9f12163223546bd3aa9f7af6817931f980da8 ]
    
    The GPIO chip is called davinci_gpio.0 in legacy mode. Fix it, so that
    mmc can correctly lookup the wp and cp gpios. Also fix the GPIO numbers
    as they are not offsets within a bank.
    
    Note that it is the gpio-davinci driver that sets the gpiochip label to
    davinci_gpio.0.
    
    Fixes: b5e1438cf98a ("ARM: davinci: da830-evm: use gpio descriptor for mmc pins")
    Reported-by: David Lechner <david@lechnology.com>
    Reviewed-by: David Lechner <david@lechnology.com>
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 13e4a2083d2b5286ecfecfe98aa1bace6eee7a3e
Author: Håkon Bugge <haakon.bugge@oracle.com>
Date:   Wed Apr 18 16:24:50 2018 +0200

    IB/core: Make ib_mad_client_id atomic
    
    [ Upstream commit db82476f37413eaeff5f836a9d8b022d6544accf ]
    
    Currently, the kernel protects access to the agent ID allocator on a per
    port basis using a spinlock, so it is impossible for two apps/threads on
    the same port to get the same TID, but it is entirely possible for two
    threads on different ports to end up with the same TID.
    
    As this can be confusing (regardless of it being legal according to the
    IB Spec 1.3, C13-18.1.1, in section 13.4.6.4 - TransactionID usage),
    and as the rdma-core user space API for /dev/umad devices implies unique
    TIDs even across ports, make the TID an atomic type so that no two
    allocations, regardless of port number, will be the same.
    
    Signed-off-by: Håkon Bugge <haakon.bugge@oracle.com>
    Reviewed-by: Jack Morgenstein <jackm@dev.mellanox.co.il>
    Reviewed-by: Ira Weiny <ira.weiny@intel.com>
    Reviewed-by: Zhu Yanjun <yanjun.zhu@oracle.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5cb0ba254fee3c3ef61a3c02892e010851bbf54f
Author: Amir Goldstein <amir73il@gmail.com>
Date:   Mon Feb 5 19:32:18 2018 +0200

    <linux/stringhash.h>: fix end_name_hash() for 64bit long
    
    [ Upstream commit 19b9ad67310ed2f685062a00aec602bec33835f0 ]
    
    The comment claims that this helper will try not to loose bits, but for
    64bit long it looses the high bits before hashing 64bit long into 32bit
    int.  Use the helper hash_long() to do the right thing for 64bit long.
    For 32bit long, there is no change.
    
    All the callers of end_name_hash() either assign the result to
    qstr->hash, which is u32 or return the result as an int value (e.g.
    full_name_hash()).  Change the helper return type to int to conform to
    its users.
    
    [ It took me a while to apply this, because my initial reaction to it
      was - incorrectly - that it could make for slower code.
    
      After having looked more at it, I take back all my complaints about
      the patch, Amir was right and I was mis-reading things or just being
      stupid.
    
      I also don't worry too much about the possible performance impact of
      this on 64-bit, since most architectures that actually care about
      performance end up not using this very much (the dcache code is the
      most performance-critical, but the word-at-a-time case uses its own
      hashing anyway).
    
      So this ends up being mostly used for filesystems that do their own
      degraded hashing (usually because they want a case-insensitive
      comparison function).
    
      A _tiny_ worry remains, in that not everybody uses DCACHE_WORD_ACCESS,
      and then this potentially makes things more expensive on 64-bit
      architectures with slow or lacking multipliers even for the normal
      case.
    
      That said, realistically the only such architecture I can think of is
      PA-RISC. Nobody really cares about performance on that, it's more of a
      "look ma, I've got warts^W an odd machine" platform.
    
      So the patch is fine, and all my initial worries were just misplaced
      from not looking at this properly.   - Linus ]
    
    Signed-off-by: Amir Goldstein <amir73il@gmail.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3fbbdb44cead49ab5e0913e3db143954979f6174
Author: Zhu Yanjun <yanjun.zhu@oracle.com>
Date:   Thu Apr 26 00:41:10 2018 -0400

    IB/rxe: avoid double kfree_skb
    
    [ Upstream commit 9fd4350ba8953804f05215999e11a6cfb7b41f2b ]
    
    When skb is sent, it will pass the following functions in soft roce.
    
    rxe_send [rdma_rxe]
        ip_local_out
            __ip_local_out
            ip_output
                ip_finish_output
                    ip_finish_output2
                        dev_queue_xmit
                            __dev_queue_xmit
                                dev_hard_start_xmit
    
    In the above functions, if error occurs in the above functions or
    iptables rules drop skb after ip_local_out, kfree_skb will be called.
    So it is not necessary to call kfree_skb in soft roce module again.
    Or else crash will occur.
    
    The steps to reproduce:
    
         server                       client
        ---------                    ---------
        |1.1.1.1|<----rxe-channel--->|1.1.1.2|
        ---------                    ---------
    
    On server: rping -s -a 1.1.1.1 -v -C 10000 -S 512
    On client: rping -c -a 1.1.1.1 -v -C 10000 -S 512
    
    The kernel configs CONFIG_DEBUG_KMEMLEAK and
    CONFIG_DEBUG_OBJECTS are enabled on both server and client.
    
    When rping runs, run the following command in server:
    
    iptables -I OUTPUT -p udp  --dport 4791 -j DROP
    
    Without this patch, crash will occur.
    
    CC: Srinivas Eeda <srinivas.eeda@oracle.com>
    CC: Junxiao Bi <junxiao.bi@oracle.com>
    Signed-off-by: Zhu Yanjun <yanjun.zhu@oracle.com>
    Reviewed-by: Yuval Shaia <yuval.shaia@oracle.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b4f6e28c801ac69406ecf1a2d5e27b03dc4644c2
Author: Jianchao Wang <jianchao.w.wang@oracle.com>
Date:   Thu Apr 26 11:52:39 2018 +0800

    IB/rxe: add RXE_START_MASK for rxe_opcode IB_OPCODE_RC_SEND_ONLY_INV
    
    [ Upstream commit 2da36d44a9d54a2c6e1f8da1f7ccc26b0bc6cfec ]
    
    w/o RXE_START_MASK, the last_psn of IB_OPCODE_RC_SEND_ONLY_INV
    will not be updated in update_wqe_psn, and the corresponding
    wqe will not be acked in rxe_completer due to its last_psn is
    zero. Finally, the other wqe will also not be able to be acked,
    because the wqe of IB_OPCODE_RC_SEND_ONLY_INV with last_psn 0
    is still there. This causes large amount of io timeout when
    nvmeof is over rxe.
    
    Add RXE_START_MASK for IB_OPCODE_RC_SEND_ONLY_INV to fix this.
    
    Signed-off-by: Jianchao Wang <jianchao.w.wang@oracle.com>
    Reviewed-by: Zhu Yanjun <yanjun.zhu@oracle.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d2be557eef15dad24e1acef1f4179a5e207cf2ef
Author: Colin Ian King <colin.king@canonical.com>
Date:   Wed Apr 25 17:24:04 2018 +0100

    RDMA/iwpm: fix memory leak on map_info
    
    [ Upstream commit f96416cea7bce9afe619c15e87fced70f93f9098 ]
    
    In the cases where iwpm_hash_bucket is NULL and where function
    get_mapinfo_hash_bucket returns NULL then the map_info is never added
    to hash_bucket_head and hence there is a leak of map_info. Fix this
    by nullifying hash_bucket_head and if that is null we know that
    that map_info was not added to hash_bucket_head and hence map_info
    should be free'd.
    
    Detected by CoverityScan, CID#1222481 ("Resource Leak")
    
    Fixes: 30dc5e63d6a5 ("RDMA/core: Add support for iWARP Port Mapper user space service")
    Signed-off-by: Colin Ian King <colin.king@canonical.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 019ce25a4ee05e14a879289881e9883d4583beb8
Author: Parav Pandit <parav@mellanox.com>
Date:   Tue Apr 24 20:13:45 2018 +0300

    RDMA/cma: Fix use after destroy access to net namespace for IPoIB
    
    [ Upstream commit 2918c1a900252b4a0c730715ec205437c7daf79d ]
    
    There are few issues with validation of netdevice and listen id lookup
    for IB (IPoIB) while processing incoming CM request as below.
    
    1. While performing lookup of bind_list in cma_ps_find(), net namespace
    of the netdevice can get deleted in cma_exit_net(), resulting in use
    after free access of idr and/or net namespace structures.
    This lookup occurs from the workqueue context (and not userspace
    context where net namespace is always valid).
    
               CPU0                              CPU1
               ====                              ====
    
     bind_list = cma_ps_find();
                                         move netdevice to new namespace
                                         delete net namespace
                                            cma_exit_net()
                                               idr_destroy(idr);
    
     [..]
     cma_find_listener(bind_list, ..);
    
    2. While netdevice is validated for IP address in given net namespace,
    netdevice's net namespace and/or ifindex can change in
    cma_get_net_dev() and cma_match_net_dev().
    
    Above issues are overcome by using rcu lock along with netdevice
    UP/DOWN state as described below.
    When a net namespace is getting deleted, netdevice is closed and
    shutdown before moving it back to init_net namespace.
    change_net_namespace() synchronizes with any existing use of netdevice
    before changing the netdev properties such as net or ifindex.
    Once netdevice IFF_UP flags is cleared, such fields are not guaranteed
    to be valid.
    Therefore, rcu lock along with netdevice state check ensures that,
    while route lookup and cm_id lookup is in progress, netdevice of
    interest won't migrate to any other net namespace.
    This ensures that associated net namespace of netdevice won't get
    deleted while rcu lock is held for netdevice which is in IFF_UP state.
    
    Fixes: fa20105e09e9 ("IB/cma: Add support for network namespaces")
    Fixes: 4be74b42a6d0 ("IB/cma: Separate port allocation to network namespaces")
    Fixes: f887f2ac87c2 ("IB/cma: Validate routing of incoming requests")
    Signed-off-by: Parav Pandit <parav@mellanox.com>
    Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 84f66378da20a4efc07f6d7b35f31cd3327639f1
Author: Matan Barak <matanb@mellanox.com>
Date:   Tue Apr 24 08:15:20 2018 +0000

    IB/uverbs: Fix validating mandatory attributes
    
    [ Upstream commit f604db645a66b7ba4f21c426fe73253928dada41 ]
    
    Previously, if a method contained mandatory attributes in a namespace
    that wasn't given by the user, these attributes weren't validated.
    Fixing this by iterating over all specification namespaces.
    
    Fixes: fac9658cabb9 ("IB/core: Add new ioctl interface")
    Signed-off-by: Matan Barak <matanb@mellanox.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fb019834bf8e717a0fc0c67f4a61d4455e3cfec1
Author: Greg Thelen <gthelen@google.com>
Date:   Thu Apr 26 11:19:35 2018 -0700

    IB: make INFINIBAND_ADDR_TRANS configurable
    
    [ Upstream commit f7cb7b85be55a4906b4b4b30596db1043dae6335 ]
    
    Allow INFINIBAND without INFINIBAND_ADDR_TRANS because fuzzing has been
    finding fair number of CM bugs.  So provide option to disable it.
    
    Signed-off-by: Greg Thelen <gthelen@google.com>
    Cc: Tarick Bedeir <tarick@google.com>
    Reviewed-by: Bart Van Assche <bart.vanassche@wdc.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b8500e6e8eb538c520136d92d35d0e8894210dcb
Author: Greg Thelen <gthelen@google.com>
Date:   Thu Apr 26 11:19:34 2018 -0700

    ib_srp: depend on INFINIBAND_ADDR_TRANS
    
    [ Upstream commit 5a3bc8a4abbd2d553430218d3a320400dce811b7 ]
    
    INFINIBAND_SRP code depends on INFINIBAND_ADDR_TRANS provided symbols.
    So declare the kconfig dependency.  This is necessary to allow for
    enabling INFINIBAND without INFINIBAND_ADDR_TRANS.
    
    Signed-off-by: Greg Thelen <gthelen@google.com>
    Cc: Tarick Bedeir <tarick@google.com>
    Reviewed-by: Bart Van Assche <bart.vanassche@wdc.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 08088b8a079331d80ca4e6f54892a9801c0eef32
Author: Greg Thelen <gthelen@google.com>
Date:   Thu Apr 26 11:19:32 2018 -0700

    ib_srpt: depend on INFINIBAND_ADDR_TRANS
    
    [ Upstream commit 346a47b65d10e450778ec0d21e4a9409f25daaa8 ]
    
    INFINIBAND_SRPT code depends on INFINIBAND_ADDR_TRANS provided symbols.
    So declare the kconfig dependency.  This is necessary to allow for
    enabling INFINIBAND without INFINIBAND_ADDR_TRANS.
    
    Signed-off-by: Greg Thelen <gthelen@google.com>
    Cc: Tarick Bedeir <tarick@google.com>
    Reviewed-by: Bart Van Assche <bart.vanassche@wdc.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4e2b7d1687c4c4aeeed55e8cb9ff040a68cbf90e
Author: Greg Thelen <gthelen@google.com>
Date:   Thu Apr 26 11:19:31 2018 -0700

    nvmet-rdma: depend on INFINIBAND_ADDR_TRANS
    
    [ Upstream commit d6fc6a22fc7d3df987666725496ed5dd2dd30f23 ]
    
    NVME_TARGET_RDMA code depends on INFINIBAND_ADDR_TRANS provided symbols.
    So declare the kconfig dependency.  This is necessary to allow for
    enabling INFINIBAND without INFINIBAND_ADDR_TRANS.
    
    Signed-off-by: Greg Thelen <gthelen@google.com>
    Cc: Tarick Bedeir <tarick@google.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8e6dba9166ed125f52287354541a753b6a532f9c
Author: Greg Thelen <gthelen@google.com>
Date:   Thu Apr 26 11:19:30 2018 -0700

    nvme: depend on INFINIBAND_ADDR_TRANS
    
    [ Upstream commit 3af7a156bdc356946098e13180be66b6420619bf ]
    
    NVME_RDMA code depends on INFINIBAND_ADDR_TRANS provided symbols.  So
    declare the kconfig dependency.  This is necessary to allow for enabling
    INFINIBAND without INFINIBAND_ADDR_TRANS.
    
    Signed-off-by: Greg Thelen <gthelen@google.com>
    Cc: Tarick Bedeir <tarick@google.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5d33c9d0fbd8a5a5f2dfc4affb7f9f97cb86afd0
Author: Jon Maloy <jon.maloy@ericsson.com>
Date:   Wed Apr 25 18:29:25 2018 +0200

    tipc: fix bug in function tipc_nl_node_dump_monitor
    
    [ Upstream commit 7dbc73e6124ce4d0cfbdd6166de388e9367c47ad ]
    
    Commit 36a50a989ee8 ("tipc: fix infinite loop when dumping link monitor
    summary") intended to fix a problem with user tool looping when max
    number of bearers are enabled.
    
    Unfortunately, the wrong version of the commit was posted, so the
    problem was not solved at all.
    
    This commit adds the missing part.
    
    Fixes: 36a50a989ee8 ("tipc: fix infinite loop when dumping link monitor summary")
    Signed-off-by: Jon Maloy <jon.maloy@ericsson.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f1e5bbe86ec13618fc39d2b01ad166cfa335b488
Author: Baolin Wang <baolin.wang@linaro.org>
Date:   Mon Apr 9 14:40:55 2018 +0800

    i2c: sprd: Fix the i2c count issue
    
    [ Upstream commit 2a010461207cc96bee5ab81748325dec1972976f ]
    
    We found the I2C controller count register is unreliable sometimes,
    that will cause I2C to lose data. Thus we can read the data count
    from 'i2c_dev->count' instead of the I2C controller count register.
    
    Signed-off-by: Baolin Wang <baolin.wang@linaro.org>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 201dc1345bfe7228d74830767f2a8de7be9b9723
Author: Baolin Wang <baolin.wang@linaro.org>
Date:   Mon Apr 9 14:40:54 2018 +0800

    i2c: sprd: Prevent i2c accesses after suspend is called
    
    [ Upstream commit da33aa03fa34c918faf2c371ebda0dd961d7ccb2 ]
    
    Add one flag to indicate if the i2c controller has been in suspend state,
    which can prevent i2c accesses after i2c controller is suspended following
    system suspend.
    
    Signed-off-by: Baolin Wang <baolin.wang@linaro.org>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 40d526e672125a75342b779a9305b64f8792e1b0
Author: John Fastabend <john.fastabend@gmail.com>
Date:   Wed Apr 25 15:08:53 2018 -0700

    bpf: fix uninitialized variable in bpf tools
    
    [ Upstream commit 815425567dea6c54494e85050631d6bdda907c5d ]
    
    Here the variable cont is used as the saved_pointer for a call to
    strtok_r(). It is safe to use the value uninitialized in this
    context however and the later reference is only ever used if
    the strtok_r is successful. But, 'gcc-5' at least doesn't have all
    this knowledge so initialize cont to NULL. Additionally, do the
    natural NULL check before accessing just for completness.
    
    The warning is the following:
    
    ./bpf/tools/bpf/bpf_dbg.c: In function ‘cmd_load’:
    ./bpf/tools/bpf/bpf_dbg.c:1077:13: warning: ‘cont’ may be used uninitialized in this function [-Wmaybe-uninitialized]
      } else if (matches(subcmd, "pcap") == 0) {
    
    Fixes: fd981e3c321a "filter: bpf_dbg: add minimal bpf debugger"
    Signed-off-by: John Fastabend <john.fastabend@gmail.com>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 09daf2df8db88672ae8060eee7802d93a371f244
Author: jacek.tomaka@poczta.fm <jacek.tomaka@poczta.fm>
Date:   Tue Apr 24 00:14:25 2018 +0800

    x86/cpu/intel: Add missing TLB cpuid values
    
    [ Upstream commit b837913fc2d9061bf9b8c0dd6bf2d24e2f98b84a ]
    
    Make kernel print the correct number of TLB entries on Intel Xeon Phi 7210
    (and others)
    
    Before:
    [ 0.320005] Last level dTLB entries: 4KB 0, 2MB 0, 4MB 0, 1GB 0
    After:
    [ 0.320005] Last level dTLB entries: 4KB 256, 2MB 128, 4MB 128, 1GB 16
    
    The entries do exist in the official Intel SMD but the type column there is
    incorrect (states "Cache" where it should read "TLB"), but the entries for
    the values 0x6B, 0x6C and 0x6D are correctly described as 'Data TLB'.
    
    Signed-off-by: Jacek Tomaka <jacek.tomaka@poczta.fm>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Link: https://lkml.kernel.org/r/20180423161425.24366-1-jacekt@dugeo.com
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 75b0436b24d6806c10108c4743c1c816aa026289
Author: Evan Wang <xswang@marvell.com>
Date:   Fri Apr 13 12:32:31 2018 +0800

    ata: ahci: mvebu: override ahci_stop_engine for mvebu AHCI
    
    [ Upstream commit daa2e3bdbb0b3e691cf20a042350817310cb8cb5 ]
    
    There is an issue(Errata Ref#226) that the SATA can not be
    detected via SATA Port-MultiPlayer(PMP) with following
    error log:
      ata1.15: PMP product ID mismatch
      ata1.15: SATA link up 6.0 Gbps (SStatus 133 SControl 300)
      ata1.15: Port Multiplier vendor mismatch '0x1b4b'!='0x0'
      ata1.15: PMP revalidation failed (errno=-19)
    
    After debugging, the reason is found that the value Port-x
    FIS-based Switching Control(PxFBS@0x40) become wrong.
    According to design, the bits[11:8, 0] of register PxFBS
    are cleared when Port Command and Status (0x18) bit[0]
    changes its value from 1 to 0, i.e. falling edge of Port
    Command and Status bit[0] sends PULSE that resets PxFBS
    bits[11:8; 0].
    So it needs a mvebu SATA WA to save the port PxFBS register
    before PxCMD ST write and restore it afterwards.
    
    This patch implements the WA in a separate function of
    ahci_mvebu_stop_engine to override ahci_stop_gngine.
    
    Signed-off-by: Evan Wang <xswang@marvell.com>
    Cc: Ofer Heifetz <oferh@marvell.com>
    Cc: Tejun Heo <tj@kernel.org>
    Cc: Thomas Petazzoni <thomas.petazzoni@bootlin.com>
    Signed-off-by: Tejun Heo <tj@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 48c0bf9af16115adda818dcff78871f547643a1b
Author: Evan Wang <xswang@marvell.com>
Date:   Fri Apr 13 12:32:30 2018 +0800

    libahci: Allow drivers to override stop_engine
    
    [ Upstream commit fa89f53bd7288d6aa7a982841119e7123faf5a53 ]
    
    Marvell armada37xx, armada7k and armada8k share the same
    AHCI sata controller IP, and currently there is an issue
    (Errata Ref#226)that the SATA can not be detected via SATA
    Port-MultiPlayer(PMP). After debugging, the reason is
    found that the value of Port-x FIS-based Switching Control
    (PxFBS@0x40) became wrong.
    According to design, the bits[11:8, 0] of register PxFBS
    are cleared when Port Command and Status (0x18) bit[0]
    changes its value from 1 to 0, i.e. falling edge of Port
    Command and Status bit[0] sends PULSE that resets PxFBS
    bits[11:8; 0].
    So it needs save the port PxFBS register before PxCMD
    ST write and restore the port PxFBS register afterwards
    in ahci_stop_engine().
    
    This commit allows drivers to override ahci_stop_engine
    behavior for use by the Marvell AHCI driver(and potentially
    other drivers in the future).
    
    Signed-off-by: Evan Wang <xswang@marvell.com>
    Cc: Ofer Heifetz <oferh@marvell.com>
    Cc: Tejun Heo <tj@kernel.org>
    Cc: Thomas Petazzoni <thomas.petazzoni@bootlin.com>
    Signed-off-by: Tejun Heo <tj@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 81d27c6ed637d5088901de01f0f5c7a624dad119
Author: Mark Rutland <mark.rutland@arm.com>
Date:   Wed Apr 25 17:13:42 2018 +0100

    KVM: arm/arm64: vgic: fix possible spectre-v1 in vgic_mmio_read_apr()
    
    [ Upstream commit 5e1ca5e23b167987d5b6d8b08f2d5b7dd2d13f49 ]
    
    It's possible for userspace to control n. Sanitize n when using it as an
    array index.
    
    Note that while it appears that n must be bound to the interval [0,3]
    due to the way it is extracted from addr, we cannot guarantee that
    compiler transformations (and/or future refactoring) will ensure this is
    the case, and given this is a slow path it's better to always perform
    the masking.
    
    Found by smatch.
    
    Signed-off-by: Mark Rutland <mark.rutland@arm.com>
    Acked-by: Christoffer Dall <christoffer.dall@arm.com>
    Acked-by: Marc Zyngier <marc.zyngier@arm.com>
    Cc: kvmarm@lists.cs.columbia.edu
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e3d1002e14cede45fc543c82b469dd21c5ba027f
Author: Mark Rutland <mark.rutland@arm.com>
Date:   Wed Apr 25 17:13:40 2018 +0100

    arm64: fix possible spectre-v1 in ptrace_hbp_get_event()
    
    [ Upstream commit 19791a7ca674fb3009bb068260e852a2f05b605c ]
    
    It's possible for userspace to control idx. Sanitize idx when using it
    as an array index.
    
    Found by smatch.
    
    Signed-off-by: Mark Rutland <mark.rutland@arm.com>
    Cc: Catalin Marinas <catalin.marinas@arm.com>
    Cc: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 06beec8716407961d6c4a74f1feaecd72013fa8b
Author: Omar Sandoval <osandov@fb.com>
Date:   Thu Apr 26 00:21:59 2018 -0700

    blk-mq: fix sysfs inflight counter
    
    [ Upstream commit bf0ddaba65ddbb2715af97041da8e7a45b2d8628 ]
    
    When the blk-mq inflight implementation was added, /proc/diskstats was
    converted to use it, but /sys/block/$dev/inflight was not. Fix it by
    adding another helper to count in-flight requests by data direction.
    
    Fixes: f299b7c7a9de ("blk-mq: provide internal in-flight variant")
    Signed-off-by: Omar Sandoval <osandov@fb.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 11ac08bd73ebfda3bb0c7b748d0306bdb658e6fe
Author: Arvind Yadav <arvind.yadav.cs@gmail.com>
Date:   Fri Mar 30 16:56:10 2018 +0530

    HID: intel-ish-hid: use put_device() instead of kfree()
    
    [ Upstream commit a4eb490a41a0da3b1275fc7427084cf9ae2c3c1c ]
    
    Never directly free @dev after calling device_register(), even
    if it returned an error. Always use put_device() to give up the
    reference initialized.
    
    Signed-off-by: Arvind Yadav <arvind.yadav.cs@gmail.com>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d803d94a3fcde7f317c40cc846d7c585532119f0
Author: Ramon Fried <rfried@codeaurora.org>
Date:   Fri Mar 23 00:09:12 2018 -0400

    rpmsg: added MODULE_ALIAS for rpmsg_char
    
    [ Upstream commit 93dd4e73c0d9cc32f835d76a54257020b0bfc75a ]
    
    Added "rpmsg:rpmsg_chrdev" MODULE_ALIAS to autoload
    rpmg_chrdev module automatically.
    
    Signed-off-by: Ramon Fried <rfried@codeaurora.org>
    Signed-off-by: Bjorn Andersson <bjorn.andersson@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bb7894391aad325ffe83e84b412022324ce345ef
Author: Tobias Jordan <Tobias.Jordan@elektrobit.com>
Date:   Thu Feb 15 16:12:55 2018 +0100

    remoteproc: qcom: Fix potential device node leaks
    
    [ Upstream commit 278d744c46fd4f1925aec77752d18a0e4a9cbec3 ]
    
    Add missing of_node_put()s at two places for device nodes returned by
    of_parse_phandle().
    
    Fixes: 051fb70fd4ea ("remoteproc: qcom: Driver for the self-authenticating
     Hexagon v5")
    Signed-off-by: Tobias Jordan <Tobias.Jordan@elektrobit.com>
    Signed-off-by: Bjorn Andersson <bjorn.andersson@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit af22d1b7705a130ccf917d806a139ea9ff1e9703
Author: Kan Liang <kan.liang@linux.intel.com>
Date:   Wed Apr 25 14:57:17 2018 -0400

    perf/x86/intel: Don't enable freeze-on-smi for PerfMon V1
    
    [ Upstream commit 4e949e9b9d1e3edcdab3b54656c5851bd9e49c67 ]
    
    The SMM freeze feature was introduced since PerfMon V2. But the current
    code unconditionally enables the feature for all platforms. It can
    generate #GP exception, if the related FREEZE_WHILE_SMM bit is set for
    the machine with PerfMon V1.
    
    To disable the feature for PerfMon V1, perf needs to
    - Remove the freeze_on_smi sysfs entry by moving intel_pmu_attrs to
      intel_pmu, which is only applied to PerfMon V2 and later.
    - Check the PerfMon version before flipping the SMM bit when starting CPU
    
    Fixes: 6089327f5424 ("perf/x86: Add sysfs entry to freeze counters on SMI")
    Signed-off-by: Kan Liang <kan.liang@linux.intel.com>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Acked-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Cc: ak@linux.intel.com
    Cc: eranian@google.com
    Cc: acme@redhat.com
    Link: https://lkml.kernel.org/r/1524682637-63219-1-git-send-email-kan.liang@linux.intel.com
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3958294c661e35e8454147c7fc7df60c35d989c2
Author: Dag Moxnes <dag.moxnes@oracle.com>
Date:   Wed Apr 25 13:22:01 2018 +0200

    rds: ib: Fix missing call to rds_ib_dev_put in rds_ib_setup_qp
    
    [ Upstream commit 91a825290ca4eae88603bc811bf74a45f94a3f46 ]
    
    The function rds_ib_setup_qp is calling rds_ib_get_client_data and
    should correspondingly call rds_ib_dev_put. This call was lost in
    the non-error path with the introduction of error handling done in
    commit 3b12f73a5c29 ("rds: ib: add error handle")
    
    Signed-off-by: Dag Moxnes <dag.moxnes@oracle.com>
    Reviewed-by: Håkon Bugge <haakon.bugge@oracle.com>
    Acked-by: Santosh Shilimkar <santosh.shilimkar@oracle.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9079946f612b25f4db25c9fbb074c2cb60c0c31d
Author: Masami Hiramatsu <mhiramat@kernel.org>
Date:   Thu Apr 5 18:29:12 2018 +0900

    selftests: ftrace: Add a testcase for multiple actions on trigger
    
    [ Upstream commit 25aa50e0ca397a5e5d4d6fcecefa8107877d1dd0 ]
    
    Add a testcase for multiple actions with different
    parameters on an event trigger, which has been fixed
    by commit 192c283e93bd ("tracing: Add action comparisons
     when testing matching hist triggers").
    
    Link: http://lkml.kernel.org/r/152292055227.15769.6327959816123227152.stgit@devbox
    
    Reviewed-by: Tom Zanussi <tom.zanussi@linux.intel.com>
    Tested-by: Tom Zanussi <tom.zanussi@linux.intel.com>
    Signed-off-by: Masami Hiramatsu <mhiramat@kernel.org>
    Signed-off-by: Steven Rostedt (VMware) <rostedt@goodmis.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 27e13b330dd2dae63b41855640d2b70517bd67e1
Author: Arvind Yadav <arvind.yadav.cs@gmail.com>
Date:   Tue Apr 24 13:33:03 2018 +0530

    HID: wacom: Release device resource data obtained by devres_alloc()
    
    [ Upstream commit 097b8f62dd793e08f1732fc74dbb64596c7fbff9 ]
    
    Free device resource data, if __wacom_devm_sysfs_create_group
    is not successful.
    
    Signed-off-by: Arvind Yadav <arvind.yadav.cs@gmail.com>
    Reviewed-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2f3ca3908fc06af250172cf08210778cfecb66aa
Author: pgzh <peter.ganzhorn@gmail.com>
Date:   Thu Apr 12 19:36:47 2018 +0200

    HID: lenovo: Add support for IBM/Lenovo Scrollpoint mice
    
    [ Upstream commit a230cd52b8a2be39cd6e9a13b3e62af57f21372a ]
    
    The IBM/Lenovo Scrollpoint mice feature a trackpoint-like stick instead of a
    scrolling wheel capable of 2-D (vertical+horizontal) scrolling.  hid-generic
    does only expose 1-D (vertical) scrolling functionality for these mice.  This
    patch adds support for horizontal scrolling for the IBM/Lenovo Scrollpoint mice
    to hid-lenovo.
    
    [jkosina@suse.cz: remove change versioning from git changelog]
    Signed-off-by: Peter Ganzhorn <peter.ganzhorn@gmail.com>
    Reviewed-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
    Signed-off-by: Peter De Wachter <pdewacht@gmail.com>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e6ec885f5f4ce93f5fb446c52131ac159e7e63f6
Author: Mark Rutland <mark.rutland@arm.com>
Date:   Tue Apr 24 13:11:22 2018 +0100

    arm64: ptrace: remove addr_limit manipulation
    
    [ Upstream commit 59275a0c037ed6fabd6354730f1e3104264ab719 ]
    
    We transiently switch to KERNEL_DS in compat_ptrace_gethbpregs() and
    compat_ptrace_sethbpregs(), but in either case this is pointless as we
    don't perform any uaccess during this window.
    
    let's rip out the redundant addr_limit manipulation.
    
    Acked-by: Catalin Marinas <catalin.marinas@arm.com>
    Signed-off-by: Mark Rutland <mark.rutland@arm.com>
    Cc: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ef0fa5e6f52b5850440bd3cf144220b688af8b3a
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Mon Apr 23 15:51:38 2018 -0700

    net: ethtool: Add missing kernel doc for FEC parameters
    
    [ Upstream commit d805c5209350ae725e3a1ee0204ba27d9e75ce3e ]
    
    While adding support for ethtool::get_fecparam and set_fecparam, kernel
    doc for these functions was missed, add those.
    
    Fixes: 1a5f3da20bd9 ("net: ethtool: add support for forward error correction modes")
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Acked-by: Roopa Prabhu <roopa@cumulusnetworks.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b1d0907c6feddcfe13f26b901d7e28c22d6650c0
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Sun Apr 22 19:56:17 2018 +0200

    thermal: int3403_thermal: Fix NULL pointer deref on module load / probe
    
    [ Upstream commit 13b86f50eaaddaea4bdd2fe476fd12e6a0951add ]
    
    Starting with kernel 4.17 thermal_cooling_device_register() will call the
    get_max_state() op during register.
    
    Since we deref priv->priv in int3403_get_max_state() this means we must
    set priv->priv before calling thermal_cooling_device_register().
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Zhang Rui <rui.zhang@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 56dfe52e04a287eb8c1d25d8fcfaef9e32fcd2e8
Author: Andres Rodriguez <andres.rodriguez@amd.com>
Date:   Tue Apr 10 17:32:33 2018 -0400

    drm/amdkfd: fix clock counter retrieval for node without GPU
    
    [ Upstream commit 1cf6cc74bbeb85bb87c3ca3f3df97a283c3aa737 ]
    
    Currently if a user requests clock counters for a node without a GPU
    resource we will always return EINVAL.
    
    Instead if no GPU resource is attached, fill the gpu_clock_counter
    argument with zeroes so that we may proceed and return valid CPU
    counters.
    
    Signed-off-by: Andres Rodriguez <andres.rodriguez@amd.com>
    Signed-off-by: Felix Kuehling <Felix.Kuehling@amd.com>
    Reviewed-by: Oded Gabbay <oded.gabbay@gmail.com>
    Signed-off-by: Oded Gabbay <oded.gabbay@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 73ea96beb771e7a1670eeb9d945a00d6bf1855d5
Author: Mika Westerberg <mika.westerberg@linux.intel.com>
Date:   Mon Apr 23 14:16:03 2018 +0300

    ACPI / watchdog: Prefer iTCO_wdt on Lenovo Z50-70
    
    [ Upstream commit a0a37862a4e1844793d39aca9ccb8fecbdcb8659 ]
    
    WDAT table on Lenovo Z50-70 is using RTC SRAM (ports 0x70 and 0x71) to
    store state of the timer. This conflicts with Linux RTC driver
    (rtc-cmos.c) who fails to reserve those ports for itself preventing RTC
    from functioning. In addition the WDAT table seems not to be fully
    functional because it does not reset the system when the watchdog times
    out.
    
    On this system iTCO_wdt works just fine so we simply prefer to use it
    instead of WDAT. This makes RTC working again and also results working
    watchdog via iTCO_wdt.
    
    Reported-by: Peter Milley <pbmilley@gmail.com>
    Link: https://bugzilla.kernel.org/show_bug.cgi?id=199033
    Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 00a85086e51fc213d66d15d5693dc4ff29ab68bd
Author: Sekhar Nori <nsekhar@ti.com>
Date:   Tue Apr 17 18:06:00 2018 +0530

    ARM: dts: da850: fix W=1 warnings with pinmux node
    
    [ Upstream commit 94a82284ad4711b7f9fd78981fdc7a1cb645030b ]
    
    Remove unused #address-cells and #size-cells from pinmux
    node. This fixes W=1 warnings of the type:
    
    arch/arm/boot/dts/da850-lcdk.dtb: Warning (avoid_unnecessary_addr_size): /soc@1c00000/pinmux@14120: unnecessary #address-cells/#size-cells without "ranges" or child "reg" property
    
    Tested on DA850 LCDK by checking output of:
    
    /sys/kernel/debug/pinctrl/1c14120.pinmux-pinctrl-single/pins
    
    before and after the change.
    
    Reviewed-by: David Lechner <david@lechnology.com>
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9148e21d7624fd4d6b69383c8988978c7ec84ef8
Author: Jingju Hou <Jingju.Hou@synaptics.com>
Date:   Mon Apr 23 15:22:49 2018 +0800

    net: phy: marvell: clear wol event before setting it
    
    [ Upstream commit b6a930fa88083b41d26ddf1cab95cbd740936c22 ]
    
    If WOL event happened once, the LED[2] interrupt pin will not be
    cleared unless we read the CSISR register. If interrupts are in use,
    the normal interrupt handling will clear the WOL event. Let's clear the
    WOL event before enabling it if !phy_interrupt_is_valid().
    
    Signed-off-by: Jingju Hou <Jingju.Hou@synaptics.com>
    Signed-off-by: Jisheng Zhang <Jisheng.Zhang@synaptics.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b0471926ceb538d1bd75576a853dbb19722eff25
Author: Balbir Singh <bsingharora@gmail.com>
Date:   Fri Apr 6 15:24:24 2018 +1000

    powerpc/powernv/memtrace: Let the arch hotunplug code flush cache
    
    [ Upstream commit 7fd6641de28fe9b5bce0c38d2adee0a72a72619e ]
    
    Don't do this via custom code, instead now that we have support in the
    arch hotplug/hotunplug code, rely on those routines to do the right
    thing.
    
    The existing flush doesn't work because it uses ppc64_caches.l1d.size
    instead of ppc64_caches.l1d.line_size.
    
    Fixes: 9d5171a8f248 ("powerpc/powernv: Enable removal of memory for in memory tracing")
    Signed-off-by: Balbir Singh <bsingharora@gmail.com>
    Reviewed-by: Rashmica Gupta <rashmica.g@gmail.com>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a4fa9189d6084067a7faa384ae1a405267caa48e
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Mon Apr 23 09:32:40 2018 +0200

    dt-bindings: meson-uart: DT fix s/clocks-names/clock-names/
    
    [ Upstream commit 34df2466b48dfe258e14fe2a7bc4641416575ade ]
    
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 71c8e7432a2e2ed11bb78dd524bc1cbe0fbea1d6
Author: Chen Yu <yu.c.chen@intel.com>
Date:   Tue Apr 10 23:07:51 2018 +0800

    ACPI / PM: Blacklist Low Power S0 Idle _DSM for ThinkPad X1 Tablet(2016)
    
    [ Upstream commit 855c1c2fce8bdbd796cba1d1456ca8f0e876c2f1 ]
    
    ThinkPad X1 Tablet(2016) is reported to have issues with
    the Low Power S0 Idle _DSM interface and since this machine
    model generally can do ACPI S3 just fine, and user would
    like to use S3 as default sleep model, add a blacklist
    entry to disable that interface for ThinkPad X1 Tablet(2016).
    
    Link: https://bugzilla.kernel.org/show_bug.cgi?id=199057
    Reported-and-tested-by: Robin Lee <robinlee.sysu@gmail.com>
    Signed-off-by: Chen Yu <yu.c.chen@intel.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d3bd4954286b95471c676722f21964ab36cec4d7
Author: Tobias Regnery <tobias.regnery@gmail.com>
Date:   Tue Apr 10 10:38:06 2018 +0200

    usb: typec: ucsi: fix tracepoint related build error
    
    [ Upstream commit 2f860691c2d2e3af1404ffeb2d22dd5c3dbca811 ]
    
    There is the following build error with CONFIG_TYPEC_UCSI=m, CONFIG_FTRACE=y
    and CONFIG_TRACING=n:
    
    ERROR: "__tracepoint_ucsi_command" [drivers/usb/typec/ucsi/typec_ucsi.ko] undefined!
    ERROR: "__tracepoint_ucsi_register_port" [drivers/usb/typec/ucsi/typec_ucsi.ko] undefined!
    ERROR: "__tracepoint_ucsi_notify" [drivers/usb/typec/ucsi/typec_ucsi.ko] undefined!
    ERROR: "__tracepoint_ucsi_reset_ppm" [drivers/usb/typec/ucsi/typec_ucsi.ko] undefined!
    ERROR: "__tracepoint_ucsi_run_command" [drivers/usb/typec/ucsi/typec_ucsi.ko] undefined!
    ERROR: "__tracepoint_ucsi_ack" [drivers/usb/typec/ucsi/typec_ucsi.ko] undefined!
    ERROR: "__tracepoint_ucsi_connector_change" [drivers/usb/typec/ucsi/typec_ucsi.ko] undefined!
    
    This compination is quite hard to create because CONFIG_TRACING gets selected
    only in rare cases without CONFIG_FTRACE.
    
    The build failure is caused by conditionally compiling trace.c depending on
    the wrong option CONFIG_FTRACE. Change this to depend on CONFIG_TRACING like
    other users of tracepoints do.
    
    Fixes: c1b0bc2dabfa ("usb: typec: Add support for UCSI interface")
    Signed-off-by: Tobias Regnery <tobias.regnery@gmail.com>
    Acked-by: Heikki Krogerus <heikki.krogerus@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6d2707f26892a07c19286c9472e2e32bd441f55e
Author: Minchan Kim <minchan@kernel.org>
Date:   Fri Apr 20 14:56:17 2018 -0700

    mm: memcg: add __GFP_NOWARN in __memcg_schedule_kmem_cache_create()
    
    [ Upstream commit c892fd82cc0632d425ae011a4dd75eb59e9f84ee ]
    
    If there is heavy memory pressure, page allocation with __GFP_NOWAIT
    fails easily although it's order-0 request.  I got below warning 9 times
    for normal boot.
    
         <snip >: page allocation failure: order:0, mode:0x2200000(GFP_NOWAIT|__GFP_NOTRACK)
         .. snip ..
         Call trace:
           dump_backtrace+0x0/0x4
           dump_stack+0xa4/0xc0
           warn_alloc+0xd4/0x15c
           __alloc_pages_nodemask+0xf88/0x10fc
           alloc_slab_page+0x40/0x18c
           new_slab+0x2b8/0x2e0
           ___slab_alloc+0x25c/0x464
           __kmalloc+0x394/0x498
           memcg_kmem_get_cache+0x114/0x2b8
           kmem_cache_alloc+0x98/0x3e8
           mmap_region+0x3bc/0x8c0
           do_mmap+0x40c/0x43c
           vm_mmap_pgoff+0x15c/0x1e4
           sys_mmap+0xb0/0xc8
           el0_svc_naked+0x24/0x28
         Mem-Info:
         active_anon:17124 inactive_anon:193 isolated_anon:0
          active_file:7898 inactive_file:712955 isolated_file:55
          unevictable:0 dirty:27 writeback:18 unstable:0
          slab_reclaimable:12250 slab_unreclaimable:23334
          mapped:19310 shmem:212 pagetables:816 bounce:0
          free:36561 free_pcp:1205 free_cma:35615
         Node 0 active_anon:68496kB inactive_anon:772kB active_file:31592kB inactive_file:2851820kB unevictable:0kB isolated(anon):0kB isolated(file):220kB mapped:77240kB dirty:108kB writeback:72kB shmem:848kB writeback_tmp:0kB unstable:0kB all_unreclaimable? no
         DMA free:142188kB min:3056kB low:3820kB high:4584kB active_anon:10052kB inactive_anon:12kB active_file:312kB inactive_file:1412620kB unevictable:0kB writepending:0kB present:1781412kB managed:1604728kB mlocked:0kB slab_reclaimable:3592kB slab_unreclaimable:876kB kernel_stack:400kB pagetables:52kB bounce:0kB free_pcp:1436kB local_pcp:124kB free_cma:142492kB
         lowmem_reserve[]: 0 1842 1842
         Normal free:4056kB min:4172kB low:5212kB high:6252kB active_anon:58376kB inactive_anon:760kB active_file:31348kB inactive_file:1439040kB unevictable:0kB writepending:180kB present:2000636kB managed:1923688kB mlocked:0kB slab_reclaimable:45408kB slab_unreclaimable:92460kB kernel_stack:9680kB pagetables:3212kB bounce:0kB free_pcp:3392kB local_pcp:688kB free_cma:0kB
         lowmem_reserve[]: 0 0 0
         DMA: 0*4kB 0*8kB 1*16kB (C) 0*32kB 0*64kB 0*128kB 1*256kB (C) 1*512kB (C) 0*1024kB 1*2048kB (C) 34*4096kB (C) = 142096kB
         Normal: 228*4kB (UMEH) 172*8kB (UMH) 23*16kB (UH) 24*32kB (H) 5*64kB (H) 1*128kB (H) 0*256kB 0*512kB 0*1024kB 0*2048kB 0*4096kB = 3872kB
         721350 total pagecache pages
         0 pages in swap cache
         Swap cache stats: add 0, delete 0, find 0/0
         Free swap  = 0kB
         Total swap = 0kB
         945512 pages RAM
         0 pages HighMem/MovableOnly
         63408 pages reserved
         51200 pages cma reserved
    
    __memcg_schedule_kmem_cache_create() tries to create a shadow slab cache
    and the worker allocation failure is not really critical because we will
    retry on the next kmem charge.  We might miss some charges but that
    shouldn't be critical.  The excessive allocation failure report is not
    very helpful.
    
    [mhocko@kernel.org: changelog update]
    Link: http://lkml.kernel.org/r/20180418022912.248417-1-minchan@kernel.org
    Signed-off-by: Minchan Kim <minchan@kernel.org>
    Acked-by: Johannes Weiner <hannes@cmpxchg.org>
    Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
    Cc: Michal Hocko <mhocko@kernel.org>
    Cc: Vladimir Davydov <vdavydov.dev@gmail.com>
    Cc: Minchan Kim <minchan@kernel.org>
    Cc: Matthew Wilcox <willy@infradead.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cd2cc6d131709b28032e026f81baa2f9a0d9b88d
Author: Dave Young <dyoung@redhat.com>
Date:   Fri Apr 20 14:56:10 2018 -0700

    kexec_file: do not add extra alignment to efi memmap
    
    [ Upstream commit a841aa83dff0af75c88aa846ba610a8af4c5ee21 ]
    
    Chun-Yi reported a kernel warning message below:
    
      WARNING: CPU: 0 PID: 0 at ../mm/early_ioremap.c:182 early_iounmap+0x4f/0x12c()
      early_iounmap(ffffffffff200180, 00000118) [0] size not consistent 00000120
    
    The problem is x86 kexec_file_load adds extra alignment to the efi
    memmap: in bzImage64_load():
    
            efi_map_sz = efi_get_runtime_map_size();
            efi_map_sz = ALIGN(efi_map_sz, 16);
    
    And __efi_memmap_init maps with the size including the alignment bytes
    but efi_memmap_unmap use nr_maps * desc_size which does not include the
    extra bytes.
    
    The alignment in kexec code is only needed for the kexec buffer internal
    use Actually kexec should pass exact size of the efi memmap to 2nd
    kernel.
    
    Link: http://lkml.kernel.org/r/20180417083600.GA1972@dhcp-128-65.nay.redhat.com
    Signed-off-by: Dave Young <dyoung@redhat.com>
    Reported-by: joeyli <jlee@suse.com>
    Tested-by: Randy Wright <rwright@hpe.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d497efd805fe5e2c2bd77f98bcc0f1700f090f0b
Author: Alexey Dobriyan <adobriyan@gmail.com>
Date:   Fri Apr 20 14:56:03 2018 -0700

    proc: revalidate kernel thread inodes to root:root
    
    [ Upstream commit 2e0ad552f5f8cd0fda02bc45fcd2b89821c62fd1 ]
    
    task_dump_owner() has the following code:
    
            mm = task->mm;
            if (mm) {
                    if (get_dumpable(mm) != SUID_DUMP_USER) {
                            uid = ...
                    }
            }
    
    Check for ->mm is buggy -- kernel thread might be borrowing mm
    and inode will go to some random uid:gid pair.
    
    Link: http://lkml.kernel.org/r/20180412220109.GA20978@avx2
    Signed-off-by: Alexey Dobriyan <adobriyan@gmail.com>
    Cc: "Eric W. Biederman" <ebiederm@xmission.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a20600762300154bb6ed99eea6b16abd1163dbea
Author: Huang Ying <ying.huang@intel.com>
Date:   Fri Apr 20 14:55:38 2018 -0700

    mm, pagemap: fix swap offset value for PMD migration entry
    
    [ Upstream commit 88c28f2469151b031f8cea9b28ed5be1b74a4172 ]
    
    The swap offset reported by /proc/<pid>/pagemap may be not correct for
    PMD migration entries.  If addr passed into pagemap_pmd_range() isn't
    aligned with PMD start address, the swap offset reported doesn't
    reflect this.  And in the loop to report information of each sub-page,
    the swap offset isn't increased accordingly as that for PFN.
    
    This may happen after opening /proc/<pid>/pagemap and seeking to a page
    whose address doesn't align with a PMD start address.  I have verified
    this with a simple test program.
    
    BTW: migration swap entries have PFN information, do we need to restrict
    whether to show them?
    
    [akpm@linux-foundation.org: fix typo, per Huang, Ying]
    Link: http://lkml.kernel.org/r/20180408033737.10897-1-ying.huang@intel.com
    Signed-off-by: "Huang, Ying" <ying.huang@intel.com>
    Cc: Michal Hocko <mhocko@suse.com>
    Cc: "Kirill A. Shutemov" <kirill.shutemov@linux.intel.com>
    Cc: Andrei Vagin <avagin@openvz.org>
    Cc: Dan Williams <dan.j.williams@intel.com>
    Cc: "Jerome Glisse" <jglisse@redhat.com>
    Cc: Daniel Colascione <dancol@google.com>
    Cc: Zi Yan <zi.yan@cs.rutgers.edu>
    Cc: Naoya Horiguchi <n-horiguchi@ah.jp.nec.com>
    Cc: Alexey Dobriyan <adobriyan@gmail.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6385f2da8b3bda687ae5e9f7c60655cfeb16632a
Author: Colin Ian King <colin.king@canonical.com>
Date:   Fri Apr 20 10:57:16 2018 +0100

    scsi: isci: Fix infinite loop in while loop
    
    [ Upstream commit 4bc83b3f272fe8f36450f9c003df49cf07ffe5fd ]
    
    In the case when the phy_mask is bitwise anded with the phy_index bit is
    zero the continue statement currently jumps to the next iteration of the
    while loop and phy_index is never actually incremented, potentially
    causing an infinite loop if phy_index is less than SCI_MAX_PHS. Fix this
    by turning the while loop into a for loop.
    
    Signed-off-by: Colin Ian King <colin.king@canonical.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 12f9bb1a273e29c0b51b5894803f8076dc5e4a8e
Author: Long Li <longli@microsoft.com>
Date:   Thu Mar 22 14:47:18 2018 -0700

    scsi: storvsc: Set up correct queue depth values for IDE devices
    
    [ Upstream commit f286299c1d0ba5e2ca0377610307b370fe178767 ]
    
    Unlike SCSI and FC, we don't use multiple channels for IDE.  Also fix
    the calculation for sub-channels.
    
    Signed-off-by: Long Li <longli@microsoft.com>
    Reviewed-by: Michael Kelley <mikelley@microsoft.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fc0d99fde0d2439ac7802efcb2f390013198db3b
Author: Baolin Wang <baolin.wang@linaro.org>
Date:   Thu Apr 19 14:51:03 2018 +0800

    parisc: time: Convert read_persistent_clock() to read_persistent_clock64()
    
    [ Upstream commit f76cdd00ef0e39d880139b074e3b247594dff95a ]
    
    The read_persistent_clock() uses a timespec, which is not year 2038 safe
    on 32bit systems. On parisc architecture, we have implemented generic
    RTC drivers that can be used to compensate the system suspend time, but
    the RTC time can not represent the nanosecond resolution, so this patch
    just converts to read_persistent_clock64() with timespec64.
    
    Signed-off-by: Baolin Wang <baolin.wang@linaro.org>
    Acked-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Helge Deller <deller@gmx.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6bf379f26a549f06a6b38a9594a06b1b213e18de
Author: David Howells <dhowells@redhat.com>
Date:   Fri Apr 20 13:35:02 2018 +0100

    vfs: Undo an overly zealous MS_RDONLY -> SB_RDONLY conversion
    
    [ Upstream commit a9e5b73288cf1595ac2e05cf1acd1924ceea05fa ]
    
    In do_mount() when the MS_* flags are being converted to MNT_* flags,
    MS_RDONLY got accidentally convered to SB_RDONLY.
    
    Undo this change.
    
    Fixes: e462ec50cb5f ("VFS: Differentiate mount flags (MS_*) from internal superblock flags")
    Signed-off-by: David Howells <dhowells@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bd595dbfcbd640e8270e8fdfe8b91226a80242ac
Author: dann frazier <dann.frazier@canonical.com>
Date:   Wed Apr 18 21:55:41 2018 -0600

    net: hns: Avoid action name truncation
    
    [ Upstream commit f4ea89110df237da6fbcaab76af431e85f07d904 ]
    
    When longer interface names are used, the action names exposed in
    /proc/interrupts and /proc/irq/* maybe truncated. For example, when
    using the predictable name algorithm in systemd on a HiSilicon D05,
    I see:
    
      ubuntu@d05-3:~$  grep enahisic2i0-tx /proc/interrupts | sed 's/.* //'
      enahisic2i0-tx0
      enahisic2i0-tx1
      [...]
      enahisic2i0-tx8
      enahisic2i0-tx9
      enahisic2i0-tx1
      enahisic2i0-tx1
      enahisic2i0-tx1
      enahisic2i0-tx1
      enahisic2i0-tx1
      enahisic2i0-tx1
    
    Increase the max ring name length to allow for an interface name
    of IFNAMSIZE. After this change, I now see:
    
      $ grep enahisic2i0-tx /proc/interrupts | sed 's/.* //'
      enahisic2i0-tx0
      enahisic2i0-tx1
      enahisic2i0-tx2
      [...]
      enahisic2i0-tx8
      enahisic2i0-tx9
      enahisic2i0-tx10
      enahisic2i0-tx11
      enahisic2i0-tx12
      enahisic2i0-tx13
      enahisic2i0-tx14
      enahisic2i0-tx15
    
    Signed-off-by: dann frazier <dann.frazier@canonical.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ea7246c258922565a53319ddc54684d081d1b4c8
Author: Jiang Biao <jiang.biao2@zte.com.cn>
Date:   Thu Apr 19 12:06:09 2018 +0800

    blkcg: init root blkcg_gq under lock
    
    [ Upstream commit 901932a3f9b2b80352896be946c6d577c0a9652c ]
    
    The initializing of q->root_blkg is currently outside of queue lock
    and rcu, so the blkg may be destroied before the initializing, which
    may cause dangling/null references. On the other side, the destroys
    of blkg are protected by queue lock or rcu. Put the initializing
    inside the queue lock and rcu to make it safer.
    
    Signed-off-by: Jiang Biao <jiang.biao2@zte.com.cn>
    Signed-off-by: Wen Yang <wen.yang99@zte.com.cn>
    CC: Tejun Heo <tj@kernel.org>
    CC: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b6126afd64d069384e41605779e8e27288185359
Author: Emil Velikov <emil.velikov@collabora.com>
Date:   Wed Mar 28 17:22:16 2018 +0100

    drm/msm: don't deref error pointer in the msm_fbdev_create error path
    
    [ Upstream commit 789d4c300e10eb2096ee83c3497118e67ccc951e ]
    
    Currently the error pointer returned by msm_alloc_stolen_fb gets passed
    to drm_framebuffer_remove. The latter handles only NULL pointers, thus
    a nasty crash will occur.
    
    Drop the unnecessary fail label and the associated checks - both err and
    fb will be set at this stage.
    
    Cc: Rob Clark <robdclark@gmail.com>
    Cc: linux-arm-msm@vger.kernel.org
    Cc: dri-devel@lists.freedesktop.org
    Cc: freedreno@lists.freedesktop.org
    Signed-off-by: Emil Velikov <emil.velikov@collabora.com>
    Signed-off-by: Rob Clark <robdclark@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5151a0c8d730509cc92ac2d1a2697dd0fe48be59
Author: Stefan Agner <stefan@agner.ch>
Date:   Mon Mar 19 22:26:32 2018 +0100

    drm/msm/dsi: use correct enum in dsi_get_cmd_fmt
    
    [ Upstream commit a4af89286f8fc382459308764ea05935dc477cdc ]
    
    The function dsi_get_cmd_fmt returns enum dsi_cmd_dst_format,
    use the correct enum value also for MIPI_DSI_FMT_RGB666/_PACKED.
    
    This has been discovered using clang:
      drivers/gpu/drm/msm/dsi/dsi_host.c:743:35: warning: implicit conversion
            from enumeration type 'enum dsi_vid_dst_format' to different
            enumeration type 'enum dsi_cmd_dst_format' [-Wenum-conversion]
              case MIPI_DSI_FMT_RGB666:       return VID_DST_FORMAT_RGB666;
                                              ~~~~~~ ^~~~~~~~~~~~~~~~~~~~~
    
    Signed-off-by: Stefan Agner <stefan@agner.ch>
    Reviewed-by: Archit Taneja <architt@codeaurora.org>
    Signed-off-by: Rob Clark <robdclark@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit be04f7301d8dc92a0c54392da26bd9b474ed7a2b
Author: Ben Hutchings <ben.hutchings@codethink.co.uk>
Date:   Tue Apr 3 23:38:45 2018 +0100

    drm/msm: Fix possible null dereference on failure of get_pages()
    
    [ Upstream commit 3976626ea3d2011f8fd3f3a47070a8b792018253 ]
    
    Commit 62e3a3e342af changed get_pages() to initialise
    msm_gem_object::pages before trying to initialise msm_gem_object::sgt,
    so that put_pages() would properly clean up pages in the failure
    case.
    
    However, this means that put_pages() now needs to check that
    msm_gem_object::sgt is not null before trying to clean it up, and
    this check was only applied to part of the cleanup code.  Move
    it all into the conditional block.  (Strictly speaking we don't
    need to make the kfree() conditional, but since we can't avoid
    checking for null ourselves we may as well do so.)
    
    Fixes: 62e3a3e342af ("drm/msm: fix leak in failed get_pages")
    Signed-off-by: Ben Hutchings <ben.hutchings@codethink.co.uk>
    Reviewed-by: Jordan Crouse <jcrouse@codeaurora.org>
    Signed-off-by: Rob Clark <robdclark@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 625b5b8c76d42afdf5ebcd7fa8da9fa2fcebfd67
Author: Srinivas Kandagatla <srinivas.kandagatla@linaro.org>
Date:   Wed Apr 18 18:46:37 2018 +0100

    ASoC: msm8916-wcd-analog: use threaded context for mbhc events
    
    [ Upstream commit a8419a0cd98ddf628a9e38a92110af7cc650dde7 ]
    
    As snd_soc_jack_report() can sleep, move handling of mbhc events to a
    thread context rather than in interrupt context.
    
    Fixes: de66b3455023 ('ASoC: codecs: msm8916-wcd-analog: add MBHC support')
    Reported-by: Bjorn Andersson <bjorn.andersson@linaro.org>
    Signed-off-by: Srinivas Kandagatla <srinivas.kandagatla@linaro.org>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 705fd605237b384051cf64b1bfeb223f6478d6cb
Author: Taehee Yoo <ap420073@gmail.com>
Date:   Wed Apr 18 23:35:34 2018 +0900

    netfilter: nf_tables: fix out-of-bounds in nft_chain_commit_update
    
    [ Upstream commit d71efb599ad42ef1e564c652d8084252bdc85edf ]
    
    When chain name is changed, nft_chain_commit_update is called.
    In the nft_chain_commit_update, trans->ctx.chain->name has old chain name
    and nft_trans_chain_name(trans) has new chain name.
    If new chain name is longer than old chain name, KASAN warns
    slab-out-of-bounds.
    
    [  175.015012] BUG: KASAN: slab-out-of-bounds in strcpy+0x9e/0xb0
    [  175.022735] Write of size 1 at addr ffff880114e022da by task iptables-compat/1458
    
    [  175.031353] CPU: 0 PID: 1458 Comm: iptables-compat Not tainted 4.16.0-rc7+ #146
    [  175.031353] Hardware name: To be filled by O.E.M. To be filled by O.E.M./Aptio CRB, BIOS 5.6.5 07/08/2015
    [  175.031353] Call Trace:
    [  175.031353]  dump_stack+0x68/0xa0
    [  175.031353]  print_address_description+0xd0/0x260
    [  175.031353]  ? strcpy+0x9e/0xb0
    [  175.031353]  kasan_report+0x234/0x350
    [  175.031353]  __asan_report_store1_noabort+0x1c/0x20
    [  175.031353]  strcpy+0x9e/0xb0
    [  175.031353]  nf_tables_commit+0x1ccc/0x2990
    [  175.031353]  nfnetlink_rcv+0x141e/0x16c0
    [  175.031353]  ? nfnetlink_net_init+0x150/0x150
    [  175.031353]  ? lock_acquire+0x370/0x370
    [  175.031353]  ? lock_acquire+0x370/0x370
    [  175.031353]  netlink_unicast+0x444/0x640
    [  175.031353]  ? netlink_attachskb+0x700/0x700
    [  175.031353]  ? _copy_from_iter_full+0x180/0x740
    [  175.031353]  ? kasan_check_write+0x14/0x20
    [  175.031353]  ? _copy_from_user+0x9b/0xd0
    [  175.031353]  netlink_sendmsg+0x845/0xc70
    [ ... ]
    
    Steps to reproduce:
       iptables-compat -N 1
       iptables-compat -E 1 aaaaaaaaa
    
    Signed-off-by: Taehee Yoo <ap420073@gmail.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d11b04c348940a0331689551385858298e7e1a84
Author: Pablo Neira Ayuso <pablo@netfilter.org>
Date:   Wed Apr 18 12:23:39 2018 +0200

    netfilter: nf_tables: NAT chain and extensions require NF_TABLES
    
    [ Upstream commit 39f2ff0816e5421476c2bc538b68b4bb0708a78e ]
    
    Move these options inside the scope of the 'if' NF_TABLES and
    NF_TABLES_IPV6 dependencies. This patch fixes:
    
       net/ipv6/netfilter/nft_chain_nat_ipv6.o: In function `nft_nat_do_chain':
    >> net/ipv6/netfilter/nft_chain_nat_ipv6.c:37: undefined reference to `nft_do_chain'
       net/ipv6/netfilter/nft_chain_nat_ipv6.o: In function `nft_chain_nat_ipv6_exit':
    >> net/ipv6/netfilter/nft_chain_nat_ipv6.c:94: undefined reference to `nft_unregister_chain_type'
       net/ipv6/netfilter/nft_chain_nat_ipv6.o: In function `nft_chain_nat_ipv6_init':
    >> net/ipv6/netfilter/nft_chain_nat_ipv6.c:87: undefined reference to `nft_register_chain_type'
    
    that happens with:
    
    CONFIG_NF_TABLES=m
    CONFIG_NFT_CHAIN_NAT_IPV6=y
    
    Fixes: 02c7b25e5f54 ("netfilter: nf_tables: build-in filter chain type")
    Reported-by: kbuild test robot <lkp@intel.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 348288a2699c046a524aac1a43a1fa1d508945ba
Author: Ming Lei <ming.lei@redhat.com>
Date:   Mon Apr 16 17:48:41 2018 +0800

    scsi: target: fix crash with iscsi target and dvd
    
    [ Upstream commit 8e1ceafe50ec4d1bcfae154dd70e7cb6946a6177 ]
    
    When the current page can't be added to bio, one new bio should be
    created for adding this page again, instead of ignoring this page.
    
    This patch fixes kernel crash with iscsi target and dvd, as reported by
    Wakko.
    
    Cc: Wakko Warner <wakko@animx.eu.org>
    Cc: Bart Van Assche <Bart.VanAssche@wdc.com>
    Cc: target-devel@vger.kernel.org
    Cc: linux-scsi@vger.kernel.org
    Cc: "Nicholas A. Bellinger" <nab@linux-iscsi.org>
    Cc: Christoph Hellwig <hch@lst.de>
    Fixes: 84c8590646d5b35804 ("target: avoid accessing .bi_vcnt directly")
    Signed-off-by: Ming Lei <ming.lei@redhat.com>
    Reviewed-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4fb7926bba584ed7045551f8a40d0a4b0a89d2fd
Author: Vinson Lee <vlee@freedesktop.org>
Date:   Wed Mar 21 21:04:12 2018 +0000

    scsi: megaraid_sas: Do not log an error if FW successfully initializes.
    
    [ Upstream commit fb1633d56b0025233ed3dc49b44544748d509d9d ]
    
    Fixes: 2d2c2331673c ("scsi: megaraid_sas: modified few prints in OCR and IOC INIT path")
    Signed-off-by: Vinson Lee <vlee@freedesktop.org>
    Acked-by: Shivasharan S <shivasharan.srikanteshwara@broadcom.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit af2cc1d2e75c50ce0dbbd3455608790c4fe07fbd
Author: Chris Leech <cleech@redhat.com>
Date:   Mon Apr 9 15:15:28 2018 -0700

    scsi: iscsi: respond to netlink with unicast when appropriate
    
    [ Upstream commit af17092810a887178195276255b7b31f8fbe7dbe ]
    
    Instead of always multicasting responses, send a unicast netlink message
    directed at the correct pid.  This will be needed if we ever want to
    support multiple userspace processes interacting with the kernel over
    iSCSI netlink simultaneously.  Limitations can currently be seen if you
    attempt to run multiple iscsistart commands in parallel.
    
    We've fixed up the userspace issues in iscsistart that prevented
    multiple instances from running, so now attempts to speed up booting by
    bringing up multiple iscsi sessions at once in the initramfs are just
    running into misrouted responses that this fixes.
    
    Signed-off-by: Chris Leech <cleech@redhat.com>
    Reviewed-by: Lee Duncan <lduncan@suse.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3f64c0c502ef050846c6dc1b56a9510afee53328
Author: Tung Nguyen <tung.q.nguyen@dektech.com.au>
Date:   Tue Apr 17 21:58:27 2018 +0200

    tipc: fix infinite loop when dumping link monitor summary
    
    [ Upstream commit 36a50a989ee8267588de520b8704b85f045a3220 ]
    
    When configuring the number of used bearers to MAX_BEARER and issuing
    command "tipc link monitor summary", the command enters infinite loop
    in user space.
    
    This issue happens because function tipc_nl_node_dump_monitor() returns
    the wrong 'prev_bearer' value when all potential monitors have been
    scanned.
    
    The correct behavior is to always try to scan all monitors until either
    the netlink message is full, in which case we return the bearer identity
    of the affected monitor, or we continue through the whole bearer array
    until we can return MAX_BEARERS. This solution also caters for the case
    where there may be gaps in the bearer array.
    
    Signed-off-by: Tung Nguyen <tung.q.nguyen@dektech.com.au>
    Signed-off-by: Jon Maloy <jon.maloy@ericsson.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9d5e2d69705fed4ab527f5a283b90ae602f4e0fd
Author: Jiang Biao <jiang.biao2@zte.com.cn>
Date:   Wed Apr 18 08:37:18 2018 -0600

    blkcg: don't hold blkcg lock when deactivating policy
    
    [ Upstream commit 946b81da114b8ba5c74bb01e57c0c6eca2bdc801 ]
    
    As described in the comment of blkcg_activate_policy(),
    *Update of each blkg is protected by both queue and blkcg locks so
    that holding either lock and testing blkcg_policy_enabled() is
    always enough for dereferencing policy data.*
    with queue lock held, there is no need to hold blkcg lock in
    blkcg_deactivate_policy(). Similar case is in
    blkcg_activate_policy(), which has removed holding of blkcg lock in
    commit 4c55f4f9ad3001ac1fefdd8d8ca7641d18558e23.
    
    Signed-off-by: Jiang Biao <jiang.biao2@zte.com.cn>
    Signed-off-by: Wen Yang <wen.yang99@zte.com.cn>
    CC: Tejun Heo <tj@kernel.org>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c5b6316c3f5139cbc1d9a37cd6b86bb7be3802bf
Author: sxauwsk <sxauwsk@163.com>
Date:   Tue Apr 17 04:01:27 2018 +0800

    spi: cadence: Add usleep_range() for cdns_spi_fill_tx_fifo()
    
    [ Upstream commit 49530e6411789c1b9ea3ebc58e520c19d1c3752f ]
    
    In case of xspi work in busy condition, may send bytes failed.
    once something wrong, spi controller did't work any more
    
    My test found this situation appear in both of read/write process.
    so when TX FIFO is full, add one byte delay before send data;
    
    Signed-off-by: sxauwsk <sxauwsk@163.com>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5f4bf078e779927200b246d05f569dbe75543ace
Author: Liam Girdwood <liam.r.girdwood@linux.intel.com>
Date:   Tue Mar 27 14:30:44 2018 +0100

    ASoC: topology: Check widget kcontrols before deref.
    
    [ Upstream commit 05bdcf12905533b8628627b6634608cd3b57c607 ]
    
    Validate the topology input before we dereference the pointer.
    
    Signed-off-by: Liam Girdwood <liam.r.girdwood@linux.intel.com>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ff3080bab10dcbd694b903eb8d70586c6f48b64b
Author: Simon Gaiser <simon@invisiblethingslab.com>
Date:   Thu Mar 15 04:08:03 2018 +0100

    xen: xenbus_dev_frontend: Really return response string
    
    [ Upstream commit ebf04f331fa15a966262341a7dc6b1a0efd633e4 ]
    
    xenbus_command_reply() did not actually copy the response string and
    leaked stack content instead.
    
    Fixes: 9a6161fe73bd ("xen: return xenstore command failures via response instead of rc")
    Signed-off-by: Simon Gaiser <simon@invisiblethingslab.com>
    Reviewed-by: Juergen Gross <jgross@suse.com>
    Signed-off-by: Boris Ostrovsky <boris.ostrovsky@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d5cf1ed8d3ae37a6115a0696a4885df1c777a9e9
Author: Yan Wang <yan.wang@linux.intel.com>
Date:   Mon Mar 26 16:48:00 2018 +0100

    ASoC: topology: Fix bugs of freeing soc topology
    
    [ Upstream commit feb12f0cd8d7b1e8df2e6fce19fc9a026a468cc2 ]
    
    In snd_soc_tplg_component_remove(), it should compare index and
    not dobj->index with SND_SOC_TPLG_INDEX_ALL for removing all
    topology objects.
    
    Signed-off-by: Yan Wang <yan.wang@linux.intel.com>
    Signed-off-by: Liam Girdwood <liam.r.girdwood@linux.intel.com>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bd8acfd77dd336afa8f22bb6f0ed24a7d479c355
Author: Loic Poulain <loic.poulain@linaro.org>
Date:   Tue Apr 3 11:19:01 2018 +0200

    PCI: kirin: Fix reset gpio name
    
    [ Upstream commit 5db8f8d1099bd93a64a80b609dbcce887327ffc8 ]
    
    As documented in the devicetree bindings (pci/kirin-pcie.txt) and the
    reset gpio name must be 'reset-gpios'. However, current driver
    erroneously looks for a 'reset-gpio' resource which makes the driver
    probe fail. Fix it.
    
    Fixes: fc5165db245a ("PCI: kirin: Add HiSilicon Kirin SoC PCIe controller driver")
    Signed-off-by: Loic Poulain <loic.poulain@linaro.org>
    [lorenzo.pieralisi@arm.com: updated the commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Acked-by: Xiaowei Song <songxiaowei@hisilicon.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 150efd30c3a0d0f1fc250ebdb198dff80bf86730
Author: Geert Uytterhoeven <geert@linux-m68k.org>
Date:   Sun Apr 8 11:05:15 2018 +0200

    soc: bcm2835: Make !RASPBERRYPI_FIRMWARE dummies return failure
    
    [ Upstream commit 144345a4a8c3b497a3f60d3af9d6071a37660186 ]
    
    If CONFIG_RASPBERRYPI_FIRMWARE=n:
    
        drivers/gpio/gpio-raspberrypi-exp.c: In function ‘rpi_exp_gpio_get_polarity’:
        drivers/gpio/gpio-raspberrypi-exp.c:71: warning: ‘get.polarity’ is used uninitialized in this function
        drivers/gpio/gpio-raspberrypi-exp.c: In function ‘rpi_exp_gpio_get_direction’:
        drivers/gpio/gpio-raspberrypi-exp.c:150: warning: ‘get.direction’ is used uninitialized in this function
    
    The dummy firmware interface functions return 0, which means success,
    causing subsequent code to make use of the never initialized output
    parameter.
    
    Fix this by making the dummy functions return an error code (-ENOSYS)
    instead.
    
    Note that this assumes the firmware always fills in the requested data
    in the CONFIG_RASPBERRYPI_FIRMWARE=y case.
    
    Fixes: d45f1a563b92dac7 ("staging: vc04_services: fix up rpi firmware functions")
    Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Reviewed-by: Eric Anholt <eric@anholt.net>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3050437392722eb9eaad327dcd5d10a069010670
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Sun Apr 1 09:42:25 2018 -0700

    soc: bcm: raspberrypi-power: Fix use of __packed
    
    [ Upstream commit 0a12e80ce4230434c2ed66ad0d65af0b7ccecea8 ]
    
    Commit a09cd356586d ("ARM: bcm2835: add rpi power domain driver")
    attempted to annotate the structure rpi_power_domain_packet with
    __packed but introduced a typo and made it named __packet instead. Just
    drop the annotation since the structure is naturally aligned already.
    
    Fixes: a09cd356586d ("ARM: bcm2835: add rpi power domain driver")
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d066fd9d7e9b41d60c5dca81ec5d5dbb0664a32f
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Wed Mar 28 23:41:52 2018 +0000

    eCryptfs: don't pass up plaintext names when using filename encryption
    
    [ Upstream commit e86281e700cca8a773f9a572fa406adf2784ba5c ]
    
    Both ecryptfs_filldir() and ecryptfs_readlink_lower() use
    ecryptfs_decode_and_decrypt_filename() to translate lower filenames to
    upper filenames. The function correctly passes up lower filenames,
    unchanged, when filename encryption isn't in use. However, it was also
    passing up lower filenames when the filename wasn't encrypted or
    when decryption failed. Since 88ae4ab9802e, eCryptfs refuses to lookup
    lower plaintext names when filename encryption is enabled so this
    resulted in a situation where userspace would see lower plaintext
    filenames in calls to getdents(2) but then not be able to lookup those
    filenames.
    
    An example of this can be seen when enabling filename encryption on an
    eCryptfs mount at the root directory of an Ext4 filesystem:
    
    $ ls -1i /lower
    12 ECRYPTFS_FNEK_ENCRYPTED.FWYZD8TcW.5FV-TKTEYOHsheiHX9a-w.NURCCYIMjI8pn5BDB9-h3fXwrE--
    11 lost+found
    $ ls -1i /upper
    ls: cannot access '/upper/lost+found': No such file or directory
     ? lost+found
    12 test
    
    With this change, the lower lost+found dentry is ignored:
    
    $ ls -1i /lower
    12 ECRYPTFS_FNEK_ENCRYPTED.FWYZD8TcW.5FV-TKTEYOHsheiHX9a-w.NURCCYIMjI8pn5BDB9-h3fXwrE--
    11 lost+found
    $ ls -1i /upper
    12 test
    
    Additionally, some potentially noisy error/info messages in the related
    code paths are turned into debug messages so that the logs can't be
    easily filled.
    
    Fixes: 88ae4ab9802e ("ecryptfs_lookup(): try either only encrypted or plaintext name")
    Reported-by: Guenter Roeck <linux@roeck-us.net>
    Cc: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3f54483edea26a11f24085cd299707c212762e95
Author: oder_chiou@realtek.com <oder_chiou@realtek.com>
Date:   Fri Mar 30 15:41:55 2018 +0800

    ASoC: rt5514: Add the missing register in the readable table
    
    [ Upstream commit 5ef5ac8de125fe6b4b23293bee026ca7ea1529b9 ]
    
    The patch adds the missing register in the readable table.
    
    Signed-off-by: Oder Chiou <oder_chiou@realtek.com>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9d33f89c40e9c9ae42a69e49566a3efdc165b0dd
Author: Jerome Brunet <jbrunet@baylibre.com>
Date:   Mon Apr 9 15:59:20 2018 +0200

    clk: honor CLK_MUX_ROUND_CLOSEST in generic clk mux
    
    [ Upstream commit 4ad69b80e886a845f56ce0a3d10211208693d92b ]
    
    CLK_MUX_ROUND_CLOSEST is part of the clk_mux documentation but clk_mux
    directly calls __clk_mux_determine_rate(), which overrides the flag.
    As result, if clk_mux is instantiated with CLK_MUX_ROUND_CLOSEST, the
    flag will be ignored and the clock rounded down.
    
    To solve this, this patch expose clk_mux_determine_rate_flags() in the
    clk-provider API and uses it in the determine_rate() callback of clk_mux.
    
    Fixes: 15a02c1f6dd7 ("clk: Add __clk_mux_determine_rate_closest")
    Signed-off-by: Jerome Brunet <jbrunet@baylibre.com>
    Signed-off-by: Stephen Boyd <sboyd@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dccf9862a7f5afe8c81bd52302918c33d9ba57d6
Author: Jacopo Mondi <jacopo+renesas@jmondi.org>
Date:   Mon Apr 16 15:56:08 2018 +0200

    dt-bindings: dmaengine: rcar-dmac: document R8A77965 support
    
    [ Upstream commit b89bc283286b105e50aab9ab35992c0237ac77d8 ]
    
    Add documentation for r8a77965 compatible string to rcar-dmac device
    tree bindings documentation.
    
    Signed-off-by: Jacopo Mondi <jacopo+renesas@jmondi.org>
    Reviewed-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Reviewed-by: Simon Horman <horms+renesas@verge.net.au>
    Signed-off-by: Rob Herring <robh@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 20d68135933707021bdd708cf2238a66975f0dc3
Author: Jacopo Mondi <jacopo+renesas@jmondi.org>
Date:   Mon Apr 16 15:55:28 2018 +0200

    dt-bindings: serial: sh-sci: Add support for r8a77965 (H)SCIF
    
    [ Upstream commit 7de5b7e5f6a67c285b86d1478e8e150929c93482 ]
    
    Add documentation for r8a77965 compatible string to Renesas sci-serial
    device tree bindings documentation.
    
    Signed-off-by: Jacopo Mondi <jacopo+renesas@jmondi.org>
    Reviewed-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Signed-off-by: Rob Herring <robh@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 20d3d7fa75b2edf6618d288367ec8de5cac1cf84
Author: Matheus Castello <matheus@castello.eng.br>
Date:   Wed Apr 11 01:17:03 2018 -0400

    dt-bindings: pinctrl: sunxi: Fix reference to driver
    
    [ Upstream commit b614e905a0bc8fc5d4fa72665ac26ae00c874a4e ]
    
    Bindings describe hardware, not drivers.
    Use reference to hardware Allwinner A1X Pin Controller instead driver.
    
    Signed-off-by: Matheus Castello <matheus@castello.eng.br>
    Signed-off-by: Rob Herring <robh@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5eeb26c58c0a66cade30410aaeb112e866cb8c2e
Author: Lukasz Majewski <lukma@denx.de>
Date:   Wed Apr 4 09:52:04 2018 +0200

    doc: Add vendor prefix for Kieback & Peter GmbH
    
    [ Upstream commit 99bf8f27f3f94d2a37291354b8dc83f13728f75f ]
    
    The 'kiebackpeter' entry has been added to vendor-prefixes.txt to indicate
    products from Kieback & Peter GmbH.
    
    Signed-off-by: Lukasz Majewski <lukma@denx.de>
    Signed-off-by: Rob Herring <robh@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3ca7dddaa13f8e7f4e618bf54dad2d18e9efc251
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Fri Apr 13 15:44:16 2018 +0300

    spi: sh-msiof: Fix bit field overflow writes to TSCR/RSCR
    
    [ Upstream commit 10b4640833e95eeacaef8060bc1b35e636df3218 ]
    
    The change fixes a bit field overflow which allows to write to higher
    bits while calculating SPI transfer clock and setting BRPS and BRDV
    bit fields, the problem is reproduced if 'parent_rate' to 'spi_hz'
    ratio is greater than 1024, for instance
    
      p->min_div      = 2,
      MSO rate        = 33333333,
      SPI device rate = 10000
    
    results in
    
      k          = 5, i.e. BRDV = 0b100 or 1/32 prescaler output,
      BRPS       = 105,
      TSCR value = 0x6804, thus MSSEL and MSIMM bit fields are non-zero.
    
    Fixes: 65d5665bb260 ("spi: sh-msiof: Update calculation of frequency dividing")
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b3ccb8a77ed11c366fe8d3c3d64a71b5ddf44a75
Author: Matt Redfearn <matt.redfearn@mips.com>
Date:   Fri Apr 13 09:50:44 2018 +0100

    MIPS: dts: Boston: Fix PCI bus dtc warnings:
    
    [ Upstream commit 2c2bf522ed8cbfaac666f7dc65cfd38de2b89f0f ]
    
    dtc recently (v1.4.4-8-g756ffc4f52f6) added PCI bus checks. Fix the
    warnings now emitted:
    
    arch/mips/boot/dts/img/boston.dtb: Warning (pci_bridge): /pci@10000000: missing bus-range for PCI bridge
    arch/mips/boot/dts/img/boston.dtb: Warning (pci_bridge): /pci@12000000: missing bus-range for PCI bridge
    arch/mips/boot/dts/img/boston.dtb: Warning (pci_bridge): /pci@14000000: missing bus-range for PCI bridge
    
    Signed-off-by: Matt Redfearn <matt.redfearn@mips.com>
    Cc: Ralf Baechle <ralf@linux-mips.org>
    Cc: Paul Burton <paul.burton@mips.com>
    Cc: Rob Herring <robh+dt@kernel.org>
    Cc: Mark Rutland <mark.rutland@arm.com>
    Cc: linux-mips@linux-mips.org
    Cc: devicetree@vger.kernel.org
    Patchwork: https://patchwork.linux-mips.org/patch/19070/
    Signed-off-by: James Hogan <jhogan@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ba041775a9a8291327f958d6337d130217de1bee
Author: Chengguang Xu <cgxu519@gmx.com>
Date:   Sat Apr 14 20:16:06 2018 +0800

    isofs: fix potential memory leak in mount option parsing
    
    [ Upstream commit 4f34a5130a471f32f2fe7750769ab4057dc3eaa0 ]
    
    When specifying string type mount option (e.g., iocharset)
    several times in a mount, current option parsing may
    cause memory leak. Hence, call kfree for previous one
    in this case. Meanwhile, check memory allocation result
    for it.
    
    Signed-off-by: Chengguang Xu <cgxu519@gmx.com>
    Signed-off-by: Jan Kara <jack@suse.cz>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d27cd5cb9b384803d69204b07b447e9abe32f127
Author: Martin Schwidefsky <schwidefsky@de.ibm.com>
Date:   Tue Apr 3 11:08:52 2018 +0200

    s390/smsgiucv: disable SMSG on module unload
    
    [ Upstream commit 760dd0eeaec1689430243ead14e5a429613d8c52 ]
    
    The module exit function of the smsgiucv module uses the incorrect CP
    command to disable SMSG messages. The correct command is "SET SMSG OFF".
    Use it.
    
    Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e7b720ef94d8582a1346e6aebf03f8a59e682b17
Author: Sinan Kaya <okaya@codeaurora.org>
Date:   Thu Apr 12 22:30:44 2018 -0400

    MIPS: io: Add barrier after register read in readX()
    
    [ Upstream commit a1cc7034e33d12dc17d13fbcd7d597d552889097 ]
    
    While a barrier is present in the writeX() functions before the register
    write, a similar barrier is missing in the readX() functions after the
    register read. This could allow memory accesses following readX() to
    observe stale data.
    
    Signed-off-by: Sinan Kaya <okaya@codeaurora.org>
    Reported-by: Arnd Bergmann <arnd@arndb.de>
    Cc: Ralf Baechle <ralf@linux-mips.org>
    Cc: Paul Burton <paul.burton@mips.com>
    Cc: linux-mips@linux-mips.org
    Patchwork: https://patchwork.linux-mips.org/patch/19069/
    [jhogan@kernel.org: Tidy commit message]
    Signed-off-by: James Hogan <jhogan@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dc94ac5fc41054c16824b01683fade1b77a07c7a
Author: Amir Goldstein <amir73il@gmail.com>
Date:   Thu Apr 5 16:18:03 2018 +0300

    fsnotify: fix ignore mask logic in send_to_group()
    
    [ Upstream commit 92183a42898dc400b89da35685d1814ac6acd3d8 ]
    
    The ignore mask logic in send_to_group() does not match the logic
    in fanotify_should_send_event(). In the latter, a vfsmount mark ignore
    mask precedes an inode mark mask and in the former, it does not.
    
    That difference may cause events to be sent to fanotify backend for no
    reason. Fix the logic in send_to_group() to match that of
    fanotify_should_send_event().
    
    Signed-off-by: Amir Goldstein <amir73il@gmail.com>
    Signed-off-by: Jan Kara <jack@suse.cz>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 025e42a5e7a318572d0ea2b94b508011bcaff306
Author: Arnaldo Carvalho de Melo <acme@redhat.com>
Date:   Thu Apr 12 14:58:24 2018 -0300

    perf report: Fix switching to another perf.data file
    
    [ Upstream commit 7b366142a50ad79e48de8e67c5b3e8cfb9fa82dd ]
    
    In the TUI the 's' hotkey can be used to switch to another perf.data
    file in the current directory, but that got broken in Fixes:
    b01141f4f59c ("perf annotate: Initialize the priv are in symbol__new()"),
    that would show this once another file was chosen:
    
        ┌─Fatal Error─────────────────────────────────────┐
        │Annotation needs to be init before symbol__init()│
        │                                                 │
        │                                                 │
        │Press any key...                                 │
        └─────────────────────────────────────────────────┘
    
    Fix it by just silently bailing out if symbol__annotation_init() was already
    called, just like is done with symbol__init(), i.e. they are done just once at
    session start, not when switching to a new perf.data file.
    
    Cc: Adrian Hunter <adrian.hunter@intel.com>
    Cc: Andi Kleen <ak@linux.intel.com>
    Cc: David Ahern <dsahern@gmail.com>
    Cc: Jin Yao <yao.jin@linux.intel.com>
    Cc: Jiri Olsa <jolsa@kernel.org>
    Cc: Martin Liška <mliska@suse.cz>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Ravi Bangoria <ravi.bangoria@linux.vnet.ibm.com>
    Cc: Thomas Richter <tmricht@linux.vnet.ibm.com>
    Cc: Wang Nan <wangnan0@huawei.com>
    Fixes: b01141f4f59c ("perf annotate: Initialize the priv are in symbol__new()")
    Link: https://lkml.kernel.org/n/tip-ogppdtpzfax7y1h6gjdv5s6u@git.kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7bb0c4bd79ab318225f4dfd9e2394c998a6bd566
Author: Jakub Kicinski <kuba@kernel.org>
Date:   Wed Apr 11 16:47:35 2018 -0700

    nfp: ignore signals when communicating with management FW
    
    [ Upstream commit 5496295aefe86995e41398b0f76de601308fc3f5 ]
    
    We currently allow signals to interrupt the wait for management FW
    commands.  Exiting the wait should not cause trouble, the FW will
    just finish executing the command in the background and new commands
    will wait for the old one to finish.
    
    However, this may not be what users expect (Ctrl-C not actually stopping
    the command).  Moreover some systems routinely request link information
    with signals pending (Ubuntu 14.04 runs a landscape-sysinfo python tool
    from MOTD) worrying users with errors like these:
    
    nfp 0000:04:00.0: nfp_nsp: Error -512 waiting for code 0x0007 to start
    nfp 0000:04:00.0: nfp: reading port table failed -512
    
    Make the wait for management FW responses non-interruptible.
    
    Fixes: 1a64821c6af7 ("nfp: add support for service processor access")
    Signed-off-by: Jakub Kicinski <jakub.kicinski@netronome.com>
    Reviewed-by: Dirk van der Merwe <dirk.vandermerwe@netronome.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d96da2acac5dcf3d8187794b5ef86481ddcf2791
Author: Sinan Kaya <okaya@codeaurora.org>
Date:   Tue Apr 3 08:55:03 2018 -0400

    MIPS: io: Prevent compiler reordering writeX()
    
    [ Upstream commit f6b7aeee8f167409195fbf1364d02988fecad1d0 ]
    
    writeX() has strong ordering semantics with respect to memory updates.
    In the absence of a write barrier or a compiler barrier, the compiler
    can reorder register and memory update instructions. This breaks the
    writeX() API.
    
    Signed-off-by: Sinan Kaya <okaya@codeaurora.org>
    Cc: Arnd Bergmann <arnd@arndb.de>
    Cc: Ralf Baechle <ralf@linux-mips.org>
    Cc: Paul Burton <paul.burton@mips.com>
    Cc: linux-mips@linux-mips.org
    Patchwork: https://patchwork.linux-mips.org/patch/18997/
    [jhogan@kernel.org: Tidy commit message]
    Signed-off-by: James Hogan <jhogan@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit df5524e5483b6a29c011721131a510fae3ce0f45
Author: Krish Sadhukhan <krish.sadhukhan@oracle.com>
Date:   Wed Apr 11 01:10:16 2018 -0400

    x86: Add check for APIC access address for vmentry of L2 guests
    
    [ Upstream commit f0f4cf5b306620282db0c59ff963012e1973e025 ]
    
    According to the sub-section titled 'VM-Execution Control Fields' in the
    section titled 'Basic VM-Entry Checks' in Intel SDM vol. 3C, the following
    vmentry check must be enforced:
    
        If the 'virtualize APIC-accesses' VM-execution control is 1, the
        APIC-access address must satisfy the following checks:
    
            - Bits 11:0 of the address must be 0.
            - The address should not set any bits beyond the processor's
              physical-address width.
    
    This patch adds the necessary check to conform to this rule. If the check
    fails, we cause the L2 VMENTRY to fail which is what the associated unit
    test (following patch) expects.
    
    Reviewed-by: Mihai Carabas <mihai.carabas@oracle.com>
    Reviewed-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
    Reviewed-by: Jim Mattson <jmattson@google.com>
    Reviewed-by: Wanpeng Li <wanpengli@tencent.com>
    Signed-off-by: Krish Sadhukhan <krish.sadhukhan@oracle.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9b78e9ddc47ac2da31db600065ea6577dc9f8170
Author: hu huajun <huhuajun@linux.alibaba.com>
Date:   Wed Apr 11 15:16:40 2018 +0800

    KVM: X86: fix incorrect reference of trace_kvm_pi_irte_update
    
    [ Upstream commit 2698d82e519413c6ad287e6f14b29e0373ed37f8 ]
    
    In arch/x86/kvm/trace.h, this function is declared as host_irq the
    first input, and vcpu_id the second, instead of otherwise.
    
    Signed-off-by: hu huajun <huhuajun@linux.alibaba.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 176ebf4df9710fefe751d6565c35da5a45aeece3
Author: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
Date:   Fri Apr 6 15:36:11 2018 -0700

    Input: synaptics-rmi4 - fix an unchecked out of memory error path
    
    [ Upstream commit 839c42273617787318da7baf6151d553108f5e17 ]
    
    When extending the rmi_spi buffers, we must check that no out of memory
    error occurs, otherwise we may access data above the currently allocated
    memory.
    
    Propagate the error code returned by 'rmi_spi_manage_pools()' instead.
    
    Signed-off-by: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
    Reviewed-by: Andrew Duggan <aduggan@synaptics.com>
    Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 65783949c813d0cad88b6a30f47737e8dfc00c86
Author: Anson Huang <Anson.Huang@nxp.com>
Date:   Wed Mar 28 11:22:37 2018 +0800

    clocksource/drivers/imx-tpm: Correct some registers operation flow
    
    [ Upstream commit 506a7be93ff773d5d4cf75a59f342865605b4910 ]
    
    According to i.MX7ULP reference manual, TPM_SC_CPWMS can ONLY be written when
    counter is disabled, TPM_SC_TOF is write-1-clear, TPM_C0SC_CHF is also
    write-1-clear, correct these registers initialization flow;
    
    Signed-off-by: Anson Huang <Anson.Huang@nxp.com>
    Signed-off-by: Daniel Lezcano <daniel.lezcano@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
