commit 4201a586f1fa63de5a965a1ebc3b99e0e1a4912c
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Tue Nov 27 16:10:52 2018 +0100

    Linux 4.14.84

commit 3c7f1671af5f1bef6fac4e9ad7416e7a5a4ed295
Author: Ilya Dryomov <idryomov@gmail.com>
Date:   Thu Nov 8 15:55:37 2018 +0100

    libceph: fall back to sendmsg for slab pages
    
    commit 7e241f647dc7087a0401418a187f3f5b527cc690 upstream.
    
    skb_can_coalesce() allows coalescing neighboring slab objects into
    a single frag:
    
      return page == skb_frag_page(frag) &&
             off == frag->page_offset + skb_frag_size(frag);
    
    ceph_tcp_sendpage() can be handed slab pages.  One example of this is
    XFS: it passes down sector sized slab objects for its metadata I/O.  If
    the kernel client is co-located on the OSD node, the skb may go through
    loopback and pop on the receive side with the exact same set of frags.
    When tcp_recvmsg() attempts to copy out such a frag, hardened usercopy
    complains because the size exceeds the object's allocated size:
    
      usercopy: kernel memory exposure attempt detected from ffff9ba917f20a00 (kmalloc-512) (1024 bytes)
    
    Although skb_can_coalesce() could be taught to return false if the
    resulting frag would cross a slab object boundary, we already have
    a fallback for non-refcounted pages.  Utilize it for slab pages too.
    
    Cc: stable@vger.kernel.org # 4.8+
    Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 540f89376ba2949f53ed6f057fea321be848cd43
Author: Eric Biggers <ebiggers@google.com>
Date:   Wed Nov 14 13:55:09 2018 -0800

    HID: uhid: forbid UHID_CREATE under KERNEL_DS or elevated privileges
    
    commit 8c01db7619f07c85c5cd81ec5eb83608b56c88f5 upstream.
    
    When a UHID_CREATE command is written to the uhid char device, a
    copy_from_user() is done from a user pointer embedded in the command.
    When the address limit is KERNEL_DS, e.g. as is the case during
    sys_sendfile(), this can read from kernel memory.  Alternatively,
    information can be leaked from a setuid binary that is tricked to write
    to the file descriptor.  Therefore, forbid UHID_CREATE in these cases.
    
    No other commands in uhid_char_write() are affected by this bug and
    UHID_CREATE is marked as "obsolete", so apply the restriction to
    UHID_CREATE only rather than to uhid_char_write() entirely.
    
    Thanks to Dmitry Vyukov for adding uhid definitions to syzkaller and to
    Jann Horn for commit 9da3f2b740544 ("x86/fault: BUG() when uaccess
    helpers fault on kernel addresses"), allowing this bug to be found.
    
    Reported-by: syzbot+72473edc9bf4eb1c6556@syzkaller.appspotmail.com
    Fixes: d365c6cfd337 ("HID: uhid: add UHID_CREATE and UHID_DESTROY events")
    Cc: <stable@vger.kernel.org> # v3.6+
    Cc: Jann Horn <jannh@google.com>
    Cc: Andy Lutomirski <luto@kernel.org>
    Signed-off-by: Eric Biggers <ebiggers@google.com>
    Reviewed-by: Jann Horn <jannh@google.com>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3cf1a2b4e0b3eae21abd25d535142e7b6ac3209c
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Mon Nov 19 19:06:01 2018 +0100

    ACPI / platform: Add SMB0001 HID to forbidden_id_list
    
    commit 2bbb5fa37475d7aa5fa62f34db1623f3da2dfdfa upstream.
    
    Many HP AMD based laptops contain an SMB0001 device like this:
    
    Device (SMBD)
    {
        Name (_HID, "SMB0001")  // _HID: Hardware ID
        Name (_CRS, ResourceTemplate ()  // _CRS: Current Resource Settings
        {
            IO (Decode16,
                0x0B20,             // Range Minimum
                0x0B20,             // Range Maximum
                0x20,               // Alignment
                0x20,               // Length
                )
            IRQ (Level, ActiveLow, Shared, )
                {7}
        })
    }
    
    The legacy style IRQ resource here causes acpi_dev_get_irqresource() to
    be called with legacy=true and this message to show in dmesg:
    ACPI: IRQ 7 override to edge, high
    
    This causes issues when later on the AMD0030 GPIO device gets enumerated:
    
    Device (GPIO)
    {
        Name (_HID, "AMDI0030")  // _HID: Hardware ID
        Name (_CID, "AMDI0030")  // _CID: Compatible ID
        Name (_UID, Zero)  // _UID: Unique ID
        Method (_CRS, 0, NotSerialized)  // _CRS: Current Resource Settings
        {
            Name (RBUF, ResourceTemplate ()
            {
                Interrupt (ResourceConsumer, Level, ActiveLow, Shared, ,, )
                {
                    0x00000007,
                }
                Memory32Fixed (ReadWrite,
                    0xFED81500,         // Address Base
                    0x00000400,         // Address Length
                    )
            })
            Return (RBUF) /* \_SB_.GPIO._CRS.RBUF */
        }
    }
    
    Now acpi_dev_get_irqresource() gets called with legacy=false, but because
    of the earlier override of the trigger-type acpi_register_gsi() returns
    -EBUSY (because we try to register the same interrupt with a different
    trigger-type) and we end up setting IORESOURCE_DISABLED in the flags.
    
    The setting of IORESOURCE_DISABLED causes platform_get_irq() to call
    acpi_irq_get() which is not implemented on x86 and returns -EINVAL.
    resulting in the following in dmesg:
    
    amd_gpio AMDI0030:00: Failed to get gpio IRQ: -22
    amd_gpio: probe of AMDI0030:00 failed with error -22
    
    The SMB0001 is a "virtual" device in the sense that the only way the OS
    interacts with it is through calling a couple of methods to do SMBus
    transfers. As such it is weird that it has IO and IRQ resources at all,
    because the driver for it is not expected to ever access the hardware
    directly.
    
    The Linux driver for the SMB0001 device directly binds to the acpi_device
    through the acpi_bus, so we do not need to instantiate a platform_device
    for this ACPI device. This commit adds the SMB0001 HID to the
    forbidden_id_list, avoiding the instantiating of a platform_device for it.
    Not instantiating a platform_device means we will no longer call
    acpi_dev_get_irqresource() for the legacy IRQ resource fixing the probe of
    the AMDI0030 device failing.
    
    BugLink: https://bugzilla.redhat.com/show_bug.cgi?id=1644013
    BugLink: https://bugzilla.kernel.org/show_bug.cgi?id=198715
    BugLink: https://bugzilla.kernel.org/show_bug.cgi?id=199523
    Reported-by: Lukas Kahnert <openproggerfreak@gmail.com>
    Tested-by: Marc <suaefar@googlemail.com>
    Cc: All applicable <stable@vger.kernel.org>
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 16c233b9b6c8758207f0079737bf36bda9cd9094
Author: Gustavo A. R. Silva <gustavo@embeddedor.com>
Date:   Tue Oct 16 12:59:44 2018 +0200

    drivers/misc/sgi-gru: fix Spectre v1 vulnerability
    
    commit fee05f455ceb5c670cbe48e2f9454ebc4a388554 upstream.
    
    req.gid can be indirectly controlled by user-space, hence leading to
    a potential exploitation of the Spectre variant 1 vulnerability.
    
    This issue was detected with the help of Smatch:
    
    vers/misc/sgi-gru/grukdump.c:200 gru_dump_chiplet_request() warn:
    potential spectre issue 'gru_base' [w]
    
    Fix this by sanitizing req.gid before calling macro GID_TO_GRU, which
    uses it to index gru_base.
    
    Notice that given that speculation windows are large, the policy is
    to kill the speculation on the first load and not worry if it can be
    completed with a dependent load/store [1].
    
    [1] https://marc.info/?l=linux-kernel&m=152449131114778&w=2
    
    Cc: stable@vger.kernel.org
    Signed-off-by: Gustavo A. R. Silva <gustavo@embeddedor.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fb37c765e28d778f53c66c7727254f8ac2f047ea
Author: Mattias Jacobsson <2pi@mok.nu>
Date:   Sun Oct 21 11:25:37 2018 +0200

    USB: misc: appledisplay: add 20" Apple Cinema Display
    
    commit f6501f49199097b99e4e263644d88c90d1ec1060 upstream.
    
    Add another Apple Cinema Display to the list of supported displays
    
    Signed-off-by: Mattias Jacobsson <2pi@mok.nu>
    Cc: stable <stable@vger.kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 939936e6015d007f6ef2e344f5e2ec809074c987
Author: Nathan Chancellor <natechancellor@gmail.com>
Date:   Wed Oct 17 10:09:02 2018 -0700

    misc: atmel-ssc: Fix section annotation on atmel_ssc_get_driver_data
    
    commit 7c97301285b62a41d6bceded7d964085fc8cc50f upstream.
    
    After building the kernel with Clang, the following section mismatch
    warning appears:
    
    WARNING: vmlinux.o(.text+0x3bf19a6): Section mismatch in reference from
    the function ssc_probe() to the function
    .init.text:atmel_ssc_get_driver_data()
    The function ssc_probe() references
    the function __init atmel_ssc_get_driver_data().
    This is often because ssc_probe lacks a __init
    annotation or the annotation of atmel_ssc_get_driver_data is wrong.
    
    Remove __init from atmel_ssc_get_driver_data to get rid of the mismatch.
    
    Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
    Cc: stable <stable@vger.kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 041fa1f61997142e52331eee0eba84ffdbf85bd2
Author: Emmanuel Pescosta <emmanuelpescosta099@gmail.com>
Date:   Fri Oct 26 14:48:09 2018 +0200

    usb: quirks: Add delay-init quirk for Corsair K70 LUX RGB
    
    commit a77112577667cbda7c6292c52d909636aef31fd9 upstream.
    
    Following on from this patch: https://lkml.org/lkml/2017/11/3/516,
    Corsair K70 LUX RGB keyboards also require the DELAY_INIT quirk to
    start correctly at boot.
    
    Dmesg output:
    usb 1-6: string descriptor 0 read error: -110
    usb 1-6: New USB device found, idVendor=1b1c, idProduct=1b33
    usb 1-6: New USB device strings: Mfr=1, Product=2, SerialNumber=3
    usb 1-6: can't set config #1, error -110
    
    Signed-off-by: Emmanuel Pescosta <emmanuelpescosta099@gmail.com>
    Cc: stable <stable@vger.kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d7385bcf1887642ac0f0c7c6b82efc0d3c3c5f45
Author: Kai-Heng Feng <kai.heng.feng@canonical.com>
Date:   Fri Oct 26 13:33:15 2018 +0800

    USB: quirks: Add no-lpm quirk for Raydium touchscreens
    
    commit deefd24228a172d1b27d4a9adbfd2cdacd60ae64 upstream.
    
    Raydium USB touchscreen fails to set config if LPM is enabled:
    [    2.030658] usb 1-8: New USB device found, idVendor=2386, idProduct=3119
    [    2.030659] usb 1-8: New USB device strings: Mfr=1, Product=2, SerialNumber=0
    [    2.030660] usb 1-8: Product: Raydium Touch System
    [    2.030661] usb 1-8: Manufacturer: Raydium Corporation
    [    7.132209] usb 1-8: can't set config #1, error -110
    
    Same behavior can be observed on 2386:3114.
    
    Raydium claims the touchscreen supports LPM under Windows, so I used
    Microsoft USB Test Tools (MUTT) [1] to check its LPM status. MUTT shows
    that the LPM doesn't work under Windows, either. So let's just disable LPM
    for Raydium touchscreens.
    
    [1] https://docs.microsoft.com/en-us/windows-hardware/drivers/usbcon/usb-test-tools
    
    Signed-off-by: Kai-Heng Feng <kai.heng.feng@canonical.com>
    Cc: stable <stable@vger.kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 578f05a757bf76e828fe244994436947187bcfe3
Author: Maarten Jacobs <maarten256@outlook.com>
Date:   Mon Nov 19 23:18:49 2018 +0000

    usb: cdc-acm: add entry for Hiro (Conexant) modem
    
    commit 63529eaa6164ef7ab4b907b25ac3648177e5e78f upstream.
    
    The cdc-acm kernel module currently does not support the Hiro (Conexant)
    H05228 USB modem. The patch below adds the device specific information:
            idVendor        0x0572
            idProduct       0x1349
    
    Signed-off-by: Maarten Jacobs <maarten256@outlook.com>
    Acked-by: Oliver Neukum <oneukum@suse.com>
    Cc: stable <stable@vger.kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f6a6ae4e0f345aa481535bfe2046cd33f4dc37b8
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Fri Oct 26 10:19:51 2018 +0300

    uio: Fix an Oops on load
    
    commit 432798195bbce1f8cd33d1c0284d0538835e25fb upstream.
    
    I was trying to solve a double free but I introduced a more serious
    NULL dereference bug.  The problem is that if there is an IRQ which
    triggers immediately, then we need "info->uio_dev" but it's not set yet.
    
    This patch puts the original initialization back to how it was and just
    sets info->uio_dev to NULL on the error path so it should solve both
    the Oops and the double free.
    
    Fixes: f019f07ecf6a ("uio: potential double frees if __uio_register_device() fails")
    Reported-by: Mathias Thore <Mathias.Thore@infinera.com>
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Cc: stable <stable@vger.kernel.org>
    Tested-by: Mathias Thore <Mathias.Thore@infinera.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2fc77700daa9f2faf7e61f46c1d784fd85867dfc
Author: Aaro Koskinen <aaro.koskinen@iki.fi>
Date:   Sun Nov 11 00:06:12 2018 +0200

    MIPS: OCTEON: cavium_octeon_defconfig: re-enable OCTEON USB driver
    
    commit 82fba2df7f7c019627f24c5036dc99f41731d770 upstream.
    
    Re-enable OCTEON USB driver which is needed on older hardware
    (e.g. EdgeRouter Lite) for mass storage etc. This got accidentally
    deleted when config options were changed for OCTEON2/3 USB.
    
    Signed-off-by: Aaro Koskinen <aaro.koskinen@iki.fi>
    Signed-off-by: Paul Burton <paul.burton@mips.com>
    Fixes: f922bc0ad08b ("MIPS: Octeon: cavium_octeon_defconfig: Enable more drivers")
    Patchwork: https://patchwork.linux-mips.org/patch/21077/
    Cc: Ralf Baechle <ralf@linux-mips.org>
    Cc: James Hogan <jhogan@kernel.org>
    Cc: linux-mips@linux-mips.org
    Cc: linux-kernel@vger.kernel.org
    Cc: stable@vger.kernel.org # 4.14+
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 817266cb8d45b74a695fb8a27e12b17cf087d7b1
Author: Sakari Ailus <sakari.ailus@linux.intel.com>
Date:   Mon Nov 5 09:35:44 2018 -0500

    media: v4l: event: Add subscription to list before calling "add" operation
    
    commit 92539d3eda2c090b382699bbb896d4b54e9bdece upstream.
    
    Patch ad608fbcf166 changed how events were subscribed to address an issue
    elsewhere. As a side effect of that change, the "add" callback was called
    before the event subscription was added to the list of subscribed events,
    causing the first event queued by the add callback (and possibly other
    events arriving soon afterwards) to be lost.
    
    Fix this by adding the subscription to the list before calling the "add"
    callback, and clean up afterwards if that fails.
    
    Fixes: ad608fbcf166 ("media: v4l: event: Prevent freeing event subscriptions while accessed")
    
    Reported-by: Dave Stevenson <dave.stevenson@raspberrypi.org>
    Signed-off-by: Sakari Ailus <sakari.ailus@linux.intel.com>
    Tested-by: Dave Stevenson <dave.stevenson@raspberrypi.org>
    Reviewed-by: Hans Verkuil <hans.verkuil@cisco.com>
    Tested-by: Hans Verkuil <hans.verkuil@cisco.com>
    Cc: stable@vger.kernel.org (for 4.14 and up)
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a17989cb9bb03c75bb57dddc0f044100fd4d856e
Author: Kirill A. Shutemov <kirill.shutemov@linux.intel.com>
Date:   Fri Oct 26 15:28:55 2018 +0300

    x86/ldt: Unmap PTEs for the slot before freeing LDT pages
    
    commit a0e6e0831c516860fc7f9be1db6c081fe902ebcf upstream
    
    modify_ldt(2) leaves the old LDT mapped after switching over to the new
    one. The old LDT gets freed and the pages can be re-used.
    
    Leaving the mapping in place can have security implications. The mapping is
    present in the userspace page tables and Meltdown-like attacks can read
    these freed and possibly reused pages.
    
    It's relatively simple to fix: unmap the old LDT and flush TLB before
    freeing the old LDT memory.
    
    This further allows to avoid flushing the TLB in map_ldt_struct() as the
    slot is unmapped and flushed by unmap_ldt_struct() or has never been mapped
    at all.
    
    [ tglx: Massaged changelog and removed the needless line breaks ]
    
    Fixes: f55f0501cbf6 ("x86/pti: Put the LDT in its own PGD if PTI is on")
    Signed-off-by: Kirill A. Shutemov <kirill.shutemov@linux.intel.com>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Cc: bp@alien8.de
    Cc: hpa@zytor.com
    Cc: dave.hansen@linux.intel.com
    Cc: luto@kernel.org
    Cc: peterz@infradead.org
    Cc: boris.ostrovsky@oracle.com
    Cc: jgross@suse.com
    Cc: bhe@redhat.com
    Cc: willy@infradead.org
    Cc: linux-mm@kvack.org
    Cc: stable@vger.kernel.org
    Link: https://lkml.kernel.org/r/20181026122856.66224-3-kirill.shutemov@linux.intel.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d412ab7cfc0de3c01befb5d32746eaf512929bde
Author: Kirill A. Shutemov <kirill.shutemov@linux.intel.com>
Date:   Fri Oct 26 15:28:54 2018 +0300

    x86/mm: Move LDT remap out of KASLR region on 5-level paging
    
    commit d52888aa2753e3063a9d3a0c9f72f94aa9809c15 upstream
    
    On 5-level paging the LDT remap area is placed in the middle of the KASLR
    randomization region and it can overlap with the direct mapping, the
    vmalloc or the vmap area.
    
    The LDT mapping is per mm, so it cannot be moved into the P4D page table
    next to the CPU_ENTRY_AREA without complicating PGD table allocation for
    5-level paging.
    
    The 4 PGD slot gap just before the direct mapping is reserved for
    hypervisors, so it cannot be used.
    
    Move the direct mapping one slot deeper and use the resulting gap for the
    LDT remap area. The resulting layout is the same for 4 and 5 level paging.
    
    [ tglx: Massaged changelog ]
    
    Fixes: f55f0501cbf6 ("x86/pti: Put the LDT in its own PGD if PTI is on")
    Signed-off-by: Kirill A. Shutemov <kirill.shutemov@linux.intel.com>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Reviewed-by: Andy Lutomirski <luto@kernel.org>
    Cc: bp@alien8.de
    Cc: hpa@zytor.com
    Cc: dave.hansen@linux.intel.com
    Cc: peterz@infradead.org
    Cc: boris.ostrovsky@oracle.com
    Cc: jgross@suse.com
    Cc: bhe@redhat.com
    Cc: willy@infradead.org
    Cc: linux-mm@kvack.org
    Cc: stable@vger.kernel.org
    Link: https://lkml.kernel.org/r/20181026122856.66224-2-kirill.shutemov@linux.intel.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 09917457494163dec35a74745ff04184385c8d32
Author: Adrian Hunter <adrian.hunter@intel.com>
Date:   Wed Nov 21 15:52:47 2018 +0200

    perf test code-reading: Fix perf_env setup for PTI entry trampolines
    
    commit f6c66d73bb8192d357bb5fb8cd5826920f811d8c upstream.
    
    The "Object code reading" test will not create maps for the PTI entry
    trampolines unless the machine environment exists to show that the arch is
    x86_64.
    
    Signed-off-by: Adrian Hunter <adrian.hunter@intel.com>
    Reported-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Cc: Jiri Olsa <jolsa@redhat.com>
    Link: http://lkml.kernel.org/r/1528183800-21577-1-git-send-email-adrian.hunter@intel.com
    [ split from a larger patch ]
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit ce41e5fc90d4039907046e10b8d8dd7206ec36a4
Author: Adrian Hunter <adrian.hunter@intel.com>
Date:   Wed Nov 21 15:52:46 2018 +0200

    perf machine: Workaround missing maps for x86 PTI entry trampolines
    
    commit 4d99e4136580d178e3523281a820be17bf814bf8 upstream.
    
    On x86_64 the PTI entry trampolines are not in the kernel map created by
    perf tools. That results in the addresses having no symbols and prevents
    annotation.  It also causes Intel PT to have decoding errors at the
    trampoline addresses.
    
    Workaround that by creating maps for the trampolines.
    
    At present the kernel does not export information revealing where the
    trampolines are.  Until that happens, the addresses are hardcoded.
    
    Signed-off-by: Adrian Hunter <adrian.hunter@intel.com>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Andi Kleen <ak@linux.intel.com>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: H. Peter Anvin <hpa@zytor.com>
    Cc: Jiri Olsa <jolsa@redhat.com>
    Cc: Joerg Roedel <joro@8bytes.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: x86@kernel.org
    Link: http://lkml.kernel.org/r/1526986485-6562-6-git-send-email-adrian.hunter@intel.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5d390059eab4bc9b3bfcba01a214ab873514f578
Author: Adrian Hunter <adrian.hunter@intel.com>
Date:   Wed Nov 21 15:52:45 2018 +0200

    perf machine: Add nr_cpus_avail()
    
    commit 9cecca325ea879c84fcd31a5e609a514c1a1dbd1 upstream.
    
    Add a function to return the number of the machine's available CPUs.
    
    Signed-off-by: Adrian Hunter <adrian.hunter@intel.com>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Andi Kleen <ak@linux.intel.com>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: H. Peter Anvin <hpa@zytor.com>
    Cc: Jiri Olsa <jolsa@redhat.com>
    Cc: Joerg Roedel <joro@8bytes.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: x86@kernel.org
    Link: http://lkml.kernel.org/r/1526986485-6562-5-git-send-email-adrian.hunter@intel.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4edc059bac38f8cb59a8e539fb36fe0b8d19c55e
Author: Adrian Hunter <adrian.hunter@intel.com>
Date:   Wed Nov 21 15:52:44 2018 +0200

    perf tools: Fix kernel_start for PTI on x86
    
    commit 19422a9f2a3be7f3a046285ffae4cbb571aa853a upstream.
    
    On x86_64, PTI entry trampolines are less than the start of kernel text,
    but still above 2^63. So leave kernel_start = 1ULL << 63 for x86_64.
    
    Signed-off-by: Adrian Hunter <adrian.hunter@intel.com>
    Tested-by: Jiri Olsa <jolsa@kernel.org>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Andi Kleen <ak@linux.intel.com>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: H. Peter Anvin <hpa@zytor.com>
    Cc: Joerg Roedel <joro@8bytes.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: x86@kernel.org
    Link: http://lkml.kernel.org/r/1526548928-20790-7-git-send-email-adrian.hunter@intel.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit e404a6294a31b2b68cecdd2e89d61cc6ed87dddd
Author: Adrian Hunter <adrian.hunter@intel.com>
Date:   Wed Nov 21 15:52:43 2018 +0200

    perf machine: Add machine__is() to identify machine arch
    
    commit dbbd34a666ee117d0e39e71a47f38f02c4a5c698 upstream.
    
    Add a function to identify the machine architecture.
    
    Signed-off-by: Adrian Hunter <adrian.hunter@intel.com>
    Tested-by: Jiri Olsa <jolsa@kernel.org>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Andi Kleen <ak@linux.intel.com>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: H. Peter Anvin <hpa@zytor.com>
    Cc: Joerg Roedel <joro@8bytes.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: x86@kernel.org
    Link: http://lkml.kernel.org/r/1526548928-20790-6-git-send-email-adrian.hunter@intel.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 8c209c38d8fa633bfd519476f6b616ee1bc8eb06
Author: Mika Westerberg <mika.westerberg@linux.intel.com>
Date:   Tue May 22 14:16:50 2018 +0300

    ACPI / watchdog: Prefer iTCO_wdt always when WDAT table uses RTC SRAM
    
    [ Upstream commit 5a802a7a285c8877ca872e44eeb0f06afcb5212f ]
    
    After we added quirk for Lenovo Z50-70 it turns out there are at least
    two more systems where WDAT table includes instructions accessing RTC
    SRAM. Instead of quirking each system separately, look for such
    instructions in the table and automatically prefer iTCO_wdt if found.
    
    Link: https://bugzilla.kernel.org/show_bug.cgi?id=199033
    Reported-by: Arnold Guy <aurnoldg@gmail.com>
    Reported-by: Alois Nespor <nespor@fssp.cz>
    Reported-by: Yury Pakin <zxwarior@gmail.com>
    Reported-by: Ihor Chyhin <ihorchyhin@ukr.net>
    Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
    Acked-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 26eff850549b52e43d0bc61f4682952fe2da293d
Author: YueHaibing <yuehaibing@huawei.com>
Date:   Thu Nov 8 02:04:57 2018 +0000

    SUNRPC: drop pointless static qualifier in xdr_get_next_encode_buffer()
    
    [ Upstream commit 025911a5f4e36955498ed50806ad1b02f0f76288 ]
    
    There is no need to have the '__be32 *p' variable static since new value
    always be assigned before use it.
    
    Signed-off-by: YueHaibing <yuehaibing@huawei.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: J. Bruce Fields <bfields@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c887029c11d0c2bc14da9eb02704669cebab89a9
Author: Minchan Kim <minchan@kernel.org>
Date:   Fri Nov 23 15:25:50 2018 +0900

    zram: close udev startup race condition as default groups
    
    commit fef912bf860e upstream.
    commit 98af4d4df889 upstream.
    
    I got a report from Howard Chen that he saw zram and sysfs race(ie,
    zram block device file is created but sysfs for it isn't yet)
    when he tried to create new zram devices via hotadd knob.
    
    v4.20 kernel fixes it by [1, 2] but it's too large size to merge
    into -stable so this patch fixes the problem by registering defualt
    group by Greg KH's approach[3].
    
    This patch should be applied to every stable tree [3.16+] currently
    existing from kernel.org because the problem was introduced at 2.6.37
    by [4].
    
    [1] fef912bf860e, block: genhd: add 'groups' argument to device_add_disk
    [2] 98af4d4df889, zram: register default groups with device_add_disk()
    [3] http://kroah.com/log/blog/2013/06/26/how-to-create-a-sysfs-file-correctly/
    [4] 33863c21e69e9, Staging: zram: Replace ioctls with sysfs interface
    
    Cc: Sergey Senozhatsky <sergey.senozhatsky@gmail.com>
    Cc: Hannes Reinecke <hare@suse.com>
    Tested-by: Howard Chen <howardsoc@google.com>
    Signed-off-by: Minchan Kim <minchan@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 47ff76ee9c9c938531ec97b7b4a74804a10f04fc
Author: Thor Thayer <thor.thayer@linux.intel.com>
Date:   Thu Nov 8 11:42:14 2018 -0600

    net: stmmac: Fix RX packet size > 8191
    
    [ Upstream commit 8137b6ef0ce469154e5cf19f8e7fe04d9a72ac5e ]
    
    Ping problems with packets > 8191 as shown:
    
    PING 192.168.1.99 (192.168.1.99) 8150(8178) bytes of data.
    8158 bytes from 192.168.1.99: icmp_seq=1 ttl=64 time=0.669 ms
    wrong data byte 8144 should be 0xd0 but was 0x0
    16    10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f
          20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f
    %< ---------------snip--------------------------------------
    8112  b0 b1 b2 b3 b4 b5 b6 b7 b8 b9 ba bb bc bd be bf
          c0 c1 c2 c3 c4 c5 c6 c7 c8 c9 ca cb cc cd ce cf
    8144  0 0 0 0 d0 d1
          ^^^^^^^
    Notice the 4 bytes of 0 before the expected byte of d0.
    
    Databook notes that the RX buffer must be a multiple of 4/8/16
    bytes [1].
    
    Update the DMA Buffer size define to 8188 instead of 8192. Remove
    the -1 from the RX buffer size allocations and use the new
    DMA Buffer size directly.
    
    [1] Synopsys DesignWare Cores Ethernet MAC Universal v3.70a
        [section 8.4.2 - Table 8-24]
    
    Tested on SoCFPGA Stratix10 with ping sweep from 100 to 8300 byte packets.
    
    Fixes: 286a83721720 ("stmmac: add CHAINED descriptor mode support (V4)")
    Suggested-by: Jose Abreu <jose.abreu@synopsys.com>
    Signed-off-by: Thor Thayer <thor.thayer@linux.intel.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit fe2c4df2692de3c724ac8720d4479cbe16d89814
Author: Sagiv Ozeri <sagiv.ozeri@cavium.com>
Date:   Thu Nov 8 16:46:11 2018 +0200

    qed: Fix potential memory corruption
    
    [ Upstream commit fa5c448d98f0df660bfcad3dd5facc027ef84cd3 ]
    
    A stuck ramrod should be deleted from the completion_pending list,
    otherwise it will be added again in the future and corrupt the list.
    
    Return error value to inform that ramrod is stuck and should be deleted.
    
    Signed-off-by: Sagiv Ozeri <sagiv.ozeri@cavium.com>
    Signed-off-by: Denis Bolotin <denis.bolotin@cavium.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 082810cb7f21c52dbe4c15f247e87ad22b88bbb8
Author: Denis Bolotin <denis.bolotin@cavium.com>
Date:   Thu Nov 8 16:46:09 2018 +0200

    qed: Fix blocking/unlimited SPQ entries leak
    
    [ Upstream commit 2632f22ebd08da249c2017962a199a0cfb2324bf ]
    
    When there are no SPQ entries left in the free_pool, new entries are
    allocated and are added to the unlimited list. When an entry in the pool
    is available, the content is copied from the original entry, and the new
    entry is sent to the device. qed_spq_post() is not aware of that, so the
    additional entry is stored in the original entry as p_post_ent, which can
    later be returned to the pool.
    
    Signed-off-by: Denis Bolotin <denis.bolotin@cavium.com>
    Signed-off-by: Michal Kalderon <michal.kalderon@cavium.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 484ef227384f88c0b52e9dd43529eccf7c4025da
Author: Denis Bolotin <denis.bolotin@cavium.com>
Date:   Thu Nov 8 16:46:08 2018 +0200

    qed: Fix memory/entry leak in qed_init_sp_request()
    
    [ Upstream commit 39477551df940ddb1339203817de04f5caaacf7a ]
    
    Free the allocated SPQ entry or return the acquired SPQ entry to the free
    list in error flows.
    
    Signed-off-by: Denis Bolotin <denis.bolotin@cavium.com>
    Signed-off-by: Michal Kalderon <michal.kalderon@cavium.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit eddf9365687f829beeca47a3d0cfcdf6252e46a1
Author: Jacob Keller <jacob.e.keller@intel.com>
Date:   Mon Oct 29 10:52:42 2018 -0700

    i40e: restore NETIF_F_GSO_IPXIP[46] to netdev features
    
    [ Upstream commit ba766b8b99c30ad3c55ed8cf224d1185ecff1476 ]
    
    Since commit bacd75cfac8a ("i40e/i40evf: Add capability exchange for
    outer checksum", 2017-04-06) the i40e driver has not reported support
    for IP-in-IP offloads. This likely occurred due to a bad rebase, as the
    commit extracts hw_enc_features into its own variable. As part of this
    change, it dropped the NETIF_F_FSO_IPXIP flags from the
    netdev->hw_enc_features. This was unfortunately not caught during code
    review.
    
    Fix this by adding back the missing feature flags.
    
    For reference, NETIF_F_GSO_IPXIP4 was added in commit 7e13318daa4a
    ("net: define gso types for IPx over IPv4 and IPv6", 2016-05-20),
    replacing NETIF_F_GSO_IPIP and NETIF_F_GSO_SIT.
    
    NETIF_F_GSO_IPXIP6 was added in commit bf2d1df39502 ("intel: Add support
    for IPv6 IP-in-IP offload", 2016-05-20).
    
    Signed-off-by: Jacob Keller <jacob.e.keller@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit fc88b3abe23fe3d4cb2e2b1f3f7036e7f68889fe
Author: Gustavo Romero <gromero@linux.vnet.ibm.com>
Date:   Thu Nov 1 20:13:21 2018 -0400

    perf tools: Fix undefined symbol scnprintf in libperf-jvmti.so
    
    [ Upstream commit 6ac2226229d931153331a93d90655a3de05b9290 ]
    
    Currently jvmti agent can not be used because function scnprintf is not
    present in the agent libperf-jvmti.so. As a result the JVM when using
    such agent to record JITed code profiling information will fail on
    looking up scnprintf:
    
      java: symbol lookup error: lib/libperf-jvmti.so: undefined symbol: scnprintf
    
    This commit fixes that by reverting to the use of snprintf, that can be
    looked up, instead of scnprintf, adding a proper check for the returned
    value in order to print a better error message when the jitdump file
    pathname is too long. Checking the returned value also helps to comply
    with some recent gcc versions, like gcc8, which will fail due to
    truncated writing checks related to the -Werror=format-truncation= flag.
    
    Signed-off-by: Gustavo Romero <gromero@linux.vnet.ibm.com>
    Acked-by: Jiri Olsa <jolsa@kernel.org>
    LPU-Reference: 1541117601-18937-2-git-send-email-gromero@linux.vnet.ibm.com
    Link: https://lkml.kernel.org/n/tip-mvpxxxy7wnzaj74cq75muw3f@git.kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit ef8d2a5d990af5d658aafd37b41e29782b690bff
Author: Valentin Schneider <valentin.schneider@arm.com>
Date:   Tue Oct 23 14:37:31 2018 +0100

    sched/core: Take the hotplug lock in sched_init_smp()
    
    [ Upstream commit 40fa3780bac2b654edf23f6b13f4e2dd550aea10 ]
    
    When running on linux-next (8c60c36d0b8c ("Add linux-next specific files
    for 20181019")) + CONFIG_PROVE_LOCKING=y on a big.LITTLE system (e.g.
    Juno or HiKey960), we get the following report:
    
     [    0.748225] Call trace:
     [    0.750685]  lockdep_assert_cpus_held+0x30/0x40
     [    0.755236]  static_key_enable_cpuslocked+0x20/0xc8
     [    0.760137]  build_sched_domains+0x1034/0x1108
     [    0.764601]  sched_init_domains+0x68/0x90
     [    0.768628]  sched_init_smp+0x30/0x80
     [    0.772309]  kernel_init_freeable+0x278/0x51c
     [    0.776685]  kernel_init+0x10/0x108
     [    0.780190]  ret_from_fork+0x10/0x18
    
    The static_key in question is 'sched_asym_cpucapacity' introduced by
    commit:
    
      df054e8445a4 ("sched/topology: Add static_key for asymmetric CPU capacity optimizations")
    
    In this particular case, we enable it because smp_prepare_cpus() will
    end up fetching the capacity-dmips-mhz entry from the devicetree,
    so we already have some asymmetry detected when entering sched_init_smp().
    
    This didn't get detected in tip/sched/core because we were missing:
    
      commit cb538267ea1e ("jump_label/lockdep: Assert we hold the hotplug lock for _cpuslocked() operations")
    
    Calls to build_sched_domains() post sched_init_smp() will hold the
    hotplug lock, it just so happens that this very first call is a
    special case. As stated by a comment in sched_init_smp(), "There's no
    userspace yet to cause hotplug operations" so this is a harmless
    warning.
    
    However, to both respect the semantics of underlying
    callees and make lockdep happy, take the hotplug lock in
    sched_init_smp(). This also satisfies the comment atop
    sched_init_domains() that says "Callers must hold the hotplug lock".
    
    Reported-by: Sudeep Holla <sudeep.holla@arm.com>
    Tested-by: Sudeep Holla <sudeep.holla@arm.com>
    Signed-off-by: Valentin Schneider <valentin.schneider@arm.com>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Cc: Dietmar.Eggemann@arm.com
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: morten.rasmussen@arm.com
    Cc: quentin.perret@arm.com
    Link: http://lkml.kernel.org/r/1540301851-3048-1-git-send-email-valentin.schneider@arm.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 850e4ca7868046e13b66cb0d656398960efc4162
Author: Thomas Richter <tmricht@linux.ibm.com>
Date:   Mon Oct 29 08:11:33 2018 +0000

    s390/perf: Change CPUM_CF return code in event init function
    
    [ Upstream commit 0bb2ae1b26e1fb7543ec7474cdd374ac4b88c4da ]
    
    The function perf_init_event() creates a new event and
    assignes it to a PMU. This a done in a loop over all existing
    PMUs. For each listed PMU the event init function is called
    and if this function does return any other error than -ENOENT,
    the loop is terminated the creation of the event fails.
    
    If the event is invalid, return -ENOENT to try other PMUs.
    
    Signed-off-by: Thomas Richter <tmricht@linux.ibm.com>
    Reviewed-by: Hendrik Brueckner <brueckner@linux.ibm.com>
    Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 615a30e8dbc9c60bb35f3687072fb077160ea0b7
Author: Jeremy Linton <jeremy.linton@arm.com>
Date:   Mon Nov 5 18:14:41 2018 -0600

    lib/raid6: Fix arm64 test build
    
    [ Upstream commit 313a06e636808387822af24c507cba92703568b1 ]
    
    The lib/raid6/test fails to build the neon objects
    on arm64 because the correct machine type is 'aarch64'.
    
    Once this is correctly enabled, the neon recovery objects
    need to be added to the build.
    
    Reviewed-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
    Signed-off-by: Jeremy Linton <jeremy.linton@arm.com>
    Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 35b3e230a2b5dc9068a8779f1b77754b9c3edfde
Author: Ricardo Ribalda Delgado <ricardo.ribalda@gmail.com>
Date:   Thu Nov 1 14:15:49 2018 +0100

    clk: fixed-factor: fix of_node_get-put imbalance
    
    [ Upstream commit f98e8a572bddbf27032114127d2fcc78fa5e6a9d ]
    
    When the fixed factor clock is created by devicetree,
    of_clk_add_provider is called.  Add a call to
    of_clk_del_provider in the remove function to balance
    it out.
    
    Reported-by: Alan Tull <atull@kernel.org>
    Fixes: 971451b3b15d ("clk: fixed-factor: Convert into a module platform driver")
    Signed-off-by: Ricardo Ribalda Delgado <ricardo.ribalda@gmail.com>
    Signed-off-by: Stephen Boyd <sboyd@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c6b1ef1110ce90b66dbd957b706d58fd1ce4f4b4
Author: Inki Dae <inki.dae@samsung.com>
Date:   Fri Oct 5 11:50:20 2018 +0900

    Revert "drm/exynos/decon5433: implement frame counter"
    
    [ Upstream commit 6ca469e22a30992b4478d2ab88737c70667c1e00 ]
    
    This reverts commit 0586feba322e1de05075700eb4b835c8b683e62b
    
    This patch makes it to need get_vblank_counter callback in crtc
    to get frame counter from decon driver.
    
    However, drm_dev->max_vblank_count is a member unique to
    vendor's DRM driver but in case of ARM DRM, some CRTC devices
    don't provide the frame counter value. As a result, this patch
    made extension and clone mode not working.
    
    Instead of this patch, we may need separated max_vblank_count
    which belongs to each CRTC device, or need to implement frame
    counter emulation for them who don't support HW frame counter.
    
    Signed-off-by: Inki Dae <inki.dae@samsung.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 21eb778e7dd55c4a690b662d988798a2eb988c1d
Author: Geert Uytterhoeven <geert@linux-m68k.org>
Date:   Sun Oct 28 18:16:51 2018 +0100

    hwmon: (ibmpowernv) Remove bogus __init annotations
    
    [ Upstream commit e3e61f01d755188cb6c2dcf5a244b9c0937c258e ]
    
    If gcc decides not to inline make_sensor_label():
    
        WARNING: vmlinux.o(.text+0x4df549c): Section mismatch in reference from the function .create_device_attrs() to the function .init.text:.make_sensor_label()
        The function .create_device_attrs() references
        the function __init .make_sensor_label().
        This is often because .create_device_attrs lacks a __init
        annotation or the annotation of .make_sensor_label is wrong.
    
    As .probe() can be called after freeing of __init memory, all __init
    annotiations in the driver are bogus, and should be removed.
    
    Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 8cab58117e72caa2234323ce399f77037fe4dea2
Author: Julian Wiedmann <jwi@linux.ibm.com>
Date:   Fri Nov 2 19:04:09 2018 +0100

    s390/qeth: fix HiperSockets sniffer
    
    [ Upstream commit bd74a7f9cc033cf4d405788f80292268987dc0c5 ]
    
    Sniffing mode for L3 HiperSockets requires that no IP addresses are
    registered with the HW. The preferred way to achieve this is for
    userspace to delete all the IPs on the interface. But qeth is expected
    to also tolerate a configuration where that is not the case, by skipping
    the IP registration when in sniffer mode.
    Since commit 5f78e29ceebf ("qeth: optimize IP handling in rx_mode callback")
    reworked the IP registration logic in the L3 subdriver, this no longer
    works. When the qeth device is set online, qeth_l3_recover_ip() now
    unconditionally registers all unicast addresses from our internal
    IP table.
    
    While we could fix this particular problem by skipping
    qeth_l3_recover_ip() on a sniffer device, the more future-proof change
    is to skip the IP address registration at the lowest level. This way we
    a) catch any future code path that attempts to register an IP address
       without considering the sniffer scenario, and
    b) continue to build up our internal IP table, so that if sniffer mode
       is switched off later we can operate just like normal.
    
    Fixes: 5f78e29ceebf ("qeth: optimize IP handling in rx_mode callback")
    Signed-off-by: Julian Wiedmann <jwi@linux.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit fdf4e678ea193ec9c2e099509994a118260f0d8c
Author: Taehee Yoo <ap420073@gmail.com>
Date:   Sun Oct 21 00:00:08 2018 +0900

    netfilter: xt_IDLETIMER: add sysfs filename checking routine
    
    [ Upstream commit 54451f60c8fa061af9051a53be9786393947367c ]
    
    When IDLETIMER rule is added, sysfs file is created under
    /sys/class/xt_idletimer/timers/
    But some label name shouldn't be used.
    ".", "..", "power", "uevent", "subsystem", etc...
    So that sysfs filename checking routine is needed.
    
    test commands:
       %iptables -I INPUT -j IDLETIMER --timeout 1 --label "power"
    
    splat looks like:
    [95765.423132] sysfs: cannot create duplicate filename '/devices/virtual/xt_idletimer/timers/power'
    [95765.433418] CPU: 0 PID: 8446 Comm: iptables Not tainted 4.19.0-rc6+ #20
    [95765.449755] Call Trace:
    [95765.449755]  dump_stack+0xc9/0x16b
    [95765.449755]  ? show_regs_print_info+0x5/0x5
    [95765.449755]  sysfs_warn_dup+0x74/0x90
    [95765.449755]  sysfs_add_file_mode_ns+0x352/0x500
    [95765.449755]  sysfs_create_file_ns+0x179/0x270
    [95765.449755]  ? sysfs_add_file_mode_ns+0x500/0x500
    [95765.449755]  ? idletimer_tg_checkentry+0x3e5/0xb1b [xt_IDLETIMER]
    [95765.449755]  ? rcu_read_lock_sched_held+0x114/0x130
    [95765.449755]  ? __kmalloc_track_caller+0x211/0x2b0
    [95765.449755]  ? memcpy+0x34/0x50
    [95765.449755]  idletimer_tg_checkentry+0x4e2/0xb1b [xt_IDLETIMER]
    [ ... ]
    
    Fixes: 0902b469bd25 ("netfilter: xtables: idletimer target implementation")
    Signed-off-by: Taehee Yoo <ap420073@gmail.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 79f2eb5fde82c5264cb51cf52c1c24bd3cef6b47
Author: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
Date:   Fri Oct 19 19:35:19 2018 +0200

    netfilter: ipset: Correct rcu_dereference() call in ip_set_put_comment()
    
    [ Upstream commit 17b8b74c0f8dbf9b9e3301f9ca5b65dd1c079951 ]
    
    The function is called when rcu_read_lock() is held and not
    when rcu_read_lock_bh() is held.
    
    Signed-off-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 28bd72a7262a2256d4e2fa35b8bba47cb43e8142
Author: Justin M. Forbes <jforbes@fedoraproject.org>
Date:   Wed Oct 31 13:02:03 2018 -0500

    s390/mm: Fix ERROR: "__node_distance" undefined!
    
    [ Upstream commit a541f0ebcc08ed8bc0cc492eec9a86cb280a9f24 ]
    
    Fixes:
    ERROR: "__node_distance" [drivers/nvme/host/nvme-core.ko] undefined!
    make[1]: *** [scripts/Makefile.modpost:92: __modpost] Error 1
    make: *** [Makefile:1275: modules] Error 2
    + exit 1
    
    Signed-off-by: Justin M. Forbes <jforbes@fedoraproject.org>
    Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com>
    Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 0d5d0b5c41f766355f2b42c47d13ea001f754c7d
Author: Eric Westbrook <eric@westbrook.io>
Date:   Tue Aug 28 15:14:42 2018 -0600

    netfilter: ipset: actually allow allowable CIDR 0 in hash:net,port,net
    
    [ Upstream commit 886503f34d63e681662057448819edb5b1057a97 ]
    
    Allow /0 as advertised for hash:net,port,net sets.
    
    For "hash:net,port,net", ipset(8) says that "either subnet
    is permitted to be a /0 should you wish to match port
    between all destinations."
    
    Make that statement true.
    
    Before:
    
        # ipset create cidrzero hash:net,port,net
        # ipset add cidrzero 0.0.0.0/0,12345,0.0.0.0/0
        ipset v6.34: The value of the CIDR parameter of the IP address is invalid
    
        # ipset create cidrzero6 hash:net,port,net family inet6
        # ipset add cidrzero6 ::/0,12345,::/0
        ipset v6.34: The value of the CIDR parameter of the IP address is invalid
    
    After:
    
        # ipset create cidrzero hash:net,port,net
        # ipset add cidrzero 0.0.0.0/0,12345,0.0.0.0/0
        # ipset test cidrzero 192.168.205.129,12345,172.16.205.129
        192.168.205.129,tcp:12345,172.16.205.129 is in set cidrzero.
    
        # ipset create cidrzero6 hash:net,port,net family inet6
        # ipset add cidrzero6 ::/0,12345,::/0
        # ipset test cidrzero6 fe80::1,12345,ff00::1
        fe80::1,tcp:12345,ff00::1 is in set cidrzero6.
    
    See also:
    
      https://bugzilla.kernel.org/show_bug.cgi?id=200897
      https://github.com/ewestbrook/linux/commit/df7ff6efb0934ab6acc11f003ff1a7580d6c1d9c
    
    Signed-off-by: Eric Westbrook <linux@westbrook.io>
    Signed-off-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a1e0ae82cfd5f05973a6459ec17ed61df5cf0f9f
Author: Stefano Brivio <sbrivio@redhat.com>
Date:   Sat Jul 14 21:59:43 2018 +0200

    netfilter: ipset: list:set: Decrease refcount synchronously on deletion and replace
    
    [ Upstream commit 439cd39ea136d2c026805264d58a91f36b6b64ca ]
    
    Commit 45040978c899 ("netfilter: ipset: Fix set:list type crash
    when flush/dump set in parallel") postponed decreasing set
    reference counters to the RCU callback.
    
    An 'ipset del' command can terminate before the RCU grace period
    is elapsed, and if sets are listed before then, the reference
    counter shown in userspace will be wrong:
    
     # ipset create h hash:ip; ipset create l list:set; ipset add l
     # ipset del l h; ipset list h
     Name: h
     Type: hash:ip
     Revision: 4
     Header: family inet hashsize 1024 maxelem 65536
     Size in memory: 88
     References: 1
     Number of entries: 0
     Members:
     # sleep 1; ipset list h
     Name: h
     Type: hash:ip
     Revision: 4
     Header: family inet hashsize 1024 maxelem 65536
     Size in memory: 88
     References: 0
     Number of entries: 0
     Members:
    
    Fix this by making the reference count update synchronous again.
    
    As a result, when sets are listed, ip_set_name_byindex() might
    now fetch a set whose reference count is already zero. Instead
    of relying on the reference count to protect against concurrent
    set renaming, grab ip_set_ref_lock as reader and copy the name,
    while holding the same lock in ip_set_rename() as writer
    instead.
    
    Reported-by: Li Shuang <shuali@redhat.com>
    Fixes: 45040978c899 ("netfilter: ipset: Fix set:list type crash when flush/dump set in parallel")
    Signed-off-by: Stefano Brivio <sbrivio@redhat.com>
    Signed-off-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 221609ce4ce547d2fbad0e7ecd68d66e12f358ec
Author: Vasily Gorbik <gor@linux.ibm.com>
Date:   Fri Oct 19 15:37:01 2018 +0200

    s390/vdso: add missing FORCE to build targets
    
    [ Upstream commit b44b136a3773d8a9c7853f8df716bd1483613cbb ]
    
    According to Documentation/kbuild/makefiles.txt all build targets using
    if_changed should use FORCE as well. Add missing FORCE to make sure
    vdso targets are rebuild properly when not just immediate prerequisites
    have changed but also when build command differs.
    
    Reviewed-by: Philipp Rudo <prudo@linux.ibm.com>
    Signed-off-by: Vasily Gorbik <gor@linux.ibm.com>
    Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 10c51fa85c9879f7d90b184f940e2e16e5e3b330
Author: Nathan Chancellor <natechancellor@gmail.com>
Date:   Tue Sep 25 12:44:59 2018 -0700

    arm64: percpu: Initialize ret in the default case
    
    [ Upstream commit b5bb425871186303e6936fa2581521bdd1964a58 ]
    
    Clang warns that if the default case is taken, ret will be
    uninitialized.
    
    ./arch/arm64/include/asm/percpu.h:196:2: warning: variable 'ret' is used
    uninitialized whenever switch default is taken
    [-Wsometimes-uninitialized]
            default:
            ^~~~~~~
    ./arch/arm64/include/asm/percpu.h:200:9: note: uninitialized use occurs
    here
            return ret;
                   ^~~
    ./arch/arm64/include/asm/percpu.h:157:19: note: initialize the variable
    'ret' to silence this warning
            unsigned long ret, loop;
                             ^
                              = 0
    
    This warning appears several times while building the erofs filesystem.
    While it's not strictly wrong, the BUILD_BUG will prevent this from
    becoming a true problem. Initialize ret to 0 in the default case right
    before the BUILD_BUG to silence all of these warnings.
    
    Reported-by: Prasad Sodagudi <psodagud@codeaurora.org>
    Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
    Reviewed-by: Nick Desaulniers <ndesaulniers@google.com>
    Signed-off-by: Dennis Zhou <dennis@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4f9ffc2711d0d6651b67fa68ab75feec7201ecff
Author: Paul Gortmaker <paul.gortmaker@windriver.com>
Date:   Thu Sep 20 21:44:19 2018 -0400

    platform/x86: acerhdf: Add BIOS entry for Gateway LT31 v1.3307
    
    [ Upstream commit 684238d79ad85c5e19a71bb5818e77e329912fbc ]
    
    To fix:
    
      acerhdf: unknown (unsupported) BIOS version Gateway  /LT31   /v1.3307 , please report, aborting!
    
    As can be seen in the context, the BIOS registers haven't changed in
    the previous versions, so the assumption is they won't have changed
    in this last update for this somewhat older platform either.
    
    Cc: Peter Feuerer <peter@piie.net>
    Cc: Darren Hart <dvhart@infradead.org>
    Cc: Andy Shevchenko <andy@infradead.org>
    Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
    Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Reviewed-by: Peter Feuerer <peter@piie.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit ad2e60ff51a7bbcaf87cf66875e3a28aaefbaedd
Author: Feng Tang <feng.tang@intel.com>
Date:   Wed Oct 3 00:49:21 2018 +0800

    x86/earlyprintk: Add a force option for pciserial device
    
    [ Upstream commit d2266bbfa9e3e32e3b642965088ca461bd24a94f ]
    
    The "pciserial" earlyprintk variant helps much on many modern x86
    platforms, but unfortunately there are still some platforms with PCI
    UART devices which have the wrong PCI class code. In that case, the
    current class code check does not allow for them to be used for logging.
    
    Add a sub-option "force" which overrides the class code check and thus
    the use of such device can be enforced.
    
     [ bp: massage formulations. ]
    
    Suggested-by: Borislav Petkov <bp@alien8.de>
    Signed-off-by: Feng Tang <feng.tang@intel.com>
    Signed-off-by: Borislav Petkov <bp@suse.de>
    Cc: "H. Peter Anvin" <hpa@zytor.com>
    Cc: "Stuart R . Anderson" <stuart.r.anderson@intel.com>
    Cc: Bjorn Helgaas <bhelgaas@google.com>
    Cc: David Rientjes <rientjes@google.com>
    Cc: Feng Tang <feng.tang@intel.com>
    Cc: Frederic Weisbecker <frederic@kernel.org>
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Cc: H Peter Anvin <hpa@linux.intel.com>
    Cc: Ingo Molnar <mingo@kernel.org>
    Cc: Jiri Kosina <jkosina@suse.cz>
    Cc: Jonathan Corbet <corbet@lwn.net>
    Cc: Kai-Heng Feng <kai.heng.feng@canonical.com>
    Cc: Kate Stewart <kstewart@linuxfoundation.org>
    Cc: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Philippe Ombredanne <pombredanne@nexb.com>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: Thymo van Beers <thymovanbeers@gmail.com>
    Cc: alan@linux.intel.com
    Cc: linux-doc@vger.kernel.org
    Link: http://lkml.kernel.org/r/20181002164921.25833-1-feng.tang@intel.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d0a636aa44f9e7cbac2a90e191bc0ad840b10b9e
Author: Zubin Mithra <zsm@chromium.org>
Date:   Thu Sep 27 14:49:17 2018 -0700

    apparmor: Fix uninitialized value in aa_split_fqname
    
    [ Upstream commit 250f2da49cb8e582215a65c03f50e8ddf5cd119c ]
    
    Syzkaller reported a OOB-read with the stacktrace below. This occurs
    inside __aa_lookupn_ns as `n` is not initialized. `n` is obtained from
    aa_splitn_fqname. In cases where `name` is invalid, aa_splitn_fqname
    returns without initializing `ns_name` and `ns_len`.
    
    Fix this by always initializing `ns_name` and `ns_len`.
    
            __dump_stack lib/dump_stack.c:77 [inline]
            dump_stack+0x1c4/0x2b4 lib/dump_stack.c:113
            print_address_description.cold.8+0x9/0x1ff mm/kasan/report.c:256
            kasan_report_error mm/kasan/report.c:354 [inline]
            kasan_report.cold.9+0x242/0x309 mm/kasan/report.c:412
            __asan_report_load1_noabort+0x14/0x20 mm/kasan/report.c:430
            memcmp+0xe3/0x160 lib/string.c:861
            strnstr+0x4b/0x70 lib/string.c:934
            __aa_lookupn_ns+0xc1/0x570 security/apparmor/policy_ns.c:209
            aa_lookupn_ns+0x88/0x1e0 security/apparmor/policy_ns.c:240
            aa_fqlookupn_profile+0x1b9/0x1010 security/apparmor/policy.c:468
            fqlookupn_profile+0x80/0xc0 security/apparmor/label.c:1844
            aa_label_strn_parse+0xa3a/0x1230 security/apparmor/label.c:1908
            aa_label_parse+0x42/0x50 security/apparmor/label.c:1943
            aa_change_profile+0x513/0x3510 security/apparmor/domain.c:1362
            apparmor_setprocattr+0xaa4/0x1150 security/apparmor/lsm.c:658
            security_setprocattr+0x66/0xc0 security/security.c:1298
            proc_pid_attr_write+0x301/0x540 fs/proc/base.c:2555
            __vfs_write+0x119/0x9f0 fs/read_write.c:485
            vfs_write+0x1fc/0x560 fs/read_write.c:549
            ksys_write+0x101/0x260 fs/read_write.c:598
            __do_sys_write fs/read_write.c:610 [inline]
            __se_sys_write fs/read_write.c:607 [inline]
            __x64_sys_write+0x73/0xb0 fs/read_write.c:607
            do_syscall_64+0x1b9/0x820 arch/x86/entry/common.c:290
            entry_SYSCALL_64_after_hwframe+0x49/0xbe
    
    Fixes: 3b0aaf5866bf ("apparmor: add lib fn to find the "split" for fqnames")
    Reported-by: syzbot+61e4b490d9d2da591b50@syzkaller.appspotmail.com
    Signed-off-by: Zubin Mithra <zsm@chromium.org>
    Reviewed-by: Kees Cook <keescook@chromium.org>
    Signed-off-by: John Johansen <john.johansen@canonical.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit e2a11843feaac0a4c7f6047ab433a059f0122603
Author: Marek Szyprowski <m.szyprowski@samsung.com>
Date:   Mon Sep 24 13:01:20 2018 +0200

    clk: samsung: exynos5420: Enable PERIS clocks for suspend
    
    [ Upstream commit b33228029d842269e17bba591609e83ed422005d ]
    
    Ensure that clocks for core SoC modules (including TZPC0..9 modules)
    are enabled for suspend/resume cycle. This fixes suspend/resume
    support on Exynos5422-based Odroid XU3/XU4 boards.
    
    Suggested-by: Joonyoung Shim <jy0922.shim@samsung.com>
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Sylwester Nawrocki <snawrocki@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a088fde602b8dc3183fb40fa2e706455243bd900
Author: Chengguang Xu <cgxu519@gmx.com>
Date:   Wed Jun 13 12:05:13 2018 +0800

    fs/exofs: fix potential memory leak in mount option parsing
    
    [ Upstream commit 515f1867addaba49c1c6ac73abfaffbc192c1db4 ]
    
    There are some cases can cause memory leak when parsing
    option 'osdname'.
    
    Signed-off-by: Chengguang Xu <cgxu519@gmx.com>
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit bff410ea7ec2541a38d353a9e012f7f4622e17c1
Author: David Miller <davem@davemloft.net>
Date:   Wed Oct 17 12:08:59 2018 -0700

    perf symbols: Set PLT entry/header sizes properly on Sparc
    
    [ Upstream commit d6afa561e1471ccfdaf7191230c0c59a37e45a5b ]
    
    Using the sh_entsize for both values isn't correct.  It happens to be
    correct on x86...
    
    For both 32-bit and 64-bit sparc, there are four PLT entries in the PLT
    section.
    
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Alexis Berlemont <alexis.berlemont@gmail.com>
    Cc: David Tolnay <dtolnay@gmail.com>
    Cc: Hanjun Guo <guohanjun@huawei.com>
    Cc: Hemant Kumar <hemant@linux.vnet.ibm.com>
    Cc: Li Bin <huawei.libin@huawei.com>
    Cc: Masami Hiramatsu <mhiramat@kernel.org>
    Cc: Milian Wolff <milian.wolff@kdab.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Wang Nan <wangnan0@huawei.com>
    Cc: zhangmengting@huawei.com
    Fixes: b2f7605076d6 ("perf symbols: Fix plt entry calculation for ARM and AARCH64")
    Link: http://lkml.kernel.org/r/20181017.120859.2268840244308635255.davem@davemloft.net
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 0333b8fc793bdb01b454a9c2ad3bf2c63a8cb530
Author: Alan Tull <atull@kernel.org>
Date:   Thu Oct 18 14:54:11 2018 -0500

    clk: fixed-rate: fix of_node_get-put imbalance
    
    [ Upstream commit 52091c256bdcad0d01e2852a63f19cd2cce6af96 ]
    
    When the fixed rate clock is created by devicetree,
    of_clk_add_provider is called.  Add a call to
    of_clk_del_provider in the remove function to balance
    it out.
    
    Signed-off-by: Alan Tull <atull@kernel.org>
    Fixes: 435779fe1336 ("clk: fixed-rate: Convert into a module platform driver")
    Signed-off-by: Stephen Boyd <sboyd@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b36c78af0c4d210aa99b705c4d777adf6a44d67f
Author: Rajneesh Bhardwaj <rajneesh.bhardwaj@linux.intel.com>
Date:   Sat Oct 6 12:21:13 2018 +0530

    platform/x86: intel_telemetry: report debugfs failure
    
    [ Upstream commit 8d98b1ef368feeb7720b8b9b6f3bd93f2ad892bc ]
    
    On some Goldmont based systems such as ASRock J3455M the BIOS may not
    enable the IPC1 device that provides access to the PMC and PUNIT. In
    such scenarios, the IOSS and PSS resources from the platform device can
    not be obtained and result in a invalid telemetry_plt_config which is an
    internal data structure that holds platform config and is maintained by
    the telemetry platform driver.
    
    This is also applicable to the platforms where the BIOS supports IPC1
    device under debug configurations but IPC1 is disabled by user or the
    policy.
    
    This change allows user to know the reason for not seeing entries under
    /sys/kernel/debug/telemetry/* when there is no apparent failure at boot.
    
    Cc: Matt Turner <matt.turner@intel.com>
    Cc: Len Brown <len.brown@intel.com>
    Cc: Souvik Kumar Chakravarty <souvik.k.chakravarty@intel.com>
    Cc: Kuppuswamy Sathyanarayanan <sathyanarayanan.kuppuswamy@intel.com>
    
    Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=198779
    Acked-by: Matt Turner <matt.turner@intel.com>
    Signed-off-by: Rajneesh Bhardwaj <rajneesh.bhardwaj@linux.intel.com>
    Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a3e69ef80467644e7970fdc39452f2247994fc3f
Author: Lee, Shawn C <shawn.c.lee@intel.com>
Date:   Sun Oct 28 22:49:33 2018 -0700

    drm/edid: Add 6 bpc quirk for BOE panel.
    
    [ Upstream commit 922dceff8dc1fb4dafc9af78139ba65671408103 ]
    
    BOE panel (ID: 0x0771) that reports "DFP 1.x compliant TMDS".
    But it's 6bpc panel only instead of 8 bpc.
    
    Add panel ID to edid quirk list and set 6 bpc as default to
    work around this issue.
    
    Cc: Jani Nikula <jani.nikula@intel.com>
    Cc: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
    Cc: Gustavo Padovan <gustavo@padovan.org>
    Cc: Cooper Chiou <cooper.chiou@intel.com>
    Signed-off-by: Lee, Shawn C <shawn.c.lee@intel.com>>
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Link: https://patchwork.freedesktop.org/patch/msgid/1540792173-7288-1-git-send-email-shawn.c.lee@intel.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a134b05a43ae2327036e860fb10c74389b5bd971
Author: Richard Weinberger <richard@nod.at>
Date:   Fri Jun 15 16:42:56 2018 +0200

    um: Give start_idle_thread() a return code
    
    [ Upstream commit 7ff1e34bbdc15acab823b1ee4240e94623d50ee8 ]
    
    Fixes:
    arch/um/os-Linux/skas/process.c:613:1: warning: control reaches end of
    non-void function [-Wreturn-type]
    
    longjmp() never returns but gcc still warns that the end of the function
    can be reached.
    Add a return code and debug aid to detect this impossible case.
    
    Signed-off-by: Richard Weinberger <richard@nod.at>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit f2e71fed903fa6441188f4ac8b0df6528711cae3
Author: Ernesto A. Fernández <ernesto.mnd.fernandez@gmail.com>
Date:   Tue Oct 30 15:06:00 2018 -0700

    hfsplus: prevent btree data loss on root split
    
    [ Upstream commit 0a3021d4f5295aa073c7bf5c5e4de60a2e292578 ]
    
    Creating, renaming or deleting a file may cause catalog corruption and
    data loss.  This bug is randomly triggered by xfstests generic/027, but
    here is a faster reproducer:
    
      truncate -s 50M fs.iso
      mkfs.hfsplus fs.iso
      mount fs.iso /mnt
      i=100
      while [ $i -le 150 ]; do
        touch /mnt/$i &>/dev/null
        ((++i))
      done
      i=100
      while [ $i -le 150 ]; do
        mv /mnt/$i /mnt/$(perl -e "print $i x82") &>/dev/null
        ((++i))
      done
      umount /mnt
      fsck.hfsplus -n fs.iso
    
    The bug is triggered whenever hfs_brec_update_parent() needs to split the
    root node.  The height of the btree is not increased, which leaves the new
    node orphaned and its records lost.
    
    Link: http://lkml.kernel.org/r/26d882184fc43043a810114258f45277752186c7.1535682461.git.ernesto.mnd.fernandez@gmail.com
    Signed-off-by: Ernesto A. Fernández <ernesto.mnd.fernandez@gmail.com>
    Cc: Christoph Hellwig <hch@infradead.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit dc50dd3ac68b092c0bcb05cbd8b604e8d517185a
Author: Ernesto A. Fernández <ernesto.mnd.fernandez@gmail.com>
Date:   Tue Oct 30 15:06:07 2018 -0700

    hfs: prevent btree data loss on root split
    
    [ Upstream commit d057c036672f33d43a5f7344acbb08cf3a8a0c09 ]
    
    This bug is triggered whenever hfs_brec_update_parent() needs to split
    the root node.  The height of the btree is not increased, which leaves
    the new node orphaned and its records lost.  It is not possible for this
    to happen on a valid hfs filesystem because the index nodes have fixed
    length keys.
    
    For reasons I ignore, the hfs module does have support for a number of
    hfsplus features.  A corrupt btree header may report variable length
    keys and trigger this bug, so it's better to fix it.
    
    Link: http://lkml.kernel.org/r/9750b1415685c4adca10766895f6d5ef12babdb0.1535682463.git.ernesto.mnd.fernandez@gmail.com
    Signed-off-by: Ernesto A. Fernández <ernesto.mnd.fernandez@gmail.com>
    Cc: Christoph Hellwig <hch@infradead.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 195169e26eaa18da05f0b63cc4b7dbfa50d70752
Author: Jann Horn <jannh@google.com>
Date:   Tue Oct 30 15:06:38 2018 -0700

    reiserfs: propagate errors from fill_with_dentries() properly
    
    [ Upstream commit b10298d56c9623f9b173f19959732d3184b35f4f ]
    
    fill_with_dentries() failed to propagate errors up to
    reiserfs_for_each_xattr() properly.  Plumb them through.
    
    Note that reiserfs_for_each_xattr() is only used by
    reiserfs_delete_xattrs() and reiserfs_chown_xattrs().  The result of
    reiserfs_delete_xattrs() is discarded anyway, the only difference there is
    whether a warning is printed to dmesg.  The result of
    reiserfs_chown_xattrs() does matter because it can block chowning of the
    file to which the xattrs belong; but either way, the resulting state can
    have misaligned ownership, so my patch doesn't improve things greatly.
    
    Credit for making me look at this code goes to Al Viro, who pointed out
    that the ->actor calling convention is suboptimal and should be changed.
    
    Link: http://lkml.kernel.org/r/20180802163335.83312-1-jannh@google.com
    Signed-off-by: Jann Horn <jannh@google.com>
    Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
    Cc: Jeff Mahoney <jeffm@suse.com>
    Cc: Eric Biggers <ebiggers@google.com>
    Cc: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit f54c21ee5dcede4164e8924a525d801f2fe855fd
Author: Radoslaw Tyl <radoslawx.tyl@intel.com>
Date:   Mon Oct 22 08:44:31 2018 +0200

    ixgbe: fix MAC anti-spoofing filter after VFLR
    
    [ Upstream commit 6702185c1ffec3421181b5e24491e3fac920cb61 ]
    
    This change resolves a driver bug where the driver is logging a
    message that says "Spoofed packets detected". This can occur on the PF
    (host) when a VF has VLAN+MACVLAN enabled and is re-started with a
    different MAC address.
    
    MAC and VLAN anti-spoofing filters are to be enabled together.
    
    Signed-off-by: Radoslaw Tyl <radoslawx.tyl@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Acked-by: Piotr Skajewski <piotrx.skajewski@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit aa9571b2015d270a3e73a66d3a5b27c37836fd6a
Author: Anders Roxell <anders.roxell@linaro.org>
Date:   Tue Oct 30 12:38:50 2018 +0100

    arm64: kprobe: make page to RO mode when allocate it
    
    [ Upstream commit 966866892cf89d606544bca22d584ba2ef9ec208 ]
    
    Commit 1404d6f13e47 ("arm64: dump: Add checking for writable and exectuable pages")
    has successfully identified code that leaves a page with W+X
    permissions.
    
    [    3.245140] arm64/mm: Found insecure W+X mapping at address (____ptrval____)/0xffff000000d90000
    [    3.245771] WARNING: CPU: 0 PID: 1 at ../arch/arm64/mm/dump.c:232 note_page+0x410/0x420
    [    3.246141] Modules linked in:
    [    3.246653] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 4.19.0-rc5-next-20180928-00001-ge70ae259b853-dirty #62
    [    3.247008] Hardware name: linux,dummy-virt (DT)
    [    3.247347] pstate: 80000005 (Nzcv daif -PAN -UAO)
    [    3.247623] pc : note_page+0x410/0x420
    [    3.247898] lr : note_page+0x410/0x420
    [    3.248071] sp : ffff00000804bcd0
    [    3.248254] x29: ffff00000804bcd0 x28: ffff000009274000
    [    3.248578] x27: ffff00000921a000 x26: ffff80007dfff000
    [    3.248845] x25: ffff0000093f5000 x24: ffff000009526f6a
    [    3.249109] x23: 0000000000000004 x22: ffff000000d91000
    [    3.249396] x21: ffff000000d90000 x20: 0000000000000000
    [    3.249661] x19: ffff00000804bde8 x18: 0000000000000400
    [    3.249924] x17: 0000000000000000 x16: 0000000000000000
    [    3.250271] x15: ffffffffffffffff x14: 295f5f5f5f6c6176
    [    3.250594] x13: 7274705f5f5f5f28 x12: 2073736572646461
    [    3.250941] x11: 20746120676e6970 x10: 70616d20582b5720
    [    3.251252] x9 : 6572756365736e69 x8 : 3039643030303030
    [    3.251519] x7 : 306666666678302f x6 : ffff0000095467b2
    [    3.251802] x5 : 0000000000000000 x4 : 0000000000000000
    [    3.252060] x3 : 0000000000000000 x2 : ffffffffffffffff
    [    3.252323] x1 : 4d151327adc50b00 x0 : 0000000000000000
    [    3.252664] Call trace:
    [    3.252953]  note_page+0x410/0x420
    [    3.253186]  walk_pgd+0x12c/0x238
    [    3.253417]  ptdump_check_wx+0x68/0xf8
    [    3.253637]  mark_rodata_ro+0x68/0x98
    [    3.253847]  kernel_init+0x38/0x160
    [    3.254103]  ret_from_fork+0x10/0x18
    
    kprobes allocates a writable executable page with module_alloc() in
    order to store executable code.
    Reworked to that when allocate a page it sets mode RO. Inspired by
    commit 63fef14fc98a ("kprobes/x86: Make insn buffer always ROX and use text_poke()").
    
    Suggested-by: Arnd Bergmann <arnd@arndb.de>
    Suggested-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
    Acked-by: Will Deacon <will.deacon@arm.com>
    Acked-by: Masami Hiramatsu <mhiramat@kernel.org>
    Reviewed-by: Laura Abbott <labbott@redhat.com>
    Signed-off-by: Anders Roxell <anders.roxell@linaro.org>
    [catalin.marinas@arm.com: removed unnecessary casts]
    Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit bc32d90e4d45b4f544527efdce2ea57d83f77542
Author: Ronnie Sahlberg <lsahlber@redhat.com>
Date:   Thu Oct 25 15:43:36 2018 +1000

    cifs: fix return value for cifs_listxattr
    
    [ Upstream commit 0c5d6cb6643f48ad3775322f3ebab6c7eb67484e ]
    
    If the application buffer was too small to fit all the names
    we would still count the number of bytes and return this for
    listxattr. This would then trigger a BUG in usercopy.c
    
    Fix the computation of the size so that we return -ERANGE
    correctly when the buffer is too small.
    
    This fixes the kernel BUG for xfstest generic/377
    
    Signed-off-by: Ronnie Sahlberg <lsahlber@redhat.com>
    Signed-off-by: Steve French <stfrench@microsoft.com>
    Reviewed-by: Aurelien Aptel <aaptel@suse.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 426477d9f68b56ab71f52a5ce2dd6da0699d89c3
Author: Colin Ian King <colin.king@canonical.com>
Date:   Thu Nov 1 13:14:30 2018 +0000

    cifs: don't dereference smb_file_target before null check
    
    [ Upstream commit 8c6c9bed8773375b1d54ccca2911ec892c59db5d ]
    
    There is a null check on dst_file->private data which suggests
    it can be potentially null. However, before this check, pointer
    smb_file_target is derived from dst_file->private and dereferenced
    in the call to tlink_tcon, hence there is a potential null pointer
    deference.
    
    Fix this by assigning smb_file_target and target_tcon after the
    null pointer sanity checks.
    
    Detected by CoverityScan, CID#1475302 ("Dereference before null check")
    
    Fixes: 04b38d601239 ("vfs: pull btrfs clone API to vfs layer")
    Signed-off-by: Colin Ian King <colin.king@canonical.com>
    Signed-off-by: Steve French <stfrench@microsoft.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>
