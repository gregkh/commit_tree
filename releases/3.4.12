commit 1c7eb28096b50831697a9cf6f8bf1af0e5b234bc
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Tue Oct 2 10:35:08 2012 -0700

    Linux 3.4.12

commit 9effb1b2599c3ae0be3c5bf3f6187667fe2a6e70
Author: Will Deacon <will@kernel.org>
Date:   Fri Jul 13 19:15:40 2012 +0100

    ARM: 7467/1: mutex: use generic xchg-based implementation for ARMv6+
    
    commit a76d7bd96d65fa5119adba97e1b58d95f2e78829 upstream.
    
    The open-coded mutex implementation for ARMv6+ cores suffers from a
    severe lack of barriers, so in the uncontended case we don't actually
    protect any accesses performed during the critical section.
    
    Furthermore, the code is largely a duplication of the ARMv6+ atomic_dec
    code but optimised to remove a branch instruction, as the mutex fastpath
    was previously inlined. Now that this is executed out-of-line, we can
    reuse the atomic access code for the locking (in fact, we use the xchg
    code as this produces shorter critical sections).
    
    This patch uses the generic xchg based implementation for mutexes on
    ARMv6+, which introduces barriers to the lock/unlock operations and also
    has the benefit of removing a fair amount of inline assembly code.
    
    Acked-by: Arnd Bergmann <arnd@arndb.de>
    Acked-by: Nicolas Pitre <nico@linaro.org>
    Reported-by: Shan Kang <kangshan0910@gmail.com>
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 446d14d4c51010379f7f12f3616773e7e7fb47d9
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Fri Sep 28 09:06:10 2012 -0700

    Revert: drm/i915: correctly order the ring init sequence
    
    This reverts commit 57ecc93ce680b1ace1f9e79d588dabe32353202c which
    really is commit 0d8957c8a90bbb5d34fab9a304459448a5131e06 upstream as it
    has been reported to cause problems in the 3.4.y kernel series.
    
    Reported-by: Herton Ronaldo Krzesinski <herton.krzesinski@canonical.com>
    Cc: Andreas Sturmlechner <andreas.sturmlechner@gmail.com>
    Cc: Jani Nikula <jani.nikula@intel.com>
    Cc: Yang Guang <guang.a.yang@intel.com>
    Cc: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9a266f619f8b9994b0c2bd9bb79605ddfa4ac32a
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Sun Sep 23 19:33:55 2012 +0300

    vmwgfx: corruption in vmw_event_fence_action_create()
    
    commit 68c4fce737c4b963e336435f225621dc21138397 upstream.
    
    We don't allocate enough data for this struct.  As soon as we start
    modifying event->event on the next lines, then we're going beyond the
    end of the memory we allocated.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Dave Airlie <airlied@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 03c4c80ee30ae2c965cd838dd0f21c97a877366d
Author: Jani Nikula <jani.nikula@intel.com>
Date:   Mon Aug 13 13:22:35 2012 +0300

    drm/i915: fall back to bit-banging if GMBUS fails in CRT EDID reads
    
    commit f1a2f5b7c5f0941d23eef0a095c0b99bf8d051e6 upstream.
    
    GMBUS was enabled over bit-banging as the default in commits:
    
    commit c3dfefa0a6d235bd465309e12f4c56ea16e71111
    Author: Daniel Vetter <daniel.vetter@ffwll.ch>
    Date:   Tue Feb 14 22:37:25 2012 +0100
    
        drm/i915: reenable gmbus on gen3+ again
    
    and
    
    commit 0fb3f969c8683505fb7323c06bf8a999a5a45a15
    Author: Daniel Vetter <daniel.vetter@ffwll.ch>
    Date:   Fri Mar 2 19:38:30 2012 +0100
    
        drm/i915: enable gmbus on gen2
    
    Unfortunately, GMBUS seems to fail on some CRT displays. Add a bit-banging
    fallback to CRT EDID reads.
    
    LKML-Reference: <201207251020.47637.maciej.rutecki@gmail.com>
    Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=45881
    Signed-off-by: Jani Nikula <jani.nikula@intel.com>
    Tested-by: Alex Ferrando <alferpal@gmail.com>
    Cc: stable@vger.kernel.org (for 3.4+3.5)
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bd1d3d8331af11cc1abf5e907a9a963037530281
Author: Dave Airlie <airlied@redhat.com>
Date:   Tue Sep 25 16:17:43 2012 +1000

    drm/udl: limit modes to the sku pixel limits.
    
    commit 3a75885848996baab5276ff37ebf7295c3c753f0 upstream.
    
    Otherwise when X starts we commonly get a black screen scanning
    out nothing, its wierd dpms on/off from userspace brings it back,
    
    With this on F18, multi-seat works again with my 1920x1200 monitor
    which is above the sku limit for the device I have.
    
    Reviewed-by: Alex Deucher <alexander.deucher@gmail.com>
    Signed-off-by: Dave Airlie <airlied@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 66801463734e49416a9b013d3eb8f9eb8cd851e0
Author: Roland Stigge <stigge@antcom.de>
Date:   Thu Sep 20 10:48:03 2012 +0200

    gpio-lpc32xx: Fix value handling of gpio_direction_output()
    
    commit b1268d3737c6316016026245eef276eda6b0a621 upstream.
    
    For GPIOs of gpio-lpc32xx, gpio_direction_output() ignores the value argument
    (initial value of output). This patch fixes this by setting the level
    accordingly.
    
    Signed-off-by: Roland Stigge <stigge@antcom.de>
    Acked-by: Alexandre Pereira da Silva <aletes.xgr@gmail.com>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d20ff72cdeb4cbb586a1ee1a3f4f1bbade52414a
Author: Mark Brown <broonie@opensource.wolfsonmicro.com>
Date:   Wed Sep 26 11:57:30 2012 +0100

    ASoC: wm2000: Correct register size
    
    commit d0e12f3ff3472cbd8f52d3c0e6ee07a841787c40 upstream.
    
    Signed-off-by: Mark Brown <broonie@opensource.wolfsonmicro.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1437cb571cacaf18ce2da7dd8c858fac57806d37
Author: Alan Stern <stern@rowland.harvard.edu>
Date:   Wed Sep 26 13:09:53 2012 -0400

    USB: Fix race condition when removing host controllers
    
    commit 0d00dc2611abbe6ad244d50569c2ee82ce42846c upstream.
    
    This patch (as1607) fixes a race that can occur if a USB host
    controller is removed while a process is reading the
    /sys/kernel/debug/usb/devices file.
    
    The usb_device_read() routine uses the bus->root_hub pointer to
    determine whether or not the root hub is registered.  The is not a
    valid test, because the pointer is set before the root hub gets
    registered and remains set even after the root hub is unregistered and
    deallocated.  As a result, usb_device_read() or usb_device_dump() can
    access freed memory, causing an oops.
    
    The patch changes the test to use the hcd->rh_registered flag, which
    does get set and cleared at the appropriate times.  It also makes sure
    to hold the usb_bus_list_lock mutex while setting the flag, so that
    usb_device_read() will become aware of new root hubs as soon as they
    are registered.
    
    Signed-off-by: Alan Stern <stern@rowland.harvard.edu>
    Reported-by: Don Zickus <dzickus@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0f36cbb3364497fce45f40f295847f2de7cceeb7
Author: Joachim Eastwood <manabian@gmail.com>
Date:   Sun Sep 23 22:56:00 2012 +0200

    USB: ohci-at91: fix null pointer in ohci_hcd_at91_overcurrent_irq
    
    commit 01bb6501779ed0b6dc6c55be34b49eaa6306fdd8 upstream.
    
    Fixes the following NULL pointer dereference:
    [    7.740000] ohci_hcd: USB 1.1 'Open' Host Controller (OHCI) Driver
    [    7.810000] Unable to handle kernel NULL pointer dereference at virtual address 00000028
    [    7.810000] pgd = c3a38000
    [    7.810000] [00000028] *pgd=23a8c831, *pte=00000000, *ppte=00000000
    [    7.810000] Internal error: Oops: 17 [#1] PREEMPT ARM
    [    7.810000] Modules linked in: ohci_hcd(+) regmap_i2c snd_pcm usbcore snd_page_alloc at91_cf snd_timer pcmcia_rsrc snd soundcore gpio_keys regmap_spi pcmcia_core usb_common nls_base
    [    7.810000] CPU: 0    Not tainted  (3.6.0-rc6-mpa+ #264)
    [    7.810000] PC is at __gpio_to_irq+0x18/0x40
    [    7.810000] LR is at ohci_hcd_at91_overcurrent_irq+0x24/0xb4 [ohci_hcd]
    [    7.810000] pc : [<c01392d4>]    lr : [<bf08f694>]    psr: 40000093
    [    7.810000] sp : c3a11c40  ip : c3a11c50  fp : c3a11c4c
    [    7.810000] r10: 00000000  r9 : c02dcd6e  r8 : fefff400
    [    7.810000] r7 : 00000000  r6 : c02cc928  r5 : 00000030  r4 : c02dd168
    [    7.810000] r3 : c02e7350  r2 : ffffffea  r1 : c02cc928  r0 : 00000000
    [    7.810000] Flags: nZcv  IRQs off  FIQs on  Mode SVC_32  ISA ARM  Segment user
    [    7.810000] Control: c000717f  Table: 23a38000  DAC: 00000015
    [    7.810000] Process modprobe (pid: 285, stack limit = 0xc3a10270)
    [    7.810000] Stack: (0xc3a11c40 to 0xc3a12000)
    [    7.810000] 1c40: c3a11c6c c3a11c50 bf08f694 c01392cc c3a11c84 c2c38b00 c3806900 00000030
    [    7.810000] 1c60: c3a11ca4 c3a11c70 c0051264 bf08f680 c3a11cac c3a11c80 c003e764 c3806900
    [    7.810000] 1c80: c2c38b00 c02cb05c c02cb000 fefff400 c3806930 c3a11cf4 c3a11cbc c3a11ca8
    [    7.810000] 1ca0: c005142c c005123c c3806900 c3805a00 c3a11cd4 c3a11cc0 c0053f24 c00513e4
    [    7.810000] 1cc0: c3a11cf4 00000030 c3a11cec c3a11cd8 c005120c c0053e88 00000000 00000000
    [    7.810000] 1ce0: c3a11d1c c3a11cf0 c00124d0 c00511e0 01400000 00000001 00000012 00000000
    [    7.810000] 1d00: ffffffff c3a11d94 00000030 00000000 c3a11d34 c3a11d20 c005120c c0012438
    [    7.810000] 1d20: c001dac4 00000012 c3a11d4c c3a11d38 c0009b08 c00511e0 c00523fc 60000013
    [    7.810000] 1d40: c3a11d5c c3a11d50 c0008510 c0009ab4 c3a11ddc c3a11d60 c0008eb4 c00084f0
    [    7.810000] 1d60: 00000000 00000030 00000000 00000080 60000013 bf08f670 c3806900 c2c38b00
    [    7.810000] 1d80: 00000030 c3806930 00000000 c3a11ddc c3a11d88 c3a11da8 c0054190 c00523fc
    [    7.810000] 1da0: 60000013 ffffffff c3a11dec c3a11db8 00000000 c2c38b00 bf08f670 c3806900
    [    7.810000] 1dc0: 00000000 00000080 c02cc928 00000030 c3a11e0c c3a11de0 c0052764 c00520d8
    [    7.810000] 1de0: c3a11dfc 00000000 00000000 00000002 bf090f61 00000004 c02cc930 c02cc928
    [    7.810000] 1e00: c3a11e4c c3a11e10 bf090978 c005269c bf090f61 c02cc928 bf093000 c02dd170
    [    7.810000] 1e20: c3a11e3c c02cc930 c02cc930 bf0911d0 bf0911d0 bf093000 c3a10000 00000000
    [    7.810000] 1e40: c3a11e5c c3a11e50 c0155b7c bf090808 c3a11e7c c3a11e60 c0154690 c0155b6c
    [    7.810000] 1e60: c02cc930 c02cc964 bf0911d0 c3a11ea0 c3a11e9c c3a11e80 c015484c c01545e8
    [    7.810000] 1e80: 00000000 00000000 c01547e4 bf0911d0 c3a11ec4 c3a11ea0 c0152e58 c01547f4
    [    7.810000] 1ea0: c381b88c c384ab10 c2c10540 bf0911d0 00000000 c02d7518 c3a11ed4 c3a11ec8
    [    7.810000] 1ec0: c01544c0 c0152e0c c3a11efc c3a11ed8 c01536cc c01544b0 bf091075 c3a11ee8
    [    7.810000] 1ee0: bf049af0 bf09120c bf0911d0 00000000 c3a11f1c c3a11f00 c0154e9c c0153628
    [    7.810000] 1f00: bf049af0 bf09120c 000ae190 00000000 c3a11f2c c3a11f20 c0155f58 c0154e04
    [    7.810000] 1f20: c3a11f44 c3a11f30 bf093054 c0155f1c 00000000 00006a4f c3a11f7c c3a11f48
    [    7.810000] 1f40: c0008638 bf093010 bf09120c 000ae190 00000000 c00093c4 00006a4f bf09120c
    [    7.810000] 1f60: 000ae190 00000000 c00093c4 00000000 c3a11fa4 c3a11f80 c004fdc4 c000859c
    [    7.810000] 1f80: c3a11fa4 000ae190 00006a4f 00016eb8 000ad018 00000080 00000000 c3a11fa8
    [    7.810000] 1fa0: c0009260 c004fd58 00006a4f 00016eb8 000ae190 00006a4f 000ae100 00000000
    [    7.810000] 1fc0: 00006a4f 00016eb8 000ad018 00000080 000adba0 000ad208 00000000 000ad3d8
    [    7.810000] 1fe0: beaf7ae8 beaf7ad8 000172b8 b6e4e940 20000010 000ae190 00000000 00000000
    [    7.810000] Backtrace:
    [    7.810000] [<c01392bc>] (__gpio_to_irq+0x0/0x40) from [<bf08f694>] (ohci_hcd_at91_overcurrent_irq+0x24/0xb4 [ohci_hcd])
    [    7.810000] [<bf08f670>] (ohci_hcd_at91_overcurrent_irq+0x0/0xb4 [ohci_hcd]) from [<c0051264>] (handle_irq_event_percpu+0x38/0x1a8)
    [    7.810000]  r6:00000030 r5:c3806900 r4:c2c38b00
    [    7.810000] [<c005122c>] (handle_irq_event_percpu+0x0/0x1a8) from [<c005142c>] (handle_irq_event+0x58/0x7c)
    [    7.810000] [<c00513d4>] (handle_irq_event+0x0/0x7c) from [<c0053f24>] (handle_simple_irq+0xac/0xd8)
    [    7.810000]  r5:c3805a00 r4:c3806900
    [    7.810000] [<c0053e78>] (handle_simple_irq+0x0/0xd8) from [<c005120c>] (generic_handle_irq+0x3c/0x48)
    [    7.810000]  r4:00000030
    [    7.810000] [<c00511d0>] (generic_handle_irq+0x0/0x48) from [<c00124d0>] (gpio_irq_handler+0xa8/0xfc)
    [    7.810000]  r4:00000000
    [    7.810000] [<c0012428>] (gpio_irq_handler+0x0/0xfc) from [<c005120c>] (generic_handle_irq+0x3c/0x48)
    [    7.810000] [<c00511d0>] (generic_handle_irq+0x0/0x48) from [<c0009b08>] (handle_IRQ+0x64/0x88)
    [    7.810000]  r4:00000012
    [    7.810000] [<c0009aa4>] (handle_IRQ+0x0/0x88) from [<c0008510>] (at91_aic_handle_irq+0x30/0x38)
    [    7.810000]  r5:60000013 r4:c00523fc
    [    7.810000] [<c00084e0>] (at91_aic_handle_irq+0x0/0x38) from [<c0008eb4>] (__irq_svc+0x34/0x60)
    [    7.810000] Exception stack(0xc3a11d60 to 0xc3a11da8)
    [    7.810000] 1d60: 00000000 00000030 00000000 00000080 60000013 bf08f670 c3806900 c2c38b00
    [    7.810000] 1d80: 00000030 c3806930 00000000 c3a11ddc c3a11d88 c3a11da8 c0054190 c00523fc
    [    7.810000] 1da0: 60000013 ffffffff
    [    7.810000] [<c00520c8>] (__setup_irq+0x0/0x458) from [<c0052764>] (request_threaded_irq+0xd8/0x134)
    [    7.810000] [<c005268c>] (request_threaded_irq+0x0/0x134) from [<bf090978>] (ohci_hcd_at91_drv_probe+0x180/0x41c [ohci_hcd])
    [    7.810000] [<bf0907f8>] (ohci_hcd_at91_drv_probe+0x0/0x41c [ohci_hcd]) from [<c0155b7c>] (platform_drv_probe+0x20/0x24)
    [    7.810000] [<c0155b5c>] (platform_drv_probe+0x0/0x24) from [<c0154690>] (driver_probe_device+0xb8/0x20c)
    [    7.810000] [<c01545d8>] (driver_probe_device+0x0/0x20c) from [<c015484c>] (__driver_attach+0x68/0x88)
    [    7.810000]  r7:c3a11ea0 r6:bf0911d0 r5:c02cc964 r4:c02cc930
    [    7.810000] [<c01547e4>] (__driver_attach+0x0/0x88) from [<c0152e58>] (bus_for_each_dev+0x5c/0x9c)
    [    7.810000]  r6:bf0911d0 r5:c01547e4 r4:00000000
    [    7.810000] [<c0152dfc>] (bus_for_each_dev+0x0/0x9c) from [<c01544c0>] (driver_attach+0x20/0x28)
    [    7.810000]  r7:c02d7518 r6:00000000 r5:bf0911d0 r4:c2c10540
    [    7.810000] [<c01544a0>] (driver_attach+0x0/0x28) from [<c01536cc>] (bus_add_driver+0xb4/0x22c)
    [    7.810000] [<c0153618>] (bus_add_driver+0x0/0x22c) from [<c0154e9c>] (driver_register+0xa8/0x144)
    [    7.810000]  r7:00000000 r6:bf0911d0 r5:bf09120c r4:bf049af0
    [    7.810000] [<c0154df4>] (driver_register+0x0/0x144) from [<c0155f58>] (platform_driver_register+0x4c/0x60)
    [    7.810000]  r7:00000000 r6:000ae190 r5:bf09120c r4:bf049af0
    [    7.810000] [<c0155f0c>] (platform_driver_register+0x0/0x60) from [<bf093054>] (ohci_hcd_mod_init+0x54/0x8c [ohci_hcd])
    [    7.810000] [<bf093000>] (ohci_hcd_mod_init+0x0/0x8c [ohci_hcd]) from [<c0008638>] (do_one_initcall+0xac/0x174)
    [    7.810000]  r4:00006a4f
    [    7.810000] [<c000858c>] (do_one_initcall+0x0/0x174) from [<c004fdc4>] (sys_init_module+0x7c/0x1a0)
    [    7.810000] [<c004fd48>] (sys_init_module+0x0/0x1a0) from [<c0009260>] (ret_fast_syscall+0x0/0x2c)
    [    7.810000]  r7:00000080 r6:000ad018 r5:00016eb8 r4:00006a4f
    [    7.810000] Code: e24cb004 e59f3028 e1a02000 e7930180 (e5903028)
    [    7.810000] ---[ end trace 85aa37ed128143b5 ]---
    [    7.810000] Kernel panic - not syncing: Fatal exception in interrupt
    
    Commit 6fffb77c (USB: ohci-at91: fix PIO handling in relation with number of
    ports) started setting unused pins to EINVAL. But this exposed a bug in the
    ohci_hcd_at91_overcurrent_irq function where the gpio was used without being
    checked to see if it is valid.
    
    This patches fixed the issue by adding the gpio valid check.
    
    Signed-off-by: Joachim Eastwood <joachim.eastwood@jotron.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit feab18eb28ec4c93c0762b7407b616d19ab9ad8b
Author: Stanislav Kinsbursky <skinsbursky@parallels.com>
Date:   Wed Apr 25 18:22:40 2012 +0400

    LockD: pass service to per-net up and down functions
    
    commit 4db77695bf5738bdafa83d1b58b64cbecc6f55e7 upstream.
    
    Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com>
    Signed-off-by: J. Bruce Fields <bfields@redhat.com>
    Cc: Jason Wessel <jason.wessel@windriver.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 97ed537eaa6ff11c9a1df342364e25d0996bc117
Author: Tejun Heo <tj@kernel.org>
Date:   Thu Jul 19 13:52:53 2012 -0700

    kthread_worker: reimplement flush_kthread_work() to allow freeing the work item being executed
    
    commit 46f3d976213452350f9d10b0c2780c2681f7075b upstream.
    
    kthread_worker provides minimalistic workqueue-like interface for
    users which need a dedicated worker thread (e.g. for realtime
    priority).  It has basic queue, flush_work, flush_worker operations
    which mostly match the workqueue counterparts; however, due to the way
    flush_work() is implemented, it has a noticeable difference of not
    allowing work items to be freed while being executed.
    
    While the current users of kthread_worker are okay with the current
    behavior, the restriction does impede some valid use cases.  Also,
    removing this difference isn't difficult and actually makes the code
    easier to understand.
    
    This patch reimplements flush_kthread_work() such that it uses a
    flush_work item instead of queue/done sequence numbers.
    
    Signed-off-by: Tejun Heo <tj@kernel.org>
    Cc: Colin Cross <ccross@google.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 34b6567e91b3ff6209c16b3868ec95e0e1cddc1f
Author: Tejun Heo <tj@kernel.org>
Date:   Thu Jul 19 13:52:53 2012 -0700

    kthread_worker: reorganize to prepare for flush_kthread_work() reimplementation
    
    commit 9a2e03d8ed518a61154f18d83d6466628e519f94 upstream.
    
    Make the following two non-functional changes.
    
    * Separate out insert_kthread_work() from queue_kthread_work().
    
    * Relocate struct kthread_flush_work and kthread_flush_work_fn()
      definitions above flush_kthread_work().
    
    v2: Added lockdep_assert_held() in insert_kthread_work() as suggested
        by Andy Walls.
    
    Signed-off-by: Tejun Heo <tj@kernel.org>
    Acked-by: Andy Walls <awalls@md.metrocast.net>
    Cc: Colin Cross <ccross@google.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c717dcaf750cd0a43609d8c2016a380e542b28ed
Author: Stanislav Kinsbursky <skinsbursky@parallels.com>
Date:   Tue Jul 3 16:46:41 2012 +0400

    NFSd: set nfsd_serv to NULL after service destruction
    
    commit 57c8b13e3cd0f94944c9691ce7f58e5fcef8a12d upstream.
    
    In nfsd_destroy():
    
            if (destroy)
                    svc_shutdown_net(nfsd_serv, net);
            svc_destroy(nfsd_server);
    
    svc_shutdown_net(nfsd_serv, net) calls nfsd_last_thread(), which sets
    nfsd_serv to NULL, causing a NULL dereference on the following line.
    
    Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com>
    Signed-off-by: J. Bruce Fields <bfields@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6a4ebdb6be2ac2ad0e03ca9131573a1f0eadd7d5
Author: Stanislav Kinsbursky <skinsbursky@parallels.com>
Date:   Tue Jul 3 16:46:41 2012 +0400

    NFSd: introduce nfsd_destroy() helper
    
    commit 19f7e2ca44dfc3c1b3f499fc46801f98d403500f upstream.
    
    Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com>
    Signed-off-by: J. Bruce Fields <bfields@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1d22d5660b961c6b36fa361e1e394f64b068c763
Author: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
Date:   Wed Sep 12 09:05:22 2012 +0200

    UBI: fix a horrible memory deallocation bug
    
    commit 78b495c39add820ab66ab897af9bd77a5f2e91f6 upstream
    
    UBI was mistakingly using 'kfree()' instead of 'kmem_cache_free()' when
    freeing "attach eraseblock" structures in vtbl.c. Thankfully, this happened
    only when we were doing auto-format, so many systems were unaffected. However,
    there are still many users affected.
    
    It is strange, but the system did not crash and nothing bad happened when
    the SLUB memory allocator was used. However, in case of SLOB we observed an
    crash right away.
    
    This problem was introduced in 2.6.39 by commit
    "6c1e875 UBI: add slab cache for ubi_scan_leb objects"
    
    Reported-by: Richard Genoud <richard.genoud@gmail.com>
    Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
    Signed-off-by: Richard Genoud <richard.genoud@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 77d13a088343c507a8d5bb924abc730c603f1f6b
Author: Seth Forshee <seth.forshee@canonical.com>
Date:   Wed Aug 8 08:27:03 2012 -0500

    irq_remap: disable IRQ remapping if any IOAPIC lacks an IOMMU
    
    commit 32ab31e01e2def6f48294d872d9bb42573aae00f upstream.
    
    The ACPI tables in the Macbook Air 5,1 define a single IOAPIC with id 2,
    but the only remapping unit described in the DMAR table matches id 0.
    Interrupt remapping fails as a result, and the kernel panics with the
    message "timer doesn't work through Interrupt-remapped IO-APIC."
    
    To fix this, check each IOAPIC for a corresponding IOMMU. If an IOMMU is
    not found, do not allow IRQ remapping to be enabled.
    
    v2: Move check to parse_ioapics_under_ir(), raise log level to KERN_ERR,
        and add FW_BUG to the log message
    v3: Skip check if IOMMU doesn't support interrupt remapping and remove
        existing check that the IOMMU count equals the IOAPIC count
    
    Acked-by: Suresh Siddha <suresh.b.siddha@intel.com>
    Signed-off-by: Seth Forshee <seth.forshee@canonical.com>
    Acked-by: Yinghai Lu <yinghai@kernel.org>
    Signed-off-by: Joerg Roedel <joerg.roedel@amd.com>
    Acked-by: Cho, Yu-Chen <acho@suse.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 49194d4e7d8c14fb83f213c54a476685f8389c70
Author: Satoru Moriya <satoru.moriya@hds.com>
Date:   Tue May 29 15:06:47 2012 -0700

    mm: avoid swapping out with swappiness==0
    
    commit fe35004fbf9eaf67482b074a2e032abb9c89b1dd upstream.
    
    Sometimes we'd like to avoid swapping out anonymous memory.  In
    particular, avoid swapping out pages of important process or process
    groups while there is a reasonable amount of pagecache on RAM so that we
    can satisfy our customers' requirements.
    
    OTOH, we can control how aggressive the kernel will swap memory pages with
    /proc/sys/vm/swappiness for global and
    /sys/fs/cgroup/memory/memory.swappiness for each memcg.
    
    But with current reclaim implementation, the kernel may swap out even if
    we set swappiness=0 and there is pagecache in RAM.
    
    This patch changes the behavior with swappiness==0.  If we set
    swappiness==0, the kernel does not swap out completely (for global reclaim
    until the amount of free pages and filebacked pages in a zone has been
    reduced to something very very small (nr_free + nr_filebacked < high
    watermark)).
    
    Signed-off-by: Satoru Moriya <satoru.moriya@hds.com>
    Acked-by: Minchan Kim <minchan@kernel.org>
    Reviewed-by: Rik van Riel <riel@redhat.com>
    Acked-by: Jerome Marchand <jmarchan@redhat.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 642550436c8b3a933550468996ef547630344a0e
Author: Bjørn Mork <bjorn@mork.no>
Date:   Thu Aug 23 12:13:58 2012 +0200

    net: qmi_wwan: new devices: UML290 and K5006-Z
    
    commit 10cbc1d97a7c7f9ae862fffe27b771ef0da9c461 upstream.
    
    Newer firmware versions for the Pantech UML290 use a different
    subclass ID.  The Windows driver match on both IDs, so we do
    that as well.
    
    The ZTE (Vodafone) K5006-Z is a new device.
    
    Signed-off-by: Bjørn Mork <bjorn@mork.no>
    Cc: Dan Williams <dcbw@redhat.com>
    Cc: Thomas Schäfer <tschaefer@t-online.de>
    [bmork: backported to 3.4: use driver whitelisting]
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8d3362715e0c0d29274b1689d87914e7c64f0032
Author: Bjørn Mork <bjorn@mork.no>
Date:   Thu Aug 23 12:13:57 2012 +0200

    net: qmi_wwan: add Sierra Wireless devices
    
    commit 9b469a60d68b13c288d5c3fc23de29d9d482dbe6 upstream.
    
    Add 6 new devices and one modified device, based on
    information from laptop vendor Windows drivers.
    
    Sony provides a driver with two new devices using
    a Gobi 2k+ layout (1199:68a5 and 1199:68a9).  The
    Sony driver also adds a non-standard QMI/net
    interface to the already supported 1199:9011
    Gobi device. We do not know whether this is an
    alternate interface number or an additional
    interface which might be present, but that doesn't
    really matter.
    
    Lenovo provides a driver supporting 4 new devices:
     - MC7770 (1199:901b) with standard Gobi 2k+ layout
     - MC7700 (0f3d:68a2) with layout similar to MC7710
     - MC7750 (114f:68a2) with layout similar to MC7710
     - EM7700 (1199:901c) with layout similar to MC7710
    
    Note regaring the three devices similar to MC7710:
    
    The Windows drivers only support interface #8 on these
    devices.  The MC7710 can support QMI/net functions on
    interface #19 and #20 as well, and this driver is
    verified to work on interface #19 (a firmware bug is
    suspected to prevent #20 from working).
    
    We do not enable these additional interfaces until they
    either show up in a Windows driver or are verified to
    work in some other way.  Therefore limiting the new
    devices to interface #8 for now.
    
    [bmork: backported to 3.4: use driver whitelisting]
    Signed-off-by: Bjørn Mork <bjorn@mork.no>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e7861ce75b60e23d4d0a0b08c6f20fb3dc236c26
Author: Bjørn Mork <bjorn@mork.no>
Date:   Thu Jul 12 01:18:26 2012 +0000

    net: qmi_wwan: add ZTE MF821D
    
    commit db8dacf953a70274172236957a4b97d4fdb376f0 upstream.
    
    Sold by O2 (telefonica germany) under the name "LTE4G"
    
    Tested-by: Thomas Schäfer <tschaefer@t-online.de>
    Signed-off-by: Bjørn Mork <bjorn@mork.no>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e7f558cc5068b40428b048d8e6e338fef29fd5ee
Author: Bjørn Mork <bjorn@mork.no>
Date:   Thu Jul 5 01:13:33 2012 +0000

    net: qmi_wwan: add ZTE MF60
    
    commit 6fecd35d4cd79fc75e8290abb86734c18500d2a2 upstream.
    
    Adding a device with limited QMI support. It does not support
    normal QMI_WDS commands for connection management. Instead,
    sending a QMI_CTL SET_INSTANCE_ID command is required to
    enable the network interface:
    
      01 0f 00 00 00 00 00 00  20 00 04 00 01 01 00 00
    
    A number of QMI_DMS and QMI_NAS commands are also supported
    for optional device management.
    
    Signed-off-by: Bjørn Mork <bjorn@mork.no>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bf5ebae622cc4b0df483488ec8648831705f6465
Author: Bjørn Mork <bjorn@mork.no>
Date:   Wed May 23 23:19:32 2012 +0000

    net: qmi_wwan: Add Sierra Wireless device IDs
    
    commit 5e071b5d1aa6928f8d695c15f52a949d70b8d7fb upstream.
    
    Some additional Gobi3K IDs found in the BSD/GPL licensed
    out-of-tree GobiNet driver from Sierra Wireless.
    
    Signed-off-by: Bjørn Mork <bjorn@mork.no>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4bf003851ca52d2b1cb6f96817f7fe335e1fd849
Author: Andrew Bird (Sphere Systems) <ajb@spheresystems.co.uk>
Date:   Sat May 19 22:28:37 2012 +0000

    USB: qmi_wwan: Add ZTE (Vodafone) K3765-Z
    
    commit 8965c98fdebedce077257241957b205515dd1a5f upstream.
    
    Add the ZTE (Vodafone) K3765-Z to the whitelist. This requires the
    previous patch to make the whitelist with forced interface 4 generic
    or the device fails to initialise. After applying this patch and
    loading the Option driver without usb-modeswitch's bind all
    interfaces trick, a wwan0 net interface and /dev/cdc-wdm0 device
    file were created. Using Bjorn Mork's perl connection script a
    connection was made to a mobile network using QMI and the network
    interface's IPv4 address was configured OK.
    
    Signed-off-by: Andrew Bird <ajb@spheresystems.co.uk>
    Acked-by: Bjørn Mork <bjorn@mork.no>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 11cbc507a8451655bd0445a0ca8f9018ce8d20a1
Author: Bjørn Mork <bjorn@mork.no>
Date:   Sat May 19 07:20:31 2012 +0000

    net: qmi_wwan: Add Vodafone/Huawei K5005 support
    
    commit 88c16dc3bb61a1c1e9d4c78f45cc2107bc8d5249 upstream.
    
    Tested-by: Thomas Schäfer <tschaefer@t-online.de>
    Signed-off-by: Bjørn Mork <bjorn@mork.no>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 61df44523230af4f6aaeb4b0aa8131c74cc47ec3
Author: Darren Hart <dvhart@linux.intel.com>
Date:   Tue Jun 19 14:00:18 2012 -0700

    pch_uart: Add eg20t_port lock field, avoid recursive spinlocks
    
    commit 2588aba002d14e938c2f56d299ecf3e7ce1302a5 upstream.
    
    pch_uart_interrupt() takes priv->port.lock which leads to two recursive
    spinlock calls if low_latency==1 or CONFIG_PREEMPT_RT_FULL=y (one
    otherwise):
    
    pch_uart_interrupt
      spin_lock_irqsave(priv->port.lock, flags)
      case PCH_UART_IID_RDR_TO (data ready)
      handle_rx_to
        push_rx
          tty_port_tty_get
            spin_lock_irqsave(&port->lock, flags) <--- already hold this lock
            ...
          tty_flip_buffer_push
            ...
            flush_to_ldisc
              spin_lock_irqsave(&tty->buf.lock)
                spin_lock_irqsave(&tty->buf.lock)
                disc->ops->receive_buf(tty, char_buf)
                  n_tty_receive_buf
                    tty->ops->flush_chars()
                    uart_flush_chars
                      uart_start
                        spin_lock_irqsave(&port->lock) <--- already hold this lock
    
    Avoid this by using a dedicated lock to protect the eg20t_port structure
    and IO access to its membase. This is more consistent with the 8250
    driver.  Ensure priv->lock is always take prior to priv->port.lock when
    taken at the same time.
    
    V2: Remove inadvertent whitespace change.
    V3: Account for oops_in_progress for the private lock in
        pch_console_write().
    
    Note: Like the 8250 driver, if a printk is introduced anywhere inside
          the pch_console_write() critical section, the kernel will hang
          on a recursive spinlock on the private lock. The oops case is
          handled by using a trylock in the oops_in_progress case.
    
    Signed-off-by: Darren Hart <dvhart@linux.intel.com>
    CC: Tomoya MORINAGA <tomoya.rohm@gmail.com>
    CC: Feng Tang <feng.tang@intel.com>
    CC: Alexander Stein <alexander.stein@systec-electronic.com>
    Acked-by: Alan Cox <alan@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cb2184097168d9ee97126d8284a501759f6d1367
Author: Timur Tabi <timur@freescale.com>
Date:   Mon Jul 23 15:43:32 2012 -0500

    powerpc/85xx: p1022ds: fix DIU/LBC switching with NAND enabled
    
    commit 896c01cb4bb3cfc2c0ea9873fa7a9f8bd0a7c8d8 upstream.
    
    In order for indirect mode on the PIXIS to work properly, both chip selects
    need to be set to GPCM mode, otherwise writes to the chip select base
    addresses will not actually post to the local bus -- they'll go to the
    NAND controller instead.  Therefore, we need to set BR0 and BR1 to GPCM
    mode before switching to indirect mode.
    
    Signed-off-by: Timur Tabi <timur@freescale.com>
    Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e85f60c9fc3d5ecc66e6598c0e487aa5c4b7feeb
Author: Timur Tabi <timur@freescale.com>
Date:   Fri Jul 13 14:28:42 2012 -0500

    powerpc/85xx: p1022ds: disable the NAND flash node if video is enabled
    
    commit 6269f2584a359766f53005c676daff8aee60cbed upstream.
    
    The Freescale P1022 has a unique pin muxing "feature" where the DIU video
    controller's video signals are muxed with 24 of the local bus address signals.
    When the DIU is enabled, the bulk of the local bus is disabled, preventing
    access to memory-mapped devices like NAND flash and the pixis FPGA.
    
    Therefore, if the DIU is going to be enabled, then memory-mapped devices on
    the localbus, like NAND flash, need to be disabled.
    
    This patch is similar to "powerpc/85xx: p1022ds: disable the NOR flash node
    if video is enabled", except that it disables the NAND flash node instead.
    This PIXIS node needs to remain enabled because it is used by platform code
    to switch into indirect mode.
    
    Signed-off-by: Timur Tabi <timur@freescale.com>
    Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3dcb53637949c288a1ff2a06ee3c0a212ace6ef1
Author: Tomoya MORINAGA <tomoya.rohm@gmail.com>
Date:   Fri Jul 6 17:19:43 2012 +0900

    pch_uart: Fix parity setting issue
    
    commit 38bd2a1ac736901d1cf4971c78ef952ba92ef78b upstream.
    
    Parity Setting value is reverse.
    E.G. In case of setting ODD parity, EVEN value is set.
    This patch inverts "if" condition.
    
    Signed-off-by: Tomoya MORINAGA <tomoya.rohm@gmail.com>
    Acked-by: Alan Cox <alan@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 439ec7b975d17a097414671ef2aaa6037448c3f6
Author: Tomoya MORINAGA <tomoya.rohm@gmail.com>
Date:   Fri Jul 6 17:19:42 2012 +0900

    pch_uart: Fix rx error interrupt setting issue
    
    commit 9539dfb7ac1c84522fe1f79bb7dac2990f3de44a upstream.
    
    Rx Error interrupt(E.G. parity error) is not enabled.
    So, when parity error occurs, error interrupt is not occurred.
    As a result, the received data is not dropped.
    
    This patch adds enable/disable rx error interrupt code.
    
    Signed-off-by: Tomoya MORINAGA <tomoya.rohm@gmail.com>
    Acked-by: Alan Cox <alan@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 17361b3edc6e84fbbc996ad9bb350be41739f457
Author: Alan Cox <alan@linux.intel.com>
Date:   Mon Jul 2 18:51:38 2012 +0100

    pch_uart: Fix missing break for 16 byte fifo
    
    commit 9bc03743fff0770dc5a5324ba92e67cc377f16ca upstream.
    
    Otherwise we fall back to the wrong value.
    
    Reported-by: <dcb314@hotmail.com>
    Resolves-bug: https://bugzilla.kernel.org/show_bug.cgi?id=44091
    Signed-off-by: Alan Cox <alan@linux.intel.com>
    Signed-off-by: Tomoya MORINAGA <tomoya.rohm@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a31c99713bb3e130d34039a7a073a9d815af90a0
Author: Douglas Bagnall <douglas@paradise.net.nz>
Date:   Fri Jul 6 23:27:57 2012 -0300

    media: Avoid sysfs oops when an rc_dev's raw device is absent
    
    commit 720bb6436ff30fccad05cf5bdf961ea5b1f5686d upstream.
    
    For some reason, when the lirc daemon learns that a usb remote control
    has been unplugged, it wants to read the sysfs attributes of the
    disappearing device. This is useful for uncovering transient
    inconsistencies, but less so for keeping the system running when such
    inconsistencies exist.
    
    Under some circumstances (like every time I unplug my dvb stick from
    my laptop), lirc catches an rc_dev whose raw event handler has been
    removed (presumably by ir_raw_event_unregister), and proceeds to
    interrogate the raw protocols supported by the NULL pointer.
    
    This patch avoids the NULL dereference, and ignores the issue of how
    this state of affairs came about in the first place.
    
    Version 2 incorporates changes recommended by Mauro Carvalho Chehab
    (-ENODEV instead of -EINVAL, and a signed-off-by).
    
    Signed-off-by: Douglas Bagnall <douglas@paradise.net.nz>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
    Cc: Herton Ronaldo Krzesinski <herton.krzesinski@canonical.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9a227fcb842a03fce5b8a6da0da40f5601ec6908
Author: John Stultz <john.stultz@linaro.org>
Date:   Tue Sep 11 15:04:19 2012 -0400

    time: Move ktime_t overflow checking into timespec_valid_strict
    
    commit cee58483cf56e0ba355fdd97ff5e8925329aa936 upstream
    
    Andreas Bombe reported that the added ktime_t overflow checking added to
    timespec_valid in commit 4e8b14526ca7 ("time: Improve sanity checking of
    timekeeping inputs") was causing problems with X.org because it caused
    timeouts larger then KTIME_T to be invalid.
    
    Previously, these large timeouts would be clamped to KTIME_MAX and would
    never expire, which is valid.
    
    This patch splits the ktime_t overflow checking into a new
    timespec_valid_strict function, and converts the timekeeping codes
    internal checking to use this more strict function.
    
    Reported-and-tested-by: Andreas Bombe <aeb@debian.org>
    Cc: Zhouping Liu <zliu@redhat.com>
    Cc: Ingo Molnar <mingo@kernel.org>
    Cc: Prarit Bhargava <prarit@redhat.com>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: John Stultz <john.stultz@linaro.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: John Stultz <john.stultz@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 80257cbe62ea0919153c43421746269ab68473bf
Author: John Stultz <john.stultz@linaro.org>
Date:   Tue Sep 11 15:04:18 2012 -0400

    time: Avoid making adjustments if we haven't accumulated anything
    
    commit bf2ac312195155511a0f79325515cbb61929898a upstream.
    
    If update_wall_time() is called and the current offset isn't large
    enough to accumulate, avoid re-calling timekeeping_adjust which may
    change the clock freq and can cause 1ns inconsistencies with
    CLOCK_REALTIME_COARSE/CLOCK_MONOTONIC_COARSE.
    
    Signed-off-by: John Stultz <john.stultz@linaro.org>
    Cc: Prarit Bhargava <prarit@redhat.com>
    Cc: Ingo Molnar <mingo@kernel.org>
    Link: http://lkml.kernel.org/r/1345595449-34965-5-git-send-email-john.stultz@linaro.org
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: John Stultz <john.stultz@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8e878154f5658ba93cf9bb2b491a930ec195de3d
Author: John Stultz <john.stultz@linaro.org>
Date:   Tue Sep 11 15:04:17 2012 -0400

    time: Improve sanity checking of timekeeping inputs
    
    commit 4e8b14526ca7fb046a81c94002c1c43b6fdf0e9b upstream.
    
    Unexpected behavior could occur if the time is set to a value large
    enough to overflow a 64bit ktime_t (which is something larger then the
    year 2262).
    
    Also unexpected behavior could occur if large negative offsets are
    injected via adjtimex.
    
    So this patch improves the sanity check timekeeping inputs by
    improving the timespec_valid() check, and then makes better use of
    timespec_valid() to make sure we don't set the time to an invalid
    negative value or one that overflows ktime_t.
    
    Note: This does not protect from setting the time close to overflowing
    ktime_t and then letting natural accumulation cause the overflow.
    
    Reported-by: CAI Qian <caiqian@redhat.com>
    Reported-by: Sasha Levin <levinsasha928@gmail.com>
    Signed-off-by: John Stultz <john.stultz@linaro.org>
    Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
    Cc: Prarit Bhargava <prarit@redhat.com>
    Cc: Zhouping Liu <zliu@redhat.com>
    Cc: Ingo Molnar <mingo@kernel.org>
    Link: http://lkml.kernel.org/r/1344454580-17031-1-git-send-email-john.stultz@linaro.org
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: John Stultz <john.stultz@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 504471eb5044e4a1dd10950d1a3efab39ba2083a
Author: Jarod Wilson <jarod@redhat.com>
Date:   Mon Jun 4 13:05:24 2012 -0300

    media: lirc_sir: make device registration work
    
    commit 4b71ca6bce8fab3d08c61bf330e781f957934ae1 upstream.
    
    For one, the driver device pointer needs to be filled in, or the lirc core
    will refuse to load the driver. And we really need to wire up all the
    platform_device bits. This has been tested via the lirc sourceforge tree
    and verified to work, been sitting there for months, finally getting
    around to sending it. :\
    
    Signed-off-by: Jarod Wilson <jarod@redhat.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
    CC: Josh Boyer <jwboyer@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 391c314928c37b0c946061c0adddd5bd5730c8b7
Author: Yinghai Lu <yinghai@kernel.org>
Date:   Wed Jul 11 14:02:53 2012 -0700

    mm: sparse: fix usemap allocation above node descriptor section
    
    commit 99ab7b19440a72ebdf225f99b20f8ef40decee86 upstream.
    
    After commit f5bf18fa22f8 ("bootmem/sparsemem: remove limit constraint
    in alloc_bootmem_section"), usemap allocations may easily be placed
    outside the optimal section that holds the node descriptor, even if
    there is space available in that section.  This results in unnecessary
    hotplug dependencies that need to have the node unplugged before the
    section holding the usemap.
    
    The reason is that the bootmem allocator doesn't guarantee a linear
    search starting from the passed allocation goal but may start out at a
    much higher address absent an upper limit.
    
    Fix this by trying the allocation with the limit at the section end,
    then retry without if that fails.  This keeps the fix from f5bf18fa22f8
    of not panicking if the allocation does not fit in the section, but
    still makes sure to try to stay within the section at first.
    
    [rewritten massively by Johannes to apply to 3.4]
    
    Signed-off-by: Yinghai Lu <yinghai@kernel.org>
    Signed-off-by: Johannes Weiner <hannes@cmpxchg.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit e194fab8d7ebe95db5609f1cb6794c2afcc3118f
Author: Peter Zijlstra <peterz@infradead.org>
Date:   Fri Jun 22 13:36:05 2012 +0200

    sched: Fix race in task_group()
    
    commit 8323f26ce3425460769605a6aece7a174edaa7d1 upstream.
    
    Stefan reported a crash on a kernel before a3e5d1091c1 ("sched:
    Don't call task_group() too many times in set_task_rq()"), he
    found the reason to be that the multiple task_group()
    invocations in set_task_rq() returned different values.
    
    Looking at all that I found a lack of serialization and plain
    wrong comments.
    
    The below tries to fix it using an extra pointer which is
    updated under the appropriate scheduler locks. Its not pretty,
    but I can't really see another way given how all the cgroup
    stuff works.
    
    Reported-and-tested-by: Stefan Bader <stefan.bader@canonical.com>
    Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl>
    Link: http://lkml.kernel.org/r/1340364965.18025.71.camel@twins
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6418cc471b5d8a64ce22d2aa827fcb275e61449c
Author: Francois Romieu <romieu@fr.zoreil.com>
Date:   Wed Jun 20 12:09:18 2012 +0000

    r8169: RxConfig hack for the 8168evl.
    
    commit eb2dc35d99028b698cdedba4f5522bc43e576bd2 upstream.
    
    The 8168evl (RTL_GIGA_MAC_VER_34) based Gigabyte GA-990FXA motherboards
    are very prone to NETDEV watchdog problems without this change. See
    https://bugzilla.kernel.org/show_bug.cgi?id=42899 for instance.
    
    I don't know why it *works*. It's depressingly effective though.
    
    For the record:
    - the problem may go along IOMMU (AMD-Vi) errors but it really looks
      like a red herring.
    - the patch sets the RX_MULTI_EN bit. If the 8168c doc is any guide,
      the chipset now fetches several Rx descriptors at a time.
    - long ago the driver ignored the RX_MULTI_EN bit.
      e542a2269f232d61270ceddd42b73a4348dee2bb changed the RxConfig
      settings. Whatever the problem it's now labeled a regression.
    - Realtek's own driver can identify two different 8168evl devices
      (CFG_METHOD_16 and CFG_METHOD_17) where the r8169 driver only
      sees one. It sucks.
    
    Signed-off-by: Francois Romieu <romieu@fr.zoreil.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit 9dd30d194e2e83be4e14d7b4bdf21087f389318b
Author: Daniel J Blueman <daniel@quora.org>
Date:   Mon Jul 23 12:22:37 2012 +0800

    libata: Prevent interface errors with Seagate FreeAgent GoFlex
    
    commit c531077f40abc9f2129c4c83a30b3f8d6ce1c0e7 upstream.
    
    When using my Seagate FreeAgent GoFlex eSATAp external disk enclosure,
    interface errors are always seen until 1.5Gbps is negotiated [1]. This
    occurs using any disk in the enclosure, and when the disk is connected
    directly with a generic passive eSATAp cable, we see stable 3Gbps
    operation as expected.
    
    Blacklist 3Gbps mode to avoid dataloss and the ~30s delay bus reset
    and renegotiation incurs.
    
    Signed-off-by: Daniel J Blueman <daniel@quora.org>
    Signed-off-by: Jeff Garzik <jgarzik@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b2c1fcae0409fec6d96351fe2793a502870f4370
Author: Weiping Pan <wpan@redhat.com>
Date:   Mon Jul 23 10:37:48 2012 +0800

    rds: set correct msg_namelen
    
    commit 06b6a1cf6e776426766298d055bb3991957d90a7 upstream.
    
    Jay Fenlason (fenlason@redhat.com) found a bug,
    that recvfrom() on an RDS socket can return the contents of random kernel
    memory to userspace if it was called with a address length larger than
    sizeof(struct sockaddr_in).
    rds_recvmsg() also fails to set the addr_len paramater properly before
    returning, but that's just a bug.
    There are also a number of cases wher recvfrom() can return an entirely bogus
    address. Anything in rds_recvmsg() that returns a non-negative value but does
    not go through the "sin = (struct sockaddr_in *)msg->msg_name;" code path
    at the end of the while(1) loop will return up to 128 bytes of kernel memory
    to userspace.
    
    And I write two test programs to reproduce this bug, you will see that in
    rds_server, fromAddr will be overwritten and the following sock_fd will be
    destroyed.
    Yes, it is the programmer's fault to set msg_namelen incorrectly, but it is
    better to make the kernel copy the real length of address to user space in
    such case.
    
    How to run the test programs ?
    I test them on 32bit x86 system, 3.5.0-rc7.
    
    1 compile
    gcc -o rds_client rds_client.c
    gcc -o rds_server rds_server.c
    
    2 run ./rds_server on one console
    
    3 run ./rds_client on another console
    
    4 you will see something like:
    server is waiting to receive data...
    old socket fd=3
    server received data from client:data from client
    msg.msg_namelen=32
    new socket fd=-1067277685
    sendmsg()
    : Bad file descriptor
    
    /***************** rds_client.c ********************/
    
    int main(void)
    {
            int sock_fd;
            struct sockaddr_in serverAddr;
            struct sockaddr_in toAddr;
            char recvBuffer[128] = "data from client";
            struct msghdr msg;
            struct iovec iov;
    
            sock_fd = socket(AF_RDS, SOCK_SEQPACKET, 0);
            if (sock_fd < 0) {
                    perror("create socket error\n");
                    exit(1);
            }
    
            memset(&serverAddr, 0, sizeof(serverAddr));
            serverAddr.sin_family = AF_INET;
            serverAddr.sin_addr.s_addr = inet_addr("127.0.0.1");
            serverAddr.sin_port = htons(4001);
    
            if (bind(sock_fd, (struct sockaddr*)&serverAddr, sizeof(serverAddr)) < 0) {
                    perror("bind() error\n");
                    close(sock_fd);
                    exit(1);
            }
    
            memset(&toAddr, 0, sizeof(toAddr));
            toAddr.sin_family = AF_INET;
            toAddr.sin_addr.s_addr = inet_addr("127.0.0.1");
            toAddr.sin_port = htons(4000);
            msg.msg_name = &toAddr;
            msg.msg_namelen = sizeof(toAddr);
            msg.msg_iov = &iov;
            msg.msg_iovlen = 1;
            msg.msg_iov->iov_base = recvBuffer;
            msg.msg_iov->iov_len = strlen(recvBuffer) + 1;
            msg.msg_control = 0;
            msg.msg_controllen = 0;
            msg.msg_flags = 0;
    
            if (sendmsg(sock_fd, &msg, 0) == -1) {
                    perror("sendto() error\n");
                    close(sock_fd);
                    exit(1);
            }
    
            printf("client send data:%s\n", recvBuffer);
    
            memset(recvBuffer, '\0', 128);
    
            msg.msg_name = &toAddr;
            msg.msg_namelen = sizeof(toAddr);
            msg.msg_iov = &iov;
            msg.msg_iovlen = 1;
            msg.msg_iov->iov_base = recvBuffer;
            msg.msg_iov->iov_len = 128;
            msg.msg_control = 0;
            msg.msg_controllen = 0;
            msg.msg_flags = 0;
            if (recvmsg(sock_fd, &msg, 0) == -1) {
                    perror("recvmsg() error\n");
                    close(sock_fd);
                    exit(1);
            }
    
            printf("receive data from server:%s\n", recvBuffer);
    
            close(sock_fd);
    
            return 0;
    }
    
    /***************** rds_server.c ********************/
    
    int main(void)
    {
            struct sockaddr_in fromAddr;
            int sock_fd;
            struct sockaddr_in serverAddr;
            unsigned int addrLen;
            char recvBuffer[128];
            struct msghdr msg;
            struct iovec iov;
    
            sock_fd = socket(AF_RDS, SOCK_SEQPACKET, 0);
            if(sock_fd < 0) {
                    perror("create socket error\n");
                    exit(0);
            }
    
            memset(&serverAddr, 0, sizeof(serverAddr));
            serverAddr.sin_family = AF_INET;
            serverAddr.sin_addr.s_addr = inet_addr("127.0.0.1");
            serverAddr.sin_port = htons(4000);
            if (bind(sock_fd, (struct sockaddr*)&serverAddr, sizeof(serverAddr)) < 0) {
                    perror("bind error\n");
                    close(sock_fd);
                    exit(1);
            }
    
            printf("server is waiting to receive data...\n");
            msg.msg_name = &fromAddr;
    
            /*
             * I add 16 to sizeof(fromAddr), ie 32,
             * and pay attention to the definition of fromAddr,
             * recvmsg() will overwrite sock_fd,
             * since kernel will copy 32 bytes to userspace.
             *
             * If you just use sizeof(fromAddr), it works fine.
             * */
            msg.msg_namelen = sizeof(fromAddr) + 16;
            /* msg.msg_namelen = sizeof(fromAddr); */
            msg.msg_iov = &iov;
            msg.msg_iovlen = 1;
            msg.msg_iov->iov_base = recvBuffer;
            msg.msg_iov->iov_len = 128;
            msg.msg_control = 0;
            msg.msg_controllen = 0;
            msg.msg_flags = 0;
    
            while (1) {
                    printf("old socket fd=%d\n", sock_fd);
                    if (recvmsg(sock_fd, &msg, 0) == -1) {
                            perror("recvmsg() error\n");
                            close(sock_fd);
                            exit(1);
                    }
                    printf("server received data from client:%s\n", recvBuffer);
                    printf("msg.msg_namelen=%d\n", msg.msg_namelen);
                    printf("new socket fd=%d\n", sock_fd);
                    strcat(recvBuffer, "--data from server");
                    if (sendmsg(sock_fd, &msg, 0) == -1) {
                            perror("sendmsg()\n");
                            close(sock_fd);
                            exit(1);
                    }
            }
    
            close(sock_fd);
            return 0;
    }
    
    Signed-off-by: Weiping Pan <wpan@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 11266a8e031a3782241760850f002c79ee2887e1
Author: Li Zhong <zhong@linux.vnet.ibm.com>
Date:   Tue Jul 24 15:02:49 2012 -0700

    Fix a dead loop in async_synchronize_full()
    
    [Fixed upstream by commits 2955b47d2c1983998a8c5915cb96884e67f7cb53 and
    a4683487f90bfe3049686fc5c566bdc1ad03ace6 from Dan Williams, but they are much
    more intrusive than this tiny fix, according to Andrew - gregkh]
    
    This patch tries to fix a dead loop in  async_synchronize_full(), which
    could be seen when preemption is disabled on a single cpu machine.
    
    void async_synchronize_full(void)
    {
            do {
                    async_synchronize_cookie(next_cookie);
            } while (!list_empty(&async_running) || !
    list_empty(&async_pending));
    }
    
    async_synchronize_cookie() calls async_synchronize_cookie_domain() with
    &async_running as the default domain to synchronize.
    
    However, there might be some works in the async_pending list from other
    domains. On a single cpu system, without preemption, there is no chance
    for the other works to finish, so async_synchronize_full() enters a dead
    loop.
    
    It seems async_synchronize_full() wants to synchronize all entries in
    all running lists(domains), so maybe we could just check the entry_count
    to know whether all works are finished.
    
    Currently, async_synchronize_cookie_domain() expects a non-NULL running
    list ( if NULL, there would be NULL pointer dereference ), so maybe a
    NULL pointer could be used as an indication for the functions to
    synchronize all works in all domains.
    
    Reported-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
    Signed-off-by: Li Zhong <zhong@linux.vnet.ibm.com>
    Tested-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
    Tested-by: Christian Kujau <lists@nerdbynature.de>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Dan Williams <dan.j.williams@gmail.com>
    Cc: Christian Kujau <lists@nerdbynature.de>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Cong Wang <xiyou.wangcong@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0d19c30f548369606cce202224c86cf3ae1d20ea
Author: Ezequiel Garcia <elezegarcia@gmail.com>
Date:   Wed Jul 18 13:41:11 2012 -0300

    media: cx25821: Remove bad strcpy to read-only char*
    
    commit c854d8883fec59332f0662917f8c94dcfb1c405d upstream.
    
    The strcpy was being used to set the name of the board.
    This was both wrong and redundant,
    since the destination char* was read-only and
    the name is set statically at compile time.
    
    The type of the name field is changed to const char*
    to prevent future errors.
    
    Reported-by: Radek Masin <radek@masin.eu>
    Signed-off-by: Ezequiel Garcia <elezegarcia@gmail.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e6da94be68b025bdbbee3764428769a85367aa79
Author: Rustad, Mark D <mark.d.rustad@intel.com>
Date:   Wed Jul 18 09:06:07 2012 +0000

    net: Statically initialize init_net.dev_base_head
    
    commit 734b65417b24d6eea3e3d7457e1f11493890ee1d upstream.
    
    This change eliminates an initialization-order hazard most
    recently seen when netprio_cgroup is built into the kernel.
    
    With thanks to Eric Dumazet for catching a bug.
    
    Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
    Acked-by: Eric Dumazet <edumazet@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c031edca540afb66764db24eed10eb149ac6c852
Author: Vinicius Costa Gomes <vinicius.gomes@openbossa.org>
Date:   Thu Aug 23 21:32:44 2012 -0300

    Bluetooth: Fix sending a HCI Authorization Request over LE links
    
    commit d8343f125710fb596f7a88cd756679f14f4e77b9 upstream.
    
    In the case that the link is already in the connected state and a
    Pairing request arrives from the mgmt interface, hci_conn_security()
    would be called but it was not considering LE links.
    
    Reported-by: João Paulo Rechi Vita <jprvita@openbossa.org>
    Signed-off-by: Vinicius Costa Gomes <vinicius.gomes@openbossa.org>
    Signed-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0fcc0805df9cf7483e927cf6a4dc94938318c06a
Author: Vinicius Costa Gomes <vinicius.gomes@openbossa.org>
Date:   Thu Aug 23 21:32:43 2012 -0300

    Bluetooth: Change signature of smp_conn_security()
    
    commit cc110922da7e902b62d18641a370fec01a9fa794 upstream.
    
    To make it clear that it may be called from contexts that may not have
    any knowledge of L2CAP, we change the connection parameter, to receive
    a hci_conn.
    
    This also makes it clear that it is checking the security of the link.
    
    Signed-off-by: Vinicius Costa Gomes <vinicius.gomes@openbossa.org>
    Signed-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 27d50469825fd267f44e13fb0627b011c0da6abd
Author: Andre Guedes <andre.guedes@openbossa.org>
Date:   Wed Aug 1 20:34:15 2012 -0300

    Bluetooth: Fix use-after-free bug in SMP
    
    commit 61a0cfb008f57ecf7eb28ee762952fb42dc15d15 upstream.
    
    If SMP fails, we should always cancel security_timer delayed work.
    Otherwise, security_timer function may run after l2cap_conn object
    has been freed.
    
    This patch fixes the following warning reported by ODEBUG:
    
    WARNING: at lib/debugobjects.c:261 debug_print_object+0x7c/0x8d()
    Hardware name: Bochs
    ODEBUG: free active (active state 0) object type: timer_list hint: delayed_work_timer_fn+0x0/0x27
    Modules linked in: btusb bluetooth
    Pid: 440, comm: kworker/u:2 Not tainted 3.5.0-rc1+ #4
    Call Trace:
     [<ffffffff81174600>] ? free_obj_work+0x4a/0x7f
     [<ffffffff81023eb8>] warn_slowpath_common+0x7e/0x97
     [<ffffffff81023f65>] warn_slowpath_fmt+0x41/0x43
     [<ffffffff811746b1>] debug_print_object+0x7c/0x8d
     [<ffffffff810394f0>] ? __queue_work+0x241/0x241
     [<ffffffff81174fdd>] debug_check_no_obj_freed+0x92/0x159
     [<ffffffff810ac08e>] slab_free_hook+0x6f/0x77
     [<ffffffffa0019145>] ? l2cap_conn_del+0x148/0x157 [bluetooth]
     [<ffffffff810ae408>] kfree+0x59/0xac
     [<ffffffffa0019145>] l2cap_conn_del+0x148/0x157 [bluetooth]
     [<ffffffffa001b9a2>] l2cap_recv_frame+0xa77/0xfa4 [bluetooth]
     [<ffffffff810592f9>] ? trace_hardirqs_on_caller+0x112/0x1ad
     [<ffffffffa001c86c>] l2cap_recv_acldata+0xe2/0x264 [bluetooth]
     [<ffffffffa0002b2f>] hci_rx_work+0x235/0x33c [bluetooth]
     [<ffffffff81038dc3>] ? process_one_work+0x126/0x2fe
     [<ffffffff81038e22>] process_one_work+0x185/0x2fe
     [<ffffffff81038dc3>] ? process_one_work+0x126/0x2fe
     [<ffffffff81059f2e>] ? lock_acquired+0x1b5/0x1cf
     [<ffffffffa00028fa>] ? le_scan_work+0x11d/0x11d [bluetooth]
     [<ffffffff81036fb6>] ? spin_lock_irq+0x9/0xb
     [<ffffffff81039209>] worker_thread+0xcf/0x175
     [<ffffffff8103913a>] ? rescuer_thread+0x175/0x175
     [<ffffffff8103cfe0>] kthread+0x95/0x9d
     [<ffffffff812c5054>] kernel_threadi_helper+0x4/0x10
     [<ffffffff812c36b0>] ? retint_restore_args+0x13/0x13
     [<ffffffff8103cf4b>] ? flush_kthread_worker+0xdb/0xdb
     [<ffffffff812c5050>] ? gs_change+0x13/0x13
    
    This bug can be reproduced using hctool lecc or l2test tools and
    bluetoothd not running.
    
    Signed-off-by: Andre Guedes <andre.guedes@openbossa.org>
    Signed-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 403c9ebee757d7ec82e3e06e456ae2445f0b9f40
Author: Henrik Rydberg <rydberg@euromail.se>
Date:   Sat Aug 25 19:28:06 2012 +0200

    Bluetooth: Add support for Apple vendor-specific devices
    
    commit 1fa6535faf055cd71311ab887e94fc234f04ee18 upstream.
    
    As pointed out by Gustavo and Marcel, all Apple-specific Broadcom
    devices seen so far have the same interface class, subclass and
    protocol numbers. This patch adds an entry which matches all of them,
    using the new USB_VENDOR_AND_INTERFACE_INFO() macro.
    
    In particular, this patch adds support for the MacBook Pro Retina
    (05ac:8286), which is not in the present list.
    
    Signed-off-by: Henrik Rydberg <rydberg@euromail.se>
    Tested-by: Shea Levy <shea@shealevy.com>
    Acked-by: Marcel Holtmann <marcel@holtmann.org>
    Signed-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 004251b52ce7f5079a70220b30bd99c5010f2c6e
Author: Gustavo Padovan <gustavo.padovan@collabora.co.uk>
Date:   Mon Aug 6 15:36:49 2012 -0300

    Bluetooth: Use USB_VENDOR_AND_INTERFACE() for Broadcom devices
    
    commit 92c385f46b30f4954e9dd2d2005c12d233b479ea upstream.
    
    Many Broadcom devices has a vendor specific devices class, with this rule
    we match all existent and future controllers with this behavior.
    
    We also remove old rules to that matches product id for Broadcom devices.
    
    Tested-by: John Hommel <john.hommel@hp.com>
    Signed-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ef3914b1b84739c721bcbecd0e519509ccde388c
Author: Manoj Iyer <manoj.iyer@canonical.com>
Date:   Tue Jul 10 14:07:38 2012 -0500

    Bluetooth: btusb: Add vendor specific ID (0a5c:21f4) BCM20702A0
    
    commit 61c964ba1748e984cb232b431582815899bf10fe upstream.
    
    Patch adds support for BCM20702A0 device id (0a5c:21f4).
    
    usb-devices after patch was applied:
    T: Bus=03 Lev=01 Prnt=01 Port=01 Cnt=01 Dev#= 2 Spd=12 MxCh= 0
    D: Ver= 2.00 Cls=ff(vend.) Sub=01 Prot=01 MxPS=64 #Cfgs= 1
    P: Vendor=0a5c ProdID=21f4 Rev=01.12
    S: Manufacturer=Broadcom Corp
    S: Product=BCM20702A0
    S: SerialNumber=E4D53DF154D6
    C: #Ifs= 4 Cfg#= 1 Atr=e0 MxPwr=0mA
    I: If#= 0 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=01 Prot=01 Driver=btusb
    I: If#= 1 Alt= 0 #EPs= 2 Cls=ff(vend.) Sub=01 Prot=01 Driver=btusb
    I: If#= 2 Alt= 0 #EPs= 2 Cls=ff(vend.) Sub=ff Prot=ff Driver=(none)
    I: If#= 3 Alt= 0 #EPs= 0 Cls=fe(app. ) Sub=01 Prot=01 Driver=(none)
    
    usb-devices before patch was applied:
    T: Bus=03 Lev=01 Prnt=01 Port=01 Cnt=01 Dev#= 2 Spd=12 MxCh= 0
    D: Ver= 2.00 Cls=ff(vend.) Sub=01 Prot=01 MxPS=64 #Cfgs= 1
    P: Vendor=0a5c ProdID=21f4 Rev=01.12
    S: Manufacturer=Broadcom Corp
    S: Product=BCM20702A0
    S: SerialNumber=E4D53DF154D6
    C: #Ifs= 4 Cfg#= 1 Atr=e0 MxPwr=0mA
    I: If#= 0 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=01 Prot=01 Driver=(none)
    I: If#= 1 Alt= 0 #EPs= 2 Cls=ff(vend.) Sub=01 Prot=01 Driver=(none)
    I: If#= 2 Alt= 0 #EPs= 2 Cls=ff(vend.) Sub=ff Prot=ff Driver=(none)
    I: If#= 3 Alt= 0 #EPs= 0 Cls=fe(app. ) Sub=01 Prot=01 Driver=(none)
    
    Signed-off-by: Manoj Iyer <manoj.iyer@canonical.com>
    Tested-by: Chris Gagnon <chris.gagnon@canonical.com>
    Signed-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2b3c7134014a200279e7ed31716e528cd009dfb0
Author: Jason Wang <jasowang@redhat.com>
Date:   Wed May 2 11:42:06 2012 +0800

    macvtap: zerocopy: set SKBTX_DEV_ZEROCOPY only when skb is built successfully
    
    commit 01d6657b388438def19c8baaea28e742b6ed32ec upstream.
    
    Current the SKBTX_DEV_ZEROCOPY is set unconditionally after
    zerocopy_sg_from_iovec(), this would lead NULL pointer when macvtap
    fails to build zerocopy skb because destructor_arg was not
    initialized. Solve this by set this flag after the skb were built
    successfully.
    
    Signed-off-by: Jason Wang <jasowang@redhat.com>
    Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
    Cc: Ben Hutchings <ben@decadent.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 61f26eb401b04a9312c422a5dcc7436246f37b58
Author: Jason Wang <jasowang@redhat.com>
Date:   Wed May 2 11:41:58 2012 +0800

    macvtap: zerocopy: put page when fail to get all requested user pages
    
    commit 02ce04bb3d28c3333231f43bca677228dbc686fe upstream.
    
    When get_user_pages_fast() fails to get all requested pages, we could not use
    kfree_skb() to free it as it has not been put in the skb fragments. So we need
    to call put_page() instead.
    
    Signed-off-by: Jason Wang <jasowang@redhat.com>
    Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
    Cc: Ben Hutchings <ben@decadent.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bfd1678ca0143060686d87ae0c07bebab6f0245b
Author: Jason Wang <jasowang@redhat.com>
Date:   Wed May 2 11:41:44 2012 +0800

    macvtap: zerocopy: fix truesize underestimation
    
    commit 4ef67ebedffa44ed9939b34708ac2fee06d2f65f upstream.
    
    As the skb fragment were pinned/built from user pages, we should
    account the page instead of length for truesize.
    
    Signed-off-by: Jason Wang <jasowang@redhat.com>
    Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
    Cc: Ben Hutchings <ben@decadent.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2b9ec261e3f247dc84b50263564778bcbefec79b
Author: Jason Wang <jasowang@redhat.com>
Date:   Wed May 2 11:41:30 2012 +0800

    macvtap: zerocopy: fix offset calculation when building skb
    
    commit 3afc9621f15701c557e60f61eba9242bac2771dd upstream.
    
    This patch fixes the offset calculation when building skb:
    
    - offset1 were used as skb data offset not vector offset
    - reset offset to zero only when we advance to next vector
    
    Signed-off-by: Jason Wang <jasowang@redhat.com>
    Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
    Cc: Ben Hutchings <ben@decadent.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6c9e62877051270d20e34c0c3652e36f1cc37c04
Author: Alan Cox <alan@linux.intel.com>
Date:   Tue May 15 18:44:15 2012 +0100

    x86: Fix boot on Twinhead H12Y
    
    commit 80b3e557371205566a71e569fbfcce5b11f92dbe upstream.
    
    Despite lots of investigation into why this is needed we don't
    know or have an elegant cure. The only answer found on this
    laptop is to mark a problem region as used so that Linux doesn't
    put anything there.
    
    Currently all the users add reserve= command lines and anyone
    not knowing this needs to find the magic page that documents it.
    Automate it instead.
    
    Signed-off-by: Alan Cox <alan@linux.intel.com>
    Tested-and-bugfixed-by: Arne Fitzenreiter <arne@fitzenreiter.de>
    Resolves-bug: https://bugzilla.kernel.org/show_bug.cgi?id=10231
    Link: http://lkml.kernel.org/r/20120515174347.5109.94551.stgit@bluebook
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6adebb0e1d4820435e0c6739b0de20a196cc20d5
Author: Lai Jiangshan <laijs@cn.fujitsu.com>
Date:   Sun Sep 2 00:28:19 2012 +0800

    workqueue: UNBOUND -> REBIND morphing in rebind_workers() should be atomic
    
    commit 96e65306b81351b656835c15931d1d237b252f27 upstream.
    
    The compiler may compile the following code into TWO write/modify
    instructions.
    
            worker->flags &= ~WORKER_UNBOUND;
            worker->flags |= WORKER_REBIND;
    
    so the other CPU may temporarily see worker->flags which doesn't have
    either WORKER_UNBOUND or WORKER_REBIND set and perform local wakeup
    prematurely.
    
    Fix it by using single explicit assignment via ACCESS_ONCE().
    
    Because idle workers have another WORKER_NOT_RUNNING flag, this bug
    doesn't exist for them; however, update it to use the same pattern for
    consistency.
    
    tj: Applied the change to idle workers too and updated comments and
        patch description a bit.
    
    Signed-off-by: Lai Jiangshan <laijs@cn.fujitsu.com>
    Signed-off-by: Tejun Heo <tj@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 956b165f9e89e37aff44d615321d1e3166589701
Author: NeilBrown <neilb@suse.de>
Date:   Sat Aug 18 09:51:42 2012 +1000

    md/raid10: fix problem with on-stack allocation of r10bio structure.
    
    commit e0ee778528bbaad28a5c69d2e219269a3a096607 upstream.
    
    A 'struct r10bio' has an array of per-copy information at the end.
    This array is declared with size [0] and r10bio_pool_alloc allocates
    enough extra space to store the per-copy information depending on the
    number of copies needed.
    
    So declaring a 'struct r10bio on the stack isn't going to work.  It
    won't allocate enough space, and memory corruption will ensue.
    
    So in the two places where this is done, declare a sufficiently large
    structure and use that instead.
    
    The two call-sites of this bug were introduced in 3.4 and 3.5
    so this is suitable for both those kernels.  The patch will have to
    be modified for 3.4 as it only has one bug.
    
    Reported-by: Ivan Vasilyev <ivan.vasilyev@gmail.com>
    Tested-by: Ivan Vasilyev <ivan.vasilyev@gmail.com>
    Signed-off-by: NeilBrown <neilb@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1f7edfcc0a87e5daf273981135e376ed61d284e4
Author: Wang Xingchao <xingchao.wang@intel.com>
Date:   Thu Sep 13 07:43:22 2012 +0800

    drm/i915: HDMI - Clear Audio Enable bit for Hot Plug
    
    commit b98b60167279df3acac9422c3c9820d9ebbcf9fb upstream.
    
    Clear Audio Enable bit to trigger unsolicated event to notify Audio
    Driver part the HDMI hot plug change. The patch fixed the bug when
    remove HDMI cable the bit was not cleared correctly.
    
    In intel_hdmi_dpms(), if intel_hdmi->has_audio been true, the "Audio enable bit" will
    be set to trigger unsolicated event to notify Alsa driver the change.
    
    intel_hdmi->has_audio will be reset to false from intel_hdmi_detect() after
    remove the hdmi cable, here's debug log:
    
    [  187.494153] [drm:output_poll_execute], [CONNECTOR:17:HDMI-A-1] status updated from 1 to 2
    [  187.525349] [drm:intel_hdmi_detect], HDMI: has_audio = 0
    
    so when comes back to intel_hdmi_dpms(), the "Audio enable bit" will not be cleared. And this
    cause the eld infomation and pin presence doesnot update accordingly in alsa driver side.
    
    This patch will also trigger unsolicated event to alsa driver to notify the hot plug event:
    
    [  187.853159] ALSA sound/pci/hda/patch_hdmi.c:772 HDMI hot plug event: Codec=3 Pin=5 Presence_Detect=0 ELD_Valid=1
    [  187.853268] ALSA sound/pci/hda/patch_hdmi.c:990 HDMI status: Codec=3 Pin=5 Presence_Detect=0 ELD_Valid=0
    
    Signed-off-by: Wang Xingchao <xingchao.wang@intel.com>
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4b4ceb8aca588b3ea3e385a31cef9b92f18021af
Author: Dave Airlie <airlied@redhat.com>
Date:   Fri Sep 14 13:28:23 2012 +1000

    drm/nouveau: fix booting with plymouth + dumb support
    
    commit 610bd7da160f76f1644ecb4cd7f39511b49a22cc upstream.
    
    We noticed a plymouth bug on Fedora 18, and I then
    noticed this stupid thinko, fixing it fixed the problem
    with plymouth.
    
    Acked-by: Ben Skeggs <bskeggs@redhat.com>
    Signed-off-by: Dave Airlie <airlied@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fcb836f584992f104bcbae16829760e3db876491
Author: Alex Deucher <alexander.deucher@amd.com>
Date:   Wed Aug 29 19:48:26 2012 -0400

    drm/radeon: fix dig encoder selection on DCE61
    
    commit 41fa54377057ab38bc3e08ebb46168a7daf2e63b upstream.
    
    Was using the DCE41 code which was wrong. Fixes
    blank displays on a number of Trinity systems.
    
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d6ce9c9ced227fde03cd1377f190c2cd469e09e0
Author: Jerome Glisse <jglisse@redhat.com>
Date:   Tue Aug 28 16:50:22 2012 -0400

    drm/radeon: force dma32 to fix regression rs4xx,rs6xx,rs740
    
    commit 4a2b6662c3632176b4fdf012243dd3751367bf1f upstream.
    
    It seems some of those IGP dislike non dma32 page despite what
    documentation says. Fix regression since we allowed non dma32
    pages. It seems it only affect some revision of those IGP chips
    as we don't know which one just force dma32 for all of them.
    
    https://bugzilla.redhat.com/show_bug.cgi?id=785375
    
    Signed-off-by: Jerome Glisse <jglisse@redhat.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5f566f0b27ebddb41b5bd42484047ae96d645704
Author: Alex Deucher <alexander.deucher@amd.com>
Date:   Tue Aug 21 19:06:21 2012 -0400

    drm/radeon: don't disable plls that are in use by other crtcs
    
    commit 4e58591c8961b3e31709313f75819f2eec06e322 upstream.
    
    Some plls are shared for DP.
    
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Reviewed-by: Michel Dänzer <michel.daenzer@amd.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ea708eb2c1843004a41d0beeac724451202513ff
Author: Alex Deucher <alexander.deucher@amd.com>
Date:   Mon Aug 20 11:06:21 2012 -0400

    drm/radeon: convert radeon vfct code to use acpi_get_table_with_size
    
    commit 7c3906d04a4587dceaa78cc1ae6b14e6454ee02a upstream.
    
    Allows us to verify the table size.
    
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6992255930809bc988366e7177126dab74e7df95
Author: Xu, Anhua <anhua.xu@intel.com>
Date:   Mon Aug 13 03:08:33 2012 +0000

    drm/i915: fix wrong order of parameters in port checking functions
    
    commit b70ad586162609141f0aa9eb34790f31a8954f89 upstream.
    
    Wrong order of parameters passed-in when calling hdmi/adpa
    /lvds_pipe_enabled(), 2nd and 3rd parameters are reversed.
    
    This bug was indroduced by
    
    commit 1519b9956eb4b4180fa3f47c73341463cdcfaa37
    Author: Keith Packard <keithp@keithp.com>
    Date:   Sat Aug 6 10:35:34 2011 -0700
    
        drm/i915: Fix PCH port pipe select in CPT disable paths
    
    The reachable tag for this commit is v3.1-rc1-3-g1519b99
    
    Signed-off-by: Anhua Xu <anhua.xu@intel.com>
    Reviewed-by: Chris Wilson <chris@chris-wilson.co.uk>
    Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=44876
    Tested-by: Daniel Schroeder <sec@dschroeder.info>
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 853a847c89384d47afcad59beeecb535fe733402
Author: Alex Deucher <alexander.deucher@amd.com>
Date:   Fri Aug 24 18:21:21 2012 -0400

    drm/radeon/atom: powergating fixes for DCE6
    
    commit c205b232a64fed6d26edd7e40985b396de99a27f upstream.
    
    Power gating is per crtc pair, but the powergating registers
    should be called individually.  The hw handles power up/down
    properly.  The pair is powered up if either crtc in the pair
    is powered up and the pair is not powered down until both
    crtcs in the pair are powered down.  This simplifies
    programming and should save additional power as the previous
    code never actually power gated the crtc pair.
    
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d468e2150f5f52ea7b0c459366028f28cc1cf96b
Author: Alex Deucher <alexander.deucher@amd.com>
Date:   Wed Aug 22 09:54:56 2012 -0400

    drm/radeon/atom: rework DIG modesetting on DCE3+
    
    commit 8d1af57ae3c4458ed0de93ef97f388dd1b3239c7 upstream.
    
    The ordering is important and the current drm code
    wasn't cutting it for modern DIG encoders.  We need
    to have information about crtc before setting up
    the encoders so I've shifted the ordering a bit.
    Probably we'll need a full rework akin to danvet's
    recent intel patchs.  This patch fixes numerous
    issues with DP bridge chips and makes link training
    much more reliable.
    
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2607b9407db4cbc16d5a130c8c16702711c3b7be
Author: Jakob Bornecrantz <jakob@vmware.com>
Date:   Thu Aug 16 08:29:03 2012 +0000

    drm: Check for invalid cursor flags
    
    commit 7c4eaca4162d0b5ad4fb39f974d7ffd71b9daa09 upstream.
    
    Signed-off-by: Jakob Bornecrantz <jakob@vmware.com>
    Signed-off-by: Dave Airlie <airlied@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4368ade3ff2bfff1033f9e5758630b3d4e8f7e71
Author: AceLan Kao <acelan.kao@canonical.com>
Date:   Wed Jul 4 15:20:14 2012 +0800

    asus-nb-wmi: add some video toggle keys
    
    commit 3766054fff4af1b58a1440a284907887f4d2e8be upstream.
    
    There are some new video switch keys that used by newer machines.
    0xA0 - SDSP HDMI only
    0xA1 - SDSP LCD + HDMI
    0xA2 - SDSP CRT + HDMI
    0xA3 - SDSP TV + HDMI
    But in Linux, there is no suitable userspace application to handle this,
    so, mapping them all to KEY_SWITCHVIDEOMODE.
    
    Signed-off-by: AceLan Kao <acelan.kao@canonical.com>
    Signed-off-by: Matthew Garrett <mjg@redhat.com>
    Cc: Tim Gardner <tim.gardner@canonical.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 91a1da919e60a62ed3dfb10296e8eed4eb2b03bd
Author: Corentin Chary <corentin.chary@gmail.com>
Date:   Mon Aug 20 23:01:51 2012 +0200

    asus-laptop: HRWS/HWRS typo
    
    commit 8871e99f89b7d7b1ea99de550eea2a56273f42ab upstream.
    
    Resolves-bug: https://bugzilla.kernel.org/show_bug.cgi?id=24222
    Signed-off-by: Corentin Chary <corentin.chary@gmail.com>
    Signed-off-by: Matthew Garrett <mjg@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 33822abf1d7190dd8dab1da87661bde5208de6c8
Author: Jani Nikula <jani.nikula@intel.com>
Date:   Mon Aug 13 13:22:34 2012 +0300

    drm/i915: extract connector update from intel_ddc_get_modes() for reuse
    
    commit 4eab81366465aedcfd26de960c595bc03599c09f upstream.
    
    Refactor the connector update part of intel_ddc_get_modes() into a separate
    intel_connector_update_modes() function for reuse. No functional changes.
    
    Signed-off-by: Jani Nikula <jani.nikula@intel.com>
    Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=45881
    Tested-by: Alex Ferrando <alferpal@gmail.com>
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9e4f7198fda9c9d9effccff1a9d56ea2b0b3d4b4
Author: Tvrtko Ursulin <tvrtko.ursulin@onelan.co.uk>
Date:   Mon Aug 20 15:16:04 2012 +0100

    drm/radeon/kms: extend the Fujitsu D3003-S2 board connector quirk to cover later silicon stepping
    
    commit 52e9b39d9a89ae33662596bd30e62dd56bddbe73 upstream.
    
    There is a more recent APU stepping with a new PCI ID
    shipping in the same board by Fujitsu which needs the
    same quirk to correctly mark the back plane connectors.
    
    Signed-off-by: Tvrtko Ursulin <tvrtko.ursulin@onelan.co.uk>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 25413e693f697f801e1cc8fd10e90a7821a3a04b
Author: David Lamparter <equinox@diac24.net>
Date:   Thu Aug 16 15:45:20 2012 -0400

    drm/radeon: implement ACPI VFCT vbios fetch (v3)
    
    commit 268ba0a99f89a84dc5eb312470896113d0709c74 upstream.
    
    This is required for pure UEFI systems.  The vbios is stored
    in ACPI rather than at the legacy vga location.
    
    Fixes:
    https://bugs.freedesktop.org/show_bug.cgi?id=26891
    
    V2: fix #ifdefs as per Greg's comments
    V3: fix it harder
    
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Reviewed-by: Jerome Glisse <jglisse@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0a1d9a860832a5ca43114cdebf0e8650463cc1f0
Author: Alex Deucher <alexander.deucher@amd.com>
Date:   Thu Aug 16 15:39:09 2012 -0400

    drm/radeon: split ATRM support out from the ATPX handler (v3)
    
    commit c61e2775873f603148e8e998a938721b7d222d24 upstream.
    
    There are systems that use ATRM, but not ATPX.
    
    Fixes:
    https://bugs.freedesktop.org/show_bug.cgi?id=41265
    
    V2: fix #ifdefs as per Greg's comments
    V3: fix it harder
    
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 53c6c871480eb31207906a2c7e7e3a859339a8a3
Author: Alex Deucher <alexander.deucher@amd.com>
Date:   Tue Aug 21 18:52:56 2012 -0400

    drm/radeon/ss: use num_crtc rather than hardcoded 6
    
    commit 5317670692f61675394db2eb6713484b67383750 upstream.
    
    When checking if a pll is in use.
    
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8ff63613670a03eaa3524f4a55742c17ed105bc5
Author: Jerome Glisse <jglisse@redhat.com>
Date:   Fri Aug 17 14:40:04 2012 -0400

    drm/radeon: avoid turning off spread spectrum for used pll
    
    commit 5efcc76c13a745f98e7b6604d6aca49761be1970 upstream.
    
    If spread spectrum is enabled and in use for a given pll we
    should not turn it off as it will lead to turning off display
    for crtc that use the pll (this behavior was observed on chelsea
    edp).
    
    Signed-off-by: Jerome Glisse <jglisse@redhat.com>
    Reviewed-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 13e902acc58ef41e6516f160bd55976891d3b9cb
Author: Dave Airlie <airlied@redhat.com>
Date:   Tue Aug 21 16:29:47 2012 +1000

    fbcon: fix race condition between console lock and cursor timer (v1.1)
    
    commit d8636a2717bb3da2a7ce2154bf08de90bb8c87b0 upstream.
    
    So we've had a fair few reports of fbcon handover breakage between
    efi/vesafb and i915 surface recently, so I dedicated a couple of
    days to finding the problem.
    
    Essentially the last thing we saw was the conflicting framebuffer
    message and that was all.
    
    So after much tracing with direct netconsole writes (printks
    under console_lock not so useful), I think I found the race.
    
    Thread A (driver load)    Thread B (timer thread)
      unbind_con_driver ->              |
      bind_con_driver ->                |
      vc->vc_sw->con_deinit ->          |
      fbcon_deinit ->                   |
      console_lock()                    |
          |                             |
          |                       fbcon_flashcursor timer fires
          |                       console_lock() <- blocked for A
          |
          |
    fbcon_del_cursor_timer ->
      del_timer_sync
      (BOOM)
    
    Of course because all of this is under the console lock,
    we never see anything, also since we also just unbound the active
    console guess what we never see anything.
    
    Hopefully this fixes the problem for anyone seeing vesafb->kms
    driver handoff.
    
    v1.1: add comment suggestion from Alan.
    
    Signed-off-by: Dave Airlie <airlied@redhat.com>
    Acked-by: Alan Cox <alan@lxorguk.ukuu.org.uk>
    Tested-by: Josh Boyer <jwboyer@gmail.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 95c1d943a1e7515643dcd8466ba82c3566f778b6
Author: Robin Holt <holt@sgi.com>
Date:   Tue Aug 21 16:16:02 2012 -0700

    drivers/misc/sgi-xp/xpc_uv.c: SGI XPC fails to load when cpu 0 is out of IRQ resources
    
    commit 7838f994b4fceff24c343f4e26a6cf4393869579 upstream.
    
    On many of our larger systems, CPU 0 has had all of its IRQ resources
    consumed before XPC loads.  Worst cases on machines with multiple 10
    GigE cards and multiple IB cards have depleted the entire first socket
    of IRQs.
    
    This patch makes selecting the node upon which IRQs are allocated (as
    well as all the other GRU Message Queue structures) specifiable as a
    module load param and has a default behavior of searching all nodes/cpus
    for an available resources.
    
    [akpm@linux-foundation.org: fix build: include cpu.h and module.h]
    Signed-off-by: Robin Holt <holt@sgi.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7f2e6defbe27240e9d51e4eee2f2568d31956b79
Author: Rafael J. Wysocki <rjw@rjwysocki.net>
Date:   Wed Aug 15 21:31:55 2012 +0200

    PM / Runtime: Clear power.deferred_resume on success in rpm_suspend()
    
    commit 58a34de7b1a920d287d17d2ca08bc9aaf7e6d35b upstream.
    
    The power.deferred_resume can only be set if the runtime PM status
    of device is RPM_SUSPENDING and it should be cleared after its
    status has been changed, regardless of whether or not the runtime
    suspend has been successful.  However, it only is cleared on
    suspend failure, while it may remain set on successful suspend and
    is happily leaked to rpm_resume() executed in that case.
    
    That shouldn't happen, so if power.deferred_resume is set in
    rpm_suspend() after the status has been changed to RPM_SUSPENDED,
    clear it before calling rpm_resume().  Then, it doesn't need to be
    cleared before changing the status to RPM_SUSPENDING any more,
    because it's always cleared after the status has been changed to
    either RPM_SUSPENDED (on success) or RPM_ACTIVE (on failure).
    
    Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
    Acked-by: Alan Stern <stern@rowland.harvard.edu>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a0bfb9191135a16c84df7ba580ea839aefff4a0f
Author: Rafael J. Wysocki <rjw@rjwysocki.net>
Date:   Wed Aug 15 21:31:45 2012 +0200

    PM / Runtime: Fix rpm_resume() return value for power.no_callbacks set
    
    commit 7f321c26c04807834fef4c524d2b21573423fc74 upstream.
    
    For devices whose power.no_callbacks flag is set, rpm_resume()
    should return 1 if the device's parent is already active, so that
    the callers of pm_runtime_get() don't think that they have to wait
    for the device to resume (asynchronously) in that case (the core
    won't queue up an asynchronous resume in that case, so there's
    nothing to wait for anyway).
    
    Modify the code accordingly (and make sure that an idle notification
    will be queued up on success, even if 1 is to be returned).
    
    Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
    Acked-by: Alan Stern <stern@rowland.harvard.edu>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5e5891d1fe77e50428913ab69ff8cc8c5695a560
Author: Atsushi Nemoto <anemo@mba.ocn.ne.jp>
Date:   Tue Aug 21 16:16:10 2012 -0700

    drivers/rtc/rtc-rs5c348.c: fix hour decoding in 12-hour mode
    
    commit 7dbfb315b2aaef0a115765946bf3026d074c33a7 upstream.
    
    Correct the offset by subtracting 20 from tm_hour before taking the
    modulo 12.
    
    [ "Why 20?" I hear you ask. Or at least I did.
    
      Here's the reason why: RS5C348_BIT_PM is 32, and is - stupidly -
      included in the RS5C348_HOURS_MASK define.  So it's really subtracting
      out that bit to get "hour+12".  But then because it does things modulo
      12, it needs to add the 12 in again afterwards anyway.
    
      This code is confused.  It would be much clearer if RS5C348_HOURS_MASK
      just didn't include the RS5C348_BIT_PM bit at all, then it wouldn't
      need to do the silly subtract either.
    
      Whatever. It's all just math, the end result is the same.   - Linus ]
    
    Reported-by: James Nute <newten82@gmail.com>
    Tested-by: James Nute <newten82@gmail.com>
    Signed-off-by: Atsushi Nemoto <anemo@mba.ocn.ne.jp>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e60b883144de35ea312a7570460cfe6a42af61c1
Author: Will Deacon <will@kernel.org>
Date:   Fri Aug 10 15:22:09 2012 +0100

    mutex: Place lock in contended state after fastpath_lock failure
    
    commit 0bce9c46bf3b15f485d82d7e81dabed6ebcc24b1 upstream.
    
    ARM recently moved to asm-generic/mutex-xchg.h for its mutex
    implementation after the previous implementation was found to be missing
    some crucial memory barriers. However, this has revealed some problems
    running hackbench on SMP platforms due to the way in which the
    MUTEX_SPIN_ON_OWNER code operates.
    
    The symptoms are that a bunch of hackbench tasks are left waiting on an
    unlocked mutex and therefore never get woken up to claim it. This boils
    down to the following sequence of events:
    
            Task A        Task B        Task C        Lock value
    0                                                     1
    1       lock()                                        0
    2                     lock()                          0
    3                     spin(A)                         0
    4       unlock()                                      1
    5                                   lock()            0
    6                     cmpxchg(1,0)                    0
    7                     contended()                    -1
    8       lock()                                        0
    9       spin(C)                                       0
    10                                  unlock()          1
    11      cmpxchg(1,0)                                  0
    12      unlock()                                      1
    
    At this point, the lock is unlocked, but Task B is in an uninterruptible
    sleep with nobody to wake it up.
    
    This patch fixes the problem by ensuring we put the lock into the
    contended state if we fail to acquire it on the fastpath, ensuring that
    any blocked waiters are woken up when the mutex is released.
    
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Cc: Arnd Bergmann <arnd@arndb.de>
    Cc: Chris Mason <chris.mason@fusionio.com>
    Cc: Ingo Molnar <mingo@elte.hu>
    Reviewed-by: Nicolas Pitre <nico@linaro.org>
    Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl>
    Link: http://lkml.kernel.org/n/tip-6e9lrw2avczr0617fzl5vqb8@git.kernel.org
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 86236252d2449313bdbac790023cbc957bf6e426
Author: Xinyu Chen <xinyu.chen@freescale.com>
Date:   Mon Aug 27 09:36:51 2012 +0200

    tty: serial: imx: console write routing is unsafe on SMP
    
    commit 9ec1882df244c4ee1baa692676fef5e8b0f5487d upstream.
    
    The console feature's write routing is unsafe on SMP with
    the startup/shutdown call.
    
    There could be several consumers of the console
    * the kernel printk
    * the init process using /dev/kmsg to call printk to show log
    * shell, which open /dev/console and write with sys_write()
    
    The shell goes into the normal uart open/write routing,
    but the other two go into the console operations.
    The open routing calls imx serial startup, which will write USR1/2
    register without any lock and critical with imx_console_write call.
    
    Add a spin_lock for startup/shutdown/console_write routing.
    
    This patch is a port from Freescale's Android kernel.
    
    Signed-off-by: Xinyu Chen <xinyu.chen@freescale.com>
    Tested-by: Dirk Behme <dirk.behme@de.bosch.com>
    CC: Sascha Hauer <s.hauer@pengutronix.de>
    Acked-by: Shawn Guo <shawn.guo@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 48877fe63db63f981cc64d597369fb489ae2e556
Author: Moiz Sonasath <m-sonasath@ti.com>
Date:   Wed Sep 5 08:34:26 2012 +0300

    usb: host: xhci: fix compilation error for non-PCI based stacks
    
    commit 296365781903226a3fb8758901eaeec09d2798e4 upstream.
    
    For non PCI-based stacks, this function call
    usb_disable_xhci_ports(to_pci_dev(hcd->self.controller));
    made from xhci_shutdown is not applicable.
    
    Ideally, we wouldn't have any PCI-specific code on
    a generic driver such as the xHCI stack, but it looks
    like we should just stub usb_disable_xhci_ports() out
    for non-PCI devices.
    
    [ balbi@ti.com: slight improvement to commit log ]
    
    This patch should be backported to kernels as old as 3.0, since the
    commit it fixes (e95829f474f0db3a4d940cae1423783edd966027 "xhci: Switch
    PPT ports to EHCI on shutdown.") was marked for stable.
    
    Signed-off-by: Moiz Sonasath<m-sonasath@ti.com>
    Signed-off-by: Ruchika Kharwar <ruchika@ti.com>
    Signed-off-by: Felipe Balbi <balbi@ti.com>
    Signed-off-by: Sarah Sharp <sarah.a.sharp@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fa544a230c9ce8b56bef4ea64f2d606f95cee37b
Author: Manoj Iyer <manoj.iyer@canonical.com>
Date:   Wed Aug 22 11:53:18 2012 -0500

    xhci: Recognize USB 3.0 devices as superspeed at powerup
    
    commit 29d214576f936db627ff62afb9ef438eea18bcd2 upstream.
    
    On Intel Panther Point chipset USB 3.0 devices show up as
    high-speed devices on powerup, but after an s3 cycle they are
    correctly recognized as SuperSpeed. At powerup switch the port
    to xHCI so that USB 3.0 devices are correctly recognized.
    
    BugLink: http://bugs.launchpad.net/bugs/1000424
    
    This patch should be backported to kernels as old as 3.0, that contain
    commit ID 69e848c2090aebba5698a1620604c7dccb448684 "Intel xhci: Support
    EHCI/xHCI port switching."
    
    Signed-off-by: Manoj Iyer <manoj.iyer@canonical.com>
    Signed-off-by: Sarah Sharp <sarah.a.sharp@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 279412b46d186d0cb6badb02e3bfd4d03beff43e
Author: Matthew Garrett <mjg@redhat.com>
Date:   Tue Aug 14 16:44:49 2012 -0400

    xhci: Make handover code more robust
    
    commit e955a1cd086de4d165ae0f4c7be7289d84b63bdc upstream.
    
    My test platform (Intel DX79SI) boots reliably under BIOS, but frequently
    crashes when booting via UEFI. I finally tracked this down to the xhci
    handoff code. It seems that reads from the device occasionally just return
    0xff, resulting in xhci_find_next_cap_offset generating a value that's
    larger than the resource region. We then oops when attempting to read the
    value. Sanity checking that value lets us avoid the crash.
    
    I've no idea what's causing the underlying problem, and xhci still doesn't
    actually *work* even with this, but the machine at least boots which will
    probably make further debugging easier.
    
    This should be backported to kernels as old as 2.6.31, that contain the
    commit 66d4eadd8d067269ea8fead1a50fe87c2979a80d "USB: xhci: BIOS handoff
    and HW initialization."
    
    Signed-off-by: Matthew Garrett <mjg@redhat.com>
    Signed-off-by: Sarah Sharp <sarah.a.sharp@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3dd2f0bb418f24a3b9a0b9b93b1ba104c2e6d140
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Mon Aug 13 19:57:03 2012 +0300

    xhci: Fix a logical vs bitwise AND bug
    
    commit 052c7f9ffb0e95843e75448d02664459253f9ff8 upstream.
    
    The intent was to test whether the flag was set.
    
    This patch should be backported to stable kernels as old as 3.0, since
    it fixes a bug in commit e95829f474f0db3a4d940cae1423783edd966027 "xhci:
    Switch PPT ports to EHCI on shutdown.", which was marked for stable.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Sarah Sharp <sarah.a.sharp@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 40fd8822f49ad6ac2b7a575e3b2020e7382db431
Author: Ruchika Kharwar <ruchika@ti.com>
Date:   Fri Aug 10 09:58:30 2012 +0300

    usb: host: xhci-plat: use ioremap_nocache
    
    commit 319acdfc064169023cd9ada5085b434fbcdacec2 upstream.
    
    Use the ioremap_nocache variant of the ioremap API in
    order to make sure our memory will be marked uncachable.
    
    This patch should be backported to kernels as old as 3.4, that contain
    the commit 3429e91a661e1f383aecc86c6bbcf65afb15c892 "usb: host: xhci:
    add platform driver support".
    
    Signed-off-by: Ruchika Kharwar <ruchika@ti.com>
    Signed-off-by: Felipe Balbi <balbi@ti.com>
    Signed-off-by: Sarah Sharp <sarah.a.sharp@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3c4154bb097ffc933a70771e976949d00969d451
Author: Keng-Yu Lin <kengyu@canonical.com>
Date:   Fri Aug 10 01:39:23 2012 +0800

    Intel xhci: Only switch the switchable ports
    
    commit a96874a2a92feaef607ddd3137277a788cb927a6 upstream.
    
    With a previous patch to enable the EHCI/XHCI port switching, it switches
    all the available ports.
    
    The assumption is not correct because the BIOS may expect some ports
    not switchable by the OS.
    
    There are two more registers that contains the information of the switchable
    and non-switchable ports.
    
    This patch adds the checking code for the two register so that only the
    switchable ports are altered.
    
    This patch should be backported to kernels as old as 3.0, that contain
    commit ID 69e848c2090aebba5698a1620604c7dccb448684 "Intel xhci: Support
    EHCI/xHCI port switching."
    
    Signed-off-by: Keng-Yu Lin <kengyu@canonical.com>
    Signed-off-by: Sarah Sharp <sarah.a.sharp@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dadc5da6b79314943a7e5eda6369c70e3c7a1d26
Author: Alexis R. Cortes <alexis.cortes@ti.com>
Date:   Fri Aug 3 14:00:27 2012 -0500

    usb: host: xhci: Fix Compliance Mode on SN65LVPE502CP Hardware
    
    commit 71c731a296f1b08a3724bd1b514b64f1bda87a23 upstream.
    
    This patch is intended to work around a known issue on the
    SN65LVPE502CP USB3.0 re-driver that can delay the negotiation
    between a device and the host past the usual handshake timeout.
    
    If that happens on the first insertion, the host controller
    port will enter in Compliance Mode and NO port status event will
    be generated (as per xHCI Spec) making impossible to detect this
    event by software. The port will remain in compliance mode until
    a warm reset is applied to it.
    
    As a result of this, the port will seem "dead" to the user and no
    device connections or disconnections will be detected.
    
    For solving this, the patch creates a timer which polls every 2
    seconds the link state of each host controller's port (this
    by reading the PORTSC register) and recovers the port by issuing a
    Warm reset every time Compliance mode is detected.
    
    If a xHC USB3.0 port has previously entered to U0, the compliance
    mode issue will NOT occur only until system resumes from
    sleep/hibernate, therefore, the compliance mode timer is stopped
    when all xHC USB 3.0 ports have entered U0. The timer is initialized
    again after each system resume.
    
    Since the issue is being caused by a piece of hardware, the timer
    will be enabled ONLY on those systems that have the SN65LVPE502CP
    installed (this patch uses DMI strings for detecting those systems)
    therefore making this patch to act as a quirk (XHCI_COMP_MODE_QUIRK
    has been added to the xhci stack).
    
    This patch applies for these systems:
    Vendor: Hewlett-Packard. System Models: Z420, Z620 and Z820.
    
    This patch should be backported to kernels as old as 3.2, as that was
    the first kernel to support warm reset.  The kernels will need to
    contain both commit 10d674a82e553cb8a1f41027bb3c3e309b3f6804 "USB: When
    hot reset for USB3 fails, try warm reset" and commit
    8bea2bd37df08aaa599aa361a9f8b836ba98e554 "usb: Add support for root hub
    port status CAS".  The first patch add warm reset support, and the
    second patch modifies the USB core to issue a warm reset when the port
    is in compliance mode.
    
    Signed-off-by: Alexis R. Cortes <alexis.cortes@ti.com>
    Signed-off-by: Sarah Sharp <sarah.a.sharp@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1f92c25123b256e3c8d892fcb0d71760445ccb90
Author: Sergei Poselenov <sposelenov@emcraft.com>
Date:   Sun Sep 2 13:14:32 2012 +0400

    rt2800usb: Added rx packet length validity check
    
    commit efd5d6b03bd9c9e0df646c56fb5f4f3e25e5c1ac upstream.
    
    On our system (ARM Cortex-M3 SOC running linux-2.6.33)
    frequent crashes were observed in the rt2800usb module
    because of the invalid length of the received packet (3392,
    46920...). This patch adds the sanity check on the packet
    legth. Also, changed WARNING to ERROR in rt2x00lib_rxdone()
    so that the bad packet condition would be noticed.
    
    The fix was tested on the latest compat-wireless-3.5.1-1-snpc.
    
    Signed-off-by: Sergei Poselenov <sposelenov@emcraft.com>
    Acked-by: Ivo van Doorn <IvDoorn@gmail.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit adc7b2b36a6fb6854f2146d86f08d362b6aa0b83
Author: Alan Stern <stern@rowland.harvard.edu>
Date:   Tue Sep 4 10:41:02 2012 -0400

    USB: add device quirk for Joss Optical touchboard
    
    commit 92fc7a8b0f20bdb243c706daf42658e8e0cd2ef0 upstream.
    
    This patch (as1604) adds a CONFIG_INTF_STRINGS quirk for the Joss
    infrared touchboard device.  The device doesn't like to be asked for
    its interface strings.
    
    Signed-off-by: Alan Stern <stern@rowland.harvard.edu>
    Reported-by: adam ? <adam3337@wp.pl>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 61fee2c3e35d8496685317c4e17c98e8905ba762
Author: Nicolas Ferre <nicolas.ferre@microchip.com>
Date:   Wed Aug 29 11:49:18 2012 +0200

    USB: ohci-at91: fix PIO handling in relation with number of ports
    
    commit 6fffb77c8393151b0cf8cef1b9c2ba90587dd2e8 upstream.
    
    If the number of ports present on the SoC/board is not the maximum
    and that the platform data is not filled with all data, there is
    an easy way to mess the PIO setup for this interface.
    This quick fix addresses mis-configuration in USB host platform data
    that is common in at91 boards since commit 0ee6d1e (USB: ohci-at91:
    change maximum number of ports) that did not modified the associatd
    board files.
    
    Reported-by: Klaus Falkner <klaus.falkner@solectrix.de>
    Signed-off-by: Nicolas Ferre <nicolas.ferre@atmel.com>
    Acked-by: Alan Stern <stern@rowland.harvard.edu>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5527f1341645e192145f7e581230dcf4447dd8c7
Author: Bjørn Mork <bjorn@mork.no>
Date:   Mon Sep 10 22:17:34 2012 +0200

    USB: cdc-wdm: fix wdm_find_device* return value
    
    commit 6a44886899ef8cc396e230e492e6a56a883889f3 upstream.
    
    A logic error made the wdm_find_device* functions
    return a bogus pointer into static data instead of
    the intended NULL no matching device was found.
    
    Signed-off-by: Bjørn Mork <bjorn@mork.no>
    Cc: Oliver Neukum <oliver@neukum.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7acab78d0fc555fb57cc8b5a5080b5f637f447a1
Author: Pratyush Anand <pratyush.anand@gmail.com>
Date:   Fri Aug 10 13:42:16 2012 +0530

    usb: dwc3: ep0: correct cache sync issue in case of ep0_bounced
    
    commit 0416e494ce7dc84e2719bc9fb7daecb330476074 upstream.
    
    In case of ep0 out, if length is not aligned to maxpacket size then we use
    dwc->ep_bounce_addr for dma transfer and not request->dma. Since, we have
    alreday done memcpy from dwc->ep0_bounce to request->buf, so we do not need to
    issue cache sync function. In fact, cache sync function will bring wrong data
    in request->buf from request->dma in this scenario.
    
    So, cache sync function must not be executed in case of ep0 bounced.
    
    Signed-off-by: Pratyush Anand <pratyush.anand@st.com>
    Signed-off-by: Felipe Balbi <balbi@ti.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1ea39e97a7cebcb8ab8c969ba05ac1e8b1b0457d
Author: Éric Piel <piel@delmic.com>
Date:   Tue Sep 4 17:25:06 2012 +0200

    USB: ftdi-sio: add support for more Physik Instrumente devices
    
    commit dafc4f7be1a556ca3868d343c00127728b397068 upstream.
    
    Commit b69cc672052540 added support for the E-861.  After acquiring a C-867, I
    realised that every Physik Instrumente's device has a different PID. They are
    listed in the Windows device driver's .inf file. So here are all PIDs for the
    current (and probably future) USB devices from Physik Instrumente.
    
    Compiled, but only actually tested on the E-861 and C-867.
    
    Signed-off-by: Éric Piel <piel@delmic.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c5a79afd07d3aa476eb62851df56fe53f5c07d8e
Author: Bjørn Mork <bjorn@mork.no>
Date:   Mon Sep 10 12:01:05 2012 +0200

    USB: ftdi_sio: do not claim CDC ACM function
    
    commit f08dea734844aa42ec57c229b0b73b3d7d21f810 upstream.
    
    The Microchip vid:pid 04d8:000a is used for their CDC ACM
    demo firmware application.  This is a device with a single
    function conforming to the CDC ACM specification and with
    the intention of demonstrating CDC ACM class firmware and
    driver interaction.  The demo is used on a number of
    development boards, and may also be used unmodified by
    vendors using Microchip hardware.
    
    Some vendors have re-used this vid:pid for other types of
    firmware, emulating FTDI chips. Attempting to continue to
    support such devices without breaking class based
    applications that by matching on interface
    class/subclass/proto being ff/ff/00.  I have no information
    about the actual device or interface descriptors, but this
    will at least make the proper CDC ACM devices work again.
    Anyone having details of the offending device's descriptors
    should update this entry with the details.
    
    Reported-by: Florian Wöhrl <fw@woehrl.biz>
    Reported-by: Xiaofan Chen <xiaofanc@gmail.com>
    Cc: Alan Cox <alan@linux.intel.com>
    Cc: Bruno Thomsen <bruno.thomsen@gmail.com>
    Signed-off-by: Bjørn Mork <bjorn@mork.no>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7d9088f7173dc7e93d73bbe1b3fdc8f2ea107275
Author: Horst Schirmeier <horst@schirmeier.com>
Date:   Fri Aug 31 00:00:28 2012 +0200

    USB: ftdi_sio: PID for NZR SEM 16+ USB
    
    commit 26a538b9ea2a3ee10dafc0068f0560dfd7b7ba37 upstream.
    
    This adds the USB PID for the NZR SEM 16+ USB energy monitor device
    <http://www.nzr.de>.  It works perfectly with the GPL software on
    <http://schou.dk/linux/sparometer/>.
    
    Signed-off-by: Horst Schirmeier <horst@schirmeier.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7fe0451922d30d1e540edaa26c95dd708ae55e1a
Author: Pavankumar Kondeti <pkondeti@codeaurora.org>
Date:   Fri Sep 7 11:23:28 2012 +0530

    EHCI: Update qTD next pointer in QH overlay region during unlink
    
    commit 3d037774b42ed677f699b1dce7d548d55f4e4c2b upstream.
    
    There is a possibility of QH overlay region having reference to a stale
    qTD pointer during unlink.
    
    Consider an endpoint having two pending qTD before unlink process begins.
    The endpoint's QH queue looks like this.
    
    qTD1 --> qTD2 --> Dummy
    
    To unlink qTD2, QH is removed from asynchronous list and Asynchronous
    Advance Doorbell is programmed.  The qTD1's next qTD pointer is set to
    qTD2'2 next qTD pointer and qTD2 is retired upon controller's doorbell
    interrupt.  If QH's current qTD pointer points to qTD1, transfer overlay
    region still have reference to qTD2. But qtD2 is just unlinked and freed.
    This may cause EHCI system error.  Fix this by updating qTD next pointer
    in QH overlay region with the qTD next pointer of the current qTD.
    
    Signed-off-by: Pavankumar Kondeti <pkondeti@codeaurora.org>
    Acked-by: Alan Stern <stern@rowland.harvard.edu>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6da04d620105c54d37de139f9b09e62196b5d0c3
Author: Weston Andros Adamson <dros@netapp.com>
Date:   Thu Sep 6 15:54:27 2012 -0400

    NFS: return error from decode_getfh in decode open
    
    commit 01913b49cf1dc6409a07dd2a4cc6af2e77f3c410 upstream.
    
    If decode_getfh failed, nfs4_xdr_dec_open would return 0 since the last
    decode_* call must have succeeded.
    
    Signed-off-by: Weston Andros Adamson <dros@netapp.com>
    Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3672dff93b8c5c7d2ebaf18eb32c98b06e942dac
Author: Trond Myklebust <Trond.Myklebust@netapp.com>
Date:   Tue Sep 4 11:05:07 2012 -0400

    NFS: Fix a problem with the legacy binary mount code
    
    commit 872ece86ea5c367aa92f44689c2d01a1c767aeb3 upstream.
    
    Apparently, am-utils is still using the legacy binary mountdata interface,
    and is having trouble parsing /proc/mounts due to the 'port=' field being
    incorrectly set.
    
    The following patch should fix up the regression.
    
    Reported-by: Marius Tolzmann <tolzmann@molgen.mpg.de>
    Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f15e72437813a8943aaa3f7528e464923c31437f
Author: Trond Myklebust <Trond.Myklebust@netapp.com>
Date:   Mon Sep 3 14:56:02 2012 -0400

    NFS: Fix the initialisation of the readdir 'cookieverf' array
    
    commit c3f52af3e03013db5237e339c817beaae5ec9e3a upstream.
    
    When the NFS_COOKIEVERF helper macro was converted into a static
    inline function in commit 99fadcd764 (nfs: convert NFS_*(inode)
    helpers to static inline), we broke the initialisation of the
    readdir cookies, since that depended on doing a memset with an
    argument of 'sizeof(NFS_COOKIEVERF(inode))' which therefore
    changed from sizeof(be32 cookieverf[2]) to sizeof(be32 *).
    
    At this point, NFS_COOKIEVERF seems to be more of an obfuscation
    than a helper, so the best thing would be to just get rid of it.
    
    Also see: https://bugzilla.kernel.org/show_bug.cgi?id=46881
    
    Reported-by: Andi Kleen <andi@firstfloor.org>
    Reported-by: David Binderman <dcb314@hotmail.com>
    Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 010ec57f5f6706fbafe9b198846c35500de7aa91
Author: Gertjan van Wingerde <gwingerde@gmail.com>
Date:   Fri Aug 31 19:22:11 2012 +0200

    rt2x00: Fix rfkill polling prior to interface start.
    
    commit a396e10019eaf3809b0219c966865aaafec12630 upstream.
    
    We need to program the rfkill switch GPIO pin direction to input at
    device initialization time, not only when the interface is brought up.
    Doing this only when the interface is brought up could lead to rfkill
    detecting the switch is turned on erroneously and inability to create
    the interface and bringing it up.
    
    Reported-and-tested-by: Andreas Messer <andi@bastelmap.de>
    Signed-off-by: Gertjan van Wingerde <gwingerde@gmail.com>
    Acked-by: Ivo Van Doorn <ivdoorn@gmail.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c0b4947b6456ca77865b296d6b80eaf8c76fa722
Author: Gertjan van Wingerde <gwingerde@gmail.com>
Date:   Fri Aug 31 19:22:10 2012 +0200

    rt2x00: Fix word size of rt2500usb MAC_CSR19 register.
    
    commit 6ced58a5dbb94dbfbea1b33ca3c56d1e929cd548 upstream.
    
    The register is 16 bits wide, not 32.
    
    Signed-off-by: Gertjan van Wingerde <gwingerde@gmail.com>
    Acked-by: Ivo Van Doorn <ivdoorn@gmail.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 117fe26c51421653d28bfbf91fe71027e9abb253
Author: Gertjan van Wingerde <gwingerde@gmail.com>
Date:   Fri Aug 31 19:22:09 2012 +0200

    rt2x00: Identify ASUS USB-N53 device.
    
    commit 177ef8360fabdc49ff08d2598c06e7f7a36b53e3 upstream.
    
    This is an RT3572 based device.
    
    Signed-off-by: Maximilian Engelhardt <maxi@daemonizer.de>
    Signed-off-by: Gertjan van Wingerde <gwingerde@gmail.com>
    Acked-by: Ivo Van Doorn <ivdoorn@gmail.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 87a34202d070db674e215091e98d21881af56f22
Author: Nicolas Ferre <nicolas.ferre@microchip.com>
Date:   Tue Sep 11 17:21:45 2012 +0200

    dmaengine: at_hdmac: check that each sg data length is non-null
    
    commit c456797681db814f4f5b36909e8e94047bf53d9c upstream.
    
    Avoid the construction of a malformed DMA request sent to
    the DMA controller.
    Log message is for debug only because this condition is unlikely to
    append and may only trigger at driver development time.
    
    Signed-off-by: Nicolas Ferre <nicolas.ferre@atmel.com>
    Signed-off-by: Vinod Koul <vinod.koul@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8dd47c73d93505aee90bc56d56965ef82b535f93
Author: Nicolas Ferre <nicolas.ferre@microchip.com>
Date:   Tue Sep 11 17:21:44 2012 +0200

    dmaengine: at_hdmac: fix comment in atc_prep_slave_sg()
    
    commit c618a9be0e8c0f36baee2560860a0118a428fb26 upstream.
    
    s/dma_memcpy/slave_sg/ and it is sg length that we are
    talking about.
    
    Signed-off-by: Nicolas Ferre <nicolas.ferre@atmel.com>
    Signed-off-by: Vinod Koul <vinod.koul@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 570d1520c48a9033c62b9ae552b250d2822c6f9e
Author: Sachin Kamat <sachin.kamat@linaro.org>
Date:   Mon Sep 17 15:20:23 2012 +0530

    DMA: PL330: Check the pointer returned by kzalloc
    
    commit 61c6e7531d3b66b33187b8cdd700fd8ab93ffd62 upstream.
    
    kzalloc could return NULL. Hence add a check to avoid
    NULL pointer dereference.
    
    Signed-off-by: Sachin Kamat <sachin.kamat@linaro.org>
    Acked-by: Jassi Brar <jassisinghbrar@gmail.com>
    Signed-off-by: Vinod Koul <vinod.koul@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fe9803b58dce15848465ab0270ccea29f4a5c4bb
Author: Sachin Kamat <sachin.kamat@linaro.org>
Date:   Mon Sep 17 15:20:22 2012 +0530

    DMA: PL330: Fix potential NULL pointer dereference in pl330_submit_req()
    
    commit 2e2c682becb20416c140aa0d6d3137b51a5c76da upstream.
    
    'r->cfg' is being checked for NULL. However, it is dereferenced
    in the previous statements. Thus moving those statements within
    the check.
    
    Signed-off-by: Sachin Kamat <sachin.kamat@linaro.org>
    Acked-by: Jassi Brar <jassisinghbrar@gmail.com>
    Signed-off-by: Vinod Koul <vinod.koul@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7334e402a35e0379933e8b0442f0baeed1104217
Author: Luis R. Rodriguez <mcgrof@do-not-panic.com>
Date:   Fri Sep 14 15:36:57 2012 -0700

    cfg80211: fix possible circular lock on reg_regdb_search()
    
    commit a85d0d7f3460b1a123b78e7f7e39bf72c37dfb78 upstream.
    
    When call_crda() is called we kick off a witch hunt search
    for the same regulatory domain on our internal regulatory
    database and that work gets kicked off on a workqueue, this
    is done while the cfg80211_mutex is held. If that workqueue
    kicks off it will first lock reg_regdb_search_mutex and
    later cfg80211_mutex but to ensure two CPUs will not contend
    against cfg80211_mutex the right thing to do is to have the
    reg_regdb_search() wait until the cfg80211_mutex is let go.
    
    The lockdep report is pasted below.
    
    cfg80211: Calling CRDA to update world regulatory domain
    
    ======================================================
    [ INFO: possible circular locking dependency detected ]
    3.3.8 #3 Tainted: G           O
    -------------------------------------------------------
    kworker/0:1/235 is trying to acquire lock:
     (cfg80211_mutex){+.+...}, at: [<816468a4>] set_regdom+0x78c/0x808 [cfg80211]
    
    but task is already holding lock:
     (reg_regdb_search_mutex){+.+...}, at: [<81646828>] set_regdom+0x710/0x808 [cfg80211]
    
    which lock already depends on the new lock.
    
    the existing dependency chain (in reverse order) is:
    
    -> #2 (reg_regdb_search_mutex){+.+...}:
           [<800a8384>] lock_acquire+0x60/0x88
           [<802950a8>] mutex_lock_nested+0x54/0x31c
           [<81645778>] is_world_regdom+0x9f8/0xc74 [cfg80211]
    
    -> #1 (reg_mutex#2){+.+...}:
           [<800a8384>] lock_acquire+0x60/0x88
           [<802950a8>] mutex_lock_nested+0x54/0x31c
           [<8164539c>] is_world_regdom+0x61c/0xc74 [cfg80211]
    
    -> #0 (cfg80211_mutex){+.+...}:
           [<800a77b8>] __lock_acquire+0x10d4/0x17bc
           [<800a8384>] lock_acquire+0x60/0x88
           [<802950a8>] mutex_lock_nested+0x54/0x31c
           [<816468a4>] set_regdom+0x78c/0x808 [cfg80211]
    
    other info that might help us debug this:
    
    Chain exists of:
      cfg80211_mutex --> reg_mutex#2 --> reg_regdb_search_mutex
    
     Possible unsafe locking scenario:
    
           CPU0                    CPU1
           ----                    ----
      lock(reg_regdb_search_mutex);
                                   lock(reg_mutex#2);
                                   lock(reg_regdb_search_mutex);
      lock(cfg80211_mutex);
    
     *** DEADLOCK ***
    
    3 locks held by kworker/0:1/235:
     #0:  (events){.+.+..}, at: [<80089a00>] process_one_work+0x230/0x460
     #1:  (reg_regdb_work){+.+...}, at: [<80089a00>] process_one_work+0x230/0x460
     #2:  (reg_regdb_search_mutex){+.+...}, at: [<81646828>] set_regdom+0x710/0x808 [cfg80211]
    
    stack backtrace:
    Call Trace:
    [<80290fd4>] dump_stack+0x8/0x34
    [<80291bc4>] print_circular_bug+0x2ac/0x2d8
    [<800a77b8>] __lock_acquire+0x10d4/0x17bc
    [<800a8384>] lock_acquire+0x60/0x88
    [<802950a8>] mutex_lock_nested+0x54/0x31c
    [<816468a4>] set_regdom+0x78c/0x808 [cfg80211]
    
    Reported-by: Felix Fietkau <nbd@openwrt.org>
    Tested-by: Felix Fietkau <nbd@openwrt.org>
    Signed-off-by: Luis R. Rodriguez <mcgrof@do-not-panic.com>
    Reviewed-by: Johannes Berg <johannes@sipsolutions.net>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 12e58ca43097b5330e028f4087e7e4789c08abf7
Author: Ira W. Snyder <iws@ovro.caltech.edu>
Date:   Tue Sep 11 15:58:15 2012 -0700

    can: janz-ican3: fix support for older hardware revisions
    
    commit e21093ef6fb4cbecdf926102286dbe280ae965db upstream.
    
    The Revision 1.0 Janz CMOD-IO Carrier Board does not have support for
    the reset registers. To support older hardware, the code is changed to
    use the hardware reset register on the Janz VMOD-ICAN3 hardware itself.
    
    Signed-off-by: Ira W. Snyder <iws@ovro.caltech.edu>
    Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4a3aa6ef866b7128e57358858e053450ab97c41a
Author: Marc Kleine-Budde <mkl@pengutronix.de>
Date:   Wed Sep 19 14:58:45 2012 +0200

    can: ti_hecc: fix oops during rmmod
    
    commit ab04c8bd423edb03e2148350a091836c196107fc upstream.
    
    This patch fixes an oops which occurs when unloading the driver, while the
    network interface is still up. The problem is that first the io mapping is
    teared own, then the CAN device is unregistered, resulting in accessing the
    hardware's iomem:
    
    [  172.744232] Unable to handle kernel paging request at virtual address c88b0040
    [  172.752441] pgd = c7be4000
    [  172.755645] [c88b0040] *pgd=87821811, *pte=00000000, *ppte=00000000
    [  172.762207] Internal error: Oops: 807 [#1] PREEMPT ARM
    [  172.767517] Modules linked in: ti_hecc(-) can_dev
    [  172.772430] CPU: 0    Not tainted  (3.5.0alpha-00037-g3554cc0 #126)
    [  172.778961] PC is at ti_hecc_close+0xb0/0x100 [ti_hecc]
    [  172.784423] LR is at __dev_close_many+0x90/0xc0
    [  172.789123] pc : [<bf00c768>]    lr : [<c033be58>]    psr: 60000013
    [  172.789123] sp : c5c1de68  ip : 00040081  fp : 00000000
    [  172.801025] r10: 00000001  r9 : c5c1c000  r8 : 00100100
    [  172.806457] r7 : c5d0a48c  r6 : c5d0a400  r5 : 00000000  r4 : c5d0a000
    [  172.813232] r3 : c88b0000  r2 : 00000001  r1 : c5d0a000  r0 : c5d0a000
    [  172.820037] Flags: nZCv  IRQs on  FIQs on  Mode SVC_32  ISA ARM  Segment user
    [  172.827423] Control: 10c5387d  Table: 87be4019  DAC: 00000015
    [  172.833404] Process rmmod (pid: 600, stack limit = 0xc5c1c2f0)
    [  172.839447] Stack: (0xc5c1de68 to 0xc5c1e000)
    [  172.843994] de60:                   bf00c6b8 c5c1dec8 c5d0a000 c5d0a000 00200200 c033be58
    [  172.852478] de80: c5c1de44 c5c1dec8 c5c1dec8 c033bf2c c5c1de90 c5c1de90 c5d0a084 c5c1de44
    [  172.860992] dea0: c5c1dec8 c033c098 c061d3dc c5d0a000 00000000 c05edf28 c05edb34 c000d724
    [  172.869476] dec0: 00000000 c033c2f8 c5d0a084 c5d0a084 00000000 c033c370 00000000 c5d0a000
    [  172.877990] dee0: c05edb00 c033c3b8 c5d0a000 bf00d3ac c05edb00 bf00d7c8 bf00d7c8 c02842dc
    [  172.886474] df00: c02842c8 c0282f90 c5c1c000 c05edb00 bf00d7c8 c0283668 bf00d7c8 00000000
    [  172.894989] df20: c0611f98 befe2f80 c000d724 c0282d10 bf00d804 00000000 00000013 c0068a8c
    [  172.903472] df40: c5c538e8 685f6974 00636365 c61571a8 c5cb9980 c61571a8 c6158a20 c00c9bc4
    [  172.911987] df60: 00000000 00000000 c5cb9980 00000000 c5cb9980 00000000 c7823680 00000006
    [  172.920471] df80: bf00d804 00000880 c5c1df8c 00000000 000d4267 befe2f80 00000001 b6d90068
    [  172.928985] dfa0: 00000081 c000d5a0 befe2f80 00000001 befe2f80 00000880 b6d90008 00000008
    [  172.937469] dfc0: befe2f80 00000001 b6d90068 00000081 00000001 00000000 befe2eac 00000000
    [  172.945983] dfe0: 00000000 befe2b18 00023ba4 b6e6addc 60000010 befe2f80 a8e00190 86d2d344
    [  172.954498] [<bf00c768>] (ti_hecc_close+0xb0/0x100 [ti_hecc]) from [<c033be58>] (__dev__registered_many+0xc0/0x2a0)
    [  172.984161] [<c033c098>] (rollback_registered_many+0xc0/0x2a0) from [<c033c2f8>] (rollback_registered+0x20/0x30)
    [  172.994750] [<c033c2f8>] (rollback_registered+0x20/0x30) from [<c033c370>] (unregister_netdevice_queue+0x68/0x98)
    [  173.005401] [<c033c370>] (unregister_netdevice_queue+0x68/0x98) from [<c033c3b8>] (unregister_netdev+0x18/0x20)
    [  173.015899] [<c033c3b8>] (unregister_netdev+0x18/0x20) from [<bf00d3ac>] (ti_hecc_remove+0x60/0x80 [ti_hecc])
    [  173.026245] [<bf00d3ac>] (ti_hecc_remove+0x60/0x80 [ti_hecc]) from [<c02842dc>] (platform_drv_remove+0x14/0x18)
    [  173.036712] [<c02842dc>] (platform_drv_remove+0x14/0x18) from [<c0282f90>] (__device_release_driver+0x7c/0xbc)
    
    Tested-by: Jan Luebbe <jlu@pengutronix.de>
    Cc: Anant Gole <anantgole@ti.com>
    Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d83e6a4819844782ac16591a89c598342eef8627
Author: Søren Holm <sgh@sgh.dk>
Date:   Mon Sep 17 21:50:57 2012 +0000

    asix: Support DLink DUB-E100 H/W Ver C1
    
    commit ed3770a9cd5764a575b83810ea679bbff2b03082 upstream.
    
    Signed-off-by: Søren Holm <sgh@sgh.dk>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b9e8ad48eca69a02b03ea2beea38383d5f3f0b3f
Author: Larry Finger <Larry.Finger@lwfinger.net>
Date:   Tue Sep 11 11:11:13 2012 -0500

    rtlwifi: rtl8192ce: Log message that B_CUT device may not work
    
    commit 022e1d0680c7b4366017393417b8758be5abcee8 upstream.
    
    There are a number of problems that occur for the latest version
    of the Realtek RTL8188CE device with the in-kernel driver. These
    include selection of the wrong firmware, and system lockup. A full
    fix is known, but is too invasive for inclusion in stable. This patch
    fixes the problem with loading the wrong firmware, and logs a message
    that the device may not work for kernels 3.6 and older.
    
    Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
    Cc: Anisse Astier <anisse@astier.eu>
    Cc: Li Chaoming <chaoming_li@realsil.com.cn>
    Tested-by: Anisse Astier <anisse@astier.eu>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 870fefcd916e9766ff3ac689aa87e9f3abbe9381
Author: Jovi Zhang <bookjovi@gmail.com>
Date:   Wed Aug 22 10:34:08 2012 +0800

    MIPS: mm: Add compound tail page _mapcount when mapped
    
    commit af89fa3986b9d034a286544ab1ed95096496a2f9 upstream.
    
    See commit b6999b191 which did the same modification for x86's mm/gup,
    
    Quote from commit b6999b191:
        "If compound pages are used and the page is a
        tail page, gup_huge_pmd() increases _mapcount to record tail page are
        mapped while gup_huge_pud does not do that."
    
    [ralf@linux-mips.org: fixed rejects caused by the original patch getting
    linewrapped.]
    
    Signed-off-by: Jovi Zhang <boojovi@gmail.com>
    Cc: Youquan Song <youquan.song@intel.com>
    Cc: Andi Kleen <andi@firstfloor.org>
    Patchwork: https://patchwork.linux-mips.org/patch/4291/
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0ed92b21f3807633c70f7565f92b034ef8bf4b1c
Author: Anisse Astier <anisse@astier.eu>
Date:   Wed Sep 19 11:10:48 2012 -0700

    Input: i8042 - disable mux on Toshiba C850D
    
    commit 8669cf6793bb38307a30fb6b9565ddc8840ebd3f upstream.
    
    On Toshiba Satellite C850D, the touchpad and the keyboard might randomly
    not work at boot. Preventing MUX mode activation solves this issue.
    
    Signed-off-by: Anisse Astier <anisse@astier.eu>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c648535596087f7d17458c293d69829ff6e60a6c
Author: Wen Congyang <wency@cn.fujitsu.com>
Date:   Thu Sep 20 14:04:47 2012 +0800

    tracing: Don't call page_to_pfn() if page is NULL
    
    commit 85f2a2ef1d0ab99523e0b947a2b723f5650ed6aa upstream.
    
    When allocating memory fails, page is NULL. page_to_pfn() will
    cause the kernel panicked if we don't use sparsemem vmemmap.
    
    Link: http://lkml.kernel.org/r/505AB1FF.8020104@cn.fujitsu.com
    
    Acked-by: Mel Gorman <mel@csn.ul.ie>
    Cc: Frederic Weisbecker <fweisbec@gmail.com>
    Cc: Ingo Molnar <mingo@redhat.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Reviewed-by: Minchan Kim <minchan@kernel.org>
    Signed-off-by: Wen Congyang <wency@cn.fujitsu.com>
    Signed-off-by: Steven Rostedt <rostedt@goodmis.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dca2dd18c62e3b90cb71534e0a715d246ce7196d
Author: Matthew Leach <matthew.leach@arm.com>
Date:   Tue Sep 11 17:56:57 2012 +0100

    ARM: 7532/1: decompressor: reset SCTLR.TRE for VMSA ARMv7 cores
    
    commit e1e5b7e4251c7538ca08c2c5545b0c2fbd8a6635 upstream.
    
    This patch zeroes the SCTLR.TRE bit prior to setting the mapping as
    cacheable for ARMv7 cores in the decompressor, ensuring that the
    memory region attributes are obtained from the C and B bits, not from
    the page tables.
    
    Cc: Nicolas Pitre <nico@fluxnic.net>
    Reviewed-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Matthew Leach <matthew.leach@arm.com>
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9f8a301630c67302cab77da0c4cb06272a95459d
Author: Toshi Kani <toshi.kani@hp.com>
Date:   Mon Aug 27 12:52:24 2012 -0600

    hpwdt: Fix kdump issue in hpwdt
    
    commit 308b135e4fcc00c80c07e0e04e7afa8edf78583c upstream.
    
    kdump can be interrupted by watchdog timer when the timer is left
    activated on the crash kernel. Changed the hpwdt driver to disable
    watchdog timer at boot-time. This assures that watchdog timer is
    disabled until /dev/watchdog is opened, and prevents watchdog timer
    to be left running on the crash kernel.
    
    Signed-off-by: Toshi Kani <toshi.kani@hp.com>
    Tested-by: Lisa Mitchell <lisa.mitchell@hp.com>
    Signed-off-by: Thomas Mingarelli <Thomas.Mingarelli@hp.com>
    Signed-off-by: Wim Van Sebroeck <wim@iguana.be>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a6be20b8cd1e5e847c4191b8f249b939aaabf987
Author: Andrzej Kaczmarek <andrzej.kaczmarek@tieto.com>
Date:   Wed Aug 29 10:02:09 2012 +0200

    Bluetooth: mgmt: Fix enabling LE while powered off
    
    commit 562fcc246ebe31ade6e1be08585673b9b2785498 upstream.
    
    When new BT USB adapter is plugged in it's configured while still being powered
    off (HCI_AUTO_OFF flag is set), thus Set LE will only set dev_flags but won't
    write changes to controller. As a result it's not possible to start device
    discovery session on LE controller as it uses interleaved discovery which
    requires LE Supported Host flag in extended features.
    
    This patch ensures HCI Write LE Host Supported is sent when Set Powered is
    called to power on controller and clear HCI_AUTO_OFF flag.
    
    Signed-off-by: Andrzej Kaczmarek <andrzej.kaczmarek@tieto.com>
    Acked-by: Johan Hedberg <johan.hedberg@intel.com>
    Signed-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ec4d417c66a406bb464598220faf9f561d5b6d25
Author: Vinicius Costa Gomes <vinicius.gomes@openbossa.org>
Date:   Fri Sep 14 16:34:46 2012 -0300

    Bluetooth: Fix not removing power_off delayed work
    
    commit 78c04c0bf52360dc2f7185e99c8e9aa05d73ae5a upstream.
    
    For example, when a usb reset is received (I could reproduce it
    running something very similar to this[1] in a loop) it could be
    that the device is unregistered while the power_off delayed work
    is still scheduled to run.
    
    Backtrace:
    
    WARNING: at lib/debugobjects.c:261 debug_print_object+0x7c/0x8d()
    Hardware name: To Be Filled By O.E.M.
    ODEBUG: free active (active state 0) object type: timer_list hint: delayed_work_timer_fn+0x0/0x26
    Modules linked in: nouveau mxm_wmi btusb wmi bluetooth ttm coretemp drm_kms_helper
    Pid: 2114, comm: usb-reset Not tainted 3.5.0bt-next #2
    Call Trace:
     [<ffffffff8124cc00>] ? free_obj_work+0x57/0x91
     [<ffffffff81058f88>] warn_slowpath_common+0x7e/0x97
     [<ffffffff81059035>] warn_slowpath_fmt+0x41/0x43
     [<ffffffff8124ccb6>] debug_print_object+0x7c/0x8d
     [<ffffffff8106e3ec>] ? __queue_work+0x259/0x259
     [<ffffffff8124d63e>] ? debug_check_no_obj_freed+0x6f/0x1b5
     [<ffffffff8124d667>] debug_check_no_obj_freed+0x98/0x1b5
     [<ffffffffa00aa031>] ? bt_host_release+0x10/0x1e [bluetooth]
     [<ffffffff810fc035>] kfree+0x90/0xe6
     [<ffffffffa00aa031>] bt_host_release+0x10/0x1e [bluetooth]
     [<ffffffff812ec2f9>] device_release+0x4a/0x7e
     [<ffffffff8123ef57>] kobject_release+0x11d/0x154
     [<ffffffff8123ed98>] kobject_put+0x4a/0x4f
     [<ffffffff812ec0d9>] put_device+0x12/0x14
     [<ffffffffa009472b>] hci_free_dev+0x22/0x26 [bluetooth]
     [<ffffffffa0280dd0>] btusb_disconnect+0x96/0x9f [btusb]
     [<ffffffff813581b4>] usb_unbind_interface+0x57/0x106
     [<ffffffff812ef988>] __device_release_driver+0x83/0xd6
     [<ffffffff812ef9fb>] device_release_driver+0x20/0x2d
     [<ffffffff813582a7>] usb_driver_release_interface+0x44/0x7b
     [<ffffffff81358795>] usb_forced_unbind_intf+0x45/0x4e
     [<ffffffff8134f959>] usb_reset_device+0xa6/0x12e
     [<ffffffff8135df86>] usbdev_do_ioctl+0x319/0xe20
     [<ffffffff81203244>] ? avc_has_perm_flags+0xc9/0x12e
     [<ffffffff812031a0>] ? avc_has_perm_flags+0x25/0x12e
     [<ffffffff81050101>] ? do_page_fault+0x31e/0x3a1
     [<ffffffff8135eaa6>] usbdev_ioctl+0x9/0xd
     [<ffffffff811126b1>] vfs_ioctl+0x21/0x34
     [<ffffffff81112f7b>] do_vfs_ioctl+0x408/0x44b
     [<ffffffff81208d45>] ? file_has_perm+0x76/0x81
     [<ffffffff8111300f>] sys_ioctl+0x51/0x76
     [<ffffffff8158db22>] system_call_fastpath+0x16/0x1b
    
    [1] http://cpansearch.perl.org/src/DPAVLIN/Biblio-RFID-0.03/examples/usbreset.c
    
    Signed-off-by: Vinicius Costa Gomes <vinicius.gomes@openbossa.org>
    Signed-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dcc8dbc21ff2052c0df6dee3e1a36c3ef4f1133c
Author: Andrzej Kaczmarek <andrzej.kaczmarek@tieto.com>
Date:   Wed Aug 29 10:02:08 2012 +0200

    Bluetooth: mgmt: Fix enabling SSP while powered off
    
    commit 3d1cbdd6aefff711bcf389fdabc4af9bc22e8201 upstream.
    
    When new BT USB adapter is plugged in it's configured while still being powered
    off (HCI_AUTO_OFF flag is set), thus Set SSP will only set dev_flags but won't
    write changes to controller. As a result remote devices won't use Secure Simple
    Pairing with our device due to SSP Host Support flag disabled in extended
    features and may also reject SSP attempt from our side (with possible fallback
    to legacy pairing).
    
    This patch ensures HCI Write Simple Pairing Mode is sent when Set Powered is
    called to power on controller and clear HCI_AUTO_OFF flag.
    
    Signed-off-by: Andrzej Kaczmarek <andrzej.kaczmarek@tieto.com>
    Acked-by: Johan Hedberg <johan.hedberg@intel.com>
    Signed-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f51909c0af2ebc533eaf48c7daff503b3e54d983
Author: Wang Sen <senwang@linux.vnet.ibm.com>
Date:   Mon Jul 30 14:25:06 2012 +0800

    SCSI: scsi: virtio-scsi: Fix address translation failure of HighMem pages used by sg list
    
    commit 27e99ade81368e6fdda3212bff9345177cf9e57a upstream.
    
    When using the commands below to write some data to a virtio-scsi LUN of the
    QEMU guest(32-bit) with 1G physical memory(qemu -m 1024), the qemu will crash.
    
            # sudo mkfs.ext4 /dev/sdb  (/dev/sdb is the virtio-scsi LUN.)
            # sudo mount /dev/sdb /mnt
            # dd if=/dev/zero of=/mnt/file bs=1M count=1024
    
    In current implementation, sg_set_buf is called to add buffers to sg list which
    is put into the virtqueue eventually. But if there are some HighMem pages in
    table->sgl you can not get virtual address by sg_virt. So, sg_virt(sg_elem) may
    return NULL value. This will cause QEMU exit when virtqueue_map_sg is called
    in QEMU because an invalid GPA is passed by virtqueue.
    
    Two solutions are discussed here:
    http://lkml.indiana.edu/hypermail/linux/kernel/1207.3/00675.html
    
    Finally, value assignment approach was adopted because:
    
    Value assignment creates a well-formed scatterlist, because the termination
    marker in source sg_list has been set in blk_rq_map_sg(). The last entry of the
    source sg_list is just copied to the the last entry in destination list.  Note
    that, for now, virtio_ring does not care about the form of the scatterlist and
    simply processes the first out_num + in_num consecutive elements of the sg[]
    array.
    
    I have tested the patch on my workstation. QEMU would not crash any more.
    
    Signed-off-by: Wang Sen <senwang@linux.vnet.ibm.com>
    Acked-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: James Bottomley <JBottomley@Parallels.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c2cf6b0d20d0febfead4b29d87f9fc2e903127c0
Author: Stephen M. Cameron <scameron@beardog.cce.hp.com>
Date:   Fri Sep 14 16:34:25 2012 -0500

    SCSI: hpsa: fix handling of protocol error
    
    commit 256d0eaac87da1e993190846064f339f4c7a63f5 upstream.
    
    If a command status of CMD_PROTOCOL_ERR is received, this
    information should be conveyed to the SCSI mid layer, not
    dropped on the floor.  CMD_PROTOCOL_ERR may be received
    from the Smart Array for any commands destined for an external
    RAID controller such as a P2000, or commands destined for tape
    drives or CD/DVD-ROM drives, if for instance a cable is
    disconnected.  This mostly affects multipath configurations, as
    disconnecting a cable on a non-multipath configuration is not
    going to do anything good regardless of whether CMD_PROTOCOL_ERR
    is handled correctly or not.  Not handling CMD_PROTOCOL_ERR
    correctly in a multipath configaration involving external RAID
    controllers may cause data corruption, so this is quite a serious
    bug.  This bug should not normally cause a problem for direct
    attached disk storage.
    
    Signed-off-by: Stephen M. Cameron <scameron@beardog.cce.hp.com>
    Signed-off-by: James Bottomley <JBottomley@Parallels.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4f04e027f76aefbcfc987af72e6727d40d8c654d
Author: Eddie Wai <eddie.wai@broadcom.com>
Date:   Tue Aug 21 10:35:53 2012 -0700

    SCSI: bnx2i: Fixed NULL ptr deference for 1G bnx2 Linux iSCSI offload
    
    commit d6532207116307eb7ecbfa7b9e02c53230096a50 upstream.
    
    This patch fixes the following kernel panic invoked by uninitialized fields
    in the chip initialization for the 1G bnx2 iSCSI offload.
    
    One of the bits in the chip initialization is being used by the latest
    firmware to control overflow packets.  When this control bit gets enabled
    erroneously, it would ultimately result in a bad packet placement which would
    cause the bnx2 driver to dereference a NULL ptr in the placement handler.
    
    This can happen under certain stress I/O environment under the Linux
    iSCSI offload operation.
    
    This change only affects Broadcom's 5709 chipset.
    
    Unable to handle kernel NULL pointer dereference at 0000000000000008 RIP:
     [<ffffffff881f0e7d>] :bnx2:bnx2_poll_work+0xd0d/0x13c5
    Pid: 0, comm: swapper Tainted: G     ---- 2.6.18-333.el5debug #2
    RIP: 0010:[<ffffffff881f0e7d>]  [<ffffffff881f0e7d>] :bnx2:bnx2_poll_work+0xd0d/0x13c5
    RSP: 0018:ffff8101b575bd50  EFLAGS: 00010216
    RAX: 0000000000000005 RBX: ffff81007c5fb180 RCX: 0000000000000000
    RDX: 0000000000000ffc RSI: 00000000817e8000 RDI: 0000000000000220
    RBP: ffff81015bbd7ec0 R08: ffff8100817e9000 R09: 0000000000000000
    R10: ffff81007c5fb180 R11: 00000000000000c8 R12: 000000007a25a010
    R13: 0000000000000000 R14: 0000000000000005 R15: ffff810159f80558
    FS:  0000000000000000(0000) GS:ffff8101afebc240(0000) knlGS:0000000000000000
    CS:  0010 DS: 0018 ES: 0018 CR0: 000000008005003b
    CR2: 0000000000000008 CR3: 0000000000201000 CR4: 00000000000006a0
    Process swapper (pid: 0, threadinfo ffff8101b5754000, task ffff8101afebd820)
    Stack:  000000000000000b ffff810159f80000 0000000000000040 ffff810159f80520
     ffff810159f80500 00cf00cf8008e84b ffffc200100939e0 ffff810009035b20
     0000502900000000 000000be00000001 ffff8100817e7810 00d08101b575bea8
    Call Trace:
     <IRQ>  [<ffffffff8008e0d0>] show_schedstat+0x1c2/0x25b
     [<ffffffff881f1886>] :bnx2:bnx2_poll+0xf6/0x231
     [<ffffffff8000c9b9>] net_rx_action+0xac/0x1b1
     [<ffffffff800125a0>] __do_softirq+0x89/0x133
     [<ffffffff8005e30c>] call_softirq+0x1c/0x28
     [<ffffffff8006d5de>] do_softirq+0x2c/0x7d
     [<ffffffff8006d46e>] do_IRQ+0xee/0xf7
     [<ffffffff8005d625>] ret_from_intr+0x0/0xa
     <EOI>  [<ffffffff801a5780>] acpi_processor_idle_simple+0x1c5/0x341
     [<ffffffff801a573d>] acpi_processor_idle_simple+0x182/0x341
     [<ffffffff801a55bb>] acpi_processor_idle_simple+0x0/0x341
     [<ffffffff80049560>] cpu_idle+0x95/0xb8
     [<ffffffff80078b1c>] start_secondary+0x479/0x488
    
    Signed-off-by: Eddie Wai <eddie.wai@broadcom.com>
    Reviewed-by: Mike Christie <michaelc@cs.wisc.edu>
    Signed-off-by: James Bottomley <JBottomley@Parallels.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d39bdd32d086d55a4adf228a0af2874ee489cd61
Author: sreekanth.reddy@lsi.com <sreekanth.reddy@lsi.com>
Date:   Wed Aug 22 16:55:13 2012 +0530

    SCSI: mpt2sas: Fix for issue - Unable to boot from the drive connected to HBA
    
    commit 10cce6d8b5af0b32bc4254ae4a28423a74c0921c upstream.
    
    This patch checks whether HBA is SAS2008 B0 controller.
    if it is a SAS2008 B0 controller then it use IO-APIC interrupt instead of MSIX,
    as SAS2008 B0 controller doesn't support MSIX interrupts.
    
    [jejb: fix whitespace problems]
    Signed-off-by: Sreekanth Reddy <sreekanth.reddy@lsi.com>
    Signed-off-by: James Bottomley <JBottomley@Parallels.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c68f32825bc8c3e046493262422e134a03adb6c6
Author: James Bottomley <jbottomley@parallels.com>
Date:   Thu Jun 21 07:50:02 2012 +0000

    SCSI: lpfc: fix problems with -Werror
    
    commit 4bdd03e61b7a5c4c6bc2b25d46fcd491788fdfb3 upstream.
    
    Commit d38bd3aef ("Add -Werror compilation flag") is causing build breakage
    with random gcc incarnations.  These look like gcc problems, but we shouldn't
    break the build because of a bad gcc.  Fix this by adding a make flag
    
    WARNINGS_BECOME_ERRORS=1
    
    which is the same as aic7xxx uses so ordinarily the build doesn't use -Werror
    
    Reported-by: Fengguang Wu <fengguang.wu@intel.com>
    Cc: Alex Iannicelli <alex.iannicelli@emulex.com>
    Cc: James Smart <james.smart@emulex.com>
    Cc: Jonathan Nieder <jrnieder@gmail.com>
    Cc: Mike Pagano <mpagano@gentoo.org>
    Signed-off-by: James Bottomley <JBottomley@Parallels.com>

commit d5217650d6e48503466a9192e2cd72c91c696f50
Author: Hante Meuleman <meuleman@broadcom.com>
Date:   Tue Sep 11 21:16:48 2012 +0200

    brcmfmac: Fix big endian host configuration data.
    
    commit e020a83d0942a5aceac35986500c9834efc8707d upstream.
    
    Fixes big endian host configuration parameters.
    
    Reviewed-by: Arend Van Spriel <arend@broadcom.com>
    Signed-off-by: Hante Meuleman <meuleman@broadcom.com>
    Signed-off-by: Arend van Spriel <arend@broadcom.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7c4a26d507774d22b7e6eb792046c203f71a0ab0
Author: Hante Meuleman <meuleman@broadcom.com>
Date:   Tue Sep 11 21:16:47 2012 +0200

    brcmfmac: fix big endian bug in i-scan.
    
    commit ed205b361956c96e0d8c09a8c9135a6a79cd9541 upstream.
    
    ssid len is 32 bit and needs endian conversion for big endian systems.
    
    Signed-off-by: Hante Meuleman <meuleman@broadcom.com>
    Signed-off-by: Arend van Spriel <arend@broadcom.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ba41a6df9e32ee5752165496017cadf700c14ca9
Author: Eliad Peller <eliad@wizery.com>
Date:   Tue Sep 4 17:44:45 2012 +0300

    mac80211: clear bssid on auth/assoc failure
    
    commit 3d2abdfdf14f4d6decc2023708211e19b096f4ca upstream.
    
    ifmgd->bssid wasn't cleared properly in some
    auth/assoc failure cases, causing mac80211 and
    the low-level driver to go out of sync.
    
    Clear ifmgd->bssid on failure, and notify the driver.
    
    Signed-off-by: Eliad Peller <eliad@wizery.com>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0bf2a827d745808dde90001134ecc6a4af39b361
Author: Santiago Leon <santil@linux.vnet.ibm.com>
Date:   Tue Sep 4 14:41:37 2012 +0000

    ibmveth: Fix alignment of rx queue bug
    
    commit d90c92fee89ccd75ef2646f3bde0b4c0450666c3 upstream.
    
    This patch fixes a bug found by Nish Aravamudan
    (https://lkml.org/lkml/2012/5/15/220) where the driver is not following
    the spec (it is not aligning the rx buffer on a 16-byte boundary) and the
    hypervisor aborts the registration, making the device unusable.
    
    The fix follows BenH's recommendation (https://lkml.org/lkml/2012/7/20/461)
    to replace the kmalloc+map for a single call to dma_alloc_coherent()
    because that function always aligns to a 16-byte boundary.
    
    The stable trees will run into this bug whenever the rx buffer kmalloc call
    returns something not aligned on a 16-byte boundary.
    
    Signed-off-by: Santiago Leon <santil@linux.vnet.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1db67b66e816cc91335ce18179d97eb125e5a769
Author: Dave Airlie <airlied@redhat.com>
Date:   Tue Aug 28 01:53:54 2012 +0000

    vmwgfx: add dumb ioctl support
    
    commit 5e1782d224c79b26ab7d5c31e3f87657000714fb upstream.
    
    Testing and works with the -modesetting driver,
    
    Reviewed-by: Jakob Bornecrantz <jakob@vmware.com>
    Signed-off-by: Dave Airlie <airlied@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2ae637123f49eea55c12e2871f7acc28a601dccc
Author: Jeff Layton <jlayton@kernel.org>
Date:   Tue Sep 18 14:21:01 2012 -0400

    cifs: fix return value in cifsConvertToUTF16
    
    commit c73f693989d7a7d99ec66a7065295a0c93d0b127 upstream.
    
    This function returns the wrong value, which causes the callers to get
    the length of the resulting pathname wrong when it contains non-ASCII
    characters.
    
    This seems to fix https://bugzilla.samba.org/show_bug.cgi?id=6767
    
    Reported-by: Baldvin Kovacs <baldvin.kovacs@gmail.com>
    Reported-and-Tested-by: Nicolas Lefebvre <nico.lefebvre@gmail.com>
    Signed-off-by: Jeff Layton <jlayton@redhat.com>
    Signed-off-by: Steve French <smfrench@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a3bd94a4566b2c107c3d9661076ba184af9f83ba
Author: Nestor Lopez Casado <nlopezcasad@logitech.com>
Date:   Fri Sep 21 12:21:34 2012 +0200

    HID: Fix logitech-dj: missing Unifying device issue
    
    commit 596264082f10dd4a567c43d4526b2f54ac5520bc upstream.
    
    This patch fixes an issue introduced after commit 4ea5454203d991ec
    ("HID: Fix race condition between driver core and ll-driver").
    
    After that commit, hid-core discards any incoming packet that arrives while
    hid driver's probe function is being executed.
    
    This broke the enumeration process of hid-logitech-dj, that must receive
    control packets in-band with the mouse and keyboard packets. Discarding mouse
    or keyboard data at the very begining is usually fine, but it is not the case
    for control packets.
    
    This patch forces a re-enumeration of the paired devices when a packet arrives
    that comes from an unknown device.
    
    Based on a patch originally written by Benjamin Tissoires.
    
    Signed-off-by: Nestor Lopez Casado <nlopezcasad@logitech.com>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3f4d6d765aedf4c52195d1d3938b6c404a2f6555
Author: Guenter Roeck <linux@roeck-us.net>
Date:   Tue Sep 11 13:43:17 2012 -0700

    hwmon: (ad7314) Add 'name' sysfs attribute
    
    commit 3ceefe4319636d89d4bdf40dca9471970f942e4f upstream.
    
    The 'name' sysfs attribute is mandatory for hwmon devices, but was missing
    in this driver.
    
    Cc: Jonathan Cameron <jic23@cam.ac.uk>
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Acked-by: Jean Delvare <khali@linux-fr.org>
    Acked-by: Jonathan Cameron <jic23@cam.ac.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 17c7900f51d4cef95f95bbf3743bc9d19075052d
Author: Guenter Roeck <linux@roeck-us.net>
Date:   Tue Sep 11 13:39:08 2012 -0700

    hwmon: (ads7871) Add 'name' sysfs attribute
    
    commit 4e21f4eaa49f78d3e977e316514c941053871c76 upstream.
    
    The 'name' sysfs attribute is mandatory for hwmon devices, but was missing
    in this driver.
    
    Cc: Paul Thomas <pthomas8589@gmail.com>
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Acked-by: Jean Delvare <khali@linux-fr.org>
    Acked-by: Paul Thomas <pthomas8589@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b5b937dae933e1997300ffa2f6c45759a849bee0
Author: Andreas Herrmann <andreas.herrmann3@amd.com>
Date:   Sun Sep 23 20:27:32 2012 +0200

    hwmon: (fam15h_power) Tweak runavg_range on resume
    
    commit 5f0ecb907deb1e6f28071ee3bd568903b9da1be4 upstream.
    
    The quirk introduced with commit
    00250ec90963b7ef6678438888f3244985ecde14 (hwmon: fam15h_power: fix
    bogus values with current BIOSes) is not only required during driver
    load but also when system resumes from suspend. The BIOS might set the
    previously recommended (but unsuitable) initilization value for the
    running average range register during resume.
    
    Signed-off-by: Andreas Herrmann <andreas.herrmann3@amd.com>
    Tested-by: Andreas Hartmann <andihartmann@01019freenet.de>
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 02fc6e74ca8c7751b7764894fb4c9da5609c79b5
Author: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
Date:   Fri Aug 17 10:22:37 2012 -0400

    xen/boot: Disable NUMA for PV guests.
    
    commit 8d54db795dfb1049d45dc34f0dddbc5347ec5642 upstream.
    
    The hypervisor is in charge of allocating the proper "NUMA" memory
    and dealing with the CPU scheduler to keep them bound to the proper
    NUMA node. The PV guests (and PVHVM) have no inkling of where they
    run and do not need to know that right now. In the future we will
    need to inject NUMA configuration data (if a guest spans two or more
    NUMA nodes) so that the kernel can make the right choices. But those
    patches are not yet present.
    
    In the meantime, disable the NUMA capability in the PV guest, which
    also fixes a bootup issue. Andre says:
    
    "we see Dom0 crashes due to the kernel detecting the NUMA topology not
    by ACPI, but directly from the northbridge (CONFIG_AMD_NUMA).
    
    This will detect the actual NUMA config of the physical machine, but
    will crash about the mismatch with Dom0's virtual memory. Variation of
    the theme: Dom0 sees what it's not supposed to see.
    
    This happens with the said config option enabled and on a machine where
    this scanning is still enabled (K8 and Fam10h, not Bulldozer class)
    
    We have this dump then:
    NUMA: Warning: node ids are out of bound, from=-1 to=-1 distance=10
    Scanning NUMA topology in Northbridge 24
    Number of physical nodes 4
    Node 0 MemBase 0000000000000000 Limit 0000000040000000
    Node 1 MemBase 0000000040000000 Limit 0000000138000000
    Node 2 MemBase 0000000138000000 Limit 00000001f8000000
    Node 3 MemBase 00000001f8000000 Limit 0000000238000000
    Initmem setup node 0 0000000000000000-0000000040000000
      NODE_DATA [000000003ffd9000 - 000000003fffffff]
    Initmem setup node 1 0000000040000000-0000000138000000
      NODE_DATA [0000000137fd9000 - 0000000137ffffff]
    Initmem setup node 2 0000000138000000-00000001f8000000
      NODE_DATA [00000001f095e000 - 00000001f0984fff]
    Initmem setup node 3 00000001f8000000-0000000238000000
    Cannot find 159744 bytes in node 3
    BUG: unable to handle kernel NULL pointer dereference at (null)
    IP: [<ffffffff81d220e6>] __alloc_bootmem_node+0x43/0x96
    Pid: 0, comm: swapper Not tainted 3.3.6 #1 AMD Dinar/Dinar
    RIP: e030:[<ffffffff81d220e6>]  [<ffffffff81d220e6>] __alloc_bootmem_node+0x43/0x96
    .. snip..
      [<ffffffff81d23024>] sparse_early_usemaps_alloc_node+0x64/0x178
      [<ffffffff81d23348>] sparse_init+0xe4/0x25a
      [<ffffffff81d16840>] paging_init+0x13/0x22
      [<ffffffff81d07fbb>] setup_arch+0x9c6/0xa9b
      [<ffffffff81683954>] ? printk+0x3c/0x3e
      [<ffffffff81d01a38>] start_kernel+0xe5/0x468
      [<ffffffff81d012cf>] x86_64_start_reservations+0xba/0xc1
      [<ffffffff81007153>] ? xen_setup_runstate_info+0x2c/0x36
      [<ffffffff81d050ee>] xen_start_kernel+0x565/0x56c
    "
    
    so we just disable NUMA scanning by setting numa_off=1.
    
    Reported-and-Tested-by: Andre Przywara <andre.przywara@amd.com>
    Acked-by: Andre Przywara <andre.przywara@amd.com>
    Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 449efd1d33fcf40a81f902ceed6a21a406f8d105
Author: Stefano Stabellini <stefano.stabellini@eu.citrix.com>
Date:   Wed Sep 12 12:44:30 2012 +0100

    xen/m2p: do not reuse kmap_op->dev_bus_addr
    
    commit 2fc136eecd0c647a6b13fcd00d0c41a1a28f35a5 upstream.
    
    If the caller passes a valid kmap_op to m2p_add_override, we use
    kmap_op->dev_bus_addr to store the original mfn, but dev_bus_addr is
    part of the interface with Xen and if we are batching the hypercalls it
    might not have been written by the hypervisor yet. That means that later
    on Xen will write to it and we'll think that the original mfn is
    actually what Xen has written to it.
    
    Rather than "stealing" struct members from kmap_op, keep using
    page->index to store the original mfn and add another parameter to
    m2p_remove_override to get the corresponding kmap_op instead.
    It is now responsibility of the caller to keep track of which kmap_op
    corresponds to a particular page in the m2p_override (gntdev, the only
    user of this interface that passes a valid kmap_op, is already doing that).
    
    Reported-and-Tested-By: Sander Eikelenboom <linux@eikelenboom.it>
    Signed-off-by: Stefano Stabellini <stefano.stabellini@eu.citrix.com>
    Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 967c0e4ab954d228ca87d85c523ae8a65c03cc5e
Author: qiuxishi <qiuxishi@gmail.com>
Date:   Mon Sep 17 14:09:24 2012 -0700

    memory hotplug: fix section info double registration bug
    
    commit f14851af0ebb32745c6c5a2e400aa0549f9d20df upstream.
    
    There may be a bug when registering section info.  For example, on my
    Itanium platform, the pfn range of node0 includes the other nodes, so
    other nodes' section info will be double registered, and memmap's page
    count will equal to 3.
    
      node0: start_pfn=0x100,    spanned_pfn=0x20fb00, present_pfn=0x7f8a3, => 0x000100-0x20fc00
      node1: start_pfn=0x80000,  spanned_pfn=0x80000,  present_pfn=0x80000, => 0x080000-0x100000
      node2: start_pfn=0x100000, spanned_pfn=0x80000,  present_pfn=0x80000, => 0x100000-0x180000
      node3: start_pfn=0x180000, spanned_pfn=0x80000,  present_pfn=0x80000, => 0x180000-0x200000
    
      free_all_bootmem_node()
            register_page_bootmem_info_node()
                    register_page_bootmem_info_section()
    
    When hot remove memory, we can't free the memmap's page because
    page_count() is 2 after put_page_bootmem().
    
      sparse_remove_one_section()
            free_section_usemap()
                    free_map_bootmem()
                            put_page_bootmem()
    
    [akpm@linux-foundation.org: add code comment]
    Signed-off-by: Xishi Qiu <qiuxishi@huawei.com>
    Signed-off-by: Jiang Liu <jiang.liu@huawei.com>
    Acked-by: Mel Gorman <mgorman@suse.de>
    Cc: "Luck, Tony" <tony.luck@intel.com>
    Cc: Yasuaki Ishimatsu <isimatu.yasuaki@jp.fujitsu.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 32e653056d900d3ecc984733dbfcea34c92bf6d0
Author: Jianguo Wu <wujianguo@huawei.com>
Date:   Mon Sep 17 14:08:56 2012 -0700

    mm/ia64: fix a memory block size bug
    
    commit 05cf96398e1b6502f9e191291b715c7463c9d5dd upstream.
    
    I found following definition in include/linux/memory.h, in my IA64
    platform, SECTION_SIZE_BITS is equal to 32, and MIN_MEMORY_BLOCK_SIZE
    will be 0.
    
      #define MIN_MEMORY_BLOCK_SIZE     (1 << SECTION_SIZE_BITS)
    
    Because MIN_MEMORY_BLOCK_SIZE is int type and length of 32bits,
    so MIN_MEMORY_BLOCK_SIZE(1 << 32) will will equal to 0.
    Actually when SECTION_SIZE_BITS >= 31, MIN_MEMORY_BLOCK_SIZE will be wrong.
    This will cause wrong system memory infomation in sysfs.
    I think it should be:
    
      #define MIN_MEMORY_BLOCK_SIZE     (1UL << SECTION_SIZE_BITS)
    
    And "echo offline > memory0/state" will cause following call trace:
    
      kernel BUG at mm/memory_hotplug.c:885!
      sh[6455]: bugcheck! 0 [1]
      Pid: 6455, CPU 0, comm:                   sh
      psr : 0000101008526030 ifs : 8000000000000fa4 ip  : [<a0000001008c40f0>]    Not tainted (3.6.0-rc1)
      ip is at offline_pages+0x210/0xee0
      Call Trace:
        show_stack+0x80/0xa0
        show_regs+0x640/0x920
        die+0x190/0x2c0
        die_if_kernel+0x50/0x80
        ia64_bad_break+0x3d0/0x6e0
        ia64_native_leave_kernel+0x0/0x270
        offline_pages+0x210/0xee0
        alloc_pages_current+0x180/0x2a0
    
    Signed-off-by: Jianguo Wu <wujianguo@huawei.com>
    Signed-off-by: Jiang Liu <jiang.liu@huawei.com>
    Cc: "Luck, Tony" <tony.luck@intel.com>
    Reviewed-by: Michal Hocko <mhocko@suse.cz>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fea0071c60870fbebc605ef72d87668d72dbbd81
Author: Benoît Locher <Benoit.Locher@skf.com>
Date:   Mon Aug 27 15:02:45 2012 +0200

    can: mcp251x: avoid repeated frame bug
    
    commit cab32f39dcc5b35db96497dc0a026b5dea76e4e7 upstream.
    
    The MCP2515 has a silicon bug causing repeated frame transmission, see section
    5 of MCP2515 Rev. B Silicon Errata Revision G (March 2007).
    
    Basically, setting TXBnCTRL.TXREQ in either SPI mode (00 or 11) will eventually
    cause the bug. The workaround proposed by Microchip is to use mode 00 and send
    a RTS command on the SPI bus to initiate the transmission.
    
    Signed-off-by: Benoît Locher <Benoit.Locher@skf.com>
    Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 48f0f14ffb6ff4852922994d11fbda418d40100e
Author: Charles Wang <muming.wq@taobao.com>
Date:   Mon Aug 20 16:02:33 2012 +0800

    sched: Add missing call to calc_load_exit_idle()
    
    commit 749c8814f08f12baa4a9c2812a7c6ede7d69507d upstream.
    
    Azat Khuzhin reported high loadavg in Linux v3.6
    
    After checking the upstream scheduler code, I found Peter's commit:
    
      5167e8d5417b sched/nohz: Rewrite and fix load-avg computation -- again
    
    not fully applied, missing the call to calc_load_exit_idle().
    
    After that idle exit in sampling window will always be calculated
    to non-idle, and the load will be higher than normal.
    
    This patch adds the missing call to calc_load_exit_idle().
    
    Signed-off-by: Charles Wang <muming.wq@taobao.com>
    Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl>
    Link: http://lkml.kernel.org/r/1345449754-27130-1-git-send-email-muming.wq@gmail.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a95bb54b6345874159a82b93c67c49244d2433f2
Author: Guenter Roeck <linux@roeck-us.net>
Date:   Tue Jun 19 08:00:00 2012 -0700

    hwmon: (twl4030-madc-hwmon) Initialize uninitialized structure elements
    
    commit 73d7c119255615a26070f9d6cdb722a166a29015 upstream.
    
    twl4030_madc_conversion uses do_avg and type structure elements of
    twl4030_madc_request. Initialize structure to avoid random operation.
    
    Fix for: Coverity CID 200794 Uninitialized scalar variable.
    
    Cc: Keerthy <j-keerthy@ti.com>
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Acked-by: Jean Delvare <khali@linux-fr.org>
    Acked-by: Keerthy <j-keerthy@ti.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6093dd2f5a10b5a071aa623be7927a6421762adb
Author: Kevin Hilman <khilman@ti.com>
Date:   Mon Sep 17 14:09:17 2012 -0700

    drivers/rtc/rtc-twl.c: ensure all interrupts are disabled during probe
    
    commit 8dcebaa9a0ae8a0487f4342f3d56d2cb1c980860 upstream.
    
    On some platforms, bootloaders are known to do some interesting RTC
    programming.  Without going into the obscurities as to why this may be
    the case, suffice it to say the the driver should not make any
    assumptions about the state of the RTC when the driver loads.  In
    particular, the driver probe should be sure that all interrupts are
    disabled until otherwise programmed.
    
    This was discovered when finding bursty I2C traffic every second on
    Overo platforms.  This I2C overhead was keeping the SoC from hitting
    deep power states.  The cause was found to be the RTC firing every
    second on the I2C-connected TWL PMIC.
    
    Special thanks to Felipe Balbi for suggesting to look for a rogue driver
    as the source of the I2C traffic rather than the I2C driver itself.
    
    Special thanks to Steve Sakoman for helping track down the source of the
    continuous RTC interrups on the Overo boards.
    
    Signed-off-by: Kevin Hilman <khilman@ti.com>
    Cc: Felipe Balbi <balbi@ti.com>
    Tested-by: Steve Sakoman <steve@sakoman.com>
    Cc: Alessandro Zummo <a.zummo@towertech.it>
    Tested-by: Shubhrajyoti Datta <omaplinuxkernel@gmail.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit aa7994f281a5e705b5f9cb13b3219fc346263872
Author: Li Haifeng <omycle@gmail.com>
Date:   Mon Sep 17 14:09:21 2012 -0700

    mm/page_alloc: fix the page address of higher page's buddy calculation
    
    commit 0ba8f2d59304dfe69b59c034de723ad80f7ab9ac upstream.
    
    The heuristic method for buddy has been introduced since commit
    43506fad21ca ("mm/page_alloc.c: simplify calculation of combined index
    of adjacent buddy lists").  But the page address of higher page's buddy
    was wrongly calculated, which will lead page_is_buddy to fail for ever.
    IOW, the heuristic method would be disabled with the wrong page address
    of higher page's buddy.
    
    Calculating the page address of higher page's buddy should be based
    higher_page with the offset between index of higher page and index of
    higher page's buddy.
    
    Signed-off-by: Haifeng Li <omycle@gmail.com>
    Signed-off-by: Gavin Shan <shangw@linux.vnet.ibm.com>
    Reviewed-by: Michal Hocko <mhocko@suse.cz>
    Cc: KyongHo Cho <pullip.cho@samsung.com>
    Cc: Mel Gorman <mgorman@suse.de>
    Cc: Minchan Kim <minchan.kim@gmail.com>
    Cc: Johannes Weiner <jweiner@redhat.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a4dd7e6c27a37237f09d437a515a3330093d4f70
Author: Dylan Reid <dgreid@chromium.org>
Date:   Sat Sep 1 01:38:19 2012 -0700

    ASoC: samsung dma - Don't indicate support for pause/resume.
    
    commit 57b2d68863f281737d8596cb3d76d89d9cc54fd8 upstream.
    
    The pause and resume operations indicate that the stream can be
    un-paused/resumed from the exact location they were paused/suspended.
    This is not true for this driver, the pause and suspend triggers share
    the same code path with stop, they flush all pending DMA transfers.
    This drops all pending samples.  The pause_release/resume triggers are
    the same as start, except that prepare won't be called beforehand,
    nothing will be enqueued to the DMA engine and nothing will happen (no
    audio).  Removing the pause flag will let apps know that it isn't
    supported.  Removing the resume flag will cause user space to call
    prepare and start instead of resume, so audio will continue playing when
    the system wakes up.
    
    Before removing the pause and resume flags, I tested this on an exynos
    5250, using 'aplay -i'. Pause/un-pause leads to silence followed by a
    write error.  Suspend/resume testing led to the same result.  Removing
    the two flags fixes suspend/resume (since snd_pcm_prepare is called
    again). And leads to a proper reporting of pause not supported.
    
    Signed-off-by: Dylan Reid <dgreid@chromium.org>
    Signed-off-by: Mark Brown <broonie@opensource.wolfsonmicro.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 547ee164a63242ef14c41410615aa60aa164fce2
Author: Paul Clements <paul.clements@steeleye.com>
Date:   Mon Sep 17 14:09:02 2012 -0700

    nbd: clear waiting_queue on shutdown
    
    commit fded4e090c60100d709318896c79816d68d5b47d upstream.
    
    Fix a serious but uncommon bug in nbd which occurs when there is heavy
    I/O going to the nbd device while, at the same time, a failure (server,
    network) or manual disconnect of the nbd connection occurs.
    
    There is a small window between the time that the nbd_thread is stopped
    and the socket is shutdown where requests can continue to be queued to
    nbd's internal waiting_queue.  When this happens, those requests are
    never completed or freed.
    
    The fix is to clear the waiting_queue on shutdown of the nbd device, in
    the same way that the nbd request queue (queue_head) is already being
    cleared.
    
    Signed-off-by: Paul Clements <paul.clements@steeleye.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9fd0132a29b4e40e5cf5ff82a02227b7f603bba7
Author: NeilBrown <neilb@suse.de>
Date:   Wed Sep 19 12:52:30 2012 +1000

    md/raid5: fix calculate of 'degraded' when a replacement becomes active.
    
    commit e5c86471f933608db5d43679f84cb4346c32033e upstream.
    
    When a replacement device becomes active, we mark the device that it
    replaces as 'faulty' so that it can subsequently get removed.
    However 'calc_degraded' only pays attention to the primary device, not
    the replacement, so the array appears to become degraded, which is
    wrong.
    
    So teach 'calc_degraded' to consider any replacement if a primary
    device is faulty.
    
    This is suitable for -stable as an incorrect 'degraded' value can
    confuse md and could lead to data corruption.
    This is only relevant for 3.3 and later.
    
    Reported-by: Robin Hill <robin@robinhill.me.uk>
    Reported-by: John Drescher <drescherjm@gmail.com>
    Signed-off-by: NeilBrown <neilb@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d765682ea82fb83fd8d01b7663f78b5d2f9fd839
Author: NeilBrown <neilb@suse.de>
Date:   Wed Sep 19 12:54:22 2012 +1000

    md: make sure metadata is updated when spares are activated or removed.
    
    commit 6dafab6b1383e912cd252fa809570b484eb6e0dc upstream.
    
    It isn't always necessary to update the metadata when spares are
    removed as the presence-or-not of a spare isn't really important to
    the integrity of an array.
    Also activating a spare doesn't always require updating the metadata
    as the update on 'recovery-completed' is usually sufficient.
    
    However the introduction of 'replacement' devices have made these
    transitions sometimes more important.  For example the 'Replacement'
    flag isn't cleared until the original device is removed, so we need
    to ensure a metadata update after that 'spare' is removed.
    
    So set MD_CHANGE_DEVS whenever a spare is activated or removed, to
    complement the current situation where it is set when a spare is added
    or a device is failed (or a number of other less common situations).
    
    This is suitable for -stable as out-of-data metadata could lead
    to data corruption.
    This is only relevant for 3.3 and later 9when 'replacement' as
    introduced.
    
    Signed-off-by: NeilBrown <neilb@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1c55a12c2a3d5b54598e7ba04e2d0fcf858b9023
Author: NeilBrown <neilb@suse.de>
Date:   Thu Aug 16 16:46:12 2012 +1000

    md: Don't truncate size at 4TB for RAID0 and Linear
    
    commit 667a5313ecd7308d79629c0738b0db588b0b0a4e upstream.
    
    commit 27a7b260f71439c40546b43588448faac01adb93
       md: Fix handling for devices from 2TB to 4TB in 0.90 metadata.
    
    changed 0.90 metadata handling to truncated size to 4TB as that is
    all that 0.90 can record.
    However for RAID0 and Linear, 0.90 doesn't need to record the size, so
    this truncation is not needed and causes working arrays to become too small.
    
    So avoid the truncation for RAID0 and Linear
    
    This bug was introduced in 3.1 and is suitable for any stable kernels
    from then onwards.
    As the offending commit was tagged for 'stable', any stable kernel
    that it was applied to should also get this patch.  That includes
    at least 2.6.32, 2.6.33 and 3.0. (Thanks to Ben Hutchings for
    providing that list).
    
    Signed-off-by: Neil Brown <neilb@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dd8121960467e40388876403758334fa91516db2
Author: Dmitry Kasatkin <dmitry.kasatkin@intel.com>
Date:   Wed Sep 12 13:26:55 2012 +0300

    digsig: add hash size comparision on signature verification
    
    commit bc01637a80f5b670bd70a0279d3f93fa8de1c96d upstream.
    
    When pkcs_1_v1_5_decode_emsa() returns without error and hash sizes do
    not match, hash comparision is not done and digsig_verify_rsa() returns
    no error.  This is a bug and this patch fixes it.
    
    The bug was introduced in v3.3 by commit b35e286a640f ("lib/digsig:
    pkcs_1_v1_5_decode_emsa cleanup").
    
    Signed-off-by: Dmitry Kasatkin <dmitry.kasatkin@intel.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e3c9398035cbf79a2ab75c2f43de999fc9a726f4
Author: Mel Gorman <mgorman@suse.de>
Date:   Sun Aug 19 14:41:03 2012 +1200

    Redefine ATOMIC_INIT and ATOMIC64_INIT to drop the casts
    
    commit 67a806d9499353fabd5b5ff07337f3aa88a1c3ba upstream.
    
    The following build error occurred during an alpha build:
    
      net/core/sock.c:274:36: error: initializer element is not constant
    
    Dave Anglin says:
    > Here is the line in sock.i:
    >
    > struct static_key memalloc_socks = ((struct static_key) { .enabled =
    > ((atomic_t) { (0) }) });
    
    The above line contains two compound literals.  It also uses a designated
    initializer to initialize the field enabled.  A compound literal is not a
    constant expression.
    
    The location of the above statement isn't fully clear, but if a compound
    literal occurs outside the body of a function, the initializer list must
    consist of constant expressions.
    
    Signed-off-by: Mel Gorman <mgorman@suse.de>
    Signed-off-by: Fengguang Wu <fengguang.wu@intel.com>
    Signed-off-by: Michael Cree <mcree@orcon.net.nz>
    Acked-by: Matt Turner <mattst88@gmail.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cf499a04f9b5c8d2218257046b66b3062401673a
Author: Bjørn Mork <bjorn@mork.no>
Date:   Sun Sep 2 15:41:34 2012 +0200

    kobject: fix oops with "input0: bad kobj_uevent_env content in show_uevent()"
    
    commit 60e233a56609fd963c59e99bd75c663d63fa91b6 upstream.
    
    Fengguang Wu <fengguang.wu@intel.com> writes:
    
    > After the __devinit* removal series, I can still get kernel panic in
    > show_uevent(). So there are more sources of bug..
    >
    > Debug patch:
    >
    > @@ -343,8 +343,11 @@ static ssize_t show_uevent(struct device
    >                 goto out;
    >
    >         /* copy keys to file */
    > -       for (i = 0; i < env->envp_idx; i++)
    > +       dev_err(dev, "uevent %d env[%d]: %s/.../%s\n", env->buflen, env->envp_idx, top_kobj->name, dev->kobj.name);
    > +       for (i = 0; i < env->envp_idx; i++) {
    > +               printk(KERN_ERR "uevent %d env[%d]: %s\n", (int)count, i, env->envp[i]);
    >                 count += sprintf(&buf[count], "%s\n", env->envp[i]);
    > +       }
    >
    > Oops message, the env[] is again not properly initilized:
    >
    > [   44.068623] input input0: uevent 61 env[805306368]: input0/.../input0
    > [   44.069552] uevent 0 env[0]: (null)
    
    This is a completely different CONFIG_HOTPLUG problem, only
    demonstrating another reason why CONFIG_HOTPLUG should go away.  I had a
    hard time trying to disable it anyway ;-)
    
    The problem this time is lots of code assuming that a call to
    add_uevent_var() will guarantee that env->buflen > 0.  This is not true
    if CONFIG_HOTPLUG is unset.  So things like this end up overwriting
    env->envp_idx because the array index is -1:
    
            if (add_uevent_var(env, "MODALIAS="))
                    return -ENOMEM;
            len = input_print_modalias(&env->buf[env->buflen - 1],
                                       sizeof(env->buf) - env->buflen,
                                       dev, 0);
    
    Don't know what the best action is, given that there seem to be a *lot*
    of this around the kernel.  This patch "fixes" the problem for me, but I
    don't know if it can be considered an appropriate fix.
    
    [ It is the correct fix for now, for 3.7 forcing CONFIG_HOTPLUG to
    always be on is the longterm fix, but it's too late for 3.6 and older
    kernels to resolve this that way - gregkh ]
    
    Reported-by: Fengguang Wu <fengguang.wu@intel.com>
    Signed-off-by: Bjørn Mork <bjorn@mork.no>
    Tested-by: Fengguang Wu <fengguang.wu@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f0868b703758f19c2ced945c2c3fce1c151ab369
Author: Alan Cox <alan@linux.intel.com>
Date:   Tue Sep 4 16:07:18 2012 +0100

    ahci: Add alternate identifier for the 88SE9172
    
    commit 17c60c6b763cb5b83b0185e7d38d01d18e55a05a upstream.
    
    This can also appear as 0x9192. Reported in bugzilla and confirmed with the
    board documentation for these boards.
    
    Resolves-bug: https://bugzilla.kernel.org/show_bug.cgi?id=42970
    Signed-off-by: Alan Cox <alan@linux.intel.com>
    Signed-off-by: Jeff Garzik <jgarzik@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 93ee70835a254181a9d9c5750e9301b70899ad90
Author: Robert Richter <robert.richter@amd.com>
Date:   Thu Jul 19 18:28:26 2012 +0200

    oprofile, s390: Fix uninitialized memory access when writing to oprofilefs
    
    commit 81ff3478d9ba7f0b48b0abef740e542fd83adf79 upstream.
    
    If oprofilefs_ulong_from_user() is called with count equals zero, *val
    remains unchanged. Depending on the implementation it might be
    uninitialized. Fixing users of oprofilefs_ulong_ from_user().
    
    We missed these s390 changes with:
    
     913050b oprofile: Fix uninitialized memory access when writing to writing to oprofilefs
    
    Signed-off-by: Robert Richter <robert.richter@amd.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d409354d1b8a1e47b8f29887179949ec951ffe83
Author: Ian Chen <ian.cy.chen@samsung.com>
Date:   Wed Aug 29 15:05:36 2012 +0900

    mmc: card: Skip secure erase on MoviNAND; causes unrecoverable corruption.
    
    commit 3550ccdb9d8d350e526b809bf3dd92b550a74fe1 upstream.
    
    For several MoviNAND eMMC parts, there are known issues with secure
    erase and secure trim.  For these specific MoviNAND devices, we skip
    these operations.
    
    Specifically, there is a bug in the eMMC firmware that causes
    unrecoverable corruption when the MMC is erased with MMC_CAP_ERASE
    enabled.
    
    References:
    
    http://forum.xda-developers.com/showthread.php?t=1644364
    https://plus.google.com/111398485184813224730/posts/21pTYfTsCkB#111398485184813224730/posts/21pTYfTsCkB
    
    Signed-off-by: Ian Chen <ian.cy.chen@samsung.com>
    Reviewed-by: Namjae Jeon <linkinjeon@gmail.com>
    Acked-by: Jaehoon Chung <jh80.chung@samsung.com>
    Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Chris Ball <cjb@laptop.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e66a381518f9ebf98cdc583d20ae706aa5d1dc28
Author: Shawn Guo <shawn.guo@linaro.org>
Date:   Wed Aug 22 23:10:01 2012 +0800

    mmc: sdhci-esdhc: break out early if clock is 0
    
    commit 74f330bceaa7b88d06062e1cac3d519a3dfc041e upstream.
    
    Since commit 30832ab56 ("mmc: sdhci: Always pass clock request value
    zero to set_clock host op") was merged, esdhc_set_clock starts hitting
    "if (clock == 0)" where ESDHC_SYSTEM_CONTROL has been operated.  This
    causes SDHCI card-detection function being broken.  Fix the regression
    by moving "if (clock == 0)" above ESDHC_SYSTEM_CONTROL operation.
    
    Signed-off-by: Shawn Guo <shawn.guo@linaro.org>
    Signed-off-by: Chris Ball <cjb@laptop.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3a4781e12d0e6264c76bfd110783321450138169
Author: Lauri Hintsala <lauri.hintsala@bluegiga.com>
Date:   Tue Jul 17 17:16:09 2012 +0300

    mmc: mxs-mmc: fix deadlock in SDIO IRQ case
    
    commit 1af36b2a993dddfa3d6860ec4879c9e8abc9b976 upstream.
    
    Release the lock before mmc_signal_sdio_irq is called by mxs_mmc_irq_handler.
    
    Backtrace:
    [   79.660000] =============================================
    [   79.660000] [ INFO: possible recursive locking detected ]
    [   79.660000] 3.4.0-00009-g3e96082-dirty #11 Not tainted
    [   79.660000] ---------------------------------------------
    [   79.660000] swapper/0 is trying to acquire lock:
    [   79.660000]  (&(&host->lock)->rlock#2){-.....}, at: [<c026ea3c>] mxs_mmc_enable_sdio_irq+0x18/0xd4
    [   79.660000]
    [   79.660000] but task is already holding lock:
    [   79.660000]  (&(&host->lock)->rlock#2){-.....}, at: [<c026f744>] mxs_mmc_irq_handler+0x1c/0xe8
    [   79.660000]
    [   79.660000] other info that might help us debug this:
    [   79.660000]  Possible unsafe locking scenario:
    [   79.660000]
    [   79.660000]        CPU0
    [   79.660000]        ----
    [   79.660000]   lock(&(&host->lock)->rlock#2);
    [   79.660000]   lock(&(&host->lock)->rlock#2);
    [   79.660000]
    [   79.660000]  *** DEADLOCK ***
    [   79.660000]
    [   79.660000]  May be due to missing lock nesting notation
    [   79.660000]
    [   79.660000] 1 lock held by swapper/0:
    [   79.660000]  #0:  (&(&host->lock)->rlock#2){-.....}, at: [<c026f744>] mxs_mmc_irq_handler+0x1c/0xe8
    [   79.660000]
    [   79.660000] stack backtrace:
    [   79.660000] [<c0014bd0>] (unwind_backtrace+0x0/0xf4) from [<c005f9c0>] (__lock_acquire+0x1948/0x1d48)
    [   79.660000] [<c005f9c0>] (__lock_acquire+0x1948/0x1d48) from [<c005fea0>] (lock_acquire+0xe0/0xf8)
    [   79.660000] [<c005fea0>] (lock_acquire+0xe0/0xf8) from [<c03a8460>] (_raw_spin_lock_irqsave+0x44/0x58)
    [   79.660000] [<c03a8460>] (_raw_spin_lock_irqsave+0x44/0x58) from [<c026ea3c>] (mxs_mmc_enable_sdio_irq+0x18/0xd4)
    [   79.660000] [<c026ea3c>] (mxs_mmc_enable_sdio_irq+0x18/0xd4) from [<c026f7fc>] (mxs_mmc_irq_handler+0xd4/0xe8)
    [   79.660000] [<c026f7fc>] (mxs_mmc_irq_handler+0xd4/0xe8) from [<c006bdd8>] (handle_irq_event_percpu+0x70/0x254)
    [   79.660000] [<c006bdd8>] (handle_irq_event_percpu+0x70/0x254) from [<c006bff8>] (handle_irq_event+0x3c/0x5c)
    [   79.660000] [<c006bff8>] (handle_irq_event+0x3c/0x5c) from [<c006e6d0>] (handle_level_irq+0x90/0x110)
    [   79.660000] [<c006e6d0>] (handle_level_irq+0x90/0x110) from [<c006b930>] (generic_handle_irq+0x38/0x50)
    [   79.660000] [<c006b930>] (generic_handle_irq+0x38/0x50) from [<c00102fc>] (handle_IRQ+0x30/0x84)
    [   79.660000] [<c00102fc>] (handle_IRQ+0x30/0x84) from [<c000f058>] (__irq_svc+0x38/0x60)
    [   79.660000] [<c000f058>] (__irq_svc+0x38/0x60) from [<c0010520>] (default_idle+0x2c/0x40)
    [   79.660000] [<c0010520>] (default_idle+0x2c/0x40) from [<c0010a90>] (cpu_idle+0x64/0xcc)
    [   79.660000] [<c0010a90>] (cpu_idle+0x64/0xcc) from [<c04ff858>] (start_kernel+0x244/0x2c8)
    [   79.660000] BUG: spinlock lockup on CPU#0, swapper/0
    [   79.660000]  lock: c398cb2c, .magic: dead4ead, .owner: swapper/0, .owner_cpu: 0
    [   79.660000] [<c0014bd0>] (unwind_backtrace+0x0/0xf4) from [<c01ddb1c>] (do_raw_spin_lock+0xf0/0x144)
    [   79.660000] [<c01ddb1c>] (do_raw_spin_lock+0xf0/0x144) from [<c03a8468>] (_raw_spin_lock_irqsave+0x4c/0x58)
    [   79.660000] [<c03a8468>] (_raw_spin_lock_irqsave+0x4c/0x58) from [<c026ea3c>] (mxs_mmc_enable_sdio_irq+0x18/0xd4)
    [   79.660000] [<c026ea3c>] (mxs_mmc_enable_sdio_irq+0x18/0xd4) from [<c026f7fc>] (mxs_mmc_irq_handler+0xd4/0xe8)
    [   79.660000] [<c026f7fc>] (mxs_mmc_irq_handler+0xd4/0xe8) from [<c006bdd8>] (handle_irq_event_percpu+0x70/0x254)
    [   79.660000] [<c006bdd8>] (handle_irq_event_percpu+0x70/0x254) from [<c006bff8>] (handle_irq_event+0x3c/0x5c)
    [   79.660000] [<c006bff8>] (handle_irq_event+0x3c/0x5c) from [<c006e6d0>] (handle_level_irq+0x90/0x110)
    [   79.660000] [<c006e6d0>] (handle_level_irq+0x90/0x110) from [<c006b930>] (generic_handle_irq+0x38/0x50)
    [   79.660000] [<c006b930>] (generic_handle_irq+0x38/0x50) from [<c00102fc>] (handle_IRQ+0x30/0x84)
    [   79.660000] [<c00102fc>] (handle_IRQ+0x30/0x84) from [<c000f058>] (__irq_svc+0x38/0x60)
    [   79.660000] [<c000f058>] (__irq_svc+0x38/0x60) from [<c0010520>] (default_idle+0x2c/0x40)
    [   79.660000] [<c0010520>] (default_idle+0x2c/0x40) from [<c0010a90>] (cpu_idle+0x64/0xcc)
    [   79.660000] [<c0010a90>] (cpu_idle+0x64/0xcc) from [<c04ff858>] (start_kernel+0x244/0x2c8)
    
    Signed-off-by: Lauri Hintsala <lauri.hintsala@bluegiga.com>
    Acked-by: Shawn Guo <shawn.guo@linaro.org>
    Signed-off-by: Chris Ball <cjb@laptop.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8889866c58f77c557e79a30853ee4fd5f50780ef
Author: Aaron Lu <aaron.lu@intel.com>
Date:   Fri Sep 14 20:54:44 2012 +0200

    ACPI / PM: Use KERN_DEBUG when no power resources are found
    
    commit f25b70613c048ceb1df052576fda03321ebf41cf upstream.
    
    commit a606dac368eed5696fb38e16b1394f1d049c09e9 adds support to link
    devices which have _PRx, if a device does not have _PRx, a warning
    message will be printed.
    
    This commit is for ZPODD on Intel ZPODD capable platforms, on other
    platforms, it has no problem if there is no power resource for this
    device, so a warning here is not appropriate, change it to debug.
    
    Reported-by: Borislav Petkov <bp@amd64.org>
    Signed-off-by: Aaron Lu <aaron.lu@intel.com>
    Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2bafdfd612901af70fcea3cf1866e388eb68fdf0
Author: Lin Ming <ming.m.lin@intel.com>
Date:   Fri Sep 14 00:26:33 2012 +0200

    ACPI / PM: Fix resource_lock dead lock in acpi_power_on_device
    
    commit 40bf66ec9791f1452b90b82aadc3b6e6aee201f5 upstream.
    
    Commit 0090def("ACPI: Add interface to register/unregister device
    to/from power resources") used resource_lock to protect the devices list
    that relies on power resource. It caused a mutex dead lock, as below
    
        acpi_power_on ---> lock resource_lock
          __acpi_power_on
            acpi_power_on_device
              acpi_power_get_inferred_state
                acpi_power_get_list_state ---> lock resource_lock
    
    This patch adds a new mutex "devices_lock" to protect the devices list
    and calls acpi_power_on_device in acpi_power_on, instead of
    __acpi_power_on, after the resource_lock is released.
    
    [rjw: Changed data type of a boolean variable to bool.]
    
    Signed-off-by: Lin Ming <ming.m.lin@intel.com>
    Signed-off-by: Aaron Lu <aaron.lu@intel.com>
    Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d156b47c4242843096e4a13f8ace5a0626bde3e9
Author: Al Viro <viro@ZenIV.linux.org.uk>
Date:   Mon Aug 20 14:59:25 2012 +0100

    perf_event: Switch to internal refcount, fix race with close()
    
    commit a6fa941d94b411bbd2b6421ffbde6db3c93e65ab upstream.
    
    Don't mess with file refcounts (or keep a reference to file, for
    that matter) in perf_event.  Use explicit refcount of its own
    instead.  Deal with the race between the final reference to event
    going away and new children getting created for it by use of
    atomic_long_inc_not_zero() in inherit_event(); just have the
    latter free what it had allocated and return NULL, that works
    out just fine (children of siblings of something doomed are
    created as singletons, same as if the child of leader had been
    created and immediately killed).
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl>
    Link: http://lkml.kernel.org/r/20120820135925.GG23464@ZenIV.linux.org.uk
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9b52a3b313497af37dcdba4ba4c0c95809db525c
Author: Stephen Warren <swarren@nvidia.com>
Date:   Fri Aug 24 21:20:15 2012 -0600

    sound: tegra_alc5632: remove HP detect GPIO inversion
    
    commit c921928661eda599d73a6a86e58bdd5aecfa18cb upstream.
    
    Both the schematics and practical testing show that the HP detect GPIO
    is high when the headphones are plugged in. Hence, the snd_soc_jack_gpio
    should not specify to invert the signal.
    
    Signed-off-by: Stephen Warren <swarren@nvidia.com>
    Acked-by: Andrey Danin <danindrey@mail.ru>
    Signed-off-by: Mark Brown <broonie@opensource.wolfsonmicro.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2ad98b042313307859bf2f332b95b6588ec0ba0d
Author: Francesco Ruggeri <fruggeri@aristanetworks.com>
Date:   Thu Sep 13 15:03:37 2012 -0700

    fs/proc: fix potential unregister_sysctl_table hang
    
    commit 6bf6104573482570f7103d3e5ddf9574db43a363 upstream.
    
    The unregister_sysctl_table() function hangs if all references to its
    ctl_table_header structure are not dropped.
    
    This can happen sometimes because of a leak in proc_sys_lookup():
    proc_sys_lookup() gets a reference to the table via lookup_entry(), but
    it does not release it when a subsequent call to sysctl_follow_link()
    fails.
    
    This patch fixes this leak by making sure the reference is always
    dropped on return.
    
    See also commit 076c3eed2c31 ("sysctl: Rewrite proc_sys_lookup
    introducing find_entry and lookup_entry") which reorganized this code in
    3.4.
    
    Tested in Linux 3.4.4.
    
    Signed-off-by: Francesco Ruggeri <fruggeri@aristanetworks.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 125c4c2a41ac9249b54602db68b81a5ad398bbb7
Author: Bjørn Mork <bjorn@mork.no>
Date:   Tue Sep 11 09:40:31 2012 +0200

    USB: option: replace ZTE K5006-Z entry with vendor class rule
    
    commit ba9edaa468869a8cea242a411066b0f490751798 upstream.
    
    Fix the ZTE K5006-Z entry so that it actually matches anything
    
      commit f1b5c997 USB: option: add ZTE K5006-Z
    
    added a device specific entry assuming that the device would use
    class/subclass/proto == ff/ff/ff like other ZTE devices. It
    turns out that ZTE has started using vendor specific subclass
    and protocol codes:
    
    T:  Bus=01 Lev=01 Prnt=01 Port=03 Cnt=01 Dev#=  4 Spd=480  MxCh= 0
    D:  Ver= 2.00 Cls=00(>ifc ) Sub=00 Prot=00 MxPS=64 #Cfgs=  1
    P:  Vendor=19d2 ProdID=1018 Rev= 0.00
    S:  Manufacturer=ZTE,Incorporated
    S:  Product=ZTE LTE Technologies MSM
    S:  SerialNumber=MF821Vxxxxxxx
    C:* #Ifs= 5 Cfg#= 1 Atr=c0 MxPwr=500mA
    I:* If#= 0 Alt= 0 #EPs= 2 Cls=ff(vend.) Sub=86 Prot=10 Driver=(none)
    E:  Ad=81(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms
    E:  Ad=01(O) Atr=02(Bulk) MxPS= 512 Ivl=4ms
    I:* If#= 1 Alt= 0 #EPs= 2 Cls=ff(vend.) Sub=02 Prot=05 Driver=(none)
    E:  Ad=82(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms
    E:  Ad=02(O) Atr=02(Bulk) MxPS= 512 Ivl=4ms
    I:* If#= 2 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=02 Prot=01 Driver=(none)
    E:  Ad=83(I) Atr=03(Int.) MxPS=  64 Ivl=2ms
    E:  Ad=84(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms
    E:  Ad=03(O) Atr=02(Bulk) MxPS= 512 Ivl=4ms
    I:* If#= 3 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=06 Prot=00 Driver=qmi_wwan
    E:  Ad=85(I) Atr=03(Int.) MxPS=  64 Ivl=2ms
    E:  Ad=86(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms
    E:  Ad=04(O) Atr=02(Bulk) MxPS= 512 Ivl=4ms
    I:* If#= 4 Alt= 0 #EPs= 2 Cls=08(stor.) Sub=06 Prot=50 Driver=usb-storage
    E:  Ad=05(O) Atr=02(Bulk) MxPS= 512 Ivl=0ms
    E:  Ad=87(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms
    
    We do not have any information on how ZTE intend to use these
    codes, but let us assume for now that the 3 sets matching
    serial functions in the K5006-Z always will identify a serial
    function in a ZTE device.
    
    Cc: Thomas Schäfer <tschaefer@t-online.de>
    Signed-off-by: Bjørn Mork <bjorn@mork.no>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8ef2b61115a3baeb3dc60782af32a3f6c46ed7a4
Author: Ian Abbott <abbotti@mev.co.uk>
Date:   Fri Aug 31 20:41:30 2012 +0100

    staging: comedi: das08: Correct AO output for das08jr-16-ao
    
    commit 61ed59ed09e6ad2b8395178ea5ad5f653bba08e3 upstream.
    
    Don't zero out bits 15..12 of the data value in `das08jr_ao_winsn()` as
    that knobbles the upper three-quarters of the output range for the
    'das08jr-16-ao' board.
    
    Signed-off-by: Ian Abbott <abbotti@mev.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8fae345eec6e2fff49e634b108f3318d88205c6c
Author: Eric Dumazet <edumazet@google.com>
Date:   Mon Sep 10 21:22:11 2012 +0200

    staging: r8712u: fix bug in r8712_recv_indicatepkt()
    
    commit abf02cfc179bb4bd30d05f582d61b3b8f429b813 upstream.
    
    64bit arches have a buggy r8712u driver, let's fix it.
    
    skb->tail must be set properly or network stack behavior is undefined.
    
    Addresses https://bugzilla.redhat.com/show_bug.cgi?id=847525
    Addresses https://bugzilla.kernel.org/show_bug.cgi?id=45071
    
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Cc: Dave Jones <davej@redhat.com>
    Acked-by: Larry Finger <Larry.Finger@lwfinger.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 191ee4172f0a89b85ce1daad00d88f33b66e07e6
Author: Malcolm Priestley <tvboxspy@gmail.com>
Date:   Wed Aug 29 23:08:21 2012 +0100

    staging: vt6656: [BUG] - Failed connection, incorrect endian.
    
    commit aa209eef3ce8419ff2926c2fa944dfbfb5afbacb upstream.
    
    Hi,
    
    This patch fixes a bug with driver failing to negotiate a connection.
    
    The bug was traced to commit
    203e4615ee9d9fa8d3506b9d0ef30095e4d5bc90
    staging: vt6656: removed custom definitions of Ethernet packet types
    
    In that patch, definitions in include/linux/if_ether.h replaced ones
    in tether.h which had both big and little endian definitions.
    
    include/linux/if_ether.h only refers to big endian values, cpu_to_be16
    should be used for the correct endian architectures.
    
    Signed-off-by: Malcolm Priestley <tvboxspy@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6d4960ed8247d763e9022bda9f068fec7000af3f
Author: Seth Jennings <sjenning@linux.vnet.ibm.com>
Date:   Wed Aug 29 16:58:45 2012 -0500

    staging: zcache: fix cleancache race condition with shrinker
    
    commit 6d7d9798ad5c97ee4e911dd070dc12dc5ae55bd0 upstream.
    
    This patch fixes a race condition that results in memory
    corruption when using cleancache.
    
    The race exists between the zcache shrinker handler,
    shrink_zcache_memory() and cleancache_get_page().
    
    In most cases, the shrinker will both evict a zbpg
    from its buddy list and flush it from tmem before a
    cleancache_get_page() occurs on that page. A subsequent
    cleancache_get_page() will fail in the tmem layer.
    
    In the rare case that two occur together and the
    cleancache_get_page() path gets through the tmem
    layer before the shrinker path can flush tmem,
    zbud_decompress() does a check to see if the zbpg is a
    "zombie", i.e. not on a buddy list, which means the shrinker
    is in the process of reclaiming it. If the zbpg is a zombie,
    zbud_decompress() returns -EINVAL.
    
    However, this return code is being ignored by the caller,
    zcache_pampd_get_data_and_free(), which results in the
    caller of cleancache_get_page() thinking that the page has
    been properly retrieved when it has not.
    
    This patch modifies zcache_pampd_get_data_and_free() to
    convey the failure up the stack so that the caller of
    cleancache_get_page() knows the page retrieval failed.
    
    This needs to be applied to stable trees as well.
    zcache-main.c was named zcache.c before v3.1, so
    I'm not sure how you want to handle trees earlier
    than that.
    
    Signed-off-by: Seth Jennings <sjenning@linux.vnet.ibm.com>
    Reviewed-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
    Reviewed-by: Minchan Kim <minchan@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 18e64a0a0dfc533ab56f7aa198316b4ea11adca9
Author: Christopher Brannon <chris@the-brannons.com>
Date:   Sat Jun 16 16:55:20 2012 -0500

    Staging: speakup: fix an improperly-declared variable.
    
    commit 4ea418b8b2fa8a70d0fcc8231b65e67b3a72984b upstream.
    
    A local static variable was declared as a pointer to a string
    constant.  We're assigning to the underlying memory, so it
    needs to be an array instead.
    
    Signed-off-by: Christopher Brannon <chris@the-brannons.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4386363312d70a764a376f1635467bab8e26965a
Author: Takashi Iwai <tiwai@suse.de>
Date:   Thu Sep 20 07:44:11 2012 +0200

    ALSA: hda - Workaround for silent output on VAIO Z with ALC889
    
    commit e427c2375646789ecd0ccaef1a1e41458559ab2d upstream.
    
    On recent kernels, Realtek codec parser tries to optimize the routing
    aggressively and take the headphone output as primary at first.  This
    caused a regression on VAIO Z with ALC889, the silent output from the
    speaker.
    
    The problem seems that the speaker pin must be connected to the first
    DAC (0x02) on this machine by some reason although the codec itself
    advertises the flexible routing with any DACs.
    
    This patch adds a fix-up for choosing the speaker pin as the primary
    so that the right DAC is assigned on this device.
    
    Reported-and-tested-by: Adam Williamson <awilliam@redhat.com>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 23b5a5da4f07b887adce9b42daa7aa14a72a5427
Author: Matteo Frigo <athena@fftw.org>
Date:   Wed Sep 12 10:12:06 2012 -0400

    ALSA: ice1724: Use linear scale for AK4396 volume control.
    
    commit 3737e2be505d872bf2b3c1cd4151b2d2b413d7b5 upstream.
    
    The AK4396 DAC has a linear-scale attentuator, but
    sound/pci/ice1712/prodigy_hifi.c used a log scale instead, which is
    not quite right.  This patch restores the correct scale, borrowing
    from the ak4396 code in sound/pci/oxygen/oxygen.c.
    
    Signed-off-by: Matteo Frigo <athena@fftw.org>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6172ace501d10b1c629c5e82af26d0b87773c1ef
Author: Takashi Iwai <tiwai@suse.de>
Date:   Mon Sep 10 09:39:31 2012 +0200

    ALSA: hda - Fix Oops at codec reset/reconfig
    
    commit 07dc59f0988cb54fd87bd373b3b27eb2401dd811 upstream.
    
    snd_hda_codec_reset() calls restore_pincfgs() where the codec is
    powered up again, which eventually tries to resume and initialize via
    the callbacks of the codec.  However, it's the place just after codec
    free callback, thus no codec callbacks should be called after that.
    On a codec like CS4206, it results in Oops due to the access in init
    callback.
    
    This patch fixes the issue by clearing the codec callbacks properly
    after freeing codec.
    
    Reported-by: Daniel J Blueman <daniel@quora.org>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 68983b9dae341fbca6b74be02248adb86e105818
Author: Takashi Iwai <tiwai@suse.de>
Date:   Thu Sep 6 10:10:11 2012 +0200

    ALSA: hda - Fix missing Master volume for STAC9200/925x
    
    commit ab548d2dba63ba947287965e525cc02a15d9853d upstream.
    
    With the commit [2faa3bf: ALSA: hda - Rewrite the mute-LED hook with
    vmaster hook in patch_sigmatel.c], the former Master volume control
    was converted to PCM.  This was supposed to be covered by the vmaster
    control.  But due to the lack of "PCM" slave definition, this didn't
    happen properly.  The patch fixes the missing entry.
    
    Reported-by: Andrew Shadura <bugzilla@tut.by>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4dbbba47b19e4e2902a3b5115569e97c210c3297
Author: Russell King <rmk+kernel@arm.linux.org.uk>
Date:   Sat Aug 25 09:03:15 2012 +0100

    ARM: Fix ioremap() of address zero
    
    commit a849088aa1552b1a28eea3daff599ee22a734ae3 upstream.
    
    Murali Nalajala reports a regression that ioremapping address zero
    results in an oops dump:
    
    Unable to handle kernel paging request at virtual address fa200000
    pgd = d4f80000
    [fa200000] *pgd=00000000
    Internal error: Oops: 5 [#1] PREEMPT SMP ARM
    Modules linked in:
    CPU: 0    Tainted: G        W (3.4.0-g3b5f728-00009-g638207a #13)
    PC is at msm_pm_config_rst_vector_before_pc+0x8/0x30
    LR is at msm_pm_boot_config_before_pc+0x18/0x20
    pc : [<c0078f84>]    lr : [<c007903c>]    psr: a0000093
    sp : c0837ef0  ip : cfe00000  fp : 0000000d
    r10: da7efc17  r9 : 225c4278  r8 : 00000006
    r7 : 0003c000  r6 : c085c824  r5 : 00000001  r4 : fa101000
    r3 : fa200000  r2 : c095080c  r1 : 002250fc  r0 : 00000000
    Flags: NzCv  IRQs off  FIQs on  Mode SVC_32  ISA ARM Segment kernel
    Control: 10c5387d  Table: 25180059  DAC: 00000015
    [<c0078f84>] (msm_pm_config_rst_vector_before_pc+0x8/0x30) from [<c007903c>] (msm_pm_boot_config_before_pc+0x18/0x20)
    [<c007903c>] (msm_pm_boot_config_before_pc+0x18/0x20) from [<c007a55c>] (msm_pm_power_collapse+0x410/0xb04)
    [<c007a55c>] (msm_pm_power_collapse+0x410/0xb04) from [<c007b17c>] (arch_idle+0x294/0x3e0)
    [<c007b17c>] (arch_idle+0x294/0x3e0) from [<c000eed8>] (default_idle+0x18/0x2c)
    [<c000eed8>] (default_idle+0x18/0x2c) from [<c000f254>] (cpu_idle+0x90/0xe4)
    [<c000f254>] (cpu_idle+0x90/0xe4) from [<c057231c>] (rest_init+0x88/0xa0)
    [<c057231c>] (rest_init+0x88/0xa0) from [<c07ff890>] (start_kernel+0x3a8/0x40c)
    Code: c0704256 e12fff1e e59f2020 e5923000 (e5930000)
    
    This is caused by the 'reserved' entries which we insert (see
    19b52abe3c5d7 - ARM: 7438/1: fill possible PMD empty section gaps)
    which get matched for physical address zero.
    
    Resolve this by marking these reserved entries with a different flag.
    
    Tested-by: Murali Nalajala <mnalajal@codeaurora.org>
    Acked-by: Nicolas Pitre <nico@linaro.org>
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6252fbdc0a40c20a21b24d7bfccf3c08ea9b10dc
Author: Dae S. Kim <dae@velatum.com>
Date:   Fri Aug 31 02:00:51 2012 +0200

    Staging: Android alarm: IOCTL command encoding fix
    
    commit 6bd4a5d96c08dc2380f8053b1bd4f879f55cd3c9 upstream.
    
    Fixed a bug. Data was being written to user space using an IOCTL
    command encoded with _IOC_WRITE access mode.
    
    Signed-off-by: Dae S. Kim <dae@velatum.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8cc876def310b034ab0e0775a14d1a49472d7f5f
Author: Russell King <rmk+kernel@arm.linux.org.uk>
Date:   Fri Sep 7 18:22:28 2012 +0100

    ARM: 7527/1: uaccess: explicitly check __user pointer when !CPU_USE_DOMAINS
    
    commit 8404663f81d212918ff85f493649a7991209fa04 upstream.
    
    The {get,put}_user macros don't perform range checking on the provided
    __user address when !CPU_HAS_DOMAINS.
    
    This patch reworks the out-of-line assembly accessors to check the user
    address against a specified limit, returning -EFAULT if is is out of
    range.
    
    [will: changed get_user register allocation to match put_user]
    [rmk: fixed building on older ARM architectures]
    
    Reported-by: Catalin Marinas <catalin.marinas@arm.com>
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit eff605bb6c699aae80b199010f0beb26563fc399
Author: Will Deacon <will@kernel.org>
Date:   Fri Sep 7 18:21:44 2012 +0100

    ARM: 7526/1: traps: send SIGILL if get_user fails on undef handling path
    
    commit 2b2040af0b64cd93e5d4df2494c4486cf604090d upstream.
    
    get_user may fail to load from the provided __user address due to an
    unhandled fault generated by the access.
    
    In the case of the undefined instruction trap, this results in failure
    to load the faulting instruction, in which case we should send SIGILL to
    the task rather than continue with potentially uninitialised data.
    
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dab510cf4641187bf69e1b5e1be014848c1b473f
Author: David Brown <davidb@codeaurora.org>
Date:   Tue Sep 4 21:36:37 2012 +0100

    ARM: 7513/1: Make sure dtc is built before running it
    
    commit 70b0476a2394de4f4e32e0b67288d80ff71ca963 upstream.
    
    'make dtbs' in a clean tree will try running the dtc before actually
    building it.  Make these rules depend upon the scripts to build it.
    
    Signed-off-by: David Brown <davidb@codeaurora.org>
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3518fd322d6b13b278830cc41e26d6011c3641fa
Author: Will Deacon <will@kernel.org>
Date:   Thu Aug 16 18:55:44 2012 +0100

    ARM: 7496/1: hw_breakpoint: don't rely on dfsr to show watchpoint access type
    
    commit bf8801145c01ab600f8df66e8c879ac642fa5846 upstream.
    
    From ARM debug architecture v7.1 onwards, a watchpoint exception causes
    the DFAR to be updated with the faulting data address. However, DFSR.WnR
    takes an UNKNOWN value and therefore cannot be used in general to
    determine the access type that triggered the watchpoint.
    
    This patch forbids watchpoints without an overflow handler from
    specifying a specific access type (load/store). Those with overflow
    handlers must be able to handle false positives potentially triggered by
    a watchpoint of a different access type on the same address. For
    SIGTRAP-based handlers (i.e. ptrace), this should have no impact.
    
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a18a65bd69dfdb28e729f22f9ca171fa81544dc4
Author: Nicholas Bellinger <nab@linux-iscsi.org>
Date:   Thu Aug 16 15:33:10 2012 -0700

    target: Fix ->data_length re-assignment bug with SCSI overflow
    
    commit 4c054ba63ad47ef244cfcfa1cea38134620a5bae upstream.
    
    This patch fixes a long-standing bug with SCSI overflow handling
    where se_cmd->data_length was incorrectly being re-assigned to
    the larger CDB extracted allocation length, resulting in a number
    of fabric level errors that would end up causing a session reset
    in most cases.  So instead now:
    
     - Only re-assign se_cmd->data_length durining UNDERFLOW (to use the
       smaller value)
     - Use existing se_cmd->data_length for OVERFLOW (to use the smaller
       value)
    
    This fix has been tested with the following CDB to generate an
    SCSI overflow:
    
      sg_raw -r512 /dev/sdc 28 0 0 0 0 0 0 0 9 0
    
    Tested using iscsi-target, tcm_qla2xxx, loopback and tcm_vhost fabric
    ports.  Here is a bit more detail on each case:
    
     - iscsi-target: Bug with open-iscsi with overflow, sg_raw returns
                     -3584 bytes of data.
     - tcm_qla2xxx: Working as expected, returnins 512 bytes of data
     - loopback: sg_raw returns CHECK_CONDITION, from overflow rejection
                 in transport_generic_map_mem_to_cmd()
     - tcm_vhost: Same as loopback
    
    Reported-by: Roland Dreier <roland@purestorage.com>
    Cc: Roland Dreier <roland@purestorage.com>
    Cc: Christoph Hellwig <hch@lst.de>
    Cc: Boaz Harrosh <bharrosh@panasas.com>
    Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2d4d5e8eefbfb75feac2f2d98b70399f4c5c09a5
Author: Tyler Hicks <tyhicks@canonical.com>
Date:   Thu Sep 13 12:00:56 2012 -0700

    eCryptfs: Copy up attributes of the lower target inode after rename
    
    commit 8335eafc2859e1a26282bef7c3d19f3d68868b8a upstream.
    
    After calling into the lower filesystem to do a rename, the lower target
    inode's attributes were not copied up to the eCryptfs target inode. This
    resulted in the eCryptfs target inode staying around, rather than being
    evicted, because i_nlink was not updated for the eCryptfs inode. This
    also meant that eCryptfs didn't do the final iput() on the lower target
    inode so it stayed around, as well. This would result in a failure to
    free up space occupied by the target file in the rename() operation.
    Both target inodes would eventually be evicted when the eCryptfs
    filesystem was unmounted.
    
    This patch calls fsstack_copy_attr_all() after the lower filesystem
    does its ->rename() so that important inode attributes, such as i_nlink,
    are updated at the eCryptfs layer. ecryptfs_evict_inode() is now called
    and eCryptfs can drop its final reference on the lower inode.
    
    http://launchpad.net/bugs/561129
    
    Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
    Tested-by: Colin Ian King <colin.king@canonical.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 25941570aadb0f03270acab13bab1378eec5ea21
Author: Amerigo Wang <amwang@redhat.com>
Date:   Sat Aug 18 07:02:20 2012 +0000

    netconsole: remove a redundant netconsole_target_put()
    
    commit 72d3eb13b5c0abe7d63efac41f39c5b644c7bbaa upstream.
    
    This netconsole_target_put() is obviously redundant, and it
    causes a kernel segfault when removing a bridge device which has
    netconsole running on it.
    
    This is caused by:
    
            commit 8d8fc29d02a33e4bd5f4fa47823c1fd386346093
            Author: Amerigo Wang <amwang@redhat.com>
            Date:   Thu May 19 21:39:10 2011 +0000
    
                netpoll: disable netpoll when enslave a device
    
    Signed-off-by: Cong Wang <amwang@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f92e8b0ddb85dfe7d8d2547516c873ec8dd9838e
Author: Miklos Szeredi <mszeredi@suse.cz>
Date:   Mon Sep 17 22:31:38 2012 +0200

    vfs: dcache: use DCACHE_DENTRY_KILLED instead of DCACHE_DISCONNECTED in d_kill()
    
    commit b161dfa6937ae46d50adce8a7c6b12233e96e7bd upstream.
    
    IBM reported a soft lockup after applying the fix for the rename_lock
    deadlock.  Commit c83ce989cb5f ("VFS: Fix the nfs sillyrename regression
    in kernel 2.6.38") was found to be the culprit.
    
    The nfs sillyrename fix used DCACHE_DISCONNECTED to indicate that the
    dentry was killed.  This flag can be set on non-killed dentries too,
    which results in infinite retries when trying to traverse the dentry
    tree.
    
    This patch introduces a separate flag: DCACHE_DENTRY_KILLED, which is
    only set in d_kill() and makes try_to_ascend() test only this flag.
    
    IBM reported successful test results with this patch.
    
    Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
    Cc: Trond Myklebust <Trond.Myklebust@netapp.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5975bc201acbe121eaf22ee41076a08b92abc26f
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Fri Sep 14 14:48:21 2012 -0700

    vfs: make O_PATH file descriptors usable for 'fstat()'
    
    commit 55815f70147dcfa3ead5738fd56d3574e2e3c1c2 upstream.
    
    We already use them for openat() and friends, but fstat() also wants to
    be able to use O_PATH file descriptors.  This should make it more
    directly comparable to the O_SEARCH of Solaris.
    
    Note that you could already do the same thing with "fstatat()" and an
    empty path, but just doing "fstat()" directly is simpler and faster, so
    there is no reason not to just allow it directly.
    
    See also commit 332a2e1244bd, which did the same thing for fchdir, for
    the same reasons.
    
    Reported-by: ольга крыжановская <olga.kryzhanovska@gmail.com>
    Cc: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f2742791b906afefa8f20906824d594e56afa20c
Author: Stephen M. Cameron <scameron@beardog.cce.hp.com>
Date:   Fri Sep 14 16:35:10 2012 -0500

    cciss: fix handling of protocol error
    
    commit 2453f5f992717251cfadab6184fbb3ec2f2e8b40 upstream.
    
    If a command completes with a status of CMD_PROTOCOL_ERR, this
    information should be conveyed to the SCSI mid layer, not dropped
    on the floor.  Unlike a similar bug in the hpsa driver, this bug
    only affects tape drives and CD and DVD ROM drives in the cciss
    driver, and to induce it, you have to disconnect (or damage) a
    cable, so it is not a very likely scenario (which would explain
    why the bug has gone undetected for the last 10 years.)
    
    Signed-off-by: Stephen M. Cameron <scameron@beardog.cce.hp.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3b4a9ccbdc75c6c014383b8656b57afd249d65cf
Author: Tejun Heo <tj@kernel.org>
Date:   Tue Sep 18 14:24:59 2012 -0700

    cpufreq/powernow-k8: workqueue user shouldn't migrate the kworker to another CPU
    
    commit 6889125b8b4e09c5e53e6ecab3433bed1ce198c9 upstream.
    
    powernowk8_target() runs off a per-cpu work item and if the
    cpufreq_policy->cpu is different from the current one, it migrates the
    kworker to the target CPU by manipulating current->cpus_allowed.  The
    function migrates the kworker back to the original CPU but this is
    still broken.  Workqueue concurrency management requires the kworkers
    to stay on the same CPU and powernowk8_target() ends up triggerring
    BUG_ON(rq != this_rq()) in try_to_wake_up_local() if it contends on
    fidvid_mutex and sleeps.
    
    It is unclear why this bug is being reported now.  Duncan says it
    appeared to be a regression of 3.6-rc1 and couldn't reproduce it on
    3.5.  Bisection seemed to point to 63d95a91 "workqueue: use @pool
    instead of @gcwq or @cpu where applicable" which is an non-functional
    change.  Given that the reproduce case sometimes took upto days to
    trigger, it's easy to be misled while bisecting.  Maybe something made
    contention on fidvid_mutex more likely?  I don't know.
    
    This patch fixes the bug by using work_on_cpu() instead if @pol->cpu
    isn't the same as the current one.  The code assumes that
    cpufreq_policy->cpu is kept online by the caller, which Rafael tells
    me is the case.
    
    stable: ed48ece27c ("workqueue: reimplement work_on_cpu() using
            system_wq") should be applied before this; otherwise, the
            behavior could be horrible.
    
    Signed-off-by: Tejun Heo <tj@kernel.org>
    Reported-by: Duncan <1i5t5.duncan@cox.net>
    Tested-by: Duncan <1i5t5.duncan@cox.net>
    Cc: Rafael J. Wysocki <rjw@sisk.pl>
    Cc: Andreas Herrmann <andreas.herrmann3@amd.com>
    Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=47301
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fc7da7e1c4356e4ffc7c30423325b7f0da3311b2
Author: Tejun Heo <tj@kernel.org>
Date:   Tue Sep 18 12:48:43 2012 -0700

    workqueue: reimplement work_on_cpu() using system_wq
    
    commit ed48ece27cd3d5ee0354c32bbaec0f3e1d4715c3 upstream.
    
    The existing work_on_cpu() implementation is hugely inefficient.  It
    creates a new kthread, execute that single function and then let the
    kthread die on each invocation.
    
    Now that system_wq can handle concurrent executions, there's no
    advantage of doing this.  Reimplement work_on_cpu() using system_wq
    which makes it simpler and way more efficient.
    
    stable: While this isn't a fix in itself, it's needed to fix a
            workqueue related bug in cpufreq/powernow-k8.  AFAICS, this
            shouldn't break other existing users.
    
    Signed-off-by: Tejun Heo <tj@kernel.org>
    Acked-by: Jiri Kosina <jkosina@suse.cz>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Bjorn Helgaas <bhelgaas@google.com>
    Cc: Len Brown <lenb@kernel.org>
    Cc: Rafael J. Wysocki <rjw@sisk.pl>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2ff0cd9f615bae1de9d812de92eff6426aad26c9
Author: Jesse Gross <jesse@nicira.com>
Date:   Fri May 25 11:29:30 2012 -0700

    openvswitch: Reset upper layer protocol info on internal devices.
    
    [ Upstream commit 7fe99e2d434eafeac0c57b279a77e5de39212636 ]
    
    It's possible that packets that are sent on internal devices (from
    the OVS perspective) have already traversed the local IP stack.
    After they go through the internal device, they will again travel
    through the IP stack which may get confused by the presence of
    existing information in the skb. The problem can be observed
    when switching between namespaces. This clears out that information
    to avoid problems but deliberately leaves other metadata alone.
    This is to provide maximum flexibility in chaining together OVS
    and other Linux components.
    
    Signed-off-by: Jesse Gross <jesse@nicira.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6cacd608448898cf0b7bb4353e1a92c6dc7d5dd9
Author: Yuval Mintz <yuvalmin@broadcom.com>
Date:   Sun Aug 26 00:35:45 2012 +0000

    bnx2x: fix 57840_MF pci id
    
    [ Upstream commit 5c879d2094946081af934739850c7260e8b25d3c ]
    
    Commit c3def943c7117d42caaed3478731ea7c3c87190e have added support for
    new pci ids of the 57840 board, while failing to change the obsolete value
    in 'pci_ids.h'.
    This patch does so, allowing the probe of such devices.
    
    Signed-off-by: Yuval Mintz <yuvalmin@broadcom.com>
    Signed-off-by: Eilon Greenstein <eilong@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit b9d798a996cddfc4c1045e9af97ee434ccab4956
Author: Francesco Ruggeri <fruggeri@aristanetworks.com>
Date:   Fri Aug 24 07:38:35 2012 +0000

    net: ipv4: ipmr_expire_timer causes crash when removing net namespace
    
    [ Upstream commit acbb219d5f53821b2d0080d047800410c0420ea1 ]
    
    When tearing down a net namespace, ipv4 mr_table structures are freed
    without first deactivating their timers. This can result in a crash in
    run_timer_softirq.
    This patch mimics the corresponding behaviour in ipv6.
    Locking and synchronization seem to be adequate.
    We are about to kfree mrt, so existing code should already make sure that
    no other references to mrt are pending or can be created by incoming traffic.
    The functions invoked here do not cause new references to mrt or other
    race conditions to be created.
    Invoking del_timer_sync guarantees that ipmr_expire_timer is inactive.
    Both ipmr_expire_process (whose completion we may have to wait in
    del_timer_sync) and mroute_clean_tables internally use mfc_unres_lock
    or other synchronizations when needed, and they both only modify mrt.
    
    Tested in Linux 3.4.8.
    
    Signed-off-by: Francesco Ruggeri <fruggeri@aristanetworks.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit fae286b0e547ed0379d93ace7664ea6f55cce0e0
Author: xeb@mail.ru <xeb@mail.ru>
Date:   Fri Aug 24 01:07:38 2012 +0000

    l2tp: avoid to use synchronize_rcu in tunnel free function
    
    [ Upstream commit 99469c32f79a32d8481f87be0d3c66dad286f4ec ]
    
    Avoid to use synchronize_rcu in l2tp_tunnel_free because context may be
    atomic.
    
    Signed-off-by: Dmitry Kozlov <xeb@mail.ru>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit c5ca1d03c29df5dc550f71bd1669af8bc30e32f8
Author: Claudiu Manoil <claudiu.manoil@freescale.com>
Date:   Thu Aug 23 21:46:25 2012 +0000

    gianfar: fix default tx vlan offload feature flag
    
    [ Upstream commit e2c53be223aca36cf93eb6a0f6bafa079e78f52b ]
    
    Commit -
    "b852b72 gianfar: fix bug caused by
    87c288c6e9aa31720b72e2bc2d665e24e1653c3e"
    disables by default (on mac init) the hw vlan tag insertion.
    The "features" flags were not updated to reflect this, and
    "ethtool -K" shows tx-vlan-offload to be "on" by default.
    
    Cc: Sebastian Poehn <sebastian.poehn@belden.com>
    Signed-off-by: Claudiu Manoil <claudiu.manoil@freescale.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit fa1dcb6f0d338629cf1e3939227135ce0ea17b50
Author: Ben Hutchings <bhutchings@solarflare.com>
Date:   Wed Aug 15 18:09:15 2012 +0100

    sfc: Fix reporting of IPv4 full filters through ethtool
    
    [ Upstream commit ac70b2e9a13423b5efa0178e081936ce6979aea5 ]
    
    ETHTOOL_GRXCLSRULE returns filters for a TCP/IPv4 or UDP/IPv4 4-tuple
    with source and destination swapped.
    
    Signed-off-by: Ben Hutchings <bhutchings@solarflare.com>

commit fbc350126994de9682e0400b969ab84437768894
Author: Yuchung Cheng <ycheng@google.com>
Date:   Thu Aug 23 07:05:17 2012 +0000

    tcp: fix cwnd reduction for non-sack recovery
    
    [ Upstream commit 7c4a56fec379ac0d7754e0d4da6a7361f1a4fe64 ]
    
    The cwnd reduction in fast recovery is based on the number of packets
    newly delivered per ACK. For non-sack connections every DUPACK
    signifies a packet has been delivered, but the sender mistakenly
    skips counting them for cwnd reduction.
    
    The fix is to compute newly_acked_sacked after DUPACKs are accounted
    in sacked_out for non-sack connections.
    
    Signed-off-by: Yuchung Cheng <ycheng@google.com>
    Acked-by: Nandita Dukkipati <nanditad@google.com>
    Acked-by: Neal Cardwell <ncardwell@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit 912af4d4433a29aa51bcbc33c4275541d8ccc4b1
Author: Pablo Neira Ayuso <pablo@netfilter.org>
Date:   Thu Aug 23 02:09:11 2012 +0000

    netlink: fix possible spoofing from non-root processes
    
    [ Upstream commit 20e1db19db5d6b9e4e83021595eab0dc8f107bef ]
    
    Non-root user-space processes can send Netlink messages to other
    processes that are well-known for being subscribed to Netlink
    asynchronous notifications. This allows ilegitimate non-root
    process to send forged messages to Netlink subscribers.
    
    The userspace process usually verifies the legitimate origin in
    two ways:
    
    a) Socket credentials. If UID != 0, then the message comes from
       some ilegitimate process and the message needs to be dropped.
    
    b) Netlink portID. In general, portID == 0 means that the origin
       of the messages comes from the kernel. Thus, discarding any
       message not coming from the kernel.
    
    However, ctnetlink sets the portID in event messages that has
    been triggered by some user-space process, eg. conntrack utility.
    So other processes subscribed to ctnetlink events, eg. conntrackd,
    know that the event was triggered by some user-space action.
    
    Neither of the two ways to discard ilegitimate messages coming
    from non-root processes can help for ctnetlink.
    
    This patch adds capability validation in case that dst_pid is set
    in netlink_sendmsg(). This approach is aggressive since existing
    applications using any Netlink bus to deliver messages between
    two user-space processes will break. Note that the exception is
    NETLINK_USERSOCK, since it is reserved for netlink-to-netlink
    userspace communication.
    
    Still, if anyone wants that his Netlink bus allows netlink-to-netlink
    userspace, then they can set NL_NONROOT_SEND. However, by default,
    I don't think it makes sense to allow to use NETLINK_ROUTE to
    communicate two processes that are sending no matter what information
    that is not related to link/neighbouring/routing. They should be using
    NETLINK_USERSOCK instead for that.
    
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit 7c799a1e1ca2bc766574078b684c14474da9f704
Author: Eric Dumazet <edumazet@google.com>
Date:   Tue Aug 21 06:21:17 2012 +0000

    af_netlink: force credentials passing [CVE-2012-3520]
    
    [ Upstream commit e0e3cea46d31d23dc40df0a49a7a2c04fe8edfea ]
    
    Pablo Neira Ayuso discovered that avahi and
    potentially NetworkManager accept spoofed Netlink messages because of a
    kernel bug.  The kernel passes all-zero SCM_CREDENTIALS ancillary data
    to the receiver if the sender did not provide such data, instead of not
    including any such data at all or including the correct data from the
    peer (as it is the case with AF_UNIX).
    
    This bug was introduced in commit 16e572626961
    (af_unix: dont send SCM_CREDENTIALS by default)
    
    This patch forces passing credentials for netlink, as
    before the regression.
    
    Another fix would be to not add SCM_CREDENTIALS in
    netlink messages if not provided by the sender, but it
    might break some programs.
    
    With help from Florian Weimer & Petr Matousek
    
    This issue is designated as CVE-2012-3520
    
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Cc: Petr Matousek <pmatouse@redhat.com>
    Cc: Florian Weimer <fweimer@redhat.com>
    Cc: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit 9e296becde8a8da5bcc1a8e22f27bdf9bd8636fe
Author: Eric Leblond <eric@regit.org>
Date:   Thu Aug 16 22:02:58 2012 +0000

    af_packet: don't emit packet on orig fanout group
    
    [ Upstream commit c0de08d04215031d68fa13af36f347a6cfa252ca ]
    
    If a packet is emitted on one socket in one group of fanout sockets,
    it is transmitted again. It is thus read again on one of the sockets
    of the fanout group. This result in a loop for software which
    generate packets when receiving one.
    This retransmission is not the intended behavior: a fanout group
    must behave like a single socket. The packet should not be
    transmitted on a socket if it originates from a socket belonging
    to the same fanout group.
    
    This patch fixes the issue by changing the transmission check to
    take fanout group info account.
    
    Reported-by: Aleksandr Kotov <a1k@mail.ru>
    Signed-off-by: Eric Leblond <eric@regit.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d09b3b2b1183848e287bc0b6397f8d05945becc4
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:57 2012 +0000

    net: fix info leak in compat dev_ifconf()
    
    [ Upstream commit 43da5f2e0d0c69ded3d51907d9552310a6b545e8 ]
    
    The implementation of dev_ifconf() for the compat ioctl interface uses
    an intermediate ifc structure allocated in userland for the duration of
    the syscall. Though, it fails to initialize the padding bytes inserted
    for alignment and that for leaks four bytes of kernel stack. Add an
    explicit memset(0) before filling the structure to avoid the info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 62b4d90b525c6c11e467a2eadb12fcf64a6f0829
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:56 2012 +0000

    ipvs: fix info leak in getsockopt(IP_VS_SO_GET_TIMEOUT)
    
    [ Upstream commit 2d8a041b7bfe1097af21441cb77d6af95f4f4680 ]
    
    If at least one of CONFIG_IP_VS_PROTO_TCP or CONFIG_IP_VS_PROTO_UDP is
    not set, __ip_vs_get_timeouts() does not fully initialize the structure
    that gets copied to userland and that for leaks up to 12 bytes of kernel
    stack. Add an explicit memset(0) before passing the structure to
    __ip_vs_get_timeouts() to avoid the info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Wensong Zhang <wensong@linux-vs.org>
    Cc: Simon Horman <horms@verge.net.au>
    Cc: Julian Anastasov <ja@ssi.bg>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 59039dc90bb7879bd4c8c959109d27131f0ce40f
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:55 2012 +0000

    dccp: fix info leak via getsockopt(DCCP_SOCKOPT_CCID_TX_INFO)
    
    [ Upstream commit 7b07f8eb75aa3097cdfd4f6eac3da49db787381d ]
    
    The CCID3 code fails to initialize the trailing padding bytes of struct
    tfrc_tx_info added for alignment on 64 bit architectures. It that for
    potentially leaks four bytes kernel stack via the getsockopt() syscall.
    Add an explicit memset(0) before filling the structure to avoid the
    info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Gerrit Renker <gerrit@erg.abdn.ac.uk>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 00ed5b8f397447a944a3305274b74049bfcd633f
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:53 2012 +0000

    llc: fix info leak via getsockname()
    
    [ Upstream commit 3592aaeb80290bda0f2cf0b5456c97bfc638b192 ]
    
    The LLC code wrongly returns 0, i.e. "success", when the socket is
    zapped. Together with the uninitialized uaddrlen pointer argument from
    sys_getsockname this leads to an arbitrary memory leak of up to 128
    bytes kernel stack via the getsockname() syscall.
    
    Return an error instead when the socket is zapped to prevent the info
    leak. Also remove the unnecessary memset(0). We don't directly write to
    the memory pointed by uaddr but memcpy() a local structure at the end of
    the function that is properly initialized.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Arnaldo Carvalho de Melo <acme@ghostprotocols.net>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dbcba7a54a0327f0ef6d6a3ec53b67d0969109b6
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:51 2012 +0000

    Bluetooth: L2CAP - Fix info leak via getsockname()
    
    [ Upstream commit 792039c73cf176c8e39a6e8beef2c94ff46522ed ]
    
    The L2CAP code fails to initialize the l2_bdaddr_type member of struct
    sockaddr_l2 and the padding byte added for alignment. It that for leaks
    two bytes kernel stack via the getsockname() syscall. Add an explicit
    memset(0) before filling the structure to avoid the info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Marcel Holtmann <marcel@holtmann.org>
    Cc: Gustavo Padovan <gustavo@padovan.org>
    Cc: Johan Hedberg <johan.hedberg@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8717cd3d63233ee5591bf8e8d6e5960a1f6252b1
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:50 2012 +0000

    Bluetooth: RFCOMM - Fix info leak via getsockname()
    
    [ Upstream commit 9344a972961d1a6d2c04d9008b13617bcb6ec2ef ]
    
    The RFCOMM code fails to initialize the trailing padding byte of struct
    sockaddr_rc added for alignment. It that for leaks one byte kernel stack
    via the getsockname() syscall. Add an explicit memset(0) before filling
    the structure to avoid the info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Marcel Holtmann <marcel@holtmann.org>
    Cc: Gustavo Padovan <gustavo@padovan.org>
    Cc: Johan Hedberg <johan.hedberg@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 279d3f5b2d402034dee1a81b7f5e3f678aa46d21
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:49 2012 +0000

    Bluetooth: RFCOMM - Fix info leak in ioctl(RFCOMMGETDEVLIST)
    
    [ Upstream commit f9432c5ec8b1e9a09b9b0e5569e3c73db8de432a ]
    
    The RFCOMM code fails to initialize the two padding bytes of struct
    rfcomm_dev_list_req inserted for alignment before copying it to
    userland. Additionally there are two padding bytes in each instance of
    struct rfcomm_dev_info. The ioctl() that for disclosures two bytes plus
    dev_num times two bytes uninitialized kernel heap memory.
    
    Allocate the memory using kzalloc() to fix this issue.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Marcel Holtmann <marcel@holtmann.org>
    Cc: Gustavo Padovan <gustavo@padovan.org>
    Cc: Johan Hedberg <johan.hedberg@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 745dcdb0fd330f0cc984bd8a7764a81f04e44780
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:48 2012 +0000

    Bluetooth: RFCOMM - Fix info leak in getsockopt(BT_SECURITY)
    
    [ Upstream commit 9ad2de43f1aee7e7274a4e0d41465489299e344b ]
    
    The RFCOMM code fails to initialize the key_size member of struct
    bt_security before copying it to userland -- that for leaking one
    byte kernel stack. Initialize key_size with 0 to avoid the info
    leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Marcel Holtmann <marcel@holtmann.org>
    Cc: Gustavo Padovan <gustavo@padovan.org>
    Cc: Johan Hedberg <johan.hedberg@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 639edee79eb2035b6fe3976f50a1c5364acc7352
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:47 2012 +0000

    Bluetooth: HCI - Fix info leak via getsockname()
    
    [ Upstream commit 3f68ba07b1da811bf383b4b701b129bfcb2e4988 ]
    
    The HCI code fails to initialize the hci_channel member of struct
    sockaddr_hci and that for leaks two bytes kernel stack via the
    getsockname() syscall. Initialize hci_channel with 0 to avoid the
    info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Marcel Holtmann <marcel@holtmann.org>
    Cc: Gustavo Padovan <gustavo@padovan.org>
    Cc: Johan Hedberg <johan.hedberg@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 87c42a1dfd5939d0a24795cd99b3d63daa4e1eff
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:46 2012 +0000

    Bluetooth: HCI - Fix info leak in getsockopt(HCI_FILTER)
    
    [ Upstream commit e15ca9a0ef9a86f0477530b0f44a725d67f889ee ]
    
    The HCI code fails to initialize the two padding bytes of struct
    hci_ufilter before copying it to userland -- that for leaking two
    bytes kernel stack. Add an explicit memset(0) before filling the
    structure to avoid the info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Cc: Marcel Holtmann <marcel@holtmann.org>
    Cc: Gustavo Padovan <gustavo@padovan.org>
    Cc: Johan Hedberg <johan.hedberg@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 458ed5622e976848aacdea07d4bfcb84a350c460
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:45 2012 +0000

    atm: fix info leak via getsockname()
    
    [ Upstream commit 3c0c5cfdcd4d69ffc4b9c0907cec99039f30a50a ]
    
    The ATM code fails to initialize the two padding bytes of struct
    sockaddr_atmpvc inserted for alignment. Add an explicit memset(0)
    before filling the structure to avoid the info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5b26dbdd5f22871c21fc2ea4afedfe4ecad62d72
Author: Mathias Krause <minipli@googlemail.com>
Date:   Wed Aug 15 11:31:44 2012 +0000

    atm: fix info leak in getsockopt(SO_ATMPVC)
    
    [ Upstream commit e862f1a9b7df4e8196ebec45ac62295138aa3fc2 ]
    
    The ATM code fails to initialize the two padding bytes of struct
    sockaddr_atmpvc inserted for alignment. Add an explicit memset(0)
    before filling the structure to avoid the info leak.
    
    Signed-off-by: Mathias Krause <minipli@googlemail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 84a2d3c44cce71152f3555af83bafea6ec5ef23c
Author: Ben Hutchings <bhutchings@solarflare.com>
Date:   Tue Aug 14 08:54:51 2012 +0000

    ipv6: addrconf: Avoid calling netdevice notifiers with RCU read-side lock
    
    [ Upstream commit 4acd4945cd1e1f92b20d14e349c6c6a52acbd42d ]
    
    Cong Wang reports that lockdep detected suspicious RCU usage while
    enabling IPV6 forwarding:
    
     [ 1123.310275] ===============================
     [ 1123.442202] [ INFO: suspicious RCU usage. ]
     [ 1123.558207] 3.6.0-rc1+ #109 Not tainted
     [ 1123.665204] -------------------------------
     [ 1123.768254] include/linux/rcupdate.h:430 Illegal context switch in RCU read-side critical section!
     [ 1123.992320]
     [ 1123.992320] other info that might help us debug this:
     [ 1123.992320]
     [ 1124.307382]
     [ 1124.307382] rcu_scheduler_active = 1, debug_locks = 0
     [ 1124.522220] 2 locks held by sysctl/5710:
     [ 1124.648364]  #0:  (rtnl_mutex){+.+.+.}, at: [<ffffffff81768498>] rtnl_trylock+0x15/0x17
     [ 1124.882211]  #1:  (rcu_read_lock){.+.+.+}, at: [<ffffffff81871df8>] rcu_lock_acquire+0x0/0x29
     [ 1125.085209]
     [ 1125.085209] stack backtrace:
     [ 1125.332213] Pid: 5710, comm: sysctl Not tainted 3.6.0-rc1+ #109
     [ 1125.441291] Call Trace:
     [ 1125.545281]  [<ffffffff8109d915>] lockdep_rcu_suspicious+0x109/0x112
     [ 1125.667212]  [<ffffffff8107c240>] rcu_preempt_sleep_check+0x45/0x47
     [ 1125.781838]  [<ffffffff8107c260>] __might_sleep+0x1e/0x19b
    [...]
     [ 1127.445223]  [<ffffffff81757ac5>] call_netdevice_notifiers+0x4a/0x4f
    [...]
     [ 1127.772188]  [<ffffffff8175e125>] dev_disable_lro+0x32/0x6b
     [ 1127.885174]  [<ffffffff81872d26>] dev_forward_change+0x30/0xcb
     [ 1128.013214]  [<ffffffff818738c4>] addrconf_forward_change+0x85/0xc5
    [...]
    
    addrconf_forward_change() uses RCU iteration over the netdev list,
    which is unnecessary since it already holds the RTNL lock.  We also
    cannot reasonably require netdevice notifier functions not to sleep.
    
    Reported-by: Cong Wang <amwang@redhat.com>
    Signed-off-by: Ben Hutchings <bhutchings@solarflare.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c8cca9d90b953a0a2b5d0edab789f5c52ae983f5
Author: Daniel Borkmann <daniel@iogearbox.net>
Date:   Fri Aug 10 22:48:54 2012 +0000

    af_packet: remove BUG statement in tpacket_destruct_skb
    
    [ Upstream commit 7f5c3e3a80e6654cf48dfba7cf94f88c6b505467 ]
    
    Here's a quote of the comment about the BUG macro from asm-generic/bug.h:
    
     Don't use BUG() or BUG_ON() unless there's really no way out; one
     example might be detecting data structure corruption in the middle
     of an operation that can't be backed out of.  If the (sub)system
     can somehow continue operating, perhaps with reduced functionality,
     it's probably not BUG-worthy.
    
     If you're tempted to BUG(), think again:  is completely giving up
     really the *only* solution?  There are usually better options, where
     users don't need to reboot ASAP and can mostly shut down cleanly.
    
    In our case, the status flag of a ring buffer slot is managed from both sides,
    the kernel space and the user space. This means that even though the kernel
    side might work as expected, the user space screws up and changes this flag
    right between the send(2) is triggered when the flag is changed to
    TP_STATUS_SENDING and a given skb is destructed after some time. Then, this
    will hit the BUG macro. As David suggested, the best solution is to simply
    remove this statement since it cannot be used for kernel side internal
    consistency checks. I've tested it and the system still behaves /stable/ in
    this case, so in accordance with the above comment, we should rather remove it.
    
    Signed-off-by: Daniel Borkmann <daniel.borkmann@tik.ee.ethz.ch>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit caf2630c41a183b72e5d6211e5efd1457ac0c463
Author: Alexey Khoroshilov <khoroshilov@ispras.ru>
Date:   Wed Aug 8 00:33:25 2012 +0000

    net/core: Fix potential memory leak in dev_set_alias()
    
    [ Upstream commit 7364e445f62825758fa61195d237a5b8ecdd06ec ]
    
    Do not leak memory by updating pointer with potentially NULL realloc return value.
    
    Found by Linux Driver Verification project (linuxtesting.org).
    
    Signed-off-by: Alexey Khoroshilov <khoroshilov@ispras.ru>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a348ed02b367a8a8307444724db5c8e96c90ac78
Author: Gao feng <gaofeng@cn.fujitsu.com>
Date:   Tue Aug 7 00:23:11 2012 +0000

    pptp: lookup route with the proper net namespace
    
    [ Upstream commit 08252b32311c3fa84219ad794d640af7399b5485 ]
    
    pptp always use init_net as the net namespace to lookup
    route, this will cause route lookup failed in container.
    
    because we already set the correct net namespace to struct
    sock in pptp_create,so fix this by using sock_net(sk) to
    replace &init_net.
    
    Signed-off-by: Gao feng <gaofeng@cn.fujitsu.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bc3f72433351e278a92a38c2090aacff982ce558
Author: Wu Fengguang <fengguang.wu@intel.com>
Date:   Thu Aug 2 23:10:01 2012 +0000

    isdnloop: fix and simplify isdnloop_init()
    
    [ Upstream commit 77f00f6324cb97cf1df6f9c4aaeea6ada23abdb2 ]
    
    Fix a buffer overflow bug by removing the revision and printk.
    
    [   22.016214] isdnloop-ISDN-driver Rev 1.11.6.7
    [   22.097508] isdnloop: (loop0) virtual card added
    [   22.174400] Kernel panic - not syncing: stack-protector: Kernel stack is corrupted in: ffffffff83244972
    [   22.174400]
    [   22.436157] Pid: 1, comm: swapper Not tainted 3.5.0-bisect-00018-gfa8bbb1-dirty #129
    [   22.624071] Call Trace:
    [   22.720558]  [<ffffffff832448c3>] ? CallcNew+0x56/0x56
    [   22.815248]  [<ffffffff8222b623>] panic+0x110/0x329
    [   22.914330]  [<ffffffff83244972>] ? isdnloop_init+0xaf/0xb1
    [   23.014800]  [<ffffffff832448c3>] ? CallcNew+0x56/0x56
    [   23.090763]  [<ffffffff8108e24b>] __stack_chk_fail+0x2b/0x30
    [   23.185748]  [<ffffffff83244972>] isdnloop_init+0xaf/0xb1
    
    Signed-off-by: Fengguang Wu <fengguang.wu@intel.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7e0c71a9a5a23f9433eac1d0aabbc9d54da3428b
Author: Hiroaki SHIMODA <shimoda.hiroaki@gmail.com>
Date:   Fri Aug 3 19:57:52 2012 +0900

    net_sched: gact: Fix potential panic in tcf_gact().
    
    [ Upstream commit 696ecdc10622d86541f2e35cc16e15b6b3b1b67e ]
    
    gact_rand array is accessed by gact->tcfg_ptype whose value
    is assumed to less than MAX_RAND, but any range checks are
    not performed.
    
    So add a check in tcf_gact_init(). And in tcf_gact(), we can
    reduce a branch.
    
    Signed-off-by: Hiroaki SHIMODA <shimoda.hiroaki@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4658b24b2dd0e4c6215db2203743fa999765e8a0
Author: Ben Hutchings <bhutchings@solarflare.com>
Date:   Mon Jul 30 16:11:42 2012 +0000

    tcp: Apply device TSO segment limit earlier
    
    [ Upstream commit 1485348d2424e1131ea42efc033cbd9366462b01 ]
    
    Cache the device gso_max_segs in sock::sk_gso_max_segs and use it to
    limit the size of TSO skbs.  This avoids the need to fall back to
    software GSO for local TCP senders.
    
    Signed-off-by: Ben Hutchings <bhutchings@solarflare.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0a1f711681e0d7068b69c0697c4ba284fbf1b2bf
Author: Ben Hutchings <bhutchings@solarflare.com>
Date:   Mon Jul 30 15:57:44 2012 +0000

    sfc: Fix maximum number of TSO segments and minimum TX queue size
    
    [ Upstream commit 7e6d06f0de3f74ca929441add094518ae332257c ]
    
    Currently an skb requiring TSO may not fit within a minimum-size TX
    queue.  The TX queue selected for the skb may stall and trigger the TX
    watchdog repeatedly (since the problem skb will be retried after the
    TX reset).  This issue is designated as CVE-2012-3412.
    
    Set the maximum number of TSO segments for our devices to 100.  This
    should make no difference to behaviour unless the actual MSS is less
    than about 700.  Increase the minimum TX queue size accordingly to
    allow for 2 worst-case skbs, so that there will definitely be space
    to add an skb after we wake a queue.
    
    To avoid invalidating existing configurations, change
    efx_ethtool_set_ringparam() to fix up values that are too small rather
    than returning -EINVAL.
    
    Signed-off-by: Ben Hutchings <bhutchings@solarflare.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2dc3b21fbca98bd3c8d9e53acf5d966add3c7606
Author: Ben Hutchings <bhutchings@solarflare.com>
Date:   Mon Jul 30 15:57:00 2012 +0000

    net: Allow driver to limit number of GSO segments per skb
    
    [ Upstream commit 30b678d844af3305cda5953467005cebb5d7b687 ]
    
    A peer (or local user) may cause TCP to use a nominal MSS of as little
    as 88 (actual MSS of 76 with timestamps).  Given that we have a
    sufficiently prodigious local sender and the peer ACKs quickly enough,
    it is nevertheless possible to grow the window for such a connection
    to the point that we will try to send just under 64K at once.  This
    results in a single skb that expands to 861 segments.
    
    In some drivers with TSO support, such an skb will require hundreds of
    DMA descriptors; a substantial fraction of a TX ring or even more than
    a full ring.  The TX queue selected for the skb may stall and trigger
    the TX watchdog repeatedly (since the problem skb will be retried
    after the TX reset).  This particularly affects sfc, for which the
    issue is designated as CVE-2012-3412.
    
    Therefore:
    1. Add the field net_device::gso_max_segs holding the device-specific
       limit.
    2. In netif_skb_features(), if the number of segments is too high then
       mask out GSO features to force fall back to software GSO.
    
    Signed-off-by: Ben Hutchings <bhutchings@solarflare.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
