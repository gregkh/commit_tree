commit f4c88459f7c9320f587b839c3d24a2a9dc18a8a0
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Fri Aug 24 13:09:23 2018 +0200

    Linux 4.14.67

commit ef3cf941e0dfe3b6cd9e377767298605d08a05da
Author: Jann Horn <jannh@google.com>
Date:   Tue Aug 21 21:59:37 2018 -0700

    reiserfs: fix broken xattr handling (heap corruption, bad retval)
    
    commit a13f085d111e90469faf2d9965eb39b11c114d7e upstream.
    
    This fixes the following issues:
    
    - When a buffer size is supplied to reiserfs_listxattr() such that each
      individual name fits, but the concatenation of all names doesn't fit,
      reiserfs_listxattr() overflows the supplied buffer.  This leads to a
      kernel heap overflow (verified using KASAN) followed by an out-of-bounds
      usercopy and is therefore a security bug.
    
    - When a buffer size is supplied to reiserfs_listxattr() such that a
      name doesn't fit, -ERANGE should be returned.  But reiserfs instead just
      truncates the list of names; I have verified that if the only xattr on a
      file has a longer name than the supplied buffer length, listxattr()
      incorrectly returns zero.
    
    With my patch applied, -ERANGE is returned in both cases and the memory
    corruption doesn't happen anymore.
    
    Credit for making me clean this code up a bit goes to Al Viro, who pointed
    out that the ->actor calling convention is suboptimal and should be
    changed.
    
    Link: http://lkml.kernel.org/r/20180802151539.5373-1-jannh@google.com
    Fixes: 48b32a3553a5 ("reiserfs: use generic xattr handlers")
    Signed-off-by: Jann Horn <jannh@google.com>
    Acked-by: Jeff Mahoney <jeffm@suse.com>
    Cc: Eric Biggers <ebiggers@google.com>
    Cc: Al Viro <viro@zeniv.linux.org.uk>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 82c6d4994ba86ca5edec001f690d9cd3e4cd442f
Author: Esben Haabendal <eha@deif.com>
Date:   Thu Aug 16 10:43:12 2018 +0200

    i2c: imx: Fix race condition in dma read
    
    commit bed4ff1ed4d8f2ef5007c5c6ae1b29c5677a3632 upstream.
    
    This fixes a race condition, where the DMAEN bit ends up being set after
    I2C slave has transmitted a byte following the dummy read.  When that
    happens, an interrupt is generated instead, and no DMA request is generated
    to kickstart the DMA read, and a timeout happens after DMA_TIMEOUT (1 sec).
    
    Fixed by setting the DMAEN bit before the dummy read.
    
    Signed-off-by: Esben Haabendal <eha@deif.com>
    Acked-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Cc: stable@kernel.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 415a02d8b65ae48a8a01694de5ea3c574128710b
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Sun Aug 12 12:53:20 2018 +0200

    i2c: core: ACPI: Properly set status byte to 0 for multi-byte writes
    
    commit c463a158cb6c5d9a85b7d894cd4f8116e8bd6be0 upstream.
    
    acpi_gsb_i2c_write_bytes() returns i2c_transfer()'s return value, which
    is the number of transfers executed on success, so 1.
    
    The ACPI code expects us to store 0 in gsb->status for success, not 1.
    
    Specifically this breaks the following code in the Thinkpad 8 DSDT:
    
                ECWR = I2CW = ECWR /* \_SB_.I2C1.BAT0.ECWR */
                If ((ECST == Zero))
                {
                    ECRD = I2CR /* \_SB_.I2C1.I2CR */
                }
    
    Before this commit we set ECST to 1, causing the read to never happen
    breaking battery monitoring on the Thinkpad 8.
    
    This commit makes acpi_gsb_i2c_write_bytes() return 0 when i2c_transfer()
    returns 1, so the single write transfer completed successfully, and
    makes it return -EIO on for other (unexpected) return values >= 0.
    
    Cc: stable@vger.kernel.org
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Acked-by: Mika Westerberg <mika.westerberg@linux.intel.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b5b7417ed9d6d61df318f7b45c5c2ad38bbc09d2
Author: Lukas Wunner <lukas@wunner.de>
Date:   Thu Jul 19 17:27:34 2018 -0500

    PCI: pciehp: Fix unprotected list iteration in IRQ handler
    
    commit 1204e35bedf4e5015cda559ed8c84789a6dae24e upstream.
    
    Commit b440bde74f04 ("PCI: Add pci_ignore_hotplug() to ignore hotplug
    events for a device") iterates over the devices on a hotplug port's
    subordinate bus in pciehp's IRQ handler without acquiring pci_bus_sem.
    It is thus possible for a user to cause a crash by concurrently
    manipulating the device list, e.g. by disabling slot power via sysfs
    on a different CPU or by initiating a remove/rescan via sysfs.
    
    This can't be fixed by acquiring pci_bus_sem because it may sleep.
    The simplest fix is to avoid the list iteration altogether and just
    check the ignore_hotplug flag on the port itself.  This works because
    pci_ignore_hotplug() sets the flag both on the device as well as on its
    parent bridge.
    
    We do lose the ability to print the name of the device blocking hotplug
    in the debug message, but that's probably bearable.
    
    Fixes: b440bde74f04 ("PCI: Add pci_ignore_hotplug() to ignore hotplug events for a device")
    Signed-off-by: Lukas Wunner <lukas@wunner.de>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2f27dfad05eff15b251fc012829dda9841e79377
Author: Lukas Wunner <lukas@wunner.de>
Date:   Thu Jul 19 17:27:32 2018 -0500

    PCI: pciehp: Fix use-after-free on unplug
    
    commit 281e878eab191cce4259abbbf1a0322e3adae02c upstream.
    
    When pciehp is unbound (e.g. on unplug of a Thunderbolt device), the
    hotplug_slot struct is deregistered and thus freed before freeing the
    IRQ.  The IRQ handler and the work items it schedules print the slot
    name referenced from the freed structure in various informational and
    debug log messages, each time resulting in a quadruple dereference of
    freed pointers (hotplug_slot -> pci_slot -> kobject -> name).
    
    At best the slot name is logged as "(null)", at worst kernel memory is
    exposed in logs or the driver crashes:
    
      pciehp 0000:10:00.0:pcie204: Slot((null)): Card not present
    
    An attacker may provoke the bug by unplugging multiple devices on a
    Thunderbolt daisy chain at once.  Unplugging can also be simulated by
    powering down slots via sysfs.  The bug is particularly easy to trigger
    in poll mode.
    
    It has been present since the driver's introduction in 2004:
    https://git.kernel.org/tglx/history/c/c16b4b14d980
    
    Fix by rearranging teardown such that the IRQ is freed first.  Run the
    work items queued by the IRQ handler to completion before freeing the
    hotplug_slot struct by draining the work queue from the ->release_slot
    callback which is invoked by pci_hp_deregister().
    
    Signed-off-by: Lukas Wunner <lukas@wunner.de>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Cc: stable@vger.kernel.org # v2.6.4
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8af37982c3b281af5ee5b3cec8085f2706973357
Author: Myron Stowe <myron.stowe@redhat.com>
Date:   Mon Aug 13 12:19:39 2018 -0600

    PCI: Skip MPS logic for Virtual Functions (VFs)
    
    commit 3dbe97efe8bf450b183d6dee2305cbc032e6b8a4 upstream.
    
    PCIe r4.0, sec 9.3.5.4, "Device Control Register", shows both
    Max_Payload_Size (MPS) and Max_Read_request_Size (MRRS) to be 'RsvdP' for
    VFs.  Just prior to the table it states:
    
      "PF and VF functionality is defined in Section 7.5.3.4 except where
       noted in Table 9-16.  For VF fields marked 'RsvdP', the PF setting
       applies to the VF."
    
    All of which implies that with respect to Max_Payload_Size Supported
    (MPSS), MPS, and MRRS values, we should not be paying any attention to the
    VF's fields, but rather only to the PF's.  Only looking at the PF's fields
    also logically makes sense as it's the sole physical interface to the PCIe
    bus.
    
    Link: https://bugzilla.kernel.org/show_bug.cgi?id=200527
    Fixes: 27d868b5e6cf ("PCI: Set MPS to match upstream bridge")
    Signed-off-by: Myron Stowe <myron.stowe@redhat.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Cc: stable@vger.kernel.org # 4.3+
    Cc: Keith Busch <keith.busch@intel.com>
    Cc: Sinan Kaya <okaya@kernel.org>
    Cc: Dongdong Liu <liudongdong3@huawei.com>
    Cc: Jon Mason <jdmason@kudzu.us>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cf9c2bc5eea03bd96b08b8cbd1c8adfed4fa617f
Author: Lukas Wunner <lukas@wunner.de>
Date:   Thu Jul 19 17:27:31 2018 -0500

    PCI: hotplug: Don't leak pci_slot on registration failure
    
    commit 4ce6435820d1f1cc2c2788e232735eb244bcc8a3 upstream.
    
    If addition of sysfs files fails on registration of a hotplug slot, the
    struct pci_slot as well as the entry in the slot_list is leaked.  The
    issue has been present since the hotplug core was introduced in 2002:
    https://git.kernel.org/tglx/history/c/a8a2069f432c
    
    Perhaps the idea was that even though sysfs addition fails, the slot
    should still be usable.  But that's not how drivers use the interface,
    they abort probe if a non-zero value is returned.
    
    Signed-off-by: Lukas Wunner <lukas@wunner.de>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Cc: stable@vger.kernel.org # v2.4.15+
    Cc: Greg Kroah-Hartman <greg@kroah.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6541d98d114ef4ccf923c02ae665262450b3966c
Author: John David Anglin <dave.anglin@bell.net>
Date:   Sun Aug 12 16:31:17 2018 -0400

    parisc: Remove unnecessary barriers from spinlock.h
    
    commit 3b885ac1dc35b87a39ee176a6c7e2af9c789d8b8 upstream.
    
    Now that mb() is an instruction barrier, it will slow performance if we issue
    unnecessary barriers.
    
    The spinlock defines have a number of unnecessary barriers.  The __ldcw()
    define is both a hardware and compiler barrier.  The mb() barriers in the
    routines using __ldcw() serve no purpose.
    
    The only barrier needed is the one in arch_spin_unlock().  We need to ensure
    all accesses are complete prior to releasing the lock.
    
    Signed-off-by: John David Anglin <dave.anglin@bell.net>
    Cc: stable@vger.kernel.org # 4.0+
    Signed-off-by: Helge Deller <deller@gmx.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3f59cf41fbfb622878c53815b9f464fe5aeaf7d9
Author: Ursula Braun <ubraun@linux.ibm.com>
Date:   Wed Aug 8 14:13:19 2018 +0200

    net/smc: no shutdown in state SMC_LISTEN
    
    commit caa21e19e08d7a1445116a93f7ab4e187ebbbadb upstream.
    
    Invoking shutdown for a socket in state SMC_LISTEN does not make
    sense. Nevertheless programs like syzbot fuzzing the kernel may
    try to do this. For SMC this means a socket refcounting problem.
    This patch makes sure a shutdown call for an SMC socket in state
    SMC_LISTEN simply returns with -ENOTCONN.
    
    Signed-off-by: Ursula Braun <ubraun@linux.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9e9f27e0d7ac938a78e603ba1a2a2bdab034394b
Author: Willem de Bruijn <willemb@google.com>
Date:   Mon Aug 6 10:38:34 2018 -0400

    packet: refine ring v3 block size test to hold one frame
    
    commit 4576cd469d980317c4edd9173f8b694aa71ea3a3 upstream.
    
    TPACKET_V3 stores variable length frames in fixed length blocks.
    Blocks must be able to store a block header, optional private space
    and at least one minimum sized frame.
    
    Frames, even for a zero snaplen packet, store metadata headers and
    optional reserved space.
    
    In the block size bounds check, ensure that the frame of the
    chosen configuration fits. This includes sockaddr_ll and optional
    tp_reserve.
    
    Syzbot was able to construct a ring with insuffient room for the
    sockaddr_ll in the header of a zero-length frame, triggering an
    out-of-bounds write in dev_parse_header.
    
    Convert the comparison to less than, as zero is a valid snap len.
    This matches the test for minimum tp_frame_size immediately below.
    
    Fixes: f6fb8f100b80 ("af-packet: TPACKET_V3 flexible buffer implementation.")
    Fixes: eb73190f4fbe ("net/packet: refine check for priv area size")
    Reported-by: syzbot <syzkaller@googlegroups.com>
    Signed-off-by: Willem de Bruijn <willemb@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c764f22b2fc39fbc621493f3c43bf120eaf2dbc7
Author: Florian Westphal <fw@strlen.de>
Date:   Tue Jul 17 21:03:15 2018 +0200

    netfilter: conntrack: dccp: treat SYNC/SYNCACK as invalid if no prior state
    
    commit 6613b6173dee098997229caf1f3b961c49da75e6 upstream.
    
    When first DCCP packet is SYNC or SYNCACK, we insert a new conntrack
    that has an un-initialized timeout value, i.e. such entry could be
    reaped at any time.
    
    Mark them as INVALID and only ignore SYNC/SYNCACK when connection had
    an old state.
    
    Reported-by: syzbot+6f18401420df260e37ed@syzkaller.appspotmail.com
    Signed-off-by: Florian Westphal <fw@strlen.de>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit caf3d4bd62cc11a055dce8a19e87a9f33b5e4bca
Author: Eric Dumazet <edumazet@google.com>
Date:   Mon Jun 18 21:35:07 2018 -0700

    xfrm_user: prevent leaking 2 bytes of kernel memory
    
    commit 45c180bc29babbedd6b8c01b975780ef44d9d09c upstream.
    
    struct xfrm_userpolicy_type has two holes, so we should not
    use C99 style initializer.
    
    KMSAN report:
    
    BUG: KMSAN: kernel-infoleak in copyout lib/iov_iter.c:140 [inline]
    BUG: KMSAN: kernel-infoleak in _copy_to_iter+0x1b14/0x2800 lib/iov_iter.c:571
    CPU: 1 PID: 4520 Comm: syz-executor841 Not tainted 4.17.0+ #5
    Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
    Call Trace:
     __dump_stack lib/dump_stack.c:77 [inline]
     dump_stack+0x185/0x1d0 lib/dump_stack.c:113
     kmsan_report+0x188/0x2a0 mm/kmsan/kmsan.c:1117
     kmsan_internal_check_memory+0x138/0x1f0 mm/kmsan/kmsan.c:1211
     kmsan_copy_to_user+0x7a/0x160 mm/kmsan/kmsan.c:1253
     copyout lib/iov_iter.c:140 [inline]
     _copy_to_iter+0x1b14/0x2800 lib/iov_iter.c:571
     copy_to_iter include/linux/uio.h:106 [inline]
     skb_copy_datagram_iter+0x422/0xfa0 net/core/datagram.c:431
     skb_copy_datagram_msg include/linux/skbuff.h:3268 [inline]
     netlink_recvmsg+0x6f1/0x1900 net/netlink/af_netlink.c:1959
     sock_recvmsg_nosec net/socket.c:802 [inline]
     sock_recvmsg+0x1d6/0x230 net/socket.c:809
     ___sys_recvmsg+0x3fe/0x810 net/socket.c:2279
     __sys_recvmmsg+0x58e/0xe30 net/socket.c:2391
     do_sys_recvmmsg+0x2a6/0x3e0 net/socket.c:2472
     __do_sys_recvmmsg net/socket.c:2485 [inline]
     __se_sys_recvmmsg net/socket.c:2481 [inline]
     __x64_sys_recvmmsg+0x15d/0x1c0 net/socket.c:2481
     do_syscall_64+0x15b/0x230 arch/x86/entry/common.c:287
     entry_SYSCALL_64_after_hwframe+0x44/0xa9
    RIP: 0033:0x446ce9
    RSP: 002b:00007fc307918db8 EFLAGS: 00000293 ORIG_RAX: 000000000000012b
    RAX: ffffffffffffffda RBX: 00000000006dbc24 RCX: 0000000000446ce9
    RDX: 000000000000000a RSI: 0000000020005040 RDI: 0000000000000003
    RBP: 00000000006dbc20 R08: 0000000020004e40 R09: 0000000000000000
    R10: 0000000040000000 R11: 0000000000000293 R12: 0000000000000000
    R13: 00007ffc8d2df32f R14: 00007fc3079199c0 R15: 0000000000000001
    
    Uninit was stored to memory at:
     kmsan_save_stack_with_flags mm/kmsan/kmsan.c:279 [inline]
     kmsan_save_stack mm/kmsan/kmsan.c:294 [inline]
     kmsan_internal_chain_origin+0x12b/0x210 mm/kmsan/kmsan.c:685
     kmsan_memcpy_origins+0x11d/0x170 mm/kmsan/kmsan.c:527
     __msan_memcpy+0x109/0x160 mm/kmsan/kmsan_instr.c:413
     __nla_put lib/nlattr.c:569 [inline]
     nla_put+0x276/0x340 lib/nlattr.c:627
     copy_to_user_policy_type net/xfrm/xfrm_user.c:1678 [inline]
     dump_one_policy+0xbe1/0x1090 net/xfrm/xfrm_user.c:1708
     xfrm_policy_walk+0x45a/0xd00 net/xfrm/xfrm_policy.c:1013
     xfrm_dump_policy+0x1c0/0x2a0 net/xfrm/xfrm_user.c:1749
     netlink_dump+0x9b5/0x1550 net/netlink/af_netlink.c:2226
     __netlink_dump_start+0x1131/0x1270 net/netlink/af_netlink.c:2323
     netlink_dump_start include/linux/netlink.h:214 [inline]
     xfrm_user_rcv_msg+0x8a3/0x9b0 net/xfrm/xfrm_user.c:2577
     netlink_rcv_skb+0x37e/0x600 net/netlink/af_netlink.c:2448
     xfrm_netlink_rcv+0xb2/0xf0 net/xfrm/xfrm_user.c:2598
     netlink_unicast_kernel net/netlink/af_netlink.c:1310 [inline]
     netlink_unicast+0x1680/0x1750 net/netlink/af_netlink.c:1336
     netlink_sendmsg+0x104f/0x1350 net/netlink/af_netlink.c:1901
     sock_sendmsg_nosec net/socket.c:629 [inline]
     sock_sendmsg net/socket.c:639 [inline]
     ___sys_sendmsg+0xec8/0x1320 net/socket.c:2117
     __sys_sendmsg net/socket.c:2155 [inline]
     __do_sys_sendmsg net/socket.c:2164 [inline]
     __se_sys_sendmsg net/socket.c:2162 [inline]
     __x64_sys_sendmsg+0x331/0x460 net/socket.c:2162
     do_syscall_64+0x15b/0x230 arch/x86/entry/common.c:287
     entry_SYSCALL_64_after_hwframe+0x44/0xa9
    Local variable description: ----upt.i@dump_one_policy
    Variable was created at:
     dump_one_policy+0x78/0x1090 net/xfrm/xfrm_user.c:1689
     xfrm_policy_walk+0x45a/0xd00 net/xfrm/xfrm_policy.c:1013
    
    Byte 130 of 137 is uninitialized
    Memory access starts at ffff88019550407f
    
    Fixes: c0144beaeca42 ("[XFRM] netlink: Use nla_put()/NLA_PUT() variantes")
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Reported-by: syzbot <syzkaller@googlegroups.com>
    Cc: Steffen Klassert <steffen.klassert@secunet.com>
    Cc: Herbert Xu <herbert@gondor.apana.org.au>
    Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fdb441da3858ce0523099f466b8433a1ea055865
Author: John David Anglin <dave.anglin@bell.net>
Date:   Sun Aug 12 16:38:03 2018 -0400

    parisc: Remove ordered stores from syscall.S
    
    commit 7797167ffde1f00446301cb22b37b7c03194cfaf upstream.
    
    Now that we use a sync prior to releasing the locks in syscall.S, we don't need
    the PA 2.0 ordered stores used to release some locks.  Using an ordered store,
    potentially slows the release and subsequent code.
    
    There are a number of other ordered stores and loads that serve no purpose.  I
    have converted these to normal stores.
    
    Signed-off-by: John David Anglin <dave.anglin@bell.net>
    Cc: stable@vger.kernel.org # 4.0+
    Signed-off-by: Helge Deller <deller@gmx.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit deebf1d61e707f5a0f29a76cbb54ab333869d01b
Author: Jaegeuk Kim <jaegeuk@kernel.org>
Date:   Tue Apr 24 21:34:05 2018 -0600

    f2fs: sanity check for total valid node blocks
    
    commit 8a29c1260e24e7c9c6ab138aa0017558d8b28208 upstream.
    
    This patch enhances sanity check for SIT entries.
    
    syzbot hit the following crash on upstream commit
    83beed7b2b26f232d782127792dd0cd4362fdc41 (Fri Apr 20 17:56:32 2018 +0000)
    Merge branch 'fixes' of git://git.kernel.org/pub/scm/linux/kernel/git/evalenti/linux-soc-thermal
    syzbot dashboard link: https://syzkaller.appspot.com/bug?extid=bf9253040425feb155ad
    
    syzkaller reproducer: https://syzkaller.appspot.com/x/repro.syz?id=5692130282438656
    Raw console output: https://syzkaller.appspot.com/x/log.txt?id=5095924598571008
    Kernel config: https://syzkaller.appspot.com/x/.config?id=1808800213120130118
    compiler: gcc (GCC) 8.0.1 20180413 (experimental)
    
    IMPORTANT: if you fix the bug, please add the following tag to the commit:
    Reported-by: syzbot+bf9253040425feb155ad@syzkaller.appspotmail.com
    It will help syzbot understand when the bug is fixed. See footer for details.
    If you forward the report, please keep this part and the footer.
    
    F2FS-fs (loop0): invalid crc value
    F2FS-fs (loop0): Try to recover 1th superblock, ret: 0
    F2FS-fs (loop0): Mounted with checkpoint version = d
    F2FS-fs (loop0): Bitmap was wrongly cleared, blk:9740
    ------------[ cut here ]------------
    kernel BUG at fs/f2fs/segment.c:1884!
    invalid opcode: 0000 [#1] SMP KASAN
    Dumping ftrace buffer:
       (ftrace buffer empty)
    Modules linked in:
    CPU: 1 PID: 4508 Comm: syz-executor0 Not tainted 4.17.0-rc1+ #10
    Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
    RIP: 0010:update_sit_entry+0x1215/0x1590 fs/f2fs/segment.c:1882
    RSP: 0018:ffff8801af526708 EFLAGS: 00010282
    RAX: ffffed0035ea4cc0 RBX: ffff8801ad454f90 RCX: 0000000000000000
    RDX: 0000000000000000 RSI: ffffffff82eeb87e RDI: ffffed0035ea4cb6
    RBP: ffff8801af526760 R08: ffff8801ad4a2480 R09: ffffed003b5e4f90
    R10: ffffed003b5e4f90 R11: ffff8801daf27c87 R12: ffff8801adb8d380
    R13: 0000000000000001 R14: 0000000000000008 R15: 00000000ffffffff
    FS:  00000000014af940(0000) GS:ffff8801daf00000(0000) knlGS:0000000000000000
    CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
    CR2: 00007f06bc223000 CR3: 00000001adb02000 CR4: 00000000001406e0
    DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
    DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
    Call Trace:
     allocate_data_block+0x66f/0x2050 fs/f2fs/segment.c:2663
     do_write_page+0x105/0x1b0 fs/f2fs/segment.c:2727
     write_node_page+0x129/0x350 fs/f2fs/segment.c:2770
     __write_node_page+0x7da/0x1370 fs/f2fs/node.c:1398
     sync_node_pages+0x18cf/0x1eb0 fs/f2fs/node.c:1652
     block_operations+0x429/0xa60 fs/f2fs/checkpoint.c:1088
     write_checkpoint+0x3ba/0x5380 fs/f2fs/checkpoint.c:1405
     f2fs_sync_fs+0x2fb/0x6a0 fs/f2fs/super.c:1077
     __sync_filesystem fs/sync.c:39 [inline]
     sync_filesystem+0x265/0x310 fs/sync.c:67
     generic_shutdown_super+0xd7/0x520 fs/super.c:429
     kill_block_super+0xa4/0x100 fs/super.c:1191
     kill_f2fs_super+0x9f/0xd0 fs/f2fs/super.c:3030
     deactivate_locked_super+0x97/0x100 fs/super.c:316
     deactivate_super+0x188/0x1b0 fs/super.c:347
     cleanup_mnt+0xbf/0x160 fs/namespace.c:1174
     __cleanup_mnt+0x16/0x20 fs/namespace.c:1181
     task_work_run+0x1e4/0x290 kernel/task_work.c:113
     tracehook_notify_resume include/linux/tracehook.h:191 [inline]
     exit_to_usermode_loop+0x2bd/0x310 arch/x86/entry/common.c:166
     prepare_exit_to_usermode arch/x86/entry/common.c:196 [inline]
     syscall_return_slowpath arch/x86/entry/common.c:265 [inline]
     do_syscall_64+0x6ac/0x800 arch/x86/entry/common.c:290
     entry_SYSCALL_64_after_hwframe+0x49/0xbe
    RIP: 0033:0x457d97
    RSP: 002b:00007ffd46f9c8e8 EFLAGS: 00000246 ORIG_RAX: 00000000000000a6
    RAX: 0000000000000000 RBX: 0000000000000000 RCX: 0000000000457d97
    RDX: 00000000014b09a3 RSI: 0000000000000002 RDI: 00007ffd46f9da50
    RBP: 00007ffd46f9da50 R08: 0000000000000000 R09: 0000000000000009
    R10: 0000000000000005 R11: 0000000000000246 R12: 00000000014b0940
    R13: 0000000000000000 R14: 0000000000000002 R15: 000000000000658e
    RIP: update_sit_entry+0x1215/0x1590 fs/f2fs/segment.c:1882 RSP: ffff8801af526708
    ---[ end trace f498328bb02610a2 ]---
    
    Reported-and-tested-by: syzbot+bf9253040425feb155ad@syzkaller.appspotmail.com
    Reported-and-tested-by: syzbot+7d6d31d3bc702f566ce3@syzkaller.appspotmail.com
    Reported-and-tested-by: syzbot+0a725420475916460f12@syzkaller.appspotmail.com
    Reviewed-by: Chao Yu <yuchao0@huawei.com>
    Signed-off-by: Jaegeuk Kim <jaegeuk@kernel.org>
    Signed-off-by: Sudip Mukherjee <sudipm.mukherjee@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2ab95e71c8a592cb798e0059dd26a900c6e290a2
Author: Jaegeuk Kim <jaegeuk@kernel.org>
Date:   Tue Dec 19 19:16:34 2017 -0800

    f2fs: return error during fill_super
    
    commit c39a1b348c4fe172729eff77c533dabc3c7cdaa7 upstream.
    
    Let's avoid BUG_ON during fill_super, when on-disk was totall corrupted.
    
    Reviewed-by: Chao Yu <yuchao0@huawei.com>
    Signed-off-by: Jaegeuk Kim <jaegeuk@kernel.org>
    Signed-off-by: Sudip Mukherjee <sudipm.mukherjee@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 270d5d77191769eaa57f94eff3ef8119121a091a
Author: Paolo Bonzini <pbonzini@redhat.com>
Date:   Mon May 28 13:31:13 2018 +0200

    KVM: irqfd: fix race between EPOLLHUP and irq_bypass_register_consumer
    
    commit 9432a3175770e06cb83eada2d91fac90c977cb99 upstream.
    
    A comment warning against this bug is there, but the code is not doing what
    the comment says.  Therefore it is possible that an EPOLLHUP races against
    irq_bypass_register_consumer.  The EPOLLHUP handler schedules irqfd_shutdown,
    and if that runs soon enough, you get a use-after-free.
    
    Reported-by: syzbot <syzkaller@googlegroups.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Reviewed-by: David Hildenbrand <david@redhat.com>
    Signed-off-by: Sudip Mukherjee <sudipm.mukherjee@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7a12f4ed07a5f7b49c7d4f86ea67f65ec953cc40
Author: Roland Dreier <roland@purestorage.com>
Date:   Thu Jul 19 20:07:59 2018 -0700

    nvme: fix handling of metadata_len for NVME_IOCTL_IO_CMD
    
    [ Upstream commit 9b382768135ee3ff282f828c906574a8478e036b ]
    
    The old code in nvme_user_cmd() passed the userspace virtual address
    from nvme_passthru_cmd.metadata as the length of the metadata buffer
    as well as the address to nvme_submit_user_cmd().
    
    Fixes: 63263d60 ("nvme: Use metadata for passthrough commands")
    Signed-off-by: Roland Dreier <roland@purestorage.com>
    Reviewed-by: Keith Busch <keith.busch@intel.com>
    Signed-off-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0ee106583f9c6fe2eccb5dbb9eb9562abbcba7ac
Author: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Date:   Thu Jul 19 21:38:23 2018 +0200

    ARM: dts: imx6: RDU2: fix irq type for mv88e6xxx switch
    
    [ Upstream commit e01a06c8089132bb4da035c6a83df23916ca3ebf ]
    
    The Marvell switches report their interrupts in a level sensitive way.
    When using edge sensitive detection a race condition in the interrupt
    handler of the swich might result in the OS to miss all future events
    which might make the switch non-functional.
    
    The problem is that both mv88e6xxx_g2_irq_thread_fn() and
    mv88e6xxx_g1_irq_thread_work() sample the irq cause register
    (MV88E6XXX_G2_INT_SRC and MV88E6XXX_G1_STS respectively) once and then
    handle the observed sources. If after sampling but before all observed
    irq sources are handled a new irq source gets active this is not noticed
    by the handler which returns unsuspecting, but the interrupt line stays
    active which prevents the edge detector to kick in.
    
    All device trees but imx6qdl-zii-rdu2 get this right (most of them by
    not specifying an interrupt parent). So fix imx6qdl-zii-rdu2
    accordingly.
    
    Signed-off-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
    Fixes: f64992d1a916 ("ARM: dts: imx6: RDU2: Add Switch interrupts")
    Reviewed-by: Andrew Lunn <andrew@lunn.ch>
    Signed-off-by: Shawn Guo <shawnguo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 119970f4775ba44e46545df5c3237ee8721dc1de
Author: Robin H. Johnson <robbat2@gentoo.org>
Date:   Fri Jul 13 20:50:47 2018 +0000

    ACPI / EC: Use ec_no_wakeup on more Thinkpad X1 Carbon 6th systems
    
    [ Upstream commit 2c4d6baf1bc4f7729773ffcee9ba2a9781578633 ]
    
    The ec_no_wakeup matcher added for Thinkpad X1 Carbon 6th gen systems
    beyond matched only a single DMI model (20KGS3JF01), that didn't cover
    my laptop (20KH002JUS). Change to match based on DMI product family to
    cover all X1 6th gen systems.
    
    Signed-off-by: Robin H. Johnson <robbat2@gentoo.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 715f5f92aabfa17ab4b7a39cf67b67d6d6eef68b
Author: Anson Huang <Anson.Huang@nxp.com>
Date:   Tue Jul 17 11:28:46 2018 +0800

    soc: imx: gpc: restrict register range for regmap access
    
    [ Upstream commit de2d9b5284bcb5c159c5882ac69f6bfd4dec7c67 ]
    
    GPC registers are NOT continuous, some registers are
    reserved and accessing them from userspace will trigger
    external abort, add regmap register access table to
    avoid below abort:
    
    root@imx6slevk:~# cat /sys/kernel/debug/regmap/20dc000.gpc/registers
    [  108.480477] Unhandled fault: imprecise external abort (0x1406) at 0xb6db5004
    [  108.487985] pgd = 42b54bfd
    [  108.490741] [b6db5004] *pgd=ba1b7831
    [  108.494386] Internal error: : 1406 [#1] SMP ARM
    [  108.498943] Modules linked in:
    [  108.502043] CPU: 0 PID: 389 Comm: cat Not tainted 4.18.0-rc1-00074-gc9f1f60-dirty #482
    [  108.509982] Hardware name: Freescale i.MX6 SoloLite (Device Tree)
    [  108.516123] PC is at regmap_mmio_read32le+0x20/0x24
    [  108.521031] LR is at regmap_mmio_read+0x40/0x60
    [  108.525586] pc : [<c059cf74>]    lr : [<c059d1ac>]    psr: 20060093
    [  108.531875] sp : eccf1d98  ip : eccf1da8  fp : eccf1da4
    [  108.537122] r10: ec2d3800  r9 : eccf1f60  r8 : ecfc0000
    [  108.542370] r7 : eccf1e2c  r6 : eccf1e2c  r5 : 00000028  r4 : ec338e00
    [  108.548920] r3 : 00000000  r2 : eccf1e2c  r1 : f0980028  r0 : 00000000
    [  108.555474] Flags: nzCv  IRQs off  FIQs on  Mode SVC_32  ISA ARM  Segment none
    [  108.562720] Control: 10c5387d  Table: acf4004a  DAC: 00000051
    [  108.568491] Process cat (pid: 389, stack limit = 0xd4318a65)
    [  108.574174] Stack: (0xeccf1d98 to 0xeccf2000)
    
    Fixes: 721cabf6c660 ("soc: imx: move PGC handling to a new GPC driver")
    Signed-off-by: Anson Huang <Anson.Huang@nxp.com>
    Reviewed-by: Fabio Estevam <fabio.estevam@nxp.com>
    Signed-off-by: Shawn Guo <shawnguo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 90e7d66508e3db1c1de55b6e196597edb37940b3
Author: Randy Dunlap <rdunlap@infradead.org>
Date:   Tue Jul 17 18:27:45 2018 -0700

    tcp: identify cryptic messages as TCP seq # bugs
    
    [ Upstream commit e56b8ce363a36fb7b74b80aaa5cc9084f2c908b4 ]
    
    Attempt to make cryptic TCP seq number error messages clearer by
    (1) identifying the source of the message as "TCP", (2) identifying the
    errors as "seq # bug", and (3) grouping the field identifiers and values
    by separating them with commas.
    
    E.g., the following message is changed from:
    
    recvmsg bug 2: copied 73BCB6CD seq 70F17CBE rcvnxt 73BCB9AA fl 0
    WARNING: CPU: 2 PID: 1501 at /linux/net/ipv4/tcp.c:1881 tcp_recvmsg+0x649/0xb90
    
    to:
    
    TCP recvmsg seq # bug 2: copied 73BCB6CD, seq 70F17CBE, rcvnxt 73BCB9AA, fl 0
    WARNING: CPU: 2 PID: 1501 at /linux/net/ipv4/tcp.c:2011 tcp_recvmsg+0x694/0xba0
    
    Suggested-by: 積丹尼 Dan Jacobson <jidanni@jidanni.org>
    Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e86aaeb8a63015d321acb6bce2ce0358d794cfa3
Author: Stefan Wahren <stefan.wahren@i2se.com>
Date:   Wed Jul 18 08:31:45 2018 +0200

    net: qca_spi: Fix log level if probe fails
    
    [ Upstream commit 50973993260a6934f0a00da53d9b746cfbea89ab ]
    
    In cases the probing fails the log level of the messages should
    be an error.
    
    Signed-off-by: Stefan Wahren <stefan.wahren@i2se.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7f117d7000ee4c232032212dc9e74c59faa7ab81
Author: Stefan Wahren <stefan.wahren@i2se.com>
Date:   Wed Jul 18 08:31:44 2018 +0200

    net: qca_spi: Make sure the QCA7000 reset is triggered
    
    [ Upstream commit 711c62dfa6bdb4326ca6c587f295ea5c4f7269de ]
    
    In case the SPI thread is not running, a simple reset of sync
    state won't fix the transmit timeout. We also need to wake up the kernel
    thread.
    
    Signed-off-by: Stefan Wahren <stefan.wahren@i2se.com>
    Fixes: ed7d42e24eff ("net: qca_spi: fix transmit queue timeout handling")
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f600a10d05da9d88d4385053997fb7898ed1eca7
Author: Stefan Wahren <stefan.wahren@i2se.com>
Date:   Wed Jul 18 08:31:43 2018 +0200

    net: qca_spi: Avoid packet drop during initial sync
    
    [ Upstream commit b2bab426dc715de147f8039a3fccff27d795f4eb ]
    
    As long as the synchronization with the QCA7000 isn't finished, we
    cannot accept packets from the upper layers. So let the SPI thread
    enable the TX queue after sync and avoid unwanted packet drop.
    
    Signed-off-by: Stefan Wahren <stefan.wahren@i2se.com>
    Fixes: 291ab06ecf67 ("net: qualcomm: new Ethernet over SPI driver for QCA7000")
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 96dfb7652e172b0ea77124928753904b64bc0261
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Wed Jul 18 15:40:40 2018 -0500

    PCI: versatile: Fix I/O space page leak
    
    [ Upstream commit 0018b265adf7e251f90d3ca1c7c0e32e2a0ad262 ]
    
    When testing the R-Car PCIe driver on the Condor board, if the PCIe PHY
    driver was left disabled, the kernel crashed with this BUG:
    
      kernel BUG at lib/ioremap.c:72!
      Internal error: Oops - BUG: 0 [#1] PREEMPT SMP
      Modules linked in:
      CPU: 0 PID: 39 Comm: kworker/0:1 Not tainted 4.17.0-dirty #1092
      Hardware name: Renesas Condor board based on r8a77980 (DT)
      Workqueue: events deferred_probe_work_func
      pstate: 80000005 (Nzcv daif -PAN -UAO)
      pc : ioremap_page_range+0x370/0x3c8
      lr : ioremap_page_range+0x40/0x3c8
      sp : ffff000008da39e0
      x29: ffff000008da39e0 x28: 00e8000000000f07
      x27: ffff7dfffee00000 x26: 0140000000000000
      x25: ffff7dfffef00000 x24: 00000000000fe100
      x23: ffff80007b906000 x22: ffff000008ab8000
      x21: ffff000008bb1d58 x20: ffff7dfffef00000
      x19: ffff800009c30fb8 x18: 0000000000000001
      x17: 00000000000152d0 x16: 00000000014012d0
      x15: 0000000000000000 x14: 0720072007200720
      x13: 0720072007200720 x12: 0720072007200720
      x11: 0720072007300730 x10: 00000000000000ae
      x9 : 0000000000000000 x8 : ffff7dffff000000
      x7 : 0000000000000000 x6 : 0000000000000100
      x5 : 0000000000000000 x4 : 000000007b906000
      x3 : ffff80007c61a880 x2 : ffff7dfffeefffff
      x1 : 0000000040000000 x0 : 00e80000fe100f07
      Process kworker/0:1 (pid: 39, stack limit = 0x        (ptrval))
      Call trace:
       ioremap_page_range+0x370/0x3c8
       pci_remap_iospace+0x7c/0xac
       pci_parse_request_of_pci_ranges+0x13c/0x190
       rcar_pcie_probe+0x4c/0xb04
       platform_drv_probe+0x50/0xbc
       driver_probe_device+0x21c/0x308
       __device_attach_driver+0x98/0xc8
       bus_for_each_drv+0x54/0x94
       __device_attach+0xc4/0x12c
       device_initial_probe+0x10/0x18
       bus_probe_device+0x90/0x98
       deferred_probe_work_func+0xb0/0x150
       process_one_work+0x12c/0x29c
       worker_thread+0x200/0x3fc
       kthread+0x108/0x134
       ret_from_fork+0x10/0x18
      Code: f9004ba2 54000080 aa0003fb 17ffff48 (d4210000)
    
    It turned out that pci_remap_iospace() wasn't undone when the driver's
    probe failed, and since devm_phy_optional_get() returned -EPROBE_DEFER,
    the probe was retried, finally causing the BUG due to trying to remap
    already remapped pages.
    
    The Versatile PCI controller driver has the same issue.
    Replace pci_remap_iospace() with the devm_ managed version to fix the bug.
    
    Fixes: b7e78170efd4 ("PCI: versatile: Add DT-based ARM Versatile PB PCIe host driver")
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    [lorenzo.pieralisi@arm.com: updated the commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0e66392d985c4595969f69350d8566d292ea12e7
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Wed Jul 18 15:40:26 2018 -0500

    PCI: OF: Fix I/O space page leak
    
    commit a5fb9fb023a1435f2b42bccd7f547560f3a21dc3 upstream.
    
    When testing the R-Car PCIe driver on the Condor board, if the PCIe PHY
    driver was left disabled, the kernel crashed with this BUG:
    
      kernel BUG at lib/ioremap.c:72!
      Internal error: Oops - BUG: 0 [#1] PREEMPT SMP
      Modules linked in:
      CPU: 0 PID: 39 Comm: kworker/0:1 Not tainted 4.17.0-dirty #1092
      Hardware name: Renesas Condor board based on r8a77980 (DT)
      Workqueue: events deferred_probe_work_func
      pstate: 80000005 (Nzcv daif -PAN -UAO)
      pc : ioremap_page_range+0x370/0x3c8
      lr : ioremap_page_range+0x40/0x3c8
      sp : ffff000008da39e0
      x29: ffff000008da39e0 x28: 00e8000000000f07
      x27: ffff7dfffee00000 x26: 0140000000000000
      x25: ffff7dfffef00000 x24: 00000000000fe100
      x23: ffff80007b906000 x22: ffff000008ab8000
      x21: ffff000008bb1d58 x20: ffff7dfffef00000
      x19: ffff800009c30fb8 x18: 0000000000000001
      x17: 00000000000152d0 x16: 00000000014012d0
      x15: 0000000000000000 x14: 0720072007200720
      x13: 0720072007200720 x12: 0720072007200720
      x11: 0720072007300730 x10: 00000000000000ae
      x9 : 0000000000000000 x8 : ffff7dffff000000
      x7 : 0000000000000000 x6 : 0000000000000100
      x5 : 0000000000000000 x4 : 000000007b906000
      x3 : ffff80007c61a880 x2 : ffff7dfffeefffff
      x1 : 0000000040000000 x0 : 00e80000fe100f07
      Process kworker/0:1 (pid: 39, stack limit = 0x        (ptrval))
      Call trace:
       ioremap_page_range+0x370/0x3c8
       pci_remap_iospace+0x7c/0xac
       pci_parse_request_of_pci_ranges+0x13c/0x190
       rcar_pcie_probe+0x4c/0xb04
       platform_drv_probe+0x50/0xbc
       driver_probe_device+0x21c/0x308
       __device_attach_driver+0x98/0xc8
       bus_for_each_drv+0x54/0x94
       __device_attach+0xc4/0x12c
       device_initial_probe+0x10/0x18
       bus_probe_device+0x90/0x98
       deferred_probe_work_func+0xb0/0x150
       process_one_work+0x12c/0x29c
       worker_thread+0x200/0x3fc
       kthread+0x108/0x134
       ret_from_fork+0x10/0x18
      Code: f9004ba2 54000080 aa0003fb 17ffff48 (d4210000)
    
    It turned out that pci_remap_iospace() wasn't undone when the driver's
    probe failed, and since devm_phy_optional_get() returned -EPROBE_DEFER,
    the probe was retried, finally causing the BUG due to trying to remap
    already remapped pages.
    
    Introduce the devm_pci_remap_iospace() managed API and replace the
    pci_remap_iospace() call with it to fix the bug.
    
    Fixes: dbf9826d5797 ("PCI: generic: Convert to DT resource parsing API")
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    [lorenzo.pieralisi@arm.com: split commit/updated the commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 114a5608cde4197870d4f217c69f27ea20f9350c
Author: Peng Hao <peng.hao2@zte.com.cn>
Date:   Sat Jul 14 23:28:29 2018 +0800

    kvmclock: fix TSC calibration for nested guests
    
    [ Upstream commit e10f7805032365cc11c739a97f226ebb48aee042 ]
    
    Inside a nested guest, access to hardware can be slow enough that
    tsc_read_refs always return ULLONG_MAX, causing tsc_refine_calibration_work
    to be called periodically and the nested guest to spend a lot of time
    reading the ACPI timer.
    
    However, if the TSC frequency is available from the pvclock page,
    we can just set X86_FEATURE_TSC_KNOWN_FREQ and avoid the recalibration.
    'refine' operation.
    
    Suggested-by: Peter Zijlstra <peterz@infradead.org>
    Signed-off-by: Peng Hao <peng.hao2@zte.com.cn>
    [Commit message rewritten. - Paolo]
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1b1968d8f6ae913f5c0ec55893d324195d234fbe
Author: David Lechner <david@lechnology.com>
Date:   Mon Jul 16 17:58:10 2018 -0500

    net: usb: rtl8150: demote allmulti message to dev_dbg()
    
    [ Upstream commit 3a9b0455062ffb9d2f6cd4473a76e3456f318c9f ]
    
    This driver can spam the kernel log with multiple messages of:
    
        net eth0: eth0: allmulti set
    
    Usually 4 or 8 at a time (probably because of using ConnMan).
    
    This message doesn't seem useful, so let's demote it from dev_info()
    to dev_dbg().
    
    Signed-off-by: David Lechner <david@lechnology.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 70cc6b67508ca7a940f463a1aa12869f1f59fd7a
Author: Alexander Sverdlin <alexander.sverdlin@nsn.com>
Date:   Fri Jul 13 17:31:50 2018 +0200

    octeon_mgmt: Fix MIX registers configuration on MTU setup
    
    [ Upstream commit 4aac0b43474d18f6160302a3caa147d77fa3baa1 ]
    
    octeon_mgmt driver doesn't drop RX frames that are 1-4 bytes bigger than
    MTU set for the corresponding interface. The problem is in the
    AGL_GMX_RX0/1_FRM_MAX register setting, which should not account for VLAN
    tagging.
    
    According to Octeon HW manual:
    "For tagged frames, MAX increases by four bytes for each VLAN found up to a
    maximum of two VLANs, or MAX + 8 bytes."
    
    OCTEON_FRAME_HEADER_LEN "define" is fine for ring buffer management, but
    should not be used for AGL_GMX_RX0/1_FRM_MAX.
    
    The problem could be easily reproduced using "ping" command. If affected
    system has default MTU 1500, other host (having MTU >= 1504) can
    successfully "ping" the affected system with payload size 1473-1476,
    resulting in IP packets of size 1501-1504 accepted by the mgmt driver.
    Fixed system still accepts IP packets of 1500 bytes even with VLAN tagging,
    because the limits are lifted in HW as expected, for every VLAN tag.
    
    Signed-off-by: Alexander Sverdlin <alexander.sverdlin@nokia.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fc9caa36d80e7f3aaf0720df58a7611ae88b9a94
Author: Qu Wenruo <wqu@suse.com>
Date:   Wed Jul 11 13:41:21 2018 +0800

    btrfs: scrub: Don't use inode page cache in scrub_handle_errored_block()
    
    [ Upstream commit 665d4953cde6d9e75c62a07ec8f4f8fd7d396ade ]
    
    In commit ac0b4145d662 ("btrfs: scrub: Don't use inode pages for device
    replace") we removed the branch of copy_nocow_pages() to avoid
    corruption for compressed nodatasum extents.
    
    However above commit only solves the problem in scrub_extent(), if
    during scrub_pages() we failed to read some pages,
    sctx->no_io_error_seen will be non-zero and we go to fixup function
    scrub_handle_errored_block().
    
    In scrub_handle_errored_block(), for sctx without csum (no matter if
    we're doing replace or scrub) we go to scrub_fixup_nodatasum() routine,
    which does the similar thing with copy_nocow_pages(), but does it
    without the extra check in copy_nocow_pages() routine.
    
    So for test cases like btrfs/100, where we emulate read errors during
    replace/scrub, we could corrupt compressed extent data again.
    
    This patch will fix it just by avoiding any "optimization" for
    nodatasum, just falls back to the normal fixup routine by try read from
    any good copy.
    
    This also solves WARN_ON() or dead lock caused by lame backref iteration
    in scrub_fixup_nodatasum() routine.
    
    The deadlock or WARN_ON() won't be triggered before commit ac0b4145d662
    ("btrfs: scrub: Don't use inode pages for device replace") since
    copy_nocow_pages() have better locking and extra check for data extent,
    and it's already doing the fixup work by try to read data from any good
    copy, so it won't go scrub_fixup_nodatasum() anyway.
    
    This patch disables the faulty code and will be removed completely in a
    followup patch.
    
    Fixes: ac0b4145d662 ("btrfs: scrub: Don't use inode pages for device replace")
    Signed-off-by: Qu Wenruo <wqu@suse.com>
    Signed-off-by: David Sterba <dsterba@suse.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2daadcdc58278f0d57e4ed23e6841e3a0e059ebf
Author: John Allen <jallen@linux.ibm.com>
Date:   Mon Jul 16 10:29:30 2018 -0500

    ibmvnic: Fix error recovery on login failure
    
    [ Upstream commit 3578a7ecb69920efc3885dbd610e98c00dbdf5db ]
    
    Testing has uncovered a failure case that is not handled properly. In the
    event that a login fails and we are not able to recover on the spot, we
    return 0 from do_reset, preventing any error recovery code from being
    triggered.  Additionally, the state is set to "probed" meaning that when we
    are able to trigger the error recovery, the driver always comes up in the
    probed state. To handle the case properly, we need to return a failure code
    here and set the adapter state to the state that we entered the reset in
    indicating the state that we would like to come out of the recovery reset
    in.
    
    Signed-off-by: John Allen <jallen@linux.vnet.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a6c35a5c87509ebaf6cdbc5b035a9184d690b1ba
Author: Randy Dunlap <rdunlap@infradead.org>
Date:   Fri Jul 13 21:25:19 2018 -0700

    net/ethernet/freescale/fman: fix cross-build error
    
    [ Upstream commit c133459765fae249ba482f62e12f987aec4376f0 ]
    
      CC [M]  drivers/net/ethernet/freescale/fman/fman.o
    In file included from ../drivers/net/ethernet/freescale/fman/fman.c:35:
    ../include/linux/fsl/guts.h: In function 'guts_set_dmacr':
    ../include/linux/fsl/guts.h:165:2: error: implicit declaration of function 'clrsetbits_be32' [-Werror=implicit-function-declaration]
      clrsetbits_be32(&guts->dmacr, 3 << shift, device << shift);
      ^~~~~~~~~~~~~~~
    
    Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
    Cc: Madalin Bucur <madalin.bucur@nxp.com>
    Cc: netdev@vger.kernel.org
    Cc: linuxppc-dev@lists.ozlabs.org
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7b4ab0e6510bdef33cbb9e3b4a5471d252d3d295
Author: Stephen Hemminger <stephen@networkplumber.org>
Date:   Fri Jul 13 10:38:38 2018 -0700

    hv/netvsc: fix handling of fallback to single queue mode
    
    [ Upstream commit 916c5e1413be058d1c1f6e502db350df890730ce ]
    
    The netvsc device may need to fallback to running in single queue
    mode if host side only wants to support single queue.
    
    Recent change for handling mtu broke this in setup logic.
    
    Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
    Fixes: 3ffe64f1a641 ("hv_netvsc: split sub-channel setup into async and sync")
    Signed-off-by: Stephen Hemminger <sthemmin@microsoft.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dcedabcab0457f17df9c7ff7d66cd27aa517b685
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Tue Jul 3 15:30:56 2018 +0300

    drm/nouveau/gem: off by one bugs in nouveau_gem_pushbuf_reloc_apply()
    
    [ Upstream commit 7f073d011f93e92d4d225526b9ab6b8b0bbd6613 ]
    
    The bo array has req->nr_buffers elements so the > should be >= so we
    don't read beyond the end of the array.
    
    Fixes: a1606a9596e5 ("drm/nouveau: new gem pushbuf interface, bump to 0.0.16")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b6fadd93ad962be7584b9df8b56897293c1d975f
Author: Wei Yongjun <weiyongjun1@huawei.com>
Date:   Wed Jul 11 12:34:21 2018 +0000

    pinctrl: nsp: Fix potential NULL dereference
    
    [ Upstream commit c29e9da56bebb4c2c794e871b0dc0298bbf08142 ]
    
    platform_get_resource() may fail and return NULL, so we should
    better check it's return value to avoid a NULL pointer dereference
    a bit later in the code.
    
    This is detected by Coccinelle semantic patch.
    
    @@
    expression pdev, res, n, t, e, e1, e2;
    @@
    
    res = platform_get_resource(pdev, t, n);
    + if (!res)
    +   return -EINVAL;
    ... when != res == NULL
    e = devm_ioremap_nocache(e1, res->start, e2);
    
    Fixes: cc4fa83f66e9 ("pinctrl: nsp: add pinmux driver support for Broadcom NSP SoC")
    Signed-off-by: Wei Yongjun <weiyongjun1@huawei.com>
    Reviewed-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 54046f1793c7a35e7b8c63964c181faf384bcc38
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Tue Jul 3 15:04:25 2018 +0300

    pinctrl: nsp: off by ones in nsp_pinmux_enable()
    
    [ Upstream commit f90a21c898db58eaea14b8ad7e9af3b9e15e5f8a ]
    
    The > comparisons should be >= or else we read beyond the end of the
    pinctrl->functions[] array.
    
    Fixes: cc4fa83f66e9 ("pinctrl: nsp: add pinmux driver support for Broadcom NSP SoC")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Reviewed-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 87011fb97fe5a4b05c7c7c532502b45947fc4709
Author: Paul Cercueil <paul@crapouillou.net>
Date:   Wed Jun 27 13:49:02 2018 +0200

    pinctrl: ingenic: Fix inverted direction for < JZ4770
    
    [ Upstream commit 0084a786ca8c84b443f67c4a697b4f2552761650 ]
    
    The .gpio_set_direction() callback was setting inverted direction
    for SoCs older than the JZ4770, this restores the correct behaviour.
    
    Signed-off-by: Paul Cercueil <paul@crapouillou.net>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2d2eacd650c6a01ef90c34c7d99f82854eb7fd96
Author: Yuchung Cheng <ycheng@google.com>
Date:   Thu Jul 12 06:04:53 2018 -0700

    tcp: remove DELAYED ACK events in DCTCP
    
    [ Upstream commit a69258f7aa2623e0930212f09c586fd06674ad79 ]
    
    After fixing the way DCTCP tracking delayed ACKs, the delayed-ACK
    related callbacks are no longer needed
    
    Signed-off-by: Yuchung Cheng <ycheng@google.com>
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Acked-by: Neal Cardwell <ncardwell@google.com>
    Acked-by: Lawrence Brakmo <brakmo@fb.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bf106eaa181c64373442c75f0dbd602b77cf5233
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Thu Jul 12 15:23:45 2018 +0300

    qlogic: check kstrtoul() for errors
    
    [ Upstream commit 5fc853cc01c68f84984ecc2d5fd777ecad78240f ]
    
    We accidentally left out the error handling for kstrtoul().
    
    Fixes: a520030e326a ("qlcnic: Implement flash sysfs callback for 83xx adapter")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 75425326b88ccdbcdecc652b1f6f672c0bd286d0
Author: Willem de Bruijn <willemb@google.com>
Date:   Wed Jul 11 12:00:45 2018 -0400

    packet: reset network header if packet shorter than ll reserved space
    
    [ Upstream commit 993675a3100b16a4c80dfd70cbcde8ea7127b31d ]
    
    If variable length link layer headers result in a packet shorter
    than dev->hard_header_len, reset the network header offset. Else
    skb->mac_len may exceed skb->len after skb_mac_reset_len.
    
    packet_sendmsg_spkt already has similar logic.
    
    Fixes: b84bbaf7a6c8 ("packet: in packet_snd start writing at link layer allocation")
    Signed-off-by: Willem de Bruijn <willemb@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit edf81993dc293d9048fce2076a0b9182cd6ac07e
Author: Masahiro Yamada <yamada.masahiro@socionext.com>
Date:   Thu Jul 12 19:38:36 2018 +0900

    kbuild: suppress warnings from 'getconf LFS_*'
    
    [ Upstream commit 6d79a7b424a5630a6fcab31fd7c38af4ea9c9a0f ]
    
    Suppress warnings for systems that do not recognize LFS_*.
    
     getconf: no such configuration parameter `LFS_CFLAGS'
     getconf: no such configuration parameter `LFS_LDFLAGS'
     getconf: no such configuration parameter `LFS_LIBS'
    
    Fixes: d7f14c66c273 ("kbuild: Enable Large File Support for hostprogs")
    Reported-by: Chen Feng <puck.chen@hisilicon.com>
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Acked-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit abf9fb6e1537f324d9de965a9928e12dabbc5f47
Author: Laura Abbott <labbott@redhat.com>
Date:   Mon Jul 9 17:45:57 2018 -0700

    tools: build: Use HOSTLDFLAGS with fixdep
    
    [ Upstream commit 8b247a92ebd0cda7dec49a6f771d9c4950f3d3ad ]
    
    The final link of fixdep uses LDFLAGS but not the existing HOSTLDFLAGS.
    Fix this.
    
    Signed-off-by: Laura Abbott <labbott@redhat.com>
    Acked-by: Jiri Olsa <jolsa@kernel.org>
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bd43d233acaa0a80dbc2ae5e605374719eb4bdf7
Author: Alexander Duyck <alexander.h.duyck@intel.com>
Date:   Mon Jun 18 12:02:00 2018 -0400

    ixgbe: Be more careful when modifying MAC filters
    
    [ Upstream commit d14c780c11fbc10f66c43e7b64eefe87ca442bd3 ]
    
    This change makes it so that we are much more explicit about the ordering
    of updates to the receive address register (RAR) table. Prior to this patch
    I believe we may have been updating the table while entries were still
    active, or possibly allowing for reordering of things since we weren't
    explicitly flushing writes to either the lower or upper portion of the
    register prior to accessing the other half.
    
    Signed-off-by: Alexander Duyck <alexander.h.duyck@intel.com>
    Reviewed-by: Shannon Nelson <shannon.nelson@oracle.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 95b08af4026956f8324aec9c883ec084b7c58101
Author: Adam Ford <aford173@gmail.com>
Date:   Wed Jul 11 12:54:54 2018 -0500

    ARM: dts: am3517.dtsi: Disable reference to OMAP3 OTG controller
    
    [ Upstream commit 923847413f7316b5ced3491769b3fefa6c56a79a ]
    
    The AM3517 has a different OTG controller location than the OMAP3,
    which is included from omap3.dtsi.  This results in a hwmod error.
    Since the AM3517 has a different OTG controller address, this patch
    disabes one that is isn't available.
    
    Signed-off-by: Adam Ford <aford173@gmail.com>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e77c08b7c6f0a93ac736425d3728038300a009cd
Author: Nishanth Menon <nm@ti.com>
Date:   Tue Jul 10 14:47:25 2018 -0500

    ARM: DRA7/OMAP5: Enable ACTLR[0] (Enable invalidates of BTB) for secondary cores
    
    [ Upstream commit 2f8b5b21830aea95989a6e67d8a971297272a086 ]
    
    Call secure services to enable ACTLR[0] (Enable invalidates of BTB with
    ICIALLU) when branch hardening is enabled for kernel.
    
    On GP devices OMAP5/DRA7, there is no possibility to update secure
    side since "secure world" is ROM and there are no override mechanisms
    possible. On HS devices, appropriate PPA should do the workarounds as
    well.
    
    However, the configuration is only done for secondary core, since it is
    expected that firmware/bootloader will have enabled the required
    configuration for the primary boot core (note: bootloaders typically
    will NOT enable secondary processors, since it has no need to do so).
    
    Signed-off-by: Nishanth Menon <nm@ti.com>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b900c624d467abc34c7dfbf873493cd4e9ab188f
Author: Steven Rostedt (VMware) <rostedt@goodmis.org>
Date:   Tue Jul 10 08:22:40 2018 +0100

    ARM: 8780/1: ftrace: Only set kernel memory back to read-only after boot
    
    [ Upstream commit b4c7e2bd2eb4764afe3af9409ff3b1b87116fa30 ]
    
    Dynamic ftrace requires modifying the code segments that are usually
    set to read-only. To do this, a per arch function is called both before
    and after the ftrace modifications are performed. The "before" function
    will set kernel code text to read-write to allow for ftrace to make the
    modifications, and the "after" function will set the kernel code text
    back to "read-only" to keep the kernel code text protected.
    
    The issue happens when dynamic ftrace is tested at boot up. The test is
    done before the kernel code text has been set to read-only. But the
    "before" and "after" calls are still performed. The "after" call will
    change the kernel code text to read-only prematurely, and other boot
    code that expects this code to be read-write will fail.
    
    The solution is to add a variable that is set when the kernel code text
    is expected to be converted to read-only, and make the ftrace "before"
    and "after" calls do nothing if that variable is not yet set. This is
    similar to the x86 solution from commit 162396309745 ("ftrace, x86:
    make kernel text writable only for conversions").
    
    Link: http://lkml.kernel.org/r/20180620212906.24b7b66e@vmware.local.home
    
    Reported-by: Stefan Agner <stefan@agner.ch>
    Tested-by: Stefan Agner <stefan@agner.ch>
    Signed-off-by: Steven Rostedt (VMware) <rostedt@goodmis.org>
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 26c7588c28caafda58ed88b45912dafc240c495e
Author: Kamal Heib <kamalheib1@gmail.com>
Date:   Tue Jul 10 11:56:50 2018 +0300

    RDMA/mlx5: Fix memory leak in mlx5_ib_create_srq() error path
    
    [ Upstream commit d63c46734c545ad0488761059004a65c46efdde3 ]
    
    Fix memory leak in the error path of mlx5_ib_create_srq() by making sure
    to free the allocated srq.
    
    Fixes: c2b37f76485f ("IB/mlx5: Fix integer overflows in mlx5_ib_create_srq")
    Signed-off-by: Kamal Heib <kamalheib1@gmail.com>
    Acked-by: Leon Romanovsky <leonro@mellanox.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a6629efeef9d9bbb76d9e7cdf0262ad07e9f1651
Author: Dave Jiang <dave.jiang@intel.com>
Date:   Wed Jul 11 10:10:11 2018 -0700

    nfit: fix unchecked dereference in acpi_nfit_ctl
    
    [ Upstream commit ee6581ceba7f8314b81b2f2a81f1cf3f67c679e2 ]
    
    Incremental patch to fix the unchecked dereference in acpi_nfit_ctl.
    Reported by Dan Carpenter:
    
    "acpi/nfit: fix cmd_rc for acpi_nfit_ctl to
    always return a value" from Jun 28, 2018, leads to the following
    Smatch complaint:
    
        drivers/acpi/nfit/core.c:578 acpi_nfit_ctl()
         warn: variable dereferenced before check 'cmd_rc' (see line 411)
    
    drivers/acpi/nfit/core.c
       410
       411          *cmd_rc = -EINVAL;
                    ^^^^^^^^^^^^^^^^^^
    Patch adds unchecked dereference.
    
    Fixes: c1985cefd844 ("acpi/nfit: fix cmd_rc for acpi_nfit_ctl to always return a value")
    
    Signed-off-by: Dave Jiang <dave.jiang@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 953c9cddc99983d4bd78936a42c28d5330ccae61
Author: Janne Huttunen <janne.huttunen@nokia.com>
Date:   Mon Jul 9 13:59:50 2018 +0300

    perf script python: Fix dict reference counting
    
    [ Upstream commit db0ba84c04ef2cf293aaada5ae97531127844d9d ]
    
    The dictionaries are attached to the parameter tuple that steals the
    references and takes care of releasing them when appropriate.  The code
    should not decrement the reference counts explicitly.  E.g. if libpython
    has been built with reference debugging enabled, the superfluous DECREFs
    will trigger this error when running perf script:
    
      Fatal Python error: Objects/tupleobject.c:238 object at
      0x7f10f2041b40 has negative ref count -1
      Aborted (core dumped)
    
    If the reference debugging is not enabled, the superfluous DECREFs might
    cause the dict objects to be silently released while they are still in
    use. This may trigger various other assertions or just cause perf
    crashes and/or weird and unexpected data changes in the stored Python
    objects.
    
    Signed-off-by: Janne Huttunen <janne.huttunen@nokia.com>
    Acked-by: Jiri Olsa <jolsa@kernel.org>
    Acked-by: Namhyung Kim <namhyung@kernel.org>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Andi Kleen <ak@linux.intel.com>
    Cc: Jaroslav Skarvada <jskarvad@redhat.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Link: http://lkml.kernel.org/r/1531133990-17485-1-git-send-email-janne.huttunen@nokia.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d1d2e7d014d261d435baf0ca12ad0b132cea9188
Author: Jiri Olsa <jolsa@kernel.org>
Date:   Mon Jul 2 15:42:01 2018 +0200

    perf tools: Fix compilation errors on gcc8
    
    [ Upstream commit a09603f851045b031e990d2d663958ccb49db525 ]
    
    We are getting following warnings on gcc8 that break compilation:
    
      $ make
        CC       jvmti/jvmti_agent.o
      jvmti/jvmti_agent.c: In function ‘jvmti_open’:
      jvmti/jvmti_agent.c:252:35: error: ‘/jit-’ directive output may be truncated \
        writing 5 bytes into a region of size between 1 and 4096 [-Werror=format-truncation=]
        snprintf(dump_path, PATH_MAX, "%s/jit-%i.dump", jit_path, getpid());
    
    There's no point in checking the result of snprintf call in
    jvmti_open, the following open call will fail in case the
    name is mangled or too long.
    
    Using tools/lib/ function scnprintf that touches the return value from
    the snprintf() calls and thus get rid of those warnings.
    
      $ make DEBUG=1
        CC       arch/x86/util/perf_regs.o
      arch/x86/util/perf_regs.c: In function ‘arch_sdt_arg_parse_op’:
      arch/x86/util/perf_regs.c:229:4: error: ‘strncpy’ output truncated before terminating nul
      copying 2 bytes from a string of the same length [-Werror=stringop-truncation]
        strncpy(prefix, "+0", 2);
        ^~~~~~~~~~~~~~~~~~~~~~~~
    
    Using scnprintf instead of the strncpy (which we know is safe in here)
    to get rid of that warning.
    
    Signed-off-by: Jiri Olsa <jolsa@kernel.org>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: David Ahern <dsahern@gmail.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Link: http://lkml.kernel.org/r/20180702134202.17745-1-jolsa@kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 42a061a16675f6cf439228e6582d7596c19f7e8d
Author: Kim Phillips <kim.phillips@arm.com>
Date:   Fri Jun 29 12:46:52 2018 -0500

    perf llvm-utils: Remove bashism from kernel include fetch script
    
    [ Upstream commit f6432b9f65001651412dbc3589d251534822d4ab ]
    
    Like system(), popen() calls /bin/sh, which may/may not be bash.
    
    Script when run on dash and encounters the line, yields:
    
     exit: Illegal number: -1
    
    checkbashisms report on script content:
    
     possible bashism (exit|return with negative status code):
     exit -1
    
    Remove the bashism and use the more portable non-zero failure
    status code 1.
    
    Signed-off-by: Kim Phillips <kim.phillips@arm.com>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Hendrik Brueckner <brueckner@linux.vnet.ibm.com>
    Cc: Jiri Olsa <jolsa@redhat.com>
    Cc: Michael Petlan <mpetlan@redhat.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Sandipan Das <sandipan@linux.vnet.ibm.com>
    Cc: Thomas Richter <tmricht@linux.vnet.ibm.com>
    Link: http://lkml.kernel.org/r/20180629124652.8d0af7e2281fd3fd8262cacc@arm.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e238b259b7741164e75dc79dda02c790655c0ce1
Author: Manish Rangankar <manish.rangankar@cavium.com>
Date:   Mon Jul 2 23:52:31 2018 -0700

    scsi: qedi: Send driver state to MFW
    
    [ Upstream commit a3440d0d2f57f7ba102fc332086961cf261180af ]
    
    In case of iSCSI offload BFS environment, MFW requires to mark virtual
    link based upon qedi load status.
    
    Signed-off-by: Manish Rangankar <manish.rangankar@qlogic.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a38adc3e104b96f49ff9d9a583e8a1b1256dfff3
Author: Saurav Kashyap <saurav.kashyap@cavium.com>
Date:   Thu Jul 5 07:01:33 2018 -0700

    scsi: qedf: Send the driver state to MFW
    
    [ Upstream commit 6ac174756dfc9884f08b23af840ca911155f5578 ]
    
    Need to notify firmware when driver is loaded and unloaded.
    
    Signed-off-by: Saurav Kashyap <saurav.kashyap@cavium.com>
    Signed-off-by: Chad Dupuis <chad.dupuis@cavium.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fdf578210a0eb0b600c68795377cbf4999a24a25
Author: Vikas Gupta <vikas.gupta@broadcom.com>
Date:   Mon Jul 9 02:24:52 2018 -0400

    bnxt_en: Fix for system hang if request_irq fails
    
    [ Upstream commit c58387ab1614f6d7fb9e244f214b61e7631421fc ]
    
    Fix bug in the error code path when bnxt_request_irq() returns failure.
    bnxt_disable_napi() should not be called in this error path because
    NAPI has not been enabled yet.
    
    Fixes: c0c050c58d84 ("bnxt_en: New Broadcom ethernet driver.")
    Signed-off-by: Vikas Gupta <vikas.gupta@broadcom.com>
    Signed-off-by: Michael Chan <michael.chan@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cab718feb18f6e4900f8951e966804d988d39a2d
Author: Michael Chan <michael.chan@broadcom.com>
Date:   Mon Jul 9 02:24:49 2018 -0400

    bnxt_en: Always set output parameters in bnxt_get_max_rings().
    
    [ Upstream commit 78f058a4aa0f2280dc4d45d2c4a95728398ef857 ]
    
    The current code returns -ENOMEM and does not bother to set the output
    parameters to 0 when no rings are available.  Some callers, such as
    bnxt_get_channels() will display garbage ring numbers when that happens.
    Fix it by always setting the output parameters.
    
    Fixes: 6e6c5a57fbe1 ("bnxt_en: Modify bnxt_get_max_rings() to support shared or non shared rings.")
    Signed-off-by: Michael Chan <michael.chan@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 822bbc4c7966392501d43f9f205a6af09e492567
Author: Michael Chan <michael.chan@broadcom.com>
Date:   Mon Jul 9 02:24:48 2018 -0400

    bnxt_en: Fix inconsistent BNXT_FLAG_AGG_RINGS logic.
    
    [ Upstream commit 07f4fde53d12eb8d921b465bb298e964e0bdc38c ]
    
    If there aren't enough RX rings available, the driver will attempt to
    use a single RX ring without the aggregation ring.  If that also
    fails, the BNXT_FLAG_AGG_RINGS flag is cleared but the other ring
    parameters are not set consistently to reflect that.  If more RX
    rings become available at the next open, the RX rings will be in
    an inconsistent state and may crash when freeing the RX rings.
    
    Fix it by restoring the BNXT_FLAG_AGG_RINGS if not enough RX rings are
    available to run without aggregation rings.
    
    Fixes: bdbd1eb59c56 ("bnxt_en: Handle no aggregation ring gracefully.")
    Signed-off-by: Michael Chan <michael.chan@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 09af6c90819d9bdd9f8ce6233308cead86625965
Author: Peter Zijlstra <peterz@infradead.org>
Date:   Tue Jun 19 17:22:05 2018 +0300

    ARC: Improve cmpxchg syscall implementation
    
    [ Upstream commit e8708786d4fe21c043d38d760f768949a3d71185 ]
    
    This is used in configs lacking hardware atomics to emulate atomic r-m-w
    for user space, implemented by disabling preemption in kernel.
    
    However there are issues in current implementation:
    
    1. Process not terminated if invalid user pointer passed:
       i.e. __get_user() failed.
    
    2. The reason for this patch was __put_user() failure not being handled
       either, specifically for the COW break scenario.
       The zero page is initially wired up and read from __get_user()
       succeeds. A subsequent write by __put_user() induces a
       Protection Violation, but COW can't finish as Linux page fault
       handler is disabled due to preempt disable.
       And what's worse is we silently return the stale value to user space.
       Fix this specific case by re-enabling preemption and explicitly
       fixing up the fault and retrying the whole sequence over.
    
    Cc: Max Filippov <jcmvbkbc@gmail.com>
    Cc: linux-arch@vger.kernel.org
    Signed-off-by: Alexey Brodkin <abrodkin@synopsys.com>
    Signed-off-by: Peter Zijlstra <peterz@infradead.org>
    Signed-off-by: Vineet Gupta <vgupta@synopsys.com>
    [vgupta: rewrote the changelog]
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e653e79ace50feb02030b5d4728e282c839c24fc
Author: Andrey Ryabinin <aryabinin@virtuozzo.com>
Date:   Fri Jul 6 16:38:53 2018 +0300

    netfilter: nf_conntrack: Fix possible possible crash on module loading.
    
    [ Upstream commit 2045cdfa1b40d66f126f3fd05604fc7c754f0022 ]
    
    Loading the nf_conntrack module with doubled hashsize parameter, i.e.
              modprobe nf_conntrack hashsize=12345 hashsize=12345
    causes NULL-ptr deref.
    
    If 'hashsize' specified twice, the nf_conntrack_set_hashsize() function
    will be called also twice.
    The first nf_conntrack_set_hashsize() call will set the
    'nf_conntrack_htable_size' variable:
    
            nf_conntrack_set_hashsize()
                    ...
                    /* On boot, we can set this without any fancy locking. */
                    if (!nf_conntrack_htable_size)
                            return param_set_uint(val, kp);
    
    But on the second invocation, the nf_conntrack_htable_size is already set,
    so the nf_conntrack_set_hashsize() will take a different path and call
    the nf_conntrack_hash_resize() function. Which will crash on the attempt
    to dereference 'nf_conntrack_hash' pointer:
    
            BUG: unable to handle kernel NULL pointer dereference at 0000000000000000
            RIP: 0010:nf_conntrack_hash_resize+0x255/0x490 [nf_conntrack]
            Call Trace:
             nf_conntrack_set_hashsize+0xcd/0x100 [nf_conntrack]
             parse_args+0x1f9/0x5a0
             load_module+0x1281/0x1a50
             __se_sys_finit_module+0xbe/0xf0
             do_syscall_64+0x7c/0x390
             entry_SYSCALL_64_after_hwframe+0x49/0xbe
    
    Fix this, by checking !nf_conntrack_hash instead of
    !nf_conntrack_htable_size. nf_conntrack_hash will be initialized only
    after the module loaded, so the second invocation of the
    nf_conntrack_set_hashsize() won't crash, it will just reinitialize
    nf_conntrack_htable_size again.
    
    Signed-off-by: Andrey Ryabinin <aryabinin@virtuozzo.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a76e62b50dc0fb869a5371448395700eb3d31bd3
Author: Florian Westphal <fw@strlen.de>
Date:   Fri Jul 6 20:06:05 2018 +0200

    netfilter: nft_compat: explicitly reject ERROR and standard target
    
    [ Upstream commit 21d5e078192d244df3d6049f9464fff2f72cfd68 ]
    
    iptables-nft never requests these, but make this explicitly illegal.
    If it were quested, kernel could oops as ->eval is NULL, furthermore,
    the builtin targets have no owning module so its possible to rmmod
    eb/ip/ip6_tables module even if they would be loaded.
    
    Signed-off-by: Florian Westphal <fw@strlen.de>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit afd13311ee014d52b2d1ca9c452a157b836d987f
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Tue Jun 26 17:06:06 2018 +0100

    drm/armada: fix irq handling
    
    [ Upstream commit 92298c1cd8e8a6b56322b602ad72b54e6237631d ]
    
    Add the missing locks to the IRQ enable/disable paths, and fix a comment
    in the interrupt handler: reading the ISR clears down the status bits,
    but does not reset the interrupt so it can signal again.  That seems to
    require a write.
    
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3d211fefdd52a717e91b5f50fa578c810a2c2596
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Sun Jun 24 14:35:10 2018 +0100

    drm/armada: fix colorkey mode property
    
    [ Upstream commit d378859a667edc99e3473704847698cae97ca2b1 ]
    
    The colorkey mode property was not correctly disabling the colorkeying
    when "disabled" mode was selected.  Arrange for this to work as one
    would expect.
    
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f2cbde943d9797f49ff484408e1edb4fd9bccaae
Author: Mikko Perttunen <mperttunen@nvidia.com>
Date:   Wed Jun 20 16:03:58 2018 +0300

    drm/tegra: Fix comparison operator for buffer size
    
    [ Upstream commit 5265f0338bc0feec6c0d544dfe005dec1a93cb93 ]
    
    Here we are checking for the buffer length, not an offset for writing
    to, so using > is correct. The current code incorrectly rejects a
    command buffer ending at the memory buffer's end.
    
    Signed-off-by: Mikko Perttunen <mperttunen@nvidia.com>
    Reviewed-by: Dmitry Osipenko <digetx@gmail.com>
    Signed-off-by: Thierry Reding <treding@nvidia.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d3f205d2d3cdbd57b67a16b0dcd197bcf19e6111
Author: Dmitry Osipenko <digetx@gmail.com>
Date:   Fri Jul 6 21:02:36 2018 +0300

    gpu: host1x: Check whether size of unpin isn't 0
    
    [ Upstream commit ec58923215dbbeef59ee82923ee94d745f73db58 ]
    
    Only gather pins are mapped by the Host1x driver, regular BO relocations
    are not. Check whether size of unpin isn't 0, otherwise IOVA allocation at
    0x0 could be erroneously released.
    
    Signed-off-by: Dmitry Osipenko <digetx@gmail.com>
    Signed-off-by: Thierry Reding <treding@nvidia.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1b57c5876c08fa8b6a79165ed99ddd1cc1f2438f
Author: Stefan Schmidt <stefan@datenfreihafen.org>
Date:   Fri Sep 22 14:14:05 2017 +0200

    ieee802154: fakelb: switch from BUG_ON() to WARN_ON() on problem
    
    [ Upstream commit 8f2fbc6c60ff213369e06a73610fc882a42fdf20 ]
    
    The check is valid but it does not warrant to crash the kernel. A
    WARN_ON() is good enough here.
    Found by checkpatch.
    
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c1f84e47ec2621b806e6f268f8f5a889b43b3186
Author: Stefan Schmidt <stefan@datenfreihafen.org>
Date:   Fri Sep 22 14:13:54 2017 +0200

    ieee802154: at86rf230: use __func__ macro for debug messages
    
    [ Upstream commit 8a81388ec27c4c0adbdecd20e67bb5f411ab46b2 ]
    
    Instead of having the function name hard-coded (it might change and we
    forgot to update them in the debug output) we can use __func__ instead
    and also shorter the line so we do not need to break it. Also fix an
    extra blank line while being here.
    Found by checkpatch.
    
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 68e70bc28d53a4b09dd7bc1fab2df911dd284bd8
Author: Stefan Schmidt <stefan@datenfreihafen.org>
Date:   Fri Sep 22 14:13:53 2017 +0200

    ieee802154: at86rf230: switch from BUG_ON() to WARN_ON() on problem
    
    [ Upstream commit 20f330452ad8814f2289a589baf65e21270879a7 ]
    
    The check is valid but it does not warrant to crash the kernel. A
    WARN_ON() is good enough here.
    Found by checkpatch.
    
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1b8f1ab088baa4cb29c1373d529955786be8fdc1
Author: Douglas Anderson <dianders@chromium.org>
Date:   Mon Jun 18 18:30:43 2018 +0100

    nvmem: Don't let a NULL cell_id for nvmem_cell_get() crash us
    
    [ Upstream commit 87ed1405ef09d29a14df43295f7b6a93b63bfe6e ]
    
    In commit ca04d9d3e1b1 ("phy: qcom-qusb2: New driver for QUSB2 PHY on
    Qcom chips") you can see a call like:
    
      devm_nvmem_cell_get(dev, NULL);
    
    Note that the cell ID passed to the function is NULL.  This is because
    the qcom-qusb2 driver is expected to work only on systems where the
    PHY node is hooked up via device-tree and is nameless.
    
    This works OK for the most part.  The first thing nvmem_cell_get()
    does is to call of_nvmem_cell_get() and there it's documented that a
    NULL name is fine.  The problem happens when the call to
    of_nvmem_cell_get() returns -EINVAL.  In such a case we'll fall back
    to nvmem_cell_get_from_list() and eventually might (if nvmem_cells
    isn't an empty list) crash with something that looks like:
    
     strcmp
     nvmem_find_cell
     __nvmem_device_get
     nvmem_cell_get_from_list
     nvmem_cell_get
     devm_nvmem_cell_get
     qusb2_phy_probe
    
    There are several different ways we could fix this problem:
    
    One could argue that perhaps the qcom-qusb2 driver should be changed
    to use of_nvmem_cell_get() which is allowed to have a NULL name.  In
    that case, we'd need to add a patche to introduce
    devm_of_nvmem_cell_get() since the qcom-qusb2 driver is using devm
    managed resources.
    
    One could also argue that perhaps we could just add a name to
    qcom-qusb2.  That would be OK but I believe it effectively changes the
    device tree bindings, so maybe it's a no-go.
    
    In this patch I have chosen to fix the problem by simply not crashing
    when a NULL cell_id is passed to nvmem_cell_get().
    
    NOTE: that for the qcom-qusb2 driver the "nvmem-cells" property is
    defined to be optional and thus it's expected to be a common case that
    we would hit this crash and this is more than just a theoretical fix.
    
    Fixes: ca04d9d3e1b1 ("phy: qcom-qusb2: New driver for QUSB2 PHY on Qcom chips")
    Signed-off-by: Douglas Anderson <dianders@chromium.org>
    Signed-off-by: Srinivas Kandagatla <srinivas.kandagatla@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit de9f2452b1ad4e223b305618df8fa2b7312d8488
Author: Davide Caratti <dcaratti@redhat.com>
Date:   Fri Jul 6 21:01:06 2018 +0200

    net/sched: act_tunnel_key: fix NULL dereference when 'goto chain' is used
    
    [ Upstream commit 38230a3e0e0933bbcf5df6fa469ba0667f667568 ]
    
    the control action in the common member of struct tcf_tunnel_key must be a
    valid value, as it can contain the chain index when 'goto chain' is used.
    Ensure that the control action can be read as x->tcfa_action, when x is a
    pointer to struct tc_action and x->ops->type is TCA_ACT_TUNNEL_KEY, to
    prevent the following command:
    
     # tc filter add dev $h2 ingress protocol ip pref 1 handle 101 flower \
     > $tcflags dst_mac $h2mac action tunnel_key unset goto chain 1
    
    from causing a NULL dereference when a matching packet is received:
    
     BUG: unable to handle kernel NULL pointer dereference at 0000000000000000
     PGD 80000001097ac067 P4D 80000001097ac067 PUD 103b0a067 PMD 0
     Oops: 0000 [#1] SMP PTI
     CPU: 0 PID: 3491 Comm: mausezahn Tainted: G            E     4.18.0-rc2.auguri+ #421
     Hardware name: Hewlett-Packard HP Z220 CMT Workstation/1790, BIOS K51 v01.58 02/07/2013
     RIP: 0010:tcf_action_exec+0xb8/0x100
     Code: 00 00 00 20 74 1d 83 f8 03 75 09 49 83 c4 08 4d 39 ec 75 bc 48 83 c4 10 5b 5d 41 5c 41 5d 41 5e 41 5f c3 49 8b 97 a8 00 00 00 <48> 8b 12 48 89 55 00 48 83 c4 10 5b 5d 41 5c 41 5d 41 5e 41 5f c3
     RSP: 0018:ffff95145ea03c40 EFLAGS: 00010246
     RAX: 0000000020000001 RBX: ffff9514499e5800 RCX: 0000000000000001
     RDX: 0000000000000000 RSI: 0000000000000002 RDI: 0000000000000000
     RBP: ffff95145ea03e60 R08: 0000000000000000 R09: ffff95145ea03c9c
     R10: ffff95145ea03c78 R11: 0000000000000008 R12: ffff951456a69800
     R13: ffff951456a69808 R14: 0000000000000001 R15: ffff95144965ee40
     FS:  00007fd67ee11740(0000) GS:ffff95145ea00000(0000) knlGS:0000000000000000
     CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
     CR2: 0000000000000000 CR3: 00000001038a2006 CR4: 00000000001606f0
     Call Trace:
      <IRQ>
      fl_classify+0x1ad/0x1c0 [cls_flower]
      ? __update_load_avg_se.isra.47+0x1ca/0x1d0
      ? __update_load_avg_se.isra.47+0x1ca/0x1d0
      ? update_load_avg+0x665/0x690
      ? update_load_avg+0x665/0x690
      ? kmem_cache_alloc+0x38/0x1c0
      tcf_classify+0x89/0x140
      __netif_receive_skb_core+0x5ea/0xb70
      ? enqueue_entity+0xd0/0x270
      ? process_backlog+0x97/0x150
      process_backlog+0x97/0x150
      net_rx_action+0x14b/0x3e0
      __do_softirq+0xde/0x2b4
      do_softirq_own_stack+0x2a/0x40
      </IRQ>
      do_softirq.part.18+0x49/0x50
      __local_bh_enable_ip+0x49/0x50
      __dev_queue_xmit+0x4ab/0x8a0
      ? wait_woken+0x80/0x80
      ? packet_sendmsg+0x38f/0x810
      ? __dev_queue_xmit+0x8a0/0x8a0
      packet_sendmsg+0x38f/0x810
      sock_sendmsg+0x36/0x40
      __sys_sendto+0x10e/0x140
      ? do_vfs_ioctl+0xa4/0x630
      ? syscall_trace_enter+0x1df/0x2e0
      ? __audit_syscall_exit+0x22a/0x290
      __x64_sys_sendto+0x24/0x30
      do_syscall_64+0x5b/0x180
      entry_SYSCALL_64_after_hwframe+0x44/0xa9
     RIP: 0033:0x7fd67e18dc93
     Code: 48 8b 0d 18 83 20 00 f7 d8 64 89 01 48 83 c8 ff c3 66 0f 1f 44 00 00 83 3d 59 c7 20 00 00 75 13 49 89 ca b8 2c 00 00 00 0f 05 <48> 3d 01 f0 ff ff 73 34 c3 48 83 ec 08 e8 2b f7 ff ff 48 89 04 24
     RSP: 002b:00007ffe0189b748 EFLAGS: 00000246 ORIG_RAX: 000000000000002c
     RAX: ffffffffffffffda RBX: 00000000020ca010 RCX: 00007fd67e18dc93
     RDX: 0000000000000062 RSI: 00000000020ca322 RDI: 0000000000000003
     RBP: 00007ffe0189b780 R08: 00007ffe0189b760 R09: 0000000000000014
     R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000062
     R13: 00000000020ca322 R14: 00007ffe0189b760 R15: 0000000000000003
     Modules linked in: act_tunnel_key act_gact cls_flower sch_ingress vrf veth act_csum(E) xt_CHECKSUM iptable_mangle ipt_MASQUERADE iptable_nat nf_nat_ipv4 nf_nat nf_conntrack_ipv4 nf_defrag_ipv4 xt_conntrack nf_conntrack ipt_REJECT nf_reject_ipv4 tun bridge stp llc ebtable_filter ebtables ip6table_filter ip6_tables iptable_filter intel_rapl snd_hda_codec_hdmi x86_pkg_temp_thermal intel_powerclamp snd_hda_codec_realtek coretemp snd_hda_codec_generic kvm_intel kvm irqbypass snd_hda_intel crct10dif_pclmul crc32_pclmul hp_wmi ghash_clmulni_intel pcbc snd_hda_codec aesni_intel sparse_keymap rfkill snd_hda_core snd_hwdep snd_seq crypto_simd iTCO_wdt gpio_ich iTCO_vendor_support wmi_bmof cryptd mei_wdt glue_helper snd_seq_device snd_pcm pcspkr snd_timer snd i2c_i801 lpc_ich sg soundcore wmi mei_me
      mei ie31200_edac nfsd auth_rpcgss nfs_acl lockd grace sunrpc ip_tables xfs libcrc32c sd_mod sr_mod cdrom i915 video i2c_algo_bit drm_kms_helper syscopyarea sysfillrect sysimgblt fb_sys_fops ahci crc32c_intel libahci serio_raw sfc libata mtd drm ixgbe mdio i2c_core e1000e dca
     CR2: 0000000000000000
     ---[ end trace 1ab8b5b5d4639dfc ]---
     RIP: 0010:tcf_action_exec+0xb8/0x100
     Code: 00 00 00 20 74 1d 83 f8 03 75 09 49 83 c4 08 4d 39 ec 75 bc 48 83 c4 10 5b 5d 41 5c 41 5d 41 5e 41 5f c3 49 8b 97 a8 00 00 00 <48> 8b 12 48 89 55 00 48 83 c4 10 5b 5d 41 5c 41 5d 41 5e 41 5f c3
     RSP: 0018:ffff95145ea03c40 EFLAGS: 00010246
     RAX: 0000000020000001 RBX: ffff9514499e5800 RCX: 0000000000000001
     RDX: 0000000000000000 RSI: 0000000000000002 RDI: 0000000000000000
     RBP: ffff95145ea03e60 R08: 0000000000000000 R09: ffff95145ea03c9c
     R10: ffff95145ea03c78 R11: 0000000000000008 R12: ffff951456a69800
     R13: ffff951456a69808 R14: 0000000000000001 R15: ffff95144965ee40
     FS:  00007fd67ee11740(0000) GS:ffff95145ea00000(0000) knlGS:0000000000000000
     CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
     CR2: 0000000000000000 CR3: 00000001038a2006 CR4: 00000000001606f0
     Kernel panic - not syncing: Fatal exception in interrupt
     Kernel Offset: 0x11400000 from 0xffffffff81000000 (relocation range: 0xffffffff80000000-0xffffffffbfffffff)
     ---[ end Kernel panic - not syncing: Fatal exception in interrupt ]---
    
    Fixes: d0f6dd8a914f ("net/sched: Introduce act_tunnel_key")
    Signed-off-by: Davide Caratti <dcaratti@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 431f0995a5e86727f69a7fc53007a00fc5ef088d
Author: Daniel Mack <daniel@zonque.org>
Date:   Fri Jul 6 22:15:00 2018 +0200

    ARM: pxa: irq: fix handling of ICMR registers in suspend/resume
    
    [ Upstream commit 0c1049dcb4ceec640d8bd797335bcbebdcab44d2 ]
    
    PXA3xx platforms have 56 interrupts that are stored in two ICMR
    registers. The code in pxa_irq_suspend() and pxa_irq_resume() however
    does a simple division by 32 which only leads to one register being
    saved at suspend and restored at resume time. The NAND interrupt
    setting, for instance, is lost.
    
    Fix this by using DIV_ROUND_UP() instead.
    
    Signed-off-by: Daniel Mack <daniel@zonque.org>
    Signed-off-by: Robert Jarzmik <robert.jarzmik@free.fr>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 924d13694a13bf1c6be9a4df744ae2fcfcb1fa71
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Wed Jul 4 11:14:51 2018 +0300

    ravb: fix invalid context bug while changing link options by ethtool
    
    [ Upstream commit 05925e52a7d379192a5fdff2c33710f573190ead ]
    
    The change fixes sleep in atomic context bug, which is encountered
    every time when link settings are changed by ethtool.
    
    Since commit 35b5f6b1a82b ("PHYLIB: Locking fixes for PHY I/O
    potentially sleeping") phy_start_aneg() function utilizes a mutex
    to serialize changes to phy state, however that helper function is
    called in atomic context under a grabbed spinlock, because
    phy_start_aneg() is called by phy_ethtool_ksettings_set() and by
    replaced phy_ethtool_sset() helpers from phylib.
    
    Now duplex mode setting is enforced in ravb_adjust_link() only, also
    now RX/TX is disabled when link is put down or modifications to E-MAC
    registers ECMR and GECMR are expected for both cases of checked and
    ignored link status pin state from E-MAC interrupt handler.
    
    Fixes: c156633f1353 ("Renesas Ethernet AVB driver proper")
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Reviewed-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1465aba3428dc13c9f34607e80ec0b0b9f309c95
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Wed Jul 4 11:14:50 2018 +0300

    ravb: fix invalid context bug while calling auto-negotiation by ethtool
    
    [ Upstream commit 0973a4dd79fe56a3beecfcff675ba4c01df0b0c1 ]
    
    Since commit 35b5f6b1a82b ("PHYLIB: Locking fixes for PHY I/O
    potentially sleeping") phy_start_aneg() function utilizes a mutex
    to serialize changes to phy state, however the helper function is
    called in atomic context.
    
    The bug can be reproduced by running "ethtool -r" command, the bug
    is reported if CONFIG_DEBUG_ATOMIC_SLEEP build option is enabled.
    
    Fixes: c156633f1353 ("Renesas Ethernet AVB driver proper")
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Reviewed-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7947dc71b9ded5d01fda11580fe540c7fee45278
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Wed Jul 4 11:12:40 2018 +0300

    sh_eth: fix invalid context bug while changing link options by ethtool
    
    [ Upstream commit 5cb3f52a11e18628fc4bee76dd14b1f0b76349de ]
    
    The change fixes sleep in atomic context bug, which is encountered
    every time when link settings are changed by ethtool.
    
    Since commit 35b5f6b1a82b ("PHYLIB: Locking fixes for PHY I/O
    potentially sleeping") phy_start_aneg() function utilizes a mutex
    to serialize changes to phy state, however that helper function is
    called in atomic context under a grabbed spinlock, because
    phy_start_aneg() is called by phy_ethtool_ksettings_set() and by
    replaced phy_ethtool_sset() helpers from phylib.
    
    Now duplex mode setting is enforced in sh_eth_adjust_link() only,
    also now RX/TX is disabled when link is put down or modifications
    to E-MAC registers ECMR and GECMR are expected for both cases of
    checked and ignored link status pin state from E-MAC interrupt handler.
    
    For reference the change is a partial rework of commit 1e1b812bbe10
    ("sh_eth: fix handling of no LINK signal").
    
    Fixes: dc19e4e5e02f ("sh: sh_eth: Add support ethtool")
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Reviewed-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 533b9559ff83a986236c62cbb1b439b0b52ff963
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Wed Jul 4 11:12:39 2018 +0300

    sh_eth: fix invalid context bug while calling auto-negotiation by ethtool
    
    [ Upstream commit 53a710b5044d8475faa6813000b6dd659400ef7b ]
    
    Since commit 35b5f6b1a82b ("PHYLIB: Locking fixes for PHY I/O
    potentially sleeping") phy_start_aneg() function utilizes a mutex
    to serialize changes to phy state, however the helper function is
    called in atomic context.
    
    The bug can be reproduced by running "ethtool -r" command, the bug
    is reported if CONFIG_DEBUG_ATOMIC_SLEEP build option is enabled.
    
    Fixes: dc19e4e5e02f ("sh: sh_eth: Add support ethtool")
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Reviewed-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5860ae76e018bddbda89b98da4a12e7ae20b38cd
Author: Arun Kumar Neelakantam <aneela@codeaurora.org>
Date:   Wed Jul 4 19:49:32 2018 +0530

    net: qrtr: Broadcast messages only from control port
    
    [ Upstream commit fdf5fd3975666804118e62c69de25dc85cc0909c ]
    
    The broadcast node id should only be sent with the control port id.
    
    Signed-off-by: Arun Kumar Neelakantam <aneela@codeaurora.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8e39e96f23d8fe5a6114e43ff80e5852ab11e3c9
Author: Paul Moore <paul@paul-moore.com>
Date:   Wed Jul 4 09:58:05 2018 -0400

    ipv6: make ipv6_renew_options() interrupt/kernel safe
    
    [ Upstream commit a9ba23d48dbc6ffd08426bb10f05720e0b9f5c14 ]
    
    At present the ipv6_renew_options_kern() function ends up calling into
    access_ok() which is problematic if done from inside an interrupt as
    access_ok() calls WARN_ON_IN_IRQ() on some (all?) architectures
    (x86-64 is affected).  Example warning/backtrace is shown below:
    
     WARNING: CPU: 1 PID: 3144 at lib/usercopy.c:11 _copy_from_user+0x85/0x90
     ...
     Call Trace:
      <IRQ>
      ipv6_renew_option+0xb2/0xf0
      ipv6_renew_options+0x26a/0x340
      ipv6_renew_options_kern+0x2c/0x40
      calipso_req_setattr+0x72/0xe0
      netlbl_req_setattr+0x126/0x1b0
      selinux_netlbl_inet_conn_request+0x80/0x100
      selinux_inet_conn_request+0x6d/0xb0
      security_inet_conn_request+0x32/0x50
      tcp_conn_request+0x35f/0xe00
      ? __lock_acquire+0x250/0x16c0
      ? selinux_socket_sock_rcv_skb+0x1ae/0x210
      ? tcp_rcv_state_process+0x289/0x106b
      tcp_rcv_state_process+0x289/0x106b
      ? tcp_v6_do_rcv+0x1a7/0x3c0
      tcp_v6_do_rcv+0x1a7/0x3c0
      tcp_v6_rcv+0xc82/0xcf0
      ip6_input_finish+0x10d/0x690
      ip6_input+0x45/0x1e0
      ? ip6_rcv_finish+0x1d0/0x1d0
      ipv6_rcv+0x32b/0x880
      ? ip6_make_skb+0x1e0/0x1e0
      __netif_receive_skb_core+0x6f2/0xdf0
      ? process_backlog+0x85/0x250
      ? process_backlog+0x85/0x250
      ? process_backlog+0xec/0x250
      process_backlog+0xec/0x250
      net_rx_action+0x153/0x480
      __do_softirq+0xd9/0x4f7
      do_softirq_own_stack+0x2a/0x40
      </IRQ>
      ...
    
    While not present in the backtrace, ipv6_renew_option() ends up calling
    access_ok() via the following chain:
    
      access_ok()
      _copy_from_user()
      copy_from_user()
      ipv6_renew_option()
    
    The fix presented in this patch is to perform the userspace copy
    earlier in the call chain such that it is only called when the option
    data is actually coming from userspace; that place is
    do_ipv6_setsockopt().  Not only does this solve the problem seen in
    the backtrace above, it also allows us to simplify the code quite a
    bit by removing ipv6_renew_options_kern() completely.  We also take
    this opportunity to cleanup ipv6_renew_options()/ipv6_renew_option()
    a small amount as well.
    
    This patch is heavily based on a rough patch by Al Viro.  I've taken
    his original patch, converted a kmemdup() call in do_ipv6_setsockopt()
    to a memdup_user() call, made better use of the e_inval jump target in
    the same function, and cleaned up the use ipv6_renew_option() by
    ipv6_renew_options().
    
    CC: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Paul Moore <paul@paul-moore.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 365279b70bf3fd458cfe1d44d0f2c220cff5c362
Author: Florian Westphal <fw@strlen.de>
Date:   Wed Jul 4 20:25:32 2018 +0200

    netfilter: x_tables: set module owner for icmp(6) matches
    
    [ Upstream commit d376bef9c29b3c65aeee4e785fffcd97ef0a9a81 ]
    
    nft_compat relies on xt_request_find_match to increment
    refcount of the module that provides the match/target.
    
    The (builtin) icmp matches did't set the module owner so it
    was possible to rmmod ip(6)tables while icmp extensions were still in use.
    
    Signed-off-by: Florian Westphal <fw@strlen.de>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2d0da218864349100c33ed71336a7211e37d64a8
Author: Lubomir Rintel <lkundrak@v3.sk>
Date:   Mon Jul 2 11:21:47 2018 +0200

    ieee802154: 6lowpan: set IFLA_LINK
    
    [ Upstream commit b30c122c0bbb0a1dc413085e177ea09467e65fdb ]
    
    Otherwise NetworkManager (and iproute alike) is not able to identify the
    parent IEEE 802.15.4 interface of a 6LoWPAN link.
    
    Signed-off-by: Lubomir Rintel <lkundrak@v3.sk>
    Acked-by: Alexander Aring <aring@mojatatu.com>
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f599525df7f1b14bed0da75cd6065cb1742a74ff
Author: Taeung Song <treeze.taeung@gmail.com>
Date:   Wed Jul 4 22:36:38 2018 +0900

    samples/bpf: Check the error of write() and read()
    
    [ Upstream commit 02a2f000a3629274bfad60bfc4de9edec49e63e7 ]
    
    test_task_rename() and test_urandom_read()
    can be failed during write() and read(),
    So check the result of them.
    
    Reviewed-by: David Laight <David.Laight@ACULAB.COM>
    Signed-off-by: Taeung Song <treeze.taeung@gmail.com>
    Acked-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3bbb0484a7317707243306352ad5457f64104d68
Author: Taeung Song <treeze.taeung@gmail.com>
Date:   Wed Jul 4 22:36:37 2018 +0900

    samples/bpf: Check the result of system()
    
    [ Upstream commit 492b7e894587c151be681f86d4d1d086375f7b45 ]
    
    To avoid the below build warning message,
    use new generate_load() checking the return value.
    
      ignoring return value of ‘system’, declared with attribute warn_unused_result
    
    And it also refactors the duplicate code of both
    test_perf_event_all_cpu() and test_perf_event_task()
    
    Cc: Teng Qin <qinteng@fb.com>
    Signed-off-by: Taeung Song <treeze.taeung@gmail.com>
    Acked-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2b533daef882f7ac6faa46e6e0e47589df1b8e7f
Author: Taeung Song <treeze.taeung@gmail.com>
Date:   Wed Jul 4 22:36:36 2018 +0900

    samples/bpf: add missing <linux/if_vlan.h>
    
    [ Upstream commit 4d5d33a085335ef469c9a87792bcaaaa8e64d8c4 ]
    
    This fixes build error regarding redefinition:
    
        CLANG-bpf  samples/bpf/parse_varlen.o
      samples/bpf/parse_varlen.c:111:8: error: redefinition of 'vlan_hdr'
      struct vlan_hdr {
             ^
      ./include/linux/if_vlan.h:38:8: note: previous definition is here
    
    So remove duplicate 'struct vlan_hdr' in sample code and include if_vlan.h
    
    Signed-off-by: Taeung Song <treeze.taeung@gmail.com>
    Acked-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bf030b2faacbc740170e33e1281ef2f96decc2a7
Author: Maciej Purski <m.purski@samsung.com>
Date:   Thu Jun 28 18:44:02 2018 +0200

    drm/bridge/sii8620: Fix display of packed pixel modes
    
    [ Upstream commit fdddc65ab35d575b42aab411b2dc687601eab680 ]
    
    Current implementation does not guarantee packed pixel modes working
    with every dongle. There are some dongles, which require selecting
    the output mode explicitly.
    
    Write proper values to registers in packed_pixel mode, based on how it
    is done in vendor's code. Select output color space: RGB
    (no packed pixel) or YCBCR422 (packed pixel).
    
    This reverts commit e8b92efa629dac0e70ea4145c5e70616de5f89c8
    ("drm/bridge/sii8620: fix display of packed pixel modes in MHL2").
    
    Signed-off-by: Maciej Purski <m.purski@samsung.com>
    Signed-off-by: Andrzej Hajda <a.hajda@samsung.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/1530204243-6370-3-git-send-email-m.purski@samsung.com
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5996929435a8418dc1e633d44c13e83383c019d5
Author: Yuiko Oshino <yuiko.oshino@microchip.com>
Date:   Tue Jul 3 11:21:46 2018 -0400

    smsc75xx: Add workaround for gigabit link up hardware errata.
    
    [ Upstream commit d461e3da905332189aad546b2ad9adbe6071c7cc ]
    
    In certain conditions, the device may not be able to link in gigabit mode. This software workaround ensures that the device will not enter the failure state.
    
    Fixes: d0cad871703b898a442e4049c532ec39168e5b57 ("SMSC75XX USB 2.0 Gigabit Ethernet Devices")
    Signed-off-by: Yuiko Oshino <yuiko.oshino@microchip.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6e7084e2c3f9fe203eeab3b0f053b99f830afd71
Author: Zhen Lei <thunder.leizhen@huawei.com>
Date:   Tue Jul 3 17:02:46 2018 -0700

    kasan: fix shadow_size calculation error in kasan_module_alloc
    
    [ Upstream commit 1e8e18f694a52d703665012ca486826f64bac29d ]
    
    There is a special case that the size is "(N << KASAN_SHADOW_SCALE_SHIFT)
    Pages plus X", the value of X is [1, KASAN_SHADOW_SCALE_SIZE-1].  The
    operation "size >> KASAN_SHADOW_SCALE_SHIFT" will drop X, and the
    roundup operation can not retrieve the missed one page.  For example:
    size=0x28006, PAGE_SIZE=0x1000, KASAN_SHADOW_SCALE_SHIFT=3, we will get
    shadow_size=0x5000, but actually we need 6 pages.
    
      shadow_size = round_up(size >> KASAN_SHADOW_SCALE_SHIFT, PAGE_SIZE);
    
    This can lead to a kernel crash when kasan is enabled and the value of
    mod->core_layout.size or mod->init_layout.size is like above.  Because
    the shadow memory of X has not been allocated and mapped.
    
    move_module:
      ptr = module_alloc(mod->core_layout.size);
      ...
      memset(ptr, 0, mod->core_layout.size);                //crashed
    
      Unable to handle kernel paging request at virtual address ffff0fffff97b000
      ......
      Call trace:
        __asan_storeN+0x174/0x1a8
        memset+0x24/0x48
        layout_and_allocate+0xcd8/0x1800
        load_module+0x190/0x23e8
        SyS_finit_module+0x148/0x180
    
    Link: http://lkml.kernel.org/r/1529659626-12660-1-git-send-email-thunder.leizhen@huawei.com
    Signed-off-by: Zhen Lei <thunder.leizhen@huawei.com>
    Reviewed-by: Dmitriy Vyukov <dvyukov@google.com>
    Acked-by: Andrey Ryabinin <aryabinin@virtuozzo.com>
    Cc: Alexander Potapenko <glider@google.com>
    Cc: Hanjun Guo <guohanjun@huawei.com>
    Cc: Libin <huawei.libin@huawei.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 017fe62bb794a2d6f339b4d76ae58ac2d0349228
Author: Mathieu Malaterre <malat@debian.org>
Date:   Thu Mar 8 21:58:43 2018 +0100

    tracing: Use __printf markup to silence compiler
    
    [ Upstream commit 26b68dd2f48fe7699a89f0cfbb9f4a650dc1c837 ]
    
    Silence warnings (triggered at W=1) by adding relevant __printf attributes.
    
      CC      kernel/trace/trace.o
    kernel/trace/trace.c: In function ‘__trace_array_vprintk’:
    kernel/trace/trace.c:2979:2: warning: function might be possible candidate for ‘gnu_printf’ format attribute [-Wsuggest-attribute=format]
      len = vscnprintf(tbuffer, TRACE_BUF_SIZE, fmt, args);
      ^~~
      AR      kernel/trace/built-in.o
    
    Link: http://lkml.kernel.org/r/20180308205843.27447-1-malat@debian.org
    
    Signed-off-by: Mathieu Malaterre <malat@debian.org>
    Signed-off-by: Steven Rostedt (VMware) <rostedt@goodmis.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 56f059c87bc6ee42f07b5dfd633daf60e98f2679
Author: Mauricio Vasquez B <mauricio.vasquez@polito.it>
Date:   Fri Jun 29 14:48:20 2018 +0200

    bpf: hash map: decrement counter on error
    
    [ Upstream commit ed2b82c03dc187018307c7c6bf9299705f3db383 ]
    
    Decrement the number of elements in the map in case the allocation
    of a new node fails.
    
    Fixes: 6c9059817432 ("bpf: pre-allocate hash map elements")
    Signed-off-by: Mauricio Vasquez B <mauricio.vasquez@polito.it>
    Acked-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fa97c916277941e139d08191ccdb2152534ee648
Author: Fabio Estevam <fabio.estevam@nxp.com>
Date:   Tue Jun 26 08:37:09 2018 -0300

    ARM: imx_v4_v5_defconfig: Select ULPI support
    
    [ Upstream commit 2ceb2780b790b74bc408a949f6aedbad8afa693e ]
    
    Select CONFIG_USB_CHIPIDEA_ULPI and CONFIG_USB_ULPI_BUS so that
    USB ULPI can be functional on some boards like that use ULPI
    interface.
    
    Signed-off-by: Fabio Estevam <fabio.estevam@nxp.com>
    Signed-off-by: Shawn Guo <shawnguo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2059e527a659cf16d6bb709f1c8509f7a7623fc4
Author: Fabio Estevam <fabio.estevam@nxp.com>
Date:   Mon Jun 25 09:34:03 2018 -0300

    ARM: imx_v6_v7_defconfig: Select ULPI support
    
    [ Upstream commit 157bcc06094c3c5800d3f4676527047b79b618e7 ]
    
    Select CONFIG_USB_CHIPIDEA_ULPI and CONFIG_USB_ULPI_BUS so that
    USB ULPI can be functional on some boards like imx51-babbge.
    
    This fixes a kernel hang in 4.18-rc1 on i.mx51-babbage, caused by commit
    03e6275ae381 ("usb: chipidea: Fix ULPI on imx51").
    
    Suggested-by: Andrey Smirnov <andrew.smirnov@gmail.com>
    Signed-off-by: Fabio Estevam <fabio.estevam@nxp.com>
    Signed-off-by: Shawn Guo <shawnguo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2aebd462a5fd0ae1bf0f08f3b01e48066c5489d8
Author: Jason Gerecke <killertofu@gmail.com>
Date:   Tue Jun 26 09:58:02 2018 -0700

    HID: wacom: Correct touch maximum XY of 2nd-gen Intuos
    
    [ Upstream commit 3b8d573586d1b9dee33edf6cb6f2ca05f4bca568 ]
    
    The touch sensors on the 2nd-gen Intuos tablets don't use a 4096x4096
    sensor like other similar tablets (3rd-gen Bamboo, Intuos5, etc.).
    The incorrect maximum XY values don't normally affect userspace since
    touch input from these devices is typically relative rather than
    absolute. It does, however, cause problems when absolute distances
    need to be measured, e.g. for gesture recognition. Since the resolution
    of the touch sensor on these devices is 10 units / mm (versus 100 for
    the pen sensor), the proper maximum values can be calculated by simply
    dividing by 10.
    
    Fixes: b5fd2a3e92 ("Input: wacom - add support for three new Intuos devices")
    Signed-off-by: Jason Gerecke <jason.gerecke@wacom.com>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 979c7c0dd75da54f6e336536c8e3cc4717ec67d7
Author: Zhenzhong Duan <zhenzhong.duan@oracle.com>
Date:   Mon Jul 2 23:49:54 2018 -0700

    x86/mm/32: Initialize the CR4 shadow before __flush_tlb_all()
    
    [ Upstream commit 4fb5f58e8d191f7c81637ad81284e4848afb4244 ]
    
    On 32-bit kernels, __flush_tlb_all() may have read the CR4 shadow before the
    initialization of CR4 shadow in cpu_init().
    
    Fix it by adding an explicit cr4_init_shadow() call into start_secondary()
    which is the first function called on non-boot SMP CPUs - ahead of the
    __flush_tlb_all() call.
    
    ( This is somewhat of a layering violation, but start_secondary() does
      CR4 bootstrap in the PCID case anyway. )
    
    Signed-off-by: Zhenzhong Duan <zhenzhong.duan@oracle.com>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: "H. Peter Anvin" <hpa@zytor.com>
    Link: http://lkml.kernel.org/r/b07b6ae9-4b57-4b40-b9bc-50c2c67f1d91@default
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bf6c97326381890d4c778e6223714a29b17f406b
Author: Alex Deucher <alexander.deucher@amd.com>
Date:   Thu Jun 28 12:38:53 2018 -0500

    drm/amdgpu: fix swapped emit_ib_size in vce3
    
    [ Upstream commit 0859df22ab7cfb3ad2df2caed76cadce6ac33a80 ]
    
    The phys and vm versions had the values swapped.
    
    Reviewed-by: Junwei Zhang <Jerry.Zhang@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f3ef33ee85c17b16f5834d2dadc1df0e79ce0841
Author: Hangbin Liu <liuhangbin@gmail.com>
Date:   Sun Jul 1 16:21:21 2018 +0800

    ipvlan: call dev_change_flags when ipvlan mode is reset
    
    [ Upstream commit 5dc2d3996a8b221c20dd0900bdad45031a572530 ]
    
    After we change the ipvlan mode from l3 to l2, or vice versa, we only
    reset IFF_NOARP flag, but don't flush the ARP table cache, which will
    cause eth->h_dest to be equal to eth->h_source in ipvlan_xmit_mode_l2().
    Then the message will not come out of host.
    
    Here is the reproducer on local host:
    
    ip link set eth1 up
    ip addr add 192.168.1.1/24 dev eth1
    ip link add link eth1 ipvlan1 type ipvlan mode l3
    
    ip netns add net1
    ip link set ipvlan1 netns net1
    ip netns exec net1 ip link set ipvlan1 up
    ip netns exec net1 ip addr add 192.168.2.1/24 dev ipvlan1
    
    ip route add 192.168.2.0/24 via 192.168.1.2
    ping 192.168.2.2 -c 2
    
    ip netns exec net1 ip link set ipvlan1 type ipvlan mode l2
    ping 192.168.2.2 -c 2
    
    Add the same configuration on remote host. After we set the mode to l2,
    we could find that the src/dst MAC addresses are the same on eth1:
    
    21:26:06.648565 00:b7:13:ad:d3:05 > 00:b7:13:ad:d3:05, ethertype IPv4 (0x0800), length 98: (tos 0x0, ttl 64, id 58356, offset 0, flags [DF], proto ICMP (1), length 84)
        192.168.2.1 > 192.168.2.2: ICMP echo request, id 22686, seq 1, length 64
    
    Fix this by calling dev_change_flags(), which will call netdevice notifier
    with flag change info.
    
    v2:
    a) As pointed out by Wang Cong, check return value for dev_change_flags() when
    change dev flags.
    b) As suggested by Stefano and Sabrina, move flags setting before l3mdev_ops.
    So we don't need to redo ipvlan_{, un}register_nf_hook() again in err path.
    
    Reported-by: Jianlin Shi <jishi@redhat.com>
    Reviewed-by: Stefano Brivio <sbrivio@redhat.com>
    Reviewed-by: Sabrina Dubroca <sd@queasysnail.net>
    Fixes: 2ad7bf3638411 ("ipvlan: Initial check-in of the IPVLAN driver.")
    Signed-off-by: Hangbin Liu <liuhangbin@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0bcba95686bef2055bc7d4521fe23ef7e24ee059
Author: Josh Poimboeuf <jpoimboe@redhat.com>
Date:   Wed Jun 27 17:03:45 2018 -0500

    objtool: Support GCC 8 '-fnoreorder-functions'
    
    [ Upstream commit 08b393d01c88aff27347ed2b1b354eb4db2f1532 ]
    
    Since the following commit:
    
      cd77849a69cf ("objtool: Fix GCC 8 cold subfunction detection for aliased functions")
    
    ... if the kernel is built with EXTRA_CFLAGS='-fno-reorder-functions',
    objtool can get stuck in an infinite loop.
    
    That flag causes the new GCC 8 cold subfunctions to be placed in .text
    instead of .text.unlikely.  But it also has an unfortunate quirk: in the
    symbol table, the subfunction (e.g., nmi_panic.cold.7) is nested inside
    the parent (nmi_panic).
    
    That function overlap confuses objtool, and causes it to get into an
    infinite loop in next_insn_same_func().  Here's Allan's description of
    the loop:
    
      "Objtool iterates through the instructions in nmi_panic using
      next_insn_same_func. Once it reaches the end of nmi_panic at 0x534 it
      jumps to 0x528 as that's the start of nmi_panic.cold.7. However, since
      the instructions starting at 0x528 are still associated with nmi_panic
      objtool will get stuck in a loop, continually jumping back to 0x528
      after reaching 0x534."
    
    Fix it by shortening the length of the parent function so that the
    functions no longer overlap.
    
    Reported-and-analyzed-by: Allan Xavier <allan.x.xavier@oracle.com>
    Signed-off-by: Josh Poimboeuf <jpoimboe@redhat.com>
    Cc: Allan Xavier <allan.x.xavier@oracle.com>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Brian Gerst <brgerst@gmail.com>
    Cc: Denys Vlasenko <dvlasenk@redhat.com>
    Cc: H. Peter Anvin <hpa@zytor.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Link: http://lkml.kernel.org/r/9e704c52bee651129b036be14feda317ae5606ae.1530136978.git.jpoimboe@redhat.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e793dc3d97669a7b631f06dec6019fe5adcf0ec5
Author: Greg Ungerer <gerg@linux-m68k.org>
Date:   Mon Jun 18 15:34:14 2018 +1000

    m68k: fix "bad page state" oops on ColdFire boot
    
    [ Upstream commit ecd60532e060e45c63c57ecf1c8549b1d656d34d ]
    
    Booting a ColdFire m68k core with MMU enabled causes a "bad page state"
    oops since commit 1d40a5ea01d5 ("mm: mark pages in use for page tables"):
    
     BUG: Bad page state in process sh  pfn:01ce2
     page:004fefc8 count:0 mapcount:-1024 mapping:00000000 index:0x0
     flags: 0x0()
     raw: 00000000 00000000 00000000 fffffbff 00000000 00000100 00000200 00000000
     raw: 039c4000
     page dumped because: nonzero mapcount
     Modules linked in:
     CPU: 0 PID: 22 Comm: sh Not tainted 4.17.0-07461-g1d40a5ea01d5 #13
    
    Fix by calling pgtable_page_dtor() in our __pte_free_tlb() code path,
    so that the PG_table flag is cleared before we free the pte page.
    
    Note that I had to change the type of pte_free() to be static from
    extern. Otherwise you get a lot of warnings like this:
    
    ./arch/m68k/include/asm/mcf_pgalloc.h:80:2: warning: ‘pgtable_page_dtor’ is static but used in inline function ‘pte_free’ which is not static
      pgtable_page_dtor(page);
      ^
    
    And making it static is consistent with our use of this in the other
    m68k pgalloc definitions of pte_free().
    
    Signed-off-by: Greg Ungerer <gerg@linux-m68k.org>
    CC: Matthew Wilcox <willy@infradead.org>
    Reviewed-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 83141913ca6bbf95bdc4aa4f9d852d5c27464eac
Author: Stafford Horne <shorne@gmail.com>
Date:   Sun Jul 1 14:17:36 2018 +0900

    openrisc: entry: Fix delay slot exception detection
    
    [ Upstream commit ae15a41a641449f536578b0d9ec0e4ade130deb5 ]
    
    Originally in patch e6d20c55a4 ("openrisc: entry: Fix delay slot
    detection") I fixed delay slot detection, but only for QEMU.  We missed
    that hardware delay slot detection using delay slot exception flag (DSX)
    was still broken.  This was because QEMU set the DSX flag in both
    pre-exception supervision register (ESR) and supervision register (SR)
    register, but on real hardware the DSX flag is only set on the SR
    register during exceptions.
    
    Fix this by carrying the DSX flag into the SR register during exception.
    We also update the DSX flag read locations to read the value from the SR
    register not the pt_regs SR register which represents ESR.  The ESR
    should never have the DSX flag set.
    
    In the process I updated/removed a few comments to match the current
    state.  Including removing a comment saying that the DSX detection logic
    was inefficient and needed to be rewritten.
    
    I have tested this on QEMU with a patch ensuring it matches the hardware
    specification.
    
    Link: https://lists.gnu.org/archive/html/qemu-devel/2018-07/msg00000.html
    Fixes: e6d20c55a4 ("openrisc: entry: Fix delay slot detection")
    Signed-off-by: Stafford Horne <shorne@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c845344aa2e2d5952f5a899fe8612b647cd39f3d
Author: Dave Jiang <dave.jiang@intel.com>
Date:   Thu Jun 28 09:56:55 2018 -0700

    acpi/nfit: fix cmd_rc for acpi_nfit_ctl to always return a value
    
    [ Upstream commit c1985cefd844e26bd19673a6df8d8f0b1918c2db ]
    
    cmd_rc is passed in by reference to the acpi_nfit_ctl() function and the
    caller expects a value returned. However, when the package is pass through
    via the ND_CMD_CALL command, cmd_rc is not touched. Make sure cmd_rc is
    always set.
    
    Fixes: aef253382266 ("libnvdimm, nfit: centralize command status translation")
    
    Signed-off-by: Dave Jiang <dave.jiang@intel.com>
    Signed-off-by: Dan Williams <dan.j.williams@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f06fae1641947549fefbef01cdec1f6c314f53a2
Author: Madalin Bucur <madalin.bucur@nxp.com>
Date:   Thu Jun 28 15:26:51 2018 +0300

    dpaa_eth: DPAA SGT needs to be 256B
    
    [ Upstream commit 595e802e53f24642a145cf7f3e4ac9afab4c21ec ]
    
    The DPAA HW requires that at least 256 bytes from the start of the
    first scatter-gather table entry are allocated and accessible. The
    hardware reads the maximum size the table can have in one access,
    thus requiring that the allocation and mapping to be done for the
    maximum size of 256B even if there is a smaller number of entries
    in the table.
    
    Signed-off-by: Madalin Bucur <madalin.bucur@nxp.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fba7c43d9368d90022d74a4716f33de3a6934e9b
Author: Madalin Bucur <madalin.bucur@nxp.com>
Date:   Thu Jun 28 15:26:50 2018 +0300

    fsl/fman: fix parser reporting bad checksum on short frames
    
    [ Upstream commit b95f6fbc8e15803a596ca5e5e21008fba29694c6 ]
    
    The FMan hardware parser needs to be configured to remove the
    short frame padding from the checksum calculation, otherwise
    short UDP and TCP frames are likely to be marked as having a
    bad checksum.
    
    Signed-off-by: Madalin Bucur <madalin.bucur@nxp.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3baa3f9221e221fb9488929e5289b49bb8ee7d18
Author: Sudarsana Reddy Kalluru <sudarsana.kalluru@cavium.com>
Date:   Thu Jun 28 04:52:15 2018 -0700

    bnx2x: Fix receiving tx-timeout in error or recovery state.
    
    [ Upstream commit 484c016d9392786ce5c74017c206c706f29f823d ]
    
    Driver performs the internal reload when it receives tx-timeout event from
    the OS. Internal reload might fail in some scenarios e.g., fatal HW issues.
    In such cases OS still see the link, which would result in undesirable
    functionalities such as re-generation of tx-timeouts.
    The patch addresses this issue by indicating the link-down to OS when
    tx-timeout is detected, and keeping the link in down state till the
    internal reload is successful.
    
    Please consider applying it to 'net' branch.
    
    Signed-off-by: Sudarsana Reddy Kalluru <Sudarsana.Kalluru@cavium.com>
    Signed-off-by: Ariel Elior <ariel.elior@cavium.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 441712f28d691b53b5871ac9d0a631e8a8afe2f6
Author: Nicholas Mc Guire <hofrat@osadl.org>
Date:   Fri Jun 29 13:50:27 2018 -0500

    PCI: faraday: Add missing of_node_put()
    
    [ Upstream commit 3dc6ddfedc2818eaaa36842fbb049191e0c5e50f ]
    
    The call to of_get_next_child() returns a node pointer with refcount
    incremented thus it must be explicitly decremented here in the error
    path and after the last usage.
    
    Fixes: d3c68e0a7e34 ("PCI: faraday: Add Faraday Technology FTPCI100 PCI Host Bridge driver")
    Signed-off-by: Nicholas Mc Guire <hofrat@osadl.org>
    [lorenzo.pieralisi@arm.com: updated commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7851cea48abca82c188ba76f4fbefce3fc0de340
Author: Nicholas Mc Guire <hofrat@osadl.org>
Date:   Fri Jun 29 13:50:10 2018 -0500

    PCI: xilinx-nwl: Add missing of_node_put()
    
    [ Upstream commit 342639d996f18bc0a4db2f42a84230c0a966dc94 ]
    
    The call to of_get_next_child() returns a node pointer with
    refcount incremented thus it must be explicitly decremented
    here after the last usage.
    
    Fixes: ab597d35ef11 ("PCI: xilinx-nwl: Add support for Xilinx NWL PCIe Host Controller")
    Signed-off-by: Nicholas Mc Guire <hofrat@osadl.org>
    [lorenzo.pieralisi@arm.com: updated commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dfcee0c7d9cb16886f173de2199875b4c79f43cf
Author: Nicholas Mc Guire <hofrat@osadl.org>
Date:   Fri Jun 29 13:49:54 2018 -0500

    PCI: xilinx: Add missing of_node_put()
    
    [ Upstream commit 8c3f9bd851a4d3acf0a0f222d4e9e41c0cd1ea8e ]
    
    The call to of_get_next_child() returns a node pointer with refcount
    incremented thus it must be explicitly decremented here after the last
    usage.
    
    Fixes: 8961def56845 ("PCI: xilinx: Add Xilinx AXI PCIe Host Bridge IP driver")
    Signed-off-by: Nicholas Mc Guire <hofrat@osadl.org>
    [lorenzo.pieralisi@arm.com: reworked commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a21b37053edc1098eaae9af37549e1bdb4640942
Author: Daniel Borkmann <daniel@iogearbox.net>
Date:   Thu Jun 28 23:34:58 2018 +0200

    bpf, s390: fix potential memleak when later bpf_jit_prog fails
    
    [ Upstream commit f605ce5eb26ac934fb8106d75d46a2c875a2bf23 ]
    
    If we would ever fail in the bpf_jit_prog() pass that writes the
    actual insns to the image after we got header via bpf_jit_binary_alloc()
    then we also need to make sure to free it through bpf_jit_binary_free()
    again when bailing out. Given we had prior bpf_jit_prog() passes to
    initially probe for clobbered registers, program size and to fill in
    addrs arrray for jump targets, this is more of a theoretical one,
    but at least make sure this doesn't break with future changes.
    
    Fixes: 054623105728 ("s390/bpf: Add s390x eBPF JIT compiler backend")
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Cc: Martin Schwidefsky <schwidefsky@de.ibm.com>
    Acked-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a567493430be60b2a29b37d6401992f68acce032
Author: Bart Van Assche <bvanassche@acm.org>
Date:   Mon Jun 25 15:51:30 2018 -0700

    drbd: Fix drbd_request_prepare() discard handling
    
    [ Upstream commit fad2d4ef636654e926d374ef038f4cd4286661f6 ]
    
    Fix the test that verifies whether bio_op(bio) represents a discard
    or write zeroes operation. Compile-tested only.
    
    Cc: Philipp Reisner <philipp.reisner@linbit.com>
    Cc: Lars Ellenberg <lars.ellenberg@linbit.com>
    Fixes: 7435e9018f91 ("drbd: zero-out partial unaligned discards on local backend")
    Signed-off-by: Bart Van Assche <bart.vanassche@wdc.com>
    Reviewed-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8a9e8b683a7c8a3fb52fcaa692ffd704ba03f29d
Author: Marek Szyprowski <m.szyprowski@samsung.com>
Date:   Thu Jun 7 13:07:49 2018 +0200

    drm/exynos: decon5433: Fix WINCONx reset value
    
    [ Upstream commit 7b7aa62c05eac9789c208b946f515983a9255d8d ]
    
    The only bits that should be preserved in decon_win_set_fmt() is
    WINCONx_ENWIN_F. All other bits depends on the selected pixel formats and
    are set by the mentioned function.
    
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Inki Dae <inki.dae@samsung.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4091040d025b778c2b935e5dd67a58d7ba22d1a1
Author: Marek Szyprowski <m.szyprowski@samsung.com>
Date:   Thu Jun 7 13:07:40 2018 +0200

    drm/exynos: decon5433: Fix per-plane global alpha for XRGB modes
    
    [ Upstream commit ab337fc274a1957ff0771f19e826c736253f7c39 ]
    
    Set per-plane global alpha to maximum value to get proper blending of
    XRGB and ARGB planes. This fixes the strange order of overlapping planes.
    
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Inki Dae <inki.dae@samsung.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 49316955f501da5dd8eb89ee1422ff2a921ee2bd
Author: Marek Szyprowski <m.szyprowski@samsung.com>
Date:   Thu Jun 7 13:06:13 2018 +0200

    drm/exynos: gsc: Fix support for NV16/61, YUV420/YVU420 and YUV422 modes
    
    [ Upstream commit dd209ef809080ced903e7747ee3ef640c923a1d2 ]
    
    Fix following issues related to planar YUV pixel format configuration:
    - NV16/61 modes were incorrectly programmed as NV12/21,
    - YVU420 was programmed as YUV420 on source,
    - YVU420 and YUV422 were programmed as YUV420 on output.
    
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Inki Dae <inki.dae@samsung.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d4857eb755d72c9e063b17256e5479353a2bf785
Author: Johannes Berg <johannes.berg@intel.com>
Date:   Fri Jun 29 09:33:39 2018 +0200

    nl80211: check nla_parse_nested() return values
    
    [ Upstream commit 95bca62fb723a121954fc7ae5473bb2c1f0d5986 ]
    
    At the very least we should check the return value if
    nla_parse_nested() is called with a non-NULL policy.
    
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 334c9cd8ba8d8c1b5dcb5a49b997aeef3db06c1d
Author: Bob Copeland <me@bobcopeland.com>
Date:   Sun Jun 24 21:10:49 2018 -0400

    nl80211: relax ht operation checks for mesh
    
    [ Upstream commit 188f60ab8e787fcbb5ac9d64ede23a0070231f09 ]
    
    Commit 9757235f451c, "nl80211: correct checks for
    NL80211_MESHCONF_HT_OPMODE value") relaxed the range for the HT
    operation field in meshconf, while also adding checks requiring
    the non-greenfield and non-ht-sta bits to be set in certain
    circumstances.  The latter bit is actually reserved for mesh BSSes
    according to Table 9-168 in 802.11-2016, so in fact it should not
    be set.
    
    wpa_supplicant sets these bits because the mesh and AP code share
    the same implementation, but authsae does not.  As a result, some
    meshconf updates from authsae which set only the NONHT_MIXED
    protection bits were being rejected.
    
    In order to avoid breaking userspace by changing the rules again,
    simply accept the values with or without the bits set, and mask
    off the reserved bit to match the spec.
    
    While in here, update the 802.11-2012 reference to 802.11-2016.
    
    Fixes: 9757235f451c ("nl80211: correct checks for NL80211_MESHCONF_HT_OPMODE value")
    Cc: Masashi Honma <masashi.honma@gmail.com>
    Signed-off-by: Bob Copeland <bobcopeland@fb.com>
    Reviewed-by: Masashi Honma <masashi.honma@gmail.com>
    Reviewed-by: Masashi Honma <masashi.honma@gmail.com>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0aa88fda693aebe6eccf538ca6ae64cf58a0c60a
Author: Jeff Moyer <jmoyer@redhat.com>
Date:   Wed Jun 27 11:43:58 2018 -0400

    dev-dax: check_vma: ratelimit dev_info-s
    
    [ Upstream commit 5a14e91d559aee5bdb0e002e1153fd9c4338a29e ]
    
    This is easily triggered from userspace, so let's ratelimit the
    messages.
    
    Signed-off-by: Jeff Moyer <jmoyer@redhat.com>
    Signed-off-by: Dan Williams <dan.j.williams@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 601c226ea6623b8fb15e33fab3608755929de4da
Author: BingJing Chang <bingjingc@synology.com>
Date:   Thu Jun 28 18:40:11 2018 +0800

    md/raid10: fix that replacement cannot complete recovery after reassemble
    
    [ Upstream commit bda3153998f3eb2cafa4a6311971143628eacdbc ]
    
    During assemble, the spare marked for replacement is not checked.
    conf->fullsync cannot be updated to be 1. As a result, recovery will
    treat it as a clean array. All recovering sectors are skipped. Original
    device is replaced with the not-recovered spare.
    
    mdadm -C /dev/md0 -l10 -n4 -pn2 /dev/loop[0123]
    mdadm /dev/md0 -a /dev/loop4
    mdadm /dev/md0 --replace /dev/loop0
    mdadm -S /dev/md0 # stop array during recovery
    
    mdadm -A /dev/md0 /dev/loop[01234]
    
    After reassemble, you can see recovery go on, but it completes
    immediately. In fact, recovery is not actually processed.
    
    To solve this problem, we just add the missing logics for replacment
    spares. (In raid1.c or raid5.c, they have already been checked.)
    
    Reported-by: Alex Chen <alexchen@synology.com>
    Reviewed-by: Alex Wu <alexwu@synology.com>
    Reviewed-by: Chung-Chiang Cheng <cccheng@synology.com>
    Signed-off-by: BingJing Chang <bingjingc@synology.com>
    Signed-off-by: Shaohua Li <shli@fb.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 94cac10c50c1e38a0c51be0fded73e5aa6fa9080
Author: Ryan Hsu <ryanhsu@codeaurora.org>
Date:   Mon Jun 18 17:00:04 2018 +0300

    ath10k: update the phymode along with bandwidth change request
    
    [ Upstream commit 9191fc2a431bade3dedc9ad17759495a9f82f41b ]
    
    In the case of Station connects to AP with narrower bandwidth at beginning.
    And later the AP changes the bandwidth to winder bandwidth, the AP will
    beacon with wider bandwidth IE, eg VHT20->VHT40->VHT80 or VHT40->VHT80.
    
    Since the supported BANDWIDTH will be limited by the PHYMODE, so while
    Station receives the bandwidth change request, it will also need to
    reconfigure the PHYMODE setting to firmware instead of just configuring
    the BANDWIDTH info, otherwise it'll trigger a firmware crash with
    non-support bandwidth.
    
    The issue was observed in WLAN.RM.4.4.1-00051-QCARMSWP-1, QCA6174 with
    below scenario:
    
    AP xxx changed bandwidth, new config is 5200 MHz, width 2 (5190/0 MHz)
    disconnect from AP xxx for new auth to yyy
    RX ReassocResp from xxx (capab=0x1111 status=0 aid=102)
    associated
    
    ....
    
    AP xxx changed bandwidth, new config is 5200 MHz, width 2 (5190/0 MHz)
    AP xxx changed bandwidth, new config is 5200 MHz, width 3 (5210/0 MHz)
    
    ....
    
    firmware register dump:
    [00]: 0x05030000 0x000015B3 0x00987291 0x00955B31
    [04]: 0x00987291 0x00060730 0x00000004 0x00000001
    [08]: 0x004089F0 0x00955A00 0x000A0B00 0x00400000
    [12]: 0x00000009 0x00000000 0x00952CD0 0x00952CE6
    [16]: 0x00952CC4 0x0098E25F 0x00000000 0x0091080D
    [20]: 0x40987291 0x0040E7A8 0x00000000 0x0041EE3C
    [24]: 0x809ABF05 0x0040E808 0x00000000 0xC0987291
    [28]: 0x809A650C 0x0040E948 0x0041FE40 0x004345C4
    [32]: 0x809A5C63 0x0040E988 0x0040E9AC 0x0042D1A8
    [36]: 0x8091D252 0x0040E9A8 0x00000002 0x00000001
    [40]: 0x809FDA9D 0x0040EA58 0x0043D554 0x0042D554
    [44]: 0x809F8B22 0x0040EA78 0x0043D554 0x00000001
    [48]: 0x80911210 0x0040EAC8 0x00000010 0x004041D0
    [52]: 0x80911154 0x0040EB28 0x00400000 0x00000000
    [56]: 0x8091122D 0x0040EB48 0x00000000 0x00400600
    
    Reported-by: Rouven Czerwinski <rouven@czerwinskis.de>
    Tested-by: Timur Kristóf <timur.kristof@gmail.com>
    Signed-off-by: Ryan Hsu <ryanhsu@codeaurora.org>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bb2b7243e3f7b78b3ab720b084166d43bf0f2eac
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Fri Jun 22 14:15:47 2018 +0300

    dmaengine: k3dma: Off by one in k3_of_dma_simple_xlate()
    
    [ Upstream commit c4c2b7644cc9a41f17a8cc8904efe3f66ae4c7ed ]
    
    The d->chans[] array has d->dma_requests elements so the > should be
    >= here.
    
    Fixes: 8e6152bc660e ("dmaengine: Add hisilicon k3 DMA engine driver")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4cea08638e9aad931771a4a5b50dabf86910e4de
Author: Marek Szyprowski <m.szyprowski@samsung.com>
Date:   Tue Jun 19 15:20:50 2018 +0200

    dmaengine: pl330: report BURST residue granularity
    
    [ Upstream commit e3f329c600033f011a978a8bc4ddb1e2e94c4f4d ]
    
    The reported residue is already calculated in BURST unit granularity, so
    advertise this capability properly to other devices in the system.
    
    Fixes: aee4d1fac887 ("dmaengine: pl330: improve pl330_tx_status() function")
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4c68433396e1e94b0b493c6c08a33e7e4ba48547
Author: Martin Blumenstingl <martin.blumenstingl@googlemail.com>
Date:   Sat Jun 23 17:00:56 2018 +0200

    ARM64: dts: meson-gxl: fix Mali GPU compatible string
    
    [ Upstream commit 1c38f4afd5d40234b67635b3c608a4093be04b96 ]
    
    meson-gxl-mali.dtsi is only used on GXL SoCs. Thus it should use the GXL
    specific compatible string instead of the GXBB one.
    For now this is purely cosmetic since the (out-of-tree) lima driver for
    this GPU currently uses the "arm,mali-450" match instead of the SoC
    specific one. However, update the .dts to match the documentation since
    this driver behavior might change in the future.
    
    Signed-off-by: Martin Blumenstingl <martin.blumenstingl@googlemail.com>
    Acked-by: Neil Armstrong <narmstrong@baylibre.com>
    Signed-off-by: Kevin Hilman <khilman@baylibre.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 58b22343150ba5c7e3d8cbac1c320773a7ef530f
Author: Keerthy <j-keerthy@ti.com>
Date:   Tue Jun 5 15:37:51 2018 +0530

    ARM: dts: da850: Fix interrups property for gpio
    
    [ Upstream commit 3eb1b955cd7ed1e621ace856710006c2a8a7f231 ]
    
    The intc #interrupt-cells is equal to 1. Currently gpio
    node has 2 cells per IRQ which is wrong. Remove the additional
    cell for each of the interrupts.
    
    Signed-off-by: Keerthy <j-keerthy@ti.com>
    Fixes: 2e38b946dc54 ("ARM: davinci: da850: add GPIO DT node")
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9f8da50b0232adef07a58402316acb6ef0205a3e
Author: Andy Lutomirski <luto@kernel.org>
Date:   Tue Jun 26 22:17:18 2018 -0700

    selftests/x86/sigreturn: Do minor cleanups
    
    [ Upstream commit e8a445dea219c32727016af14f847d2e8f7ebec8 ]
    
    We have short names for the requested and resulting register values.
    Use them instead of spelling out the whole register entry for each
    case.
    
    Signed-off-by: Andy Lutomirski <luto@kernel.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Link: http://lkml.kernel.org/r/bb3bc1f923a2f6fe7912d22a1068fe29d6033d38.1530076529.git.luto@kernel.org
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 90c45a36250b280f51af7fcce72ecfb3f9701f75
Author: Andy Lutomirski <luto@kernel.org>
Date:   Tue Jun 26 22:17:17 2018 -0700

    selftests/x86/sigreturn/64: Fix spurious failures on AMD CPUs
    
    [ Upstream commit ec348020566009d3da9b99f07c05814d13969c78 ]
    
    When I wrote the sigreturn test, I didn't realize that AMD's busted
    IRET behavior was different from Intel's busted IRET behavior:
    
    On AMD CPUs, the CPU leaks the high 32 bits of the kernel stack pointer
    to certain userspace contexts.  Gee, thanks.  There's very little
    the kernel can do about it.  Modify the test so it passes.
    
    Signed-off-by: Andy Lutomirski <luto@kernel.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Link: http://lkml.kernel.org/r/86e7fd3564497f657de30a36da4505799eebef01.1530076529.git.luto@kernel.org
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 778bce908b84b7d59d09ed0b9efca4de0edfc2c2
Author: Chengguang Xu <cgxu519@gmx.com>
Date:   Tue Jun 26 09:16:31 2018 +0800

    nfp: cast sizeof() to int when comparing with error code
    
    [ Upstream commit 2d2595719a97c876f35b1e60e5768e58753b268c ]
    
    sizeof() will return unsigned value so in the error check
    negative error code will be always larger than sizeof().
    
    Fixes: a0d8e02c35ff ("nfp: add support for reading nffw info")
    
    Signed-off-by: Chengguang Xu <cgxu519@gmx.com>
    Acked-by: Jakub Kicinski <jakub.kicinski@netronome.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a5b6bb86cc128b8bbcdd8fdccd2567c09bdc0ac4
Author: Eli Cohen <eli@mellanox.com>
Date:   Thu May 31 12:24:48 2018 +0300

    net/mlx5: E-Switch, Disallow vlan/spoofcheck setup if not being esw manager
    
    [ Upstream commit a8d70a054a718b63058b3d3ac58b6181815e4289 ]
    
    In smartnic env, if the host (PF) driver is not an e-switch manager, we
    are not allowed to apply eswitch ports setups such as vlan (VST),
    spoof-checks, min/max rate or state.
    
    Make sure we are eswitch manager when coming to issue these callbacks
    and err otherwise.
    
    Also fix the definition of ESW_ALLOWED to rely on eswitch_manager
    capability and on the vport_group_manger.
    
    Operations on the VF nic vport context, such as setting a mac or reading
    the vport counters are allowed to the PF in this scheme.
    
    The modify nic vport guid code was modified to omit checking the
    nic_vport_node_guid_modify eswitch capability.
    The reason for doing so is that modifying node guid requires vport group
    manager capability, and there's no need to check further capabilities.
    
    1. set_vf_vlan     - disallowed
    2. set_vf_spoofchk - disallowed
    3. set_vf_mac      - allowed
    4. get_vf_config   - allowed
    5. set_vf_trust    - disallowed
    6. set_vf_rate     - disallowed
    7. get_vf_stat     - allowed
    8. set_vf_link_state - disallowed
    
    Fixes: f942380c1239 ('net/mlx5: E-Switch, Vport ingress/egress ACLs rules for spoofchk')
    Signed-off-by: Eli Cohen <eli@mellanox.com>
    Reviewed-by: Or Gerlitz <ogerlitz@mellanox.com>
    Tested-by: Or Gerlitz <ogerlitz@mellanox.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 77c967872e8efe1341696bacfa1f793aedcc9f0d
Author: Yan, Zheng <zyan@redhat.com>
Date:   Tue Jun 19 18:20:34 2018 +0800

    ceph: fix dentry leak in splice_dentry()
    
    [ Upstream commit 8b8f53af1ed9df88a4c0fbfdf3db58f62060edf3 ]
    
    In any case, d_splice_alias() does not drop reference of original
    dentry.
    
    Signed-off-by: "Yan, Zheng" <zyan@redhat.com>
    Reviewed-by: Jeff Layton <jlayton@redhat.com>
    Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4c3b0ae79f0736993c444980c40ebf7a103b6f39
Author: Jann Horn <jannh@google.com>
Date:   Wed Jun 20 18:33:45 2018 +0200

    netfilter: nf_log: fix uninit read in nf_log_proc_dostring
    
    [ Upstream commit dffd22aed2aa1e804bccf19b30a421e89ee2ae61 ]
    
    When proc_dostring() is called with a non-zero offset in strict mode, it
    doesn't just write to the ->data buffer, it also reads. Make sure it
    doesn't read uninitialized data.
    
    Fixes: c6ac37d8d884 ("netfilter: nf_log: fix error on write NONE to [...]")
    Signed-off-by: Jann Horn <jannh@google.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1ea053d1cc8bc6e52e5ecb34cafc1e41d33d5602
Author: Adam Ford <aford173@gmail.com>
Date:   Thu May 17 20:20:52 2018 -0500

    ARM: davinci: board-da850-evm: fix WP pin polarity for MMC/SD
    
    [ Upstream commit 1b6fe9798af8cb7d80fad5dd30ee1bcd1e0f51eb ]
    
    When booting from MMC/SD in rw mode on DA850 EVM, the system
    crashes because the write protect pin should be active high
    and not active low. This patch fixes the polarity of the WP pin.
    
    Fixes: bdf0e8364fd3 ("ARM: davinci: da850-evm: use gpio descriptor for mmc pins")
    Signed-off-by: Adam Ford <aford173@gmail.com>
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0f868ad81facb32633f528bf5674cd3db025671b
Author: Jiri Olsa <jolsa@kernel.org>
Date:   Wed Jun 20 11:40:36 2018 +0200

    perf bench: Fix numa report output code
    
    [ Upstream commit 983107072be1a39cbde67d45cb0059138190e015 ]
    
    Currently we can hit following assert when running numa bench:
    
      $ perf bench numa mem -p 3 -t 1 -P 512 -s 100 -zZ0cm --thp 1
      perf: bench/numa.c:1577: __bench_numa: Assertion `!(!(((wait_stat) & 0x7f) == 0))' failed.
    
    The assertion is correct, because we hit the SIGFPE in following line:
    
      Thread 2.2 "thread 0/0" received signal SIGFPE, Arithmetic exception.
      [Switching to Thread 0x7fffd28c6700 (LWP 11750)]
      0x000.. in worker_thread (__tdata=0x7.. ) at bench/numa.c:1257
      1257 td->speed_gbs = bytes_done / (td->runtime_ns / NSEC_PER_SEC) / 1e9;
    
    We don't check if the runtime is actually bigger than 1 second,
    and thus this might end up with zero division within FPU.
    
    Adding the check to prevent this.
    
    Signed-off-by: Jiri Olsa <jolsa@kernel.org>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: David Ahern <dsahern@gmail.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Link: http://lkml.kernel.org/r/20180620094036.17278-1-jolsa@kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 28dbfc731fec37ed88e59e6470051f19fc32aec9
Author: Yonghong Song <yhs@fb.com>
Date:   Sat Jun 16 10:47:39 2018 -0700

    perf tools: Fix a clang 7.0 compilation error
    
    [ Upstream commit c6555c14572aeadf4fe2819abd971c4e7608b926 ]
    
    Arnaldo reported the perf build failure with latest llvm/clang compiler
    (7.0).
    
       $ make LIBCLANGLLVM=1 -C tools/perf/
       <SNIP>
        CC       /tmp/tmp.t53Qo38zci/tests/kmod-path.o
       util/c++/clang.cpp: In function ‘std::unique_ptr<llvm::SmallVectorImpl<char> >
           perf::getBPFObjectFromModule(llvm::Module*)’:
       util/c++/clang.cpp:150:43: error: no matching function for call to
           ‘llvm::TargetMachine::addPassesToEmitFile(llvm::legacy::PassManager&,
            llvm::raw_svector_ostream&, llvm::TargetMachine::CodeGenFileType)’
                   TargetMachine::CGFT_ObjectFile)) {
                                                 ^
       In file included from util/c++/clang.cpp:25:0:
       /usr/local/include/llvm/Target/TargetMachine.h:254:16: note: candidate:
           virtual bool llvm::TargetMachine::addPassesToEmitFile(
           llvm::legacy::PassManagerBase&, llvm::raw_pwrite_stream&,
           llvm::raw_pwrite_stream*, llvm::TargetMachine::CodeGenFileType, bool,
           llvm::MachineModuleInfo*)
         virtual bool addPassesToEmitFile(PassManagerBase &, raw_pwrite_stream &,
                      ^~~~~~~~~~~~~~~~~~~
      /usr/local/include/llvm/Target/TargetMachine.h:254:16: note:
          candidate expects 6 arguments, 3 provided
      mv: cannot stat '/tmp/tmp.t53Qo38zci/util/c++/.clang.o.tmp': No such file or directory
      make[7]: *** [/home/acme/git/perf/tools/build/Makefile.build:101:
          /tmp/tmp.t53Qo38zci/util/c++/clang.o] Error 1
      make[6]: *** [/home/acme/git/perf/tools/build/Makefile.build:139: c++] Error 2
      make[5]: *** [/home/acme/git/perf/tools/build/Makefile.build:139: util] Error 2
      make[5]: *** Waiting for unfinished jobs....
        CC       /tmp/tmp.t53Qo38zci/tests/thread-map.o
    
    The function addPassesToEmitFile signature changed in llvm 7.0 and such
    a change caused the failure. This patch fixed the issue with using
    proper function signatures under different compiler versions.
    
    Reported-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Yonghong Song <yhs@fb.com>
    Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Cc: Alexei Starovoitov <ast@fb.com>
    Cc: Daniel Borkmann <daniel@iogearbox.net>
    Cc: Jiri Olsa <jolsa@kernel.org>
    Cc: Martin KaFai Lau <kafai@fb.com>
    Cc: Wang Nan <wangnan0@huawei.com>
    Link: http://lkml.kernel.org/r/20180616174739.1076733-1-yhs@fb.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b4d84dcee9efe0197d1d74bae648324850f94593
Author: Sandipan Das <sandipan@linux.ibm.com>
Date:   Mon Jun 11 16:10:49 2018 +0530

    perf report powerpc: Fix crash if callchain is empty
    
    [ Upstream commit 143c99f6ac6812d23254e80844d6e34be897d3e1 ]
    
    For some cases, the callchain provided by the kernel may be empty. So,
    the callchain ip filtering code will cause a crash if we do not check
    whether the struct ip_callchain pointer is NULL before accessing any
    members.
    
    This can be observed on a powerpc64le system running Fedora 27 as shown
    below.
    
      # perf record -b -e cycles:u ls
    
    Before:
    
      # perf report --branch-history
    
      perf: Segmentation fault
      -------- backtrace --------
      perf[0x1027615c]
      linux-vdso64.so.1(__kernel_sigtramp_rt64+0x0)[0x7fff856304d8]
      perf(arch_skip_callchain_idx+0x44)[0x10257c58]
      perf[0x1017f2e4]
      perf(thread__resolve_callchain+0x124)[0x1017ff5c]
      perf(sample__resolve_callchain+0xf0)[0x10172788]
      ...
    
    After:
    
      # perf report --branch-history
    
      Samples: 25  of event 'cycles:u', Event count (approx.): 2306870
        Overhead  Source:Line            Symbol                   Shared Object
      +   11.60%  _init+35736            [.] _init                ls
      +    9.84%  strcoll_l.c:137        [.] __strcoll_l          libc-2.26.so
      +    9.16%  memcpy.S:175           [.] __memcpy_power7      libc-2.26.so
      +    9.01%  gconv_charset.h:54     [.] _nl_find_locale      libc-2.26.so
      +    8.87%  dl-addr.c:52           [.] _dl_addr             libc-2.26.so
      +    8.83%  _init+236              [.] _init                ls
      ...
    
    Reported-by: Ravi Bangoria <ravi.bangoria@linux.ibm.com>
    Signed-off-by: Sandipan Das <sandipan@linux.ibm.com>
    Acked-by: Ravi Bangoria <ravi.bangoria@linux.ibm.com>
    Cc: Jiri Olsa <jolsa@redhat.com>
    Cc: Naveen N. Rao <naveen.n.rao@linux.vnet.ibm.com>
    Cc: Sukadev Bhattiprolu <sukadev@linux.vnet.ibm.com>
    Link: http://lkml.kernel.org/r/20180611104049.11048-1-sandipan@linux.ibm.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f33194bca6c3ac011f290c884219474b84bde6c5
Author: Thomas Richter <tmricht@linux.ibm.com>
Date:   Mon Jun 11 09:31:53 2018 +0200

    perf test session topology: Fix test on s390
    
    [ Upstream commit b930e62ecd362843002bdf84c2940439822af321 ]
    
    On s390 this test case fails because the socket identifiction numbers
    assigned to the CPU are higher than the CPU identification numbers.
    
    F/ix this by adding the platform architecture into the perf data header
    flag information. This helps identifiing the test platform and handles
    s390 specifics in process_cpu_topology().
    
    Before:
    
      [root@p23lp27 perf]# perf test -vvvvv -F 39
      39: Session topology                                      :
      --- start ---
      templ file: /tmp/perf-test-iUv755
      socket_id number is too big.You may need to upgrade the perf tool.
      ---- end ----
      Session topology: Skip
      [root@p23lp27 perf]#
    
    After:
    
      [root@p23lp27 perf]# perf test -vvvvv -F 39
      39: Session topology                                      :
      --- start ---
      templ file: /tmp/perf-test-8X8VTs
      CPU 0, core 0, socket 6
      CPU 1, core 1, socket 3
      ---- end ----
      Session topology: Ok
      [root@p23lp27 perf]#
    
    Signed-off-by: Thomas Richter <tmricht@linux.ibm.com>
    Reviewed-by: Hendrik Brueckner <brueckner@linux.ibm.com>
    Cc: Heiko Carstens <heiko.carstens@de.ibm.com>
    Cc: Martin Schwidefsky <schwidefsky@de.ibm.com>
    Fixes: c84974ed9fb6 ("perf test: Add entry to test cpu topology")
    Link: http://lkml.kernel.org/r/20180611073153.15592-2-tmricht@linux.ibm.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6367516474c8589510b5ce8b2ccf68dff40ecc8b
Author: Thomas Richter <tmricht@linux.ibm.com>
Date:   Mon Jun 11 09:31:52 2018 +0200

    perf record: Support s390 random socket_id assignment
    
    [ Upstream commit 01766229533f9bdb1144a41b4345c8c7286da7b4 ]
    
    On s390 the socket identifier assigned to a CPU identifier is random and
    (depending on the configuration of the LPAR) may be higher than the CPU
    identifier. This is currently not supported.
    
    Fix this by allowing arbitrary socket identifiers being assigned to
    CPU id.
    
    Output before:
    
      [root@p23lp27 perf]# ./perf report --header -I -v
      ...
      socket_id number is too big.You may need to upgrade the perf tool.
      Error:
      The perf.data file has no samples!
      # ========
      # captured on    : Tue May 29 09:29:57 2018
      # header version : 1
      ...
      # Core ID and Socket ID information is not available
      ...
      [root@p23lp27 perf]#
    
    Output after:
    
      [root@p23lp27 perf]# ./perf report --header -I -v
      ...
      Error:
      The perf.data file has no samples!
      # ========
      # captured on    : Tue May 29 09:29:57 2018
      # header version : 1
      ...
      # CPU 0: Core ID 0, Socket ID 6
      # CPU 1: Core ID 1, Socket ID 3
      # CPU 2: Core ID -1, Socket ID -1
      ...
      [root@p23lp27 perf]#
    
    Signed-off-by: Thomas Richter <tmricht@linux.ibm.com>
    Reviewed-by: Hendrik Brueckner <brueckner@linux.ibm.com>
    Cc: Heiko Carstens <heiko.carstens@de.ibm.com>
    Cc: Martin Schwidefsky <schwidefsky@de.ibm.com>
    Link: http://lkml.kernel.org/r/20180611073153.15592-1-tmricht@linux.ibm.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2f9e98dbccf7fe27eb6fc218d81befc5d3056ca2
Author: Dirk Gouders <dirk@gouders.net>
Date:   Thu Jun 21 15:30:54 2018 +0200

    kconfig: fix line numbers for if-entries in menu tree
    
    [ Upstream commit b2d00d7c61c84edd150310af3f556f8a3c6e2e67 ]
    
    The line numers for if-entries in the menu tree are off by one or more
    lines which is confusing when debugging for correctness of unrelated changes.
    
    According to the git log, commit a02f0570ae201c49 (kconfig: improve
    error handling in the parser) was the last one that changed that part
    of the parser and replaced
    
            "if_entry: T_IF expr T_EOL"
    by
            "if_entry: T_IF expr nl"
    
    but the commit message does not state why this has been done.
    
    When reverting that part of the commit, only the line numers are
    corrected (checked with cdebug = DEBUG_PARSE in zconf.y), otherwise
    the menu tree remains unchanged (checked with zconfdump() enabled in
    conf.c).
    
    An example for the corrected line numbers:
    
    drivers/soc/Kconfig:15:source drivers/soc/tegra/Kconfig
    drivers/soc/tegra/Kconfig:4:if
    drivers/soc/tegra/Kconfig:6:if
    
    changes to:
    
    drivers/soc/Kconfig:15:source drivers/soc/tegra/Kconfig
    drivers/soc/tegra/Kconfig:1:if
    drivers/soc/tegra/Kconfig:4:if
    
    Signed-off-by: Dirk Gouders <dirk@gouders.net>
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5a64e0870cc1db2be77bbb95d209d7dcb2186686
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Thu Jun 7 16:17:14 2018 +0300

    typec: tcpm: Fix a msecs vs jiffies bug
    
    [ Upstream commit 9578bcd0bb487b8ecef4b7eee799aafb678aa441 ]
    
    The tcpm_set_state() function take msecs not jiffies.
    
    Fixes: f0690a25a140 ("staging: typec: USB Type-C Port Manager (tcpm)")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Acked-by: Heikki Krogerus <heikki.krogerus@linux.intel.com>
    Reviewed-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d341ce9a63dc3058293ae833107b42a5b40a6139
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Thu Jun 7 15:54:48 2018 +0200

    NFC: pn533: Fix wrong GFP flag usage
    
    [ Upstream commit ecc443c03fb14abfb8a6af5e3b2d43b5257e60f2 ]
    
    pn533_recv_response() is an urb completion handler, so it must use
    GFP_ATOMIC. pn533_usb_send_frame() OTOH runs from a regular sleeping
    context, so the pn533_submit_urb_for_response() there (and only there)
    can use the regular GFP_KERNEL flags.
    
    BugLink: https://bugzilla.redhat.com/show_bug.cgi?id=1514134
    Fixes: 9815c7cf22da ("NFC: pn533: Separate physical layer from ...")
    Cc: Michael Thalmeier <michael.thalmeier@hale.at>
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8a7ac5ee6856acb2487cd657e538d55324e29d45
Author: Ajay Gupta <ajaykuee@gmail.com>
Date:   Thu Jun 21 16:19:45 2018 +0300

    usb: xhci: increase CRS timeout value
    
    [ Upstream commit 305886ca87be480ae159908c2affd135c04215cf ]
    
    Some controllers take almost 55ms to complete controller
    restore state (CRS).
    There is no timeout limit mentioned in xhci specification so
    fixing the issue by increasing the timeout limit to 100ms
    
    [reformat code comment -Mathias]
    Signed-off-by: Ajay Gupta <ajaykuee@gmail.com>
    Signed-off-by: Nagaraj Annaiah <naga.annaiah@gmail.com>
    Signed-off-by: Mathias Nyman <mathias.nyman@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 13a049bebb760d185ffc04f0a3c73efd9aec87f0
Author: Dongjiu Geng <gengdongjiu@huawei.com>
Date:   Thu Jun 21 16:19:43 2018 +0300

    usb: xhci: remove the code build warning
    
    [ Upstream commit 36eb93509c45d0bdbd8d09a01ab9d857972f5963 ]
    
    Initialize the 'err' variate to remove the build warning,
    the warning is shown as below:
    
    drivers/usb/host/xhci-tegra.c: In function 'tegra_xusb_mbox_thread':
    drivers/usb/host/xhci-tegra.c:552:6: warning: 'err' may be used uninitialized in this function [-Wuninitialized]
    drivers/usb/host/xhci-tegra.c:482:6: note: 'err' was declared here
    
    Fixes: e84fce0f8837 ("usb: xhci: Add NVIDIA Tegra XUSB controller driver")
    Signed-off-by: Dongjiu Geng <gengdongjiu@huawei.com>
    Acked-by: Thierry Reding <treding@nvidia.com>
    Acked-by: Jon Hunter <jonathanh@nvidia.com>
    Signed-off-by: Mathias Nyman <mathias.nyman@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b171162cbd941b24f5663ee853a2733b0fd9087a
Author: Takashi Iwai <tiwai@suse.de>
Date:   Mon Jun 25 11:13:59 2018 +0200

    ALSA: seq: Fix UBSAN warning at SNDRV_SEQ_IOCTL_QUERY_NEXT_CLIENT ioctl
    
    [ Upstream commit c9a4c63888dbb79ce4d068ca1dd8b05bc3f156b1 ]
    
    The kernel may spew a WARNING with UBSAN undefined behavior at
    handling ALSA sequencer ioctl SNDRV_SEQ_IOCTL_QUERY_NEXT_CLIENT:
    
    UBSAN: Undefined behaviour in sound/core/seq/seq_clientmgr.c:2007:14
    signed integer overflow:
    2147483647 + 1 cannot be represented in type 'int'
    Call Trace:
     __dump_stack lib/dump_stack.c:77 [inline]
     dump_stack+0x122/0x1c8 lib/dump_stack.c:113
     ubsan_epilogue+0x12/0x86 lib/ubsan.c:159
     handle_overflow+0x1c2/0x21f lib/ubsan.c:190
      __ubsan_handle_add_overflow+0x2a/0x31 lib/ubsan.c:198
     snd_seq_ioctl_query_next_client+0x1ac/0x1d0 sound/core/seq/seq_clientmgr.c:2007
     snd_seq_ioctl+0x264/0x3d0 sound/core/seq/seq_clientmgr.c:2144
     ....
    
    It happens only when INT_MAX is passed there, as we're incrementing it
    unconditionally.  So the fix is trivial, check the value with
    INT_MAX.  Although the bug itself is fairly harmless, it's better to
    fix it so that fuzzers won't hit this again later.
    
    Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=200211
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 36bc1e1e69beb66b1f9e1ac157ec8efefb84972f
Author: Daniel Mack <daniel@zonque.org>
Date:   Sun Jun 17 13:53:09 2018 +0200

    ARM: dts: am437x: make edt-ft5x06 a wakeup source
    
    [ Upstream commit 49a6ec5b807ea4ad7ebe1f58080ebb8497cb2d2c ]
    
    The touchscreen driver no longer configures the device as wakeup source by
    default. A "wakeup-source" property is needed.
    
    Signed-off-by: Daniel Mack <daniel@zonque.org>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fc3b4e774cec694e3f7444adb5d16c974f4430bf
Author: Michael Trimarchi <michael@amarulasolutions.com>
Date:   Wed May 30 11:06:34 2018 +0200

    brcmfmac: stop watchdog before detach and free everything
    
    [ Upstream commit 373c83a801f15b1e3d02d855fad89112bd4ccbe0 ]
    
    Using built-in in kernel image without a firmware in filesystem
    or in the kernel image can lead to a kernel NULL pointer deference.
    Watchdog need to be stopped in brcmf_sdio_remove
    
    The system is going down NOW!
    [ 1348.110759] Unable to handle kernel NULL pointer dereference at virtual address 000002f8
    Sent SIGTERM to all processes
    [ 1348.121412] Mem abort info:
    [ 1348.126962]   ESR = 0x96000004
    [ 1348.130023]   Exception class = DABT (current EL), IL = 32 bits
    [ 1348.135948]   SET = 0, FnV = 0
    [ 1348.138997]   EA = 0, S1PTW = 0
    [ 1348.142154] Data abort info:
    [ 1348.145045]   ISV = 0, ISS = 0x00000004
    [ 1348.148884]   CM = 0, WnR = 0
    [ 1348.151861] user pgtable: 4k pages, 48-bit VAs, pgdp = (____ptrval____)
    [ 1348.158475] [00000000000002f8] pgd=0000000000000000
    [ 1348.163364] Internal error: Oops: 96000004 [#1] PREEMPT SMP
    [ 1348.168927] Modules linked in: ipv6
    [ 1348.172421] CPU: 3 PID: 1421 Comm: brcmf_wdog/mmc0 Not tainted 4.17.0-rc5-next-20180517 #18
    [ 1348.180757] Hardware name: Amarula A64-Relic (DT)
    [ 1348.185455] pstate: 60000005 (nZCv daif -PAN -UAO)
    [ 1348.190251] pc : brcmf_sdiod_freezer_count+0x0/0x20
    [ 1348.195124] lr : brcmf_sdio_watchdog_thread+0x64/0x290
    [ 1348.200253] sp : ffff00000b85be30
    [ 1348.203561] x29: ffff00000b85be30 x28: 0000000000000000
    [ 1348.208868] x27: ffff00000b6cb918 x26: ffff80003b990638
    [ 1348.214176] x25: ffff0000087b1a20 x24: ffff80003b94f800
    [ 1348.219483] x23: ffff000008e620c8 x22: ffff000008f0b660
    [ 1348.224790] x21: ffff000008c6a858 x20: 00000000fffffe00
    [ 1348.230097] x19: ffff80003b94f800 x18: 0000000000000001
    [ 1348.235404] x17: 0000ffffab2e8a74 x16: ffff0000080d7de8
    [ 1348.240711] x15: 0000000000000000 x14: 0000000000000400
    [ 1348.246018] x13: 0000000000000400 x12: 0000000000000001
    [ 1348.251324] x11: 00000000000002c4 x10: 0000000000000a10
    [ 1348.256631] x9 : ffff00000b85bc40 x8 : ffff80003be11870
    [ 1348.261937] x7 : ffff80003dfc7308 x6 : 000000078ff08b55
    [ 1348.267243] x5 : 00000139e1058400 x4 : 0000000000000000
    [ 1348.272550] x3 : dead000000000100 x2 : 958f2788d6618100
    [ 1348.277856] x1 : 00000000fffffe00 x0 : 0000000000000000
    
    Signed-off-by: Michael Trimarchi <michael@amarulasolutions.com>
    Acked-by: Arend van Spriel <arend.vanspriel@broadcom.com>
    Tested-by: Andy Shevchenko <andy.shevchenko@gmail.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dc68381f4919fc312dd7a16871304264c0d2fa1c
Author: Tomasz Duszynski <tduszyns@gmail.com>
Date:   Mon May 28 17:38:59 2018 +0200

    iio: pressure: bmp280: fix relative humidity unit
    
    [ Upstream commit 13399ff25f179811ce9c1df1523eb39f9e4a4772 ]
    
    According to IIO ABI relative humidity reading should be
    returned in milli percent.
    
    This patch addresses that by applying proper scaling and
    returning integer instead of fractional format type specifier.
    
    Note that the fixes tag is before the driver was heavily refactored
    to introduce spi support, so the patch won't apply that far back.
    
    Signed-off-by: Tomasz Duszynski <tduszyns@gmail.com>
    Fixes: 14beaa8f5ab1 ("iio: pressure: bmp280: add humidity support")
    Acked-by: Matt Ranostay <matt.ranostay@konsulko.com>
    Signed-off-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9265a4509509eed4005fda908de5a154cc8c7e41
Author: Ganesh Goudar <ganeshgr@chelsio.com>
Date:   Sat Jun 23 20:28:26 2018 +0530

    cxgb4: when disabling dcb set txq dcb priority to 0
    
    [ Upstream commit 5ce36338a30f9814fc4824f9fe6c20cd83d872c7 ]
    
    When we are disabling DCB, store "0" in txq->dcb_prio
    since that's used for future TX Work Request "OVLAN_IDX"
    values. Setting non zero priority upon disabling DCB
    would halt the traffic.
    
    Reported-by: AMG Zollner Robert <robert@cloudmedia.eu>
    CC: David Ahern <dsa@cumulusnetworks.com>
    Signed-off-by: Casey Leedom <leedom@chelsio.com>
    Signed-off-by: Ganesh Goudar <ganeshgr@chelsio.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 04954b2dca347ff9ec47ca9f0baaf5d27b384d10
Author: Linus Lüssing <linus.luessing@c0d3.blue>
Date:   Thu Jun 7 00:46:24 2018 +0200

    batman-adv: Fix multicast TT issues with bogus ROAM flags
    
    [ Upstream commit a44ebeff6bbd6ef50db41b4195fca87b21aefd20 ]
    
    When a (broken) node wrongly sends multicast TT entries with a ROAM
    flag then this causes any receiving node to drop all entries for the
    same multicast MAC address announced by other nodes, leading to
    packet loss.
    
    Fix this DoS vector by only storing TT sync flags. For multicast TT
    non-sync'ing flag bits like ROAM are unused so far anyway.
    
    Fixes: 1d8ab8d3c176 ("batman-adv: Modified forwarding behaviour for multicast packets")
    Reported-by: Leonardo Mörlein <me@irrelefant.net>
    Signed-off-by: Linus Lüssing <linus.luessing@c0d3.blue>
    Signed-off-by: Simon Wunderlich <sw@simonwunderlich.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 44fed77fc7e45e0fe6c41286df9134d747b2bd73
Author: Linus Lüssing <linus.luessing@c0d3.blue>
Date:   Thu Jun 7 00:46:23 2018 +0200

    batman-adv: Avoid storing non-TT-sync flags on singular entries too
    
    [ Upstream commit 4a519b83da16927fb98fd32b0f598e639d1f1859 ]
    
    Since commit 54e22f265e87 ("batman-adv: fix TT sync flag inconsistencies")
    TT sync flags and TT non-sync'd flags are supposed to be stored
    separately.
    
    The previous patch missed to apply this separation on a TT entry with
    only a single TT orig entry.
    
    This is a minor fix because with only a single TT orig entry the DDoS
    issue the former patch solves does not apply.
    
    Fixes: 54e22f265e87 ("batman-adv: fix TT sync flag inconsistencies")
    Signed-off-by: Linus Lüssing <linus.luessing@c0d3.blue>
    Signed-off-by: Sven Eckelmann <sven@narfation.org>
    Signed-off-by: Simon Wunderlich <sw@simonwunderlich.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d50e1f18eacef0a50be5a20da2dc1c8cc8af544b
Author: Sven Eckelmann <sven@narfation.org>
Date:   Sat Jun 2 17:26:35 2018 +0200

    batman-adv: Fix bat_v best gw refcnt after netlink dump
    
    [ Upstream commit 9713cb0cf19f1cec6c007e3b37be0697042b6720 ]
    
    A reference for the best gateway is taken when the list of gateways in the
    mesh is sent via netlink. This is necessary to check whether the currently
    dumped entry is the currently selected gateway or not. This information is
    then transferred as flag BATADV_ATTR_FLAG_BEST.
    
    After the comparison of the current entry is done,
    batadv_v_gw_dump_entry() has to decrease the reference counter again.
    Otherwise the reference will be held and thus prevents a proper shutdown of
    the batman-adv interfaces (and some of the interfaces enslaved in it).
    
    Fixes: b71bb6f924fe ("batman-adv: add B.A.T.M.A.N. V bat_gw_dump implementations")
    Signed-off-by: Sven Eckelmann <sven@narfation.org>
    Acked-by: Marek Lindner <mareklindner@neomailbox.ch>
    Signed-off-by: Simon Wunderlich <sw@simonwunderlich.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cc210a039ed1812b2ccca6741cd7ea4fa5ff4e4c
Author: Sven Eckelmann <sven@narfation.org>
Date:   Sat Jun 2 17:26:34 2018 +0200

    batman-adv: Fix bat_ogm_iv best gw refcnt after netlink dump
    
    [ Upstream commit b5685d2687d6612adf5eac519eb7008f74dfd1ec ]
    
    A reference for the best gateway is taken when the list of gateways in the
    mesh is sent via netlink. This is necessary to check whether the currently
    dumped entry is the currently selected gateway or not. This information is
    then transferred as flag BATADV_ATTR_FLAG_BEST.
    
    After the comparison of the current entry is done,
    batadv_iv_gw_dump_entry() has to decrease the reference counter again.
    Otherwise the reference will be held and thus prevents a proper shutdown of
    the batman-adv interfaces (and some of the interfaces enslaved in it).
    
    Fixes: efb766af06e3 ("batman-adv: add B.A.T.M.A.N. IV bat_gw_dump implementations")
    Reported-by: Andreas Ziegler <dev@andreas-ziegler.de>
    Tested-by: Andreas Ziegler <dev@andreas-ziegler.de>
    Signed-off-by: Sven Eckelmann <sven@narfation.org>
    Acked-by: Marek Lindner <mareklindner@neomailbox.ch>
    Signed-off-by: Simon Wunderlich <sw@simonwunderlich.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7634aad31a7374af49df2ad1077ad685d561a5fe
Author: Rob Herring <robh@kernel.org>
Date:   Tue May 8 10:09:51 2018 -0500

    arm64: dts: msm8916: fix Coresight ETF graph connections
    
    [ Upstream commit 6b4154a655a258c67bcfabbd4c3a06637e74ebcd ]
    
    The ETF input should be connected to the funnel output, and the ETF
    output should be connected to the replicator input. The labels are wrong
    and these got swapped:
    
    Warning (graph_endpoint): /soc/funnel@821000/ports/port@8/endpoint: graph connection to node '/soc/etf@825000/ports/port@1/endpoint' is not bidirectional
    Warning (graph_endpoint): /soc/replicator@824000/ports/port@2/endpoint: graph connection to node '/soc/etf@825000/ports/port@0/endpoint' is not bidirectional
    
    Fixes: 7c10da373698 ("arm64: dts: qcom: Add msm8916 CoreSight components")
    Cc: Ivan T. Ivanov <ivan.ivanov@linaro.org>
    Cc: Mathieu Poirier <mathieu.poirier@linaro.org>
    Cc: Andy Gross <andy.gross@linaro.org>
    Cc: David Brown <david.brown@linaro.org>
    Cc: linux-arm-msm@vger.kernel.org
    Signed-off-by: Rob Herring <robh@kernel.org>
    Reviewed-by: Mathieu Poirier <mathieu.poirier@linaro.org>
    Tested-by: Mathieu Poirier <mathieu.poirier@linaro.org>
    Signed-off-by: Andy Gross <andy.gross@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4545cfb006b72c017b75eba3bb71deb34e290e0d
Author: Casey Schaufler <casey@schaufler-ca.com>
Date:   Fri Jun 22 10:54:45 2018 -0700

    Smack: Mark inode instant in smack_task_to_inode
    
    [ Upstream commit 7b4e88434c4e7982fb053c49657e1c8bbb8692d9 ]
    
    Smack: Mark inode instant in smack_task_to_inode
    
    /proc clean-up in commit 1bbc55131e59bd099fdc568d3aa0b42634dbd188
    resulted in smack_task_to_inode() being called before smack_d_instantiate.
    This resulted in the smk_inode value being ignored, even while present
    for files in /proc/self. Marking the inode as instant here fixes that.
    
    Signed-off-by: Casey Schaufler <casey@schaufler-ca.com>
    Signed-off-by: James Morris <james.morris@microsoft.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f8e7a1bd752a73a59238389eb395eaecc636c8e9
Author: Hangbin Liu <liuhangbin@gmail.com>
Date:   Thu Jun 21 19:49:36 2018 +0800

    ipv6: mcast: fix unsolicited report interval after receiving querys
    
    [ Upstream commit 6c6da92808442908287fae8ebb0ca041a52469f4 ]
    
    After recieving MLD querys, we update idev->mc_maxdelay with max_delay
    from query header. This make the later unsolicited reports have the same
    interval with mc_maxdelay, which means we may send unsolicited reports with
    long interval time instead of default configured interval time.
    
    Also as we will not call ipv6_mc_reset() after device up. This issue will
    be there even after leave the group and join other groups.
    
    Fixes: fc4eba58b4c14 ("ipv6: make unsolicited report intervals configurable for mld")
    Signed-off-by: Hangbin Liu <liuhangbin@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b580cead624b5e0471cd418b3c0a6f20d15e95ba
Author: Zhenzhong Duan <zhenzhong.duan@oracle.com>
Date:   Fri Jun 22 13:51:26 2018 +0200

    x86/microcode/intel: Fix memleak in save_microcode_patch()
    
    [ Upstream commit 0218c766263e70795c5eaa17d75ed54bca350950 ]
    
    Free useless ucode_patch entry when it's replaced.
    
    [ bp: Drop the memfree_patch() two-liner. ]
    
    Signed-off-by: Zhenzhong Duan <zhenzhong.duan@oracle.com>
    Signed-off-by: Borislav Petkov <bp@suse.de>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Cc: Srinivas REDDY Eeda <srinivas.eeda@oracle.com>
    Link: http://lkml.kernel.org/r/888102f0-fd22-459d-b090-a1bd8a00cb2b@default
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 99654c9ffcea2d835283aa8c570432bd03ca6943
Author: Geert Uytterhoeven <geert@linux-m68k.org>
Date:   Fri Jun 22 09:04:25 2018 +0200

    mtd: dataflash: Use ULL suffix for 64-bit constants
    
    [ Upstream commit cbdceb9b3e1928554fffd0d889adf2d0d8edee4d ]
    
    With gcc 4.1.2 when compiling for 32-bit:
    
        drivers/mtd/devices/mtd_dataflash.c:736: warning: integer constant is too large for ‘long’ type
        drivers/mtd/devices/mtd_dataflash.c:737: warning: integer constant is too large for ‘long’ type
    
    Add the missing "ULL" suffixes to fix this.
    
    Fixes: 67e4145ebf2c161d ("mtd: dataflash: Add flash_info for AT45DB641E")
    Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Acked-by: Andrey Smirnov <andrew.smirnov@gmail.com>
    Signed-off-by: Boris Brezillon <boris.brezillon@bootlin.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a17ea7fb07acfe4fe2da93a42849137c29740b53
Author: Jeffrin Jose T <ahiliation@gmail.com>
Date:   Thu Jun 21 22:30:20 2018 +0530

    selftests: bpf: notification about privilege required to run test_kmod.sh testing script
    
    [ Upstream commit 81e167c2a216e7b54e6add9d2badcda267fe33b1 ]
    
    The test_kmod.sh script require root privilege for the successful
    execution of the test.
    
    This patch is to notify the user about the privilege the script
    demands for the successful execution of the test.
    
    Signed-off-by: Jeffrin Jose T (Rajagiri SET) <ahiliation@gmail.com>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c55300fcac1c15eb065eac626e17bd7b6d110346
Author: Steven Rostedt (VMware) <rostedt@goodmis.org>
Date:   Wed Apr 4 14:06:30 2018 -0400

    locking/lockdep: Do not record IRQ state within lockdep code
    
    [ Upstream commit fcc784be837714a9173b372ff9fb9b514590dad9 ]
    
    While debugging where things were going wrong with mapping
    enabling/disabling interrupts with the lockdep state and actual real
    enabling and disabling interrupts, I had to silent the IRQ
    disabling/enabling in debug_check_no_locks_freed() because it was
    always showing up as it was called before the splat was.
    
    Use raw_local_irq_save/restore() for not only debug_check_no_locks_freed()
    but for all internal lockdep functions, as they hide useful information
    about where interrupts were used incorrectly last.
    
    Signed-off-by: Steven Rostedt (VMware) <rostedt@goodmis.org>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: Will Deacon <will.deacon@arm.com>
    Link: https://lkml.kernel.org/lkml/20180404140630.3f4f4c7a@gandalf.local.home
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 097a82cb1a71f977a29b888d66620edac9d7c932
Author: Maciej Purski <m.purski@samsung.com>
Date:   Tue Jan 23 12:17:19 2018 +0100

    drm/bridge/sii8620: fix display of packed pixel modes in MHL2
    
    [ Upstream commit e8b92efa629dac0e70ea4145c5e70616de5f89c8 ]
    
    Currently packed pixel modes in MHL2 can't be displayed. The device
    automatically recognizes output format, so setting format other than
    RGB causes failure. Fix it by writing proper values to registers.
    
    Tested on MHL1 and MHL2 using various vendors' dongles both in
    DVI and HDMI mode.
    
    Signed-off-by: Maciej Purski <m.purski@samsung.com>
    Signed-off-by: Andrzej Hajda <a.hajda@samsung.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/1516706239-9104-1-git-send-email-m.purski@samsung.com
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7a21294b84fa7df3b4a894cbde4ca7fc2dfd3047
Author: Ard Biesheuvel <ardb@kernel.org>
Date:   Fri Jun 1 17:06:28 2018 +0200

    KVM: arm/arm64: Drop resource size check for GICV window
    
    [ Upstream commit ba56bc3a0786992755e6804fbcbdc60ef6cfc24c ]
    
    When booting a 64 KB pages kernel on a ACPI GICv3 system that
    implements support for v2 emulation, the following warning is
    produced
    
      GICV size 0x2000 not a multiple of page size 0x10000
    
    and support for v2 emulation is disabled, preventing GICv2 VMs
    from being able to run on such hosts.
    
    The reason is that vgic_v3_probe() performs a sanity check on the
    size of the window (it should be a multiple of the page size),
    while the ACPI MADT parsing code hardcodes the size of the window
    to 8 KB. This makes sense, considering that ACPI does not bother
    to describe the size in the first place, under the assumption that
    platforms implementing ACPI will follow the architecture and not
    put anything else in the same 64 KB window.
    
    So let's just drop the sanity check altogether, and assume that
    the window is at least 64 KB in size.
    
    Fixes: 909777324588 ("KVM: arm/arm64: vgic-new: vgic_init: implement kvm_vgic_hyp_init")
    Signed-off-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
    Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8fb20507bca0f610b44e5c38c9052a03f8225dfe
Author: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>
Date:   Wed Jun 20 12:47:52 2018 -0300

    sctp: fix erroneous inc of snmp SctpFragUsrMsgs
    
    [ Upstream commit fedb1bd3d274b33c432cb83c80c6b3cf54d509c8 ]
    
    Currently it is incrementing SctpFragUsrMsgs when the user message size
    is of the exactly same size as the maximum fragment size, which is wrong.
    
    The fix is to increment it only when user message is bigger than the
    maximum fragment size.
    
    Fixes: bfd2e4b8734d ("sctp: refactor sctp_datamsg_from_user")
    Signed-off-by: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>
    Acked-by: Neil Horman <nhorman@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 363b8de31ac91621865c3bc4e9838be86f64519f
Author: Bartosz Golaszewski <bgolaszewski@baylibre.com>
Date:   Wed Jun 20 10:03:56 2018 +0200

    net: davinci_emac: match the mdio device against its compatible if possible
    
    [ Upstream commit ea0820bb771175c7d4192fc6f5b5c56b3c6d5239 ]
    
    Device tree based systems without of_dev_auxdata will have the mdio
    device named differently than "davinci_mdio(.0)". In this case use the
    device's parent's compatible string for matching
    
    Signed-off-by: Bartosz Golaszewski <bgolaszewski@baylibre.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9b0b625841d89e94f7c5321a2bfe8ccbea8b8bb1
Author: Doron Roberts-Kedes <doronrk@fb.com>
Date:   Fri Jun 15 14:05:32 2018 -0700

    nbd: Add the nbd NBD_DISCONNECT_ON_CLOSE config flag.
    
    [ Upstream commit 08ba91ee6e2c1c08d3f0648f978cbb5dbf3491d8 ]
    
    If NBD_DISCONNECT_ON_CLOSE is set on a device, then the driver will
    issue a disconnect from nbd_release if the device has no remaining
    bdev->bd_openers.
    
    Fix ret val so reconfigure with only setting the flag succeeds.
    
    Reviewed-by: Josef Bacik <josef@toxicpanda.com>
    Signed-off-by: Doron Roberts-Kedes <doronrk@fb.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fbeb2ee3ecca6ad25957a08e9ae69cb67071528d
Author: Alexey Brodkin <Alexey.Brodkin@synopsys.com>
Date:   Wed Nov 29 11:21:45 2017 +0300

    ARC: Enable machine_desc->init_per_cpu for !CONFIG_SMP
    
    [ Upstream commit 2f24ef7413a4d91657ef04e77c27ce0b313e6c95 ]
    
    machine_desc->init_per_cpu() hook is supposed to be per cpu
    initialization and would seem to apply  equally to UP and/or SMP.
    Infact the comment in header file seems to suggest it works for
    UP too, which was not the case and this patch.
    
    This enables !CONFIG_SMP build for platforms such as hsdk.
    
    Signed-off-by: Alexey Brodkin <abrodkin@synopsys.com>
    Signed-off-by: Vineet Gupta <vgupta@synopsys.com>
    [vgupta: trimmeed changelog]
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6d2b87505f7a59b464a59e1d0870aa26d0b1f0e1
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Wed Jun 20 13:41:51 2018 +0300

    block: sed-opal: Fix a couple off by one bugs
    
    [ Upstream commit ce042c183bcb94eb2919e8036473a1fc203420f9 ]
    
    resp->num is the number of tokens in resp->tok[].  It gets set in
    response_parse().  So if n == resp->num then we're reading beyond the
    end of the data.
    
    Fixes: 455a7b238cd6 ("block: Add Sed-opal library")
    Reviewed-by: Scott Bauer <scott.bauer@intel.com>
    Tested-by: Scott Bauer <scott.bauer@intel.com>
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 955887c1fe90a2be056358001fd4920614a0f8b6
Author: Max Gurtuvoy <maxg@mellanox.com>
Date:   Tue Jun 19 15:45:33 2018 +0300

    nvmet: reset keep alive timer in controller enable
    
    [ Upstream commit d68a90e148f5a82aa67654c5012071e31c0e4baa ]
    
    Controllers that are not yet enabled should not really enforce keep alive
    timeouts, but we still want to track a timeout and cleanup in case a host
    died before it enabled the controller.  Hence, simply reset the keep
    alive timer when the controller is enabled.
    
    Suggested-by: Max Gurtovoy <maxg@mellanox.com>
    Signed-off-by: Sagi Grimberg <sagi@grimberg.me>
    Signed-off-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 62e4c9049e869e34bcc321aac6a16c79c30946e4
Author: Dinh Nguyen <dinguyen@kernel.org>
Date:   Tue Jun 19 10:35:38 2018 -0500

    net: stmmac: socfpga: add additional ocp reset line for Stratix10
    
    [ Upstream commit bc8a2d9bcbf1ca548b1deb315d14e1da81945bea ]
    
    The Stratix10 platform has an additional reset line, OCP(Open Core Protocol),
    that also needs to get deasserted for the stmmac ethernet controller to work.
    Thus we need to update the Kconfig to include ARCH_STRATIX10 in order to build
    dwmac-socfpga.
    
    Also, remove the redundant check for the reset controller pointer. The
    reset driver already checks for the pointer and returns 0 if the pointer
    is NULL.
    
    Signed-off-by: Dinh Nguyen <dinguyen@kernel.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e0eaae3872840ab8b57457da9b2a82551136168d
Author: Li RongQing <lirongqing@baidu.com>
Date:   Tue Jun 19 17:23:17 2018 +0800

    net: propagate dev_get_valid_name return code
    
    [ Upstream commit 7892bd081045222b9e4027fec279a28d6fe7aa66 ]
    
    if dev_get_valid_name failed, propagate its return code
    
    and remove the setting err to ENODEV, it will be set to
    0 again before dev_change_net_namespace exits.
    
    Signed-off-by: Li RongQing <lirongqing@baidu.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7c828ea375a19f84f3f1c0546adc05766102aa6f
Author: Stefan Agner <stefan@agner.ch>
Date:   Sun Jun 17 23:40:53 2018 +0200

    net: hamradio: use eth_broadcast_addr
    
    [ Upstream commit 4e8439aa34802deab11cee68b0ecb18f887fb153 ]
    
    The array bpq_eth_addr is only used to get the size of an
    address, whereas the bcast_addr is used to set the broadcast
    address. This leads to a warning when using clang:
    drivers/net/hamradio/bpqether.c:94:13: warning: variable 'bpq_eth_addr' is not
          needed and will not be emitted [-Wunneeded-internal-declaration]
    static char bpq_eth_addr[6];
                ^
    
    Remove both variables and use the common eth_broadcast_addr
    to set the broadcast address.
    
    Signed-off-by: Stefan Agner <stefan@agner.ch>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fb24c6df0f8ec986894b77baec225679de3a0d78
Author: Govindarajulu Varadarajan <gvaradar@cisco.com>
Date:   Tue Jun 19 08:15:24 2018 -0700

    enic: initialize enic->rfs_h.lock in enic_probe
    
    [ Upstream commit 3256d29fc7aecdf99feb1cb9475ed2252769a8a7 ]
    
    lockdep spotted that we are using rfs_h.lock in enic_get_rxnfc() without
    initializing. rfs_h.lock is initialized in enic_open(). But ethtool_ops
    can be called when interface is down.
    
    Move enic_rfs_flw_tbl_init to enic_probe.
    
    INFO: trying to register non-static key.
    the code is fine but needs lockdep annotation.
    turning off the locking correctness validator.
    CPU: 18 PID: 1189 Comm: ethtool Not tainted 4.17.0-rc7-devel+ #27
    Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.11.0-20171110_100015-anatol 04/01/2014
    Call Trace:
    dump_stack+0x85/0xc0
    register_lock_class+0x550/0x560
    ? __handle_mm_fault+0xa8b/0x1100
    __lock_acquire+0x81/0x670
    lock_acquire+0xb9/0x1e0
    ?  enic_get_rxnfc+0x139/0x2b0 [enic]
    _raw_spin_lock_bh+0x38/0x80
    ? enic_get_rxnfc+0x139/0x2b0 [enic]
    enic_get_rxnfc+0x139/0x2b0 [enic]
    ethtool_get_rxnfc+0x8d/0x1c0
    dev_ethtool+0x16c8/0x2400
    ? __mutex_lock+0x64d/0xa00
    ? dev_load+0x6a/0x150
    dev_ioctl+0x253/0x4b0
    sock_do_ioctl+0x9a/0x130
    sock_ioctl+0x1af/0x350
    do_vfs_ioctl+0x8e/0x670
    ? syscall_trace_enter+0x1e2/0x380
    ksys_ioctl+0x60/0x90
    __x64_sys_ioctl+0x16/0x20
    do_syscall_64+0x5a/0x170
    entry_SYSCALL_64_after_hwframe+0x49/0xbe
    
    Signed-off-by: Govindarajulu Varadarajan <gvaradar@cisco.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9418ea8cf216abcbed3f3a5a2cea755d3aaa415b
Author: Sudarsana Reddy Kalluru <sudarsana.kalluru@cavium.com>
Date:   Mon Jun 18 21:58:02 2018 -0700

    qed: Do not advertise DCBX_LLD_MANAGED capability.
    
    [ Upstream commit ff54d5cd9ec15546abc870452dd0b66eef4b4606 ]
    
    Do not advertise DCBX_LLD_MANAGED capability i.e., do not allow
    external agent to manage the dcbx/lldp negotiation. MFW acts as lldp agent
    for qed* devices, and no other lldp agent is allowed to coexist with mfw.
    
    Also updated a debug print, to not to display the redundant info.
    
    Fixes: a1d8d8a51 ("qed: Add dcbnl support.")
    Signed-off-by: Sudarsana Reddy Kalluru <Sudarsana.Kalluru@cavium.com>
    Signed-off-by: Ariel Elior <ariel.elior@cavium.com>
    Signed-off-by: Michal Kalderon <Michal.Kalderon@cavium.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3b29b09a53abd1c8c9d32a8129a47372a93dd15a
Author: Sudarsana Reddy Kalluru <sudarsana.kalluru@cavium.com>
Date:   Mon Jun 18 21:58:01 2018 -0700

    qed: Add sanity check for SIMD fastpath handler.
    
    [ Upstream commit 3935a70968820c3994db4de7e6e1c7e814bff875 ]
    
    Avoid calling a SIMD fastpath handler if it is NULL. The check is needed
    to handle an unlikely scenario where unsolicited interrupt is destined to
    a PF in INTa mode.
    
    Fixes: fe56b9e6a ("qed: Add module with basic common support")
    Signed-off-by: Sudarsana Reddy Kalluru <Sudarsana.Kalluru@cavium.com>
    Signed-off-by: Ariel Elior <ariel.elior@cavium.com>
    Signed-off-by: Michal Kalderon <Michal.Kalderon@cavium.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 26c6ffff8eec39bb8b767a81c7d8f28f54712919
Author: Sudarsana Reddy Kalluru <sudarsana.kalluru@cavium.com>
Date:   Mon Jun 18 21:58:00 2018 -0700

    qed: Fix possible memory leak in Rx error path handling.
    
    [ Upstream commit 4f9de4df901fb84709fe3a864dfa4eaf35700f68 ]
    
    Memory for packet buffers need to be freed in the error paths as there is
    no consumer (e.g., upper layer) for such packets and that memory will never
    get freed.
    The issue was uncovered when port was attacked with flood of isatap
    packets, these are multicast packets hence were directed at all the PFs.
    For foce PF, this meant they were routed to the ll2 module which in turn
    drops such packets.
    
    Fixes: 0a7fb11c ("qed: Add Light L2 support")
    Signed-off-by: Sudarsana Reddy Kalluru <Sudarsana.Kalluru@cavium.com>
    Signed-off-by: Ariel Elior <ariel.elior@cavium.com>
    Signed-off-by: Michal Kalderon <Michal.Kalderon@cavium.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d22240dd6ab34a69d8e6f07fd74bd53270b554fa
Author: Zhizhou Zhang <zhizhouzhang@asrmicro.com>
Date:   Tue Jun 12 17:07:37 2018 +0800

    arm64: make secondary_start_kernel() notrace
    
    [ Upstream commit b154886f7892499d0d3054026e19dfb9a731df61 ]
    
    We can't call function trace hook before setup percpu offset.
    When entering secondary_start_kernel(), percpu offset has not
    been initialized.  So this lead hotplug malfunction.
    Here is the flow to reproduce this bug:
    
    echo 0 > /sys/devices/system/cpu/cpu1/online
    echo function > /sys/kernel/debug/tracing/current_tracer
    echo 1 > /sys/kernel/debug/tracing/tracing_on
    echo 1 > /sys/devices/system/cpu/cpu1/online
    
    Acked-by: Mark Rutland <mark.rutland@arm.com>
    Tested-by: Suzuki K Poulose <suzuki.poulose@arm.com>
    Signed-off-by: Zhizhou Zhang <zhizhouzhang@asrmicro.com>
    Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a929f067a88f0f9a2b02e328f746007f645fa920
Author: Marek Szyprowski <m.szyprowski@samsung.com>
Date:   Tue Jun 12 13:08:40 2018 +0200

    arm64: dma-mapping: clear buffers allocated with FORCE_CONTIGUOUS flag
    
    [ Upstream commit dd65a941f6ba473a5cb9d013d57fa43b48450a04 ]
    
    dma_alloc_*() buffers might be exposed to userspace via mmap() call, so
    they should be cleared on allocation. In case of IOMMU-based dma-mapping
    implementation such buffer clearing was missing in the code path for
    DMA_ATTR_FORCE_CONTIGUOUS flag handling, because dma_alloc_from_contiguous()
    doesn't honor __GFP_ZERO flag. This patch fixes this issue. For more
    information on clearing buffers allocated by dma_alloc_* functions,
    see commit 6829e274a623 ("arm64: dma-mapping: always clear allocated
    buffers").
    
    Fixes: 44176bb38fa4 ("arm64: Add support for DMA_ATTR_FORCE_CONTIGUOUS to IOMMU")
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2e62d135dd530d7144f55c6ce84e2ec29f48596a
Author: Zhouyang Jia <jiazhouyang09@gmail.com>
Date:   Sat Jun 16 08:14:37 2018 +0800

    xen/scsiback: add error handling for xenbus_printf
    
    [ Upstream commit 7c63ca24c878e0051c91904b72174029320ef4bd ]
    
    When xenbus_printf fails, the lack of error-handling code may
    cause unexpected results.
    
    This patch adds error-handling code after calling xenbus_printf.
    
    Signed-off-by: Zhouyang Jia <jiazhouyang09@gmail.com>
    Reviewed-by: Juergen Gross <jgross@suse.com>
    Signed-off-by: Juergen Gross <jgross@suse.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 91e1bb748bcc9fb1737eacb1c26abd62a2ae7076
Author: Zhouyang Jia <jiazhouyang09@gmail.com>
Date:   Sat Jun 16 01:05:01 2018 +0800

    scsi: xen-scsifront: add error handling for xenbus_printf
    
    [ Upstream commit 93efbd39870474cc536b9caf4a6efeb03b0bc56f ]
    
    When xenbus_printf fails, the lack of error-handling code may
    cause unexpected results.
    
    This patch adds error-handling code after calling xenbus_printf.
    
    Signed-off-by: Zhouyang Jia <jiazhouyang09@gmail.com>
    Reviewed-by: Juergen Gross <jgross@suse.com>
    Signed-off-by: Juergen Gross <jgross@suse.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 586ae5694e375ceced8abafe1501eece4e922852
Author: Trond Myklebust <trond.myklebust@hammerspace.com>
Date:   Fri Jun 15 15:58:45 2018 -0400

    pNFS: Always free the session slot on error in nfs4_layoutget_handle_exception
    
    [ Upstream commit 2dbf8dffbf35fd8f611083b9d9fe74fdccf912a3 ]
    
    Right now, we can call nfs_commit_inode() while holding the session slot,
    which could lead to NFSv4 deadlocks. Ensure we only keep the slot if
    the server returned a layout that we have to process.
    
    Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 395c67c1c02d6282a61224139560050c9d238479
Author: Zhouyang Jia <jiazhouyang09@gmail.com>
Date:   Fri Jun 15 07:34:52 2018 +0800

    xen: add error handling for xenbus_printf
    
    [ Upstream commit 84c029a73327cef571eaa61c7d6e67e8031b52ec ]
    
    When xenbus_printf fails, the lack of error-handling code may
    cause unexpected results.
    
    This patch adds error-handling code after calling xenbus_printf.
    
    Signed-off-by: Zhouyang Jia <jiazhouyang09@gmail.com>
    Reviewed-by: Boris Ostrovsky <boris.ostrovsky@oracle.com>
    Signed-off-by: Juergen Gross <jgross@suse.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 72bc7a2f77ba0993815947735d234b6e5c63eb6c
Author: Minas Harutyunyan <Minas.Harutyunyan@synopsys.com>
Date:   Wed May 23 16:24:44 2018 +0400

    dwc2: gadget: Fix ISOC IN DDMA PID bitfield value calculation
    
    [ Upstream commit 1d8e5c00275825fc42aaa5597dab1d0b5b26bb64 ]
    
    PID bitfield in descriptor should be set based on particular request
    length, not based on EP's mc value. PID value can't be set to 0 even
    request length is 0.
    
    Signed-off-by: Minas Harutyunyan <hminas@synopsys.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6958ade76b364a87a9d6a534255fa6d35ce9890c
Author: Grigor Tovmasyan <Grigor.Tovmasyan@synopsys.com>
Date:   Thu May 24 18:22:30 2018 +0400

    usb: gadget: dwc2: fix memory leak in gadget_init()
    
    [ Upstream commit 9bb073a053f0464ea74a4d4c331fdb7da58568d6 ]
    
    Freed allocated request for ep0 to prevent memory leak in case when
    dwc2_driver_probe() failed.
    
    Cc: Stefan Wahren <stefan.wahren@i2se.com>
    Cc: Marek Szyprowski <m.szyprowski@samsung.com>
    Tested-by: Stefan Wahren <stefan.wahren@i2se.com>
    Tested-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Acked-by: Minas Harutyunyan <hminas@synopsys.com>
    Signed-off-by: Grigor Tovmasyan <tovmasya@synopsys.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 66cae9b5a1d92076b62d47dc102391f8f0493450
Author: Chunfeng Yun <chunfeng.yun@mediatek.com>
Date:   Fri May 25 17:24:57 2018 +0800

    usb: gadget: composite: fix delayed_status race condition when set_interface
    
    [ Upstream commit 980900d6318066b9f8314bfb87329a20fd0d1ca4 ]
    
    It happens when enable debug log, if set_alt() returns
    USB_GADGET_DELAYED_STATUS and usb_composite_setup_continue()
    is called before increasing count of @delayed_status,
    so fix it by using spinlock of @cdev->lock.
    
    Signed-off-by: Chunfeng Yun <chunfeng.yun@mediatek.com>
    Tested-by: Jay Hsu <shih-chieh.hsu@mediatek.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a54f59199a81faec807e23fa265ba8f5e9f725a7
Author: William Wu <william.wu@rock-chips.com>
Date:   Fri May 11 17:46:32 2018 +0800

    usb: dwc2: fix isoc split in transfer with no data
    
    [ Upstream commit 70c3c8cb83856758025c2a211dd022bc0478922a ]
    
    If isoc split in transfer with no data (the length of DATA0
    packet is zero), we can't simply return immediately. Because
    the DATA0 can be the first transaction or the second transaction
    for the isoc split in transaction. If the DATA0 packet with no
    data is in the first transaction, we can return immediately.
    But if the DATA0 packet with no data is in the second transaction
    of isoc split in transaction sequence, we need to increase the
    qtd->isoc_frame_index and giveback urb to device driver if needed,
    otherwise, the MDATA packet will be lost.
    
    A typical test case is that connect the dwc2 controller with an
    usb hs Hub (GL852G-12), and plug an usb fs audio device (Plantronics
    headset) into the downstream port of Hub. Then use the usb mic
    to record, we can find noise when playback.
    
    In the case, the isoc split in transaction sequence like this:
    
    - SSPLIT IN transaction
    - CSPLIT IN transaction
      - MDATA packet (176 bytes)
    - CSPLIT IN transaction
      - DATA0 packet (0 byte)
    
    This patch use both the length of DATA0 and qtd->isoc_split_offset
    to check if the DATA0 is in the second transaction.
    
    Tested-by: Gevorg Sahakyan <sahakyan@synopsys.com>
    Tested-by: Heiko Stuebner <heiko@sntech.de>
    Acked-by: Minas Harutyunyan hminas@synopsys.com>
    Signed-off-by: William Wu <william.wu@rock-chips.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6a38c8a49a9f95e24c80e5ec5568a27c2cb01ed0
Author: William Wu <william.wu@rock-chips.com>
Date:   Fri May 11 17:46:31 2018 +0800

    usb: dwc2: alloc dma aligned buffer for isoc split in
    
    [ Upstream commit af424a410749ed7e0c2bffd3cedbc7c274d0ff6f ]
    
    The commit 3bc04e28a030 ("usb: dwc2: host: Get aligned DMA in
    a more supported way") rips out a lot of code to simply the
    allocation of aligned DMA. However, it also introduces a new
    issue when use isoc split in transfer.
    
    In my test case, I connect the dwc2 controller with an usb hs
    Hub (GL852G-12), and plug an usb fs audio device (Plantronics
    headset) into the downstream port of Hub. Then use the usb mic
    to record, we can find noise when playback.
    
    It's because that the usb Hub uses an MDATA for the first
    transaction and a DATA0 for the second transaction for the isoc
    split in transaction. An typical isoc split in transaction sequence
    like this:
    
    - SSPLIT IN transaction
    - CSPLIT IN transaction
      - MDATA packet
    - CSPLIT IN transaction
      - DATA0 packet
    
    The DMA address of MDATA (urb->dma) is always DWORD-aligned, but
    the DMA address of DATA0 (urb->dma + qtd->isoc_split_offset) may
    not be DWORD-aligned, it depends on the qtd->isoc_split_offset (the
    length of MDATA). In my test case, the length of MDATA is usually
    unaligned, this cause DATA0 packet transmission error.
    
    This patch use kmem_cache to allocate aligned DMA buf for isoc
    split in transaction. Note that according to usb 2.0 spec, the
    maximum data payload size is 1023 bytes for each fs isoc ep,
    and the maximum allowable interrupt data payload size is 64 bytes
    or less for fs interrupt ep. So we set the size of object to be
    1024 bytes in the kmem cache.
    
    Tested-by: Gevorg Sahakyan <sahakyan@synopsys.com>
    Tested-by: Heiko Stuebner <heiko@sntech.de>
    Acked-by: Minas Harutyunyan hminas@synopsys.com>
    Signed-off-by: William Wu <william.wu@rock-chips.com>
    Reviewed-by: Douglas Anderson <dianders@chromium.org>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7ccd2c1be366d249e7c67997dbc930d5be0879b1
Author: John Garry <john.garry@huawei.com>
Date:   Fri Jun 8 18:26:33 2018 +0800

    libahci: Fix possible Spectre-v1 pmp indexing in ahci_led_store()
    
    [ Upstream commit fae2a63737e5973f1426bc139935a0f42e232844 ]
    
    Currently smatch warns of possible Spectre-V1 issue in ahci_led_store():
    drivers/ata/libahci.c:1150 ahci_led_store() warn: potential spectre issue 'pp->em_priv' (local cap)
    
    Userspace controls @pmp from following callchain:
    em_message->store()
    ->ata_scsi_em_message_store()
    -->ap->ops->em_store()
    --->ahci_led_store()
    
    After the mask+shift @pmp is effectively an 8b value, which is used to
    index into an array of length 8, so sanitize the array index.
    
    Signed-off-by: John Garry <john.garry@huawei.com>
    Signed-off-by: Tejun Heo <tj@kernel.org>
    
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ed4afe79ba5a2f6761e10b1a91920796d3164ef9
Author: Vijay Immanuel <vijayi@attalasystems.com>
Date:   Tue Jun 12 18:16:05 2018 -0700

    IB/rxe: Fix missing completion for mem_reg work requests
    
    [ Upstream commit 375dc53d032fc11e98036b5f228ad13f7c5933f5 ]
    
    Run the completer task to post a work completion after processing
    a memory registration or invalidate work request. This covers the
    case where the memory registration or invalidate was the last work
    request posted to the qp.
    
    Signed-off-by: Vijay Immanuel <vijayi@attalasystems.com>
    Reviewed-by: Yonatan Cohen <yonatanc@mellanox.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6bcd5cdf3a36e3adf211c0f90fc83a5f0b4d83d2
Author: Ayan Kumar Halder <ayan.halder@arm.com>
Date:   Tue Apr 10 19:25:03 2018 +0100

    drm/arm/malidp: Preserve LAYER_FORMAT contents when setting format
    
    [ Upstream commit ad7fda2e378f4356df621a39655f7c200b495d81 ]
    
    On some Mali-DP processors, the LAYER_FORMAT register contains fields
    other than the format. These bits were unconditionally cleared when
    setting the pixel format, whereas they should be preserved at their
    reset values.
    
    Reported-by: Brian Starkey <brian.starkey@arm.com>
    Reported-by: Liviu Dudau <liviu.dudau@arm.com>
    Signed-off-by: Ayan Kumar halder <ayan.halder@arm.com>
    Acked-by: Liviu Dudau <liviu.dudau@arm.com>
    Signed-off-by: Liviu Dudau <liviu.dudau@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0a43cd3ea76ad9b438089c7c9fab4ea98a94ef39
Author: Alison Wang <alison.wang@nxp.com>
Date:   Tue Apr 24 10:42:32 2018 +0800

    drm: mali-dp: Enable Global SE interrupts mask for DP500
    
    [ Upstream commit 89610dc2c235e7b02bb9fba0ce247e12d4dde7cd ]
    
    In the situation that DE and SE aren’t shared the same interrupt number,
    the Global SE interrupts mask bit MASK_IRQ_EN in MASKIRQ must be set, or
    else other mask bits will not work and no SE interrupt will occur. This
    patch enables MASK_IRQ_EN for SE to fix this problem.
    
    Signed-off-by: Alison Wang <alison.wang@nxp.com>
    Acked-by: Liviu Dudau <liviu.dudau@arm.com>
    Signed-off-by: Liviu Dudau <liviu.dudau@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 997a6b6b3017a914b0707676119848c1af69921d
Author: Hoan Tran <hoan.tran@amperecomputing.com>
Date:   Thu Jun 7 14:35:01 2018 +0100

    drivers/perf: xgene_pmu: Fix IOB SLOW PMU parser error
    
    [ Upstream commit a45fc268db20ecd859bb61e25045912b3194b5e6 ]
    
    This patch fixes the below parser error of the IOB SLOW PMU.
    
            # perf stat -a -e iob-slow0/cycle-count/ sleep 1
            evenf syntax error: 'iob-slow0/cycle-count/'
                                     \___ parser error
    
    It replaces the "-" character by "_" character inside the PMU name.
    
    Signed-off-by: Hoan Tran <hoan.tran@amperecomputing.com>
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fec2c747ae39db840c68dd3288cc10c144a55eec
Author: Ray Jui <ray.jui@broadcom.com>
Date:   Tue Jun 12 13:21:31 2018 -0700

    arm64: dts: Stingray: Fix I2C controller interrupt type
    
    [ Upstream commit 75af23c4736c5633894ea0baf9bca1cf6b248ca4 ]
    
    Fix I2C controller interrupt to use IRQ_TYPE_LEVEL_HIGH for Broadcom
    Stingray SoC.
    
    Fixes: 1256ea18875d ("arm64: dts: Add I2C DT nodes for Stingray SoC")
    Signed-off-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 22dc4f2b8b46fb10d6139b3d23cba2a48bf892b9
Author: Ray Jui <ray.jui@broadcom.com>
Date:   Tue Jun 12 13:21:30 2018 -0700

    arm64: dts: ns2: Fix PCIe controller interrupt type
    
    [ Upstream commit d0b8aed9e80ab526dbb04020bfc94ecea7bddb44 ]
    
    Fix PCIe controller interrupt to use IRQ_TYPE_LEVEL_HIGH for Broadcom
    NS2 SoC.
    
    Fixes: fd5e5dd56a2f ("arm64: dts: Add PCIe0 and PCIe4 DT nodes for NS2")
    Signed-off-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit db0b1a4b0772b52f7707269a7c6dc9d636d5f47c
Author: Ray Jui <ray.jui@broadcom.com>
Date:   Tue Jun 12 13:21:29 2018 -0700

    arm64: dts: ns2: Fix I2C controller interrupt type
    
    [ Upstream commit e605c287deed45624e8d35a15e3f0b4faab1a62d ]
    
    Fix I2C controller interrupt to use IRQ_TYPE_LEVEL_HIGH for Broadcom NS2
    SoC.
    
    Fixes: 7ac674e8df7a ("arm64: dts: Add I2C nodes for NS2")
    Signed-off-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 69347a9150c9b8a053fd791aaaec92fd661c4f0f
Author: Scott Branden <scott.branden@broadcom.com>
Date:   Tue May 22 10:01:39 2018 -0700

    arm64: dts: specify 1.8V EMMC capabilities for bcm958742t
    
    [ Upstream commit 37c2bd81a86ebb1cc934bf52a29c33d6f9abff7f ]
    
    Specify 1.8V EMMC capabilities for bcm958742t board to indicate support
    for UHS mode.
    
    Fixes: d4b4aba6be8a ("arm64: dts: Initial DTS files for Broadcom Stingray SOC")
    Signed-off-by: Scott Branden <scott.branden@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 31b16a0302be55e0915b270987c1429ee919313b
Author: Scott Branden <scott.branden@broadcom.com>
Date:   Fri May 18 08:21:20 2018 -0700

    arm64: dts: specify 1.8V EMMC capabilities for bcm958742k
    
    [ Upstream commit eba92503e980c08ac353d0d669d0bb143979abcd ]
    
    Specify 1.8V EMMC capabilities for bcm958742k board to indicate support
    for UHS mode.
    
    Fixes: d4b4aba6be8a ("arm64: dts: Initial DTS files for Broadcom Stingray SOC")
    Signed-off-by: Scott Branden <scott.branden@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit eab85e8bd4866595f3ab18f96dee6c7c02699313
Author: Ray Jui <ray.jui@broadcom.com>
Date:   Tue Jun 12 13:21:28 2018 -0700

    ARM: dts: Cygnus: Fix PCIe controller interrupt type
    
    [ Upstream commit 6cb1628ad3506b315cdddd7676db0ff2af378d28 ]
    
    Fix PCIe controller interrupt to use IRQ_TYPE_LEVEL_HIGH for Broadcom
    Cygnus SoC
    
    Fixes: cd590b50a936 ("ARM: dts: enable PCIe support for Cygnus")
    Fixes: f6b889358a82 ("ARM: dts: Enable MSI support for Broadcom Cygnus")
    Signed-off-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6542fcfbd4c5a82d05c1653e3ba9583971536121
Author: Ray Jui <ray.jui@broadcom.com>
Date:   Tue Jun 12 13:21:27 2018 -0700

    ARM: dts: Cygnus: Fix I2C controller interrupt type
    
    [ Upstream commit 71ca3409703b62b6a092d0d9d13f366c121bc5d3 ]
    
    Fix I2C controller interrupt to use IRQ_TYPE_LEVEL_HIGH for Broadcom
    Cygnus SoC.
    
    Fixes: b51c05a331ff ("ARM: dts: add I2C device nodes for Broadcom Cygnus")
    Signed-off-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2d4ac6f1837b874c475005fc29335c4f1d55faa2
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Mon Jun 11 15:53:40 2018 -0700

    ARM: dts: BCM5301x: Fix i2c controller interrupt type
    
    [ Upstream commit a0a8338e905734518ab9b10b06e7fd0201228f8b ]
    
    The i2c controller should be using IRQ_TYPE_LEVEL_HIGH, fix that.
    
    Fixes: bb097e3e0045 ("ARM: dts: BCM5301X: Add I2C support to the DT")
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d8ff67605d54ff6153fbd045d6d5cd821396a606
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Mon Jun 11 15:47:13 2018 -0700

    ARM: dts: NSP: Fix PCIe controllers interrupt types
    
    [ Upstream commit 403fde644855bc71318c8db65646383e22653b13 ]
    
    The interrupts for the PCIe controllers should all be of type
    IRQ_TYPE_LEVEL_HIGH instead of IRQ_TYPE_NONE.
    
    Fixes: d71eb9412088 ("ARM: dts: NSP: Add MSI support on PCI")
    Fixes: 522199029fdc ("ARM: dts: NSP: Fix PCIE DT issue")
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7ab23e15c7d209bb8ae9a265e9ea397fde9957a7
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Mon Jun 11 15:47:12 2018 -0700

    ARM: dts: NSP: Fix i2c controller interrupt type
    
    [ Upstream commit a3e32e78a40017756c71ef6dad429ffe3301126a ]
    
    The i2c controller should use IRQ_TYPE_LEVEL_HIGH instead of
    IRQ_TYPE_NONE.
    
    Fixes: 0f9f27a36d09 ("ARM: dts: NSP: Add I2C support to the DT")
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0104d49dc06f196a0102290afc783dc04975187c
Author: Fathi Boudra <fathi.boudra@linaro.org>
Date:   Thu Jun 14 11:57:08 2018 +0200

    selftests: sync: add config fragment for testing sync framework
    
    [ Upstream commit d6a3e55131fcb1e5ca1753f4b6f297a177b2fc91 ]
    
    Unless the software synchronization objects (CONFIG_SW_SYNC) is enabled,
    the sync test will be skipped:
    
    TAP version 13
    1..0 # Skipped: Sync framework not supported by kernel
    
    Add a config fragment file to be able to run "make kselftest-merge" to
    enable relevant configuration required in order to run the sync test.
    
    Signed-off-by: Fathi Boudra <fathi.boudra@linaro.org>
    Link: https://lkml.org/lkml/2017/5/5/14
    Signed-off-by: Anders Roxell <anders.roxell@linaro.org>
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a626c95346e1dfb93993975900088c4908a1a327
Author: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Date:   Wed Jun 13 21:31:43 2018 -0600

    selftests: vm: return Kselftest Skip code for skipped tests
    
    [ Upstream commit a4d7537789724985cafbc9260a31ca4f2b7cf123 ]
    
    When vm test is skipped because of unmet dependencies and/or unsupported
    configuration, it exits with error which is treated as a fail by the
    Kselftest framework. This leads to false negative result even when the
    test could not be run.
    
    Change it to return kselftest skip code when a test gets skipped to
    clearly report that the test could not be run.
    
    Kselftest framework SKIP code is 4 and the framework prints appropriate
    messages to indicate that the test is skipped.
    
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Acked-by: Mike Rapoport <rppt@linux.vnet.ibm.com>
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3a9907ebf83b379b15a44a2597066868d1c958e1
Author: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Date:   Thu Jun 14 16:56:13 2018 -0600

    selftests: zram: return Kselftest Skip code for skipped tests
    
    [ Upstream commit 685814466bf8398192cf855415a0bb2cefc1930e ]
    
    When zram test is skipped because of unmet dependencies and/or
    unsupported configuration, it exits with error which is treated as
    a fail by the Kselftest framework. This leads to false negative result
    even when the test could not be run.
    
    Change it to return kselftest skip code when a test gets skipped to
    clearly report that the test could not be run.
    
    Kselftest framework SKIP code is 4 and the framework prints appropriate
    messages to indicate that the test is skipped.
    
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 41325fa657b96b4c33fee8c7c63e00175fab538a
Author: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Date:   Wed Jun 13 21:10:48 2018 -0600

    selftests: user: return Kselftest Skip code for skipped tests
    
    [ Upstream commit d7d5311d4aa9611fe1a5a851e6f75733237a668a ]
    
    When user test is skipped because of unmet dependencies and/or
    unsupported configuration, it exits with error which is treated as
    a fail by the Kselftest framework. This leads to false negative result
    even when the test could not be run.
    
    Change it to return kselftest skip code when a test gets skipped to
    clearly report that the test could not be run. Add an explicit check
    for module presence and return skip code if module isn't present.
    
    Kselftest framework SKIP code is 4 and the framework prints appropriate
    messages to indicate that the test is skipped.
    
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d5f9d1d350bc452c1fb5f4a184ccc6dd74a2946d
Author: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Date:   Tue Jun 12 18:11:37 2018 -0600

    selftests: sysctl: return Kselftest Skip code for skipped tests
    
    [ Upstream commit c7db6ffb831fd36a03485a0d88b1e505378975ad ]
    
    When sysctl test is skipped because of unmet dependencies and/or
    unsupported configuration, it exits with error which is treated as
    a fail by the Kselftest framework. This leads to false negative result
    even when the test could not be run.
    
    Change it to return kselftest skip code when a test gets skipped to
    clearly report that the test could not be run.
    
    Changed return code to kselftest skip code in skip error legs that check
    requirements and module probe test error leg.
    
    Kselftest framework SKIP code is 4 and the framework prints appropriate
    messages to indicate that the test is skipped.
    
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Reviewed-by: Kees Cook <keescook@chromium.org>
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bc5e458a9ee234b5454e91ee56dc1fb870f9437f
Author: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Date:   Tue Jun 12 17:40:31 2018 -0600

    selftests: static_keys: return Kselftest Skip code for skipped tests
    
    [ Upstream commit 8781578087b8fb8829558bac96c3c24e5ba26f82 ]
    
    When static_keys test is skipped because of unmet dependencies and/or
    unsupported configuration, it exits with error which is treated as a fail
    by the Kselftest framework. This leads to false negative result even when
    the test could not be run.
    
    Change it to return kselftest skip code when a test gets skipped to clearly
    report that the test could not be run.
    
    Added an explicit searches for test_static_key_base and test_static_keys
    modules and return skip code if they aren't found to differentiate between
    the failure to load the module condition and module not found condition.
    
    Kselftest framework SKIP code is 4 and the framework prints appropriate
    messages to indicate that the test is skipped.
    
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 81810e45384b41c2669edb4adb9cacd65719222a
Author: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Date:   Tue Jun 12 16:46:03 2018 -0600

    selftests: pstore: return Kselftest Skip code for skipped tests
    
    [ Upstream commit 856e7c4b619af622d56b3b454f7bec32a170ac99 ]
    
    When pstore_post_reboot test gets skipped because of unmet dependencies
    and/or unsupported configuration, it returns 0 which is treated as a pass
    by the Kselftest framework. This leads to false positive result even when
    the test could not be run.
    
    Change it to return kselftest skip code when a test gets skipped to clearly
    report that the test could not be run.
    
    Kselftest framework SKIP code is 4 and the framework prints appropriate
    messages to indicate that the test is skipped.
    
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Reviewed-by: Kees Cook <keescook@chromium.org>
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 175b38277b6d9215ef9c854d666b6223873445e1
Author: Gao Feng <gfree.wind@vip.163.com>
Date:   Wed Jun 13 12:26:13 2018 +0800

    netfilter: nf_ct_helper: Fix possible panic after nf_conntrack_helper_unregister
    
    [ Upstream commit ad9852af97587b8abe8102f9ddcb05c9769656f6 ]
    
    The helper module would be unloaded after nf_conntrack_helper_unregister,
    so it may cause a possible panic caused by race.
    
    nf_ct_iterate_destroy(unhelp, me) reset the helper of conntrack as NULL,
    but maybe someone has gotten the helper pointer during this period. Then
    it would panic, when it accesses the helper and the module was unloaded.
    
    Take an example as following:
    CPU0                                                   CPU1
    ctnetlink_dump_helpinfo
    helper = rcu_dereference(help->helper);
                                                           unhelp
                                                           set helper as NULL
                                                           unload helper module
    helper->to_nlattr(skb, ct);
    
    As above, the cpu0 tries to access the helper and its module is unloaded,
    then the panic happens.
    
    Signed-off-by: Gao Feng <gfree.wind@vip.163.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 69c471908ddd7b9927aa0735766d486cbf094cab
Author: Eric Dumazet <edumazet@google.com>
Date:   Wed Jun 13 10:11:56 2018 -0700

    netfilter: ipv6: nf_defrag: reduce struct net memory waste
    
    [ Upstream commit 9ce7bc036ae4cfe3393232c86e9e1fea2153c237 ]
    
    It is a waste of memory to use a full "struct netns_sysctl_ipv6"
    while only one pointer is really used, considering netns_sysctl_ipv6
    keeps growing.
    
    Also, since "struct netns_frags" has cache line alignment,
    it is better to move the frags_hdr pointer outside, otherwise
    we spend a full cache line for this pointer.
    
    This saves 192 bytes of memory per netns.
    
    Fixes: c038a767cd69 ("ipv6: add a new namespace for nf_conntrack_reasm")
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dcf6f268deee44671fa9b320b1ba5e9648a5277c
Author: Mika Westerberg <mika.westerberg@linux.intel.com>
Date:   Mon Jun 18 14:17:16 2018 +0300

    ACPI / EC: Use ec_no_wakeup on Thinkpad X1 Carbon 6th
    
    [ Upstream commit 8195a655e5ce09550aff81b2573d9b015d520cb9 ]
    
    On this system EC interrupt triggers constantly kicking devices out of
    low power states and thus blocking power management. The system also has
    a PCIe root port hosting Alpine Ridge Thunderbolt controller and it
    never gets a chance to go to D3cold because of this.
    
    Since the power button works the same regardless if EC interrupt is
    enabled or not during s2idle, add a quirk for this machine that sets
    ec_no_wakeup=true preventing spurious wakeups.
    
    Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 987a7dab8308be0636b020444bd42910abf68dbc
Author: Johan Hovold <johan@kernel.org>
Date:   Thu May 31 16:45:52 2018 +0200

    usb: dwc3: of-simple: fix use-after-free on remove
    
    [ Upstream commit 896e518883f18e601335908192e33426c1f599a4 ]
    
    The clocks have already been explicitly disabled and put as part of
    remove() so the runtime suspend callback must not be run when balancing
    the runtime PM usage count before returning.
    
    Fixes: 16adc674d0d6 ("usb: dwc3: add generic OF glue layer")
    Signed-off-by: Johan Hovold <johan@kernel.org>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7b2dc4515f030658f9cae3f1d7e294ab8238e39f
Author: Minas Harutyunyan <Minas.Harutyunyan@synopsys.com>
Date:   Tue Jun 12 12:37:29 2018 +0400

    usb: dwc2: gadget: Fix issue in dwc2_gadget_start_isoc()
    
    [ Upstream commit 1ffba9058737af2ddeebc813faa8ea9b16bc892a ]
    
    In case of requests queue is empty reset EP target_frame to
    initial value.
    
    This allow restarting ISOC traffic in case when function
    driver queued requests with interruptions.
    
    Tested-by: Zeng Tao <prime.zeng@hisilicon.com>
    Signed-off-by: Minas Harutyunyan <hminas@synopsys.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3572fd055e69a583eff9d7fd5cb8a7736ed27d65
Author: Vincent Pelletier <plr.vincent@gmail.com>
Date:   Wed Jun 13 11:05:06 2018 +0000

    usb: gadget: ffs: Fix BUG when userland exits with submitted AIO transfers
    
    [ Upstream commit d52e4d0c0c428bf2ba35074a7495cdb28e2efbae ]
    
    This bug happens only when the UDC needs to sleep during usb_ep_dequeue,
    as is the case for (at least) dwc3.
    
    [  382.200896] BUG: scheduling while atomic: screen/1808/0x00000100
    [  382.207124] 4 locks held by screen/1808:
    [  382.211266]  #0:  (rcu_callback){....}, at: [<c10b4ff0>] rcu_process_callbacks+0x260/0x440
    [  382.219949]  #1:  (rcu_read_lock_sched){....}, at: [<c1358ba0>] percpu_ref_switch_to_atomic_rcu+0xb0/0x130
    [  382.230034]  #2:  (&(&ctx->ctx_lock)->rlock){....}, at: [<c11f0c73>] free_ioctx_users+0x23/0xd0
    [  382.230096]  #3:  (&(&ffs->eps_lock)->rlock){....}, at: [<f81e7710>] ffs_aio_cancel+0x20/0x60 [usb_f_fs]
    [  382.230160] Modules linked in: usb_f_fs libcomposite configfs bnep btsdio bluetooth ecdh_generic brcmfmac brcmutil intel_powerclamp coretemp dwc3 kvm_intel ulpi udc_core kvm irqbypass crc32_pclmul crc32c_intel pcbc dwc3_pci aesni_intel aes_i586 crypto_simd cryptd ehci_pci ehci_hcd gpio_keys usbcore basincove_gpadc industrialio usb_common
    [  382.230407] CPU: 1 PID: 1808 Comm: screen Not tainted 4.14.0-edison+ #117
    [  382.230416] Hardware name: Intel Corporation Merrifield/BODEGA BAY, BIOS 542 2015.01.21:18.19.48
    [  382.230425] Call Trace:
    [  382.230438]  <SOFTIRQ>
    [  382.230466]  dump_stack+0x47/0x62
    [  382.230498]  __schedule_bug+0x61/0x80
    [  382.230522]  __schedule+0x43/0x7a0
    [  382.230587]  schedule+0x5f/0x70
    [  382.230625]  dwc3_gadget_ep_dequeue+0x14c/0x270 [dwc3]
    [  382.230669]  ? do_wait_intr_irq+0x70/0x70
    [  382.230724]  usb_ep_dequeue+0x19/0x90 [udc_core]
    [  382.230770]  ffs_aio_cancel+0x37/0x60 [usb_f_fs]
    [  382.230798]  kiocb_cancel+0x31/0x40
    [  382.230822]  free_ioctx_users+0x4d/0xd0
    [  382.230858]  percpu_ref_switch_to_atomic_rcu+0x10a/0x130
    [  382.230881]  ? percpu_ref_exit+0x40/0x40
    [  382.230904]  rcu_process_callbacks+0x2b3/0x440
    [  382.230965]  __do_softirq+0xf8/0x26b
    [  382.231011]  ? __softirqentry_text_start+0x8/0x8
    [  382.231033]  do_softirq_own_stack+0x22/0x30
    [  382.231042]  </SOFTIRQ>
    [  382.231071]  irq_exit+0x45/0xc0
    [  382.231089]  smp_apic_timer_interrupt+0x13c/0x150
    [  382.231118]  apic_timer_interrupt+0x35/0x3c
    [  382.231132] EIP: __copy_user_ll+0xe2/0xf0
    [  382.231142] EFLAGS: 00210293 CPU: 1
    [  382.231154] EAX: bfd4508c EBX: 00000004 ECX: 00000003 EDX: f3d8fe50
    [  382.231165] ESI: f3d8fe51 EDI: bfd4508d EBP: f3d8fe14 ESP: f3d8fe08
    [  382.231176]  DS: 007b ES: 007b FS: 00d8 GS: 0033 SS: 0068
    [  382.231265]  core_sys_select+0x25f/0x320
    [  382.231346]  ? __wake_up_common_lock+0x62/0x80
    [  382.231399]  ? tty_ldisc_deref+0x13/0x20
    [  382.231438]  ? ldsem_up_read+0x1b/0x40
    [  382.231459]  ? tty_ldisc_deref+0x13/0x20
    [  382.231479]  ? tty_write+0x29f/0x2e0
    [  382.231514]  ? n_tty_ioctl+0xe0/0xe0
    [  382.231541]  ? tty_write_unlock+0x30/0x30
    [  382.231566]  ? __vfs_write+0x22/0x110
    [  382.231604]  ? security_file_permission+0x2f/0xd0
    [  382.231635]  ? rw_verify_area+0xac/0x120
    [  382.231677]  ? vfs_write+0x103/0x180
    [  382.231711]  SyS_select+0x87/0xc0
    [  382.231739]  ? SyS_write+0x42/0x90
    [  382.231781]  do_fast_syscall_32+0xd6/0x1a0
    [  382.231836]  entry_SYSENTER_32+0x47/0x71
    [  382.231848] EIP: 0xb7f75b05
    [  382.231857] EFLAGS: 00000246 CPU: 1
    [  382.231868] EAX: ffffffda EBX: 00000400 ECX: bfd4508c EDX: bfd4510c
    [  382.231878] ESI: 00000000 EDI: 00000000 EBP: 00000000 ESP: bfd45020
    [  382.231889]  DS: 007b ES: 007b FS: 0000 GS: 0033 SS: 007b
    [  382.232281] softirq: huh, entered softirq 9 RCU c10b4d90 with preempt_count 00000100, exited with 00000000?
    
    Tested-by: Sam Protsenko <semen.protsenko@linaro.org>
    Signed-off-by: Vincent Pelletier <plr.vincent@gmail.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 48168383379f2c8437059a9790d34a20fe95fe88
Author: Heikki Krogerus <heikki.krogerus@linux.intel.com>
Date:   Thu Jun 15 12:57:30 2017 +0300

    usb: dwc3: pci: add support for Intel IceLake
    
    [ Upstream commit 00908693c481f7298adf8cf4d2ff3dfbea8c375f ]
    
    PCI IDs for Intel IceLake.
    
    Signed-off-by: Heikki Krogerus <heikki.krogerus@linux.intel.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bf3bb8b549da22221ba0f28110148e1bb6c23228
Author: Anson Huang <Anson.Huang@nxp.com>
Date:   Wed May 30 09:30:42 2018 +0800

    soc: imx: gpcv2: correct PGC offset
    
    [ Upstream commit 3637f12faf507b0a4b8ac1e7115fc99583ab1db3 ]
    
    Correct MIPI/PCIe/USB_HSIC's PGC offset based on
    design RTL, the values in the Reference Manual
    (Rev. 1, 01/2018 and the older ones) are incorrect.
    
    The correct offset values should be as below:
    
    0x800 ~ 0x83F: PGC for core0 of A7 platform;
    0x840 ~ 0x87F: PGC for core1 of A7 platform;
    0x880 ~ 0x8BF: PGC for SCU of A7 platform;
    0xA00 ~ 0xA3F: PGC for fastmix/megamix;
    0xC00 ~ 0xC3F: PGC for MIPI PHY;
    0xC40 ~ 0xC7F: PGC for PCIe_PHY;
    0xC80 ~ 0xCBF: PGC for USB OTG1 PHY;
    0xCC0 ~ 0xCFF: PGC for USB OTG2 PHY;
    0xD00 ~ 0xD3F: PGC for USB HSIC PHY;
    
    Signed-off-by: Anson Huang <Anson.Huang@nxp.com>
    Fixes: 03aa12629fc4 ("soc: imx: Add GPCv2 power gating driver")
    Acked-by: Andrey Smirnov <andrew.smirnov@gmail.com>
    Reviewed-by: Fabio Estevam <fabio.estevam@nxp.com>
    Signed-off-by: Shawn Guo <shawnguo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4dff89e722d5186e9531a534f1000fee41798176
Author: Guenter Roeck <linux@roeck-us.net>
Date:   Tue Jun 12 15:19:35 2018 -0700

    hwmon: (nct6775) Fix loop limit
    
    [ Upstream commit 91bb8f45f73f19a0150c233c0f11cdeb6d71d1e9 ]
    
    Commit cc66b3038254 ("hwmon: (nct6775) Rework temperature source and label
    handling") changed a loop limit from "data->temp_label_num - 1" to "32",
    as part of moving from a string array to a bit mask. This results in the
    following error, reported by UBSAN.
    
    UBSAN: Undefined behaviour in drivers/hwmon/nct6775.c:4179:27
    shift exponent 32 is too large for 32-bit type 'long unsigned int'
    
    Similar to the original loop, the limit has to be one less than the
    number of bits.
    
    Fixes: cc66b3038254 ("hwmon: (nct6775) Rework temperature source and label handling")
    Reported-by: Paul Menzel <pmenzel+linux-hwmon@molgen.mpg.de>
    Cc: Paul Menzel <pmenzel+linux-hwmon@molgen.mpg.de>
    Tested-by: Paul Menzel <pmenzel+linux-hwmon@molgen.mpg.de>
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c0f29f9d8aa86eec14cf12521597ad5af54e1cc7
Author: Alexey Brodkin <abrodkin@synopsys.com>
Date:   Fri Jun 1 14:34:33 2018 +0300

    ARC: Explicitly add -mmedium-calls to CFLAGS
    
    [ Upstream commit 74c11e300c103af47db5b658fdcf28002421e250 ]
    
    GCC built for arc*-*-linux has "-mmedium-calls" implicitly enabled by default
    thus we don't see any problems during Linux kernel compilation.
    ----------------------------->8------------------------
    arc-linux-gcc -mcpu=arc700 -Q --help=target | grep calls
      -mlong-calls                          [disabled]
      -mmedium-calls                        [enabled]
    ----------------------------->8------------------------
    
    But if we try to use so-called Elf32 toolchain with GCC configured for
    arc*-*-elf* then we'd see the following failure:
    ----------------------------->8------------------------
    init/do_mounts.o: In function 'init_rootfs':
    do_mounts.c:(.init.text+0x108): relocation truncated to fit: R_ARC_S21W_PCREL
    against symbol 'unregister_filesystem' defined in .text section in fs/filesystems.o
    
    arc-elf32-ld: final link failed: Symbol needs debug section which does not exist
    make: *** [vmlinux] Error 1
    ----------------------------->8------------------------
    
    That happens because neither "-mmedium-calls" nor "-mlong-calls" are enabled in
    Elf32 GCC:
    ----------------------------->8------------------------
    arc-elf32-gcc -mcpu=arc700 -Q --help=target | grep calls
      -mlong-calls                          [disabled]
      -mmedium-calls                        [disabled]
    ----------------------------->8------------------------
    
    Now to make it possible to use Elf32 toolchain for building Linux kernel
    we're explicitly add "-mmedium-calls" to CFLAGS.
    
    And since we add "-mmedium-calls" to the global CFLAGS there's no point in
    having per-file copies thus removing them.
    
    Signed-off-by: Alexey Brodkin <abrodkin@synopsys.com>
    Signed-off-by: Vineet Gupta <vgupta@synopsys.com>
    
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c170373c723020696ba2eee0eb57b1407d3efe04
Author: Maciej Purski <m.purski@samsung.com>
Date:   Wed Nov 22 10:08:38 2017 +0100

    drm/bridge/sii8620: fix potential buffer overflow
    
    [ Upstream commit 9378cecb1ce5d618b8aff4d65113ddcf72fc1011 ]
    
    Buffer overflow error should not occur, as mode_fixup() callback
    filters pixel clock value and it should never exceed 600000. However,
    current implementation is not obviously safe and relies on
    implementation of mode_fixup().
    
    Make 'i' variable never reach unsafe value in order to avoid buffer
    overflow error.
    
    Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
    Fixes: bf1722ca ("drm/bridge/sii8620: rewrite hdmi start sequence")
    Signed-off-by: Maciej Purski <m.purski@samsung.com>
    Signed-off-by: Andrzej Hajda <a.hajda@samsung.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/1511341718-6974-1-git-send-email-m.purski@samsung.com
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 69004038f01ccbccc5c99dd8a287331b77acc1b9
Author: Andrzej Hajda <a.hajda@samsung.com>
Date:   Mon Jan 15 18:33:57 2018 +0100

    drm/bridge/sii8620: fix loops in EDID fetch logic
    
    [ Upstream commit 8e627a1b1ce8feb3e1da4428b71b9b4905f04888 ]
    
    Function should constantly check if cable is connected and finish
    in finite time.
    
    Signed-off-by: Andrzej Hajda <a.hajda@samsung.com>
    Tested-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Reviewed-by: Maciej Purski <m.purski@samsung.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20180115173357.31067-4-a.hajda@samsung.com
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit da327a4b9d096a0734fc345ea96b483feafd0b4b
Author: Christophe Jaillet <christophe.jaillet@wanadoo.fr>
Date:   Mon Jun 11 20:15:11 2018 +0200

    IB/mlx4: Fix an error handling path in 'mlx4_ib_rereg_user_mr()'
    
    [ Upstream commit 3dc7c7badb7502ec3e3aa817a8bdd9e53aa54c52 ]
    
    Before returning -EPERM we should release some resources, as already done
    in the other error handling path of the function.
    
    Fixes: d8f9cc328c88 ("IB/mlx4: Mark user MR as writable if actual virtual memory is writable")
    Signed-off-by: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 048f62f3725d30467d57b9a76e93a19c01af56b2
Author: Lucas Stach <l.stach@pengutronix.de>
Date:   Tue Jun 5 10:34:54 2018 -0700

    Input: synaptics-rmi4 - fix axis-swap behavior
    
    [ Upstream commit 645a397d325db6e1bb36588095ae637738b37693 ]
    
    The documentation for the touchscreen-swapped-x-y property states that
    swapping is done after inverting if both are used. RMI4 did it the other
    way around, leading to inconsistent behavior with regard to other
    touchscreens.
    
    Signed-off-by: Lucas Stach <l.stach@pengutronix.de>
    Tested-by: Nick Dyer <nick@shmanahar.org>
    Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d4108ed2a57fdbbedd99ebfac264d560e2e5eb73
Author: Jiri Olsa <jolsa@kernel.org>
Date:   Thu Jun 7 00:15:05 2018 +0200

    perf tools: Fix error index for pmu event parser
    
    [ Upstream commit f7fa827f5f432a0b1f34e10fc49da93aeef9f817 ]
    
    For events we provide specific error message we need to set error column
    index, PMU parser is missing that, adding it.
    
    Before:
    
      $ perf stat -e cycles,krava/cycles/ kill
      event syntax error: 'cycles,krava/cycles/'
                           \___ Cannot find PMU `krava'. Missing kernel support?
    
    After:
    
      $ perf stat -e cycles,krava/cycles/ kill
      event syntax error: 'cycles,krava/cycles/'
                                  \___ Cannot find PMU `krava'. Missing kernel support?
    
    Signed-off-by: Jiri Olsa <jolsa@kernel.org>
    Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Andi Kleen <andi@firstfloor.org>
    Cc: David Ahern <dsahern@gmail.com>
    Cc: Frederic Weisbecker <frederic@kernel.org>
    Cc: Milian Wolff <milian.wolff@kdab.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Stephane Eranian <eranian@google.com>
    Link: http://lkml.kernel.org/r/20180606221513.11302-3-jolsa@kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7dcffd98360a1f0e953eb2aa86976032d83f90dd
Author: Dong Jia Shi <bjsdjshi@linux.vnet.ibm.com>
Date:   Wed May 2 09:25:59 2018 +0200

    vfio: ccw: fix error return in vfio_ccw_sch_event
    
    [ Upstream commit 2c861d89ccda2fbcea9358eff9cc5f8fae548be5 ]
    
    If the device has not been registered, or there is work pending,
    we should reschedule a sch_event call again.
    
    Signed-off-by: Dong Jia Shi <bjsdjshi@linux.vnet.ibm.com>
    Message-Id: <20180502072559.50691-1-bjsdjshi@linux.vnet.ibm.com>
    Reviewed-by: Cornelia Huck <cohuck@redhat.com>
    Signed-off-by: Cornelia Huck <cohuck@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 67c0f84827e123953b8baac9de20fe039b5c83fd
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Fri May 25 16:01:47 2018 +0530

    arm: dts: armada: Fix "#cooling-cells" property's name
    
    [ Upstream commit ac62cc9d9cd6fa4c79e171c13dc8d58c3862b678 ]
    
    It should be "#cooling-cells" instead of "cooling-cells". Fix it.
    
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Gregory CLEMENT <gregory.clement@bootlin.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4aec7c283904207d6dc2bd3a319d4e77ce60c77c
Author: Matthijs van Duin <matthijsvanduin@gmail.com>
Date:   Thu Jul 19 10:43:46 2018 +0200

    pty: fix O_CLOEXEC for TIOCGPTPEER
    
    commit 36ecc1481dc8d8c52d43ba18c6b642c1d2fde789 upstream.
    
    It was being ignored because the flags were not passed to fd allocation.
    
    Fixes: 54ebbfb16034 ("tty: add TIOCGPTPEER ioctl")
    Signed-off-by: Matthijs van Duin <matthijsvanduin@gmail.com>
    Acked-by: Aleksa Sarai <asarai@suse.de>
    Cc: stable <stable@vger.kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 96de65df193607b81ba7323861d58ff7efd3bf38
Author: Takashi Iwai <tiwai@suse.de>
Date:   Fri Aug 10 16:14:26 2018 +0200

    EDAC: Add missing MEM_LRDDR4 entry in edac_mem_types[]
    
    commit b748f2de4b2f578599f46c6000683a8da755bf68 upstream.
    
    The edac_mem_types[] array misses a MEM_LRDDR4 entry, which leads to
    NULL pointer dereference when accessed via sysfs or such.
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Cc: Mauro Carvalho Chehab <mchehab@kernel.org>
    Cc: Yazen Ghannam <Yazen.Ghannam@amd.com>
    Cc: linux-edac <linux-edac@vger.kernel.org>
    Cc: <stable@vger.kernel.org>
    Link: http://lkml.kernel.org/r/20180810141426.8918-1-tiwai@suse.de
    Fixes: 1e8096bb2031 ("EDAC: Add LRDDR4 DRAM type")
    Signed-off-by: Borislav Petkov <bp@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b518e870f1f605536b544d81e52f4570bc9e340f
Author: Gustavo A. R. Silva <gustavo@embeddedor.com>
Date:   Thu Aug 2 22:40:19 2018 -0500

    drm/i915/kvmgt: Fix potential Spectre v1
    
    commit de5372da605d3bca46e3102bab51b7e1c0e0a6f6 upstream.
    
    info.index can be indirectly controlled by user-space, hence leading
    to a potential exploitation of the Spectre variant 1 vulnerability.
    
    This issue was detected with the help of Smatch:
    
    drivers/gpu/drm/i915/gvt/kvmgt.c:1232 intel_vgpu_ioctl() warn:
    potential spectre issue 'vgpu->vdev.region' [r]
    
    Fix this by sanitizing info.index before indirectly using it to index
    vgpu->vdev.region
    
    Notice that given that speculation windows are large, the policy is
    to kill the speculation on the first load and not worry if it can be
    completed with a dependent load/store [1].
    
    [1] https://marc.info/?l=linux-kernel&m=152449131114778&w=2
    
    Cc: stable@vger.kernel.org
    Signed-off-by: Gustavo A. R. Silva <gustavo@embeddedor.com>
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4bc32484df6a3bdc173301adff0c2fdc66667a40
Author: Jeremy Cline <jcline@redhat.com>
Date:   Thu Aug 2 00:03:40 2018 -0400

    ext4: fix spectre gadget in ext4_mb_regular_allocator()
    
    commit 1a5d5e5d51e75a5bca67dadbcea8c841934b7b85 upstream.
    
    'ac->ac_g_ex.fe_len' is a user-controlled value which is used in the
    derivation of 'ac->ac_2order'. 'ac->ac_2order', in turn, is used to
    index arrays which makes it a potential spectre gadget. Fix this by
    sanitizing the value assigned to 'ac->ac2_order'.  This covers the
    following accesses found with the help of smatch:
    
    * fs/ext4/mballoc.c:1896 ext4_mb_simple_scan_group() warn: potential
      spectre issue 'grp->bb_counters' [w] (local cap)
    
    * fs/ext4/mballoc.c:445 mb_find_buddy() warn: potential spectre issue
      'EXT4_SB(e4b->bd_sb)->s_mb_offsets' [r] (local cap)
    
    * fs/ext4/mballoc.c:446 mb_find_buddy() warn: potential spectre issue
      'EXT4_SB(e4b->bd_sb)->s_mb_maxs' [r] (local cap)
    
    Suggested-by: Josh Poimboeuf <jpoimboe@redhat.com>
    Signed-off-by: Jeremy Cline <jcline@redhat.com>
    Signed-off-by: Theodore Ts'o <tytso@mit.edu>
    Cc: stable@vger.kernel.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
