commit 62134e7b2b7993aff369a2f64f5b39634ac7f7c9
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Fri Aug 24 13:07:17 2018 +0200

    Linux 4.17.19

commit c3139458db1fdd5a13dff38ac8dd99ac0dc75ac9
Author: Jann Horn <jannh@google.com>
Date:   Tue Aug 21 21:59:37 2018 -0700

    reiserfs: fix broken xattr handling (heap corruption, bad retval)
    
    commit a13f085d111e90469faf2d9965eb39b11c114d7e upstream.
    
    This fixes the following issues:
    
    - When a buffer size is supplied to reiserfs_listxattr() such that each
      individual name fits, but the concatenation of all names doesn't fit,
      reiserfs_listxattr() overflows the supplied buffer.  This leads to a
      kernel heap overflow (verified using KASAN) followed by an out-of-bounds
      usercopy and is therefore a security bug.
    
    - When a buffer size is supplied to reiserfs_listxattr() such that a
      name doesn't fit, -ERANGE should be returned.  But reiserfs instead just
      truncates the list of names; I have verified that if the only xattr on a
      file has a longer name than the supplied buffer length, listxattr()
      incorrectly returns zero.
    
    With my patch applied, -ERANGE is returned in both cases and the memory
    corruption doesn't happen anymore.
    
    Credit for making me clean this code up a bit goes to Al Viro, who pointed
    out that the ->actor calling convention is suboptimal and should be
    changed.
    
    Link: http://lkml.kernel.org/r/20180802151539.5373-1-jannh@google.com
    Fixes: 48b32a3553a5 ("reiserfs: use generic xattr handlers")
    Signed-off-by: Jann Horn <jannh@google.com>
    Acked-by: Jeff Mahoney <jeffm@suse.com>
    Cc: Eric Biggers <ebiggers@google.com>
    Cc: Al Viro <viro@zeniv.linux.org.uk>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9a63bbbf78cc9e346f563b8d17371d31fddf25c5
Author: Esben Haabendal <eha@deif.com>
Date:   Thu Aug 16 10:43:12 2018 +0200

    i2c: imx: Fix race condition in dma read
    
    commit bed4ff1ed4d8f2ef5007c5c6ae1b29c5677a3632 upstream.
    
    This fixes a race condition, where the DMAEN bit ends up being set after
    I2C slave has transmitted a byte following the dummy read.  When that
    happens, an interrupt is generated instead, and no DMA request is generated
    to kickstart the DMA read, and a timeout happens after DMA_TIMEOUT (1 sec).
    
    Fixed by setting the DMAEN bit before the dummy read.
    
    Signed-off-by: Esben Haabendal <eha@deif.com>
    Acked-by: Uwe Kleine-KÃ¶nig <u.kleine-koenig@pengutronix.de>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Cc: stable@kernel.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7da4d0e8b0366b0809fa8e88689e821150d4aae0
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Sun Aug 12 12:53:20 2018 +0200

    i2c: core: ACPI: Properly set status byte to 0 for multi-byte writes
    
    commit c463a158cb6c5d9a85b7d894cd4f8116e8bd6be0 upstream.
    
    acpi_gsb_i2c_write_bytes() returns i2c_transfer()'s return value, which
    is the number of transfers executed on success, so 1.
    
    The ACPI code expects us to store 0 in gsb->status for success, not 1.
    
    Specifically this breaks the following code in the Thinkpad 8 DSDT:
    
                ECWR = I2CW = ECWR /* \_SB_.I2C1.BAT0.ECWR */
                If ((ECST == Zero))
                {
                    ECRD = I2CR /* \_SB_.I2C1.I2CR */
                }
    
    Before this commit we set ECST to 1, causing the read to never happen
    breaking battery monitoring on the Thinkpad 8.
    
    This commit makes acpi_gsb_i2c_write_bytes() return 0 when i2c_transfer()
    returns 1, so the single write transfer completed successfully, and
    makes it return -EIO on for other (unexpected) return values >= 0.
    
    Cc: stable@vger.kernel.org
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Acked-by: Mika Westerberg <mika.westerberg@linux.intel.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d8534575d550e5f8a977f5bf842fb81fd1883d7f
Author: Lukas Wunner <lukas@wunner.de>
Date:   Thu Jul 19 17:27:34 2018 -0500

    PCI: pciehp: Fix unprotected list iteration in IRQ handler
    
    commit 1204e35bedf4e5015cda559ed8c84789a6dae24e upstream.
    
    Commit b440bde74f04 ("PCI: Add pci_ignore_hotplug() to ignore hotplug
    events for a device") iterates over the devices on a hotplug port's
    subordinate bus in pciehp's IRQ handler without acquiring pci_bus_sem.
    It is thus possible for a user to cause a crash by concurrently
    manipulating the device list, e.g. by disabling slot power via sysfs
    on a different CPU or by initiating a remove/rescan via sysfs.
    
    This can't be fixed by acquiring pci_bus_sem because it may sleep.
    The simplest fix is to avoid the list iteration altogether and just
    check the ignore_hotplug flag on the port itself.  This works because
    pci_ignore_hotplug() sets the flag both on the device as well as on its
    parent bridge.
    
    We do lose the ability to print the name of the device blocking hotplug
    in the debug message, but that's probably bearable.
    
    Fixes: b440bde74f04 ("PCI: Add pci_ignore_hotplug() to ignore hotplug events for a device")
    Signed-off-by: Lukas Wunner <lukas@wunner.de>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5aceac0e4cd11a5d30cb9afb94fdd98833868eca
Author: Lukas Wunner <lukas@wunner.de>
Date:   Thu Jul 19 17:27:32 2018 -0500

    PCI: pciehp: Fix use-after-free on unplug
    
    commit 281e878eab191cce4259abbbf1a0322e3adae02c upstream.
    
    When pciehp is unbound (e.g. on unplug of a Thunderbolt device), the
    hotplug_slot struct is deregistered and thus freed before freeing the
    IRQ.  The IRQ handler and the work items it schedules print the slot
    name referenced from the freed structure in various informational and
    debug log messages, each time resulting in a quadruple dereference of
    freed pointers (hotplug_slot -> pci_slot -> kobject -> name).
    
    At best the slot name is logged as "(null)", at worst kernel memory is
    exposed in logs or the driver crashes:
    
      pciehp 0000:10:00.0:pcie204: Slot((null)): Card not present
    
    An attacker may provoke the bug by unplugging multiple devices on a
    Thunderbolt daisy chain at once.  Unplugging can also be simulated by
    powering down slots via sysfs.  The bug is particularly easy to trigger
    in poll mode.
    
    It has been present since the driver's introduction in 2004:
    https://git.kernel.org/tglx/history/c/c16b4b14d980
    
    Fix by rearranging teardown such that the IRQ is freed first.  Run the
    work items queued by the IRQ handler to completion before freeing the
    hotplug_slot struct by draining the work queue from the ->release_slot
    callback which is invoked by pci_hp_deregister().
    
    Signed-off-by: Lukas Wunner <lukas@wunner.de>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Cc: stable@vger.kernel.org # v2.6.4
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7231737bb0fd0e1ccb6e05c942ebacc9b1846a80
Author: Myron Stowe <myron.stowe@redhat.com>
Date:   Mon Aug 13 12:19:39 2018 -0600

    PCI: Skip MPS logic for Virtual Functions (VFs)
    
    commit 3dbe97efe8bf450b183d6dee2305cbc032e6b8a4 upstream.
    
    PCIe r4.0, sec 9.3.5.4, "Device Control Register", shows both
    Max_Payload_Size (MPS) and Max_Read_request_Size (MRRS) to be 'RsvdP' for
    VFs.  Just prior to the table it states:
    
      "PF and VF functionality is defined in Section 7.5.3.4 except where
       noted in Table 9-16.  For VF fields marked 'RsvdP', the PF setting
       applies to the VF."
    
    All of which implies that with respect to Max_Payload_Size Supported
    (MPSS), MPS, and MRRS values, we should not be paying any attention to the
    VF's fields, but rather only to the PF's.  Only looking at the PF's fields
    also logically makes sense as it's the sole physical interface to the PCIe
    bus.
    
    Link: https://bugzilla.kernel.org/show_bug.cgi?id=200527
    Fixes: 27d868b5e6cf ("PCI: Set MPS to match upstream bridge")
    Signed-off-by: Myron Stowe <myron.stowe@redhat.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Cc: stable@vger.kernel.org # 4.3+
    Cc: Keith Busch <keith.busch@intel.com>
    Cc: Sinan Kaya <okaya@kernel.org>
    Cc: Dongdong Liu <liudongdong3@huawei.com>
    Cc: Jon Mason <jdmason@kudzu.us>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 221d52fe2de32be2efe7c9801450df16a5e0a6f7
Author: Lukas Wunner <lukas@wunner.de>
Date:   Thu Jul 19 17:27:31 2018 -0500

    PCI: hotplug: Don't leak pci_slot on registration failure
    
    commit 4ce6435820d1f1cc2c2788e232735eb244bcc8a3 upstream.
    
    If addition of sysfs files fails on registration of a hotplug slot, the
    struct pci_slot as well as the entry in the slot_list is leaked.  The
    issue has been present since the hotplug core was introduced in 2002:
    https://git.kernel.org/tglx/history/c/a8a2069f432c
    
    Perhaps the idea was that even though sysfs addition fails, the slot
    should still be usable.  But that's not how drivers use the interface,
    they abort probe if a non-zero value is returned.
    
    Signed-off-by: Lukas Wunner <lukas@wunner.de>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Cc: stable@vger.kernel.org # v2.4.15+
    Cc: Greg Kroah-Hartman <greg@kroah.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 77f57b8a45c8d8e505385be19e8f735639bb3cd1
Author: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Date:   Thu Aug 16 12:56:46 2018 +0200

    PCI / ACPI / PM: Resume all bridges on suspend-to-RAM
    
    commit 9d64b539b738fc181442caab95f1f76d9bd58539 upstream.
    
    Commit 26112ddc254c (PCI / ACPI / PM: Resume bridges w/o drivers on
    suspend-to-RAM) attempted to fix a functional regression resulting
    from commit c62ec4610c40 (PM / core: Fix direct_complete handling
    for devices with no callbacks) by resuming PCI bridges without
    drivers (that is, "parallel PCI" ones) during system-wide suspend if
    the target system state is not ACPI S0 (working state).
    
    That turns out insufficient, however, as it is reported that, at
    least in one case, the platform firmware gets confused if a PCIe
    root port is suspended before entering the ACPI S3 sleep state.
    That issue was exposed by commit 77b3729ca03 (PCI / PM: Use
    SMART_SUSPEND and LEAVE_SUSPENDED flags for PCIe ports) that allowed
    PCIe ports to stay in runtime suspend during system-wide suspend
    (which is OK for suspend-to-idle, but turns out to be problematic
    otherwise).
    
    For this reason, drop the driver check from acpi_pci_need_resume()
    and resume all bridges (including PCIe ports with drivers) during
    system-wide suspend if the target system state is not ACPI S0.
    
    [If the target system state is ACPI S0, it means suspend-to-idle
     and the platform firmware is not going to be invoked to actually
     suspend the system, so there is no need to resume the bridges in
     that case.]
    
    Fixes: 77b3729ca03 (PCI / PM: Use SMART_SUSPEND and LEAVE_SUSPENDED flags for PCIe ports)
    Link: https://bugzilla.kernel.org/show_bug.cgi?id=200675
    Reported-by: teika kazura <teika@gmx.com>
    Tested-by: teika kazura <teika@gmx.com>
    Reviewed-by: Mika Westerberg <mika.westerberg@linux.intel.com>
    Acked-by: Bjorn Helgaas <bhelgaas@google.com>
    Cc: 4.16+ <stable@vger.kernel.org> # 4.16+: 26112ddc254c (PCI / ACPI / PM: Resume bridges ...)
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8f908e1867653b43b2b81534823c276aef6d8995
Author: Christian KÃ¶nig <ckoenig.leichtzumerken@gmail.com>
Date:   Fri Jun 29 19:54:55 2018 -0500

    PCI: Restore resized BAR state on resume
    
    commit d3252ace0bc652a1a244455556b6a549f969bf99 upstream.
    
    Resize BARs after resume to the expected size again.
    
    BugLink: https://bugzilla.kernel.org/show_bug.cgi?id=199959
    Fixes: d6895ad39f3b ("drm/amdgpu: resize VRAM BAR for CPU access v6")
    Fixes: 276b738deb5b ("PCI: Add resizable BAR infrastructure")
    Signed-off-by: Christian KÃ¶nig <christian.koenig@amd.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    CC: stable@vger.kernel.org      # v4.15+
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3cb744554f4d686fdf01dd24d6df57e0f260a96e
Author: Ursula Braun <ubraun@linux.ibm.com>
Date:   Wed Aug 8 14:13:19 2018 +0200

    net/smc: no shutdown in state SMC_LISTEN
    
    commit caa21e19e08d7a1445116a93f7ab4e187ebbbadb upstream.
    
    Invoking shutdown for a socket in state SMC_LISTEN does not make
    sense. Nevertheless programs like syzbot fuzzing the kernel may
    try to do this. For SMC this means a socket refcounting problem.
    This patch makes sure a shutdown call for an SMC socket in state
    SMC_LISTEN simply returns with -ENOTCONN.
    
    Signed-off-by: Ursula Braun <ubraun@linux.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4713ad95833b593a50f7162e503c6c791dc050a9
Author: Willem de Bruijn <willemb@google.com>
Date:   Mon Aug 6 10:38:34 2018 -0400

    packet: refine ring v3 block size test to hold one frame
    
    commit 4576cd469d980317c4edd9173f8b694aa71ea3a3 upstream.
    
    TPACKET_V3 stores variable length frames in fixed length blocks.
    Blocks must be able to store a block header, optional private space
    and at least one minimum sized frame.
    
    Frames, even for a zero snaplen packet, store metadata headers and
    optional reserved space.
    
    In the block size bounds check, ensure that the frame of the
    chosen configuration fits. This includes sockaddr_ll and optional
    tp_reserve.
    
    Syzbot was able to construct a ring with insuffient room for the
    sockaddr_ll in the header of a zero-length frame, triggering an
    out-of-bounds write in dev_parse_header.
    
    Convert the comparison to less than, as zero is a valid snap len.
    This matches the test for minimum tp_frame_size immediately below.
    
    Fixes: f6fb8f100b80 ("af-packet: TPACKET_V3 flexible buffer implementation.")
    Fixes: eb73190f4fbe ("net/packet: refine check for priv area size")
    Reported-by: syzbot <syzkaller@googlegroups.com>
    Signed-off-by: Willem de Bruijn <willemb@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e3648b5ccb51c48ef4889de52827e78eedbe1ca8
Author: Florian Westphal <fw@strlen.de>
Date:   Tue Jul 17 21:03:15 2018 +0200

    netfilter: conntrack: dccp: treat SYNC/SYNCACK as invalid if no prior state
    
    commit 6613b6173dee098997229caf1f3b961c49da75e6 upstream.
    
    When first DCCP packet is SYNC or SYNCACK, we insert a new conntrack
    that has an un-initialized timeout value, i.e. such entry could be
    reaped at any time.
    
    Mark them as INVALID and only ignore SYNC/SYNCACK when connection had
    an old state.
    
    Reported-by: syzbot+6f18401420df260e37ed@syzkaller.appspotmail.com
    Signed-off-by: Florian Westphal <fw@strlen.de>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0a8fd12f855faeea89a416f38777db38cff8369a
Author: Eric Dumazet <edumazet@google.com>
Date:   Mon Jun 18 21:35:07 2018 -0700

    xfrm_user: prevent leaking 2 bytes of kernel memory
    
    commit 45c180bc29babbedd6b8c01b975780ef44d9d09c upstream.
    
    struct xfrm_userpolicy_type has two holes, so we should not
    use C99 style initializer.
    
    KMSAN report:
    
    BUG: KMSAN: kernel-infoleak in copyout lib/iov_iter.c:140 [inline]
    BUG: KMSAN: kernel-infoleak in _copy_to_iter+0x1b14/0x2800 lib/iov_iter.c:571
    CPU: 1 PID: 4520 Comm: syz-executor841 Not tainted 4.17.0+ #5
    Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
    Call Trace:
     __dump_stack lib/dump_stack.c:77 [inline]
     dump_stack+0x185/0x1d0 lib/dump_stack.c:113
     kmsan_report+0x188/0x2a0 mm/kmsan/kmsan.c:1117
     kmsan_internal_check_memory+0x138/0x1f0 mm/kmsan/kmsan.c:1211
     kmsan_copy_to_user+0x7a/0x160 mm/kmsan/kmsan.c:1253
     copyout lib/iov_iter.c:140 [inline]
     _copy_to_iter+0x1b14/0x2800 lib/iov_iter.c:571
     copy_to_iter include/linux/uio.h:106 [inline]
     skb_copy_datagram_iter+0x422/0xfa0 net/core/datagram.c:431
     skb_copy_datagram_msg include/linux/skbuff.h:3268 [inline]
     netlink_recvmsg+0x6f1/0x1900 net/netlink/af_netlink.c:1959
     sock_recvmsg_nosec net/socket.c:802 [inline]
     sock_recvmsg+0x1d6/0x230 net/socket.c:809
     ___sys_recvmsg+0x3fe/0x810 net/socket.c:2279
     __sys_recvmmsg+0x58e/0xe30 net/socket.c:2391
     do_sys_recvmmsg+0x2a6/0x3e0 net/socket.c:2472
     __do_sys_recvmmsg net/socket.c:2485 [inline]
     __se_sys_recvmmsg net/socket.c:2481 [inline]
     __x64_sys_recvmmsg+0x15d/0x1c0 net/socket.c:2481
     do_syscall_64+0x15b/0x230 arch/x86/entry/common.c:287
     entry_SYSCALL_64_after_hwframe+0x44/0xa9
    RIP: 0033:0x446ce9
    RSP: 002b:00007fc307918db8 EFLAGS: 00000293 ORIG_RAX: 000000000000012b
    RAX: ffffffffffffffda RBX: 00000000006dbc24 RCX: 0000000000446ce9
    RDX: 000000000000000a RSI: 0000000020005040 RDI: 0000000000000003
    RBP: 00000000006dbc20 R08: 0000000020004e40 R09: 0000000000000000
    R10: 0000000040000000 R11: 0000000000000293 R12: 0000000000000000
    R13: 00007ffc8d2df32f R14: 00007fc3079199c0 R15: 0000000000000001
    
    Uninit was stored to memory at:
     kmsan_save_stack_with_flags mm/kmsan/kmsan.c:279 [inline]
     kmsan_save_stack mm/kmsan/kmsan.c:294 [inline]
     kmsan_internal_chain_origin+0x12b/0x210 mm/kmsan/kmsan.c:685
     kmsan_memcpy_origins+0x11d/0x170 mm/kmsan/kmsan.c:527
     __msan_memcpy+0x109/0x160 mm/kmsan/kmsan_instr.c:413
     __nla_put lib/nlattr.c:569 [inline]
     nla_put+0x276/0x340 lib/nlattr.c:627
     copy_to_user_policy_type net/xfrm/xfrm_user.c:1678 [inline]
     dump_one_policy+0xbe1/0x1090 net/xfrm/xfrm_user.c:1708
     xfrm_policy_walk+0x45a/0xd00 net/xfrm/xfrm_policy.c:1013
     xfrm_dump_policy+0x1c0/0x2a0 net/xfrm/xfrm_user.c:1749
     netlink_dump+0x9b5/0x1550 net/netlink/af_netlink.c:2226
     __netlink_dump_start+0x1131/0x1270 net/netlink/af_netlink.c:2323
     netlink_dump_start include/linux/netlink.h:214 [inline]
     xfrm_user_rcv_msg+0x8a3/0x9b0 net/xfrm/xfrm_user.c:2577
     netlink_rcv_skb+0x37e/0x600 net/netlink/af_netlink.c:2448
     xfrm_netlink_rcv+0xb2/0xf0 net/xfrm/xfrm_user.c:2598
     netlink_unicast_kernel net/netlink/af_netlink.c:1310 [inline]
     netlink_unicast+0x1680/0x1750 net/netlink/af_netlink.c:1336
     netlink_sendmsg+0x104f/0x1350 net/netlink/af_netlink.c:1901
     sock_sendmsg_nosec net/socket.c:629 [inline]
     sock_sendmsg net/socket.c:639 [inline]
     ___sys_sendmsg+0xec8/0x1320 net/socket.c:2117
     __sys_sendmsg net/socket.c:2155 [inline]
     __do_sys_sendmsg net/socket.c:2164 [inline]
     __se_sys_sendmsg net/socket.c:2162 [inline]
     __x64_sys_sendmsg+0x331/0x460 net/socket.c:2162
     do_syscall_64+0x15b/0x230 arch/x86/entry/common.c:287
     entry_SYSCALL_64_after_hwframe+0x44/0xa9
    Local variable description: ----upt.i@dump_one_policy
    Variable was created at:
     dump_one_policy+0x78/0x1090 net/xfrm/xfrm_user.c:1689
     xfrm_policy_walk+0x45a/0xd00 net/xfrm/xfrm_policy.c:1013
    
    Byte 130 of 137 is uninitialized
    Memory access starts at ffff88019550407f
    
    Fixes: c0144beaeca42 ("[XFRM] netlink: Use nla_put()/NLA_PUT() variantes")
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Reported-by: syzbot <syzkaller@googlegroups.com>
    Cc: Steffen Klassert <steffen.klassert@secunet.com>
    Cc: Herbert Xu <herbert@gondor.apana.org.au>
    Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5b75a91fc67fdb6a1b4b5acf58aa5bca5e6ac3ac
Author: John David Anglin <dave.anglin@bell.net>
Date:   Sun Aug 12 16:38:03 2018 -0400

    parisc: Remove ordered stores from syscall.S
    
    commit 7797167ffde1f00446301cb22b37b7c03194cfaf upstream.
    
    Now that we use a sync prior to releasing the locks in syscall.S, we don't need
    the PA 2.0 ordered stores used to release some locks.Â  Using an ordered store,
    potentially slows the release and subsequent code.
    
    There are a number of other ordered stores and loads that serve no purpose.Â  I
    have converted these to normal stores.
    
    Signed-off-by: John David Anglin <dave.anglin@bell.net>
    Cc: stable@vger.kernel.org # 4.0+
    Signed-off-by: Helge Deller <deller@gmx.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5c9fc580b1bc23eb8a23fddbd67e82c29d2aadfe
Author: John David Anglin <dave.anglin@bell.net>
Date:   Sun Aug 12 16:31:17 2018 -0400

    parisc: Remove unnecessary barriers from spinlock.h
    
    commit 3b885ac1dc35b87a39ee176a6c7e2af9c789d8b8 upstream.
    
    Now that mb() is an instruction barrier, it will slow performance if we issue
    unnecessary barriers.
    
    The spinlock defines have a number of unnecessary barriers.Â  The __ldcw()
    define is both a hardware and compiler barrier.Â  The mb() barriers in the
    routines using __ldcw() serve no purpose.
    
    The only barrier needed is the one in arch_spin_unlock().Â  We need to ensure
    all accesses are complete prior to releasing the lock.
    
    Signed-off-by: John David Anglin <dave.anglin@bell.net>
    Cc: stable@vger.kernel.org # 4.0+
    Signed-off-by: Helge Deller <deller@gmx.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4027d547d60121602404873c92c673d18ce7af7d
Author: Gustavo A. R. Silva <gustavo@embeddedor.com>
Date:   Mon Jul 23 11:32:32 2018 -0500

    drm/amdgpu/pm: Fix potential Spectre v1
    
    commit ddf74e79a54070f277ae520722d3bab7f7a6c67a upstream.
    
    idx can be indirectly controlled by user-space, hence leading to a
    potential exploitation of the Spectre variant 1 vulnerability.
    
    This issue was detected with the help of Smatch:
    
    drivers/gpu/drm/amd/amdgpu/amdgpu_pm.c:408 amdgpu_set_pp_force_state()
    warn: potential spectre issue 'data.states'
    
    Fix this by sanitizing idx before using it to index data.states
    
    Notice that given that speculation windows are large, the policy is
    to kill the speculation on the first load and not worry if it can be
    completed with a dependent load/store [1].
    
    [1] https://marc.info/?l=linux-kernel&m=152449131114778&w=2
    
    Cc: stable@vger.kernel.org
    Signed-off-by: Gustavo A. R. Silva <gustavo@embeddedor.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 766cbfbce2df2f402f77240da8650483a968c8ee
Author: Gustavo A. R. Silva <gustavo@embeddedor.com>
Date:   Thu Aug 2 22:40:19 2018 -0500

    drm/i915/kvmgt: Fix potential Spectre v1
    
    commit de5372da605d3bca46e3102bab51b7e1c0e0a6f6 upstream.
    
    info.index can be indirectly controlled by user-space, hence leading
    to a potential exploitation of the Spectre variant 1 vulnerability.
    
    This issue was detected with the help of Smatch:
    
    drivers/gpu/drm/i915/gvt/kvmgt.c:1232 intel_vgpu_ioctl() warn:
    potential spectre issue 'vgpu->vdev.region' [r]
    
    Fix this by sanitizing info.index before indirectly using it to index
    vgpu->vdev.region
    
    Notice that given that speculation windows are large, the policy is
    to kill the speculation on the first load and not worry if it can be
    completed with a dependent load/store [1].
    
    [1] https://marc.info/?l=linux-kernel&m=152449131114778&w=2
    
    Cc: stable@vger.kernel.org
    Signed-off-by: Gustavo A. R. Silva <gustavo@embeddedor.com>
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit df2ef7a510fa4c784adc53ef72b1b392a4033ad2
Author: Jeremy Cline <jcline@redhat.com>
Date:   Thu Aug 2 00:03:40 2018 -0400

    ext4: fix spectre gadget in ext4_mb_regular_allocator()
    
    commit 1a5d5e5d51e75a5bca67dadbcea8c841934b7b85 upstream.
    
    'ac->ac_g_ex.fe_len' is a user-controlled value which is used in the
    derivation of 'ac->ac_2order'. 'ac->ac_2order', in turn, is used to
    index arrays which makes it a potential spectre gadget. Fix this by
    sanitizing the value assigned to 'ac->ac2_order'.  This covers the
    following accesses found with the help of smatch:
    
    * fs/ext4/mballoc.c:1896 ext4_mb_simple_scan_group() warn: potential
      spectre issue 'grp->bb_counters' [w] (local cap)
    
    * fs/ext4/mballoc.c:445 mb_find_buddy() warn: potential spectre issue
      'EXT4_SB(e4b->bd_sb)->s_mb_offsets' [r] (local cap)
    
    * fs/ext4/mballoc.c:446 mb_find_buddy() warn: potential spectre issue
      'EXT4_SB(e4b->bd_sb)->s_mb_maxs' [r] (local cap)
    
    Suggested-by: Josh Poimboeuf <jpoimboe@redhat.com>
    Signed-off-by: Jeremy Cline <jcline@redhat.com>
    Signed-off-by: Theodore Ts'o <tytso@mit.edu>
    Cc: stable@vger.kernel.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 74953b0d4987a1c699d78cc70c7a361ad70b34ba
Author: Dave Hansen <dave.hansen@linux.intel.com>
Date:   Thu Aug 2 15:58:31 2018 -0700

    x86/mm/init: Remove freed kernel image areas from alias mapping
    
    commit c40a56a7818cfe735fc93a69e1875f8bba834483 upstream.
    
    The kernel image is mapped into two places in the virtual address space
    (addresses without KASLR, of course):
    
            1. The kernel direct map (0xffff880000000000)
            2. The "high kernel map" (0xffffffff81000000)
    
    We actually execute out of #2.  If we get the address of a kernel symbol,
    it points to #2, but almost all physical-to-virtual translations point to
    
    Parts of the "high kernel map" alias are mapped in the userspace page
    tables with the Global bit for performance reasons.  The parts that we map
    to userspace do not (er, should not) have secrets. When PTI is enabled then
    the global bit is usually not set in the high mapping and just used to
    compensate for poor performance on systems which lack PCID.
    
    This is fine, except that some areas in the kernel image that are adjacent
    to the non-secret-containing areas are unused holes.  We free these holes
    back into the normal page allocator and reuse them as normal kernel memory.
    The memory will, of course, get *used* via the normal map, but the alias
    mapping is kept.
    
    This otherwise unused alias mapping of the holes will, by default keep the
    Global bit, be mapped out to userspace, and be vulnerable to Meltdown.
    
    Remove the alias mapping of these pages entirely.  This is likely to
    fracture the 2M page mapping the kernel image near these areas, but this
    should affect a minority of the area.
    
    The pageattr code changes *all* aliases mapping the physical pages that it
    operates on (by default).  We only want to modify a single alias, so we
    need to tweak its behavior.
    
    This unmapping behavior is currently dependent on PTI being in place.
    Going forward, we should at least consider doing this for all
    configurations.  Having an extra read-write alias for memory is not exactly
    ideal for debugging things like random memory corruption and this does
    undercut features like DEBUG_PAGEALLOC or future work like eXclusive Page
    Frame Ownership (XPFO).
    
    Before this patch:
    
    current_kernel:---[ High Kernel Mapping ]---
    current_kernel-0xffffffff80000000-0xffffffff81000000          16M                               pmd
    current_kernel-0xffffffff81000000-0xffffffff81e00000          14M     ro         PSE     GLB x  pmd
    current_kernel-0xffffffff81e00000-0xffffffff81e11000          68K     ro                 GLB x  pte
    current_kernel-0xffffffff81e11000-0xffffffff82000000        1980K     RW                     NX pte
    current_kernel-0xffffffff82000000-0xffffffff82600000           6M     ro         PSE     GLB NX pmd
    current_kernel-0xffffffff82600000-0xffffffff82c00000           6M     RW         PSE         NX pmd
    current_kernel-0xffffffff82c00000-0xffffffff82e00000           2M     RW                     NX pte
    current_kernel-0xffffffff82e00000-0xffffffff83200000           4M     RW         PSE         NX pmd
    current_kernel-0xffffffff83200000-0xffffffffa0000000         462M                               pmd
    
      current_user:---[ High Kernel Mapping ]---
      current_user-0xffffffff80000000-0xffffffff81000000          16M                               pmd
      current_user-0xffffffff81000000-0xffffffff81e00000          14M     ro         PSE     GLB x  pmd
      current_user-0xffffffff81e00000-0xffffffff81e11000          68K     ro                 GLB x  pte
      current_user-0xffffffff81e11000-0xffffffff82000000        1980K     RW                     NX pte
      current_user-0xffffffff82000000-0xffffffff82600000           6M     ro         PSE     GLB NX pmd
      current_user-0xffffffff82600000-0xffffffffa0000000         474M                               pmd
    
    After this patch:
    
    current_kernel:---[ High Kernel Mapping ]---
    current_kernel-0xffffffff80000000-0xffffffff81000000          16M                               pmd
    current_kernel-0xffffffff81000000-0xffffffff81e00000          14M     ro         PSE     GLB x  pmd
    current_kernel-0xffffffff81e00000-0xffffffff81e11000          68K     ro                 GLB x  pte
    current_kernel-0xffffffff81e11000-0xffffffff82000000        1980K                               pte
    current_kernel-0xffffffff82000000-0xffffffff82400000           4M     ro         PSE     GLB NX pmd
    current_kernel-0xffffffff82400000-0xffffffff82488000         544K     ro                     NX pte
    current_kernel-0xffffffff82488000-0xffffffff82600000        1504K                               pte
    current_kernel-0xffffffff82600000-0xffffffff82c00000           6M     RW         PSE         NX pmd
    current_kernel-0xffffffff82c00000-0xffffffff82c0d000          52K     RW                     NX pte
    current_kernel-0xffffffff82c0d000-0xffffffff82dc0000        1740K                               pte
    
      current_user:---[ High Kernel Mapping ]---
      current_user-0xffffffff80000000-0xffffffff81000000          16M                               pmd
      current_user-0xffffffff81000000-0xffffffff81e00000          14M     ro         PSE     GLB x  pmd
      current_user-0xffffffff81e00000-0xffffffff81e11000          68K     ro                 GLB x  pte
      current_user-0xffffffff81e11000-0xffffffff82000000        1980K                               pte
      current_user-0xffffffff82000000-0xffffffff82400000           4M     ro         PSE     GLB NX pmd
      current_user-0xffffffff82400000-0xffffffff82488000         544K     ro                     NX pte
      current_user-0xffffffff82488000-0xffffffff82600000        1504K                               pte
      current_user-0xffffffff82600000-0xffffffffa0000000         474M                               pmd
    
    [ tglx: Do not unmap on 32bit as there is only one mapping ]
    
    Fixes: 0f561fce4d69 ("x86/pti: Enable global pages for shared areas")
    Signed-off-by: Dave Hansen <dave.hansen@linux.intel.com>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Cc: Kees Cook <keescook@google.com>
    Cc: Andrea Arcangeli <aarcange@redhat.com>
    Cc: Juergen Gross <jgross@suse.com>
    Cc: Josh Poimboeuf <jpoimboe@redhat.com>
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Hugh Dickins <hughd@google.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: Andi Kleen <ak@linux.intel.com>
    Cc: Joerg Roedel <jroedel@suse.de>
    Link: https://lkml.kernel.org/r/20180802225831.5F6A2BFC@viggo.jf.intel.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e35cecb1863bb056962151e3387a636dd322cb18
Author: Dave Hansen <dave.hansen@linux.intel.com>
Date:   Thu Aug 2 15:58:29 2018 -0700

    x86/mm/init: Add helper for freeing kernel image pages
    
    commit 6ea2738e0ca0e626c75202fb051c1e88d7a950fa upstream.
    
    When chunks of the kernel image are freed, free_init_pages() is used
    directly.  Consolidate the three sites that do this.  Also update the
    string to give an incrementally better description of that memory versus
    what was there before.
    
    Signed-off-by: Dave Hansen <dave.hansen@linux.intel.com>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Cc: keescook@google.com
    Cc: aarcange@redhat.com
    Cc: jgross@suse.com
    Cc: jpoimboe@redhat.com
    Cc: gregkh@linuxfoundation.org
    Cc: peterz@infradead.org
    Cc: hughd@google.com
    Cc: torvalds@linux-foundation.org
    Cc: bp@alien8.de
    Cc: luto@kernel.org
    Cc: ak@linux.intel.com
    Cc: Kees Cook <keescook@google.com>
    Cc: Andrea Arcangeli <aarcange@redhat.com>
    Cc: Juergen Gross <jgross@suse.com>
    Cc: Josh Poimboeuf <jpoimboe@redhat.com>
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Hugh Dickins <hughd@google.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: Andi Kleen <ak@linux.intel.com>
    Link: https://lkml.kernel.org/r/20180802225829.FE0E32EA@viggo.jf.intel.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6a794d62d1a70bdab613dfe24513d421f45931df
Author: Dave Hansen <dave.hansen@linux.intel.com>
Date:   Thu Aug 2 15:58:28 2018 -0700

    x86/mm/init: Pass unconverted symbol addresses to free_init_pages()
    
    commit 9f515cdb411ef34f1aaf4c40bb0c932cf6db5de1 upstream.
    
    The x86 code has several places where it frees parts of kernel image:
    
     1. Unused SMP alternative
     2. __init code
     3. The hole between text and rodata
     4. The hole between rodata and data
    
    We call free_init_pages() to do this.  Strangely, we convert the symbol
    addresses to kernel direct map addresses in some cases (#3, #4) but not
    others (#1, #2).
    
    The virt_to_page() and the other code in free_reserved_area() now works
    fine for for symbol addresses on x86, so don't bother converting the
    addresses to direct map addresses before freeing them.
    
    Signed-off-by: Dave Hansen <dave.hansen@linux.intel.com>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Cc: keescook@google.com
    Cc: aarcange@redhat.com
    Cc: jgross@suse.com
    Cc: jpoimboe@redhat.com
    Cc: gregkh@linuxfoundation.org
    Cc: peterz@infradead.org
    Cc: hughd@google.com
    Cc: torvalds@linux-foundation.org
    Cc: bp@alien8.de
    Cc: luto@kernel.org
    Cc: ak@linux.intel.com
    Cc: Kees Cook <keescook@google.com>
    Cc: Andrea Arcangeli <aarcange@redhat.com>
    Cc: Juergen Gross <jgross@suse.com>
    Cc: Josh Poimboeuf <jpoimboe@redhat.com>
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Hugh Dickins <hughd@google.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: Andi Kleen <ak@linux.intel.com>
    Link: https://lkml.kernel.org/r/20180802225828.89B2D0E2@viggo.jf.intel.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 79e944b0689601cb190f9bb63cbfab5c197161db
Author: Dave Hansen <dave.hansen@linux.intel.com>
Date:   Thu Aug 2 15:58:26 2018 -0700

    mm: Allow non-direct-map arguments to free_reserved_area()
    
    commit 0d83432811f26871295a9bc24d3c387924da6071 upstream.
    
    free_reserved_area() takes pointers as arguments to show which addresses
    should be freed.  However, it does this in a somewhat ambiguous way.  If it
    gets a kernel direct map address, it always works.  However, if it gets an
    address that is part of the kernel image alias mapping, it can fail.
    
    It fails if all of the following happen:
     * The specified address is part of the kernel image alias
     * Poisoning is requested (forcing a memset())
     * The address is in a read-only portion of the kernel image
    
    The memset() fails on the read-only mapping, of course.
    free_reserved_area() *is* called both on the direct map and on kernel image
    alias addresses.  We've just lucked out thus far that the kernel image
    alias areas it gets used on are read-write.  I'm fairly sure this has been
    just a happy accident.
    
    It is quite easy to make free_reserved_area() work for all cases: just
    convert the address to a direct map address before doing the memset(), and
    do this unconditionally.  There is little chance of a regression here
    because we previously did a virt_to_page() on the address for the memset,
    so we know these are not highmem pages for which virt_to_page() would fail.
    
    Signed-off-by: Dave Hansen <dave.hansen@linux.intel.com>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Cc: keescook@google.com
    Cc: aarcange@redhat.com
    Cc: jgross@suse.com
    Cc: jpoimboe@redhat.com
    Cc: gregkh@linuxfoundation.org
    Cc: peterz@infradead.org
    Cc: hughd@google.com
    Cc: torvalds@linux-foundation.org
    Cc: bp@alien8.de
    Cc: luto@kernel.org
    Cc: ak@linux.intel.com
    Cc: Kees Cook <keescook@google.com>
    Cc: Andrea Arcangeli <aarcange@redhat.com>
    Cc: Juergen Gross <jgross@suse.com>
    Cc: Josh Poimboeuf <jpoimboe@redhat.com>
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Hugh Dickins <hughd@google.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: Andi Kleen <ak@linux.intel.com>
    Link: https://lkml.kernel.org/r/20180802225826.1287AE3E@viggo.jf.intel.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 965f2fed020e56bfdf09e08a86e2d63902213f7b
Author: Matthijs van Duin <matthijsvanduin@gmail.com>
Date:   Thu Jul 19 10:43:46 2018 +0200

    pty: fix O_CLOEXEC for TIOCGPTPEER
    
    commit 36ecc1481dc8d8c52d43ba18c6b642c1d2fde789 upstream.
    
    It was being ignored because the flags were not passed to fd allocation.
    
    Fixes: 54ebbfb16034 ("tty: add TIOCGPTPEER ioctl")
    Signed-off-by: Matthijs van Duin <matthijsvanduin@gmail.com>
    Acked-by: Aleksa Sarai <asarai@suse.de>
    Cc: stable <stable@vger.kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5be1b251b3b82833d042ef5e6c906303cf638a87
Author: Takashi Iwai <tiwai@suse.de>
Date:   Fri Aug 10 16:14:26 2018 +0200

    EDAC: Add missing MEM_LRDDR4 entry in edac_mem_types[]
    
    commit b748f2de4b2f578599f46c6000683a8da755bf68 upstream.
    
    The edac_mem_types[] array misses a MEM_LRDDR4 entry, which leads to
    NULL pointer dereference when accessed via sysfs or such.
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Cc: Mauro Carvalho Chehab <mchehab@kernel.org>
    Cc: Yazen Ghannam <Yazen.Ghannam@amd.com>
    Cc: linux-edac <linux-edac@vger.kernel.org>
    Cc: <stable@vger.kernel.org>
    Link: http://lkml.kernel.org/r/20180810141426.8918-1-tiwai@suse.de
    Fixes: 1e8096bb2031 ("EDAC: Add LRDDR4 DRAM type")
    Signed-off-by: Borislav Petkov <bp@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d9b875a4a1a49414bfed766614901b41aefffe4f
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Sat Jul 21 15:24:03 2018 -0700

    mm: make vm_area_alloc() initialize core fields
    
    [ Upstream commit 490fc053865c9cc40f1085ef8a5504f5341f79d2 ]
    
    Like vm_area_dup(), it initializes the anon_vma_chain head, and the
    basic mm pointer.
    
    The rest of the fields end up being different for different users,
    although the plan is to also initialize the 'vm_ops' field to a dummy
    entry.
    
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ae97be30fa7d9e99359598fcef22db0415e10181
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Sat Jul 21 14:48:45 2018 -0700

    mm: make vm_area_dup() actually copy the old vma data
    
    [ Upstream commit 95faf6992df468f617edb788da8c21c6eed0dfa7 ]
    
    .. and re-initialize th eanon_vma_chain head.
    
    This removes some boiler-plate from the users, and also makes it clear
    why it didn't need use the 'zalloc()' version.
    
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5aac8b553059deec6d5d628f6da9271e247a0aac
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Sat Jul 21 13:48:51 2018 -0700

    mm: use helper functions for allocating and freeing vm_area structs
    
    [ Upstream commit 3928d4f5ee37cdc523894f6e549e6aae521d8980 ]
    
    The vm_area_struct is one of the most fundamental memory management
    objects, but the management of it is entirely open-coded evertwhere,
    ranging from allocation and freeing (using kmem_cache_[z]alloc and
    kmem_cache_free) to initializing all the fields.
    
    We want to unify this in order to end up having some unified
    initialization of the vmas, and the first step to this is to at least
    have basic allocation functions.
    
    Right now those functions are literally just wrappers around the
    kmem_cache_*() calls.  This is a purely mechanical conversion:
    
        # new vma:
        kmem_cache_zalloc(vm_area_cachep, GFP_KERNEL) -> vm_area_alloc()
    
        # copy old vma
        kmem_cache_alloc(vm_area_cachep, GFP_KERNEL) -> vm_area_dup(old)
    
        # free vma
        kmem_cache_free(vm_area_cachep, vma) -> vm_area_free(vma)
    
    to the point where the old vma passed in to the vm_area_dup() function
    isn't even used yet (because I've left all the old manual initialization
    alone).
    
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2a271623ce9801ed0244517bfc8b4f4e7ee33eff
Author: Roland Dreier <roland@purestorage.com>
Date:   Thu Jul 19 20:07:59 2018 -0700

    nvme: fix handling of metadata_len for NVME_IOCTL_IO_CMD
    
    [ Upstream commit 9b382768135ee3ff282f828c906574a8478e036b ]
    
    The old code in nvme_user_cmd() passed the userspace virtual address
    from nvme_passthru_cmd.metadata as the length of the metadata buffer
    as well as the address to nvme_submit_user_cmd().
    
    Fixes: 63263d60 ("nvme: Use metadata for passthrough commands")
    Signed-off-by: Roland Dreier <roland@purestorage.com>
    Reviewed-by: Keith Busch <keith.busch@intel.com>
    Signed-off-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 587eb87b45bb6a97452b9719f63cd489e1371e77
Author: Damien ThÃ©bault <damien@dtbo.net>
Date:   Wed Jul 18 12:06:01 2018 +0200

    platform/x86: dell-laptop: Fix backlight detection
    
    [ Upstream commit 2502e5a025935b7b476b69eda4959b3c4022c72b ]
    
    Fix return code check for "max brightness" ACPI call.
    
    The Dell laptop ACPI video brightness control is not present on dell
    laptops anymore, but was present in older kernel versions.
    
    The code that checks the return value is incorrect since the SMM
    refactoring.
    
    The old code was:
      if (buffer->output[0] == 0)
    
    Which was changed to:
      ret = dell_send_request(...)
      if (ret)
    
    However, dell_send_request() will return 0 if buffer->output[0] == 0,
    so we must change the check to:
      if (ret == 0)
    
    This issue was found on a Dell M4800 laptop, and the fix tested on it
    as well.
    
    Fixes: 549b4930f057 ("dell-smbios: Introduce dispatcher for SMM calls")
    Signed-off-by: Damien ThÃ©bault <damien@dtbo.net>
    Tested-by: Damien ThÃ©bault <damien@dtbo.net>
    Reviewed-by: Pali RohÃ¡r <pali.rohar@gmail.com>
    Reviewed-by: Mario Limonciello <mario.limonciello@dell.com>
    Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 844c2af02cd226fd7876d87aaf9c09d9da94553e
Author: Uwe Kleine-KÃ¶nig <u.kleine-koenig@pengutronix.de>
Date:   Thu Jul 19 21:38:23 2018 +0200

    ARM: dts: imx6: RDU2: fix irq type for mv88e6xxx switch
    
    [ Upstream commit e01a06c8089132bb4da035c6a83df23916ca3ebf ]
    
    The Marvell switches report their interrupts in a level sensitive way.
    When using edge sensitive detection a race condition in the interrupt
    handler of the swich might result in the OS to miss all future events
    which might make the switch non-functional.
    
    The problem is that both mv88e6xxx_g2_irq_thread_fn() and
    mv88e6xxx_g1_irq_thread_work() sample the irq cause register
    (MV88E6XXX_G2_INT_SRC and MV88E6XXX_G1_STS respectively) once and then
    handle the observed sources. If after sampling but before all observed
    irq sources are handled a new irq source gets active this is not noticed
    by the handler which returns unsuspecting, but the interrupt line stays
    active which prevents the edge detector to kick in.
    
    All device trees but imx6qdl-zii-rdu2 get this right (most of them by
    not specifying an interrupt parent). So fix imx6qdl-zii-rdu2
    accordingly.
    
    Signed-off-by: Uwe Kleine-KÃ¶nig <u.kleine-koenig@pengutronix.de>
    Fixes: f64992d1a916 ("ARM: dts: imx6: RDU2: Add Switch interrupts")
    Reviewed-by: Andrew Lunn <andrew@lunn.ch>
    Signed-off-by: Shawn Guo <shawnguo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fb57f5aa7b7bd09419bb3959d768bda6a6bf0a23
Author: Robin H. Johnson <robbat2@gentoo.org>
Date:   Fri Jul 13 20:50:47 2018 +0000

    ACPI / EC: Use ec_no_wakeup on more Thinkpad X1 Carbon 6th systems
    
    [ Upstream commit 2c4d6baf1bc4f7729773ffcee9ba2a9781578633 ]
    
    The ec_no_wakeup matcher added for Thinkpad X1 Carbon 6th gen systems
    beyond matched only a single DMI model (20KGS3JF01), that didn't cover
    my laptop (20KH002JUS). Change to match based on DMI product family to
    cover all X1 6th gen systems.
    
    Signed-off-by: Robin H. Johnson <robbat2@gentoo.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 710a0cc2cc996b25db56ecf1ac5845f7af06841c
Author: Anson Huang <Anson.Huang@nxp.com>
Date:   Tue Jul 17 11:28:46 2018 +0800

    soc: imx: gpc: restrict register range for regmap access
    
    [ Upstream commit de2d9b5284bcb5c159c5882ac69f6bfd4dec7c67 ]
    
    GPC registers are NOT continuous, some registers are
    reserved and accessing them from userspace will trigger
    external abort, add regmap register access table to
    avoid below abort:
    
    root@imx6slevk:~# cat /sys/kernel/debug/regmap/20dc000.gpc/registers
    [  108.480477] Unhandled fault: imprecise external abort (0x1406) at 0xb6db5004
    [  108.487985] pgd = 42b54bfd
    [  108.490741] [b6db5004] *pgd=ba1b7831
    [  108.494386] Internal error: : 1406 [#1] SMP ARM
    [  108.498943] Modules linked in:
    [  108.502043] CPU: 0 PID: 389 Comm: cat Not tainted 4.18.0-rc1-00074-gc9f1f60-dirty #482
    [  108.509982] Hardware name: Freescale i.MX6 SoloLite (Device Tree)
    [  108.516123] PC is at regmap_mmio_read32le+0x20/0x24
    [  108.521031] LR is at regmap_mmio_read+0x40/0x60
    [  108.525586] pc : [<c059cf74>]    lr : [<c059d1ac>]    psr: 20060093
    [  108.531875] sp : eccf1d98  ip : eccf1da8  fp : eccf1da4
    [  108.537122] r10: ec2d3800  r9 : eccf1f60  r8 : ecfc0000
    [  108.542370] r7 : eccf1e2c  r6 : eccf1e2c  r5 : 00000028  r4 : ec338e00
    [  108.548920] r3 : 00000000  r2 : eccf1e2c  r1 : f0980028  r0 : 00000000
    [  108.555474] Flags: nzCv  IRQs off  FIQs on  Mode SVC_32  ISA ARM  Segment none
    [  108.562720] Control: 10c5387d  Table: acf4004a  DAC: 00000051
    [  108.568491] Process cat (pid: 389, stack limit = 0xd4318a65)
    [  108.574174] Stack: (0xeccf1d98 to 0xeccf2000)
    
    Fixes: 721cabf6c660 ("soc: imx: move PGC handling to a new GPC driver")
    Signed-off-by: Anson Huang <Anson.Huang@nxp.com>
    Reviewed-by: Fabio Estevam <fabio.estevam@nxp.com>
    Signed-off-by: Shawn Guo <shawnguo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cb0bd535041ea0541b06d1d152954469799ec8a4
Author: Randy Dunlap <rdunlap@infradead.org>
Date:   Tue Jul 17 18:27:45 2018 -0700

    tcp: identify cryptic messages as TCP seq # bugs
    
    [ Upstream commit e56b8ce363a36fb7b74b80aaa5cc9084f2c908b4 ]
    
    Attempt to make cryptic TCP seq number error messages clearer by
    (1) identifying the source of the message as "TCP", (2) identifying the
    errors as "seq # bug", and (3) grouping the field identifiers and values
    by separating them with commas.
    
    E.g., the following message is changed from:
    
    recvmsg bug 2: copied 73BCB6CD seq 70F17CBE rcvnxt 73BCB9AA fl 0
    WARNING: CPU: 2 PID: 1501 at /linux/net/ipv4/tcp.c:1881 tcp_recvmsg+0x649/0xb90
    
    to:
    
    TCP recvmsg seq # bug 2: copied 73BCB6CD, seq 70F17CBE, rcvnxt 73BCB9AA, fl 0
    WARNING: CPU: 2 PID: 1501 at /linux/net/ipv4/tcp.c:2011 tcp_recvmsg+0x694/0xba0
    
    Suggested-by: ç©ä¸¹å°¼ Dan Jacobson <jidanni@jidanni.org>
    Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 50657bdfc903894fcaed15391576152f4751a576
Author: Alexander Sverdlin <alexander.sverdlin@nokia.com>
Date:   Tue Jul 17 18:23:58 2018 +0200

    net: cavium: Add fine-granular dependencies on PCI
    
    [ Upstream commit e40562abdf81f32356218d4196c33f5f93c040f7 ]
    
    Add dependencies on PCI where necessary.
    
    Fixes: 7e2bc7fb65 ("net: cavium: Drop dependency of NET_VENDOR_CAVIUM on PCI")
    Signed-off-by: Alexander Sverdlin <alexander.sverdlin@nokia.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 16bfad96c13d7faffdc8f7ce7976cdbffba19e54
Author: Stefan Wahren <stefan.wahren@i2se.com>
Date:   Wed Jul 18 08:31:45 2018 +0200

    net: qca_spi: Fix log level if probe fails
    
    [ Upstream commit 50973993260a6934f0a00da53d9b746cfbea89ab ]
    
    In cases the probing fails the log level of the messages should
    be an error.
    
    Signed-off-by: Stefan Wahren <stefan.wahren@i2se.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 08d8f98c1067ee92b482ac0892e9f070be4cd2d1
Author: Stefan Wahren <stefan.wahren@i2se.com>
Date:   Wed Jul 18 08:31:44 2018 +0200

    net: qca_spi: Make sure the QCA7000 reset is triggered
    
    [ Upstream commit 711c62dfa6bdb4326ca6c587f295ea5c4f7269de ]
    
    In case the SPI thread is not running, a simple reset of sync
    state won't fix the transmit timeout. We also need to wake up the kernel
    thread.
    
    Signed-off-by: Stefan Wahren <stefan.wahren@i2se.com>
    Fixes: ed7d42e24eff ("net: qca_spi: fix transmit queue timeout handling")
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 601e3173bc5bd0552dc60b2b2a6d3b39b9edc8ea
Author: Stefan Wahren <stefan.wahren@i2se.com>
Date:   Wed Jul 18 08:31:43 2018 +0200

    net: qca_spi: Avoid packet drop during initial sync
    
    [ Upstream commit b2bab426dc715de147f8039a3fccff27d795f4eb ]
    
    As long as the synchronization with the QCA7000 isn't finished, we
    cannot accept packets from the upper layers. So let the SPI thread
    enable the TX queue after sync and avoid unwanted packet drop.
    
    Signed-off-by: Stefan Wahren <stefan.wahren@i2se.com>
    Fixes: 291ab06ecf67 ("net: qualcomm: new Ethernet over SPI driver for QCA7000")
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 824dc11ed2c46ad97ccd80091a183e869529a758
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Wed Jul 18 15:41:11 2018 -0500

    PCI: v3-semi: Fix I/O space page leak
    
    [ Upstream commit 270ed733e68955049b693bea8f4a1efb293a96ae ]
    
    When testing the R-Car PCIe driver on the Condor board, if the PCIe PHY
    driver was left disabled, the kernel crashed with this BUG:
    
      kernel BUG at lib/ioremap.c:72!
      Internal error: Oops - BUG: 0 [#1] PREEMPT SMP
      Modules linked in:
      CPU: 0 PID: 39 Comm: kworker/0:1 Not tainted 4.17.0-dirty #1092
      Hardware name: Renesas Condor board based on r8a77980 (DT)
      Workqueue: events deferred_probe_work_func
      pstate: 80000005 (Nzcv daif -PAN -UAO)
      pc : ioremap_page_range+0x370/0x3c8
      lr : ioremap_page_range+0x40/0x3c8
      sp : ffff000008da39e0
      x29: ffff000008da39e0 x28: 00e8000000000f07
      x27: ffff7dfffee00000 x26: 0140000000000000
      x25: ffff7dfffef00000 x24: 00000000000fe100
      x23: ffff80007b906000 x22: ffff000008ab8000
      x21: ffff000008bb1d58 x20: ffff7dfffef00000
      x19: ffff800009c30fb8 x18: 0000000000000001
      x17: 00000000000152d0 x16: 00000000014012d0
      x15: 0000000000000000 x14: 0720072007200720
      x13: 0720072007200720 x12: 0720072007200720
      x11: 0720072007300730 x10: 00000000000000ae
      x9 : 0000000000000000 x8 : ffff7dffff000000
      x7 : 0000000000000000 x6 : 0000000000000100
      x5 : 0000000000000000 x4 : 000000007b906000
      x3 : ffff80007c61a880 x2 : ffff7dfffeefffff
      x1 : 0000000040000000 x0 : 00e80000fe100f07
      Process kworker/0:1 (pid: 39, stack limit = 0x        (ptrval))
      Call trace:
       ioremap_page_range+0x370/0x3c8
       pci_remap_iospace+0x7c/0xac
       pci_parse_request_of_pci_ranges+0x13c/0x190
       rcar_pcie_probe+0x4c/0xb04
       platform_drv_probe+0x50/0xbc
       driver_probe_device+0x21c/0x308
       __device_attach_driver+0x98/0xc8
       bus_for_each_drv+0x54/0x94
       __device_attach+0xc4/0x12c
       device_initial_probe+0x10/0x18
       bus_probe_device+0x90/0x98
       deferred_probe_work_func+0xb0/0x150
       process_one_work+0x12c/0x29c
       worker_thread+0x200/0x3fc
       kthread+0x108/0x134
       ret_from_fork+0x10/0x18
      Code: f9004ba2 54000080 aa0003fb 17ffff48 (d4210000)
    
    It turned out that pci_remap_iospace() wasn't undone when the driver's
    probe failed, and since devm_phy_optional_get() returned -EPROBE_DEFER,
    the probe was retried,  finally causing the BUG due to trying to remap
    already remapped pages.
    
    The V3 Semiconductor PCI driver has the same issue.
    Replace devm_pci_remap_iospace() with its devm_ managed version to fix
    the bug.
    
    Fixes: 68a15eb7bd0c ("PCI: v3-semi: Add V3 Semiconductor PCI host driver")
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    [lorenzo.pieralisi@arm.com: updated the commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6a1735ce60f04714b69ac0d4d218d93cc8870ad9
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Wed Jul 18 15:41:05 2018 -0500

    PCI: mediatek: Fix I/O space page leak
    
    [ Upstream commit 438477b9a089e45ea7c8fb549553e52833117ed8 ]
    
    When testing the R-Car PCIe driver on the Condor board, if the PCIe PHY
    driver was left disabled, the kernel crashed with this BUG:
    
      kernel BUG at lib/ioremap.c:72!
      Internal error: Oops - BUG: 0 [#1] PREEMPT SMP
      Modules linked in:
      CPU: 0 PID: 39 Comm: kworker/0:1 Not tainted 4.17.0-dirty #1092
      Hardware name: Renesas Condor board based on r8a77980 (DT)
      Workqueue: events deferred_probe_work_func
      pstate: 80000005 (Nzcv daif -PAN -UAO)
      pc : ioremap_page_range+0x370/0x3c8
      lr : ioremap_page_range+0x40/0x3c8
      sp : ffff000008da39e0
      x29: ffff000008da39e0 x28: 00e8000000000f07
      x27: ffff7dfffee00000 x26: 0140000000000000
      x25: ffff7dfffef00000 x24: 00000000000fe100
      x23: ffff80007b906000 x22: ffff000008ab8000
      x21: ffff000008bb1d58 x20: ffff7dfffef00000
      x19: ffff800009c30fb8 x18: 0000000000000001
      x17: 00000000000152d0 x16: 00000000014012d0
      x15: 0000000000000000 x14: 0720072007200720
      x13: 0720072007200720 x12: 0720072007200720
      x11: 0720072007300730 x10: 00000000000000ae
      x9 : 0000000000000000 x8 : ffff7dffff000000
      x7 : 0000000000000000 x6 : 0000000000000100
      x5 : 0000000000000000 x4 : 000000007b906000
      x3 : ffff80007c61a880 x2 : ffff7dfffeefffff
      x1 : 0000000040000000 x0 : 00e80000fe100f07
      Process kworker/0:1 (pid: 39, stack limit = 0x        (ptrval))
      Call trace:
       ioremap_page_range+0x370/0x3c8
       pci_remap_iospace+0x7c/0xac
       pci_parse_request_of_pci_ranges+0x13c/0x190
       rcar_pcie_probe+0x4c/0xb04
       platform_drv_probe+0x50/0xbc
       driver_probe_device+0x21c/0x308
       __device_attach_driver+0x98/0xc8
       bus_for_each_drv+0x54/0x94
       __device_attach+0xc4/0x12c
       device_initial_probe+0x10/0x18
       bus_probe_device+0x90/0x98
       deferred_probe_work_func+0xb0/0x150
       process_one_work+0x12c/0x29c
       worker_thread+0x200/0x3fc
       kthread+0x108/0x134
       ret_from_fork+0x10/0x18
      Code: f9004ba2 54000080 aa0003fb 17ffff48 (d4210000)
    
    It turned out that pci_remap_iospace() wasn't undone when the driver's
    probe failed, and since devm_phy_optional_get() returned -EPROBE_DEFER,
    the probe was retried, finally causing the BUG due to trying to remap
    already remapped pages.
    
    The MediaTek PCIe driver has the same issue.
    
    Replace devm_pci_remap_iospace() with its devm_ managed counterpart
    to fix the bug.
    
    Fixes: 637cfacae96f ("PCI: mediatek: Add MediaTek PCIe host controller support")
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    [lorenzo.pieralisi@arm.com: updated the commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6ab3f7e0dca0e125c158cdfc71fb8bc02fcbdb63
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Wed Jul 18 15:40:59 2018 -0500

    PCI: faraday: Fix I/O space page leak
    
    [ Upstream commit e30609454b39139a91faf631685f503b7ea3f27d ]
    
    When testing the R-Car PCIe driver on the Condor board, if
    the PCIe PHY driver was left disabled, the kernel crashed with this BUG:
    
      kernel BUG at lib/ioremap.c:72!
      Internal error: Oops - BUG: 0 [#1] PREEMPT SMP
      Modules linked in:
      CPU: 0 PID: 39 Comm: kworker/0:1 Not tainted 4.17.0-dirty #1092
      Hardware name: Renesas Condor board based on r8a77980 (DT)
      Workqueue: events deferred_probe_work_func
      pstate: 80000005 (Nzcv daif -PAN -UAO)
      pc : ioremap_page_range+0x370/0x3c8
      lr : ioremap_page_range+0x40/0x3c8
      sp : ffff000008da39e0
      x29: ffff000008da39e0 x28: 00e8000000000f07
      x27: ffff7dfffee00000 x26: 0140000000000000
      x25: ffff7dfffef00000 x24: 00000000000fe100
      x23: ffff80007b906000 x22: ffff000008ab8000
      x21: ffff000008bb1d58 x20: ffff7dfffef00000
      x19: ffff800009c30fb8 x18: 0000000000000001
      x17: 00000000000152d0 x16: 00000000014012d0
      x15: 0000000000000000 x14: 0720072007200720
      x13: 0720072007200720 x12: 0720072007200720
      x11: 0720072007300730 x10: 00000000000000ae
      x9 : 0000000000000000 x8 : ffff7dffff000000
      x7 : 0000000000000000 x6 : 0000000000000100
      x5 : 0000000000000000 x4 : 000000007b906000
      x3 : ffff80007c61a880 x2 : ffff7dfffeefffff
      x1 : 0000000040000000 x0 : 00e80000fe100f07
      Process kworker/0:1 (pid: 39, stack limit = 0x        (ptrval))
      Call trace:
       ioremap_page_range+0x370/0x3c8
       pci_remap_iospace+0x7c/0xac
       pci_parse_request_of_pci_ranges+0x13c/0x190
       rcar_pcie_probe+0x4c/0xb04
       platform_drv_probe+0x50/0xbc
       driver_probe_device+0x21c/0x308
       __device_attach_driver+0x98/0xc8
       bus_for_each_drv+0x54/0x94
       __device_attach+0xc4/0x12c
       device_initial_probe+0x10/0x18
       bus_probe_device+0x90/0x98
       deferred_probe_work_func+0xb0/0x150
       process_one_work+0x12c/0x29c
       worker_thread+0x200/0x3fc
       kthread+0x108/0x134
       ret_from_fork+0x10/0x18
      Code: f9004ba2 54000080 aa0003fb 17ffff48 (d4210000)
    
    It turned out that pci_remap_iospace() wasn't undone when the driver's
    probe failed, and since devm_phy_optional_get() returned -EPROBE_DEFER,
    the probe was retried, finally causing the BUG due to trying to remap
    already remapped pages.
    
    The Faraday PCI driver has the same issue. Replace pci_remap_iospace()
    with its devm_ managed version to fix the bug.
    
    Fixes: d3c68e0a7e34 ("PCI: faraday: Add Faraday Technology FTPCI100 PCI Host Bridge driver")
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    [lorenzo.pieralisi@arm.com: updated the commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 671db0d11b33d04c0a52d1882819d5ba82994951
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Wed Jul 18 15:40:53 2018 -0500

    PCI: aardvark: Fix I/O space page leak
    
    [ Upstream commit 1df3e5b3feebf29a3ecfa0c0f06f79544ca573e4 ]
    
    When testing the R-Car PCIe driver on the Condor board, if the PCIe PHY
    driver was left disabled, the kernel crashed with this BUG:
    
      kernel BUG at lib/ioremap.c:72!
      Internal error: Oops - BUG: 0 [#1] PREEMPT SMP
      Modules linked in:
      CPU: 0 PID: 39 Comm: kworker/0:1 Not tainted 4.17.0-dirty #1092
      Hardware name: Renesas Condor board based on r8a77980 (DT)
      Workqueue: events deferred_probe_work_func
      pstate: 80000005 (Nzcv daif -PAN -UAO)
      pc : ioremap_page_range+0x370/0x3c8
      lr : ioremap_page_range+0x40/0x3c8
      sp : ffff000008da39e0
      x29: ffff000008da39e0 x28: 00e8000000000f07
      x27: ffff7dfffee00000 x26: 0140000000000000
      x25: ffff7dfffef00000 x24: 00000000000fe100
      x23: ffff80007b906000 x22: ffff000008ab8000
      x21: ffff000008bb1d58 x20: ffff7dfffef00000
      x19: ffff800009c30fb8 x18: 0000000000000001
      x17: 00000000000152d0 x16: 00000000014012d0
      x15: 0000000000000000 x14: 0720072007200720
      x13: 0720072007200720 x12: 0720072007200720
      x11: 0720072007300730 x10: 00000000000000ae
      x9 : 0000000000000000 x8 : ffff7dffff000000
      x7 : 0000000000000000 x6 : 0000000000000100
      x5 : 0000000000000000 x4 : 000000007b906000
      x3 : ffff80007c61a880 x2 : ffff7dfffeefffff
      x1 : 0000000040000000 x0 : 00e80000fe100f07
      Process kworker/0:1 (pid: 39, stack limit = 0x        (ptrval))
      Call trace:
       ioremap_page_range+0x370/0x3c8
       pci_remap_iospace+0x7c/0xac
       pci_parse_request_of_pci_ranges+0x13c/0x190
       rcar_pcie_probe+0x4c/0xb04
       platform_drv_probe+0x50/0xbc
       driver_probe_device+0x21c/0x308
       __device_attach_driver+0x98/0xc8
       bus_for_each_drv+0x54/0x94
       __device_attach+0xc4/0x12c
       device_initial_probe+0x10/0x18
       bus_probe_device+0x90/0x98
       deferred_probe_work_func+0xb0/0x150
       process_one_work+0x12c/0x29c
       worker_thread+0x200/0x3fc
       kthread+0x108/0x134
       ret_from_fork+0x10/0x18
      Code: f9004ba2 54000080 aa0003fb 17ffff48 (d4210000)
    
    It turned out that pci_remap_iospace() wasn't undone when the driver's
    probe failed, and since devm_phy_optional_get() returned -EPROBE_DEFER,
    the probe was retried, finally causing the BUG due to trying to remap
    already remapped pages.
    
    The Aardvark PCI controller driver has the same issue.
    Replace pci_remap_iospace() with its devm_ managed version to fix the bug.
    
    Fixes: 8c39d710363c ("PCI: aardvark: Add Aardvark PCI host controller driver")
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    [lorenzo.pieralisi@arm.com: updated the commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Reviewed-by: Thomas Petazzoni <thomas.petazzoni@bootlin.com>
    Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a818d84ffe08ad7657c28166980050691ea4a857
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Wed Jul 18 15:40:46 2018 -0500

    PCI: designware: Fix I/O space page leak
    
    [ Upstream commit fd07f5e19c6fcdfa318944764248cf44eb06e532 ]
    
    When testing the R-Car PCIe driver on the Condor board, if the PCIe PHY
    driver is left disabled, the kernel crashed with this BUG:
    
      kernel BUG at lib/ioremap.c:72!
      Internal error: Oops - BUG: 0 [#1] PREEMPT SMP
      Modules linked in:
      CPU: 0 PID: 39 Comm: kworker/0:1 Not tainted 4.17.0-dirty #1092
      Hardware name: Renesas Condor board based on r8a77980 (DT)
      Workqueue: events deferred_probe_work_func
      pstate: 80000005 (Nzcv daif -PAN -UAO)
      pc : ioremap_page_range+0x370/0x3c8
      lr : ioremap_page_range+0x40/0x3c8
      sp : ffff000008da39e0
      x29: ffff000008da39e0 x28: 00e8000000000f07
      x27: ffff7dfffee00000 x26: 0140000000000000
      x25: ffff7dfffef00000 x24: 00000000000fe100
      x23: ffff80007b906000 x22: ffff000008ab8000
      x21: ffff000008bb1d58 x20: ffff7dfffef00000
      x19: ffff800009c30fb8 x18: 0000000000000001
      x17: 00000000000152d0 x16: 00000000014012d0
      x15: 0000000000000000 x14: 0720072007200720
      x13: 0720072007200720 x12: 0720072007200720
      x11: 0720072007300730 x10: 00000000000000ae
      x9 : 0000000000000000 x8 : ffff7dffff000000
      x7 : 0000000000000000 x6 : 0000000000000100
      x5 : 0000000000000000 x4 : 000000007b906000
      x3 : ffff80007c61a880 x2 : ffff7dfffeefffff
      x1 : 0000000040000000 x0 : 00e80000fe100f07
      Process kworker/0:1 (pid: 39, stack limit = 0x        (ptrval))
      Call trace:
       ioremap_page_range+0x370/0x3c8
       pci_remap_iospace+0x7c/0xac
       pci_parse_request_of_pci_ranges+0x13c/0x190
       rcar_pcie_probe+0x4c/0xb04
       platform_drv_probe+0x50/0xbc
       driver_probe_device+0x21c/0x308
       __device_attach_driver+0x98/0xc8
       bus_for_each_drv+0x54/0x94
       __device_attach+0xc4/0x12c
       device_initial_probe+0x10/0x18
       bus_probe_device+0x90/0x98
       deferred_probe_work_func+0xb0/0x150
       process_one_work+0x12c/0x29c
       worker_thread+0x200/0x3fc
       kthread+0x108/0x134
       ret_from_fork+0x10/0x18
      Code: f9004ba2 54000080 aa0003fb 17ffff48 (d4210000)
    
    It turned out that pci_remap_iospace() wasn't undone when the driver's
    probe failed, and since devm_phy_optional_get() returned -EPROBE_DEFER,
    the probe was retried, finally causing the BUG due to trying to remap
    already remapped pages.
    
    The DesignWare PCIe controller driver has the same issue.
    
    Replace devm_pci_remap_iospace() with a devm_ managed version to fix the
    bug.
    
    Fixes: cbce7900598c ("PCI: designware: Make driver arch-agnostic")
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    [lorenzo.pieralisi@arm.com: updated the commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
    Acked-by: Jingoo Han <jingoohan1@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 64c4ad1e06d03b21c203cc646ebc3192a6585aef
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Wed Jul 18 15:40:40 2018 -0500

    PCI: versatile: Fix I/O space page leak
    
    [ Upstream commit 0018b265adf7e251f90d3ca1c7c0e32e2a0ad262 ]
    
    When testing the R-Car PCIe driver on the Condor board, if the PCIe PHY
    driver was left disabled, the kernel crashed with this BUG:
    
      kernel BUG at lib/ioremap.c:72!
      Internal error: Oops - BUG: 0 [#1] PREEMPT SMP
      Modules linked in:
      CPU: 0 PID: 39 Comm: kworker/0:1 Not tainted 4.17.0-dirty #1092
      Hardware name: Renesas Condor board based on r8a77980 (DT)
      Workqueue: events deferred_probe_work_func
      pstate: 80000005 (Nzcv daif -PAN -UAO)
      pc : ioremap_page_range+0x370/0x3c8
      lr : ioremap_page_range+0x40/0x3c8
      sp : ffff000008da39e0
      x29: ffff000008da39e0 x28: 00e8000000000f07
      x27: ffff7dfffee00000 x26: 0140000000000000
      x25: ffff7dfffef00000 x24: 00000000000fe100
      x23: ffff80007b906000 x22: ffff000008ab8000
      x21: ffff000008bb1d58 x20: ffff7dfffef00000
      x19: ffff800009c30fb8 x18: 0000000000000001
      x17: 00000000000152d0 x16: 00000000014012d0
      x15: 0000000000000000 x14: 0720072007200720
      x13: 0720072007200720 x12: 0720072007200720
      x11: 0720072007300730 x10: 00000000000000ae
      x9 : 0000000000000000 x8 : ffff7dffff000000
      x7 : 0000000000000000 x6 : 0000000000000100
      x5 : 0000000000000000 x4 : 000000007b906000
      x3 : ffff80007c61a880 x2 : ffff7dfffeefffff
      x1 : 0000000040000000 x0 : 00e80000fe100f07
      Process kworker/0:1 (pid: 39, stack limit = 0x        (ptrval))
      Call trace:
       ioremap_page_range+0x370/0x3c8
       pci_remap_iospace+0x7c/0xac
       pci_parse_request_of_pci_ranges+0x13c/0x190
       rcar_pcie_probe+0x4c/0xb04
       platform_drv_probe+0x50/0xbc
       driver_probe_device+0x21c/0x308
       __device_attach_driver+0x98/0xc8
       bus_for_each_drv+0x54/0x94
       __device_attach+0xc4/0x12c
       device_initial_probe+0x10/0x18
       bus_probe_device+0x90/0x98
       deferred_probe_work_func+0xb0/0x150
       process_one_work+0x12c/0x29c
       worker_thread+0x200/0x3fc
       kthread+0x108/0x134
       ret_from_fork+0x10/0x18
      Code: f9004ba2 54000080 aa0003fb 17ffff48 (d4210000)
    
    It turned out that pci_remap_iospace() wasn't undone when the driver's
    probe failed, and since devm_phy_optional_get() returned -EPROBE_DEFER,
    the probe was retried, finally causing the BUG due to trying to remap
    already remapped pages.
    
    The Versatile PCI controller driver has the same issue.
    Replace pci_remap_iospace() with the devm_ managed version to fix the bug.
    
    Fixes: b7e78170efd4 ("PCI: versatile: Add DT-based ARM Versatile PB PCIe host driver")
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    [lorenzo.pieralisi@arm.com: updated the commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b1b2c5dc964e05039862eab7cfd53441d87069ac
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Wed Jul 18 15:40:34 2018 -0500

    PCI: xgene: Fix I/O space page leak
    
    [ Upstream commit 925652d03589084850023d8924b376b7ee3c1b1b ]
    
    When testing the R-Car PCIe driver on the Condor board, if the PCIe PHY
    driver was left disabled, the kernel crashed with this BUG:
    
      kernel BUG at lib/ioremap.c:72!
      Internal error: Oops - BUG: 0 [#1] PREEMPT SMP
      Modules linked in:
      CPU: 0 PID: 39 Comm: kworker/0:1 Not tainted 4.17.0-dirty #1092
      Hardware name: Renesas Condor board based on r8a77980 (DT)
      Workqueue: events deferred_probe_work_func
      pstate: 80000005 (Nzcv daif -PAN -UAO)
      pc : ioremap_page_range+0x370/0x3c8
      lr : ioremap_page_range+0x40/0x3c8
      sp : ffff000008da39e0
      x29: ffff000008da39e0 x28: 00e8000000000f07
      x27: ffff7dfffee00000 x26: 0140000000000000
      x25: ffff7dfffef00000 x24: 00000000000fe100
      x23: ffff80007b906000 x22: ffff000008ab8000
      x21: ffff000008bb1d58 x20: ffff7dfffef00000
      x19: ffff800009c30fb8 x18: 0000000000000001
      x17: 00000000000152d0 x16: 00000000014012d0
      x15: 0000000000000000 x14: 0720072007200720
      x13: 0720072007200720 x12: 0720072007200720
      x11: 0720072007300730 x10: 00000000000000ae
      x9 : 0000000000000000 x8 : ffff7dffff000000
      x7 : 0000000000000000 x6 : 0000000000000100
      x5 : 0000000000000000 x4 : 000000007b906000
      x3 : ffff80007c61a880 x2 : ffff7dfffeefffff
      x1 : 0000000040000000 x0 : 00e80000fe100f07
      Process kworker/0:1 (pid: 39, stack limit = 0x        (ptrval))
      Call trace:
       ioremap_page_range+0x370/0x3c8
       pci_remap_iospace+0x7c/0xac
       pci_parse_request_of_pci_ranges+0x13c/0x190
       rcar_pcie_probe+0x4c/0xb04
       platform_drv_probe+0x50/0xbc
       driver_probe_device+0x21c/0x308
       __device_attach_driver+0x98/0xc8
       bus_for_each_drv+0x54/0x94
       __device_attach+0xc4/0x12c
       device_initial_probe+0x10/0x18
       bus_probe_device+0x90/0x98
       deferred_probe_work_func+0xb0/0x150
       process_one_work+0x12c/0x29c
       worker_thread+0x200/0x3fc
       kthread+0x108/0x134
       ret_from_fork+0x10/0x18
      Code: f9004ba2 54000080 aa0003fb 17ffff48 (d4210000)
    
    It turned out that pci_remap_iospace() wasn't undone when the driver's
    probe failed, and since devm_phy_optional_get() returned -EPROBE_DEFER,
    the probe was retried, finally causing the BUG due to trying to remap
    already remapped pages.
    
    The X-Gene PCI controller driver has the same issue.
    Replace pci_remap_iospace() with the devm_ managed version so that the
    pages get unmapped automagically on any probe failure.
    
    Fixes: 5f6b6ccdbe1c ("PCI: xgene: Add APM X-Gene PCIe driver")
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    [lorenzo.pieralisi@arm.com: updated the commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 607fef725d78f876ccc3d0869ca9883364d43ba7
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Wed Jul 18 15:40:26 2018 -0500

    PCI: OF: Fix I/O space page leak
    
    [ Upstream commit a5fb9fb023a1435f2b42bccd7f547560f3a21dc3 ]
    
    When testing the R-Car PCIe driver on the Condor board, if the PCIe PHY
    driver was left disabled, the kernel crashed with this BUG:
    
      kernel BUG at lib/ioremap.c:72!
      Internal error: Oops - BUG: 0 [#1] PREEMPT SMP
      Modules linked in:
      CPU: 0 PID: 39 Comm: kworker/0:1 Not tainted 4.17.0-dirty #1092
      Hardware name: Renesas Condor board based on r8a77980 (DT)
      Workqueue: events deferred_probe_work_func
      pstate: 80000005 (Nzcv daif -PAN -UAO)
      pc : ioremap_page_range+0x370/0x3c8
      lr : ioremap_page_range+0x40/0x3c8
      sp : ffff000008da39e0
      x29: ffff000008da39e0 x28: 00e8000000000f07
      x27: ffff7dfffee00000 x26: 0140000000000000
      x25: ffff7dfffef00000 x24: 00000000000fe100
      x23: ffff80007b906000 x22: ffff000008ab8000
      x21: ffff000008bb1d58 x20: ffff7dfffef00000
      x19: ffff800009c30fb8 x18: 0000000000000001
      x17: 00000000000152d0 x16: 00000000014012d0
      x15: 0000000000000000 x14: 0720072007200720
      x13: 0720072007200720 x12: 0720072007200720
      x11: 0720072007300730 x10: 00000000000000ae
      x9 : 0000000000000000 x8 : ffff7dffff000000
      x7 : 0000000000000000 x6 : 0000000000000100
      x5 : 0000000000000000 x4 : 000000007b906000
      x3 : ffff80007c61a880 x2 : ffff7dfffeefffff
      x1 : 0000000040000000 x0 : 00e80000fe100f07
      Process kworker/0:1 (pid: 39, stack limit = 0x        (ptrval))
      Call trace:
       ioremap_page_range+0x370/0x3c8
       pci_remap_iospace+0x7c/0xac
       pci_parse_request_of_pci_ranges+0x13c/0x190
       rcar_pcie_probe+0x4c/0xb04
       platform_drv_probe+0x50/0xbc
       driver_probe_device+0x21c/0x308
       __device_attach_driver+0x98/0xc8
       bus_for_each_drv+0x54/0x94
       __device_attach+0xc4/0x12c
       device_initial_probe+0x10/0x18
       bus_probe_device+0x90/0x98
       deferred_probe_work_func+0xb0/0x150
       process_one_work+0x12c/0x29c
       worker_thread+0x200/0x3fc
       kthread+0x108/0x134
       ret_from_fork+0x10/0x18
      Code: f9004ba2 54000080 aa0003fb 17ffff48 (d4210000)
    
    It turned out that pci_remap_iospace() wasn't undone when the driver's
    probe failed, and since devm_phy_optional_get() returned -EPROBE_DEFER,
    the probe was retried, finally causing the BUG due to trying to remap
    already remapped pages.
    
    Introduce the devm_pci_remap_iospace() managed API and replace the
    pci_remap_iospace() call with it to fix the bug.
    
    Fixes: dbf9826d5797 ("PCI: generic: Convert to DT resource parsing API")
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    [lorenzo.pieralisi@arm.com: split commit/updated the commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6445942b559981bf12607990c396b071979f73ca
Author: Karsten Graul <kgraul@linux.ibm.com>
Date:   Wed Jul 18 15:22:51 2018 +0200

    net/smc: reset recv timeout after clc handshake
    
    [ Upstream commit f6bdc42f021194ec095914b92c7a8b1a09789e6d ]
    
    During clc handshake the receive timeout is set to CLC_WAIT_TIME.
    Remember and reset the original timeout value after the receive calls,
    and remove a duplicate assignment of CLC_WAIT_TIME.
    
    Signed-off-by: Karsten Graul <kgraul@linux.ibm.com>
    Signed-off-by: Ursula Braun <ubraun@linux.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1ba4f24d19bd636537859226086c63ec73a50a6c
Author: Peng Hao <peng.hao2@zte.com.cn>
Date:   Sat Jul 14 23:28:29 2018 +0800

    kvmclock: fix TSC calibration for nested guests
    
    [ Upstream commit e10f7805032365cc11c739a97f226ebb48aee042 ]
    
    Inside a nested guest, access to hardware can be slow enough that
    tsc_read_refs always return ULLONG_MAX, causing tsc_refine_calibration_work
    to be called periodically and the nested guest to spend a lot of time
    reading the ACPI timer.
    
    However, if the TSC frequency is available from the pvclock page,
    we can just set X86_FEATURE_TSC_KNOWN_FREQ and avoid the recalibration.
    'refine' operation.
    
    Suggested-by: Peter Zijlstra <peterz@infradead.org>
    Signed-off-by: Peng Hao <peng.hao2@zte.com.cn>
    [Commit message rewritten. - Paolo]
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 80e3c217d1ba398f204a6e84d7be3a2ec066b696
Author: David Lechner <david@lechnology.com>
Date:   Mon Jul 16 17:58:10 2018 -0500

    net: usb: rtl8150: demote allmulti message to dev_dbg()
    
    [ Upstream commit 3a9b0455062ffb9d2f6cd4473a76e3456f318c9f ]
    
    This driver can spam the kernel log with multiple messages of:
    
        net eth0: eth0: allmulti set
    
    Usually 4 or 8 at a time (probably because of using ConnMan).
    
    This message doesn't seem useful, so let's demote it from dev_info()
    to dev_dbg().
    
    Signed-off-by: David Lechner <david@lechnology.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1c69d879696094a90b8b6e6a34faadfedcbd6ab7
Author: Alexander Sverdlin <alexander.sverdlin@nsn.com>
Date:   Fri Jul 13 17:31:50 2018 +0200

    octeon_mgmt: Fix MIX registers configuration on MTU setup
    
    [ Upstream commit 4aac0b43474d18f6160302a3caa147d77fa3baa1 ]
    
    octeon_mgmt driver doesn't drop RX frames that are 1-4 bytes bigger than
    MTU set for the corresponding interface. The problem is in the
    AGL_GMX_RX0/1_FRM_MAX register setting, which should not account for VLAN
    tagging.
    
    According to Octeon HW manual:
    "For tagged frames, MAX increases by four bytes for each VLAN found up to a
    maximum of two VLANs, or MAX + 8 bytes."
    
    OCTEON_FRAME_HEADER_LEN "define" is fine for ring buffer management, but
    should not be used for AGL_GMX_RX0/1_FRM_MAX.
    
    The problem could be easily reproduced using "ping" command. If affected
    system has default MTU 1500, other host (having MTU >= 1504) can
    successfully "ping" the affected system with payload size 1473-1476,
    resulting in IP packets of size 1501-1504 accepted by the mgmt driver.
    Fixed system still accepts IP packets of 1500 bytes even with VLAN tagging,
    because the limits are lifted in HW as expected, for every VLAN tag.
    
    Signed-off-by: Alexander Sverdlin <alexander.sverdlin@nokia.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3b4f6a219c582bf950e62cfd7cefe61c87393aa3
Author: Scott Bauer <scott.bauer@intel.com>
Date:   Fri Jun 29 13:03:28 2018 -0600

    nvme: ensure forward progress during Admin passthru
    
    [ Upstream commit cf39a6bc342b980f10f344d88035829638a89a48 ]
    
    If the controller supports effects and goes down during the passthru admin
    command we will deadlock during namespace revalidation.
    
    [  363.488275] INFO: task kworker/u16:5:231 blocked for more than 120 seconds.
    [  363.488290]       Not tainted 4.17.0+ #2
    [  363.488296] "echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
    [  363.488303] kworker/u16:5   D    0   231      2 0x80000000
    [  363.488331] Workqueue: nvme-reset-wq nvme_reset_work [nvme]
    [  363.488338] Call Trace:
    [  363.488385]  schedule+0x75/0x190
    [  363.488396]  rwsem_down_read_failed+0x1c3/0x2f0
    [  363.488481]  call_rwsem_down_read_failed+0x14/0x30
    [  363.488504]  down_read+0x1d/0x80
    [  363.488523]  nvme_stop_queues+0x1e/0xa0 [nvme_core]
    [  363.488536]  nvme_dev_disable+0xae4/0x1620 [nvme]
    [  363.488614]  nvme_reset_work+0xd1e/0x49d9 [nvme]
    [  363.488911]  process_one_work+0x81a/0x1400
    [  363.488934]  worker_thread+0x87/0xe80
    [  363.488955]  kthread+0x2db/0x390
    [  363.488977]  ret_from_fork+0x35/0x40
    
    Fixes: 84fef62d135b6 ("nvme: check admin passthru command effects")
    Signed-off-by: Scott Bauer <scott.bauer@intel.com>
    Reviewed-by: Keith Busch <keith.busch@linux.intel.com>
    Signed-off-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 67a97632c674ef499d0067964f13fe2cf1005668
Author: Qu Wenruo <wqu@suse.com>
Date:   Wed Jul 11 13:41:21 2018 +0800

    btrfs: scrub: Don't use inode page cache in scrub_handle_errored_block()
    
    [ Upstream commit 665d4953cde6d9e75c62a07ec8f4f8fd7d396ade ]
    
    In commit ac0b4145d662 ("btrfs: scrub: Don't use inode pages for device
    replace") we removed the branch of copy_nocow_pages() to avoid
    corruption for compressed nodatasum extents.
    
    However above commit only solves the problem in scrub_extent(), if
    during scrub_pages() we failed to read some pages,
    sctx->no_io_error_seen will be non-zero and we go to fixup function
    scrub_handle_errored_block().
    
    In scrub_handle_errored_block(), for sctx without csum (no matter if
    we're doing replace or scrub) we go to scrub_fixup_nodatasum() routine,
    which does the similar thing with copy_nocow_pages(), but does it
    without the extra check in copy_nocow_pages() routine.
    
    So for test cases like btrfs/100, where we emulate read errors during
    replace/scrub, we could corrupt compressed extent data again.
    
    This patch will fix it just by avoiding any "optimization" for
    nodatasum, just falls back to the normal fixup routine by try read from
    any good copy.
    
    This also solves WARN_ON() or dead lock caused by lame backref iteration
    in scrub_fixup_nodatasum() routine.
    
    The deadlock or WARN_ON() won't be triggered before commit ac0b4145d662
    ("btrfs: scrub: Don't use inode pages for device replace") since
    copy_nocow_pages() have better locking and extra check for data extent,
    and it's already doing the fixup work by try to read data from any good
    copy, so it won't go scrub_fixup_nodatasum() anyway.
    
    This patch disables the faulty code and will be removed completely in a
    followup patch.
    
    Fixes: ac0b4145d662 ("btrfs: scrub: Don't use inode pages for device replace")
    Signed-off-by: Qu Wenruo <wqu@suse.com>
    Signed-off-by: David Sterba <dsterba@suse.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 248e87dfb8e9a30cf049087fea999fa0d3ca0f20
Author: Pavel Machek <pavel@ucw.cz>
Date:   Mon Jul 16 09:10:48 2018 +0200

    ARM: dts: omap4-droid4: fix dts w.r.t. pwm
    
    [ Upstream commit d3f6daede246038cf2ea38b78d732f9dd8feb1d6 ]
    
    pwm node should not be under gpio6 node in the device tree.
    
    This fixes detection of the pwm on Droid 4.
    
    Fixes: 6d7bdd328da4 ("ARM: dts: omap4-droid4: update touchscreen")
    Signed-off-by: Pavel Machek <pavel@ucw.cz>
    Reviewed-by: Sebastian Reichel <sebastian.reichel@collabora.co.uk>
    [tony@atomide.com: added fixes tag]
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 74c5905e1503f6be7bcac53a2a625cb752ad827c
Author: John Allen <jallen@linux.ibm.com>
Date:   Mon Jul 16 10:29:30 2018 -0500

    ibmvnic: Fix error recovery on login failure
    
    [ Upstream commit 3578a7ecb69920efc3885dbd610e98c00dbdf5db ]
    
    Testing has uncovered a failure case that is not handled properly. In the
    event that a login fails and we are not able to recover on the spot, we
    return 0 from do_reset, preventing any error recovery code from being
    triggered.  Additionally, the state is set to "probed" meaning that when we
    are able to trigger the error recovery, the driver always comes up in the
    probed state. To handle the case properly, we need to return a failure code
    here and set the adapter state to the state that we entered the reset in
    indicating the state that we would like to come out of the recovery reset
    in.
    
    Signed-off-by: John Allen <jallen@linux.vnet.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1f4a89d21562ecc933763ad81b82526d2813bdfe
Author: Randy Dunlap <rdunlap@infradead.org>
Date:   Fri Jul 13 21:25:19 2018 -0700

    net/ethernet/freescale/fman: fix cross-build error
    
    [ Upstream commit c133459765fae249ba482f62e12f987aec4376f0 ]
    
      CC [M]  drivers/net/ethernet/freescale/fman/fman.o
    In file included from ../drivers/net/ethernet/freescale/fman/fman.c:35:
    ../include/linux/fsl/guts.h: In function 'guts_set_dmacr':
    ../include/linux/fsl/guts.h:165:2: error: implicit declaration of function 'clrsetbits_be32' [-Werror=implicit-function-declaration]
      clrsetbits_be32(&guts->dmacr, 3 << shift, device << shift);
      ^~~~~~~~~~~~~~~
    
    Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
    Cc: Madalin Bucur <madalin.bucur@nxp.com>
    Cc: netdev@vger.kernel.org
    Cc: linuxppc-dev@lists.ozlabs.org
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit eea4f8ffbc1799ebdee7f3634740ab515b77ea43
Author: Stephen Hemminger <stephen@networkplumber.org>
Date:   Fri Jul 13 10:38:38 2018 -0700

    hv/netvsc: fix handling of fallback to single queue mode
    
    [ Upstream commit 916c5e1413be058d1c1f6e502db350df890730ce ]
    
    The netvsc device may need to fallback to running in single queue
    mode if host side only wants to support single queue.
    
    Recent change for handling mtu broke this in setup logic.
    
    Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
    Fixes: 3ffe64f1a641 ("hv_netvsc: split sub-channel setup into async and sync")
    Signed-off-by: Stephen Hemminger <sthemmin@microsoft.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 26611d0bb2cdd7d7d039439c4e33cfde2729116e
Author: Thomas Falcon <tlfalcon@linux.vnet.ibm.com>
Date:   Fri Jul 13 12:03:32 2018 -0500

    ibmvnic: Revise RX/TX queue error messages
    
    [ Upstream commit 2d14d3795294d42aacc278948984a480569bcc23 ]
    
    During a device failover, there may be latency between the loss
    of the current backing device and a notification from firmware that
    a failover has occurred. This latency can result in a large amount of
    error printouts as firmware returns outgoing traffic with a generic
    error code. These are not necessarily errors in this case as the
    firmware is busy swapping in a new backing adapter and is not ready
    to send packets yet. This patch reclassifies those error codes as
    warnings with an explanation that a failover may be pending. All
    other return codes will be considered errors.
    
    Signed-off-by: Thomas Falcon <tlfalcon@linux.vnet.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c62357ffc469ffec3a9363493a24196c539390c4
Author: Frank Rowand <frank.rowand@sony.com>
Date:   Thu Jul 12 14:00:07 2018 -0700

    of: overlay: update phandle cache on overlay apply and remove
    
    [ Upstream commit b9952b5218added5577e4a3443969bc20884cea9 ]
    
    A comment in the review of the patch adding the phandle cache said that
    the cache would have to be updated when modules are applied and removed.
    This patch implements the cache updates.
    
    Fixes: 0b3ce78e90fc ("of: cache phandle nodes to reduce cost of of_find_node_by_phandle()")
    Reported-by: Alan Tull <atull@kernel.org>
    Suggested-by: Alan Tull <atull@kernel.org>
    Signed-off-by: Frank Rowand <frank.rowand@sony.com>
    Signed-off-by: Rob Herring <robh@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 926fb5fe74d20370657c446f0fccb9b6bc7ea49c
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Tue Jul 3 15:30:56 2018 +0300

    drm/nouveau/gem: off by one bugs in nouveau_gem_pushbuf_reloc_apply()
    
    [ Upstream commit 7f073d011f93e92d4d225526b9ab6b8b0bbd6613 ]
    
    The bo array has req->nr_buffers elements so the > should be >= so we
    don't read beyond the end of the array.
    
    Fixes: a1606a9596e5 ("drm/nouveau: new gem pushbuf interface, bump to 0.0.16")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 92ab8ea99f2b962b0458de85dd647d3eeb1f272d
Author: Juri Lelli <juri.lelli@redhat.com>
Date:   Wed Jul 11 09:29:48 2018 +0200

    sched/deadline: Fix switched_from_dl() warning
    
    [ Upstream commit e117cb52bdb4d376b711bee34af6434c9e314b3b ]
    
    Mark noticed that syzkaller is able to reliably trigger the following warning:
    
      dl_rq->running_bw > dl_rq->this_bw
      WARNING: CPU: 1 PID: 153 at kernel/sched/deadline.c:124 switched_from_dl+0x454/0x608
      Kernel panic - not syncing: panic_on_warn set ...
    
      CPU: 1 PID: 153 Comm: syz-executor253 Not tainted 4.18.0-rc3+ #29
      Hardware name: linux,dummy-virt (DT)
      Call trace:
       dump_backtrace+0x0/0x458
       show_stack+0x20/0x30
       dump_stack+0x180/0x250
       panic+0x2dc/0x4ec
       __warn_printk+0x0/0x150
       report_bug+0x228/0x2d8
       bug_handler+0xa0/0x1a0
       brk_handler+0x2f0/0x568
       do_debug_exception+0x1bc/0x5d0
       el1_dbg+0x18/0x78
       switched_from_dl+0x454/0x608
       __sched_setscheduler+0x8cc/0x2018
       sys_sched_setattr+0x340/0x758
       el0_svc_naked+0x30/0x34
    
    syzkaller reproducer runs a bunch of threads that constantly switch
    between DEADLINE and NORMAL classes while interacting through futexes.
    
    The splat above is caused by the fact that if a DEADLINE task is setattr
    back to NORMAL while in non_contending state (blocked on a futex -
    inactive timer armed), its contribution to running_bw is not removed
    before sub_rq_bw() gets called (!task_on_rq_queued() branch) and the
    latter sees running_bw > this_bw.
    
    Fix it by removing a task contribution from running_bw if the task is
    not queued and in non_contending state while switched to a different
    class.
    
    Reported-by: Mark Rutland <mark.rutland@arm.com>
    Signed-off-by: Juri Lelli <juri.lelli@redhat.com>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Reviewed-by: Daniel Bristot de Oliveira <bristot@redhat.com>
    Reviewed-by: Luca Abeni <luca.abeni@santannapisa.it>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: claudio@evidence.eu.com
    Cc: rostedt@goodmis.org
    Link: http://lkml.kernel.org/r/20180711072948.27061-1-juri.lelli@redhat.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 969ef156934739565a725249d7eda79846fe53da
Author: Jim Mattson <jmattson@google.com>
Date:   Wed May 30 16:00:02 2018 -0700

    kvm: nVMX: Restore exit qual for VM-entry failure due to MSR loading
    
    [ Upstream commit 0b88abdc3f964c28ec03bc69eb17cb6b3b034564 ]
    
    This exit qualification was inadvertently dropped when the two
    VM-entry failure blocks were coalesced.
    
    Fixes: e79f245ddec1 ("X86/KVM: Properly update 'tsc_offset' to represent the running guest")
    Signed-off-by: Jim Mattson <jmattson@google.com>
    Reviewed-by: Krish Sadhukhan <krish.sadhukhan@oracle.com>
    Reviewed-by: David Hildenbrand <david@redhat.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 41b5285e24173c0d20aab129111acccff9dbcb9f
Author: piaojun <piaojun@huawei.com>
Date:   Fri Jul 13 16:59:06 2018 -0700

    net/9p/client.c: put refcount of trans_mod in error case in parse_opts()
    
    [ Upstream commit c290fba8c4ce6530cd941ea14db5a4ac2f77183f ]
    
    In my testing, the second mount will fail after umounting successfully.
    The reason is that we put refcount of trans_mod in the correct case
    rather than the error case in parse_opts() at last.  That will cause the
    refcount decrease to -1, and when we try to get trans_mod again in
    try_module_get(), we could only increase refcount to 0 which will cause
    failure as follows:
    
    parse_opts
      v9fs_get_trans_by_name
        try_module_get : return NULL to caller which cause error
    
    So we should put refcount of trans_mod in error case.
    
    Link: http://lkml.kernel.org/r/5B3F39A0.2030509@huawei.com
    Fixes: 9421c3e64137ec ("net/9p/client.c: fix potential refcnt problem of trans module")
    Signed-off-by: Jun Piao <piaojun@huawei.com>
    Reviewed-by: Yiwen Jiang <jiangyiwen@huawei.com>
    Reviewed-by: Greg Kurz <groug@kaod.org>
    Reviewed-by: Dominique Martinet <dominique.martinet@cea.fr>
    Tested-by: Dominique Martinet <dominique.martinet@cea.fr>
    Cc: Eric Van Hensbergen <ericvh@gmail.com>
    Cc: Ron Minnich <rminnich@sandia.gov>
    Cc: Latchesar Ionkov <lucho@ionkov.net>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4a6a2cba9276854f985d977fea149051d2e9ab4b
Author: Wei Yongjun <weiyongjun1@huawei.com>
Date:   Wed Jul 11 12:34:21 2018 +0000

    pinctrl: nsp: Fix potential NULL dereference
    
    [ Upstream commit c29e9da56bebb4c2c794e871b0dc0298bbf08142 ]
    
    platform_get_resource() may fail and return NULL, so we should
    better check it's return value to avoid a NULL pointer dereference
    a bit later in the code.
    
    This is detected by Coccinelle semantic patch.
    
    @@
    expression pdev, res, n, t, e, e1, e2;
    @@
    
    res = platform_get_resource(pdev, t, n);
    + if (!res)
    +   return -EINVAL;
    ... when != res == NULL
    e = devm_ioremap_nocache(e1, res->start, e2);
    
    Fixes: cc4fa83f66e9 ("pinctrl: nsp: add pinmux driver support for Broadcom NSP SoC")
    Signed-off-by: Wei Yongjun <weiyongjun1@huawei.com>
    Reviewed-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cab422d563379e541f5dced2c9c7660a4d033b50
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Tue Jul 3 15:04:25 2018 +0300

    pinctrl: nsp: off by ones in nsp_pinmux_enable()
    
    [ Upstream commit f90a21c898db58eaea14b8ad7e9af3b9e15e5f8a ]
    
    The > comparisons should be >= or else we read beyond the end of the
    pinctrl->functions[] array.
    
    Fixes: cc4fa83f66e9 ("pinctrl: nsp: add pinmux driver support for Broadcom NSP SoC")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Reviewed-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 593bf2c988d022243ff4bf946d0ff62d6eb8137c
Author: Paul Cercueil <paul@crapouillou.net>
Date:   Wed Jun 27 13:49:02 2018 +0200

    pinctrl: ingenic: Fix inverted direction for < JZ4770
    
    [ Upstream commit 0084a786ca8c84b443f67c4a697b4f2552761650 ]
    
    The .gpio_set_direction() callback was setting inverted direction
    for SoCs older than the JZ4770, this restores the correct behaviour.
    
    Signed-off-by: Paul Cercueil <paul@crapouillou.net>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 04f5fcc50d6abda9ab09690100ff9d1bd17b6c20
Author: Yuchung Cheng <ycheng@google.com>
Date:   Thu Jul 12 06:04:53 2018 -0700

    tcp: remove DELAYED ACK events in DCTCP
    
    [ Upstream commit a69258f7aa2623e0930212f09c586fd06674ad79 ]
    
    After fixing the way DCTCP tracking delayed ACKs, the delayed-ACK
    related callbacks are no longer needed
    
    Signed-off-by: Yuchung Cheng <ycheng@google.com>
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Acked-by: Neal Cardwell <ncardwell@google.com>
    Acked-by: Lawrence Brakmo <brakmo@fb.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 193db507439c4b5f51ec9724c44b753caa5e3726
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Thu Jul 12 15:23:45 2018 +0300

    qlogic: check kstrtoul() for errors
    
    [ Upstream commit 5fc853cc01c68f84984ecc2d5fd777ecad78240f ]
    
    We accidentally left out the error handling for kstrtoul().
    
    Fixes: a520030e326a ("qlcnic: Implement flash sysfs callback for 83xx adapter")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b45ef79dc3e78cd0856a7e69f9d6e42344e78af5
Author: Alexandre Belloni <alexandre.belloni@bootlin.com>
Date:   Thu Jul 12 12:22:44 2018 +0200

    rtc: fix alarm read and set offset
    
    [ Upstream commit fd6792bb022e43faa0c4a45b6f25285e21206f9d ]
    
    The offset needs to be added after reading the alarm value.
    
    It also needs to be subtracted after the now < alarm test.
    
    Tested-by: Jon Hunter <jonathanh@nvidia.com>
    Signed-off-by: Alexandre Belloni <alexandre.belloni@bootlin.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a2186f729d694c7d510d175ec59dd7b6298641d6
Author: Willem de Bruijn <willemb@google.com>
Date:   Wed Jul 11 12:00:45 2018 -0400

    packet: reset network header if packet shorter than ll reserved space
    
    [ Upstream commit 993675a3100b16a4c80dfd70cbcde8ea7127b31d ]
    
    If variable length link layer headers result in a packet shorter
    than dev->hard_header_len, reset the network header offset. Else
    skb->mac_len may exceed skb->len after skb_mac_reset_len.
    
    packet_sendmsg_spkt already has similar logic.
    
    Fixes: b84bbaf7a6c8 ("packet: in packet_snd start writing at link layer allocation")
    Signed-off-by: Willem de Bruijn <willemb@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9a092576e29f2ed16fd4542372e5fbba441475be
Author: Bert Kenward <bkenward@solarflare.com>
Date:   Wed Jul 11 11:45:10 2018 +0100

    sfc: hold filter_sem consistently during reset
    
    [ Upstream commit 193f20033c54db0dc9563f722fbafbcd5fa0e80d ]
    
    We should take and release the filter_sem consistently during the
    reset process, in the same manner as the mac_lock and reset_lock.
    
    For lockdep consistency we also take the filter_sem for write around
    other calls to efx->type->init().
    
    Fixes: c2bebe37c6b6 ("sfc: give ef10 its own rwsem in the filter table instead of filter_lock")
    Signed-off-by: Bert Kenward <bkenward@solarflare.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3f6034f30421fa7ae3007d0eb753b1633d26950d
Author: Bert Kenward <bkenward@solarflare.com>
Date:   Wed Jul 11 11:44:25 2018 +0100

    sfc: avoid hang from nested use of the filter_sem
    
    [ Upstream commit 1c56c0994a533ce564843a0d17af7a3e6e68f269 ]
    
    In some situations we may end up calling down_read while already
    holding the semaphore for write, thus hanging. This has been seen
    when setting the MAC address for the interface. The hung task log
    in this situation includes this stack:
      down_read
      efx_ef10_filter_insert
      efx_ef10_filter_insert_addr_list
      efx_ef10_filter_vlan_sync_rx_mode
      efx_ef10_filter_add_vlan
      efx_ef10_filter_table_probe
      efx_ef10_set_mac_address
      efx_set_mac_address
      dev_set_mac_address
    
    In addition, lockdep rightly points out that nested calling of
    down_read is incorrect.
    
    Fixes: c2bebe37c6b6 ("sfc: give ef10 its own rwsem in the filter table instead of filter_lock")
    Tested-by: Jarod Wilson <jarod@redhat.com>
    Signed-off-by: Bert Kenward <bkenward@solarflare.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5ee0b669e694e36cf71dd06ded50568b04753844
Author: Masahiro Yamada <yamada.masahiro@socionext.com>
Date:   Thu Jul 12 19:38:36 2018 +0900

    kbuild: suppress warnings from 'getconf LFS_*'
    
    [ Upstream commit 6d79a7b424a5630a6fcab31fd7c38af4ea9c9a0f ]
    
    Suppress warnings for systems that do not recognize LFS_*.
    
     getconf: no such configuration parameter `LFS_CFLAGS'
     getconf: no such configuration parameter `LFS_LDFLAGS'
     getconf: no such configuration parameter `LFS_LIBS'
    
    Fixes: d7f14c66c273 ("kbuild: Enable Large File Support for hostprogs")
    Reported-by: Chen Feng <puck.chen@hisilicon.com>
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Acked-by: Uwe Kleine-KÃ¶nig <u.kleine-koenig@pengutronix.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f9d253c15c0b7620c3d400ac135238802fba436b
Author: Laura Abbott <labbott@redhat.com>
Date:   Mon Jul 9 17:45:57 2018 -0700

    tools: build: Use HOSTLDFLAGS with fixdep
    
    [ Upstream commit 8b247a92ebd0cda7dec49a6f771d9c4950f3d3ad ]
    
    The final link of fixdep uses LDFLAGS but not the existing HOSTLDFLAGS.
    Fix this.
    
    Signed-off-by: Laura Abbott <labbott@redhat.com>
    Acked-by: Jiri Olsa <jolsa@kernel.org>
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6110c0fce4cbd477a03c911a2b7d93d58da6f130
Author: Laura Abbott <labbott@redhat.com>
Date:   Mon Jul 9 17:45:56 2018 -0700

    tools: build: Fixup host c flags
    
    [ Upstream commit 6fdbd824fd7a3876aac43d32fdf1f30b9ef72ce4 ]
    
    Commit 0c3b7e42616f ("tools build: Add support for host programs format")
    introduced host_c_flags which referenced CHOSTFLAGS. The actual name of the
    variable is HOSTCFLAGS. Fix this up.
    
    Fixes: 0c3b7e42616f ("tools build: Add support for host programs format")
    Signed-off-by: Laura Abbott <labbott@redhat.com>
    Acked-by: Jiri Olsa <jolsa@kernel.org>
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c8ba74daecc47af30293c06c9df1b944909684af
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Wed Jul 4 12:53:37 2018 +0300

    ixgbe: Off by one in ixgbe_ipsec_tx()
    
    [ Upstream commit c411104115e6821f26fc8f6de8b235ddf98de688 ]
    
    The ipsec->tx_tbl[] has IXGBE_IPSEC_MAX_SA_COUNT elements so the > needs
    to be changed to >= so we don't read one element beyond the end of the
    array.
    
    Fixes: 592594704761 ("ixgbe: process the Tx ipsec offload")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Acked-by: Shannon Nelson <shannon.nelson@oracle.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit da9135048ed7ff854fda1e7cb5df5aa2273bb624
Author: David Francis <David.Francis@amd.com>
Date:   Thu Jul 12 10:07:49 2018 -0400

    amd/dc/dce100: On dce100, set clocks to 0 on suspend
    
    [ Upstream commit 8d4235f71513cdccd9dc52b674323c3591552bc1 ]
    
    [Why]
    When a dce100 asic was suspended, the clocks were not set to 0.
    Upon resume, the new clock was compared to the existing clock,
    they were found to be the same, and so the clock was not set.
    This resulted in a pernicious blackscreen.
    
    [How]
    In atomic commit, check to see if there are any active pipes.
    If no, set clocks to 0
    
    Signed-off-by: David Francis <David.Francis@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1a9739dc9cacfe3b1b4700c8834b5c2142688a8a
Author: Alexander Duyck <alexander.h.duyck@intel.com>
Date:   Mon Jun 18 12:02:00 2018 -0400

    ixgbe: Be more careful when modifying MAC filters
    
    [ Upstream commit d14c780c11fbc10f66c43e7b64eefe87ca442bd3 ]
    
    This change makes it so that we are much more explicit about the ordering
    of updates to the receive address register (RAR) table. Prior to this patch
    I believe we may have been updating the table while entries were still
    active, or possibly allowing for reordering of things since we weren't
    explicitly flushing writes to either the lower or upper portion of the
    register prior to accessing the other half.
    
    Signed-off-by: Alexander Duyck <alexander.h.duyck@intel.com>
    Reviewed-by: Shannon Nelson <shannon.nelson@oracle.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b49969e4b90b1fbf43720050921592418d07c831
Author: Adam Ford <aford173@gmail.com>
Date:   Wed Jul 11 12:54:54 2018 -0500

    ARM: dts: am3517.dtsi: Disable reference to OMAP3 OTG controller
    
    [ Upstream commit 923847413f7316b5ced3491769b3fefa6c56a79a ]
    
    The AM3517 has a different OTG controller location than the OMAP3,
    which is included from omap3.dtsi.  This results in a hwmod error.
    Since the AM3517 has a different OTG controller address, this patch
    disabes one that is isn't available.
    
    Signed-off-by: Adam Ford <aford173@gmail.com>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 102be50be54cf69fa0f2a868e08c969c26c954f2
Author: Nishanth Menon <nm@ti.com>
Date:   Tue Jul 10 14:47:25 2018 -0500

    ARM: DRA7/OMAP5: Enable ACTLR[0] (Enable invalidates of BTB) for secondary cores
    
    [ Upstream commit 2f8b5b21830aea95989a6e67d8a971297272a086 ]
    
    Call secure services to enable ACTLR[0] (Enable invalidates of BTB with
    ICIALLU) when branch hardening is enabled for kernel.
    
    On GP devices OMAP5/DRA7, there is no possibility to update secure
    side since "secure world" is ROM and there are no override mechanisms
    possible. On HS devices, appropriate PPA should do the workarounds as
    well.
    
    However, the configuration is only done for secondary core, since it is
    expected that firmware/bootloader will have enabled the required
    configuration for the primary boot core (note: bootloaders typically
    will NOT enable secondary processors, since it has no need to do so).
    
    Signed-off-by: Nishanth Menon <nm@ti.com>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7fdaa8e0ce366957d3203387a613b5bc08b538bc
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Tue Jul 10 12:05:36 2018 +0100

    sfp: fix module initialisation with netdev already up
    
    [ Upstream commit 576cd32082351620a4e76b8babc4d5ae9b4bbb98 ]
    
    It was been observed that with a particular order of initialisation,
    the netdev can be up, but the SFP module still has its TX_DISABLE
    signal asserted.  This occurs when the network device brought up before
    the SFP kernel module has been inserted by userspace.
    
    This occurs because sfp-bus layer does not hear about the change in
    network device state, and so assumes that it is still down.  Set
    netdev->sfp when the upstream is registered to work around this problem.
    
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e756fc5b02c62e57c4124f562e1e8888a346b953
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Tue Jul 10 12:05:31 2018 +0100

    sfp: ensure we clean up properly on bus registration failure
    
    [ Upstream commit f20a4c46b984331a509528fa2b84125c617ef98b ]
    
    We fail to correctly clean up after a bus registration failure, which
    can lead to an incorrect assumption about the registration state of
    the upstream or sfp cage.
    
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e6ab069a0e67e4284dee6e67640492fc64d4a32a
Author: Steven Rostedt (VMware) <rostedt@goodmis.org>
Date:   Tue Jul 10 08:22:40 2018 +0100

    ARM: 8780/1: ftrace: Only set kernel memory back to read-only after boot
    
    [ Upstream commit b4c7e2bd2eb4764afe3af9409ff3b1b87116fa30 ]
    
    Dynamic ftrace requires modifying the code segments that are usually
    set to read-only. To do this, a per arch function is called both before
    and after the ftrace modifications are performed. The "before" function
    will set kernel code text to read-write to allow for ftrace to make the
    modifications, and the "after" function will set the kernel code text
    back to "read-only" to keep the kernel code text protected.
    
    The issue happens when dynamic ftrace is tested at boot up. The test is
    done before the kernel code text has been set to read-only. But the
    "before" and "after" calls are still performed. The "after" call will
    change the kernel code text to read-only prematurely, and other boot
    code that expects this code to be read-write will fail.
    
    The solution is to add a variable that is set when the kernel code text
    is expected to be converted to read-only, and make the ftrace "before"
    and "after" calls do nothing if that variable is not yet set. This is
    similar to the x86 solution from commit 162396309745 ("ftrace, x86:
    make kernel text writable only for conversions").
    
    Link: http://lkml.kernel.org/r/20180620212906.24b7b66e@vmware.local.home
    
    Reported-by: Stefan Agner <stefan@agner.ch>
    Tested-by: Stefan Agner <stefan@agner.ch>
    Signed-off-by: Steven Rostedt (VMware) <rostedt@goodmis.org>
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fb848d06d2eb75d33f7e7b8d438a56b936d68ced
Author: Kamal Heib <kamalheib1@gmail.com>
Date:   Tue Jul 10 11:56:50 2018 +0300

    RDMA/mlx5: Fix memory leak in mlx5_ib_create_srq() error path
    
    [ Upstream commit d63c46734c545ad0488761059004a65c46efdde3 ]
    
    Fix memory leak in the error path of mlx5_ib_create_srq() by making sure
    to free the allocated srq.
    
    Fixes: c2b37f76485f ("IB/mlx5: Fix integer overflows in mlx5_ib_create_srq")
    Signed-off-by: Kamal Heib <kamalheib1@gmail.com>
    Acked-by: Leon Romanovsky <leonro@mellanox.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3cba6052bb9e5d0422a0ccf34e2033e7575d5517
Author: Dave Jiang <dave.jiang@intel.com>
Date:   Wed Jul 11 10:10:11 2018 -0700

    nfit: fix unchecked dereference in acpi_nfit_ctl
    
    [ Upstream commit ee6581ceba7f8314b81b2f2a81f1cf3f67c679e2 ]
    
    Incremental patch to fix the unchecked dereference in acpi_nfit_ctl.
    Reported by Dan Carpenter:
    
    "acpi/nfit: fix cmd_rc for acpi_nfit_ctl to
    always return a value" from Jun 28, 2018, leads to the following
    Smatch complaint:
    
        drivers/acpi/nfit/core.c:578 acpi_nfit_ctl()
         warn: variable dereferenced before check 'cmd_rc' (see line 411)
    
    drivers/acpi/nfit/core.c
       410
       411          *cmd_rc = -EINVAL;
                    ^^^^^^^^^^^^^^^^^^
    Patch adds unchecked dereference.
    
    Fixes: c1985cefd844 ("acpi/nfit: fix cmd_rc for acpi_nfit_ctl to always return a value")
    
    Signed-off-by: Dave Jiang <dave.jiang@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6ab0a8948f67d1740431da613c707c15068b6674
Author: Jeremy Cline <jcline@redhat.com>
Date:   Tue Jul 10 11:46:12 2018 -0400

    perf tools: Use python-config --includes rather than --cflags
    
    [ Upstream commit 32aa928a7b817140c84987b726d5014911808fa4 ]
    
    Builds started failing in Fedora on Python 3.7 with:
    
        `.gnu.debuglto_.debug_macro' referenced in section
        `.gnu.debuglto_.debug_macro' of
        util/scripting-engines/trace-event-python.o: defined in discarded
        section
    
    In Fedora, Python 3.7 added -flto to the list of --cflags and since it
    was only applied to util/scripting-engines/trace-event-python.c and
    scripts/python/Perf-Trace-Util/Context.c, linking failed.
    
    It's not the first time the addition of flags has broken builds: commit
    c6707fdef7e2 ("perf tools: Fix up build in hardnened environments")
    appears to have fixed a similar problem. "python-config --includes"
    provides the proper -I flags and doesn't introduce additional CFLAGS.
    
    Signed-off-by: Jeremy Cline <jcline@redhat.com>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Jiri Olsa <jolsa@redhat.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Link: http://lkml.kernel.org/r/20180710154612.6285-1-jcline@redhat.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b6c783af06c40b8f52abb93bb50237b750f3573d
Author: Janne Huttunen <janne.huttunen@nokia.com>
Date:   Mon Jul 9 13:59:50 2018 +0300

    perf script python: Fix dict reference counting
    
    [ Upstream commit db0ba84c04ef2cf293aaada5ae97531127844d9d ]
    
    The dictionaries are attached to the parameter tuple that steals the
    references and takes care of releasing them when appropriate.  The code
    should not decrement the reference counts explicitly.  E.g. if libpython
    has been built with reference debugging enabled, the superfluous DECREFs
    will trigger this error when running perf script:
    
      Fatal Python error: Objects/tupleobject.c:238 object at
      0x7f10f2041b40 has negative ref count -1
      Aborted (core dumped)
    
    If the reference debugging is not enabled, the superfluous DECREFs might
    cause the dict objects to be silently released while they are still in
    use. This may trigger various other assertions or just cause perf
    crashes and/or weird and unexpected data changes in the stored Python
    objects.
    
    Signed-off-by: Janne Huttunen <janne.huttunen@nokia.com>
    Acked-by: Jiri Olsa <jolsa@kernel.org>
    Acked-by: Namhyung Kim <namhyung@kernel.org>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Andi Kleen <ak@linux.intel.com>
    Cc: Jaroslav Skarvada <jskarvad@redhat.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Link: http://lkml.kernel.org/r/1531133990-17485-1-git-send-email-janne.huttunen@nokia.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a4546e808abfb0ad40a06feb36b8aaa242f50bcb
Author: Jiri Olsa <jolsa@kernel.org>
Date:   Mon Jul 2 15:42:01 2018 +0200

    perf tools: Fix compilation errors on gcc8
    
    [ Upstream commit a09603f851045b031e990d2d663958ccb49db525 ]
    
    We are getting following warnings on gcc8 that break compilation:
    
      $ make
        CC       jvmti/jvmti_agent.o
      jvmti/jvmti_agent.c: In function âjvmti_openâ:
      jvmti/jvmti_agent.c:252:35: error: â/jit-â directive output may be truncated \
        writing 5 bytes into a region of size between 1 and 4096 [-Werror=format-truncation=]
        snprintf(dump_path, PATH_MAX, "%s/jit-%i.dump", jit_path, getpid());
    
    There's no point in checking the result of snprintf call in
    jvmti_open, the following open call will fail in case the
    name is mangled or too long.
    
    Using tools/lib/ function scnprintf that touches the return value from
    the snprintf() calls and thus get rid of those warnings.
    
      $ make DEBUG=1
        CC       arch/x86/util/perf_regs.o
      arch/x86/util/perf_regs.c: In function âarch_sdt_arg_parse_opâ:
      arch/x86/util/perf_regs.c:229:4: error: âstrncpyâ output truncated before terminating nul
      copying 2 bytes from a string of the same length [-Werror=stringop-truncation]
        strncpy(prefix, "+0", 2);
        ^~~~~~~~~~~~~~~~~~~~~~~~
    
    Using scnprintf instead of the strncpy (which we know is safe in here)
    to get rid of that warning.
    
    Signed-off-by: Jiri Olsa <jolsa@kernel.org>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: David Ahern <dsahern@gmail.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Link: http://lkml.kernel.org/r/20180702134202.17745-1-jolsa@kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f3327af7f84b91a131a0e132fbe5d22231bed298
Author: Kim Phillips <kim.phillips@arm.com>
Date:   Fri Jun 29 12:46:58 2018 -0500

    perf test shell: Prevent temporary editor files from being considered test scripts
    
    [ Upstream commit db8fec583f250557ddd6def1505a6c466c9747aa ]
    
    Allows a perf shell test developer to concurrently edit and run their
    test scripts, avoiding perf test attempts to execute their editor
    temporary files, such as seen here:
    
     $ sudo taskset -c 0 ./perf test -vvvvvvvv -F 63
     63: 0VIM 8.0                                              :
     --- start ---
     sh: 1: ./tests/shell/.record+probe_libc_inet_pton.sh.swp: Permission denied
     ---- end ----
     0VIM 8.0: FAILED!
    
    Signed-off-by: Kim Phillips <kim.phillips@arm.com>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Hendrik Brueckner <brueckner@linux.vnet.ibm.com>
    Cc: Jiri Olsa <jolsa@redhat.com>
    Cc: Michael Petlan <mpetlan@redhat.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Sandipan Das <sandipan@linux.vnet.ibm.com>
    Cc: Thomas Richter <tmricht@linux.vnet.ibm.com>
    Link: http://lkml.kernel.org/r/20180629124658.15a506b41fc4539c08eb9426@arm.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit daeabef01fbd6432b0f37ffc2d663c0472b204ab
Author: Kim Phillips <kim.phillips@arm.com>
Date:   Fri Jun 29 12:46:52 2018 -0500

    perf llvm-utils: Remove bashism from kernel include fetch script
    
    [ Upstream commit f6432b9f65001651412dbc3589d251534822d4ab ]
    
    Like system(), popen() calls /bin/sh, which may/may not be bash.
    
    Script when run on dash and encounters the line, yields:
    
     exit: Illegal number: -1
    
    checkbashisms report on script content:
    
     possible bashism (exit|return with negative status code):
     exit -1
    
    Remove the bashism and use the more portable non-zero failure
    status code 1.
    
    Signed-off-by: Kim Phillips <kim.phillips@arm.com>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Hendrik Brueckner <brueckner@linux.vnet.ibm.com>
    Cc: Jiri Olsa <jolsa@redhat.com>
    Cc: Michael Petlan <mpetlan@redhat.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Sandipan Das <sandipan@linux.vnet.ibm.com>
    Cc: Thomas Richter <tmricht@linux.vnet.ibm.com>
    Link: http://lkml.kernel.org/r/20180629124652.8d0af7e2281fd3fd8262cacc@arm.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 268b59b6807cc7f0bcd17a08af2eda2df0ca1249
Author: Manish Rangankar <manish.rangankar@cavium.com>
Date:   Mon Jul 2 23:52:31 2018 -0700

    scsi: qedi: Send driver state to MFW
    
    [ Upstream commit a3440d0d2f57f7ba102fc332086961cf261180af ]
    
    In case of iSCSI offload BFS environment, MFW requires to mark virtual
    link based upon qedi load status.
    
    Signed-off-by: Manish Rangankar <manish.rangankar@qlogic.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 43a75ff22e6ab543841b02182d2532cd713bce9c
Author: Saurav Kashyap <saurav.kashyap@cavium.com>
Date:   Thu Jul 5 07:01:33 2018 -0700

    scsi: qedf: Send the driver state to MFW
    
    [ Upstream commit 6ac174756dfc9884f08b23af840ca911155f5578 ]
    
    Need to notify firmware when driver is loaded and unloaded.
    
    Signed-off-by: Saurav Kashyap <saurav.kashyap@cavium.com>
    Signed-off-by: Chad Dupuis <chad.dupuis@cavium.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7f545182d9ed075cd4c9248fc62d2c0de681e125
Author: Don Brace <don.brace@microsemi.com>
Date:   Tue Jul 3 17:34:48 2018 -0500

    scsi: hpsa: correct enclosure sas address
    
    [ Upstream commit 01d0e789a14aa735ddcfddd468ef06d4f917e06d ]
    
    The original complaint was the lsscsi -t showed the same SAS address of the
    two enclosures (SEP devices). In fact the SAS address was being set to the
    Enclosure Logical Identifier (ELI).
    
    Reviewed-by: Scott Teel <scott.teel@microsemi.com>
    Reviewed-by: Kevin Barnett <kevin.barnett@microsemi.com>
    Signed-off-by: Don Brace <don.brace@microsemi.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ab85798979f1f470d64227628ed581fa0d341bfe
Author: Taeung Song <treeze.taeung@gmail.com>
Date:   Tue Jul 10 02:51:21 2018 +0900

    samples/bpf: Fix tc and ip paths in xdp2skb_meta.sh
    
    [ Upstream commit b9626f45abccd044f8048269c67720f0719f2d4e ]
    
    The below path error can occur:
    
      # ./xdp2skb_meta.sh --dev eth0 --list
      ./xdp2skb_meta.sh: line 61: /usr/sbin/tc: No such file or directory
    
    So just use command names instead of absolute paths of tc and ip.
    In addition, it allow callers to redefine $TC and $IP paths
    
    Fixes: 36e04a2d78d9 ("samples/bpf: xdp2skb_meta shows transferring info from XDP to SKB")
    Reviewed-by: Jesper Dangaard Brouer <brouer@redhat.com>
    Signed-off-by: Taeung Song <treeze.taeung@gmail.com>
    Acked-by: Jesper Dangaard Brouer <brouer@redhat.com>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 276dbd6801de8445807021704a5fb19e25d57dc4
Author: Vikas Gupta <vikas.gupta@broadcom.com>
Date:   Mon Jul 9 02:24:52 2018 -0400

    bnxt_en: Fix for system hang if request_irq fails
    
    [ Upstream commit c58387ab1614f6d7fb9e244f214b61e7631421fc ]
    
    Fix bug in the error code path when bnxt_request_irq() returns failure.
    bnxt_disable_napi() should not be called in this error path because
    NAPI has not been enabled yet.
    
    Fixes: c0c050c58d84 ("bnxt_en: New Broadcom ethernet driver.")
    Signed-off-by: Vikas Gupta <vikas.gupta@broadcom.com>
    Signed-off-by: Michael Chan <michael.chan@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 09a63bc8c2d4d41f58f6c381b2d312b4b08c0faf
Author: Michael Chan <michael.chan@broadcom.com>
Date:   Mon Jul 9 02:24:51 2018 -0400

    bnxt_en: Do not modify max IRQ count after RDMA driver requests/frees IRQs.
    
    [ Upstream commit 30f529473ec962102e8bcd33a6a04f1e1b490ae2 ]
    
    Calling bnxt_set_max_func_irqs() to modify the max IRQ count requested or
    freed by the RDMA driver is flawed.  The max IRQ count is checked when
    re-initializing the IRQ vectors and this can happen multiple times
    during ifup or ethtool -L.  If the max IRQ is reduced and the RDMA
    driver is operational, we may not initailize IRQs correctly.  This
    problem shows up on VFs with very small number of MSIX.
    
    There is no other logic that relies on the IRQ count excluding the ones
    used by RDMA.  So we fix it by just removing the call to subtract or
    add the IRQs used by RDMA.
    
    Fixes: a588e4580a7e ("bnxt_en: Add interface to support RDMA driver.")
    Signed-off-by: Michael Chan <michael.chan@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e678c47251bedef1cf9bbcb967e02305e6780b87
Author: Michael Chan <michael.chan@broadcom.com>
Date:   Mon Jul 9 02:24:49 2018 -0400

    bnxt_en: Always set output parameters in bnxt_get_max_rings().
    
    [ Upstream commit 78f058a4aa0f2280dc4d45d2c4a95728398ef857 ]
    
    The current code returns -ENOMEM and does not bother to set the output
    parameters to 0 when no rings are available.  Some callers, such as
    bnxt_get_channels() will display garbage ring numbers when that happens.
    Fix it by always setting the output parameters.
    
    Fixes: 6e6c5a57fbe1 ("bnxt_en: Modify bnxt_get_max_rings() to support shared or non shared rings.")
    Signed-off-by: Michael Chan <michael.chan@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5ef273fbb3eca2f7767abd43b93c3c393dd79c74
Author: Michael Chan <michael.chan@broadcom.com>
Date:   Mon Jul 9 02:24:48 2018 -0400

    bnxt_en: Fix inconsistent BNXT_FLAG_AGG_RINGS logic.
    
    [ Upstream commit 07f4fde53d12eb8d921b465bb298e964e0bdc38c ]
    
    If there aren't enough RX rings available, the driver will attempt to
    use a single RX ring without the aggregation ring.  If that also
    fails, the BNXT_FLAG_AGG_RINGS flag is cleared but the other ring
    parameters are not set consistently to reflect that.  If more RX
    rings become available at the next open, the RX rings will be in
    an inconsistent state and may crash when freeing the RX rings.
    
    Fix it by restoring the BNXT_FLAG_AGG_RINGS if not enough RX rings are
    available to run without aggregation rings.
    
    Fixes: bdbd1eb59c56 ("bnxt_en: Handle no aggregation ring gracefully.")
    Signed-off-by: Michael Chan <michael.chan@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5e00d96990821556d1eff891a06b20f235bd7a19
Author: Venkat Duvvuru <venkatkumar.duvvuru@broadcom.com>
Date:   Mon Jul 9 02:24:47 2018 -0400

    bnxt_en: Fix the vlan_tci exact match check.
    
    [ Upstream commit e32d4e60b350124065e0ffd9c91ac13a439aee9a ]
    
    It is possible that OVS may set donât care for DEI/CFI bit in
    vlan_tci mask. Hence, checking for vlan_tci exact match will endup
    in a vlan flow rejection.
    
    This patch fixes the problem by checking for vlan_pcp and vid
    separately, instead of checking for the entire vlan_tci.
    
    Fixes: e85a9be93cf1 (bnxt_en: do not allow wildcard matches for L2 flows)
    Signed-off-by: Venkat Duvvuru <venkatkumar.duvvuru@broadcom.com>
    Signed-off-by: Michael Chan <michael.chan@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 451530c5ac3fc9863d7b18346300d173f257c35e
Author: Peter Zijlstra <peterz@infradead.org>
Date:   Tue Jun 19 17:22:05 2018 +0300

    ARC: Improve cmpxchg syscall implementation
    
    [ Upstream commit e8708786d4fe21c043d38d760f768949a3d71185 ]
    
    This is used in configs lacking hardware atomics to emulate atomic r-m-w
    for user space, implemented by disabling preemption in kernel.
    
    However there are issues in current implementation:
    
    1. Process not terminated if invalid user pointer passed:
       i.e. __get_user() failed.
    
    2. The reason for this patch was __put_user() failure not being handled
       either, specifically for the COW break scenario.
       The zero page is initially wired up and read from __get_user()
       succeeds. A subsequent write by __put_user() induces a
       Protection Violation, but COW can't finish as Linux page fault
       handler is disabled due to preempt disable.
       And what's worse is we silently return the stale value to user space.
       Fix this specific case by re-enabling preemption and explicitly
       fixing up the fault and retrying the whole sequence over.
    
    Cc: Max Filippov <jcmvbkbc@gmail.com>
    Cc: linux-arch@vger.kernel.org
    Signed-off-by: Alexey Brodkin <abrodkin@synopsys.com>
    Signed-off-by: Peter Zijlstra <peterz@infradead.org>
    Signed-off-by: Vineet Gupta <vgupta@synopsys.com>
    [vgupta: rewrote the changelog]
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f5bab96e13a8ca8042bc9ff8e0d7ee9977b32ed7
Author: Gustavo Pimentel <gustavo.pimentel@synopsys.com>
Date:   Fri Jul 6 11:32:37 2018 +0100

    ARC: [plat-hsdk]: Configure APB GPIO controller on ARC HSDK platform
    
    [ Upstream commit ec58ba16e174d7ca24c8955a21cd0a53e0c32fdf ]
    
    In case of HSDK we have intermediate INTC in for of DW APB GPIO controller
    which is used as a de-bounce logic for interrupt wires that come from
    outside the board.
    
    We cannot use existing "irq-dw-apb-ictl" driver here because all input
    lines are routed to corresponding output lines but not muxed into one
    line (this is configured in RTL and we cannot change this in software).
    
    But even if we add such a feature to "irq-dw-apb-ictl" driver that won't
    benefit us as higher-level INTC (in case of HSDK it is IDU) anyways has
    per-input control so adding fully-controller intermediate INTC will only
    bring some overhead on interrupt processing but no other benefits.
    
    Thus we just do one-time configuration of DW APB GPIO controller and
    forget about it.
    
    Based on implementation available on arch/arc/plat-axs10x/axs10x.c file.
    
    Acked-by: Alexey Brodkin <abrodkin@synopsys.com>
    Signed-off-by: Gustavo Pimentel <gustavo.pimentel@synopsys.com>
    Signed-off-by: Vineet Gupta <vgupta@synopsys.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d3924825477fbb228af3e3f74d2474f2720ac5a5
Author: Andrey Ryabinin <aryabinin@virtuozzo.com>
Date:   Fri Jul 6 16:38:53 2018 +0300

    netfilter: nf_conntrack: Fix possible possible crash on module loading.
    
    [ Upstream commit 2045cdfa1b40d66f126f3fd05604fc7c754f0022 ]
    
    Loading the nf_conntrack module with doubled hashsize parameter, i.e.
              modprobe nf_conntrack hashsize=12345 hashsize=12345
    causes NULL-ptr deref.
    
    If 'hashsize' specified twice, the nf_conntrack_set_hashsize() function
    will be called also twice.
    The first nf_conntrack_set_hashsize() call will set the
    'nf_conntrack_htable_size' variable:
    
            nf_conntrack_set_hashsize()
                    ...
                    /* On boot, we can set this without any fancy locking. */
                    if (!nf_conntrack_htable_size)
                            return param_set_uint(val, kp);
    
    But on the second invocation, the nf_conntrack_htable_size is already set,
    so the nf_conntrack_set_hashsize() will take a different path and call
    the nf_conntrack_hash_resize() function. Which will crash on the attempt
    to dereference 'nf_conntrack_hash' pointer:
    
            BUG: unable to handle kernel NULL pointer dereference at 0000000000000000
            RIP: 0010:nf_conntrack_hash_resize+0x255/0x490 [nf_conntrack]
            Call Trace:
             nf_conntrack_set_hashsize+0xcd/0x100 [nf_conntrack]
             parse_args+0x1f9/0x5a0
             load_module+0x1281/0x1a50
             __se_sys_finit_module+0xbe/0xf0
             do_syscall_64+0x7c/0x390
             entry_SYSCALL_64_after_hwframe+0x49/0xbe
    
    Fix this, by checking !nf_conntrack_hash instead of
    !nf_conntrack_htable_size. nf_conntrack_hash will be initialized only
    after the module loaded, so the second invocation of the
    nf_conntrack_set_hashsize() won't crash, it will just reinitialize
    nf_conntrack_htable_size again.
    
    Signed-off-by: Andrey Ryabinin <aryabinin@virtuozzo.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit eb968e6d9d60320ea45e9edb9225b8bf382f7459
Author: Florian Westphal <fw@strlen.de>
Date:   Fri Jul 6 20:06:05 2018 +0200

    netfilter: nft_compat: explicitly reject ERROR and standard target
    
    [ Upstream commit 21d5e078192d244df3d6049f9464fff2f72cfd68 ]
    
    iptables-nft never requests these, but make this explicitly illegal.
    If it were quested, kernel could oops as ->eval is NULL, furthermore,
    the builtin targets have no owning module so its possible to rmmod
    eb/ip/ip6_tables module even if they would be loaded.
    
    Signed-off-by: Florian Westphal <fw@strlen.de>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 66a0b739377ee0341b0c632f7d5312b596f9b54d
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Tue Jun 26 17:06:06 2018 +0100

    drm/armada: fix irq handling
    
    [ Upstream commit 92298c1cd8e8a6b56322b602ad72b54e6237631d ]
    
    Add the missing locks to the IRQ enable/disable paths, and fix a comment
    in the interrupt handler: reading the ISR clears down the status bits,
    but does not reset the interrupt so it can signal again.  That seems to
    require a write.
    
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 697eafd012180c48ce433c1eeeb00ab2bd7f7ee4
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Sun Jun 24 14:35:10 2018 +0100

    drm/armada: fix colorkey mode property
    
    [ Upstream commit d378859a667edc99e3473704847698cae97ca2b1 ]
    
    The colorkey mode property was not correctly disabling the colorkeying
    when "disabled" mode was selected.  Arrange for this to work as one
    would expect.
    
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a2363e2d88bf50022ee643c49ee5d4f7e8c915ea
Author: Michael Hennerich <michael.hennerich@analog.com>
Date:   Mon Jun 25 16:57:37 2018 +0300

    net: ieee802154: adf7242: Fix OCL calibration runs
    
    [ Upstream commit 58e9683d14752debc6f22daf6b23e031787df31f ]
    
    Reissuing RC_RX every 400ms - to adjust for offset drift in
    receiver see datasheet page 61, OCL section.
    
    Signed-off-by: Michael Hennerich <michael.hennerich@analog.com>
    Signed-off-by: Alexandru Ardelean <alexandru.ardelean@analog.com>
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c313f29e446a1a75337df0c9bf598b830d4e1310
Author: Michael Hennerich <michael.hennerich@analog.com>
Date:   Mon Jun 25 16:49:51 2018 +0300

    net: ieee802154: adf7242: Fix erroneous RX enable
    
    [ Upstream commit 36d26d6b6208399070a9d7993534fef9fc26b1ba ]
    
    Only enable RX mode if the netdev is opened.
    
    Signed-off-by: Michael Hennerich <michael.hennerich@analog.com>
    Signed-off-by: Alexandru Ardelean <alexandru.ardelean@analog.com>
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0c5a08372faf7b587eb952ad697e7bd9d7480448
Author: Mikko Perttunen <mperttunen@nvidia.com>
Date:   Wed Jun 20 16:03:58 2018 +0300

    drm/tegra: Fix comparison operator for buffer size
    
    [ Upstream commit 5265f0338bc0feec6c0d544dfe005dec1a93cb93 ]
    
    Here we are checking for the buffer length, not an offset for writing
    to, so using > is correct. The current code incorrectly rejects a
    command buffer ending at the memory buffer's end.
    
    Signed-off-by: Mikko Perttunen <mperttunen@nvidia.com>
    Reviewed-by: Dmitry Osipenko <digetx@gmail.com>
    Signed-off-by: Thierry Reding <treding@nvidia.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7be437a4a72c95621d2c5b511a4900cc9ae5e47a
Author: Dmitry Osipenko <digetx@gmail.com>
Date:   Fri Jul 6 21:02:36 2018 +0300

    gpu: host1x: Check whether size of unpin isn't 0
    
    [ Upstream commit ec58923215dbbeef59ee82923ee94d745f73db58 ]
    
    Only gather pins are mapped by the Host1x driver, regular BO relocations
    are not. Check whether size of unpin isn't 0, otherwise IOVA allocation at
    0x0 could be erroneously released.
    
    Signed-off-by: Dmitry Osipenko <digetx@gmail.com>
    Signed-off-by: Thierry Reding <treding@nvidia.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dd6a05c921c6d2aaa589e3b0af98144110acdaef
Author: Dmitry Osipenko <digetx@gmail.com>
Date:   Sat May 19 04:07:10 2018 +0300

    gpu: host1x: Skip IOMMU initialization if firewall is enabled
    
    [ Upstream commit 4466b1f0e022f94a026bd700fee34bff15cdc4ef ]
    
    Host1x's CDMA can't access the command buffers if IOMMU and Host1x
    firewall are enabled in the kernels config because firewall doesn't map
    the copied buffer into IOVA space. Fix this by skipping IOMMU
    initialization if firewall is enabled as firewall merges sparse cmdbufs
    into a single contiguous buffer and hence IOMMU isn't needed in this case.
    
    Signed-off-by: Dmitry Osipenko <digetx@gmail.com>
    Signed-off-by: Thierry Reding <treding@nvidia.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 054b9b5cd6788ac7cdc749619b8576385811532a
Author: Stefan Schmidt <stefan@datenfreihafen.org>
Date:   Fri Sep 22 14:14:05 2017 +0200

    ieee802154: fakelb: switch from BUG_ON() to WARN_ON() on problem
    
    [ Upstream commit 8f2fbc6c60ff213369e06a73610fc882a42fdf20 ]
    
    The check is valid but it does not warrant to crash the kernel. A
    WARN_ON() is good enough here.
    Found by checkpatch.
    
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b0da3918d1159a9ea60782558878a47b2a4ae835
Author: Stefan Schmidt <stefan@datenfreihafen.org>
Date:   Fri Sep 22 14:13:54 2017 +0200

    ieee802154: at86rf230: use __func__ macro for debug messages
    
    [ Upstream commit 8a81388ec27c4c0adbdecd20e67bb5f411ab46b2 ]
    
    Instead of having the function name hard-coded (it might change and we
    forgot to update them in the debug output) we can use __func__ instead
    and also shorter the line so we do not need to break it. Also fix an
    extra blank line while being here.
    Found by checkpatch.
    
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7a56e644d28c03b319fd2bd5dc5cb80ecf6e373f
Author: Stefan Schmidt <stefan@datenfreihafen.org>
Date:   Fri Sep 22 14:13:53 2017 +0200

    ieee802154: at86rf230: switch from BUG_ON() to WARN_ON() on problem
    
    [ Upstream commit 20f330452ad8814f2289a589baf65e21270879a7 ]
    
    The check is valid but it does not warrant to crash the kernel. A
    WARN_ON() is good enough here.
    Found by checkpatch.
    
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 33be064adf3a55de91c11101be85c0771055e174
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Fri Jul 6 16:28:28 2018 +0200

    drm/sun4i: link in front-end code if needed
    
    [ Upstream commit 3156b53c2e2fadafa1a16412a8791b38f94b5bdc ]
    
    When the base sun4i DRM driver is built-in but the back-end is
    a loadable module, we run into a link error:
    
    drivers/gpu/drm/sun4i/sun4i_drv.o: In function `sun4i_drv_probe':
    sun4i_drv.c:(.text+0x60c): undefined reference to `sun4i_frontend_of_table'
    
    The dependency is a bit tricky, the best workaround I have come up
    with is to use a Makefile hack to to interpret both
    CONFIG_DRM_SUN4I_BACKEND=m and CONFIG_DRM_SUN4I_BACKEND=y
    as a directive to build the front-end the same way as the main module.
    
    Fixes: dd0421f47505 ("drm/sun4i: Add a driver for the display frontend")
    Link: https://lore.kernel.org/lkml/20180301091908.zcptz3ezqr2c6ly5@flea/
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Maxime Ripard <maxime.ripard@bootlin.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20180706142847.2032381-1-arnd@arndb.de
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c46a24e3a65e017ddee1d315350453651e9659b0
Author: Paolo Abeni <pabeni@redhat.com>
Date:   Fri Jul 6 12:30:20 2018 +0200

    ipfrag: really prevent allocation on netns exit
    
    [ Upstream commit f6f2a4a2eb92bc73671204198bb2f8ab53ff59fb ]
    
    Setting the low threshold to 0 has no effect on frags allocation,
    we need to clear high_thresh instead.
    
    The code was pre-existent to commit 648700f76b03 ("inet: frags:
    use rhashtables for reassembly units"), but before the above,
    such assignment had a different role: prevent concurrent eviction
    from the worker and the netns cleanup helper.
    
    Fixes: 648700f76b03 ("inet: frags: use rhashtables for reassembly units")
    Signed-off-by: Paolo Abeni <pabeni@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d71c9c2ae178d6cede0e753e0ff2c6ee8ef7123b
Author: John Fastabend <john.fastabend@gmail.com>
Date:   Thu Jul 5 08:49:59 2018 -0700

    bpf: fix sk_skb programs without skb->dev assigned
    
    [ Upstream commit 0c6bc6e531a6db36f49622f1f115770160f7afb0 ]
    
    Multiple BPF helpers in use by sk_skb programs calculate the max
    skb length using the __bpf_skb_max_len function. However, this
    calculates the max length using the skb->dev pointer which can be
    NULL when an sk_skb program is paired with an sk_msg program.
    
    To force this a sk_msg program needs to redirect into the ingress
    path of a sock with an attach sk_skb program. Then the the sk_skb
    program would need to call one of the helpers that adjust the skb
    size.
    
    To fix the null ptr dereference use SKB_MAX_ALLOC size if no dev
    is available.
    
    Fixes: 8934ce2fd081 ("bpf: sockmap redirect ingress support")
    Signed-off-by: John Fastabend <john.fastabend@gmail.com>
    Signed-off-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ddb34285197209ceef4e3f1283a1a9f7604b51bb
Author: Douglas Anderson <dianders@chromium.org>
Date:   Mon Jun 18 18:30:43 2018 +0100

    nvmem: Don't let a NULL cell_id for nvmem_cell_get() crash us
    
    [ Upstream commit 87ed1405ef09d29a14df43295f7b6a93b63bfe6e ]
    
    In commit ca04d9d3e1b1 ("phy: qcom-qusb2: New driver for QUSB2 PHY on
    Qcom chips") you can see a call like:
    
      devm_nvmem_cell_get(dev, NULL);
    
    Note that the cell ID passed to the function is NULL.  This is because
    the qcom-qusb2 driver is expected to work only on systems where the
    PHY node is hooked up via device-tree and is nameless.
    
    This works OK for the most part.  The first thing nvmem_cell_get()
    does is to call of_nvmem_cell_get() and there it's documented that a
    NULL name is fine.  The problem happens when the call to
    of_nvmem_cell_get() returns -EINVAL.  In such a case we'll fall back
    to nvmem_cell_get_from_list() and eventually might (if nvmem_cells
    isn't an empty list) crash with something that looks like:
    
     strcmp
     nvmem_find_cell
     __nvmem_device_get
     nvmem_cell_get_from_list
     nvmem_cell_get
     devm_nvmem_cell_get
     qusb2_phy_probe
    
    There are several different ways we could fix this problem:
    
    One could argue that perhaps the qcom-qusb2 driver should be changed
    to use of_nvmem_cell_get() which is allowed to have a NULL name.  In
    that case, we'd need to add a patche to introduce
    devm_of_nvmem_cell_get() since the qcom-qusb2 driver is using devm
    managed resources.
    
    One could also argue that perhaps we could just add a name to
    qcom-qusb2.  That would be OK but I believe it effectively changes the
    device tree bindings, so maybe it's a no-go.
    
    In this patch I have chosen to fix the problem by simply not crashing
    when a NULL cell_id is passed to nvmem_cell_get().
    
    NOTE: that for the qcom-qusb2 driver the "nvmem-cells" property is
    defined to be optional and thus it's expected to be a common case that
    we would hit this crash and this is more than just a theoretical fix.
    
    Fixes: ca04d9d3e1b1 ("phy: qcom-qusb2: New driver for QUSB2 PHY on Qcom chips")
    Signed-off-by: Douglas Anderson <dianders@chromium.org>
    Signed-off-by: Srinivas Kandagatla <srinivas.kandagatla@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 01e1bef2306971d770df898f0ba244a716a93bee
Author: Davide Caratti <dcaratti@redhat.com>
Date:   Fri Jul 6 21:01:06 2018 +0200

    net/sched: act_tunnel_key: fix NULL dereference when 'goto chain' is used
    
    [ Upstream commit 38230a3e0e0933bbcf5df6fa469ba0667f667568 ]
    
    the control action in the common member of struct tcf_tunnel_key must be a
    valid value, as it can contain the chain index when 'goto chain' is used.
    Ensure that the control action can be read as x->tcfa_action, when x is a
    pointer to struct tc_action and x->ops->type is TCA_ACT_TUNNEL_KEY, to
    prevent the following command:
    
     # tc filter add dev $h2 ingress protocol ip pref 1 handle 101 flower \
     > $tcflags dst_mac $h2mac action tunnel_key unset goto chain 1
    
    from causing a NULL dereference when a matching packet is received:
    
     BUG: unable to handle kernel NULL pointer dereference at 0000000000000000
     PGD 80000001097ac067 P4D 80000001097ac067 PUD 103b0a067 PMD 0
     Oops: 0000 [#1] SMP PTI
     CPU: 0 PID: 3491 Comm: mausezahn Tainted: G            E     4.18.0-rc2.auguri+ #421
     Hardware name: Hewlett-Packard HP Z220 CMT Workstation/1790, BIOS K51 v01.58 02/07/2013
     RIP: 0010:tcf_action_exec+0xb8/0x100
     Code: 00 00 00 20 74 1d 83 f8 03 75 09 49 83 c4 08 4d 39 ec 75 bc 48 83 c4 10 5b 5d 41 5c 41 5d 41 5e 41 5f c3 49 8b 97 a8 00 00 00 <48> 8b 12 48 89 55 00 48 83 c4 10 5b 5d 41 5c 41 5d 41 5e 41 5f c3
     RSP: 0018:ffff95145ea03c40 EFLAGS: 00010246
     RAX: 0000000020000001 RBX: ffff9514499e5800 RCX: 0000000000000001
     RDX: 0000000000000000 RSI: 0000000000000002 RDI: 0000000000000000
     RBP: ffff95145ea03e60 R08: 0000000000000000 R09: ffff95145ea03c9c
     R10: ffff95145ea03c78 R11: 0000000000000008 R12: ffff951456a69800
     R13: ffff951456a69808 R14: 0000000000000001 R15: ffff95144965ee40
     FS:  00007fd67ee11740(0000) GS:ffff95145ea00000(0000) knlGS:0000000000000000
     CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
     CR2: 0000000000000000 CR3: 00000001038a2006 CR4: 00000000001606f0
     Call Trace:
      <IRQ>
      fl_classify+0x1ad/0x1c0 [cls_flower]
      ? __update_load_avg_se.isra.47+0x1ca/0x1d0
      ? __update_load_avg_se.isra.47+0x1ca/0x1d0
      ? update_load_avg+0x665/0x690
      ? update_load_avg+0x665/0x690
      ? kmem_cache_alloc+0x38/0x1c0
      tcf_classify+0x89/0x140
      __netif_receive_skb_core+0x5ea/0xb70
      ? enqueue_entity+0xd0/0x270
      ? process_backlog+0x97/0x150
      process_backlog+0x97/0x150
      net_rx_action+0x14b/0x3e0
      __do_softirq+0xde/0x2b4
      do_softirq_own_stack+0x2a/0x40
      </IRQ>
      do_softirq.part.18+0x49/0x50
      __local_bh_enable_ip+0x49/0x50
      __dev_queue_xmit+0x4ab/0x8a0
      ? wait_woken+0x80/0x80
      ? packet_sendmsg+0x38f/0x810
      ? __dev_queue_xmit+0x8a0/0x8a0
      packet_sendmsg+0x38f/0x810
      sock_sendmsg+0x36/0x40
      __sys_sendto+0x10e/0x140
      ? do_vfs_ioctl+0xa4/0x630
      ? syscall_trace_enter+0x1df/0x2e0
      ? __audit_syscall_exit+0x22a/0x290
      __x64_sys_sendto+0x24/0x30
      do_syscall_64+0x5b/0x180
      entry_SYSCALL_64_after_hwframe+0x44/0xa9
     RIP: 0033:0x7fd67e18dc93
     Code: 48 8b 0d 18 83 20 00 f7 d8 64 89 01 48 83 c8 ff c3 66 0f 1f 44 00 00 83 3d 59 c7 20 00 00 75 13 49 89 ca b8 2c 00 00 00 0f 05 <48> 3d 01 f0 ff ff 73 34 c3 48 83 ec 08 e8 2b f7 ff ff 48 89 04 24
     RSP: 002b:00007ffe0189b748 EFLAGS: 00000246 ORIG_RAX: 000000000000002c
     RAX: ffffffffffffffda RBX: 00000000020ca010 RCX: 00007fd67e18dc93
     RDX: 0000000000000062 RSI: 00000000020ca322 RDI: 0000000000000003
     RBP: 00007ffe0189b780 R08: 00007ffe0189b760 R09: 0000000000000014
     R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000062
     R13: 00000000020ca322 R14: 00007ffe0189b760 R15: 0000000000000003
     Modules linked in: act_tunnel_key act_gact cls_flower sch_ingress vrf veth act_csum(E) xt_CHECKSUM iptable_mangle ipt_MASQUERADE iptable_nat nf_nat_ipv4 nf_nat nf_conntrack_ipv4 nf_defrag_ipv4 xt_conntrack nf_conntrack ipt_REJECT nf_reject_ipv4 tun bridge stp llc ebtable_filter ebtables ip6table_filter ip6_tables iptable_filter intel_rapl snd_hda_codec_hdmi x86_pkg_temp_thermal intel_powerclamp snd_hda_codec_realtek coretemp snd_hda_codec_generic kvm_intel kvm irqbypass snd_hda_intel crct10dif_pclmul crc32_pclmul hp_wmi ghash_clmulni_intel pcbc snd_hda_codec aesni_intel sparse_keymap rfkill snd_hda_core snd_hwdep snd_seq crypto_simd iTCO_wdt gpio_ich iTCO_vendor_support wmi_bmof cryptd mei_wdt glue_helper snd_seq_device snd_pcm pcspkr snd_timer snd i2c_i801 lpc_ich sg soundcore wmi mei_me
      mei ie31200_edac nfsd auth_rpcgss nfs_acl lockd grace sunrpc ip_tables xfs libcrc32c sd_mod sr_mod cdrom i915 video i2c_algo_bit drm_kms_helper syscopyarea sysfillrect sysimgblt fb_sys_fops ahci crc32c_intel libahci serio_raw sfc libata mtd drm ixgbe mdio i2c_core e1000e dca
     CR2: 0000000000000000
     ---[ end trace 1ab8b5b5d4639dfc ]---
     RIP: 0010:tcf_action_exec+0xb8/0x100
     Code: 00 00 00 20 74 1d 83 f8 03 75 09 49 83 c4 08 4d 39 ec 75 bc 48 83 c4 10 5b 5d 41 5c 41 5d 41 5e 41 5f c3 49 8b 97 a8 00 00 00 <48> 8b 12 48 89 55 00 48 83 c4 10 5b 5d 41 5c 41 5d 41 5e 41 5f c3
     RSP: 0018:ffff95145ea03c40 EFLAGS: 00010246
     RAX: 0000000020000001 RBX: ffff9514499e5800 RCX: 0000000000000001
     RDX: 0000000000000000 RSI: 0000000000000002 RDI: 0000000000000000
     RBP: ffff95145ea03e60 R08: 0000000000000000 R09: ffff95145ea03c9c
     R10: ffff95145ea03c78 R11: 0000000000000008 R12: ffff951456a69800
     R13: ffff951456a69808 R14: 0000000000000001 R15: ffff95144965ee40
     FS:  00007fd67ee11740(0000) GS:ffff95145ea00000(0000) knlGS:0000000000000000
     CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
     CR2: 0000000000000000 CR3: 00000001038a2006 CR4: 00000000001606f0
     Kernel panic - not syncing: Fatal exception in interrupt
     Kernel Offset: 0x11400000 from 0xffffffff81000000 (relocation range: 0xffffffff80000000-0xffffffffbfffffff)
     ---[ end Kernel panic - not syncing: Fatal exception in interrupt ]---
    
    Fixes: d0f6dd8a914f ("net/sched: Introduce act_tunnel_key")
    Signed-off-by: Davide Caratti <dcaratti@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 28694edb7fcac6eed77bfecec71472f27fed1764
Author: Davide Caratti <dcaratti@redhat.com>
Date:   Fri Jul 6 21:01:05 2018 +0200

    net/sched: act_csum: fix NULL dereference when 'goto chain' is used
    
    [ Upstream commit 11a245e2f7bf25fc21f47e4c9c8491841b128890 ]
    
    the control action in the common member of struct tcf_csum must be a valid
    value, as it can contain the chain index when 'goto chain' is used. Ensure
    that the control action can be read as x->tcfa_action, when x is a pointer
    to struct tc_action and x->ops->type is TCA_ACT_CSUM, to prevent the
    following command:
    
      # tc filter add dev $h2 ingress protocol ip pref 1 handle 101 flower \
      > $tcflags dst_mac $h2mac action csum ip or tcp or udp or sctp goto chain 1
    
    from triggering a NULL pointer dereference when a matching packet is
    received.
    
     BUG: unable to handle kernel NULL pointer dereference at 0000000000000000
     PGD 800000010416b067 P4D 800000010416b067 PUD 1041be067 PMD 0
     Oops: 0000 [#1] SMP PTI
     CPU: 0 PID: 3072 Comm: mausezahn Tainted: G            E     4.18.0-rc2.auguri+ #421
     Hardware name: Hewlett-Packard HP Z220 CMT Workstation/1790, BIOS K51 v01.58 02/07/2013
     RIP: 0010:tcf_action_exec+0xb8/0x100
     Code: 00 00 00 20 74 1d 83 f8 03 75 09 49 83 c4 08 4d 39 ec 75 bc 48 83 c4 10 5b 5d 41 5c 41 5d 41 5e 41 5f c3 49 8b 97 a8 00 00 00 <48> 8b 12 48 89 55 00 48 83 c4 10 5b 5d 41 5c 41 5d 41 5e 41 5f c3
     RSP: 0018:ffffa020dea03c40 EFLAGS: 00010246
     RAX: 0000000020000001 RBX: ffffa020d7ccef00 RCX: 0000000000000054
     RDX: 0000000000000000 RSI: ffffa020ca5ae000 RDI: ffffa020d7ccef00
     RBP: ffffa020dea03e60 R08: 0000000000000000 R09: ffffa020dea03c9c
     R10: ffffa020dea03c78 R11: 0000000000000008 R12: ffffa020d3fe4f00
     R13: ffffa020d3fe4f08 R14: 0000000000000001 R15: ffffa020d53ca300
     FS:  00007f5a46942740(0000) GS:ffffa020dea00000(0000) knlGS:0000000000000000
     CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
     CR2: 0000000000000000 CR3: 0000000104218002 CR4: 00000000001606f0
     Call Trace:
      <IRQ>
      fl_classify+0x1ad/0x1c0 [cls_flower]
      ? arp_rcv+0x121/0x1b0
      ? __x2apic_send_IPI_dest+0x40/0x40
      ? smp_reschedule_interrupt+0x1c/0xd0
      ? reschedule_interrupt+0xf/0x20
      ? reschedule_interrupt+0xa/0x20
      ? device_is_rmrr_locked+0xe/0x50
      ? iommu_should_identity_map+0x49/0xd0
      ? __intel_map_single+0x30/0x140
      ? e1000e_update_rdt_wa.isra.52+0x22/0xb0 [e1000e]
      ? e1000_alloc_rx_buffers+0x233/0x250 [e1000e]
      ? kmem_cache_alloc+0x38/0x1c0
      tcf_classify+0x89/0x140
      __netif_receive_skb_core+0x5ea/0xb70
      ? enqueue_task_fair+0xb6/0x7d0
      ? process_backlog+0x97/0x150
      process_backlog+0x97/0x150
      net_rx_action+0x14b/0x3e0
      __do_softirq+0xde/0x2b4
      do_softirq_own_stack+0x2a/0x40
      </IRQ>
      do_softirq.part.18+0x49/0x50
      __local_bh_enable_ip+0x49/0x50
      __dev_queue_xmit+0x4ab/0x8a0
      ? wait_woken+0x80/0x80
      ? packet_sendmsg+0x38f/0x810
      ? __dev_queue_xmit+0x8a0/0x8a0
      packet_sendmsg+0x38f/0x810
      sock_sendmsg+0x36/0x40
      __sys_sendto+0x10e/0x140
      ? do_vfs_ioctl+0xa4/0x630
      ? syscall_trace_enter+0x1df/0x2e0
      ? __audit_syscall_exit+0x22a/0x290
      __x64_sys_sendto+0x24/0x30
      do_syscall_64+0x5b/0x180
      entry_SYSCALL_64_after_hwframe+0x44/0xa9
     RIP: 0033:0x7f5a45cbec93
     Code: 48 8b 0d 18 83 20 00 f7 d8 64 89 01 48 83 c8 ff c3 66 0f 1f 44 00 00 83 3d 59 c7 20 00 00 75 13 49 89 ca b8 2c 00 00 00 0f 05 <48> 3d 01 f0 ff ff 73 34 c3 48 83 ec 08 e8 2b f7 ff ff 48 89 04 24
     RSP: 002b:00007ffd0ee6d748 EFLAGS: 00000246 ORIG_RAX: 000000000000002c
     RAX: ffffffffffffffda RBX: 0000000001161010 RCX: 00007f5a45cbec93
     RDX: 0000000000000062 RSI: 0000000001161322 RDI: 0000000000000003
     RBP: 00007ffd0ee6d780 R08: 00007ffd0ee6d760 R09: 0000000000000014
     R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000062
     R13: 0000000001161322 R14: 00007ffd0ee6d760 R15: 0000000000000003
     Modules linked in: act_csum act_gact cls_flower sch_ingress vrf veth act_tunnel_key(E) xt_CHECKSUM iptable_mangle ipt_MASQUERADE iptable_nat nf_nat_ipv4 nf_nat nf_conntrack_ipv4 nf_defrag_ipv4 xt_conntrack nf_conntrack ipt_REJECT nf_reject_ipv4 tun bridge stp llc ebtable_filter ebtables ip6table_filter ip6_tables iptable_filter intel_rapl x86_pkg_temp_thermal intel_powerclamp coretemp kvm_intel snd_hda_codec_hdmi snd_hda_codec_realtek kvm snd_hda_codec_generic hp_wmi iTCO_wdt sparse_keymap rfkill mei_wdt iTCO_vendor_support wmi_bmof gpio_ich irqbypass crct10dif_pclmul crc32_pclmul ghash_clmulni_intel pcbc aesni_intel snd_hda_intel crypto_simd cryptd snd_hda_codec glue_helper snd_hda_core snd_hwdep snd_seq snd_seq_device snd_pcm pcspkr i2c_i801 snd_timer snd sg lpc_ich soundcore wmi mei_me
      mei ie31200_edac nfsd auth_rpcgss nfs_acl lockd grace sunrpc ip_tables xfs libcrc32c sr_mod cdrom sd_mod ahci libahci crc32c_intel i915 ixgbe serio_raw libata video dca i2c_algo_bit sfc drm_kms_helper syscopyarea mtd sysfillrect mdio sysimgblt fb_sys_fops drm e1000e i2c_core
     CR2: 0000000000000000
     ---[ end trace 3c9e9d1a77df4026 ]---
     RIP: 0010:tcf_action_exec+0xb8/0x100
     Code: 00 00 00 20 74 1d 83 f8 03 75 09 49 83 c4 08 4d 39 ec 75 bc 48 83 c4 10 5b 5d 41 5c 41 5d 41 5e 41 5f c3 49 8b 97 a8 00 00 00 <48> 8b 12 48 89 55 00 48 83 c4 10 5b 5d 41 5c 41 5d 41 5e 41 5f c3
     RSP: 0018:ffffa020dea03c40 EFLAGS: 00010246
     RAX: 0000000020000001 RBX: ffffa020d7ccef00 RCX: 0000000000000054
     RDX: 0000000000000000 RSI: ffffa020ca5ae000 RDI: ffffa020d7ccef00
     RBP: ffffa020dea03e60 R08: 0000000000000000 R09: ffffa020dea03c9c
     R10: ffffa020dea03c78 R11: 0000000000000008 R12: ffffa020d3fe4f00
     R13: ffffa020d3fe4f08 R14: 0000000000000001 R15: ffffa020d53ca300
     FS:  00007f5a46942740(0000) GS:ffffa020dea00000(0000) knlGS:0000000000000000
     CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
     CR2: 0000000000000000 CR3: 0000000104218002 CR4: 00000000001606f0
     Kernel panic - not syncing: Fatal exception in interrupt
     Kernel Offset: 0x26400000 from 0xffffffff81000000 (relocation range: 0xffffffff80000000-0xffffffffbfffffff)
     ---[ end Kernel panic - not syncing: Fatal exception in interrupt ]---
    
    Fixes: 9c5f69bbd75a ("net/sched: act_csum: don't use spinlock in the fast path")
    Signed-off-by: Davide Caratti <dcaratti@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7520d375b0d6441649dfb4348438c882ca485972
Author: Harini Katakam <harini.katakam@xilinx.com>
Date:   Fri Jul 6 12:18:57 2018 +0530

    net: macb: Free RX ring for all queues
    
    [ Upstream commit e50b770ea5c9eff0013e8ae714d20182ed50d5e6 ]
    
    rx ring is allocated for all queues in macb_alloc_consistent.
    Free the same for all queues instead of just Q0.
    
    Signed-off-by: Harini Katakam <harini.katakam@xilinx.com>
    Reviewed-by: Claudiu Beznea <claudiu.beznea@microchip.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 966829aba26675583f0402463ec0eec4c7fb68ee
Author: Daniel Mack <daniel@zonque.org>
Date:   Fri Jul 6 22:15:00 2018 +0200

    ARM: pxa: irq: fix handling of ICMR registers in suspend/resume
    
    [ Upstream commit 0c1049dcb4ceec640d8bd797335bcbebdcab44d2 ]
    
    PXA3xx platforms have 56 interrupts that are stored in two ICMR
    registers. The code in pxa_irq_suspend() and pxa_irq_resume() however
    does a simple division by 32 which only leads to one register being
    saved at suspend and restored at resume time. The NAND interrupt
    setting, for instance, is lost.
    
    Fix this by using DIV_ROUND_UP() instead.
    
    Signed-off-by: Daniel Mack <daniel@zonque.org>
    Signed-off-by: Robert Jarzmik <robert.jarzmik@free.fr>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a583ba7a4a196d437723d634ac4be8fab023cb88
Author: Casey Leedom <leedom@chelsio.com>
Date:   Sat Jul 7 12:38:07 2018 +0530

    cxgb4: assume flash part size to be 4MB, if it can't be determined
    
    [ Upstream commit 843789f6dd6ae1651a77ac99c13bcaf191ebe05c ]
    
    t4_get_flash_params() fails in a fatal fashion if the FLASH part isn't
    one of the recognized parts. But this leads to desperate efforts to update
    drivers when various FLASH parts which we are using suddenly become
    unavailable and we need to substitute new FLASH parts.  This has lead to
    more than one Customer Field Emergency when a Customer has an old driver
    and suddenly can't use newly shipped adapters.
    
    This commit fixes this by simply assuming that the FLASH part is 4MB in
    size if it can't be identified. Note that all Chelsio adapters will have
    flash parts which are at least 4MB in size.
    
    Signed-off-by: Casey Leedom <leedom@chelsio.com>
    Signed-off-by: Ganesh Goudar <ganeshgr@chelsio.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 91df8f524275477b0212f6ea539cd2aba9695f31
Author: Jon Maloy <jon.maloy@ericsson.com>
Date:   Fri Jul 6 20:10:06 2018 +0200

    tipc: make function tipc_net_finalize() thread safe
    
    [ Upstream commit 9faa89d4ed9d7d326f4763d262842270450f9b1f ]
    
    The setting of the node address is not thread safe, meaning that
    two discoverers may decide to set it simultanously, with a duplicate
    entry in the name table as result. We fix that with this commit.
    
    Fixes: 25b0b9c4e835 ("tipc: handle collisions of 32-bit node address hash values")
    Signed-off-by: Jon Maloy <jon.maloy@ericsson.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a4100054e307ad6aae0ed4c46262d059a7239e4a
Author: Jon Maloy <jon.maloy@ericsson.com>
Date:   Fri Jul 6 20:10:05 2018 +0200

    tipc: fix correct setting of message type in second discoverer
    
    [ Upstream commit 92018c7ca959ccd346d6235dac03cf7fc1ba51f7 ]
    
    The duplicate address discovery protocol is not safe against two
    discoverers running in parallel. The one executing first after the
    trial period is over will set the node address and change its own
    message type to DSC_REQ_MSG. The one executing last may find that the
    node address is already set, and never change message type, with the
    result that its links may never be established.
    
    In this commmit we ensure that the message type always is set correctly
    after the trial period is over.
    
    Fixes: 25b0b9c4e835 ("tipc: handle collisions of 32-bit node address hash values")
    Signed-off-by: Jon Maloy <jon.maloy@ericsson.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 871d366d7ad327e83538655a46bee1b5f4a4c1c3
Author: Jon Maloy <jon.maloy@ericsson.com>
Date:   Fri Jul 6 20:10:04 2018 +0200

    tipc: correct discovery message handling during address trial period
    
    [ Upstream commit e415577f57f4452150642500364cbe5fa6112813 ]
    
    With the duplicate address discovery protocol for tipc nodes addresses
    we introduced a one second trial period before a node is allocated a
    hash number to use as address.
    
    Unfortunately, we miss to handle the case when a regular LINK REQUEST/
    RESPONSE arrives from a cluster node during the trial period. Such
    messages are not ignored as they should be, leading to links setup
    attempts while the node still has no address.
    
    Fixes: 25b0b9c4e835 ("tipc: handle collisions of 32-bit node address hash values")
    Signed-off-by: Jon Maloy <jon.maloy@ericsson.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit aa01f1bfd6e05b81b21ebf08032e7d5cb7391a9a
Author: Jon Maloy <jon.maloy@ericsson.com>
Date:   Fri Jul 6 20:10:03 2018 +0200

    tipc: fix wrong return value from function tipc_node_try_addr()
    
    [ Upstream commit 2a57f182420174c7fd4b19db979a2d135231a963 ]
    
    The function for checking if there is an node address conflict is
    supposed to return a suggestion for a new address if it finds a
    conflict, and zero otherwise. But in case the peer being checked
    is previously unknown it does instead return a "suggestion" for
    the checked address itself. This results in a DSC_TRIAL_FAIL_MSG
    being sent unecessarily to the peer, and sometimes makes the trial
    period starting over again.
    
    Fixes: 25b0b9c4e835 ("tipc: handle collisions of 32-bit node address hash values")
    Signed-off-by: Jon Maloy <jon.maloy@ericsson.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8be88764331d8f033d79d1ccc8816f57e0e61749
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Wed Jul 4 11:14:51 2018 +0300

    ravb: fix invalid context bug while changing link options by ethtool
    
    [ Upstream commit 05925e52a7d379192a5fdff2c33710f573190ead ]
    
    The change fixes sleep in atomic context bug, which is encountered
    every time when link settings are changed by ethtool.
    
    Since commit 35b5f6b1a82b ("PHYLIB: Locking fixes for PHY I/O
    potentially sleeping") phy_start_aneg() function utilizes a mutex
    to serialize changes to phy state, however that helper function is
    called in atomic context under a grabbed spinlock, because
    phy_start_aneg() is called by phy_ethtool_ksettings_set() and by
    replaced phy_ethtool_sset() helpers from phylib.
    
    Now duplex mode setting is enforced in ravb_adjust_link() only, also
    now RX/TX is disabled when link is put down or modifications to E-MAC
    registers ECMR and GECMR are expected for both cases of checked and
    ignored link status pin state from E-MAC interrupt handler.
    
    Fixes: c156633f1353 ("Renesas Ethernet AVB driver proper")
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Reviewed-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 43fdde50228a3a4b7bfd25e65e6dcf891ef5f29d
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Wed Jul 4 11:14:50 2018 +0300

    ravb: fix invalid context bug while calling auto-negotiation by ethtool
    
    [ Upstream commit 0973a4dd79fe56a3beecfcff675ba4c01df0b0c1 ]
    
    Since commit 35b5f6b1a82b ("PHYLIB: Locking fixes for PHY I/O
    potentially sleeping") phy_start_aneg() function utilizes a mutex
    to serialize changes to phy state, however the helper function is
    called in atomic context.
    
    The bug can be reproduced by running "ethtool -r" command, the bug
    is reported if CONFIG_DEBUG_ATOMIC_SLEEP build option is enabled.
    
    Fixes: c156633f1353 ("Renesas Ethernet AVB driver proper")
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Reviewed-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6032d5492ed995960273d8889b2901700b0beec1
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Wed Jul 4 11:12:40 2018 +0300

    sh_eth: fix invalid context bug while changing link options by ethtool
    
    [ Upstream commit 5cb3f52a11e18628fc4bee76dd14b1f0b76349de ]
    
    The change fixes sleep in atomic context bug, which is encountered
    every time when link settings are changed by ethtool.
    
    Since commit 35b5f6b1a82b ("PHYLIB: Locking fixes for PHY I/O
    potentially sleeping") phy_start_aneg() function utilizes a mutex
    to serialize changes to phy state, however that helper function is
    called in atomic context under a grabbed spinlock, because
    phy_start_aneg() is called by phy_ethtool_ksettings_set() and by
    replaced phy_ethtool_sset() helpers from phylib.
    
    Now duplex mode setting is enforced in sh_eth_adjust_link() only,
    also now RX/TX is disabled when link is put down or modifications
    to E-MAC registers ECMR and GECMR are expected for both cases of
    checked and ignored link status pin state from E-MAC interrupt handler.
    
    For reference the change is a partial rework of commit 1e1b812bbe10
    ("sh_eth: fix handling of no LINK signal").
    
    Fixes: dc19e4e5e02f ("sh: sh_eth: Add support ethtool")
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Reviewed-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b41eb1109b40e7e46b0e1b1b6a9aefe2ec273115
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Wed Jul 4 11:12:39 2018 +0300

    sh_eth: fix invalid context bug while calling auto-negotiation by ethtool
    
    [ Upstream commit 53a710b5044d8475faa6813000b6dd659400ef7b ]
    
    Since commit 35b5f6b1a82b ("PHYLIB: Locking fixes for PHY I/O
    potentially sleeping") phy_start_aneg() function utilizes a mutex
    to serialize changes to phy state, however the helper function is
    called in atomic context.
    
    The bug can be reproduced by running "ethtool -r" command, the bug
    is reported if CONFIG_DEBUG_ATOMIC_SLEEP build option is enabled.
    
    Fixes: dc19e4e5e02f ("sh: sh_eth: Add support ethtool")
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Reviewed-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8e86a48a155dc10f1d0e2f380c3fb95ece184bbb
Author: Arun Kumar Neelakantam <aneela@codeaurora.org>
Date:   Wed Jul 4 19:49:33 2018 +0530

    net: qrtr: Reset the node and port ID of broadcast messages
    
    [ Upstream commit d27e77a3de2866b0a772803fd03cd667b5ff8a9a ]
    
    All the control messages broadcast to remote routers are using
    QRTR_NODE_BCAST instead of using local router NODE ID which cause
    the packets to be dropped on remote router due to invalid NODE ID.
    
    Signed-off-by: Arun Kumar Neelakantam <aneela@codeaurora.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 949389817946ee404da1372a22b09cdfb15c2086
Author: Arun Kumar Neelakantam <aneela@codeaurora.org>
Date:   Wed Jul 4 19:49:32 2018 +0530

    net: qrtr: Broadcast messages only from control port
    
    [ Upstream commit fdf5fd3975666804118e62c69de25dc85cc0909c ]
    
    The broadcast node id should only be sent with the control port id.
    
    Signed-off-by: Arun Kumar Neelakantam <aneela@codeaurora.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0aa16a963fbe1581d110f4e47e8ec9091bf104ee
Author: Paul Moore <paul@paul-moore.com>
Date:   Wed Jul 4 09:58:05 2018 -0400

    ipv6: make ipv6_renew_options() interrupt/kernel safe
    
    [ Upstream commit a9ba23d48dbc6ffd08426bb10f05720e0b9f5c14 ]
    
    At present the ipv6_renew_options_kern() function ends up calling into
    access_ok() which is problematic if done from inside an interrupt as
    access_ok() calls WARN_ON_IN_IRQ() on some (all?) architectures
    (x86-64 is affected).  Example warning/backtrace is shown below:
    
     WARNING: CPU: 1 PID: 3144 at lib/usercopy.c:11 _copy_from_user+0x85/0x90
     ...
     Call Trace:
      <IRQ>
      ipv6_renew_option+0xb2/0xf0
      ipv6_renew_options+0x26a/0x340
      ipv6_renew_options_kern+0x2c/0x40
      calipso_req_setattr+0x72/0xe0
      netlbl_req_setattr+0x126/0x1b0
      selinux_netlbl_inet_conn_request+0x80/0x100
      selinux_inet_conn_request+0x6d/0xb0
      security_inet_conn_request+0x32/0x50
      tcp_conn_request+0x35f/0xe00
      ? __lock_acquire+0x250/0x16c0
      ? selinux_socket_sock_rcv_skb+0x1ae/0x210
      ? tcp_rcv_state_process+0x289/0x106b
      tcp_rcv_state_process+0x289/0x106b
      ? tcp_v6_do_rcv+0x1a7/0x3c0
      tcp_v6_do_rcv+0x1a7/0x3c0
      tcp_v6_rcv+0xc82/0xcf0
      ip6_input_finish+0x10d/0x690
      ip6_input+0x45/0x1e0
      ? ip6_rcv_finish+0x1d0/0x1d0
      ipv6_rcv+0x32b/0x880
      ? ip6_make_skb+0x1e0/0x1e0
      __netif_receive_skb_core+0x6f2/0xdf0
      ? process_backlog+0x85/0x250
      ? process_backlog+0x85/0x250
      ? process_backlog+0xec/0x250
      process_backlog+0xec/0x250
      net_rx_action+0x153/0x480
      __do_softirq+0xd9/0x4f7
      do_softirq_own_stack+0x2a/0x40
      </IRQ>
      ...
    
    While not present in the backtrace, ipv6_renew_option() ends up calling
    access_ok() via the following chain:
    
      access_ok()
      _copy_from_user()
      copy_from_user()
      ipv6_renew_option()
    
    The fix presented in this patch is to perform the userspace copy
    earlier in the call chain such that it is only called when the option
    data is actually coming from userspace; that place is
    do_ipv6_setsockopt().  Not only does this solve the problem seen in
    the backtrace above, it also allows us to simplify the code quite a
    bit by removing ipv6_renew_options_kern() completely.  We also take
    this opportunity to cleanup ipv6_renew_options()/ipv6_renew_option()
    a small amount as well.
    
    This patch is heavily based on a rough patch by Al Viro.  I've taken
    his original patch, converted a kmemdup() call in do_ipv6_setsockopt()
    to a memdup_user() call, made better use of the e_inval jump target in
    the same function, and cleaned up the use ipv6_renew_option() by
    ipv6_renew_options().
    
    CC: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Paul Moore <paul@paul-moore.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 412a5ef3396406d1312d4494c7dffce9687f5259
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Wed Jul 4 12:52:36 2018 +0300

    qed: off by one in qed_parse_mcp_trace_buf()
    
    [ Upstream commit 0df8adbb88db8283f102a2afa91610a502245cb2 ]
    
    If format_idx == s_mcp_trace_meta.formats_num then we read one element
    beyond the end of the s_mcp_trace_meta.formats[] array.
    
    Fixes: 50bc60cb155c ("qed*: Utilize FW 8.33.11.0")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Acked-by: Tomer Tayar <Tomer.Tayar@cavium.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8ce651857bd71601f0bbe46c0179678613e60729
Author: Florian Westphal <fw@strlen.de>
Date:   Wed Jul 4 20:25:32 2018 +0200

    netfilter: x_tables: set module owner for icmp(6) matches
    
    [ Upstream commit d376bef9c29b3c65aeee4e785fffcd97ef0a9a81 ]
    
    nft_compat relies on xt_request_find_match to increment
    refcount of the module that provides the match/target.
    
    The (builtin) icmp matches did't set the module owner so it
    was possible to rmmod ip(6)tables while icmp extensions were still in use.
    
    Signed-off-by: Florian Westphal <fw@strlen.de>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cc31c36e86863c4bd2086bfcf5d56aecaa208c22
Author: Lubomir Rintel <lkundrak@v3.sk>
Date:   Mon Jul 2 11:21:47 2018 +0200

    ieee802154: 6lowpan: set IFLA_LINK
    
    [ Upstream commit b30c122c0bbb0a1dc413085e177ea09467e65fdb ]
    
    Otherwise NetworkManager (and iproute alike) is not able to identify the
    parent IEEE 802.15.4 interface of a 6LoWPAN link.
    
    Signed-off-by: Lubomir Rintel <lkundrak@v3.sk>
    Acked-by: Alexander Aring <aring@mojatatu.com>
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a0b1a7b831ca919f758c118e7aecb0b99344ae18
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Wed May 30 23:47:09 2018 +0200

    ieee802154: mcr20a: add missing includes
    
    [ Upstream commit a6032120d341badd9b034cb64411e7089d8f4285 ]
    
    Without CONFIG_GPIOLIB, some headers are not included implicitly,
    leading to a build failure:
    
    drivers/net/ieee802154/mcr20a.c: In function 'mcr20a_probe':
    drivers/net/ieee802154/mcr20a.c:1347:13: error: implicit declaration of function 'irq_get_trigger_type'; did you mean 'irq_get_irqchip_state'? [-Werror=implicit-function-declaration]
    
    This includes gpio/consumer.h and irq.h directly rather through the
    gpiolib header.
    
    Fixes: 8c6ad9cc5157 ("ieee802154: Add NXP MCR20A IEEE 802.15.4 transceiver driver")
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Acked-by: Xue Liu <liuxuenetmail@gmail.com>
    Signed-off-by: Stefan Schmidt <stefan@datenfreihafen.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4c6477eb7bcd2916fde07f36119edb6e73ed893d
Author: Taeung Song <treeze.taeung@gmail.com>
Date:   Wed Jul 4 22:36:38 2018 +0900

    samples/bpf: Check the error of write() and read()
    
    [ Upstream commit 02a2f000a3629274bfad60bfc4de9edec49e63e7 ]
    
    test_task_rename() and test_urandom_read()
    can be failed during write() and read(),
    So check the result of them.
    
    Reviewed-by: David Laight <David.Laight@ACULAB.COM>
    Signed-off-by: Taeung Song <treeze.taeung@gmail.com>
    Acked-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2c8f70b90aaa024d2d07c15a2ec1c11af97194a1
Author: Taeung Song <treeze.taeung@gmail.com>
Date:   Wed Jul 4 22:36:37 2018 +0900

    samples/bpf: Check the result of system()
    
    [ Upstream commit 492b7e894587c151be681f86d4d1d086375f7b45 ]
    
    To avoid the below build warning message,
    use new generate_load() checking the return value.
    
      ignoring return value of âsystemâ, declared with attribute warn_unused_result
    
    And it also refactors the duplicate code of both
    test_perf_event_all_cpu() and test_perf_event_task()
    
    Cc: Teng Qin <qinteng@fb.com>
    Signed-off-by: Taeung Song <treeze.taeung@gmail.com>
    Acked-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 94ffaf9ecd61372460b16da72d22c40928988248
Author: Taeung Song <treeze.taeung@gmail.com>
Date:   Wed Jul 4 22:36:36 2018 +0900

    samples/bpf: add missing <linux/if_vlan.h>
    
    [ Upstream commit 4d5d33a085335ef469c9a87792bcaaaa8e64d8c4 ]
    
    This fixes build error regarding redefinition:
    
        CLANG-bpf  samples/bpf/parse_varlen.o
      samples/bpf/parse_varlen.c:111:8: error: redefinition of 'vlan_hdr'
      struct vlan_hdr {
             ^
      ./include/linux/if_vlan.h:38:8: note: previous definition is here
    
    So remove duplicate 'struct vlan_hdr' in sample code and include if_vlan.h
    
    Signed-off-by: Taeung Song <treeze.taeung@gmail.com>
    Acked-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5d17abbf8ad9a4da0fe194f11790b64b295b23e6
Author: Jim Wilson <jimw@sifive.com>
Date:   Mon Jun 11 14:48:22 2018 -0700

    RISC-V: Fix PTRACE_SETREGSET bug.
    
    [ Upstream commit 1db9b80980d26fe95c942e0bb8bde2ca715029ad ]
    
    In riscv_gpr_set, pass regs instead of &regs to user_regset_copyin to fix
    gdb segfault.
    
    Signed-off-by: Jim Wilson <jimw@sifive.com>
    Signed-off-by: Palmer Dabbelt <palmer@sifive.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 60f50e90b6afbefbb65886df4ce713af41fe348c
Author: Palmer Dabbelt <palmer@sifive.com>
Date:   Fri Jun 22 15:46:28 2018 -0700

    RISC-V: Don't include irq-riscv-intc.h
    
    [ Upstream commit 8606544890d7dc4f7a740963f70dc1e1d54f8e30 ]
    
    This file has never existed in the upstream kernel, but it's guarded by
    an #ifdef that's also never existed in the upstream kernel.  As a part
    of our interrupt controller refactoring this header is no longer
    necessary, but this reference managed to sneak in anyway.
    
    Signed-off-by: Palmer Dabbelt <palmer@sifive.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c488c3eabe9d6f9b2b705f8a68ba395b0eaea132
Author: Andreas Schwab <schwab@suse.de>
Date:   Tue Jun 12 19:26:36 2018 +0200

    RISC-V: fix R_RISCV_ADD32/R_RISCV_SUB32 relocations
    
    [ Upstream commit 781c8fe2da3d2c7c95cd7ffddbab63b80a79da4d ]
    
    The R_RISCV_ADD32/R_RISCV_SUB32 relocations should add/subtract the
    address of the symbol (without overflow check), not its contents.
    
    Signed-off-by: Andreas Schwab <schwab@suse.de>
    Signed-off-by: Palmer Dabbelt <palmer@sifive.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 19c99f6cc06f42d16a137792fd04d37d65e6708e
Author: Maciej Purski <m.purski@samsung.com>
Date:   Thu Jun 28 18:44:02 2018 +0200

    drm/bridge/sii8620: Fix display of packed pixel modes
    
    [ Upstream commit fdddc65ab35d575b42aab411b2dc687601eab680 ]
    
    Current implementation does not guarantee packed pixel modes working
    with every dongle. There are some dongles, which require selecting
    the output mode explicitly.
    
    Write proper values to registers in packed_pixel mode, based on how it
    is done in vendor's code. Select output color space: RGB
    (no packed pixel) or YCBCR422 (packed pixel).
    
    This reverts commit e8b92efa629dac0e70ea4145c5e70616de5f89c8
    ("drm/bridge/sii8620: fix display of packed pixel modes in MHL2").
    
    Signed-off-by: Maciej Purski <m.purski@samsung.com>
    Signed-off-by: Andrzej Hajda <a.hajda@samsung.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/1530204243-6370-3-git-send-email-m.purski@samsung.com
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b7a463aac23a07a01ac605106437afca0638f615
Author: Yuiko Oshino <yuiko.oshino@microchip.com>
Date:   Tue Jul 3 11:21:46 2018 -0400

    smsc75xx: Add workaround for gigabit link up hardware errata.
    
    [ Upstream commit d461e3da905332189aad546b2ad9adbe6071c7cc ]
    
    In certain conditions, the device may not be able to link in gigabit mode. This software workaround ensures that the device will not enter the failure state.
    
    Fixes: d0cad871703b898a442e4049c532ec39168e5b57 ("SMSC75XX USB 2.0 Gigabit Ethernet Devices")
    Signed-off-by: Yuiko Oshino <yuiko.oshino@microchip.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7702b2503ef6d3c4de999a18efaaf466161b30bd
Author: Wang Dongsheng <dongsheng.wang@hxt-semitech.com>
Date:   Sun Jul 1 23:15:46 2018 -0700

    net: phy: marvell: change default m88e1510 LED configuration
    
    [ Upstream commit 077772468ec141b22e1e7c0c58bc09e2f9dc8762 ]
    
    The m88e1121 LED default configuration does not apply m88e151x.
    So add a function to relpace m88e1121 LED configuration.
    
    Signed-off-by: Wang Dongsheng <dongsheng.wang@hxt-semitech.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2014bb5b41f17a8dc1c5cd55ed0a5e1832a4b7f7
Author: Zhen Lei <thunder.leizhen@huawei.com>
Date:   Tue Jul 3 17:02:46 2018 -0700

    kasan: fix shadow_size calculation error in kasan_module_alloc
    
    [ Upstream commit 1e8e18f694a52d703665012ca486826f64bac29d ]
    
    There is a special case that the size is "(N << KASAN_SHADOW_SCALE_SHIFT)
    Pages plus X", the value of X is [1, KASAN_SHADOW_SCALE_SIZE-1].  The
    operation "size >> KASAN_SHADOW_SCALE_SHIFT" will drop X, and the
    roundup operation can not retrieve the missed one page.  For example:
    size=0x28006, PAGE_SIZE=0x1000, KASAN_SHADOW_SCALE_SHIFT=3, we will get
    shadow_size=0x5000, but actually we need 6 pages.
    
      shadow_size = round_up(size >> KASAN_SHADOW_SCALE_SHIFT, PAGE_SIZE);
    
    This can lead to a kernel crash when kasan is enabled and the value of
    mod->core_layout.size or mod->init_layout.size is like above.  Because
    the shadow memory of X has not been allocated and mapped.
    
    move_module:
      ptr = module_alloc(mod->core_layout.size);
      ...
      memset(ptr, 0, mod->core_layout.size);                //crashed
    
      Unable to handle kernel paging request at virtual address ffff0fffff97b000
      ......
      Call trace:
        __asan_storeN+0x174/0x1a8
        memset+0x24/0x48
        layout_and_allocate+0xcd8/0x1800
        load_module+0x190/0x23e8
        SyS_finit_module+0x148/0x180
    
    Link: http://lkml.kernel.org/r/1529659626-12660-1-git-send-email-thunder.leizhen@huawei.com
    Signed-off-by: Zhen Lei <thunder.leizhen@huawei.com>
    Reviewed-by: Dmitriy Vyukov <dvyukov@google.com>
    Acked-by: Andrey Ryabinin <aryabinin@virtuozzo.com>
    Cc: Alexander Potapenko <glider@google.com>
    Cc: Hanjun Guo <guohanjun@huawei.com>
    Cc: Libin <huawei.libin@huawei.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 25b98023d73c4dcc08d57260ddb7334a9ae9fa16
Author: Mathieu Malaterre <malat@debian.org>
Date:   Thu Mar 8 21:58:43 2018 +0100

    tracing: Use __printf markup to silence compiler
    
    [ Upstream commit 26b68dd2f48fe7699a89f0cfbb9f4a650dc1c837 ]
    
    Silence warnings (triggered at W=1) by adding relevant __printf attributes.
    
      CC      kernel/trace/trace.o
    kernel/trace/trace.c: In function â__trace_array_vprintkâ:
    kernel/trace/trace.c:2979:2: warning: function might be possible candidate for âgnu_printfâ format attribute [-Wsuggest-attribute=format]
      len = vscnprintf(tbuffer, TRACE_BUF_SIZE, fmt, args);
      ^~~
      AR      kernel/trace/built-in.o
    
    Link: http://lkml.kernel.org/r/20180308205843.27447-1-malat@debian.org
    
    Signed-off-by: Mathieu Malaterre <malat@debian.org>
    Signed-off-by: Steven Rostedt (VMware) <rostedt@goodmis.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ba80c24ebc85ced0d9efe83b73651558f67bce56
Author: Mauricio Vasquez B <mauricio.vasquez@polito.it>
Date:   Fri Jun 29 14:48:20 2018 +0200

    bpf: hash map: decrement counter on error
    
    [ Upstream commit ed2b82c03dc187018307c7c6bf9299705f3db383 ]
    
    Decrement the number of elements in the map in case the allocation
    of a new node fails.
    
    Fixes: 6c9059817432 ("bpf: pre-allocate hash map elements")
    Signed-off-by: Mauricio Vasquez B <mauricio.vasquez@polito.it>
    Acked-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4e956777f974ae60b6c9d588b813205a3c154da9
Author: Heiner Kallweit <hkallweit1@gmail.com>
Date:   Mon Jul 2 22:49:35 2018 +0200

    r8169: fix mac address change
    
    [ Upstream commit 2d0ec5440bef4a0a8858d52d45c31725540c3e74 ]
    
    Network core refuses to change mac address because flag
    IFF_LIVE_ADDR_CHANGE isn't set. Set this missing flag.
    
    Fixes: 1f7aa2bc268e ("r8169: simplify rtl_set_mac_address")
    Reported-by: Corinna Vinschen <vinschen@redhat.com>
    Signed-off-by: Heiner Kallweit <hkallweit1@gmail.com>
    Tested-by: Corinna Vinschen <vinschen@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3634c1433bbcc929dc054a86798296f0e937fe53
Author: Doron Roberts-Kedes <doronrk@fb.com>
Date:   Mon Jul 2 10:25:05 2018 -0700

    tls: fix skb_to_sgvec returning unhandled error.
    
    [ Upstream commit 52ee6ef36ee10dd493cf2067311e56ca8015eb8d ]
    
    The current code does not inspect the return value of skb_to_sgvec. This
    can cause a nullptr kernel panic when the malformed sgvec is passed into
    the crypto request.
    
    Checking the return value of skb_to_sgvec and skipping decryption if it
    is negative fixes this problem.
    
    Fixes: c46234ebb4d1 ("tls: RX path for ktls")
    Acked-by: Dave Watson <davejwatson@fb.com>
    Signed-off-by: Doron Roberts-Kedes <doronrk@fb.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 124c9bc9ba3ea224f056988267cde3c9676318bf
Author: Fabio Estevam <fabio.estevam@nxp.com>
Date:   Tue Jun 26 08:37:09 2018 -0300

    ARM: imx_v4_v5_defconfig: Select ULPI support
    
    [ Upstream commit 2ceb2780b790b74bc408a949f6aedbad8afa693e ]
    
    Select CONFIG_USB_CHIPIDEA_ULPI and CONFIG_USB_ULPI_BUS so that
    USB ULPI can be functional on some boards like that use ULPI
    interface.
    
    Signed-off-by: Fabio Estevam <fabio.estevam@nxp.com>
    Signed-off-by: Shawn Guo <shawnguo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit df06ca1f565077596512fa2ab91df502e48e4f00
Author: Fabio Estevam <fabio.estevam@nxp.com>
Date:   Mon Jun 25 09:34:03 2018 -0300

    ARM: imx_v6_v7_defconfig: Select ULPI support
    
    [ Upstream commit 157bcc06094c3c5800d3f4676527047b79b618e7 ]
    
    Select CONFIG_USB_CHIPIDEA_ULPI and CONFIG_USB_ULPI_BUS so that
    USB ULPI can be functional on some boards like imx51-babbge.
    
    This fixes a kernel hang in 4.18-rc1 on i.mx51-babbage, caused by commit
    03e6275ae381 ("usb: chipidea: Fix ULPI on imx51").
    
    Suggested-by: Andrey Smirnov <andrew.smirnov@gmail.com>
    Signed-off-by: Fabio Estevam <fabio.estevam@nxp.com>
    Signed-off-by: Shawn Guo <shawnguo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit eb702bcd8231984e05af1f89198beba783befcb6
Author: Jason Gerecke <killertofu@gmail.com>
Date:   Tue Jun 26 09:58:02 2018 -0700

    HID: wacom: Correct touch maximum XY of 2nd-gen Intuos
    
    [ Upstream commit 3b8d573586d1b9dee33edf6cb6f2ca05f4bca568 ]
    
    The touch sensors on the 2nd-gen Intuos tablets don't use a 4096x4096
    sensor like other similar tablets (3rd-gen Bamboo, Intuos5, etc.).
    The incorrect maximum XY values don't normally affect userspace since
    touch input from these devices is typically relative rather than
    absolute. It does, however, cause problems when absolute distances
    need to be measured, e.g. for gesture recognition. Since the resolution
    of the touch sensor on these devices is 10 units / mm (versus 100 for
    the pen sensor), the proper maximum values can be calculated by simply
    dividing by 10.
    
    Fixes: b5fd2a3e92 ("Input: wacom - add support for three new Intuos devices")
    Signed-off-by: Jason Gerecke <jason.gerecke@wacom.com>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 446137c3be0bc8b6b61c3baf79072a57baf4bc58
Author: Zhenzhong Duan <zhenzhong.duan@oracle.com>
Date:   Mon Jul 2 23:49:54 2018 -0700

    x86/mm/32: Initialize the CR4 shadow before __flush_tlb_all()
    
    [ Upstream commit 4fb5f58e8d191f7c81637ad81284e4848afb4244 ]
    
    On 32-bit kernels, __flush_tlb_all() may have read the CR4 shadow before the
    initialization of CR4 shadow in cpu_init().
    
    Fix it by adding an explicit cr4_init_shadow() call into start_secondary()
    which is the first function called on non-boot SMP CPUs - ahead of the
    __flush_tlb_all() call.
    
    ( This is somewhat of a layering violation, but start_secondary() does
      CR4 bootstrap in the PCID case anyway. )
    
    Signed-off-by: Zhenzhong Duan <zhenzhong.duan@oracle.com>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: "H. Peter Anvin" <hpa@zytor.com>
    Link: http://lkml.kernel.org/r/b07b6ae9-4b57-4b40-b9bc-50c2c67f1d91@default
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2caa5529cb44baf69e766707e1d30482e47391a4
Author: Peter Zijlstra <peterz@infradead.org>
Date:   Thu Jun 7 11:45:49 2018 +0200

    kthread, sched/core: Fix kthread_parkme() (again...)
    
    [ Upstream commit 1cef1150ef40ec52f507436a14230cbc2623299c ]
    
    Gaurav reports that commit:
    
      85f1abe0019f ("kthread, sched/wait: Fix kthread_parkme() completion issue")
    
    isn't working for him. Because of the following race:
    
    > controller Thread                               CPUHP Thread
    > takedown_cpu
    > kthread_park
    > kthread_parkme
    > Set KTHREAD_SHOULD_PARK
    >                                                 smpboot_thread_fn
    >                                                 set Task interruptible
    >
    >
    > wake_up_process
    >  if (!(p->state & state))
    >                 goto out;
    >
    >                                                 Kthread_parkme
    >                                                 SET TASK_PARKED
    >                                                 schedule
    >                                                 raw_spin_lock(&rq->lock)
    > ttwu_remote
    > waiting for __task_rq_lock
    >                                                 context_switch
    >
    >                                                 finish_lock_switch
    >
    >
    >
    >                                                 Case TASK_PARKED
    >                                                 kthread_park_complete
    >
    >
    > SET Running
    
    Furthermore, Oleg noticed that the whole scheduler TASK_PARKED
    handling is buggered because the TASK_DEAD thing is done with
    preemption disabled, the current code can still complete early on
    preemption :/
    
    So basically revert that earlier fix and go with a variant of the
    alternative mentioned in the commit. Promote TASK_PARKED to special
    state to avoid the store-store issue on task->state leading to the
    WARN in kthread_unpark() -> __kthread_bind().
    
    But in addition, add wait_task_inactive() to kthread_park() to ensure
    the task really is PARKED when we return from kthread_park(). This
    avoids the whole kthread still gets migrated nonsense -- although it
    would be really good to get this done differently.
    
    Reported-by: Gaurav Kohli <gkohli@codeaurora.org>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Oleg Nesterov <oleg@redhat.com>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Fixes: 85f1abe0019f ("kthread, sched/wait: Fix kthread_parkme() completion issue")
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d2bc46d5694003a0679a5a16f804d69853ce3736
Author: Vincent Guittot <vincent.guittot@linaro.org>
Date:   Thu Jun 14 12:33:00 2018 +0200

    sched/util_est: Fix util_est_dequeue() for throttled cfs_rq
    
    [ Upstream commit 3482d98bbc730758b63a5d1cf41d05ea17481412 ]
    
    When a cfs_rq is throttled, parent cfs_rq->nr_running is decreased and
    everything happens at cfs_rq level. Currently util_est stays unchanged
    in such case and it keeps accounting the utilization of throttled tasks.
    This can somewhat make sense as we don't dequeue tasks but only throttled
    cfs_rq.
    
    If a task of another group is enqueued/dequeued and root cfs_rq becomes
    idle during the dequeue, util_est will be cleared whereas it was
    accounting util_est of throttled tasks before. So the behavior of util_est
    is not always the same regarding throttled tasks and depends of side
    activity. Furthermore, util_est will not be updated when the cfs_rq is
    unthrottled as everything happens at cfs_rq level. Main results is that
    util_est will stay null whereas we now have running tasks. We have to wait
    for the next dequeue/enqueue of the previously throttled tasks to get an
    up to date util_est.
    
    Remove the assumption that cfs_rq's estimated utilization of a CPU is 0
    if there is no running task so the util_est of a task remains until the
    latter is dequeued even if its cfs_rq has been throttled.
    
    Signed-off-by: Vincent Guittot <vincent.guittot@linaro.org>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Reviewed-by: Patrick Bellasi <patrick.bellasi@arm.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Fixes: 7f65ea42eb00 ("sched/fair: Add util_est on top of PELT")
    Link: http://lkml.kernel.org/r/1528972380-16268-1-git-send-email-vincent.guittot@linaro.org
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 431ad472e09f9e6c850652eb14c712bf420a8089
Author: Xunlei Pang <xlpang@linux.alibaba.com>
Date:   Wed Jun 20 18:18:33 2018 +0800

    sched/fair: Fix bandwidth timer clock drift condition
    
    [ Upstream commit 512ac999d2755d2b7109e996a76b6fb8b888631d ]
    
    I noticed that cgroup task groups constantly get throttled even
    if they have low CPU usage, this causes some jitters on the response
    time to some of our business containers when enabling CPU quotas.
    
    It's very simple to reproduce:
    
      mkdir /sys/fs/cgroup/cpu/test
      cd /sys/fs/cgroup/cpu/test
      echo 100000 > cpu.cfs_quota_us
      echo $$ > tasks
    
    then repeat:
    
      cat cpu.stat | grep nr_throttled  # nr_throttled will increase steadily
    
    After some analysis, we found that cfs_rq::runtime_remaining will
    be cleared by expire_cfs_rq_runtime() due to two equal but stale
    "cfs_{b|q}->runtime_expires" after period timer is re-armed.
    
    The current condition to judge clock drift in expire_cfs_rq_runtime()
    is wrong, the two runtime_expires are actually the same when clock
    drift happens, so this condtion can never hit. The orginal design was
    correctly done by this commit:
    
      a9cf55b28610 ("sched: Expire invalid runtime")
    
    ... but was changed to be the current implementation due to its locking bug.
    
    This patch introduces another way, it adds a new field in both structures
    cfs_rq and cfs_bandwidth to record the expiration update sequence, and
    uses them to figure out if clock drift happens (true if they are equal).
    
    Signed-off-by: Xunlei Pang <xlpang@linux.alibaba.com>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Reviewed-by: Ben Segall <bsegall@google.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Fixes: 51f2176d74ac ("sched/fair: Fix unlocked reads of some cfs_b->quota/period")
    Link: http://lkml.kernel.org/r/20180620101834.24455-1-xlpang@linux.alibaba.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d9cad981850cbd160f0392167d18ee5cd75df025
Author: Frederic Weisbecker <frederic@kernel.org>
Date:   Thu Jun 28 18:29:41 2018 +0200

    sched/nohz: Skip remote tick on idle task entirely
    
    [ Upstream commit d9c0ffcabd6aae7ff1e34e8078354c13bb9f1183 ]
    
    Some people have reported that the warning in sched_tick_remote()
    occasionally triggers, especially in favour of some RCU-Torture
    pressure:
    
            WARNING: CPU: 11 PID: 906 at kernel/sched/core.c:3138 sched_tick_remote+0xb6/0xc0
            Modules linked in:
            CPU: 11 PID: 906 Comm: kworker/u32:3 Not tainted 4.18.0-rc2+ #1
            Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.2-1 04/01/2014
            Workqueue: events_unbound sched_tick_remote
            RIP: 0010:sched_tick_remote+0xb6/0xc0
            Code: e8 0f 06 b8 00 c6 03 00 fb eb 9d 8b 43 04 85 c0 75 8d 48 8b 83 e0 0a 00 00 48 85 c0 75 81 eb 88 48 89 df e8 bc fe ff ff eb aa <0f> 0b eb
            +c5 66 0f 1f 44 00 00 bf 17 00 00 00 e8 b6 2e fe ff 0f b6
            Call Trace:
             process_one_work+0x1df/0x3b0
             worker_thread+0x44/0x3d0
             kthread+0xf3/0x130
             ? set_worker_desc+0xb0/0xb0
             ? kthread_create_worker_on_cpu+0x70/0x70
             ret_from_fork+0x35/0x40
    
    This happens when the remote tick applies on an idle task. Usually the
    idle_cpu() check avoids that, but it is performed before we lock the
    runqueue and it is therefore racy. It was intended to be that way in
    order to prevent from useless runqueue locks since idle task tick
    callback is a no-op.
    
    Now if the racy check slips out of our hands and we end up remotely
    ticking an idle task, the empty task_tick_idle() is harmless. Still
    it won't pass the WARN_ON_ONCE() test that ensures rq_clock_task() is
    not too far from curr->se.exec_start because update_curr_idle() doesn't
    update the exec_start value like other scheduler policies. Hence the
    reported false positive.
    
    So let's have another check, while the rq is locked, to make sure we
    don't remote tick on an idle task. The lockless idle_cpu() still applies
    to avoid unecessary rq lock contention.
    
    Reported-by: Jacek Tomaka <jacekt@dug.com>
    Reported-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
    Reported-by: Anna-Maria Gleixner <anna-maria@linutronix.de>
    Signed-off-by: Frederic Weisbecker <frederic@kernel.org>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Link: http://lkml.kernel.org/r/1530203381-31234-1-git-send-email-frederic@kernel.org
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d50a5781992f7c55e38ff0df19a1094d61b00bb7
Author: Greentime Hu <greentime@andestech.com>
Date:   Thu Jun 28 18:29:21 2018 +0800

    nds32: Fix the dts pointer is not passed correctly issue.
    
    [ Upstream commit 6897e6ecb3167598cb45e1a1424dd4d5e3778837 ]
    
    We found that the original implementation will only use the built-in dtb
    pointer instead of the pointer pass from bootloader. This bug is fixed
    by this patch.
    
    Signed-off-by: Greentime Hu <greentime@andestech.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 376fb2a02597c8ec64a5b0ef3402c8d5c3822249
Author: Alex Deucher <alexander.deucher@amd.com>
Date:   Thu Jun 28 12:38:53 2018 -0500

    drm/amdgpu: fix swapped emit_ib_size in vce3
    
    [ Upstream commit 0859df22ab7cfb3ad2df2caed76cadce6ac33a80 ]
    
    The phys and vm versions had the values swapped.
    
    Reviewed-by: Junwei Zhang <Jerry.Zhang@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit acf2b19c9b1ad2077f2160bbec6f65cdfd4ab81b
Author: Kai-Heng Feng <kai.heng.feng@canonical.com>
Date:   Mon Jul 2 17:13:31 2018 +0300

    usb: xhci: dbc: Don't decrement runtime PM counter if DBC is not started
    
    [ Upstream commit 74cb319bd97dd62881f97ea5a3228f7c2546bf56 ]
    
    pm_runtime_put_sync() gets called everytime in xhci_dbc_stop().
    
    If dbc is not started, this makes the runtime PM counter incorrectly
    becomes 0, and calls autosuspend function. Then we'll keep seeing this:
    [54664.762220] xhci_hcd 0000:00:14.0: Root hub is not suspended
    
    So only calls pm_runtime_put_sync() when dbc was started.
    
    Signed-off-by: Kai-Heng Feng <kai.heng.feng@canonical.com>
    Signed-off-by: Mathias Nyman <mathias.nyman@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3c59e14df04b8e32573ec2a955dd33f0593b0afd
Author: Hangbin Liu <liuhangbin@gmail.com>
Date:   Sun Jul 1 16:21:21 2018 +0800

    ipvlan: call dev_change_flags when ipvlan mode is reset
    
    [ Upstream commit 5dc2d3996a8b221c20dd0900bdad45031a572530 ]
    
    After we change the ipvlan mode from l3 to l2, or vice versa, we only
    reset IFF_NOARP flag, but don't flush the ARP table cache, which will
    cause eth->h_dest to be equal to eth->h_source in ipvlan_xmit_mode_l2().
    Then the message will not come out of host.
    
    Here is the reproducer on local host:
    
    ip link set eth1 up
    ip addr add 192.168.1.1/24 dev eth1
    ip link add link eth1 ipvlan1 type ipvlan mode l3
    
    ip netns add net1
    ip link set ipvlan1 netns net1
    ip netns exec net1 ip link set ipvlan1 up
    ip netns exec net1 ip addr add 192.168.2.1/24 dev ipvlan1
    
    ip route add 192.168.2.0/24 via 192.168.1.2
    ping 192.168.2.2 -c 2
    
    ip netns exec net1 ip link set ipvlan1 type ipvlan mode l2
    ping 192.168.2.2 -c 2
    
    Add the same configuration on remote host. After we set the mode to l2,
    we could find that the src/dst MAC addresses are the same on eth1:
    
    21:26:06.648565 00:b7:13:ad:d3:05 > 00:b7:13:ad:d3:05, ethertype IPv4 (0x0800), length 98: (tos 0x0, ttl 64, id 58356, offset 0, flags [DF], proto ICMP (1), length 84)
        192.168.2.1 > 192.168.2.2: ICMP echo request, id 22686, seq 1, length 64
    
    Fix this by calling dev_change_flags(), which will call netdevice notifier
    with flag change info.
    
    v2:
    a) As pointed out by Wang Cong, check return value for dev_change_flags() when
    change dev flags.
    b) As suggested by Stefano and Sabrina, move flags setting before l3mdev_ops.
    So we don't need to redo ipvlan_{, un}register_nf_hook() again in err path.
    
    Reported-by: Jianlin Shi <jishi@redhat.com>
    Reviewed-by: Stefano Brivio <sbrivio@redhat.com>
    Reviewed-by: Sabrina Dubroca <sd@queasysnail.net>
    Fixes: 2ad7bf3638411 ("ipvlan: Initial check-in of the IPVLAN driver.")
    Signed-off-by: Hangbin Liu <liuhangbin@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4f11b1ba42f5c858de2cf3f3da50c88b8db68b2b
Author: Josh Poimboeuf <jpoimboe@redhat.com>
Date:   Wed Jun 27 17:03:45 2018 -0500

    objtool: Support GCC 8 '-fnoreorder-functions'
    
    [ Upstream commit 08b393d01c88aff27347ed2b1b354eb4db2f1532 ]
    
    Since the following commit:
    
      cd77849a69cf ("objtool: Fix GCC 8 cold subfunction detection for aliased functions")
    
    ... if the kernel is built with EXTRA_CFLAGS='-fno-reorder-functions',
    objtool can get stuck in an infinite loop.
    
    That flag causes the new GCC 8 cold subfunctions to be placed in .text
    instead of .text.unlikely.  But it also has an unfortunate quirk: in the
    symbol table, the subfunction (e.g., nmi_panic.cold.7) is nested inside
    the parent (nmi_panic).
    
    That function overlap confuses objtool, and causes it to get into an
    infinite loop in next_insn_same_func().  Here's Allan's description of
    the loop:
    
      "Objtool iterates through the instructions in nmi_panic using
      next_insn_same_func. Once it reaches the end of nmi_panic at 0x534 it
      jumps to 0x528 as that's the start of nmi_panic.cold.7. However, since
      the instructions starting at 0x528 are still associated with nmi_panic
      objtool will get stuck in a loop, continually jumping back to 0x528
      after reaching 0x534."
    
    Fix it by shortening the length of the parent function so that the
    functions no longer overlap.
    
    Reported-and-analyzed-by: Allan Xavier <allan.x.xavier@oracle.com>
    Signed-off-by: Josh Poimboeuf <jpoimboe@redhat.com>
    Cc: Allan Xavier <allan.x.xavier@oracle.com>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Brian Gerst <brgerst@gmail.com>
    Cc: Denys Vlasenko <dvlasenk@redhat.com>
    Cc: H. Peter Anvin <hpa@zytor.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Link: http://lkml.kernel.org/r/9e704c52bee651129b036be14feda317ae5606ae.1530136978.git.jpoimboe@redhat.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3c2db6eee9b3cb02fe0e5688d692af14f542c30a
Author: Greg Ungerer <gerg@linux-m68k.org>
Date:   Mon Jun 18 15:34:14 2018 +1000

    m68k: fix "bad page state" oops on ColdFire boot
    
    [ Upstream commit ecd60532e060e45c63c57ecf1c8549b1d656d34d ]
    
    Booting a ColdFire m68k core with MMU enabled causes a "bad page state"
    oops since commit 1d40a5ea01d5 ("mm: mark pages in use for page tables"):
    
     BUG: Bad page state in process sh  pfn:01ce2
     page:004fefc8 count:0 mapcount:-1024 mapping:00000000 index:0x0
     flags: 0x0()
     raw: 00000000 00000000 00000000 fffffbff 00000000 00000100 00000200 00000000
     raw: 039c4000
     page dumped because: nonzero mapcount
     Modules linked in:
     CPU: 0 PID: 22 Comm: sh Not tainted 4.17.0-07461-g1d40a5ea01d5 #13
    
    Fix by calling pgtable_page_dtor() in our __pte_free_tlb() code path,
    so that the PG_table flag is cleared before we free the pte page.
    
    Note that I had to change the type of pte_free() to be static from
    extern. Otherwise you get a lot of warnings like this:
    
    ./arch/m68k/include/asm/mcf_pgalloc.h:80:2: warning: âpgtable_page_dtorâ is static but used in inline function âpte_freeâ which is not static
      pgtable_page_dtor(page);
      ^
    
    And making it static is consistent with our use of this in the other
    m68k pgalloc definitions of pte_free().
    
    Signed-off-by: Greg Ungerer <gerg@linux-m68k.org>
    CC: Matthew Wilcox <willy@infradead.org>
    Reviewed-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c249545c78f7bfac36866f2cad4aecc0492b0794
Author: Eric Biggers <ebiggers@google.com>
Date:   Mon Jun 18 15:33:23 2018 -0700

    crypto: arm/speck - fix building in Thumb2 mode
    
    [ Upstream commit a068b94d74ddb7776ca707b6d39d1ac0d2d057e6 ]
    
    Building the kernel with CONFIG_THUMB2_KERNEL=y and
    CONFIG_CRYPTO_SPECK_NEON set fails with the following errors:
    
        arch/arm/crypto/speck-neon-core.S: Assembler messages:
    
        arch/arm/crypto/speck-neon-core.S:419: Error: r13 not allowed here -- `bic sp,#0xf'
        arch/arm/crypto/speck-neon-core.S:423: Error: r13 not allowed here -- `bic sp,#0xf'
        arch/arm/crypto/speck-neon-core.S:427: Error: r13 not allowed here -- `bic sp,#0xf'
        arch/arm/crypto/speck-neon-core.S:431: Error: r13 not allowed here -- `bic sp,#0xf'
    
    The problem is that the 'bic' instruction can't operate on the 'sp'
    register in Thumb2 mode.  Fix it by using a temporary register.  This
    isn't in the main loop, so the performance difference is negligible.
    This also matches what aes-neonbs-core.S does.
    
    Reported-by: Stefan Agner <stefan@agner.ch>
    Fixes: ede9622162fa ("crypto: arm/speck - add NEON-accelerated implementation of Speck-XTS")
    Signed-off-by: Eric Biggers <ebiggers@google.com>
    Acked-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
    Reviewed-by: Stefan Agner <stefan@agner.ch>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 514020001754ca645658e21173cbccfb62b53a44
Author: Stafford Horne <shorne@gmail.com>
Date:   Sun Jul 1 14:17:36 2018 +0900

    openrisc: entry: Fix delay slot exception detection
    
    [ Upstream commit ae15a41a641449f536578b0d9ec0e4ade130deb5 ]
    
    Originally in patch e6d20c55a4 ("openrisc: entry: Fix delay slot
    detection") I fixed delay slot detection, but only for QEMU.  We missed
    that hardware delay slot detection using delay slot exception flag (DSX)
    was still broken.  This was because QEMU set the DSX flag in both
    pre-exception supervision register (ESR) and supervision register (SR)
    register, but on real hardware the DSX flag is only set on the SR
    register during exceptions.
    
    Fix this by carrying the DSX flag into the SR register during exception.
    We also update the DSX flag read locations to read the value from the SR
    register not the pt_regs SR register which represents ESR.  The ESR
    should never have the DSX flag set.
    
    In the process I updated/removed a few comments to match the current
    state.  Including removing a comment saying that the DSX detection logic
    was inefficient and needed to be rewritten.
    
    I have tested this on QEMU with a patch ensuring it matches the hardware
    specification.
    
    Link: https://lists.gnu.org/archive/html/qemu-devel/2018-07/msg00000.html
    Fixes: e6d20c55a4 ("openrisc: entry: Fix delay slot detection")
    Signed-off-by: Stafford Horne <shorne@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b49ae220bfe7f45de76f71a98c15888240aeb5e2
Author: Vishal Verma <vishal.l.verma@intel.com>
Date:   Mon Jun 18 17:17:02 2018 -0600

    tools/testing/nvdimm: advertise a write cache for nfit_test
    
    [ Upstream commit 1273c253c32b9a073a4d8921ed079177ccc7c8af ]
    
    Commit 546eb0317cfa "libnvdimm, pmem: Do not flush power-fail protected CPU caches"
    fixed the write_cache detection to correctly show the lack of a write
    cache based on the platform capabilities described in the ACPI NFIT. The
    nfit_test unit tests expected a write cache to be present, so change the
    nfit test namespaces to only advertise a persistence domain limited to
    the memory controller. This allows the kernel to show a write_cache
    attribute, and the test behaviour remains unchanged.
    
    Signed-off-by: Vishal Verma <vishal.l.verma@intel.com>
    Reviewed-by: Ross Zwisler <ross.zwisler@linux.intel.com>
    Signed-off-by: Dan Williams <dan.j.williams@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3a17b2c1170c150b6c1f71feca530c8b263bc001
Author: Dave Jiang <dave.jiang@intel.com>
Date:   Thu Jun 28 09:56:55 2018 -0700

    acpi/nfit: fix cmd_rc for acpi_nfit_ctl to always return a value
    
    [ Upstream commit c1985cefd844e26bd19673a6df8d8f0b1918c2db ]
    
    cmd_rc is passed in by reference to the acpi_nfit_ctl() function and the
    caller expects a value returned. However, when the package is pass through
    via the ND_CMD_CALL command, cmd_rc is not touched. Make sure cmd_rc is
    always set.
    
    Fixes: aef253382266 ("libnvdimm, nfit: centralize command status translation")
    
    Signed-off-by: Dave Jiang <dave.jiang@intel.com>
    Signed-off-by: Dan Williams <dan.j.williams@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d0d88b5909c71edec41cf75744b10758584899dd
Author: Julian Wiedmann <jwi@linux.ibm.com>
Date:   Fri Jun 29 19:45:54 2018 +0200

    s390/qeth: consistently re-enable device features
    
    [ Upstream commit d025da9eb1e48d3e5f2a2ff13ac5ac536ba4be43 ]
    
    commit e830baa9c3f0 ("qeth: restore device features after recovery") and
    commit ce3443564145 ("s390/qeth: rely on kernel for feature recovery")
    made sure that the HW functions for device features get re-programmed
    after recovery.
    
    But we missed that the same handling is also required when a card is
    first set offline (destroying all HW context), and then online again.
    Fix this by moving the re-enable action out of the recovery-only path.
    
    Signed-off-by: Julian Wiedmann <jwi@linux.ibm.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0e22aac15e6946eaecf1df8410d177d06e6fb6d8
Author: Madalin Bucur <madalin.bucur@nxp.com>
Date:   Thu Jun 28 15:26:51 2018 +0300

    dpaa_eth: DPAA SGT needs to be 256B
    
    [ Upstream commit 595e802e53f24642a145cf7f3e4ac9afab4c21ec ]
    
    The DPAA HW requires that at least 256 bytes from the start of the
    first scatter-gather table entry are allocated and accessible. The
    hardware reads the maximum size the table can have in one access,
    thus requiring that the allocation and mapping to be done for the
    maximum size of 256B even if there is a smaller number of entries
    in the table.
    
    Signed-off-by: Madalin Bucur <madalin.bucur@nxp.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ad71bb95651368a945b4d185cb11c6e692544d51
Author: Madalin Bucur <madalin.bucur@nxp.com>
Date:   Thu Jun 28 15:26:50 2018 +0300

    fsl/fman: fix parser reporting bad checksum on short frames
    
    [ Upstream commit b95f6fbc8e15803a596ca5e5e21008fba29694c6 ]
    
    The FMan hardware parser needs to be configured to remove the
    short frame padding from the checksum calculation, otherwise
    short UDP and TCP frames are likely to be marked as having a
    bad checksum.
    
    Signed-off-by: Madalin Bucur <madalin.bucur@nxp.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1bba5adf015d4089563a61336afa4641925b1a2b
Author: Sudarsana Reddy Kalluru <sudarsana.kalluru@cavium.com>
Date:   Thu Jun 28 04:52:15 2018 -0700

    bnx2x: Fix receiving tx-timeout in error or recovery state.
    
    [ Upstream commit 484c016d9392786ce5c74017c206c706f29f823d ]
    
    Driver performs the internal reload when it receives tx-timeout event from
    the OS. Internal reload might fail in some scenarios e.g., fatal HW issues.
    In such cases OS still see the link, which would result in undesirable
    functionalities such as re-generation of tx-timeouts.
    The patch addresses this issue by indicating the link-down to OS when
    tx-timeout is detected, and keeping the link in down state till the
    internal reload is successful.
    
    Please consider applying it to 'net' branch.
    
    Signed-off-by: Sudarsana Reddy Kalluru <Sudarsana.Kalluru@cavium.com>
    Signed-off-by: Ariel Elior <ariel.elior@cavium.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6ba78341dbb08f730f3725ab76c28ecaed22b2fd
Author: Nicholas Mc Guire <hofrat@osadl.org>
Date:   Fri Jun 29 13:50:27 2018 -0500

    PCI: faraday: Add missing of_node_put()
    
    [ Upstream commit 3dc6ddfedc2818eaaa36842fbb049191e0c5e50f ]
    
    The call to of_get_next_child() returns a node pointer with refcount
    incremented thus it must be explicitly decremented here in the error
    path and after the last usage.
    
    Fixes: d3c68e0a7e34 ("PCI: faraday: Add Faraday Technology FTPCI100 PCI Host Bridge driver")
    Signed-off-by: Nicholas Mc Guire <hofrat@osadl.org>
    [lorenzo.pieralisi@arm.com: updated commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Reviewed-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 46a5ff9d7aeb5359f982bf6e84d9127c4f983309
Author: Nicholas Mc Guire <hofrat@osadl.org>
Date:   Fri Jun 29 13:50:10 2018 -0500

    PCI: xilinx-nwl: Add missing of_node_put()
    
    [ Upstream commit 342639d996f18bc0a4db2f42a84230c0a966dc94 ]
    
    The call to of_get_next_child() returns a node pointer with
    refcount incremented thus it must be explicitly decremented
    here after the last usage.
    
    Fixes: ab597d35ef11 ("PCI: xilinx-nwl: Add support for Xilinx NWL PCIe Host Controller")
    Signed-off-by: Nicholas Mc Guire <hofrat@osadl.org>
    [lorenzo.pieralisi@arm.com: updated commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1c18c4174c8e54d96953034f779485157543c699
Author: Nicholas Mc Guire <hofrat@osadl.org>
Date:   Fri Jun 29 13:49:54 2018 -0500

    PCI: xilinx: Add missing of_node_put()
    
    [ Upstream commit 8c3f9bd851a4d3acf0a0f222d4e9e41c0cd1ea8e ]
    
    The call to of_get_next_child() returns a node pointer with refcount
    incremented thus it must be explicitly decremented here after the last
    usage.
    
    Fixes: 8961def56845 ("PCI: xilinx: Add Xilinx AXI PCIe Host Bridge IP driver")
    Signed-off-by: Nicholas Mc Guire <hofrat@osadl.org>
    [lorenzo.pieralisi@arm.com: reworked commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b641c52ae260e79ddc4ae3af946078314b46e218
Author: Daniel Borkmann <daniel@iogearbox.net>
Date:   Thu Jun 28 23:34:58 2018 +0200

    bpf, s390: fix potential memleak when later bpf_jit_prog fails
    
    [ Upstream commit f605ce5eb26ac934fb8106d75d46a2c875a2bf23 ]
    
    If we would ever fail in the bpf_jit_prog() pass that writes the
    actual insns to the image after we got header via bpf_jit_binary_alloc()
    then we also need to make sure to free it through bpf_jit_binary_free()
    again when bailing out. Given we had prior bpf_jit_prog() passes to
    initially probe for clobbered registers, program size and to fill in
    addrs arrray for jump targets, this is more of a theoretical one,
    but at least make sure this doesn't break with future changes.
    
    Fixes: 054623105728 ("s390/bpf: Add s390x eBPF JIT compiler backend")
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Cc: Martin Schwidefsky <schwidefsky@de.ibm.com>
    Acked-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Alexei Starovoitov <ast@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7d208fd9097691b6617d4bb0c90cc712e560b761
Author: Bart Van Assche <bvanassche@acm.org>
Date:   Mon Jun 25 15:51:30 2018 -0700

    drbd: Fix drbd_request_prepare() discard handling
    
    [ Upstream commit fad2d4ef636654e926d374ef038f4cd4286661f6 ]
    
    Fix the test that verifies whether bio_op(bio) represents a discard
    or write zeroes operation. Compile-tested only.
    
    Cc: Philipp Reisner <philipp.reisner@linbit.com>
    Cc: Lars Ellenberg <lars.ellenberg@linbit.com>
    Fixes: 7435e9018f91 ("drbd: zero-out partial unaligned discards on local backend")
    Signed-off-by: Bart Van Assche <bart.vanassche@wdc.com>
    Reviewed-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d48d0a5b90edde6850d52eec018263f1a225a703
Author: Jens Axboe <axboe@kernel.dk>
Date:   Thu Jun 28 11:54:01 2018 -0600

    blk-mq: don't queue more if we get a busy return
    
    [ Upstream commit 1f57f8d442f8017587eeebd8617913bfc3661d3d ]
    
    Some devices have different queue limits depending on the type of IO. A
    classic case is SATA NCQ, where some commands can queue, but others
    cannot. If we have NCQ commands inflight and encounter a non-queueable
    command, the driver returns busy. Currently we attempt to dispatch more
    from the scheduler, if we were able to queue some commands. But for the
    case where we ended up stopping due to BUSY, we should not attempt to
    retrieve more from the scheduler. If we do, we can get into a situation
    where we attempt to queue a non-queueable command, get BUSY, then
    successfully retrieve more commands from that scheduler and queue those.
    This can repeat forever, starving the non-queuable command indefinitely.
    
    Fix this by NOT attempting to pull more commands from the scheduler, if
    we get a BUSY return. This should also be more optimal in terms of
    letting requests stay in the scheduler for as long as possible, if we
    get a BUSY due to the regular out-of-tags condition.
    
    Reviewed-by: Omar Sandoval <osandov@fb.com>
    Reviewed-by: Ming Lei <ming.lei@redhat.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7e43ed7501b0c77198f46c434f3f83a46265a545
Author: Marek Szyprowski <m.szyprowski@samsung.com>
Date:   Thu Jun 7 13:07:49 2018 +0200

    drm/exynos: decon5433: Fix WINCONx reset value
    
    [ Upstream commit 7b7aa62c05eac9789c208b946f515983a9255d8d ]
    
    The only bits that should be preserved in decon_win_set_fmt() is
    WINCONx_ENWIN_F. All other bits depends on the selected pixel formats and
    are set by the mentioned function.
    
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Inki Dae <inki.dae@samsung.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7c62b6786e5a973be78409a9251e7bd295087a0e
Author: Marek Szyprowski <m.szyprowski@samsung.com>
Date:   Thu Jun 7 13:07:40 2018 +0200

    drm/exynos: decon5433: Fix per-plane global alpha for XRGB modes
    
    [ Upstream commit ab337fc274a1957ff0771f19e826c736253f7c39 ]
    
    Set per-plane global alpha to maximum value to get proper blending of
    XRGB and ARGB planes. This fixes the strange order of overlapping planes.
    
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Inki Dae <inki.dae@samsung.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 71bfed12bce1ff09711c01ebbe555e9ca533d30d
Author: Marek Szyprowski <m.szyprowski@samsung.com>
Date:   Thu Jun 7 13:06:13 2018 +0200

    drm/exynos: gsc: Fix support for NV16/61, YUV420/YVU420 and YUV422 modes
    
    [ Upstream commit dd209ef809080ced903e7747ee3ef640c923a1d2 ]
    
    Fix following issues related to planar YUV pixel format configuration:
    - NV16/61 modes were incorrectly programmed as NV12/21,
    - YVU420 was programmed as YUV420 on source,
    - YVU420 and YUV422 were programmed as YUV420 on output.
    
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Inki Dae <inki.dae@samsung.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bf6e8b8d46969809631968a1bd8d91d23c99f6a8
Author: Johannes Berg <johannes.berg@intel.com>
Date:   Fri Jun 29 09:33:39 2018 +0200

    nl80211: check nla_parse_nested() return values
    
    [ Upstream commit 95bca62fb723a121954fc7ae5473bb2c1f0d5986 ]
    
    At the very least we should check the return value if
    nla_parse_nested() is called with a non-NULL policy.
    
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 083489b7b6cf205b71e4294ca9bf94f13cd5f94b
Author: Bob Copeland <me@bobcopeland.com>
Date:   Sun Jun 24 21:10:49 2018 -0400

    nl80211: relax ht operation checks for mesh
    
    [ Upstream commit 188f60ab8e787fcbb5ac9d64ede23a0070231f09 ]
    
    Commit 9757235f451c, "nl80211: correct checks for
    NL80211_MESHCONF_HT_OPMODE value") relaxed the range for the HT
    operation field in meshconf, while also adding checks requiring
    the non-greenfield and non-ht-sta bits to be set in certain
    circumstances.  The latter bit is actually reserved for mesh BSSes
    according to Table 9-168 in 802.11-2016, so in fact it should not
    be set.
    
    wpa_supplicant sets these bits because the mesh and AP code share
    the same implementation, but authsae does not.  As a result, some
    meshconf updates from authsae which set only the NONHT_MIXED
    protection bits were being rejected.
    
    In order to avoid breaking userspace by changing the rules again,
    simply accept the values with or without the bits set, and mask
    off the reserved bit to match the spec.
    
    While in here, update the 802.11-2012 reference to 802.11-2016.
    
    Fixes: 9757235f451c ("nl80211: correct checks for NL80211_MESHCONF_HT_OPMODE value")
    Cc: Masashi Honma <masashi.honma@gmail.com>
    Signed-off-by: Bob Copeland <bobcopeland@fb.com>
    Reviewed-by: Masashi Honma <masashi.honma@gmail.com>
    Reviewed-by: Masashi Honma <masashi.honma@gmail.com>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 60ce4457d489d2a670dc3b490fddbbded1d89e94
Author: Denis Kenzior <denkenz@gmail.com>
Date:   Tue Jun 19 10:39:50 2018 -0500

    mac80211: disable BHs/preemption in ieee80211_tx_control_port()
    
    [ Upstream commit e7441c9274a6a5453e06f4c2b8b5f72eca0a3f17 ]
    
    On pre-emption enabled kernels the following print was being seen due to
    missing local_bh_disable/local_bh_enable calls.  mac80211 assumes that
    pre-emption is disabled in the data path.
    
        BUG: using smp_processor_id() in preemptible [00000000] code: iwd/517
        caller is __ieee80211_subif_start_xmit+0x144/0x210 [mac80211]
        [...]
        Call Trace:
        dump_stack+0x5c/0x80
        check_preemption_disabled.cold.0+0x46/0x51
        __ieee80211_subif_start_xmit+0x144/0x210 [mac80211]
    
    Fixes: 911806491425 ("mac80211: Add support for tx_control_port")
    Signed-off-by: Denis Kenzior <denkenz@gmail.com>
    [commit message rewrite, fixes tag]
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9fa54035165df43f8f57542eb0bafd331df57121
Author: Jeff Moyer <jmoyer@redhat.com>
Date:   Wed Jun 27 11:43:58 2018 -0400

    dev-dax: check_vma: ratelimit dev_info-s
    
    [ Upstream commit 5a14e91d559aee5bdb0e002e1153fd9c4338a29e ]
    
    This is easily triggered from userspace, so let's ratelimit the
    messages.
    
    Signed-off-by: Jeff Moyer <jmoyer@redhat.com>
    Signed-off-by: Dan Williams <dan.j.williams@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 133b39d5dd2130570d3bdf5efd1fc3dd7cce715d
Author: BingJing Chang <bingjingc@synology.com>
Date:   Thu Jun 28 18:40:11 2018 +0800

    md/raid10: fix that replacement cannot complete recovery after reassemble
    
    [ Upstream commit bda3153998f3eb2cafa4a6311971143628eacdbc ]
    
    During assemble, the spare marked for replacement is not checked.
    conf->fullsync cannot be updated to be 1. As a result, recovery will
    treat it as a clean array. All recovering sectors are skipped. Original
    device is replaced with the not-recovered spare.
    
    mdadm -C /dev/md0 -l10 -n4 -pn2 /dev/loop[0123]
    mdadm /dev/md0 -a /dev/loop4
    mdadm /dev/md0 --replace /dev/loop0
    mdadm -S /dev/md0 # stop array during recovery
    
    mdadm -A /dev/md0 /dev/loop[01234]
    
    After reassemble, you can see recovery go on, but it completes
    immediately. In fact, recovery is not actually processed.
    
    To solve this problem, we just add the missing logics for replacment
    spares. (In raid1.c or raid5.c, they have already been checked.)
    
    Reported-by: Alex Chen <alexchen@synology.com>
    Reviewed-by: Alex Wu <alexwu@synology.com>
    Reviewed-by: Chung-Chiang Cheng <cccheng@synology.com>
    Signed-off-by: BingJing Chang <bingjingc@synology.com>
    Signed-off-by: Shaohua Li <shli@fb.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d7fcc6997daba6eb22290525789174b60cf3a09d
Author: Evan Quan <evan.quan@amd.com>
Date:   Mon Jun 11 16:46:40 2018 +0800

    drm/amd/powerplay: correct vega12 thermal support as true
    
    [ Upstream commit 363a3d3fb7d478d7dd49b8c6294436b8ba5984cc ]
    
    Thermal support is enabled on vega12.
    
    Signed-off-by: Evan Quan <evan.quan@amd.com>
    Acked-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8ddb02be59a552fe6e8db5fe8633de47baa3eca2
Author: Ryan Hsu <ryanhsu@codeaurora.org>
Date:   Mon Jun 18 17:00:04 2018 +0300

    ath10k: update the phymode along with bandwidth change request
    
    [ Upstream commit 9191fc2a431bade3dedc9ad17759495a9f82f41b ]
    
    In the case of Station connects to AP with narrower bandwidth at beginning.
    And later the AP changes the bandwidth to winder bandwidth, the AP will
    beacon with wider bandwidth IE, eg VHT20->VHT40->VHT80 or VHT40->VHT80.
    
    Since the supported BANDWIDTH will be limited by the PHYMODE, so while
    Station receives the bandwidth change request, it will also need to
    reconfigure the PHYMODE setting to firmware instead of just configuring
    the BANDWIDTH info, otherwise it'll trigger a firmware crash with
    non-support bandwidth.
    
    The issue was observed in WLAN.RM.4.4.1-00051-QCARMSWP-1, QCA6174 with
    below scenario:
    
    AP xxx changed bandwidth, new config is 5200 MHz, width 2 (5190/0 MHz)
    disconnect from AP xxx for new auth to yyy
    RX ReassocResp from xxx (capab=0x1111 status=0 aid=102)
    associated
    
    ....
    
    AP xxx changed bandwidth, new config is 5200 MHz, width 2 (5190/0 MHz)
    AP xxx changed bandwidth, new config is 5200 MHz, width 3 (5210/0 MHz)
    
    ....
    
    firmware register dump:
    [00]: 0x05030000 0x000015B3 0x00987291 0x00955B31
    [04]: 0x00987291 0x00060730 0x00000004 0x00000001
    [08]: 0x004089F0 0x00955A00 0x000A0B00 0x00400000
    [12]: 0x00000009 0x00000000 0x00952CD0 0x00952CE6
    [16]: 0x00952CC4 0x0098E25F 0x00000000 0x0091080D
    [20]: 0x40987291 0x0040E7A8 0x00000000 0x0041EE3C
    [24]: 0x809ABF05 0x0040E808 0x00000000 0xC0987291
    [28]: 0x809A650C 0x0040E948 0x0041FE40 0x004345C4
    [32]: 0x809A5C63 0x0040E988 0x0040E9AC 0x0042D1A8
    [36]: 0x8091D252 0x0040E9A8 0x00000002 0x00000001
    [40]: 0x809FDA9D 0x0040EA58 0x0043D554 0x0042D554
    [44]: 0x809F8B22 0x0040EA78 0x0043D554 0x00000001
    [48]: 0x80911210 0x0040EAC8 0x00000010 0x004041D0
    [52]: 0x80911154 0x0040EB28 0x00400000 0x00000000
    [56]: 0x8091122D 0x0040EB48 0x00000000 0x00400600
    
    Reported-by: Rouven Czerwinski <rouven@czerwinskis.de>
    Tested-by: Timur KristÃ³f <timur.kristof@gmail.com>
    Signed-off-by: Ryan Hsu <ryanhsu@codeaurora.org>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 16a4d4e05f2208e096a0bb7120f8f4b76d21ef22
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Fri Jun 22 14:15:47 2018 +0300

    dmaengine: k3dma: Off by one in k3_of_dma_simple_xlate()
    
    [ Upstream commit c4c2b7644cc9a41f17a8cc8904efe3f66ae4c7ed ]
    
    The d->chans[] array has d->dma_requests elements so the > should be
    >= here.
    
    Fixes: 8e6152bc660e ("dmaengine: Add hisilicon k3 DMA engine driver")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d830b2678a68318887dcf5db34d109af36ce1ca1
Author: Marek Szyprowski <m.szyprowski@samsung.com>
Date:   Tue Jun 19 15:20:50 2018 +0200

    dmaengine: pl330: report BURST residue granularity
    
    [ Upstream commit e3f329c600033f011a978a8bc4ddb1e2e94c4f4d ]
    
    The reported residue is already calculated in BURST unit granularity, so
    advertise this capability properly to other devices in the system.
    
    Fixes: aee4d1fac887 ("dmaengine: pl330: improve pl330_tx_status() function")
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 05a28971edbf0de9fc61562975280b2e64e8bbb1
Author: Martin Blumenstingl <martin.blumenstingl@googlemail.com>
Date:   Sat Jun 23 17:00:56 2018 +0200

    ARM64: dts: meson-gxl: fix Mali GPU compatible string
    
    [ Upstream commit 1c38f4afd5d40234b67635b3c608a4093be04b96 ]
    
    meson-gxl-mali.dtsi is only used on GXL SoCs. Thus it should use the GXL
    specific compatible string instead of the GXBB one.
    For now this is purely cosmetic since the (out-of-tree) lima driver for
    this GPU currently uses the "arm,mali-450" match instead of the SoC
    specific one. However, update the .dts to match the documentation since
    this driver behavior might change in the future.
    
    Signed-off-by: Martin Blumenstingl <martin.blumenstingl@googlemail.com>
    Acked-by: Neil Armstrong <narmstrong@baylibre.com>
    Signed-off-by: Kevin Hilman <khilman@baylibre.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 534ad3cd69c92368c73f4e117e20a6654e8fb602
Author: Jerome Brunet <jbrunet@baylibre.com>
Date:   Mon Jun 25 14:56:53 2018 +0200

    ARM64: dts: meson-axg: fix ethernet stability issue
    
    [ Upstream commit 6d28d577510f1a51f7ffbe830fdbf42077e0058b ]
    
    Like the odroid-c2 and wetek, the s400 uses the RTL8211F and seems to
    suffer from the kind of stability issue.
    
    Doing an iperf3 download test, we can see a significant number of LPI
    interrupts on the tx path. After a short while (5 to 15 seconds), the
    network connection dies. If using rootfs over NFS, the connection may
    also break during the boot sequence.
    
    We still don't have a real explanation for this problem so let's disable
    EEE once again.
    
    Fixes: f6f6ac914b82 ("ARM64: dts: meson-axg: enable ethernet for A113D S400 board")
    Signed-off-by: Jerome Brunet <jbrunet@baylibre.com>
    Reviewed-by: Neil Armstrong <narmstrong@baylibre.com>
    Signed-off-by: Kevin Hilman <khilman@baylibre.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 01157286b84d818429c3da984e04bb07f71ca6c5
Author: Will Deacon <will@kernel.org>
Date:   Fri Jun 22 09:31:15 2018 +0100

    arm64: Avoid flush_icache_range() in alternatives patching code
    
    [ Upstream commit 429388682dc266e7a693f9c27e3aabd341d55343 ]
    
    The implementation of flush_icache_range() includes instruction sequences
    which are themselves patched at runtime, so it is not safe to call from
    the patching framework.
    
    This patch reworks the alternatives cache-flushing code so that it rolls
    its own internal D-cache maintenance using DC CIVAC before invalidating
    the entire I-cache after all alternatives have been applied at boot.
    Modules don't cause any issues, since flush_icache_range() is safe to
    call by the time they are loaded.
    
    Acked-by: Mark Rutland <mark.rutland@arm.com>
    Reported-by: Rohit Khanna <rokhanna@nvidia.com>
    Cc: Alexander Van Brunt <avanbrunt@nvidia.com>
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ee5f9222e7475150a8208f992d5fa2b6f6d87612
Author: Katsuhiro Suzuki <suzuki.katsuhiro@socionext.com>
Date:   Tue Jun 19 13:12:05 2018 +0900

    arm64: dts: uniphier: fix widget name of headphone for LD11/LD20 boards
    
    [ Upstream commit 86676c4685f774d818f7a6c401c925bbf2a92903 ]
    
    This patch fixes wrong name of headphone widget for receiving events
    of insert/remove headphone plug from simple-card or audio-graph-card.
    
    If we use wrong widget name then we get warning messages such as
    "asoc-audio-graph-card sound: ASoC: DAPM unknown pin Headphones"
    when the plug is inserted or removed from headphone jack.
    
    Fixes: fb21a0acaa2b7 ("arm64: dts: uniphier: add sound node")
    Signed-off-by: Katsuhiro Suzuki <suzuki.katsuhiro@socionext.com>
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Signed-off-by: Olof Johansson <olof@lixom.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a28b5c0c1f395ce6f44a31c47614d6c68c69218d
Author: Keerthy <j-keerthy@ti.com>
Date:   Tue Jun 5 15:37:51 2018 +0530

    ARM: dts: da850: Fix interrups property for gpio
    
    [ Upstream commit 3eb1b955cd7ed1e621ace856710006c2a8a7f231 ]
    
    The intc #interrupt-cells is equal to 1. Currently gpio
    node has 2 cells per IRQ which is wrong. Remove the additional
    cell for each of the interrupts.
    
    Signed-off-by: Keerthy <j-keerthy@ti.com>
    Fixes: 2e38b946dc54 ("ARM: davinci: da850: add GPIO DT node")
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 42d010a51db78c5081ad9444d917967fc87b5828
Author: Andy Lutomirski <luto@kernel.org>
Date:   Tue Jun 26 22:17:18 2018 -0700

    selftests/x86/sigreturn: Do minor cleanups
    
    [ Upstream commit e8a445dea219c32727016af14f847d2e8f7ebec8 ]
    
    We have short names for the requested and resulting register values.
    Use them instead of spelling out the whole register entry for each
    case.
    
    Signed-off-by: Andy Lutomirski <luto@kernel.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Link: http://lkml.kernel.org/r/bb3bc1f923a2f6fe7912d22a1068fe29d6033d38.1530076529.git.luto@kernel.org
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9088b0d13234c06d4132ef28be869828a9958f8d
Author: Andy Lutomirski <luto@kernel.org>
Date:   Tue Jun 26 22:17:17 2018 -0700

    selftests/x86/sigreturn/64: Fix spurious failures on AMD CPUs
    
    [ Upstream commit ec348020566009d3da9b99f07c05814d13969c78 ]
    
    When I wrote the sigreturn test, I didn't realize that AMD's busted
    IRET behavior was different from Intel's busted IRET behavior:
    
    On AMD CPUs, the CPU leaks the high 32 bits of the kernel stack pointer
    to certain userspace contexts.  Gee, thanks.  There's very little
    the kernel can do about it.  Modify the test so it passes.
    
    Signed-off-by: Andy Lutomirski <luto@kernel.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Link: http://lkml.kernel.org/r/86e7fd3564497f657de30a36da4505799eebef01.1530076529.git.luto@kernel.org
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c8551244095aaa5666935bde42908e112b9f022e
Author: Chengguang Xu <cgxu519@gmx.com>
Date:   Tue Jun 26 09:16:31 2018 +0800

    nfp: cast sizeof() to int when comparing with error code
    
    [ Upstream commit 2d2595719a97c876f35b1e60e5768e58753b268c ]
    
    sizeof() will return unsigned value so in the error check
    negative error code will be always larger than sizeof().
    
    Fixes: a0d8e02c35ff ("nfp: add support for reading nffw info")
    
    Signed-off-by: Chengguang Xu <cgxu519@gmx.com>
    Acked-by: Jakub Kicinski <jakub.kicinski@netronome.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c827073c95fde388bc65fe5227f944eaf859b9f0
Author: Sowmini Varadhan <sowmini.varadhan@oracle.com>
Date:   Mon Jun 25 06:41:25 2018 -0700

    rds: clean up loopback rds_connections on netns deletion
    
    [ Upstream commit c809195f5523dd4d09403bbb1c9732d548aa0d1e ]
    
    The RDS core module creates rds_connections based on callbacks
    from rds_loop_transport when sending/receiving packets to local
    addresses.
    
    These connections will need to be cleaned up when they are
    created from a netns that is not init_net, and that netns is deleted.
    
    Add the changes aligned with the changes from
    commit ebeeb1ad9b8a ("rds: tcp: use rds_destroy_pending() to synchronize
    netns/module teardown and rds connection/workq management") for
    rds_loop_transport
    
    Reported-and-tested-by: syzbot+4c20b3866171ce8441d2@syzkaller.appspotmail.com
    Acked-by: Santosh Shilimkar <santosh.shilimkar@oracle.com>
    Signed-off-by: Sowmini Varadhan <sowmini.varadhan@oracle.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0ce9d3074e7359b11da923fa370b065bbdd1c589
Author: Eli Cohen <eli@mellanox.com>
Date:   Thu May 31 12:24:48 2018 +0300

    net/mlx5: E-Switch, Disallow vlan/spoofcheck setup if not being esw manager
    
    [ Upstream commit a8d70a054a718b63058b3d3ac58b6181815e4289 ]
    
    In smartnic env, if the host (PF) driver is not an e-switch manager, we
    are not allowed to apply eswitch ports setups such as vlan (VST),
    spoof-checks, min/max rate or state.
    
    Make sure we are eswitch manager when coming to issue these callbacks
    and err otherwise.
    
    Also fix the definition of ESW_ALLOWED to rely on eswitch_manager
    capability and on the vport_group_manger.
    
    Operations on the VF nic vport context, such as setting a mac or reading
    the vport counters are allowed to the PF in this scheme.
    
    The modify nic vport guid code was modified to omit checking the
    nic_vport_node_guid_modify eswitch capability.
    The reason for doing so is that modifying node guid requires vport group
    manager capability, and there's no need to check further capabilities.
    
    1. set_vf_vlan     - disallowed
    2. set_vf_spoofchk - disallowed
    3. set_vf_mac      - allowed
    4. get_vf_config   - allowed
    5. set_vf_trust    - disallowed
    6. set_vf_rate     - disallowed
    7. get_vf_stat     - allowed
    8. set_vf_link_state - disallowed
    
    Fixes: f942380c1239 ('net/mlx5: E-Switch, Vport ingress/egress ACLs rules for spoofchk')
    Signed-off-by: Eli Cohen <eli@mellanox.com>
    Reviewed-by: Or Gerlitz <ogerlitz@mellanox.com>
    Tested-by: Or Gerlitz <ogerlitz@mellanox.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3aebfca49f9e2d73c028dc94f92d8af025155f3f
Author: Yan, Zheng <zyan@redhat.com>
Date:   Tue Jun 19 18:20:34 2018 +0800

    ceph: fix dentry leak in splice_dentry()
    
    [ Upstream commit 8b8f53af1ed9df88a4c0fbfdf3db58f62060edf3 ]
    
    In any case, d_splice_alias() does not drop reference of original
    dentry.
    
    Signed-off-by: "Yan, Zheng" <zyan@redhat.com>
    Reviewed-by: Jeff Layton <jlayton@redhat.com>
    Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 788a2c75a32d68d6adf583ad4a7ee1bfe7de0ad6
Author: Jann Horn <jannh@google.com>
Date:   Wed Jun 20 18:33:45 2018 +0200

    netfilter: nf_log: fix uninit read in nf_log_proc_dostring
    
    [ Upstream commit dffd22aed2aa1e804bccf19b30a421e89ee2ae61 ]
    
    When proc_dostring() is called with a non-zero offset in strict mode, it
    doesn't just write to the ->data buffer, it also reads. Make sure it
    doesn't read uninitialized data.
    
    Fixes: c6ac37d8d884 ("netfilter: nf_log: fix error on write NONE to [...]")
    Signed-off-by: Jann Horn <jannh@google.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0f5c35df8aaf20156a7dddfad884662eb49c0a4d
Author: Adam Ford <aford173@gmail.com>
Date:   Thu May 17 20:20:52 2018 -0500

    ARM: davinci: board-da850-evm: fix WP pin polarity for MMC/SD
    
    [ Upstream commit 1b6fe9798af8cb7d80fad5dd30ee1bcd1e0f51eb ]
    
    When booting from MMC/SD in rw mode on DA850 EVM, the system
    crashes because the write protect pin should be active high
    and not active low. This patch fixes the polarity of the WP pin.
    
    Fixes: bdf0e8364fd3 ("ARM: davinci: da850-evm: use gpio descriptor for mmc pins")
    Signed-off-by: Adam Ford <aford173@gmail.com>
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a1efa25770baf4385b2945556dc0844618119993
Author: Peter Chen <peter.chen@nxp.com>
Date:   Wed Jun 6 09:43:27 2018 +0800

    usb: chipidea: host: fix disconnection detect issue
    
    [ Upstream commit 90f26cc6bb90b35040f4da0347f480ea9df6e2fc ]
    
    The commit 4e88d4c08301 ("usb: add a flag to skip PHY
    initialization to struct usb_hcd") delete the assignment
    for hcd->usb_phy, it causes usb_phy_notify_connect{disconnect)
    are not called, the USB PHY driver is not notified of hot plug
    event, then the disconnection will not be detected by hardware.
    
    Fixes: 4e88d4c08301 ("usb: add a flag to skip PHY initialization
            to struct usb_hcd")
    Acked-by: Martin Blumenstingl <martin.blumenstingl@googlemail.com>
    Reported-by: Mats Karrman <mats.dev.list@gmail.com>
    Tested-by: Mats Karrman <mats.dev.list@gmail.com>
    Signed-off-by: Peter Chen <peter.chen@nxp.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c3f1091f922c7f0d7f7007f6518fa30ffeb18ed9
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Sat Jun 2 10:52:56 2018 +0300

    clk: davinci: cfgchip: testing the wrong variable
    
    [ Upstream commit 0613de37373bbbc747d434f643620472bd13303b ]
    
    There is a copy and paste bug here.  We should be testing "usb1" instead
    of "usb0".
    
    Fixes: 58e1e2d2cd89 ("clk: davinci: cfgchip: Add TI DA8XX USB PHY clocks")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: David Lechner <david@lechnology.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0f3587469a39c81443cbfceda6dd5da73dfd13c8
Author: Ravi Bangoria <ravi.bangoria@linux.ibm.com>
Date:   Mon Jun 25 18:12:20 2018 +0530

    perf tools: Fix crash caused by accessing feat_ops[HEADER_LAST_FEATURE]
    
    [ Upstream commit 92ead7ee30c80f8852d28735cbcb9d79bc85f715 ]
    
    perf_event__process_feature() accesses feat_ops[HEADER_LAST_FEATURE]
    which is not defined and thus perf is crashing. HEADER_LAST_FEATURE is
    used as an end marker for the perf report but it's unused for perf
    script/annotate. Ignore HEADER_LAST_FEATURE for perf script/annotate,
    just like it is done in 'perf report'.
    
    Before:
      # perf record -o - ls | perf script
      <SNIP 'ls' output>
      Segmentation fault (core dumped)
      #
    
    After:
      # perf record -o - ls | perf script
      <SNIP 'ls' output>
      Segmentation fault (core dumped)
      ls 7031 4392.099856:  250000 cpu-clock:uhH:  7f5e0ce7cd60
      ls 7031 4392.100355:  250000 cpu-clock:uhH:  7f5e0c706ef7
      #
    
    Signed-off-by: Ravi Bangoria <ravi.bangoria@linux.ibm.com>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Andi Kleen <ak@linux.intel.com>
    Cc: David Ahern <dsahern@gmail.com>
    Cc: David Carrillo-Cisneros <davidcc@google.com>
    Cc: Jin Yao <yao.jin@linux.intel.com>
    Cc: Jiri Olsa <jolsa@redhat.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Fixes: 57b5de463925 ("perf report: Support forced leader feature in pipe mode")
    Link: http://lkml.kernel.org/r/20180625124220.6434-4-ravi.bangoria@linux.ibm.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a94568b95dc21a7c17b11777506c71f738de329b
Author: Ravi Bangoria <ravi.bangoria@linux.ibm.com>
Date:   Mon Jun 25 18:12:19 2018 +0530

    perf script: Fix crash because of missing evsel->priv
    
    [ Upstream commit a3af66f51bd0bca72881ead4bf2bd19cb366582b ]
    
    'perf script' in piped mode is crashing because evsel->priv is not set
    properly. Fix it.
    
    Before:
    
      # perf record -o - -- ls | perf script
      <SNIP 'ls' output>
        Segmentation fault (core dumped)
      #
    
    After:
    
      # perf record -o - -- ls | perf script
      <SNIP 'ls' output>
      ls 2282 1031.731974:  250000 cpu-clock:uhH:  7effe4b3d29e
      ls 2282 1031.732222:  250000 cpu-clock:uhH:  7effe4b3a650
      #
    
    Signed-off-by: Ravi Bangoria <ravi.bangoria@linux.ibm.com>
    Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Andi Kleen <ak@linux.intel.com>
    Cc: David Ahern <dsahern@gmail.com>
    Cc: David Carrillo-Cisneros <davidcc@google.com>
    Cc: Jin Yao <yao.jin@linux.intel.com>
    Cc: Jiri Olsa <jolsa@redhat.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Fixes: a14390fde64e ("perf script: Allow creating per-event dump files")
    Link: http://lkml.kernel.org/r/20180625124220.6434-3-ravi.bangoria@linux.ibm.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ab7757aa3008156b088b199bb062444a99a9472d
Author: Jiri Olsa <jolsa@kernel.org>
Date:   Wed Jun 20 11:40:36 2018 +0200

    perf bench: Fix numa report output code
    
    [ Upstream commit 983107072be1a39cbde67d45cb0059138190e015 ]
    
    Currently we can hit following assert when running numa bench:
    
      $ perf bench numa mem -p 3 -t 1 -P 512 -s 100 -zZ0cm --thp 1
      perf: bench/numa.c:1577: __bench_numa: Assertion `!(!(((wait_stat) & 0x7f) == 0))' failed.
    
    The assertion is correct, because we hit the SIGFPE in following line:
    
      Thread 2.2 "thread 0/0" received signal SIGFPE, Arithmetic exception.
      [Switching to Thread 0x7fffd28c6700 (LWP 11750)]
      0x000.. in worker_thread (__tdata=0x7.. ) at bench/numa.c:1257
      1257 td->speed_gbs = bytes_done / (td->runtime_ns / NSEC_PER_SEC) / 1e9;
    
    We don't check if the runtime is actually bigger than 1 second,
    and thus this might end up with zero division within FPU.
    
    Adding the check to prevent this.
    
    Signed-off-by: Jiri Olsa <jolsa@kernel.org>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: David Ahern <dsahern@gmail.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Link: http://lkml.kernel.org/r/20180620094036.17278-1-jolsa@kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ea2117efdd29b22a5f2a276ffc8d0fba33d8f16b
Author: Yonghong Song <yhs@fb.com>
Date:   Sat Jun 16 10:47:39 2018 -0700

    perf tools: Fix a clang 7.0 compilation error
    
    [ Upstream commit c6555c14572aeadf4fe2819abd971c4e7608b926 ]
    
    Arnaldo reported the perf build failure with latest llvm/clang compiler
    (7.0).
    
       $ make LIBCLANGLLVM=1 -C tools/perf/
       <SNIP>
        CC       /tmp/tmp.t53Qo38zci/tests/kmod-path.o
       util/c++/clang.cpp: In function âstd::unique_ptr<llvm::SmallVectorImpl<char> >
           perf::getBPFObjectFromModule(llvm::Module*)â:
       util/c++/clang.cpp:150:43: error: no matching function for call to
           âllvm::TargetMachine::addPassesToEmitFile(llvm::legacy::PassManager&,
            llvm::raw_svector_ostream&, llvm::TargetMachine::CodeGenFileType)â
                   TargetMachine::CGFT_ObjectFile)) {
                                                 ^
       In file included from util/c++/clang.cpp:25:0:
       /usr/local/include/llvm/Target/TargetMachine.h:254:16: note: candidate:
           virtual bool llvm::TargetMachine::addPassesToEmitFile(
           llvm::legacy::PassManagerBase&, llvm::raw_pwrite_stream&,
           llvm::raw_pwrite_stream*, llvm::TargetMachine::CodeGenFileType, bool,
           llvm::MachineModuleInfo*)
         virtual bool addPassesToEmitFile(PassManagerBase &, raw_pwrite_stream &,
                      ^~~~~~~~~~~~~~~~~~~
      /usr/local/include/llvm/Target/TargetMachine.h:254:16: note:
          candidate expects 6 arguments, 3 provided
      mv: cannot stat '/tmp/tmp.t53Qo38zci/util/c++/.clang.o.tmp': No such file or directory
      make[7]: *** [/home/acme/git/perf/tools/build/Makefile.build:101:
          /tmp/tmp.t53Qo38zci/util/c++/clang.o] Error 1
      make[6]: *** [/home/acme/git/perf/tools/build/Makefile.build:139: c++] Error 2
      make[5]: *** [/home/acme/git/perf/tools/build/Makefile.build:139: util] Error 2
      make[5]: *** Waiting for unfinished jobs....
        CC       /tmp/tmp.t53Qo38zci/tests/thread-map.o
    
    The function addPassesToEmitFile signature changed in llvm 7.0 and such
    a change caused the failure. This patch fixed the issue with using
    proper function signatures under different compiler versions.
    
    Reported-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Yonghong Song <yhs@fb.com>
    Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Cc: Alexei Starovoitov <ast@fb.com>
    Cc: Daniel Borkmann <daniel@iogearbox.net>
    Cc: Jiri Olsa <jolsa@kernel.org>
    Cc: Martin KaFai Lau <kafai@fb.com>
    Cc: Wang Nan <wangnan0@huawei.com>
    Link: http://lkml.kernel.org/r/20180616174739.1076733-1-yhs@fb.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 01c62b622a4ae28656c552f56ddb363674b9115d
Author: Jiri Olsa <jolsa@kernel.org>
Date:   Mon Jun 11 11:34:21 2018 +0200

    perf tests: Add event parsing error handling to parse events test
    
    [ Upstream commit 933ccf2002aaef1037cb676622a694f5390c3d59 ]
    
    Add missing error handling for parse_events calls in test_event function
    that led to following segfault on s390:
    
      running test 52 'intel_pt//u'
      perf: Segmentation fault
      ...
      /lib64/libc.so.6(vasprintf+0xe6) [0x3fffca3f106]
      /lib64/libc.so.6(asprintf+0x46) [0x3fffca1aa96]
      ./perf(parse_events_add_pmu+0xb8) [0x80132088]
      ./perf(parse_events_parse+0xc62) [0x8019529a]
      ./perf(parse_events+0x98) [0x801341c0]
      ./perf(test__parse_events+0x48) [0x800cd140]
      ./perf(cmd_test+0x26a) [0x800bd44a]
      test child interrupted
    
    Adding the struct parse_events_error argument to parse_events call. Also
    adding parse_events_print_error to get more details on the parsing
    failures, like:
    
      # perf test 6 -v
      running test 52 'intel_pt//u'failed to parse event 'intel_pt//u', err 1, str 'Cannot find PMU `intel_pt'. Missing kernel support?'
      event syntax error: 'intel_pt//u'
                           \___ Cannot find PMU `intel_pt'. Missing kernel support?
    
    Committer note:
    
    Use named initializers in the struct parse_events_error variable to
    avoid breaking the build on centos5, 6 and others with a similar gcc:
    
      cc1: warnings being treated as errors
      tests/parse-events.c: In function 'test_event':
      tests/parse-events.c:1696: error: missing initializer
      tests/parse-events.c:1696: error: (near initialization for 'err.str')
    
    Reported-by: Kim Phillips <kim.phillips@arm.com>
    Signed-off-by: Jiri Olsa <jolsa@kernel.org>
    Tested-by: Kim Phillips <kim.phillips@arm.com>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: David Ahern <dsahern@gmail.com>
    Cc: Heiko Carstens <heiko.carstens@de.ibm.com>
    Cc: Hendrik Brueckner <brueckner@linux.vnet.ibm.com>
    Cc: Martin Schwidefsky <schwidefsky@de.ibm.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Richter <tmricht@linux.ibm.com>
    Link: http://lkml.kernel.org/r/20180611093422.1005-1-jolsa@kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 80c7f519be24d89add5cbf31787be059e73114e7
Author: Sandipan Das <sandipan@linux.ibm.com>
Date:   Mon Jun 11 16:10:49 2018 +0530

    perf report powerpc: Fix crash if callchain is empty
    
    [ Upstream commit 143c99f6ac6812d23254e80844d6e34be897d3e1 ]
    
    For some cases, the callchain provided by the kernel may be empty. So,
    the callchain ip filtering code will cause a crash if we do not check
    whether the struct ip_callchain pointer is NULL before accessing any
    members.
    
    This can be observed on a powerpc64le system running Fedora 27 as shown
    below.
    
      # perf record -b -e cycles:u ls
    
    Before:
    
      # perf report --branch-history
    
      perf: Segmentation fault
      -------- backtrace --------
      perf[0x1027615c]
      linux-vdso64.so.1(__kernel_sigtramp_rt64+0x0)[0x7fff856304d8]
      perf(arch_skip_callchain_idx+0x44)[0x10257c58]
      perf[0x1017f2e4]
      perf(thread__resolve_callchain+0x124)[0x1017ff5c]
      perf(sample__resolve_callchain+0xf0)[0x10172788]
      ...
    
    After:
    
      # perf report --branch-history
    
      Samples: 25  of event 'cycles:u', Event count (approx.): 2306870
        Overhead  Source:Line            Symbol                   Shared Object
      +   11.60%  _init+35736            [.] _init                ls
      +    9.84%  strcoll_l.c:137        [.] __strcoll_l          libc-2.26.so
      +    9.16%  memcpy.S:175           [.] __memcpy_power7      libc-2.26.so
      +    9.01%  gconv_charset.h:54     [.] _nl_find_locale      libc-2.26.so
      +    8.87%  dl-addr.c:52           [.] _dl_addr             libc-2.26.so
      +    8.83%  _init+236              [.] _init                ls
      ...
    
    Reported-by: Ravi Bangoria <ravi.bangoria@linux.ibm.com>
    Signed-off-by: Sandipan Das <sandipan@linux.ibm.com>
    Acked-by: Ravi Bangoria <ravi.bangoria@linux.ibm.com>
    Cc: Jiri Olsa <jolsa@redhat.com>
    Cc: Naveen N. Rao <naveen.n.rao@linux.vnet.ibm.com>
    Cc: Sukadev Bhattiprolu <sukadev@linux.vnet.ibm.com>
    Link: http://lkml.kernel.org/r/20180611104049.11048-1-sandipan@linux.ibm.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5d17a17ac413782b45c8602b9721aca971015669
Author: Thomas Richter <tmricht@linux.ibm.com>
Date:   Mon Jun 11 09:31:53 2018 +0200

    perf test session topology: Fix test on s390
    
    [ Upstream commit b930e62ecd362843002bdf84c2940439822af321 ]
    
    On s390 this test case fails because the socket identifiction numbers
    assigned to the CPU are higher than the CPU identification numbers.
    
    F/ix this by adding the platform architecture into the perf data header
    flag information. This helps identifiing the test platform and handles
    s390 specifics in process_cpu_topology().
    
    Before:
    
      [root@p23lp27 perf]# perf test -vvvvv -F 39
      39: Session topology                                      :
      --- start ---
      templ file: /tmp/perf-test-iUv755
      socket_id number is too big.You may need to upgrade the perf tool.
      ---- end ----
      Session topology: Skip
      [root@p23lp27 perf]#
    
    After:
    
      [root@p23lp27 perf]# perf test -vvvvv -F 39
      39: Session topology                                      :
      --- start ---
      templ file: /tmp/perf-test-8X8VTs
      CPU 0, core 0, socket 6
      CPU 1, core 1, socket 3
      ---- end ----
      Session topology: Ok
      [root@p23lp27 perf]#
    
    Signed-off-by: Thomas Richter <tmricht@linux.ibm.com>
    Reviewed-by: Hendrik Brueckner <brueckner@linux.ibm.com>
    Cc: Heiko Carstens <heiko.carstens@de.ibm.com>
    Cc: Martin Schwidefsky <schwidefsky@de.ibm.com>
    Fixes: c84974ed9fb6 ("perf test: Add entry to test cpu topology")
    Link: http://lkml.kernel.org/r/20180611073153.15592-2-tmricht@linux.ibm.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c3732c0d341b9964a48be6d2009e0fb9b48e49fb
Author: Thomas Richter <tmricht@linux.ibm.com>
Date:   Mon Jun 11 09:31:52 2018 +0200

    perf record: Support s390 random socket_id assignment
    
    [ Upstream commit 01766229533f9bdb1144a41b4345c8c7286da7b4 ]
    
    On s390 the socket identifier assigned to a CPU identifier is random and
    (depending on the configuration of the LPAR) may be higher than the CPU
    identifier. This is currently not supported.
    
    Fix this by allowing arbitrary socket identifiers being assigned to
    CPU id.
    
    Output before:
    
      [root@p23lp27 perf]# ./perf report --header -I -v
      ...
      socket_id number is too big.You may need to upgrade the perf tool.
      Error:
      The perf.data file has no samples!
      # ========
      # captured on    : Tue May 29 09:29:57 2018
      # header version : 1
      ...
      # Core ID and Socket ID information is not available
      ...
      [root@p23lp27 perf]#
    
    Output after:
    
      [root@p23lp27 perf]# ./perf report --header -I -v
      ...
      Error:
      The perf.data file has no samples!
      # ========
      # captured on    : Tue May 29 09:29:57 2018
      # header version : 1
      ...
      # CPU 0: Core ID 0, Socket ID 6
      # CPU 1: Core ID 1, Socket ID 3
      # CPU 2: Core ID -1, Socket ID -1
      ...
      [root@p23lp27 perf]#
    
    Signed-off-by: Thomas Richter <tmricht@linux.ibm.com>
    Reviewed-by: Hendrik Brueckner <brueckner@linux.ibm.com>
    Cc: Heiko Carstens <heiko.carstens@de.ibm.com>
    Cc: Martin Schwidefsky <schwidefsky@de.ibm.com>
    Link: http://lkml.kernel.org/r/20180611073153.15592-1-tmricht@linux.ibm.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 991fcd4eb70b58f4c8f0cfff85a256723db46d64
Author: Dirk Gouders <dirk@gouders.net>
Date:   Thu Jun 21 15:30:54 2018 +0200

    kconfig: fix line numbers for if-entries in menu tree
    
    [ Upstream commit b2d00d7c61c84edd150310af3f556f8a3c6e2e67 ]
    
    The line numers for if-entries in the menu tree are off by one or more
    lines which is confusing when debugging for correctness of unrelated changes.
    
    According to the git log, commit a02f0570ae201c49 (kconfig: improve
    error handling in the parser) was the last one that changed that part
    of the parser and replaced
    
            "if_entry: T_IF expr T_EOL"
    by
            "if_entry: T_IF expr nl"
    
    but the commit message does not state why this has been done.
    
    When reverting that part of the commit, only the line numers are
    corrected (checked with cdebug = DEBUG_PARSE in zconf.y), otherwise
    the menu tree remains unchanged (checked with zconfdump() enabled in
    conf.c).
    
    An example for the corrected line numbers:
    
    drivers/soc/Kconfig:15:source drivers/soc/tegra/Kconfig
    drivers/soc/tegra/Kconfig:4:if
    drivers/soc/tegra/Kconfig:6:if
    
    changes to:
    
    drivers/soc/Kconfig:15:source drivers/soc/tegra/Kconfig
    drivers/soc/tegra/Kconfig:1:if
    drivers/soc/tegra/Kconfig:4:if
    
    Signed-off-by: Dirk Gouders <dirk@gouders.net>
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ecd04c8dad8db5ade9adf87a86d5e4a33b170fa1
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Thu Jun 7 16:17:14 2018 +0300

    typec: tcpm: Fix a msecs vs jiffies bug
    
    [ Upstream commit 9578bcd0bb487b8ecef4b7eee799aafb678aa441 ]
    
    The tcpm_set_state() function take msecs not jiffies.
    
    Fixes: f0690a25a140 ("staging: typec: USB Type-C Port Manager (tcpm)")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Acked-by: Heikki Krogerus <heikki.krogerus@linux.intel.com>
    Reviewed-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8ea1c45b4e53c9355bc325b6c120563cefa1a1ed
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Thu Jun 7 15:54:48 2018 +0200

    NFC: pn533: Fix wrong GFP flag usage
    
    [ Upstream commit ecc443c03fb14abfb8a6af5e3b2d43b5257e60f2 ]
    
    pn533_recv_response() is an urb completion handler, so it must use
    GFP_ATOMIC. pn533_usb_send_frame() OTOH runs from a regular sleeping
    context, so the pn533_submit_urb_for_response() there (and only there)
    can use the regular GFP_KERNEL flags.
    
    BugLink: https://bugzilla.redhat.com/show_bug.cgi?id=1514134
    Fixes: 9815c7cf22da ("NFC: pn533: Separate physical layer from ...")
    Cc: Michael Thalmeier <michael.thalmeier@hale.at>
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 08f1a2724bf4ab89ff10441810c214a9f848cbf7
Author: Ajay Gupta <ajaykuee@gmail.com>
Date:   Thu Jun 21 16:19:45 2018 +0300

    usb: xhci: increase CRS timeout value
    
    [ Upstream commit 305886ca87be480ae159908c2affd135c04215cf ]
    
    Some controllers take almost 55ms to complete controller
    restore state (CRS).
    There is no timeout limit mentioned in xhci specification so
    fixing the issue by increasing the timeout limit to 100ms
    
    [reformat code comment -Mathias]
    Signed-off-by: Ajay Gupta <ajaykuee@gmail.com>
    Signed-off-by: Nagaraj Annaiah <naga.annaiah@gmail.com>
    Signed-off-by: Mathias Nyman <mathias.nyman@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4d8829a21160511e748873b19699db3c2979e8ed
Author: Dongjiu Geng <gengdongjiu@huawei.com>
Date:   Thu Jun 21 16:19:43 2018 +0300

    usb: xhci: remove the code build warning
    
    [ Upstream commit 36eb93509c45d0bdbd8d09a01ab9d857972f5963 ]
    
    Initialize the 'err' variate to remove the build warning,
    the warning is shown as below:
    
    drivers/usb/host/xhci-tegra.c: In function 'tegra_xusb_mbox_thread':
    drivers/usb/host/xhci-tegra.c:552:6: warning: 'err' may be used uninitialized in this function [-Wuninitialized]
    drivers/usb/host/xhci-tegra.c:482:6: note: 'err' was declared here
    
    Fixes: e84fce0f8837 ("usb: xhci: Add NVIDIA Tegra XUSB controller driver")
    Signed-off-by: Dongjiu Geng <gengdongjiu@huawei.com>
    Acked-by: Thierry Reding <treding@nvidia.com>
    Acked-by: Jon Hunter <jonathanh@nvidia.com>
    Signed-off-by: Mathias Nyman <mathias.nyman@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 13b2330ba39f9e1c012dad32de82135d1a132c57
Author: Jakub Kicinski <kuba@kernel.org>
Date:   Fri Jun 22 11:56:56 2018 -0700

    nfp: bpf: don't stop offload if replace failed
    
    [ Upstream commit 68d676a089625daed9d61df56ac63b5cd7189efe ]
    
    Stopping offload completely if replace of program failed dates
    back to days of transparent offload.  Back then we wanted to
    silently fall back to the in-driver processing.  Today we mark
    programs for offload when they are loaded into the kernel, so
    the transparent offload is no longer a reality.
    
    Flags check in the driver will only allow replace of a driver
    program with another driver program or an offload program with
    another offload program.
    
    When driver program is replaced stopping offload is a no-op,
    because driver program isn't offloaded.  When replacing
    offloaded program if the offload fails the entire operation
    will fail all the way back to user space and we should continue
    using the old program.  IOW when replacing a driver program
    stopping offload is unnecessary and when replacing offloaded
    program - it's a bug, old program should continue to run.
    
    In practice this bug would mean that if offload operation was to
    fail (either due to FW communication error, kernel OOM or new
    program being offloaded but for a different netdev) driver
    would continue reporting that previous XDP program is offloaded
    but in fact no program will be loaded in hardware.  The failure
    is fairly unlikely (found by inspection, when working on the code)
    but it's unpleasant.
    
    Backport note: even though the bug was introduced in commit
    cafa92ac2553 ("nfp: bpf: add support for XDP_FLAGS_HW_MODE"),
    this fix depends on commit 441a33031fe5 ("net: xdp: don't allow
    device-bound programs in driver mode"), so this fix is sufficient
    only in v4.15 or newer.  Kernels v4.13.x and v4.14.x do need to
    stop offload if it was transparent/opportunistic, i.e. if
    XDP_FLAGS_HW_MODE was not set on running program.
    
    Fixes: cafa92ac2553 ("nfp: bpf: add support for XDP_FLAGS_HW_MODE")
    Signed-off-by: Jakub Kicinski <jakub.kicinski@netronome.com>
    Reviewed-by: Quentin Monnet <quentin.monnet@netronome.com>
    Acked-by: Song Liu <songliubraving@fb.com>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 399b260090a626fb0b2d3d3ab88105aaf75fa47f
Author: Takashi Iwai <tiwai@suse.de>
Date:   Mon Jun 25 11:13:59 2018 +0200

    ALSA: seq: Fix UBSAN warning at SNDRV_SEQ_IOCTL_QUERY_NEXT_CLIENT ioctl
    
    [ Upstream commit c9a4c63888dbb79ce4d068ca1dd8b05bc3f156b1 ]
    
    The kernel may spew a WARNING with UBSAN undefined behavior at
    handling ALSA sequencer ioctl SNDRV_SEQ_IOCTL_QUERY_NEXT_CLIENT:
    
    UBSAN: Undefined behaviour in sound/core/seq/seq_clientmgr.c:2007:14
    signed integer overflow:
    2147483647 + 1 cannot be represented in type 'int'
    Call Trace:
     __dump_stack lib/dump_stack.c:77 [inline]
     dump_stack+0x122/0x1c8 lib/dump_stack.c:113
     ubsan_epilogue+0x12/0x86 lib/ubsan.c:159
     handle_overflow+0x1c2/0x21f lib/ubsan.c:190
      __ubsan_handle_add_overflow+0x2a/0x31 lib/ubsan.c:198
     snd_seq_ioctl_query_next_client+0x1ac/0x1d0 sound/core/seq/seq_clientmgr.c:2007
     snd_seq_ioctl+0x264/0x3d0 sound/core/seq/seq_clientmgr.c:2144
     ....
    
    It happens only when INT_MAX is passed there, as we're incrementing it
    unconditionally.  So the fix is trivial, check the value with
    INT_MAX.  Although the bug itself is fairly harmless, it's better to
    fix it so that fuzzers won't hit this again later.
    
    Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=200211
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c5c6b86fbb19a7b90887cb00c7a85187fd9068fb
Author: Daniel Mack <daniel@zonque.org>
Date:   Sun Jun 17 13:53:09 2018 +0200

    ARM: dts: am437x: make edt-ft5x06 a wakeup source
    
    [ Upstream commit 49a6ec5b807ea4ad7ebe1f58080ebb8497cb2d2c ]
    
    The touchscreen driver no longer configures the device as wakeup source by
    default. A "wakeup-source" property is needed.
    
    Signed-off-by: Daniel Mack <daniel@zonque.org>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9d8dc2ca73373aa2d8c80fad300267d7a6d349ed
Author: Haiyue Wang <haiyue.wang@linux.intel.com>
Date:   Sat Jun 23 21:51:13 2018 +0800

    ipmi: kcs_bmc: fix IRQ exception if the channel is not open
    
    [ Upstream commit dc0f0a026d33819bb82d5c26ab2fca838e2004be ]
    
    When kcs_bmc_handle_event calls kcs_force_abort function to handle the
    not open (no user running) KCS channel transaction, the returned status
    value -ENODEV causes the low level IRQ handler indicating that the irq
    was not for him by returning IRQ_NONE. After some time, this IRQ will
    be treated to be spurious one, and the exception dump happens.
    
       irq 30: nobody cared (try booting with the "irqpoll" option)
       CPU: 0 PID: 0 Comm: swapper/0 Not tainted 4.10.15-npcm750 #1
       Hardware name: NPCMX50 Chip family
       [<c010b264>] (unwind_backtrace) from [<c0106930>] (show_stack+0x20/0x24)
       [<c0106930>] (show_stack) from [<c03dad38>] (dump_stack+0x8c/0xa0)
       [<c03dad38>] (dump_stack) from [<c0168810>] (__report_bad_irq+0x3c/0xdc)
       [<c0168810>] (__report_bad_irq) from [<c0168c34>] (note_interrupt+0x29c/0x2ec)
       [<c0168c34>] (note_interrupt) from [<c0165c80>] (handle_irq_event_percpu+0x5c/0x68)
       [<c0165c80>] (handle_irq_event_percpu) from [<c0165cd4>] (handle_irq_event+0x48/0x6c)
       [<c0165cd4>] (handle_irq_event) from [<c0169664>] (handle_fasteoi_irq+0xc8/0x198)
       [<c0169664>] (handle_fasteoi_irq) from [<c016529c>] (__handle_domain_irq+0x90/0xe8)
       [<c016529c>] (__handle_domain_irq) from [<c01014bc>] (gic_handle_irq+0x58/0x9c)
       [<c01014bc>] (gic_handle_irq) from [<c010752c>] (__irq_svc+0x6c/0x90)
       Exception stack(0xc0a01de8 to 0xc0a01e30)
       1de0:                   00002080 c0a6fbc0 00000000 00000000 00000000 c096d294
       1e00: 00000000 00000001 dc406400 f03ff100 00000082 c0a01e94 c0a6fbc0 c0a01e38
       1e20: 00200102 c01015bc 60000113 ffffffff
       [<c010752c>] (__irq_svc) from [<c01015bc>] (__do_softirq+0xbc/0x358)
       [<c01015bc>] (__do_softirq) from [<c011c798>] (irq_exit+0xb8/0xec)
       [<c011c798>] (irq_exit) from [<c01652a0>] (__handle_domain_irq+0x94/0xe8)
       [<c01652a0>] (__handle_domain_irq) from [<c01014bc>] (gic_handle_irq+0x58/0x9c)
       [<c01014bc>] (gic_handle_irq) from [<c010752c>] (__irq_svc+0x6c/0x90)
       Exception stack(0xc0a01ef8 to 0xc0a01f40)
       1ee0:                                                       00000000 000003ae
       1f00: dcc0f338 c0111060 c0a00000 c0a0cc44 c0a0cbe4 c0a1c22b c07bc218 00000001
       1f20: dcffca40 c0a01f54 c0a01f58 c0a01f48 c0103524 c0103528 60000013 ffffffff
       [<c010752c>] (__irq_svc) from [<c0103528>] (arch_cpu_idle+0x48/0x4c)
       [<c0103528>] (arch_cpu_idle) from [<c0681390>] (default_idle_call+0x30/0x3c)
       [<c0681390>] (default_idle_call) from [<c0156f24>] (do_idle+0xc8/0x134)
       [<c0156f24>] (do_idle) from [<c015722c>] (cpu_startup_entry+0x28/0x2c)
       [<c015722c>] (cpu_startup_entry) from [<c067ad74>] (rest_init+0x84/0x88)
       [<c067ad74>] (rest_init) from [<c0900d44>] (start_kernel+0x388/0x394)
       [<c0900d44>] (start_kernel) from [<0000807c>] (0x807c)
       handlers:
       [<c041c5dc>] npcm7xx_kcs_irq
       Disabling IRQ #30
    
    It needs to change the returned status from -ENODEV to 0. The -ENODEV
    was originally used to tell the low level IRQ handler that no user was
    running, but not consider the IRQ handling desgin.
    
    And multiple KCS channels share one IRQ handler, it needs to check the
    IBF flag before doing force abort. If the IBF is set, after handling,
    return 0 to low level IRQ handler to indicate that the IRQ is handled.
    
    Signed-off-by: Haiyue Wang <haiyue.wang@linux.intel.com>
    Signed-off-by: Corey Minyard <cminyard@mvista.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 23e94126ee9b9bdf5cb49c9cc4fcb7f6466b90eb
Author: Michael Trimarchi <michael@amarulasolutions.com>
Date:   Wed May 30 11:06:34 2018 +0200

    brcmfmac: stop watchdog before detach and free everything
    
    [ Upstream commit 373c83a801f15b1e3d02d855fad89112bd4ccbe0 ]
    
    Using built-in in kernel image without a firmware in filesystem
    or in the kernel image can lead to a kernel NULL pointer deference.
    Watchdog need to be stopped in brcmf_sdio_remove
    
    The system is going down NOW!
    [ 1348.110759] Unable to handle kernel NULL pointer dereference at virtual address 000002f8
    Sent SIGTERM to all processes
    [ 1348.121412] Mem abort info:
    [ 1348.126962]   ESR = 0x96000004
    [ 1348.130023]   Exception class = DABT (current EL), IL = 32 bits
    [ 1348.135948]   SET = 0, FnV = 0
    [ 1348.138997]   EA = 0, S1PTW = 0
    [ 1348.142154] Data abort info:
    [ 1348.145045]   ISV = 0, ISS = 0x00000004
    [ 1348.148884]   CM = 0, WnR = 0
    [ 1348.151861] user pgtable: 4k pages, 48-bit VAs, pgdp = (____ptrval____)
    [ 1348.158475] [00000000000002f8] pgd=0000000000000000
    [ 1348.163364] Internal error: Oops: 96000004 [#1] PREEMPT SMP
    [ 1348.168927] Modules linked in: ipv6
    [ 1348.172421] CPU: 3 PID: 1421 Comm: brcmf_wdog/mmc0 Not tainted 4.17.0-rc5-next-20180517 #18
    [ 1348.180757] Hardware name: Amarula A64-Relic (DT)
    [ 1348.185455] pstate: 60000005 (nZCv daif -PAN -UAO)
    [ 1348.190251] pc : brcmf_sdiod_freezer_count+0x0/0x20
    [ 1348.195124] lr : brcmf_sdio_watchdog_thread+0x64/0x290
    [ 1348.200253] sp : ffff00000b85be30
    [ 1348.203561] x29: ffff00000b85be30 x28: 0000000000000000
    [ 1348.208868] x27: ffff00000b6cb918 x26: ffff80003b990638
    [ 1348.214176] x25: ffff0000087b1a20 x24: ffff80003b94f800
    [ 1348.219483] x23: ffff000008e620c8 x22: ffff000008f0b660
    [ 1348.224790] x21: ffff000008c6a858 x20: 00000000fffffe00
    [ 1348.230097] x19: ffff80003b94f800 x18: 0000000000000001
    [ 1348.235404] x17: 0000ffffab2e8a74 x16: ffff0000080d7de8
    [ 1348.240711] x15: 0000000000000000 x14: 0000000000000400
    [ 1348.246018] x13: 0000000000000400 x12: 0000000000000001
    [ 1348.251324] x11: 00000000000002c4 x10: 0000000000000a10
    [ 1348.256631] x9 : ffff00000b85bc40 x8 : ffff80003be11870
    [ 1348.261937] x7 : ffff80003dfc7308 x6 : 000000078ff08b55
    [ 1348.267243] x5 : 00000139e1058400 x4 : 0000000000000000
    [ 1348.272550] x3 : dead000000000100 x2 : 958f2788d6618100
    [ 1348.277856] x1 : 00000000fffffe00 x0 : 0000000000000000
    
    Signed-off-by: Michael Trimarchi <michael@amarulasolutions.com>
    Acked-by: Arend van Spriel <arend.vanspriel@broadcom.com>
    Tested-by: Andy Shevchenko <andy.shevchenko@gmail.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 17722c4b606f832ab58458031018ea342d3e2cc2
Author: Tomasz Duszynski <tduszyns@gmail.com>
Date:   Mon May 28 17:38:59 2018 +0200

    iio: pressure: bmp280: fix relative humidity unit
    
    [ Upstream commit 13399ff25f179811ce9c1df1523eb39f9e4a4772 ]
    
    According to IIO ABI relative humidity reading should be
    returned in milli percent.
    
    This patch addresses that by applying proper scaling and
    returning integer instead of fractional format type specifier.
    
    Note that the fixes tag is before the driver was heavily refactored
    to introduce spi support, so the patch won't apply that far back.
    
    Signed-off-by: Tomasz Duszynski <tduszyns@gmail.com>
    Fixes: 14beaa8f5ab1 ("iio: pressure: bmp280: add humidity support")
    Acked-by: Matt Ranostay <matt.ranostay@konsulko.com>
    Signed-off-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 42e2fa589d57ba55799dac5db8ef8fc306b71f67
Author: Ganesh Goudar <ganeshgr@chelsio.com>
Date:   Sat Jun 23 20:28:26 2018 +0530

    cxgb4: when disabling dcb set txq dcb priority to 0
    
    [ Upstream commit 5ce36338a30f9814fc4824f9fe6c20cd83d872c7 ]
    
    When we are disabling DCB, store "0" in txq->dcb_prio
    since that's used for future TX Work Request "OVLAN_IDX"
    values. Setting non zero priority upon disabling DCB
    would halt the traffic.
    
    Reported-by: AMG Zollner Robert <robert@cloudmedia.eu>
    CC: David Ahern <dsa@cumulusnetworks.com>
    Signed-off-by: Casey Leedom <leedom@chelsio.com>
    Signed-off-by: Ganesh Goudar <ganeshgr@chelsio.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a26a4c984fd64a83ae4074d9f096596b5bf85ab5
Author: Linus LÃ¼ssing <linus.luessing@c0d3.blue>
Date:   Thu Jun 7 00:46:24 2018 +0200

    batman-adv: Fix multicast TT issues with bogus ROAM flags
    
    [ Upstream commit a44ebeff6bbd6ef50db41b4195fca87b21aefd20 ]
    
    When a (broken) node wrongly sends multicast TT entries with a ROAM
    flag then this causes any receiving node to drop all entries for the
    same multicast MAC address announced by other nodes, leading to
    packet loss.
    
    Fix this DoS vector by only storing TT sync flags. For multicast TT
    non-sync'ing flag bits like ROAM are unused so far anyway.
    
    Fixes: 1d8ab8d3c176 ("batman-adv: Modified forwarding behaviour for multicast packets")
    Reported-by: Leonardo MÃ¶rlein <me@irrelefant.net>
    Signed-off-by: Linus LÃ¼ssing <linus.luessing@c0d3.blue>
    Signed-off-by: Simon Wunderlich <sw@simonwunderlich.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 880d1ef59c6fa594773a9d6f1771a6c190919564
Author: Linus LÃ¼ssing <linus.luessing@c0d3.blue>
Date:   Thu Jun 7 00:46:23 2018 +0200

    batman-adv: Avoid storing non-TT-sync flags on singular entries too
    
    [ Upstream commit 4a519b83da16927fb98fd32b0f598e639d1f1859 ]
    
    Since commit 54e22f265e87 ("batman-adv: fix TT sync flag inconsistencies")
    TT sync flags and TT non-sync'd flags are supposed to be stored
    separately.
    
    The previous patch missed to apply this separation on a TT entry with
    only a single TT orig entry.
    
    This is a minor fix because with only a single TT orig entry the DDoS
    issue the former patch solves does not apply.
    
    Fixes: 54e22f265e87 ("batman-adv: fix TT sync flag inconsistencies")
    Signed-off-by: Linus LÃ¼ssing <linus.luessing@c0d3.blue>
    Signed-off-by: Sven Eckelmann <sven@narfation.org>
    Signed-off-by: Simon Wunderlich <sw@simonwunderlich.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 62b4d20e3299db79734c2dee0b585f2a46c5324b
Author: Sven Eckelmann <sven@narfation.org>
Date:   Fri Jun 1 19:24:24 2018 +0200

    batman-adv: Fix debugfs path for renamed softif
    
    [ Upstream commit 6da7be7d24b2921f8215473ba7552796dff05fe1 ]
    
    batman-adv is creating special debugfs directories in the init
    net_namespace for each created soft-interface (batadv net_device). But it
    is possible to rename a net_device to a completely different name then the
    original one.
    
    It can therefore happen that a user registers a new batadv net_device with
    the name "bat0". batman-adv is then also adding a new directory under
    $debugfs/batman-adv/ with the name "wlan0".
    
    The user then decides to rename this device to "bat1" and registers a
    different batadv device with the name "bat0". batman-adv will then try to
    create a directory with the name "bat0" under $debugfs/batman-adv/ again.
    But there already exists one with this name under this path and thus this
    fails. batman-adv will detect a problem and rollback the registering of
    this device.
    
    batman-adv must therefore take care of renaming the debugfs directories for
    soft-interfaces whenever it detects such a net_device rename.
    
    Fixes: c6c8fea29769 ("net: Add batman-adv meshing protocol")
    Signed-off-by: Sven Eckelmann <sven@narfation.org>
    Signed-off-by: Simon Wunderlich <sw@simonwunderlich.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7fdca0f115e040856a9f6e544533e3f161d28170
Author: Sven Eckelmann <sven@narfation.org>
Date:   Fri Jun 1 19:24:23 2018 +0200

    batman-adv: Fix debugfs path for renamed hardif
    
    [ Upstream commit 36dc621ceca1be3ec885aeade5fdafbbcc452a6d ]
    
    batman-adv is creating special debugfs directories in the init
    net_namespace for each valid hard-interface (net_device). But it is
    possible to rename a net_device to a completely different name then the
    original one.
    
    It can therefore happen that a user registers a new net_device which gets
    the name "wlan0" assigned by default. batman-adv is also adding a new
    directory under $debugfs/batman-adv/ with the name "wlan0".
    
    The user then decides to rename this device to "wl_pri" and registers a
    different device. The kernel may now decide to use the name "wlan0" again
    for this new device. batman-adv will detect it as a valid net_device and
    tries to create a directory with the name "wlan0" under
    $debugfs/batman-adv/. But there already exists one with this name under
    this path and thus this fails. batman-adv will detect a problem and
    rollback the registering of this device.
    
    batman-adv must therefore take care of renaming the debugfs directories
    for hard-interfaces whenever it detects such a net_device rename.
    
    Fixes: 5bc7c1eb44f2 ("batman-adv: add debugfs structure for information per interface")
    Reported-by: John Soros <sorosj@gmail.com>
    Signed-off-by: Sven Eckelmann <sven@narfation.org>
    Signed-off-by: Simon Wunderlich <sw@simonwunderlich.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cd9718c53cb950cc15441de8dd98df40b51d0df8
Author: Sven Eckelmann <sven@narfation.org>
Date:   Sat Jun 2 17:26:35 2018 +0200

    batman-adv: Fix bat_v best gw refcnt after netlink dump
    
    [ Upstream commit 9713cb0cf19f1cec6c007e3b37be0697042b6720 ]
    
    A reference for the best gateway is taken when the list of gateways in the
    mesh is sent via netlink. This is necessary to check whether the currently
    dumped entry is the currently selected gateway or not. This information is
    then transferred as flag BATADV_ATTR_FLAG_BEST.
    
    After the comparison of the current entry is done,
    batadv_v_gw_dump_entry() has to decrease the reference counter again.
    Otherwise the reference will be held and thus prevents a proper shutdown of
    the batman-adv interfaces (and some of the interfaces enslaved in it).
    
    Fixes: b71bb6f924fe ("batman-adv: add B.A.T.M.A.N. V bat_gw_dump implementations")
    Signed-off-by: Sven Eckelmann <sven@narfation.org>
    Acked-by: Marek Lindner <mareklindner@neomailbox.ch>
    Signed-off-by: Simon Wunderlich <sw@simonwunderlich.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 83901ae9421ee2750c3c72e09ab4b51b90f89807
Author: Sven Eckelmann <sven@narfation.org>
Date:   Sat Jun 2 17:26:34 2018 +0200

    batman-adv: Fix bat_ogm_iv best gw refcnt after netlink dump
    
    [ Upstream commit b5685d2687d6612adf5eac519eb7008f74dfd1ec ]
    
    A reference for the best gateway is taken when the list of gateways in the
    mesh is sent via netlink. This is necessary to check whether the currently
    dumped entry is the currently selected gateway or not. This information is
    then transferred as flag BATADV_ATTR_FLAG_BEST.
    
    After the comparison of the current entry is done,
    batadv_iv_gw_dump_entry() has to decrease the reference counter again.
    Otherwise the reference will be held and thus prevents a proper shutdown of
    the batman-adv interfaces (and some of the interfaces enslaved in it).
    
    Fixes: efb766af06e3 ("batman-adv: add B.A.T.M.A.N. IV bat_gw_dump implementations")
    Reported-by: Andreas Ziegler <dev@andreas-ziegler.de>
    Tested-by: Andreas Ziegler <dev@andreas-ziegler.de>
    Signed-off-by: Sven Eckelmann <sven@narfation.org>
    Acked-by: Marek Lindner <mareklindner@neomailbox.ch>
    Signed-off-by: Simon Wunderlich <sw@simonwunderlich.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 81f24148ce2638c2d50490512e3086ed69f86c85
Author: Rob Herring <robh@kernel.org>
Date:   Tue May 8 10:09:51 2018 -0500

    arm64: dts: msm8916: fix Coresight ETF graph connections
    
    [ Upstream commit 6b4154a655a258c67bcfabbd4c3a06637e74ebcd ]
    
    The ETF input should be connected to the funnel output, and the ETF
    output should be connected to the replicator input. The labels are wrong
    and these got swapped:
    
    Warning (graph_endpoint): /soc/funnel@821000/ports/port@8/endpoint: graph connection to node '/soc/etf@825000/ports/port@1/endpoint' is not bidirectional
    Warning (graph_endpoint): /soc/replicator@824000/ports/port@2/endpoint: graph connection to node '/soc/etf@825000/ports/port@0/endpoint' is not bidirectional
    
    Fixes: 7c10da373698 ("arm64: dts: qcom: Add msm8916 CoreSight components")
    Cc: Ivan T. Ivanov <ivan.ivanov@linaro.org>
    Cc: Mathieu Poirier <mathieu.poirier@linaro.org>
    Cc: Andy Gross <andy.gross@linaro.org>
    Cc: David Brown <david.brown@linaro.org>
    Cc: linux-arm-msm@vger.kernel.org
    Signed-off-by: Rob Herring <robh@kernel.org>
    Reviewed-by: Mathieu Poirier <mathieu.poirier@linaro.org>
    Tested-by: Mathieu Poirier <mathieu.poirier@linaro.org>
    Signed-off-by: Andy Gross <andy.gross@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 23c3cf7d56ca1e8a5232aa2666b5ea8b42672d08
Author: Casey Schaufler <casey@schaufler-ca.com>
Date:   Fri Jun 22 10:54:45 2018 -0700

    Smack: Mark inode instant in smack_task_to_inode
    
    [ Upstream commit 7b4e88434c4e7982fb053c49657e1c8bbb8692d9 ]
    
    Smack: Mark inode instant in smack_task_to_inode
    
    /proc clean-up in commit 1bbc55131e59bd099fdc568d3aa0b42634dbd188
    resulted in smack_task_to_inode() being called before smack_d_instantiate.
    This resulted in the smk_inode value being ignored, even while present
    for files in /proc/self. Marking the inode as instant here fixes that.
    
    Signed-off-by: Casey Schaufler <casey@schaufler-ca.com>
    Signed-off-by: James Morris <james.morris@microsoft.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a29d1c5ce570ba5ebf389d5e6fafa6b85f3e0b74
Author: Hangbin Liu <liuhangbin@gmail.com>
Date:   Thu Jun 21 19:49:36 2018 +0800

    ipv6: mcast: fix unsolicited report interval after receiving querys
    
    [ Upstream commit 6c6da92808442908287fae8ebb0ca041a52469f4 ]
    
    After recieving MLD querys, we update idev->mc_maxdelay with max_delay
    from query header. This make the later unsolicited reports have the same
    interval with mc_maxdelay, which means we may send unsolicited reports with
    long interval time instead of default configured interval time.
    
    Also as we will not call ipv6_mc_reset() after device up. This issue will
    be there even after leave the group and join other groups.
    
    Fixes: fc4eba58b4c14 ("ipv6: make unsolicited report intervals configurable for mld")
    Signed-off-by: Hangbin Liu <liuhangbin@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c826a9eaca6caca0399f1dce213bf29653c5f906
Author: Zhenzhong Duan <zhenzhong.duan@oracle.com>
Date:   Fri Jun 22 13:51:26 2018 +0200

    x86/microcode/intel: Fix memleak in save_microcode_patch()
    
    [ Upstream commit 0218c766263e70795c5eaa17d75ed54bca350950 ]
    
    Free useless ucode_patch entry when it's replaced.
    
    [ bp: Drop the memfree_patch() two-liner. ]
    
    Signed-off-by: Zhenzhong Duan <zhenzhong.duan@oracle.com>
    Signed-off-by: Borislav Petkov <bp@suse.de>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Cc: Srinivas REDDY Eeda <srinivas.eeda@oracle.com>
    Link: http://lkml.kernel.org/r/888102f0-fd22-459d-b090-a1bd8a00cb2b@default
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 71141fa9f7796f01a7566c4eab35483553a69c7c
Author: Marc Zyngier <maz@kernel.org>
Date:   Fri Jun 22 10:52:54 2018 +0100

    irqchip/gic-v3-its: Fix reprogramming of redistributors on CPU hotplug
    
    [ Upstream commit 82f499c8811149069ec958b72a86643a7a289b25 ]
    
    Enabling LPIs was made a lot stricter recently, by checking that they are
    disabled before enabling them. By doing so, the CPU hotplug case was missed
    altogether, which leaves LPIs enabled on hotplug off (expecting the CPU to
    eventually come back), and won't write a different value anyway on hotplug
    on.
    
    So skip that check if that particular case is detected
    
    Fixes: 6eb486b66a30 ("irqchip/gic-v3: Ensure GICR_CTLR.EnableLPI=0 is observed before enabling")
    Reported-by: Sumit Garg <sumit.garg@linaro.org>
    Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Tested-by: Sumit Garg <sumit.garg@linaro.org>
    Cc: Jason Cooper <jason@lakedaemon.net>
    Cc: Alexandre Belloni <alexandre.belloni@bootlin.com>
    Cc: Yang Yingliang <yangyingliang@huawei.com>
    Link: https://lkml.kernel.org/r/20180622095254.5906-8-marc.zyngier@arm.com
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8b2d7cd3fa2f1de01040ac8f20230d114dabbbea
Author: Marc Zyngier <maz@kernel.org>
Date:   Fri Jun 22 10:52:50 2018 +0100

    irqchip/gic-v2m: Fix SPI release on error path
    
    [ Upstream commit cbaf45a6be497c272e80500e4fd9bccdf20d5050 ]
    
    On failing to allocate the required SPIs, the actual number of interrupts
    should be freed and not its log2 value.
    
    Fixes: de337ee30142 ("irqchip/gic-v2m: Add PCI Multi-MSI support")
    Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Cc: Jason Cooper <jason@lakedaemon.net>
    Cc: Alexandre Belloni <alexandre.belloni@bootlin.com>
    Cc: Yang Yingliang <yangyingliang@huawei.com>
    Cc: Sumit Garg <sumit.garg@linaro.org>
    Link: https://lkml.kernel.org/r/20180622095254.5906-4-marc.zyngier@arm.com
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 07b67a01208f5376aeaf7e9f75717b896a2bfb67
Author: Geert Uytterhoeven <geert@linux-m68k.org>
Date:   Fri Jun 22 09:04:25 2018 +0200

    mtd: dataflash: Use ULL suffix for 64-bit constants
    
    [ Upstream commit cbdceb9b3e1928554fffd0d889adf2d0d8edee4d ]
    
    With gcc 4.1.2 when compiling for 32-bit:
    
        drivers/mtd/devices/mtd_dataflash.c:736: warning: integer constant is too large for âlongâ type
        drivers/mtd/devices/mtd_dataflash.c:737: warning: integer constant is too large for âlongâ type
    
    Add the missing "ULL" suffixes to fix this.
    
    Fixes: 67e4145ebf2c161d ("mtd: dataflash: Add flash_info for AT45DB641E")
    Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Acked-by: Andrey Smirnov <andrew.smirnov@gmail.com>
    Signed-off-by: Boris Brezillon <boris.brezillon@bootlin.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9f73f2495bd2c292d7e3523a4cccc45ef15cd6dd
Author: Jeffrin Jose T <ahiliation@gmail.com>
Date:   Thu Jun 21 22:30:20 2018 +0530

    selftests: bpf: notification about privilege required to run test_kmod.sh testing script
    
    [ Upstream commit 81e167c2a216e7b54e6add9d2badcda267fe33b1 ]
    
    The test_kmod.sh script require root privilege for the successful
    execution of the test.
    
    This patch is to notify the user about the privilege the script
    demands for the successful execution of the test.
    
    Signed-off-by: Jeffrin Jose T (Rajagiri SET) <ahiliation@gmail.com>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 88c1d08371a005ed0f372bee9b25f38923a3e6b7
Author: Steven Rostedt (VMware) <rostedt@goodmis.org>
Date:   Wed Apr 4 14:06:30 2018 -0400

    locking/lockdep: Do not record IRQ state within lockdep code
    
    [ Upstream commit fcc784be837714a9173b372ff9fb9b514590dad9 ]
    
    While debugging where things were going wrong with mapping
    enabling/disabling interrupts with the lockdep state and actual real
    enabling and disabling interrupts, I had to silent the IRQ
    disabling/enabling in debug_check_no_locks_freed() because it was
    always showing up as it was called before the splat was.
    
    Use raw_local_irq_save/restore() for not only debug_check_no_locks_freed()
    but for all internal lockdep functions, as they hide useful information
    about where interrupts were used incorrectly last.
    
    Signed-off-by: Steven Rostedt (VMware) <rostedt@goodmis.org>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: Will Deacon <will.deacon@arm.com>
    Link: https://lkml.kernel.org/lkml/20180404140630.3f4f4c7a@gandalf.local.home
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9a8416253d9064150c6e961615b7b006c1af02e5
Author: Masahiro Yamada <yamada.masahiro@socionext.com>
Date:   Wed Apr 18 20:52:31 2018 +0900

    clk: sunxi-ng: replace lib-y with obj-y
    
    [ Upstream commit 12f8c553a503d98b519cca650b188bf51ebdbdbf ]
    
    We had commit 06e226c7fb23 ("clk: sunxi-ng: Move all clock types to a
    library") and commit 799c43415442 ("kbuild: thin archives make default
    for all archs") in the same development cycle, from different trees.
    
    With migration to the thin archive, the entire drivers/clk/sunxi-ng/lib.a
    is linked to the vmlinux.  This does not break build, but we do not get
    any size saving.
    
    However, we do not need to go back to the individual Kconfig options.
    The default configuration pulls in all (or most) of the CCU parts anyway.
    Also, once we enable CONFIG_LD_DEAD_CODE_DATA_ELIMINATION, we can simply
    list all files with obj-y, and the linker will drop all unused functions
    by itself.
    
    After the long discussion [1], people there agreed to fix this, but
    nobody sent a patch after all.  I am doing it now.
    
    I lifted up CONFIG_SUNXI_CCU to drivers/clk/Makefile because everything
    in drivers/clk/sunxi-ng/ depends on SUNXI_CCU.
    
    [1] https://patchwork.kernel.org/patch/9796521/
    
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Acked-by: Stephen Boyd <sboyd@kernel.org>
    Signed-off-by: Maxime Ripard <maxime.ripard@bootlin.com>
    Acked-by: Chen-Yu Tsai <wens@csie.org>
    Signed-off-by: Stephen Boyd <sboyd@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fc2a7f6fb8dcba5c633935cce08b49677451edd8
Author: Jianchao Wang <jianchao.w.wang@oracle.com>
Date:   Wed Jun 20 13:42:22 2018 +0800

    nvme-pci: move nvme_kill_queues to nvme_remove_dead_ctrl
    
    [ Upstream commit 9f9cafc14016f23f982d3ce18f9057923bd3037a ]
    
    There is race between nvme_remove and nvme_reset_work that can
    lead to io hang.
    
    nvme_remove                    nvme_reset_work
                                   -> nvme_remove_dead_ctrl
                                     -> nvme_dev_disable
                                       -> quiesce request_queue
                                     -> queue remove_work
    -> cancel_work_sync reset_work
    -> nvme_remove_namespaces
      -> splice ctrl->namespaces
                                   nvme_remove_dead_ctrl_work
                                   -> nvme_kill_queues
      -> nvme_ns_remove               do nothing
        -> blk_cleanup_queue
          -> blk_freeze_queue
    
    Finally, the request_queue is quiesced state when wait freeze,
    we will get io hang here. To fix it, move the nvme_kill_queues
    from nvme_remove_dead_ctrl_work to nvme_remove_dead_ctrl.
    
    Suggested-by: Keith Busch <keith.busch@linux.intel.com>
    Signed-off-by: Jianchao Wang <jianchao.w.wang@oracle.com>
    Reviewed-by: Keith Busch <keith.busch@intel.com>
    Signed-off-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a3cb0606588a3c41c1fee278b508efa71420f111
Author: Maciej Purski <m.purski@samsung.com>
Date:   Tue Jan 23 12:17:19 2018 +0100

    drm/bridge/sii8620: fix display of packed pixel modes in MHL2
    
    [ Upstream commit e8b92efa629dac0e70ea4145c5e70616de5f89c8 ]
    
    Currently packed pixel modes in MHL2 can't be displayed. The device
    automatically recognizes output format, so setting format other than
    RGB causes failure. Fix it by writing proper values to registers.
    
    Tested on MHL1 and MHL2 using various vendors' dongles both in
    DVI and HDMI mode.
    
    Signed-off-by: Maciej Purski <m.purski@samsung.com>
    Signed-off-by: Andrzej Hajda <a.hajda@samsung.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/1516706239-9104-1-git-send-email-m.purski@samsung.com
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit efedf3a95388874159bbfbee5c7e27dcb537100a
Author: Ard Biesheuvel <ardb@kernel.org>
Date:   Fri Jun 1 17:06:28 2018 +0200

    KVM: arm/arm64: Drop resource size check for GICV window
    
    [ Upstream commit ba56bc3a0786992755e6804fbcbdc60ef6cfc24c ]
    
    When booting a 64 KB pages kernel on a ACPI GICv3 system that
    implements support for v2 emulation, the following warning is
    produced
    
      GICV size 0x2000 not a multiple of page size 0x10000
    
    and support for v2 emulation is disabled, preventing GICv2 VMs
    from being able to run on such hosts.
    
    The reason is that vgic_v3_probe() performs a sanity check on the
    size of the window (it should be a multiple of the page size),
    while the ACPI MADT parsing code hardcodes the size of the window
    to 8 KB. This makes sense, considering that ACPI does not bother
    to describe the size in the first place, under the assumption that
    platforms implementing ACPI will follow the architecture and not
    put anything else in the same 64 KB window.
    
    So let's just drop the sanity check altogether, and assume that
    the window is at least 64 KB in size.
    
    Fixes: 909777324588 ("KVM: arm/arm64: vgic-new: vgic_init: implement kvm_vgic_hyp_init")
    Signed-off-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
    Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 27fe4e8d5f663054b2b678dbb84e483acd212ebd
Author: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>
Date:   Wed Jun 20 12:47:52 2018 -0300

    sctp: fix erroneous inc of snmp SctpFragUsrMsgs
    
    [ Upstream commit fedb1bd3d274b33c432cb83c80c6b3cf54d509c8 ]
    
    Currently it is incrementing SctpFragUsrMsgs when the user message size
    is of the exactly same size as the maximum fragment size, which is wrong.
    
    The fix is to increment it only when user message is bigger than the
    maximum fragment size.
    
    Fixes: bfd2e4b8734d ("sctp: refactor sctp_datamsg_from_user")
    Signed-off-by: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>
    Acked-by: Neil Horman <nhorman@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit edd8e08850fb74b23bd38b762fa3fe3b0bde6299
Author: Bartosz Golaszewski <bgolaszewski@baylibre.com>
Date:   Wed Jun 20 10:03:56 2018 +0200

    net: davinci_emac: match the mdio device against its compatible if possible
    
    [ Upstream commit ea0820bb771175c7d4192fc6f5b5c56b3c6d5239 ]
    
    Device tree based systems without of_dev_auxdata will have the mdio
    device named differently than "davinci_mdio(.0)". In this case use the
    device's parent's compatible string for matching
    
    Signed-off-by: Bartosz Golaszewski <bgolaszewski@baylibre.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b043ccf7399c7e70a42e4d9fb2f4cd146410f78b
Author: Doron Roberts-Kedes <doronrk@fb.com>
Date:   Fri Jun 15 14:05:32 2018 -0700

    nbd: Add the nbd NBD_DISCONNECT_ON_CLOSE config flag.
    
    [ Upstream commit 08ba91ee6e2c1c08d3f0648f978cbb5dbf3491d8 ]
    
    If NBD_DISCONNECT_ON_CLOSE is set on a device, then the driver will
    issue a disconnect from nbd_release if the device has no remaining
    bdev->bd_openers.
    
    Fix ret val so reconfigure with only setting the flag succeeds.
    
    Reviewed-by: Josef Bacik <josef@toxicpanda.com>
    Signed-off-by: Doron Roberts-Kedes <doronrk@fb.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 473c7b01ff67a44a1d745de3162541697a3e6880
Author: Anders Roxell <anders.roxell@linaro.org>
Date:   Tue Jun 19 18:41:11 2018 +0200

    selftests: net: add config fragments
    
    [ Upstream commit 73f9c33beb9e85850a11a1597b35a13650352509 ]
    
    Add fragments to pass bridge and vlan tests.
    
    Fixes: 33b01b7b4f19 ("selftests: add rtnetlink test script")
    Signed-off-by: Anders Roxell <anders.roxell@linaro.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 05f7daf5b3a337495296bcd4d05f93c8421e5f24
Author: Alexey Brodkin <Alexey.Brodkin@synopsys.com>
Date:   Wed Nov 29 11:21:45 2017 +0300

    ARC: Enable machine_desc->init_per_cpu for !CONFIG_SMP
    
    [ Upstream commit 2f24ef7413a4d91657ef04e77c27ce0b313e6c95 ]
    
    machine_desc->init_per_cpu() hook is supposed to be per cpu
    initialization and would seem to apply  equally to UP and/or SMP.
    Infact the comment in header file seems to suggest it works for
    UP too, which was not the case and this patch.
    
    This enables !CONFIG_SMP build for platforms such as hsdk.
    
    Signed-off-by: Alexey Brodkin <abrodkin@synopsys.com>
    Signed-off-by: Vineet Gupta <vgupta@synopsys.com>
    [vgupta: trimmeed changelog]
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b6232082cf400059dcfe21648538ba5f8cd10a75
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Wed Jun 20 13:41:51 2018 +0300

    block: sed-opal: Fix a couple off by one bugs
    
    [ Upstream commit ce042c183bcb94eb2919e8036473a1fc203420f9 ]
    
    resp->num is the number of tokens in resp->tok[].  It gets set in
    response_parse().  So if n == resp->num then we're reading beyond the
    end of the data.
    
    Fixes: 455a7b238cd6 ("block: Add Sed-opal library")
    Reviewed-by: Scott Bauer <scott.bauer@intel.com>
    Tested-by: Scott Bauer <scott.bauer@intel.com>
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2e95d2eac6d45fd148f06f8dc4da257fe866f018
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Wed Jun 20 13:45:05 2018 +0300

    blk-mq-debugfs: Off by one in blk_mq_rq_state_name()
    
    [ Upstream commit a1e79188628580465ac6d7a93a313336ee3364f1 ]
    
    If rq_state == ARRAY_SIZE() then we read one element beyond the end of
    the blk_mq_rq_state_name_array[] array.
    
    Fixes: ec6dcf63c55c ("blk-mq-debugfs: Show more request state information")
    Reviewed-by: Bart Van Assche <bart.vanassche@wdc.com>
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cf10109138be1779448b133cfc2a7e933c43ff7e
Author: Max Gurtuvoy <maxg@mellanox.com>
Date:   Tue Jun 19 15:45:33 2018 +0300

    nvmet: reset keep alive timer in controller enable
    
    [ Upstream commit d68a90e148f5a82aa67654c5012071e31c0e4baa ]
    
    Controllers that are not yet enabled should not really enforce keep alive
    timeouts, but we still want to track a timeout and cleanup in case a host
    died before it enabled the controller.  Hence, simply reset the keep
    alive timer when the controller is enabled.
    
    Suggested-by: Max Gurtovoy <maxg@mellanox.com>
    Signed-off-by: Sagi Grimberg <sagi@grimberg.me>
    Signed-off-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7458a7a177cb9174849e9c3ed32df7179c70ccd8
Author: Israel Rukshin <israelr@mellanox.com>
Date:   Tue Jun 19 15:34:11 2018 +0300

    nvme-rdma: Fix command completion race at error recovery
    
    [ Upstream commit c947657b15379505a9bba36a02005882b66abe57 ]
    
    The race is between completing the request at error recovery work and
    rdma completions.  If we cancel the request before getting the good
    rdma completion we get a NULL deref of the request MR at
    nvme_rdma_process_nvme_rsp().
    
    When Canceling the request we return its mr to the mr pool (set mr to
    NULL) and also unmap its data.  Canceling the requests while the rdma
    queues are active is not safe.  Because rdma queues are active and we
    get good rdma completions that can use the mr pointer which may be NULL.
    Completing the request too soon may lead also to performing DMA to/from
    user buffers which might have been already unmapped.
    
    The commit fixes the race by draining the QP before starting the abort
    commands mechanism.
    
    Signed-off-by: Israel Rukshin <israelr@mellanox.com>
    Reviewed-by: Max Gurtovoy <maxg@mellanox.com>
    Signed-off-by: Sagi Grimberg <sagi@grimberg.me>
    Signed-off-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d03f539983b4f64b0706488cb8b9debd327e5162
Author: Sagi Grimberg <sagi@grimberg.me>
Date:   Tue Jun 19 15:34:09 2018 +0300

    nvme-rdma: fix possible double free condition when failing to create a controller
    
    [ Upstream commit 3d0641015bf73aaa1cb54c936674959e7805070f ]
    
    Failures after nvme_init_ctrl will defer resource cleanups to .free_ctrl
    when the reference is released, hence we should not free the controller
    queues for these failures.
    
    Fix that by moving controller queues allocation before controller
    initialization and correctly freeing them for failures before
    initialization and skip them for failures after initialization.
    
    Signed-off-by: Sagi Grimberg <sagi@grimberg.me>
    Signed-off-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit dd76b88049f9a18acdc36f858d85fa544e0d492c
Author: Dinh Nguyen <dinguyen@kernel.org>
Date:   Tue Jun 19 10:35:38 2018 -0500

    net: stmmac: socfpga: add additional ocp reset line for Stratix10
    
    [ Upstream commit bc8a2d9bcbf1ca548b1deb315d14e1da81945bea ]
    
    The Stratix10 platform has an additional reset line, OCP(Open Core Protocol),
    that also needs to get deasserted for the stmmac ethernet controller to work.
    Thus we need to update the Kconfig to include ARCH_STRATIX10 in order to build
    dwmac-socfpga.
    
    Also, remove the redundant check for the reset controller pointer. The
    reset driver already checks for the pointer and returns 0 if the pointer
    is NULL.
    
    Signed-off-by: Dinh Nguyen <dinguyen@kernel.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3438b1147bd5f354138a32ee281b45010ec9fb42
Author: Li RongQing <lirongqing@baidu.com>
Date:   Tue Jun 19 17:23:17 2018 +0800

    net: propagate dev_get_valid_name return code
    
    [ Upstream commit 7892bd081045222b9e4027fec279a28d6fe7aa66 ]
    
    if dev_get_valid_name failed, propagate its return code
    
    and remove the setting err to ENODEV, it will be set to
    0 again before dev_change_net_namespace exits.
    
    Signed-off-by: Li RongQing <lirongqing@baidu.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 07b87be1c834f250d652cb413a89525cefe66275
Author: Stefan Agner <stefan@agner.ch>
Date:   Sun Jun 17 23:40:53 2018 +0200

    net: hamradio: use eth_broadcast_addr
    
    [ Upstream commit 4e8439aa34802deab11cee68b0ecb18f887fb153 ]
    
    The array bpq_eth_addr is only used to get the size of an
    address, whereas the bcast_addr is used to set the broadcast
    address. This leads to a warning when using clang:
    drivers/net/hamradio/bpqether.c:94:13: warning: variable 'bpq_eth_addr' is not
          needed and will not be emitted [-Wunneeded-internal-declaration]
    static char bpq_eth_addr[6];
                ^
    
    Remove both variables and use the common eth_broadcast_addr
    to set the broadcast address.
    
    Signed-off-by: Stefan Agner <stefan@agner.ch>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f0899c17f40112a79d1687161d3ac497ae7383cd
Author: Govindarajulu Varadarajan <gvaradar@cisco.com>
Date:   Tue Jun 19 08:15:24 2018 -0700

    enic: initialize enic->rfs_h.lock in enic_probe
    
    [ Upstream commit 3256d29fc7aecdf99feb1cb9475ed2252769a8a7 ]
    
    lockdep spotted that we are using rfs_h.lock in enic_get_rxnfc() without
    initializing. rfs_h.lock is initialized in enic_open(). But ethtool_ops
    can be called when interface is down.
    
    Move enic_rfs_flw_tbl_init to enic_probe.
    
    INFO: trying to register non-static key.
    the code is fine but needs lockdep annotation.
    turning off the locking correctness validator.
    CPU: 18 PID: 1189 Comm: ethtool Not tainted 4.17.0-rc7-devel+ #27
    Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.11.0-20171110_100015-anatol 04/01/2014
    Call Trace:
    dump_stack+0x85/0xc0
    register_lock_class+0x550/0x560
    ? __handle_mm_fault+0xa8b/0x1100
    __lock_acquire+0x81/0x670
    lock_acquire+0xb9/0x1e0
    ?  enic_get_rxnfc+0x139/0x2b0 [enic]
    _raw_spin_lock_bh+0x38/0x80
    ? enic_get_rxnfc+0x139/0x2b0 [enic]
    enic_get_rxnfc+0x139/0x2b0 [enic]
    ethtool_get_rxnfc+0x8d/0x1c0
    dev_ethtool+0x16c8/0x2400
    ? __mutex_lock+0x64d/0xa00
    ? dev_load+0x6a/0x150
    dev_ioctl+0x253/0x4b0
    sock_do_ioctl+0x9a/0x130
    sock_ioctl+0x1af/0x350
    do_vfs_ioctl+0x8e/0x670
    ? syscall_trace_enter+0x1e2/0x380
    ksys_ioctl+0x60/0x90
    __x64_sys_ioctl+0x16/0x20
    do_syscall_64+0x5a/0x170
    entry_SYSCALL_64_after_hwframe+0x49/0xbe
    
    Signed-off-by: Govindarajulu Varadarajan <gvaradar@cisco.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit da454998f444061739a696229f53332086d6bca7
Author: Sudarsana Reddy Kalluru <sudarsana.kalluru@cavium.com>
Date:   Mon Jun 18 21:58:02 2018 -0700

    qed: Do not advertise DCBX_LLD_MANAGED capability.
    
    [ Upstream commit ff54d5cd9ec15546abc870452dd0b66eef4b4606 ]
    
    Do not advertise DCBX_LLD_MANAGED capability i.e., do not allow
    external agent to manage the dcbx/lldp negotiation. MFW acts as lldp agent
    for qed* devices, and no other lldp agent is allowed to coexist with mfw.
    
    Also updated a debug print, to not to display the redundant info.
    
    Fixes: a1d8d8a51 ("qed: Add dcbnl support.")
    Signed-off-by: Sudarsana Reddy Kalluru <Sudarsana.Kalluru@cavium.com>
    Signed-off-by: Ariel Elior <ariel.elior@cavium.com>
    Signed-off-by: Michal Kalderon <Michal.Kalderon@cavium.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9c066b254ca47592ea2ee884fb4748212c435137
Author: Sudarsana Reddy Kalluru <sudarsana.kalluru@cavium.com>
Date:   Mon Jun 18 21:58:01 2018 -0700

    qed: Add sanity check for SIMD fastpath handler.
    
    [ Upstream commit 3935a70968820c3994db4de7e6e1c7e814bff875 ]
    
    Avoid calling a SIMD fastpath handler if it is NULL. The check is needed
    to handle an unlikely scenario where unsolicited interrupt is destined to
    a PF in INTa mode.
    
    Fixes: fe56b9e6a ("qed: Add module with basic common support")
    Signed-off-by: Sudarsana Reddy Kalluru <Sudarsana.Kalluru@cavium.com>
    Signed-off-by: Ariel Elior <ariel.elior@cavium.com>
    Signed-off-by: Michal Kalderon <Michal.Kalderon@cavium.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 95af241b9fb465239cfb401d5843bbecbd74046a
Author: Sudarsana Reddy Kalluru <sudarsana.kalluru@cavium.com>
Date:   Mon Jun 18 21:58:00 2018 -0700

    qed: Fix possible memory leak in Rx error path handling.
    
    [ Upstream commit 4f9de4df901fb84709fe3a864dfa4eaf35700f68 ]
    
    Memory for packet buffers need to be freed in the error paths as there is
    no consumer (e.g., upper layer) for such packets and that memory will never
    get freed.
    The issue was uncovered when port was attacked with flood of isatap
    packets, these are multicast packets hence were directed at all the PFs.
    For foce PF, this meant they were routed to the ll2 module which in turn
    drops such packets.
    
    Fixes: 0a7fb11c ("qed: Add Light L2 support")
    Signed-off-by: Sudarsana Reddy Kalluru <Sudarsana.Kalluru@cavium.com>
    Signed-off-by: Ariel Elior <ariel.elior@cavium.com>
    Signed-off-by: Michal Kalderon <Michal.Kalderon@cavium.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7e2a6057f8cd99d0a7a9827aa35adda060ab799e
Author: Zhizhou Zhang <zhizhouzhang@asrmicro.com>
Date:   Tue Jun 12 17:07:37 2018 +0800

    arm64: make secondary_start_kernel() notrace
    
    [ Upstream commit b154886f7892499d0d3054026e19dfb9a731df61 ]
    
    We can't call function trace hook before setup percpu offset.
    When entering secondary_start_kernel(), percpu offset has not
    been initialized.  So this lead hotplug malfunction.
    Here is the flow to reproduce this bug:
    
    echo 0 > /sys/devices/system/cpu/cpu1/online
    echo function > /sys/kernel/debug/tracing/current_tracer
    echo 1 > /sys/kernel/debug/tracing/tracing_on
    echo 1 > /sys/devices/system/cpu/cpu1/online
    
    Acked-by: Mark Rutland <mark.rutland@arm.com>
    Tested-by: Suzuki K Poulose <suzuki.poulose@arm.com>
    Signed-off-by: Zhizhou Zhang <zhizhouzhang@asrmicro.com>
    Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b1c9c6e175af839d47f379be5c2109622364409f
Author: Marek Szyprowski <m.szyprowski@samsung.com>
Date:   Tue Jun 12 13:08:40 2018 +0200

    arm64: dma-mapping: clear buffers allocated with FORCE_CONTIGUOUS flag
    
    [ Upstream commit dd65a941f6ba473a5cb9d013d57fa43b48450a04 ]
    
    dma_alloc_*() buffers might be exposed to userspace via mmap() call, so
    they should be cleared on allocation. In case of IOMMU-based dma-mapping
    implementation such buffer clearing was missing in the code path for
    DMA_ATTR_FORCE_CONTIGUOUS flag handling, because dma_alloc_from_contiguous()
    doesn't honor __GFP_ZERO flag. This patch fixes this issue. For more
    information on clearing buffers allocated by dma_alloc_* functions,
    see commit 6829e274a623 ("arm64: dma-mapping: always clear allocated
    buffers").
    
    Fixes: 44176bb38fa4 ("arm64: Add support for DMA_ATTR_FORCE_CONTIGUOUS to IOMMU")
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1e03a74f9f3b717aff114a75665db2f9fee8ca51
Author: Zhouyang Jia <jiazhouyang09@gmail.com>
Date:   Sat Jun 16 08:14:37 2018 +0800

    xen/scsiback: add error handling for xenbus_printf
    
    [ Upstream commit 7c63ca24c878e0051c91904b72174029320ef4bd ]
    
    When xenbus_printf fails, the lack of error-handling code may
    cause unexpected results.
    
    This patch adds error-handling code after calling xenbus_printf.
    
    Signed-off-by: Zhouyang Jia <jiazhouyang09@gmail.com>
    Reviewed-by: Juergen Gross <jgross@suse.com>
    Signed-off-by: Juergen Gross <jgross@suse.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 57ca86176374d2e420179c3408ecfdd36622e600
Author: Zhouyang Jia <jiazhouyang09@gmail.com>
Date:   Sat Jun 16 01:05:01 2018 +0800

    scsi: xen-scsifront: add error handling for xenbus_printf
    
    [ Upstream commit 93efbd39870474cc536b9caf4a6efeb03b0bc56f ]
    
    When xenbus_printf fails, the lack of error-handling code may
    cause unexpected results.
    
    This patch adds error-handling code after calling xenbus_printf.
    
    Signed-off-by: Zhouyang Jia <jiazhouyang09@gmail.com>
    Reviewed-by: Juergen Gross <jgross@suse.com>
    Signed-off-by: Juergen Gross <jgross@suse.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8a98455e9f06af5b37f37487b672f410d9b8d4d7
Author: Trond Myklebust <trond.myklebust@hammerspace.com>
Date:   Fri Jun 15 15:58:45 2018 -0400

    pNFS: Always free the session slot on error in nfs4_layoutget_handle_exception
    
    [ Upstream commit 2dbf8dffbf35fd8f611083b9d9fe74fdccf912a3 ]
    
    Right now, we can call nfs_commit_inode() while holding the session slot,
    which could lead to NFSv4 deadlocks. Ensure we only keep the slot if
    the server returned a layout that we have to process.
    
    Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8b0f3bd0e5644ad4040fd1e804e4e0480894988e
Author: Zhouyang Jia <jiazhouyang09@gmail.com>
Date:   Fri Jun 15 07:34:52 2018 +0800

    xen: add error handling for xenbus_printf
    
    [ Upstream commit 84c029a73327cef571eaa61c7d6e67e8031b52ec ]
    
    When xenbus_printf fails, the lack of error-handling code may
    cause unexpected results.
    
    This patch adds error-handling code after calling xenbus_printf.
    
    Signed-off-by: Zhouyang Jia <jiazhouyang09@gmail.com>
    Reviewed-by: Boris Ostrovsky <boris.ostrovsky@oracle.com>
    Signed-off-by: Juergen Gross <jgross@suse.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ab830707c443563d3cf37893a28bca41a007d588
Author: Nicholas Piggin <npiggin@gmail.com>
Date:   Sat May 19 14:35:53 2018 +1000

    powerpc: smp_send_stop do not offline stopped CPUs
    
    [ Upstream commit de6e5d38417e6cdb005843db420a2974993d36ff ]
    
    Marking CPUs stopped by smp_send_stop as offline can cause warnings
    due to cross-CPU wakeups. This trace was noticed on a busy system
    running a sysrq+c crash test, after the injected crash:
    
    WARNING: CPU: 51 PID: 1546 at kernel/sched/core.c:1179 set_task_cpu+0x22c/0x240
    CPU: 51 PID: 1546 Comm: kworker/u352:1 Tainted: G      D
    Workqueue: mlx5e mlx5e_update_stats_work [mlx5_core]
    [...]
    NIP [c00000000017c21c] set_task_cpu+0x22c/0x240
    LR [c00000000017d580] try_to_wake_up+0x230/0x720
    Call Trace:
    [c000000001017700] runqueues+0x0/0xb00 (unreliable)
    [c00000000017d580] try_to_wake_up+0x230/0x720
    [c00000000015a214] insert_work+0x104/0x140
    [c00000000015adb0] __queue_work+0x230/0x690
    [c000003fc5007910] [c00000000015b26c] queue_work_on+0x5c/0x90
    [c0080000135fc8f8] mlx5_cmd_exec+0x538/0xcb0 [mlx5_core]
    [c008000013608fd0] mlx5_core_access_reg+0x140/0x1d0 [mlx5_core]
    [c00800001362777c] mlx5e_update_pport_counters.constprop.59+0x6c/0x90 [mlx5_core]
    [c008000013628868] mlx5e_update_ndo_stats+0x28/0x90 [mlx5_core]
    [c008000013625558] mlx5e_update_stats_work+0x68/0xb0 [mlx5_core]
    [c00000000015bcec] process_one_work+0x1bc/0x5f0
    [c00000000015ecac] worker_thread+0xac/0x6b0
    [c000000000168338] kthread+0x168/0x1b0
    [c00000000000b628] ret_from_kernel_thread+0x5c/0xb4
    
    This happens because firstly the CPU is not really offline in the
    usual sense, processes and interrupts have not been migrated away.
    Secondly smp_send_stop does not happen atomically on all CPUs, so
    one CPU can have marked itself offline, while another CPU is still
    running processes or interrupts which can affect the first CPU.
    
    Fix this by just not marking the CPU as offline. It's more like
    frozen in time, so offline does not really reflect its state properly
    anyway. There should be nothing in the crash/panic path that walks
    online CPUs and synchronously waits for them, so this change should
    not introduce new hangs.
    
    Signed-off-by: Nicholas Piggin <npiggin@gmail.com>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bc7e139c2c38e29eb52e7e0f8013994e7530edba
Author: Minas Harutyunyan <Minas.Harutyunyan@synopsys.com>
Date:   Wed May 23 16:24:44 2018 +0400

    dwc2: gadget: Fix ISOC IN DDMA PID bitfield value calculation
    
    [ Upstream commit 1d8e5c00275825fc42aaa5597dab1d0b5b26bb64 ]
    
    PID bitfield in descriptor should be set based on particular request
    length, not based on EP's mc value. PID value can't be set to 0 even
    request length is 0.
    
    Signed-off-by: Minas Harutyunyan <hminas@synopsys.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 302dc36e1a7f31d5838e1935079e15a1f65563c4
Author: Grigor Tovmasyan <Grigor.Tovmasyan@synopsys.com>
Date:   Thu May 24 18:22:30 2018 +0400

    usb: gadget: dwc2: fix memory leak in gadget_init()
    
    [ Upstream commit 9bb073a053f0464ea74a4d4c331fdb7da58568d6 ]
    
    Freed allocated request for ep0 to prevent memory leak in case when
    dwc2_driver_probe() failed.
    
    Cc: Stefan Wahren <stefan.wahren@i2se.com>
    Cc: Marek Szyprowski <m.szyprowski@samsung.com>
    Tested-by: Stefan Wahren <stefan.wahren@i2se.com>
    Tested-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Acked-by: Minas Harutyunyan <hminas@synopsys.com>
    Signed-off-by: Grigor Tovmasyan <tovmasya@synopsys.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 249a19f36c2a406f217b21767821c40389b7a89f
Author: Chunfeng Yun <chunfeng.yun@mediatek.com>
Date:   Fri May 25 17:24:57 2018 +0800

    usb: gadget: composite: fix delayed_status race condition when set_interface
    
    [ Upstream commit 980900d6318066b9f8314bfb87329a20fd0d1ca4 ]
    
    It happens when enable debug log, if set_alt() returns
    USB_GADGET_DELAYED_STATUS and usb_composite_setup_continue()
    is called before increasing count of @delayed_status,
    so fix it by using spinlock of @cdev->lock.
    
    Signed-off-by: Chunfeng Yun <chunfeng.yun@mediatek.com>
    Tested-by: Jay Hsu <shih-chieh.hsu@mediatek.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5938e42c7eeb4fa9afbde5c0d7fd95704e69fc67
Author: William Wu <william.wu@rock-chips.com>
Date:   Fri May 11 17:46:32 2018 +0800

    usb: dwc2: fix isoc split in transfer with no data
    
    [ Upstream commit 70c3c8cb83856758025c2a211dd022bc0478922a ]
    
    If isoc split in transfer with no data (the length of DATA0
    packet is zero), we can't simply return immediately. Because
    the DATA0 can be the first transaction or the second transaction
    for the isoc split in transaction. If the DATA0 packet with no
    data is in the first transaction, we can return immediately.
    But if the DATA0 packet with no data is in the second transaction
    of isoc split in transaction sequence, we need to increase the
    qtd->isoc_frame_index and giveback urb to device driver if needed,
    otherwise, the MDATA packet will be lost.
    
    A typical test case is that connect the dwc2 controller with an
    usb hs Hub (GL852G-12), and plug an usb fs audio device (Plantronics
    headset) into the downstream port of Hub. Then use the usb mic
    to record, we can find noise when playback.
    
    In the case, the isoc split in transaction sequence like this:
    
    - SSPLIT IN transaction
    - CSPLIT IN transaction
      - MDATA packet (176 bytes)
    - CSPLIT IN transaction
      - DATA0 packet (0 byte)
    
    This patch use both the length of DATA0 and qtd->isoc_split_offset
    to check if the DATA0 is in the second transaction.
    
    Tested-by: Gevorg Sahakyan <sahakyan@synopsys.com>
    Tested-by: Heiko Stuebner <heiko@sntech.de>
    Acked-by: Minas Harutyunyan hminas@synopsys.com>
    Signed-off-by: William Wu <william.wu@rock-chips.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d6ebbb41f0942503191b4540d060d3895c0bd54e
Author: William Wu <william.wu@rock-chips.com>
Date:   Fri May 11 17:46:31 2018 +0800

    usb: dwc2: alloc dma aligned buffer for isoc split in
    
    [ Upstream commit af424a410749ed7e0c2bffd3cedbc7c274d0ff6f ]
    
    The commit 3bc04e28a030 ("usb: dwc2: host: Get aligned DMA in
    a more supported way") rips out a lot of code to simply the
    allocation of aligned DMA. However, it also introduces a new
    issue when use isoc split in transfer.
    
    In my test case, I connect the dwc2 controller with an usb hs
    Hub (GL852G-12), and plug an usb fs audio device (Plantronics
    headset) into the downstream port of Hub. Then use the usb mic
    to record, we can find noise when playback.
    
    It's because that the usb Hub uses an MDATA for the first
    transaction and a DATA0 for the second transaction for the isoc
    split in transaction. An typical isoc split in transaction sequence
    like this:
    
    - SSPLIT IN transaction
    - CSPLIT IN transaction
      - MDATA packet
    - CSPLIT IN transaction
      - DATA0 packet
    
    The DMA address of MDATA (urb->dma) is always DWORD-aligned, but
    the DMA address of DATA0 (urb->dma + qtd->isoc_split_offset) may
    not be DWORD-aligned, it depends on the qtd->isoc_split_offset (the
    length of MDATA). In my test case, the length of MDATA is usually
    unaligned, this cause DATA0 packet transmission error.
    
    This patch use kmem_cache to allocate aligned DMA buf for isoc
    split in transaction. Note that according to usb 2.0 spec, the
    maximum data payload size is 1023 bytes for each fs isoc ep,
    and the maximum allowable interrupt data payload size is 64 bytes
    or less for fs interrupt ep. So we set the size of object to be
    1024 bytes in the kmem cache.
    
    Tested-by: Gevorg Sahakyan <sahakyan@synopsys.com>
    Tested-by: Heiko Stuebner <heiko@sntech.de>
    Acked-by: Minas Harutyunyan hminas@synopsys.com>
    Signed-off-by: William Wu <william.wu@rock-chips.com>
    Reviewed-by: Douglas Anderson <dianders@chromium.org>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b64f38524d691224fb0caaf843c2da1efc980dc1
Author: Artur Petrosyan <Arthur.Petrosyan@synopsys.com>
Date:   Wed May 23 09:26:08 2018 -0400

    usb: dwc2: Fix host exit from hibernation flow.
    
    [ Upstream commit 22bb5cfdf13ae70c6a34508a16cfeee48f162443 ]
    
    In case when a hub is connected to DWC2 host
    auto suspend occurs and host goes to
    hibernation. When any device connected to hub
    host hibernation exiting incorrectly.
    
    - Added dwc2_hcd_rem_wakeup() function call to
      exit from suspend state by remote wakeup.
    
    - Increase timeout value for port suspend bit to be set.
    
    Acked-by: Minas Harutyunyan <hminas@synopsys.com>
    Signed-off-by: Artur Petrosyan <arturp@synopsys.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 55601e0651d78de3c8c02f8cf848f309b743d809
Author: Janusz Krzysztofik <jmkrzyszt@gmail.com>
Date:   Tue Jun 5 18:59:57 2018 +0200

    dmaengine: ti: omap-dma: Fix OMAP1510 incorrect residue_granularity
    
    [ Upstream commit c9bd0946da243a8eb86b44ff613e2c813f9b683b ]
    
    Commit 0198d7bb8a0c ("ASoC: omap-mcbsp: Convert to use the sdma-pcm
    instead of omap-pcm") resulted in broken audio playback on OMAP1510
    (discovered on Amstrad Delta).
    
    When running on OMAP1510, omap-pcm used to obtain DMA offset from
    snd_dmaengine_pcm_pointer_no_residue() based on DMA interrupt triggered
    software calculations instead of snd_dmaengine_pcm_pointer() which
    depended on residue value calculated from omap_dma_get_src_pos().
    Similar code path is still available in now used
    sound/soc/soc-generic-dmaengine-pcm.c but it is not triggered.
    
    It was verified already before that omap_get_dma_src_pos() from
    arch/arm/plat-omap/dma.c didn't work correctly for OMAP1510 - see
    commit 1bdd7419910c ("ASoC: OMAP: fix OMAP1510 broken PCM pointer
    callback") for details.  Apparently the same applies to its successor,
    omap_dma_get_src_pos() from drivers/dma/ti/omap-dma.c.
    
    On the other hand, snd_dmaengine_pcm_pointer_no_residue() is described
    as depreciated and discouraged for use in new drivers because of its
    unreliable accuracy.  However, it seems the only working option for
    OPAM1510 now, as long as a software calculated residue is not
    implemented as OMAP1510 fallback in omap-dma.
    
    Using snd_dmaengine_pcm_pointer_no_residue() code path instead of
    snd_dmaengine_pcm_pointer() in sound/soc/soc-generic-dmaengine-pcm.c
    can be triggered in two ways:
    - by passing pcm->flags |= SND_DMAENGINE_PCM_FLAG_NO_RESIDUE from
      sound/soc/omap/sdma-pcm.c,
    - by passing dma_caps.residue_granularity =
      DMA_RESIDUE_GRANULARITY_DESCRIPTOR from DMA engine.
    
    Let's do the latter.
    
    Signed-off-by: Janusz Krzysztofik <jmkrzyszt@gmail.com>
    Acked-by: Peter Ujfalusi <peter.ujfalusi@ti.com>
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5fd726352ec619977c8e861179755d3abd749d17
Author: John Garry <john.garry@huawei.com>
Date:   Fri Jun 8 18:26:33 2018 +0800

    libahci: Fix possible Spectre-v1 pmp indexing in ahci_led_store()
    
    [ Upstream commit fae2a63737e5973f1426bc139935a0f42e232844 ]
    
    Currently smatch warns of possible Spectre-V1 issue in ahci_led_store():
    drivers/ata/libahci.c:1150 ahci_led_store() warn: potential spectre issue 'pp->em_priv' (local cap)
    
    Userspace controls @pmp from following callchain:
    em_message->store()
    ->ata_scsi_em_message_store()
    -->ap->ops->em_store()
    --->ahci_led_store()
    
    After the mask+shift @pmp is effectively an 8b value, which is used to
    index into an array of length 8, so sanitize the array index.
    
    Signed-off-by: John Garry <john.garry@huawei.com>
    Signed-off-by: Tejun Heo <tj@kernel.org>
    
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d3fc1dee6e4a758c6ce636174011e6c1fe6a01ca
Author: Vijay Immanuel <vijayi@attalasystems.com>
Date:   Tue Jun 12 18:16:05 2018 -0700

    IB/rxe: Fix missing completion for mem_reg work requests
    
    [ Upstream commit 375dc53d032fc11e98036b5f228ad13f7c5933f5 ]
    
    Run the completer task to post a work completion after processing
    a memory registration or invalidate work request. This covers the
    case where the memory registration or invalidate was the last work
    request posted to the qp.
    
    Signed-off-by: Vijay Immanuel <vijayi@attalasystems.com>
    Reviewed-by: Yonatan Cohen <yonatanc@mellanox.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bf3a313b9dee0fa60a2327ef86cc775a309c76cf
Author: Ayan Kumar Halder <ayan.halder@arm.com>
Date:   Mon Jun 18 18:08:43 2018 +0100

    drm/mali-dp: Rectify the width and height passed to rotmem_required()
    
    [ Upstream commit c6cf387ec56c19028333274747bbb4ae145a2d13 ]
    
    The width and height needs to be swapped
    
    Signed-off-by: Ayan Kumar halder <ayan.halder@arm.com>
    Reviewed-by: Brian Starkey <brian.starkey@arm.com>
    Reviewed-by: Alexandru Gheorghe <alexandru-cosmin.gheorghe@arm.com>
    Acked-by: Liviu Dudau <liviu.dudau@arm.com>
    [rebased on top of v4.18-rc1]
    Signed-off-by: Liviu Dudau <liviu.dudau@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 39b9c26680448fcdcf918bb8f1ad983e6a17d0dd
Author: Ayan Kumar Halder <ayan.halder@arm.com>
Date:   Tue Apr 10 19:25:03 2018 +0100

    drm/arm/malidp: Preserve LAYER_FORMAT contents when setting format
    
    [ Upstream commit ad7fda2e378f4356df621a39655f7c200b495d81 ]
    
    On some Mali-DP processors, the LAYER_FORMAT register contains fields
    other than the format. These bits were unconditionally cleared when
    setting the pixel format, whereas they should be preserved at their
    reset values.
    
    Reported-by: Brian Starkey <brian.starkey@arm.com>
    Reported-by: Liviu Dudau <liviu.dudau@arm.com>
    Signed-off-by: Ayan Kumar halder <ayan.halder@arm.com>
    Acked-by: Liviu Dudau <liviu.dudau@arm.com>
    Signed-off-by: Liviu Dudau <liviu.dudau@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1dd003d7fc7f4fbcc91d85d275813c6ffb1eddcb
Author: Alison Wang <alison.wang@nxp.com>
Date:   Tue Apr 24 10:42:32 2018 +0800

    drm: mali-dp: Enable Global SE interrupts mask for DP500
    
    [ Upstream commit 89610dc2c235e7b02bb9fba0ce247e12d4dde7cd ]
    
    In the situation that DE and SE arenât shared the same interrupt number,
    the Global SE interrupts mask bit MASK_IRQ_EN in MASKIRQ must be set, or
    else other mask bits will not work and no SE interrupt will occur. This
    patch enables MASK_IRQ_EN for SE to fix this problem.
    
    Signed-off-by: Alison Wang <alison.wang@nxp.com>
    Acked-by: Liviu Dudau <liviu.dudau@arm.com>
    Signed-off-by: Liviu Dudau <liviu.dudau@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a5bcc852a0a605b8455d2a4fe5d7cca90628bc34
Author: Ayan Kumar Halder <ayan.halder@arm.com>
Date:   Fri Apr 20 15:44:57 2018 +0100

    drm/arm/malidp: Ensure that the crtcs are shutdown before removing any encoder/connector
    
    [ Upstream commit 109c4d18e57445afcaf728b8716a69375a3daab2 ]
    
    One needs to ensure that the crtcs are shutdown so that the
    drm_crtc_state->connector_mask reflects that no connectors
    are currently active. Further, it reduces the reference
    count for each connector. This ensures that the connectors
    and encoders can be cleanly removed either when _unbind
    is called for the corresponding drivers or by
    drm_mode_config_cleanup().
    We need drm_atomic_helper_shutdown() to be called before
    component_unbind_all() otherwise the connectors attached to the
    component device will have the wrong reference count value and will not
    be cleanly removed.
    
    Signed-off-by: Ayan Kumar Halder <ayan.halder@arm.com>
    Acked-by: Liviu Dudau <liviu.dudau@arm.com>
    Signed-off-by: Liviu Dudau <liviu.dudau@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b7a8ce416baab80df315719846ec2ad444910e2e
Author: Hoan Tran <hoan.tran@amperecomputing.com>
Date:   Thu Jun 7 14:35:01 2018 +0100

    drivers/perf: xgene_pmu: Fix IOB SLOW PMU parser error
    
    [ Upstream commit a45fc268db20ecd859bb61e25045912b3194b5e6 ]
    
    This patch fixes the below parser error of the IOB SLOW PMU.
    
            # perf stat -a -e iob-slow0/cycle-count/ sleep 1
            evenf syntax error: 'iob-slow0/cycle-count/'
                                     \___ parser error
    
    It replaces the "-" character by "_" character inside the PMU name.
    
    Signed-off-by: Hoan Tran <hoan.tran@amperecomputing.com>
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0963540d9656eaab1791443bf3fda12f1bdf801e
Author: Ray Jui <ray.jui@broadcom.com>
Date:   Tue Jun 12 13:21:31 2018 -0700

    arm64: dts: Stingray: Fix I2C controller interrupt type
    
    [ Upstream commit 75af23c4736c5633894ea0baf9bca1cf6b248ca4 ]
    
    Fix I2C controller interrupt to use IRQ_TYPE_LEVEL_HIGH for Broadcom
    Stingray SoC.
    
    Fixes: 1256ea18875d ("arm64: dts: Add I2C DT nodes for Stingray SoC")
    Signed-off-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit efcb779fce0bef123cebf6ee8208258cbc252015
Author: Ray Jui <ray.jui@broadcom.com>
Date:   Tue Jun 12 13:21:30 2018 -0700

    arm64: dts: ns2: Fix PCIe controller interrupt type
    
    [ Upstream commit d0b8aed9e80ab526dbb04020bfc94ecea7bddb44 ]
    
    Fix PCIe controller interrupt to use IRQ_TYPE_LEVEL_HIGH for Broadcom
    NS2 SoC.
    
    Fixes: fd5e5dd56a2f ("arm64: dts: Add PCIe0 and PCIe4 DT nodes for NS2")
    Signed-off-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e13f80368494046cd00eb0a8a5ffb76b45797685
Author: Ray Jui <ray.jui@broadcom.com>
Date:   Tue Jun 12 13:21:29 2018 -0700

    arm64: dts: ns2: Fix I2C controller interrupt type
    
    [ Upstream commit e605c287deed45624e8d35a15e3f0b4faab1a62d ]
    
    Fix I2C controller interrupt to use IRQ_TYPE_LEVEL_HIGH for Broadcom NS2
    SoC.
    
    Fixes: 7ac674e8df7a ("arm64: dts: Add I2C nodes for NS2")
    Signed-off-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 36583373392c62f6b9a67944a361c4884a491416
Author: Scott Branden <scott.branden@broadcom.com>
Date:   Tue May 22 10:01:39 2018 -0700

    arm64: dts: specify 1.8V EMMC capabilities for bcm958742t
    
    [ Upstream commit 37c2bd81a86ebb1cc934bf52a29c33d6f9abff7f ]
    
    Specify 1.8V EMMC capabilities for bcm958742t board to indicate support
    for UHS mode.
    
    Fixes: d4b4aba6be8a ("arm64: dts: Initial DTS files for Broadcom Stingray SOC")
    Signed-off-by: Scott Branden <scott.branden@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 866d7d223cb4490dfe7c9cacc4214551bc0c78fb
Author: Scott Branden <scott.branden@broadcom.com>
Date:   Fri May 18 08:21:20 2018 -0700

    arm64: dts: specify 1.8V EMMC capabilities for bcm958742k
    
    [ Upstream commit eba92503e980c08ac353d0d669d0bb143979abcd ]
    
    Specify 1.8V EMMC capabilities for bcm958742k board to indicate support
    for UHS mode.
    
    Fixes: d4b4aba6be8a ("arm64: dts: Initial DTS files for Broadcom Stingray SOC")
    Signed-off-by: Scott Branden <scott.branden@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit aed5e311793da9fadc5063720a76f0d62a5f5001
Author: Ray Jui <ray.jui@broadcom.com>
Date:   Tue Jun 12 13:21:28 2018 -0700

    ARM: dts: Cygnus: Fix PCIe controller interrupt type
    
    [ Upstream commit 6cb1628ad3506b315cdddd7676db0ff2af378d28 ]
    
    Fix PCIe controller interrupt to use IRQ_TYPE_LEVEL_HIGH for Broadcom
    Cygnus SoC
    
    Fixes: cd590b50a936 ("ARM: dts: enable PCIe support for Cygnus")
    Fixes: f6b889358a82 ("ARM: dts: Enable MSI support for Broadcom Cygnus")
    Signed-off-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2778064827966687a248e24cb37574f9695d43ba
Author: Ray Jui <ray.jui@broadcom.com>
Date:   Tue Jun 12 13:21:27 2018 -0700

    ARM: dts: Cygnus: Fix I2C controller interrupt type
    
    [ Upstream commit 71ca3409703b62b6a092d0d9d13f366c121bc5d3 ]
    
    Fix I2C controller interrupt to use IRQ_TYPE_LEVEL_HIGH for Broadcom
    Cygnus SoC.
    
    Fixes: b51c05a331ff ("ARM: dts: add I2C device nodes for Broadcom Cygnus")
    Signed-off-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8cc17a37f7a0fcdf77e47aa7f06318e458c3aa70
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Mon Jun 11 15:53:40 2018 -0700

    ARM: dts: BCM5301x: Fix i2c controller interrupt type
    
    [ Upstream commit a0a8338e905734518ab9b10b06e7fd0201228f8b ]
    
    The i2c controller should be using IRQ_TYPE_LEVEL_HIGH, fix that.
    
    Fixes: bb097e3e0045 ("ARM: dts: BCM5301X: Add I2C support to the DT")
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 969cbd08c3f48092b183fb728a8aa4885a7a0562
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Mon Jun 11 15:47:14 2018 -0700

    ARM: dts: HR2: Fix interrupt types for i2c and PCIe
    
    [ Upstream commit dbe4a39331b7aa8bcac8ef2da780724e1af1619a ]
    
    The i2c and PCIe controllers had an incorrect type which should have
    been set to IRQ_TYPE_LEVEL_HIGH, fix that.
    
    Fixes: b9099ec754b5 ("ARM: dts: Add Broadcom Hurricane 2 DTS include file")
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b1bc997a0423b77042e78e6396e3b9d08adb407d
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Mon Jun 11 15:47:13 2018 -0700

    ARM: dts: NSP: Fix PCIe controllers interrupt types
    
    [ Upstream commit 403fde644855bc71318c8db65646383e22653b13 ]
    
    The interrupts for the PCIe controllers should all be of type
    IRQ_TYPE_LEVEL_HIGH instead of IRQ_TYPE_NONE.
    
    Fixes: d71eb9412088 ("ARM: dts: NSP: Add MSI support on PCI")
    Fixes: 522199029fdc ("ARM: dts: NSP: Fix PCIE DT issue")
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 996f2d7176aca7320464e6a0db10bceed7fcf5f9
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Mon Jun 11 15:47:12 2018 -0700

    ARM: dts: NSP: Fix i2c controller interrupt type
    
    [ Upstream commit a3e32e78a40017756c71ef6dad429ffe3301126a ]
    
    The i2c controller should use IRQ_TYPE_LEVEL_HIGH instead of
    IRQ_TYPE_NONE.
    
    Fixes: 0f9f27a36d09 ("ARM: dts: NSP: Add I2C support to the DT")
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5793e128fea3128a400531ada5f6906af4003307
Author: Fathi Boudra <fathi.boudra@linaro.org>
Date:   Thu Jun 14 11:57:08 2018 +0200

    selftests: sync: add config fragment for testing sync framework
    
    [ Upstream commit d6a3e55131fcb1e5ca1753f4b6f297a177b2fc91 ]
    
    Unless the software synchronization objects (CONFIG_SW_SYNC) is enabled,
    the sync test will be skipped:
    
    TAP version 13
    1..0 # Skipped: Sync framework not supported by kernel
    
    Add a config fragment file to be able to run "make kselftest-merge" to
    enable relevant configuration required in order to run the sync test.
    
    Signed-off-by: Fathi Boudra <fathi.boudra@linaro.org>
    Link: https://lkml.org/lkml/2017/5/5/14
    Signed-off-by: Anders Roxell <anders.roxell@linaro.org>
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0fca223f6d2519dec6fbf0cf0d86b556208f253b
Author: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Date:   Wed Jun 13 21:31:43 2018 -0600

    selftests: vm: return Kselftest Skip code for skipped tests
    
    [ Upstream commit a4d7537789724985cafbc9260a31ca4f2b7cf123 ]
    
    When vm test is skipped because of unmet dependencies and/or unsupported
    configuration, it exits with error which is treated as a fail by the
    Kselftest framework. This leads to false negative result even when the
    test could not be run.
    
    Change it to return kselftest skip code when a test gets skipped to
    clearly report that the test could not be run.
    
    Kselftest framework SKIP code is 4 and the framework prints appropriate
    messages to indicate that the test is skipped.
    
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Acked-by: Mike Rapoport <rppt@linux.vnet.ibm.com>
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c161e8a62529a104f9b1b566ef8a1b580d1c505e
Author: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Date:   Thu Jun 14 16:56:13 2018 -0600

    selftests: zram: return Kselftest Skip code for skipped tests
    
    [ Upstream commit 685814466bf8398192cf855415a0bb2cefc1930e ]
    
    When zram test is skipped because of unmet dependencies and/or
    unsupported configuration, it exits with error which is treated as
    a fail by the Kselftest framework. This leads to false negative result
    even when the test could not be run.
    
    Change it to return kselftest skip code when a test gets skipped to
    clearly report that the test could not be run.
    
    Kselftest framework SKIP code is 4 and the framework prints appropriate
    messages to indicate that the test is skipped.
    
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 03b936b06597ca1fa936fcaad2b6f1e908d33c81
Author: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Date:   Wed Jun 13 21:10:48 2018 -0600

    selftests: user: return Kselftest Skip code for skipped tests
    
    [ Upstream commit d7d5311d4aa9611fe1a5a851e6f75733237a668a ]
    
    When user test is skipped because of unmet dependencies and/or
    unsupported configuration, it exits with error which is treated as
    a fail by the Kselftest framework. This leads to false negative result
    even when the test could not be run.
    
    Change it to return kselftest skip code when a test gets skipped to
    clearly report that the test could not be run. Add an explicit check
    for module presence and return skip code if module isn't present.
    
    Kselftest framework SKIP code is 4 and the framework prints appropriate
    messages to indicate that the test is skipped.
    
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d0342b78e6ac00fefc48dbfc0f2ddf51a839feeb
Author: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Date:   Tue Jun 12 18:11:37 2018 -0600

    selftests: sysctl: return Kselftest Skip code for skipped tests
    
    [ Upstream commit c7db6ffb831fd36a03485a0d88b1e505378975ad ]
    
    When sysctl test is skipped because of unmet dependencies and/or
    unsupported configuration, it exits with error which is treated as
    a fail by the Kselftest framework. This leads to false negative result
    even when the test could not be run.
    
    Change it to return kselftest skip code when a test gets skipped to
    clearly report that the test could not be run.
    
    Changed return code to kselftest skip code in skip error legs that check
    requirements and module probe test error leg.
    
    Kselftest framework SKIP code is 4 and the framework prints appropriate
    messages to indicate that the test is skipped.
    
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Reviewed-by: Kees Cook <keescook@chromium.org>
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a950c0190db084666447ea107802e377789ec682
Author: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Date:   Tue Jun 12 17:40:31 2018 -0600

    selftests: static_keys: return Kselftest Skip code for skipped tests
    
    [ Upstream commit 8781578087b8fb8829558bac96c3c24e5ba26f82 ]
    
    When static_keys test is skipped because of unmet dependencies and/or
    unsupported configuration, it exits with error which is treated as a fail
    by the Kselftest framework. This leads to false negative result even when
    the test could not be run.
    
    Change it to return kselftest skip code when a test gets skipped to clearly
    report that the test could not be run.
    
    Added an explicit searches for test_static_key_base and test_static_keys
    modules and return skip code if they aren't found to differentiate between
    the failure to load the module condition and module not found condition.
    
    Kselftest framework SKIP code is 4 and the framework prints appropriate
    messages to indicate that the test is skipped.
    
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 67fa2f218bcb82cd326dc9dfabf4896605cb935a
Author: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Date:   Tue Jun 12 16:46:03 2018 -0600

    selftests: pstore: return Kselftest Skip code for skipped tests
    
    [ Upstream commit 856e7c4b619af622d56b3b454f7bec32a170ac99 ]
    
    When pstore_post_reboot test gets skipped because of unmet dependencies
    and/or unsupported configuration, it returns 0 which is treated as a pass
    by the Kselftest framework. This leads to false positive result even when
    the test could not be run.
    
    Change it to return kselftest skip code when a test gets skipped to clearly
    report that the test could not be run.
    
    Kselftest framework SKIP code is 4 and the framework prints appropriate
    messages to indicate that the test is skipped.
    
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Reviewed-by: Kees Cook <keescook@chromium.org>
    Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 45e49e7ef9d376e4b5a084fc2d2c1713e83762ee
Author: Gao Feng <gfree.wind@vip.163.com>
Date:   Wed Jun 13 12:26:13 2018 +0800

    netfilter: nf_ct_helper: Fix possible panic after nf_conntrack_helper_unregister
    
    [ Upstream commit ad9852af97587b8abe8102f9ddcb05c9769656f6 ]
    
    The helper module would be unloaded after nf_conntrack_helper_unregister,
    so it may cause a possible panic caused by race.
    
    nf_ct_iterate_destroy(unhelp, me) reset the helper of conntrack as NULL,
    but maybe someone has gotten the helper pointer during this period. Then
    it would panic, when it accesses the helper and the module was unloaded.
    
    Take an example as following:
    CPU0                                                   CPU1
    ctnetlink_dump_helpinfo
    helper = rcu_dereference(help->helper);
                                                           unhelp
                                                           set helper as NULL
                                                           unload helper module
    helper->to_nlattr(skb, ct);
    
    As above, the cpu0 tries to access the helper and its module is unloaded,
    then the panic happens.
    
    Signed-off-by: Gao Feng <gfree.wind@vip.163.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f54a67e0d1d40a394485251c72b17aeda9c8c9d6
Author: Eric Dumazet <edumazet@google.com>
Date:   Wed Jun 13 10:11:56 2018 -0700

    netfilter: ipv6: nf_defrag: reduce struct net memory waste
    
    [ Upstream commit 9ce7bc036ae4cfe3393232c86e9e1fea2153c237 ]
    
    It is a waste of memory to use a full "struct netns_sysctl_ipv6"
    while only one pointer is really used, considering netns_sysctl_ipv6
    keeps growing.
    
    Also, since "struct netns_frags" has cache line alignment,
    it is better to move the frags_hdr pointer outside, otherwise
    we spend a full cache line for this pointer.
    
    This saves 192 bytes of memory per netns.
    
    Fixes: c038a767cd69 ("ipv6: add a new namespace for nf_conntrack_reasm")
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 26a309e14463bd3bdc28d4c57d8d1d761d2df9bc
Author: Mika Westerberg <mika.westerberg@linux.intel.com>
Date:   Mon Jun 18 14:17:16 2018 +0300

    ACPI / EC: Use ec_no_wakeup on Thinkpad X1 Carbon 6th
    
    [ Upstream commit 8195a655e5ce09550aff81b2573d9b015d520cb9 ]
    
    On this system EC interrupt triggers constantly kicking devices out of
    low power states and thus blocking power management. The system also has
    a PCIe root port hosting Alpine Ridge Thunderbolt controller and it
    never gets a chance to go to D3cold because of this.
    
    Since the power button works the same regardless if EC interrupt is
    enabled or not during s2idle, add a quirk for this machine that sets
    ec_no_wakeup=true preventing spurious wakeups.
    
    Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5661b528c0591d38ead4921dec558aa4634acc41
Author: Johan Hovold <johan@kernel.org>
Date:   Thu May 31 16:45:52 2018 +0200

    usb: dwc3: of-simple: fix use-after-free on remove
    
    [ Upstream commit 896e518883f18e601335908192e33426c1f599a4 ]
    
    The clocks have already been explicitly disabled and put as part of
    remove() so the runtime suspend callback must not be run when balancing
    the runtime PM usage count before returning.
    
    Fixes: 16adc674d0d6 ("usb: dwc3: add generic OF glue layer")
    Signed-off-by: Johan Hovold <johan@kernel.org>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2a3ab5b97ad4dabae5e4a7488aa41e2e69992663
Author: Minas Harutyunyan <Minas.Harutyunyan@synopsys.com>
Date:   Tue Jun 12 12:37:29 2018 +0400

    usb: dwc2: gadget: Fix issue in dwc2_gadget_start_isoc()
    
    [ Upstream commit 1ffba9058737af2ddeebc813faa8ea9b16bc892a ]
    
    In case of requests queue is empty reset EP target_frame to
    initial value.
    
    This allow restarting ISOC traffic in case when function
    driver queued requests with interruptions.
    
    Tested-by: Zeng Tao <prime.zeng@hisilicon.com>
    Signed-off-by: Minas Harutyunyan <hminas@synopsys.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e8ca0700a0cde5a5d80b9753f1ed35c69602964d
Author: Vincent Pelletier <plr.vincent@gmail.com>
Date:   Wed Jun 13 11:05:06 2018 +0000

    usb: gadget: ffs: Fix BUG when userland exits with submitted AIO transfers
    
    [ Upstream commit d52e4d0c0c428bf2ba35074a7495cdb28e2efbae ]
    
    This bug happens only when the UDC needs to sleep during usb_ep_dequeue,
    as is the case for (at least) dwc3.
    
    [  382.200896] BUG: scheduling while atomic: screen/1808/0x00000100
    [  382.207124] 4 locks held by screen/1808:
    [  382.211266]  #0:  (rcu_callback){....}, at: [<c10b4ff0>] rcu_process_callbacks+0x260/0x440
    [  382.219949]  #1:  (rcu_read_lock_sched){....}, at: [<c1358ba0>] percpu_ref_switch_to_atomic_rcu+0xb0/0x130
    [  382.230034]  #2:  (&(&ctx->ctx_lock)->rlock){....}, at: [<c11f0c73>] free_ioctx_users+0x23/0xd0
    [  382.230096]  #3:  (&(&ffs->eps_lock)->rlock){....}, at: [<f81e7710>] ffs_aio_cancel+0x20/0x60 [usb_f_fs]
    [  382.230160] Modules linked in: usb_f_fs libcomposite configfs bnep btsdio bluetooth ecdh_generic brcmfmac brcmutil intel_powerclamp coretemp dwc3 kvm_intel ulpi udc_core kvm irqbypass crc32_pclmul crc32c_intel pcbc dwc3_pci aesni_intel aes_i586 crypto_simd cryptd ehci_pci ehci_hcd gpio_keys usbcore basincove_gpadc industrialio usb_common
    [  382.230407] CPU: 1 PID: 1808 Comm: screen Not tainted 4.14.0-edison+ #117
    [  382.230416] Hardware name: Intel Corporation Merrifield/BODEGA BAY, BIOS 542 2015.01.21:18.19.48
    [  382.230425] Call Trace:
    [  382.230438]  <SOFTIRQ>
    [  382.230466]  dump_stack+0x47/0x62
    [  382.230498]  __schedule_bug+0x61/0x80
    [  382.230522]  __schedule+0x43/0x7a0
    [  382.230587]  schedule+0x5f/0x70
    [  382.230625]  dwc3_gadget_ep_dequeue+0x14c/0x270 [dwc3]
    [  382.230669]  ? do_wait_intr_irq+0x70/0x70
    [  382.230724]  usb_ep_dequeue+0x19/0x90 [udc_core]
    [  382.230770]  ffs_aio_cancel+0x37/0x60 [usb_f_fs]
    [  382.230798]  kiocb_cancel+0x31/0x40
    [  382.230822]  free_ioctx_users+0x4d/0xd0
    [  382.230858]  percpu_ref_switch_to_atomic_rcu+0x10a/0x130
    [  382.230881]  ? percpu_ref_exit+0x40/0x40
    [  382.230904]  rcu_process_callbacks+0x2b3/0x440
    [  382.230965]  __do_softirq+0xf8/0x26b
    [  382.231011]  ? __softirqentry_text_start+0x8/0x8
    [  382.231033]  do_softirq_own_stack+0x22/0x30
    [  382.231042]  </SOFTIRQ>
    [  382.231071]  irq_exit+0x45/0xc0
    [  382.231089]  smp_apic_timer_interrupt+0x13c/0x150
    [  382.231118]  apic_timer_interrupt+0x35/0x3c
    [  382.231132] EIP: __copy_user_ll+0xe2/0xf0
    [  382.231142] EFLAGS: 00210293 CPU: 1
    [  382.231154] EAX: bfd4508c EBX: 00000004 ECX: 00000003 EDX: f3d8fe50
    [  382.231165] ESI: f3d8fe51 EDI: bfd4508d EBP: f3d8fe14 ESP: f3d8fe08
    [  382.231176]  DS: 007b ES: 007b FS: 00d8 GS: 0033 SS: 0068
    [  382.231265]  core_sys_select+0x25f/0x320
    [  382.231346]  ? __wake_up_common_lock+0x62/0x80
    [  382.231399]  ? tty_ldisc_deref+0x13/0x20
    [  382.231438]  ? ldsem_up_read+0x1b/0x40
    [  382.231459]  ? tty_ldisc_deref+0x13/0x20
    [  382.231479]  ? tty_write+0x29f/0x2e0
    [  382.231514]  ? n_tty_ioctl+0xe0/0xe0
    [  382.231541]  ? tty_write_unlock+0x30/0x30
    [  382.231566]  ? __vfs_write+0x22/0x110
    [  382.231604]  ? security_file_permission+0x2f/0xd0
    [  382.231635]  ? rw_verify_area+0xac/0x120
    [  382.231677]  ? vfs_write+0x103/0x180
    [  382.231711]  SyS_select+0x87/0xc0
    [  382.231739]  ? SyS_write+0x42/0x90
    [  382.231781]  do_fast_syscall_32+0xd6/0x1a0
    [  382.231836]  entry_SYSENTER_32+0x47/0x71
    [  382.231848] EIP: 0xb7f75b05
    [  382.231857] EFLAGS: 00000246 CPU: 1
    [  382.231868] EAX: ffffffda EBX: 00000400 ECX: bfd4508c EDX: bfd4510c
    [  382.231878] ESI: 00000000 EDI: 00000000 EBP: 00000000 ESP: bfd45020
    [  382.231889]  DS: 007b ES: 007b FS: 0000 GS: 0033 SS: 007b
    [  382.232281] softirq: huh, entered softirq 9 RCU c10b4d90 with preempt_count 00000100, exited with 00000000?
    
    Tested-by: Sam Protsenko <semen.protsenko@linaro.org>
    Signed-off-by: Vincent Pelletier <plr.vincent@gmail.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4719b500cc8ba03cfe4da494c6953926ddfae545
Author: Heikki Krogerus <heikki.krogerus@linux.intel.com>
Date:   Thu Jun 15 12:57:30 2017 +0300

    usb: dwc3: pci: add support for Intel IceLake
    
    [ Upstream commit 00908693c481f7298adf8cf4d2ff3dfbea8c375f ]
    
    PCI IDs for Intel IceLake.
    
    Signed-off-by: Heikki Krogerus <heikki.krogerus@linux.intel.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 53f3c88aa4613f2c974728b9a6a9db7f904c566d
Author: Anson Huang <Anson.Huang@nxp.com>
Date:   Wed May 30 09:30:42 2018 +0800

    soc: imx: gpcv2: correct PGC offset
    
    [ Upstream commit 3637f12faf507b0a4b8ac1e7115fc99583ab1db3 ]
    
    Correct MIPI/PCIe/USB_HSIC's PGC offset based on
    design RTL, the values in the Reference Manual
    (Rev. 1, 01/2018 and the older ones) are incorrect.
    
    The correct offset values should be as below:
    
    0x800 ~ 0x83F: PGC for core0 of A7 platform;
    0x840 ~ 0x87F: PGC for core1 of A7 platform;
    0x880 ~ 0x8BF: PGC for SCU of A7 platform;
    0xA00 ~ 0xA3F: PGC for fastmix/megamix;
    0xC00 ~ 0xC3F: PGC for MIPI PHY;
    0xC40 ~ 0xC7F: PGC for PCIe_PHY;
    0xC80 ~ 0xCBF: PGC for USB OTG1 PHY;
    0xCC0 ~ 0xCFF: PGC for USB OTG2 PHY;
    0xD00 ~ 0xD3F: PGC for USB HSIC PHY;
    
    Signed-off-by: Anson Huang <Anson.Huang@nxp.com>
    Fixes: 03aa12629fc4 ("soc: imx: Add GPCv2 power gating driver")
    Acked-by: Andrey Smirnov <andrew.smirnov@gmail.com>
    Reviewed-by: Fabio Estevam <fabio.estevam@nxp.com>
    Signed-off-by: Shawn Guo <shawnguo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4f0eeb62a78f98e2a0c46b031070a3d16136cd4a
Author: Guenter Roeck <linux@roeck-us.net>
Date:   Tue Jun 12 15:19:35 2018 -0700

    hwmon: (nct6775) Fix loop limit
    
    [ Upstream commit 91bb8f45f73f19a0150c233c0f11cdeb6d71d1e9 ]
    
    Commit cc66b3038254 ("hwmon: (nct6775) Rework temperature source and label
    handling") changed a loop limit from "data->temp_label_num - 1" to "32",
    as part of moving from a string array to a bit mask. This results in the
    following error, reported by UBSAN.
    
    UBSAN: Undefined behaviour in drivers/hwmon/nct6775.c:4179:27
    shift exponent 32 is too large for 32-bit type 'long unsigned int'
    
    Similar to the original loop, the limit has to be one less than the
    number of bits.
    
    Fixes: cc66b3038254 ("hwmon: (nct6775) Rework temperature source and label handling")
    Reported-by: Paul Menzel <pmenzel+linux-hwmon@molgen.mpg.de>
    Cc: Paul Menzel <pmenzel+linux-hwmon@molgen.mpg.de>
    Tested-by: Paul Menzel <pmenzel+linux-hwmon@molgen.mpg.de>
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e1f511665fd9aa28500b5b901fb428d0c65f7480
Author: Helge Eichelberg <kernelorg@elchenberg.name>
Date:   Tue Jun 5 19:38:32 2018 +0200

    hwmon: (dell-smm) Disable fan support for Dell XPS13 9333
    
    [ Upstream commit 536e0019b7da4eb3badb4da5acbb70ae29e1b5ef ]
    
    Calling fan related SMM functions implemented by Dell BIOS firmware on Dell
    XPS13 9333 freeze kernel for about 500ms. Until Dell fixes it we need to
    disable fan support for Dell XPS13 9333.
    
    Via "force" module param fan support can be enabled.
    
    Link: https://bugzilla.kernel.org/show_bug.cgi?id=195751
    Signed-off-by: Helge Eichelberg <kernelorg@elchenberg.name>
    Reviewed-by: Pali RohÃ¡r <pali.rohar@gmail.com>
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e1fd246d69046f023d7d36ede68026b3373d1e9e
Author: Steve French <stfrench@microsoft.com>
Date:   Wed Jun 13 17:05:58 2018 -0500

    smb3: increase initial number of credits requested to allow write
    
    [ Upstream commit d409014e4feeab486fb36b350abfc4c94de8be37 ]
    
    Compared to other clients the Linux smb3 client ramps up
    credits very slowly, taking more than 128 operations before a
    maximum size write could be sent (since the number of credits
    requested is only 2 per small operation, causing the credit
    limit to grow very slowly).
    
    This lack of credits initially would impact large i/o performance,
    when large i/o is tried early before enough credits are built up.
    
    Signed-off-by: Steve French <sfrench@gmail.com>
    Reviewed-by: Ronnie Sahlberg <lsahlber@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bd67a01861796a0071df98a9bf278817e38f0ac6
Author: Jakub Kicinski <kuba@kernel.org>
Date:   Thu Jun 14 11:06:56 2018 -0700

    selftests/bpf: test offloads even with BPF programs present
    
    [ Upstream commit 47cf52a246e526e2092d60ac01c54af9bd45dcc9 ]
    
    Modern distroes increasingly make use of BPF programs.  Default
    Ubuntu 18.04 installation boots with a number of cgroup_skb
    programs loaded.
    
    test_offloads.py tries to check if programs and maps are not
    leaked on error paths by confirming the list of programs on the
    system is empty between tests.
    
    Since we can no longer expect the system to have no BPF objects
    at boot try to remember the programs and maps present at the start,
    and skip those when scanning the system.
    
    Signed-off-by: Jakub Kicinski <jakub.kicinski@netronome.com>
    Reviewed-by: Quentin Monnet <quentin.monnet@netronome.com>
    Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ac8bd7eb6efafe1e2d41ee1fbdf8db7034a4e1f4
Author: Alexey Brodkin <abrodkin@synopsys.com>
Date:   Fri Jun 1 14:34:33 2018 +0300

    ARC: Explicitly add -mmedium-calls to CFLAGS
    
    [ Upstream commit 74c11e300c103af47db5b658fdcf28002421e250 ]
    
    GCC built for arc*-*-linux has "-mmedium-calls" implicitly enabled by default
    thus we don't see any problems during Linux kernel compilation.
    ----------------------------->8------------------------
    arc-linux-gcc -mcpu=arc700 -Q --help=target | grep calls
      -mlong-calls                          [disabled]
      -mmedium-calls                        [enabled]
    ----------------------------->8------------------------
    
    But if we try to use so-called Elf32 toolchain with GCC configured for
    arc*-*-elf* then we'd see the following failure:
    ----------------------------->8------------------------
    init/do_mounts.o: In function 'init_rootfs':
    do_mounts.c:(.init.text+0x108): relocation truncated to fit: R_ARC_S21W_PCREL
    against symbol 'unregister_filesystem' defined in .text section in fs/filesystems.o
    
    arc-elf32-ld: final link failed: Symbol needs debug section which does not exist
    make: *** [vmlinux] Error 1
    ----------------------------->8------------------------
    
    That happens because neither "-mmedium-calls" nor "-mlong-calls" are enabled in
    Elf32 GCC:
    ----------------------------->8------------------------
    arc-elf32-gcc -mcpu=arc700 -Q --help=target | grep calls
      -mlong-calls                          [disabled]
      -mmedium-calls                        [disabled]
    ----------------------------->8------------------------
    
    Now to make it possible to use Elf32 toolchain for building Linux kernel
    we're explicitly add "-mmedium-calls" to CFLAGS.
    
    And since we add "-mmedium-calls" to the global CFLAGS there's no point in
    having per-file copies thus removing them.
    
    Signed-off-by: Alexey Brodkin <abrodkin@synopsys.com>
    Signed-off-by: Vineet Gupta <vgupta@synopsys.com>
    
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 519114dff49bba79efdeeed651bf81e92c336214
Author: Maciej Purski <m.purski@samsung.com>
Date:   Wed Nov 22 10:08:38 2017 +0100

    drm/bridge/sii8620: fix potential buffer overflow
    
    [ Upstream commit 9378cecb1ce5d618b8aff4d65113ddcf72fc1011 ]
    
    Buffer overflow error should not occur, as mode_fixup() callback
    filters pixel clock value and it should never exceed 600000. However,
    current implementation is not obviously safe and relies on
    implementation of mode_fixup().
    
    Make 'i' variable never reach unsafe value in order to avoid buffer
    overflow error.
    
    Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
    Fixes: bf1722ca ("drm/bridge/sii8620: rewrite hdmi start sequence")
    Signed-off-by: Maciej Purski <m.purski@samsung.com>
    Signed-off-by: Andrzej Hajda <a.hajda@samsung.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/1511341718-6974-1-git-send-email-m.purski@samsung.com
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a5a1d971734d11a85353b352fa04814afa4dcd8d
Author: Maciej Purski <m.purski@samsung.com>
Date:   Fri Feb 2 11:54:25 2018 +0100

    drm/bridge/sii8620: fix display modes validation
    
    [ Upstream commit ecba7cfa3afbe489288f2c819158b7402afd7ee9 ]
    
    Current implementation of mode_valid() and mode_fixup() callbacks
    handle packed pixel modes improperly.
    
    Fix it by using proper maximum clock values from the documentation.
    
    Signed-off-by: Maciej Purski <m.purski@samsung.com>
    Signed-off-by: Andrzej Hajda <a.hajda@samsung.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/1517568865-25219-1-git-send-email-m.purski@samsung.com
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c230e103e0bf2047d688754bdc1121472649744d
Author: Andrzej Hajda <a.hajda@samsung.com>
Date:   Mon Jan 15 18:33:57 2018 +0100

    drm/bridge/sii8620: fix loops in EDID fetch logic
    
    [ Upstream commit 8e627a1b1ce8feb3e1da4428b71b9b4905f04888 ]
    
    Function should constantly check if cable is connected and finish
    in finite time.
    
    Signed-off-by: Andrzej Hajda <a.hajda@samsung.com>
    Tested-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Reviewed-by: Maciej Purski <m.purski@samsung.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20180115173357.31067-4-a.hajda@samsung.com
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 94c8a7cc35f66ca736f015db62989acf6a21d17a
Author: Julia Lawall <Julia.Lawall@lip6.fr>
Date:   Sun Jun 10 16:24:15 2018 +0200

    clocksource/drivers/stm32: Fix error return code
    
    [ Upstream commit a26ed66c20f080c510fcf5bd448bce204f2c19d7 ]
    
    Return an error code on failure.
    
    Problem found using Coccinelle.
    
    Signed-off-by: Julia Lawall <Julia.Lawall@lip6.fr>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Cc: Daniel Lezcano <daniel.lezcano@linaro.org>
    Cc: kernel-janitors@vger.kernel.org
    Cc: Maxime Coquelin <mcoquelin.stm32@gmail.com>
    Cc: Alexandre Torgue <alexandre.torgue@st.com>
    Cc: linux-arm-kernel@lists.infradead.org
    Link: https://lkml.kernel.org/r1528640655-18948-3-git-send-email-Julia.Lawall@lip6.fr
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bae5e4e5249212049328af37ddb0307497d4dc3b
Author: Christophe Jaillet <christophe.jaillet@wanadoo.fr>
Date:   Mon Jun 11 20:15:11 2018 +0200

    IB/mlx4: Fix an error handling path in 'mlx4_ib_rereg_user_mr()'
    
    [ Upstream commit 3dc7c7badb7502ec3e3aa817a8bdd9e53aa54c52 ]
    
    Before returning -EPERM we should release some resources, as already done
    in the other error handling path of the function.
    
    Fixes: d8f9cc328c88 ("IB/mlx4: Mark user MR as writable if actual virtual memory is writable")
    Signed-off-by: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a8e1259744bd0cf33b3e171dc63f04c33b83dcc0
Author: Lucas Stach <l.stach@pengutronix.de>
Date:   Tue Jun 5 10:34:54 2018 -0700

    Input: synaptics-rmi4 - fix axis-swap behavior
    
    [ Upstream commit 645a397d325db6e1bb36588095ae637738b37693 ]
    
    The documentation for the touchscreen-swapped-x-y property states that
    swapping is done after inverting if both are used. RMI4 did it the other
    way around, leading to inconsistent behavior with regard to other
    touchscreens.
    
    Signed-off-by: Lucas Stach <l.stach@pengutronix.de>
    Tested-by: Nick Dyer <nick@shmanahar.org>
    Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 79510753fefd774c5baa87bddf12095fadd5230e
Author: Kalderon, Michal <Michal.Kalderon@cavium.com>
Date:   Mon Jun 11 10:20:20 2018 +0300

    RDMA/qedr: Fix NULL pointer dereference when running over iWARP without RDMA-CM
    
    [ Upstream commit 425cf5c1350a98b81f3ddda160b99c3be613a213 ]
    
    Some RoCE specific code in qedr_modify_qp was run over an iWARP device
    when running perftest benchmarks without the -R option.
    
    The commit 3e44e0ee0893 ("IB/providers: Avoid null netdev check for RoCE")
    exposed this. Dropping the check for NULL pointer on ndev in
    qedr_modify_qp lead to a null pointer dereference when running over
    iWARP. Before the code would identify ndev as being NULL and return an
    error.
    
    Fixes: 3e44e0ee0893 ("IB/providers: Avoid null netdev check for RoCE")
    Signed-off-by: Ariel Elior <Ariel.Elior@cavium.com>
    Signed-off-by: Michal Kalderon <Michal.Kalderon@cavium.com>
    Reviewed-by: Parav Pandit <parav@mellanox.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 460f9d55796e7a6be12b171cbc895a502f8e1788
Author: Zhu Yanjun <yanjun.zhu@oracle.com>
Date:   Thu Jun 7 02:32:52 2018 -0400

    IB/rxe: avoid double kfree skb
    
    [ Upstream commit 828d810550abc1fffff9b20545fec4bc150d5e82 ]
    
    In rxe_send, when network_type is not RDMA_NETWORK_IPV4 or
    RDMA_NETWORK_IPV6, skb is freed and -EINVAL is returned.
    Then rxe_xmit_packet will return -EINVAL, too. In rxe_requester,
    this skb is double freed.
    In rxe_requester, kfree_skb is needed only after fill_packet fails.
    So kfree_skb is moved from label err to test fill_packet.
    
    Fixes: 5793b4652155 ("IB/rxe: remove unnecessary skb_clone in xmit")
    Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Zhu Yanjun <yanjun.zhu@oracle.com>
    Reviewed-by: Leon Romanovsky <leonro@mellanox.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fd58a83990eef58ff19341efc1d4230d5004e6d5
Author: Nicolas Boichat <drinkcat@chromium.org>
Date:   Fri Jun 8 08:14:50 2018 +0800

    HID: google: Add support for whiskers
    
    [ Upstream commit 3e84c7651dde7cca43c5cfd7385086599cce5a5d ]
    
    Another device in the hammer class, with USB id 0x5030.
    
    Signed-off-by: Nicolas Boichat <drinkcat@chromium.org>
    Acked-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9f0ec571caf705f3b46e70ece055445b2280af70
Author: Jiri Olsa <jolsa@kernel.org>
Date:   Thu Jun 7 00:15:05 2018 +0200

    perf tools: Fix error index for pmu event parser
    
    [ Upstream commit f7fa827f5f432a0b1f34e10fc49da93aeef9f817 ]
    
    For events we provide specific error message we need to set error column
    index, PMU parser is missing that, adding it.
    
    Before:
    
      $ perf stat -e cycles,krava/cycles/ kill
      event syntax error: 'cycles,krava/cycles/'
                           \___ Cannot find PMU `krava'. Missing kernel support?
    
    After:
    
      $ perf stat -e cycles,krava/cycles/ kill
      event syntax error: 'cycles,krava/cycles/'
                                  \___ Cannot find PMU `krava'. Missing kernel support?
    
    Signed-off-by: Jiri Olsa <jolsa@kernel.org>
    Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Andi Kleen <andi@firstfloor.org>
    Cc: David Ahern <dsahern@gmail.com>
    Cc: Frederic Weisbecker <frederic@kernel.org>
    Cc: Milian Wolff <milian.wolff@kdab.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Stephane Eranian <eranian@google.com>
    Link: http://lkml.kernel.org/r/20180606221513.11302-3-jolsa@kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5d2c644ec0657ec0cddea9b37c61e398fdd3941f
Author: Dong Jia Shi <bjsdjshi@linux.vnet.ibm.com>
Date:   Wed May 2 09:25:59 2018 +0200

    vfio: ccw: fix error return in vfio_ccw_sch_event
    
    [ Upstream commit 2c861d89ccda2fbcea9358eff9cc5f8fae548be5 ]
    
    If the device has not been registered, or there is work pending,
    we should reschedule a sch_event call again.
    
    Signed-off-by: Dong Jia Shi <bjsdjshi@linux.vnet.ibm.com>
    Message-Id: <20180502072559.50691-1-bjsdjshi@linux.vnet.ibm.com>
    Reviewed-by: Cornelia Huck <cohuck@redhat.com>
    Signed-off-by: Cornelia Huck <cohuck@redhat.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d887fef5103f65abf4711c604aa29c1c4ed499d7
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Fri May 25 16:01:47 2018 +0530

    arm: dts: armada: Fix "#cooling-cells" property's name
    
    [ Upstream commit ac62cc9d9cd6fa4c79e171c13dc8d58c3862b678 ]
    
    It should be "#cooling-cells" instead of "cooling-cells". Fix it.
    
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Gregory CLEMENT <gregory.clement@bootlin.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
