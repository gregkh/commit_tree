commit 11bfbae19413a2ffe70378b6e572be263869a2bc
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Fri Oct 7 15:23:59 2016 +0200

    Linux 4.4.24

commit 9c5d43504bbbb20bc1f9fa4f7cc79b4e35860c48
Author: Takashi Iwai <tiwai@suse.de>
Date:   Tue Sep 27 16:44:49 2016 +0200

    ALSA: hda - Add the top speaker pin config for HP Spectre x360
    
    commit 0eec880966e77bdbee0112989a2be67d92e39929 upstream.
    
    HP Spectre x360 with CX20724 codec has two speaker outputs while the
    BIOS sets up only the bottom one (NID 0x17) and disables the top one
    (NID 0x1d).
    
    This patch adds a fixup simply defining the proper pincfg for NID 0x1d
    so that the top speaker works as is.
    
    Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=169071
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a891b8c1d1231bd8ac90dd72f1f2eee870390ffd
Author: Hui Wang <hui.wang@canonical.com>
Date:   Sun Sep 11 11:26:16 2016 +0800

    ALSA: hda - Fix headset mic detection problem for several Dell laptops
    
    commit 3f640970a41429f0a076c01270bbd014c9eae61c upstream.
    
    One of the laptops has the codec ALC256 on it, applying the
    ALC255_FIXUP_DELL1_MIC_NO_PRESENCE can fix the problem, the rest
    of laptops have the codec ALC295 on them, they are similar to machines
    with ALC225, applying the ALC269_FIXUP_DELL1_MIC_NO_PRESENCE can fix
    the problem.
    
    Signed-off-by: Hui Wang <hui.wang@canonical.com>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 97864aaff3fbbb11bff26963e769cbf7ffe75c26
Author: Prarit Bhargava <prarit@redhat.com>
Date:   Tue Dec 29 13:52:41 2015 +0800

    ACPICA: acpi_get_sleep_type_data: Reduce warnings
    
    commit a59b679ab85635737947310323f2f2bcfa0664a7 upstream.
    
    ACPICA commit 7bb77313091e52a846df4c9c2bea90be31bfb9d8
    
    Eliminate warnings for "not found" _Sx errors, since these
    are optional. Original NOT_FOUND status is still returned.
    
    Original changes by Prarit Bhargava.
    ACPICA BZ 1208.
    
    Link: https://github.com/acpica/acpica/commit/7bb77313
    Link: https://bugs.acpica.org/show_bug.cgi?id=1208
    Signed-off-by: Prarit Bhargava <prarit@redhat.com>
    Signed-off-by: Bob Moore <robert.moore@intel.com>
    Signed-off-by: Lv Zheng <lv.zheng@intel.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Cc: "Charles (Chas) Williams" <ciwillia@brocade.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e9a2ea31cea0887ca8923ff462d4e17b47a76b2b
Author: Hui Wang <hui.wang@canonical.com>
Date:   Mon Sep 26 10:59:38 2016 +0800

    ALSA: hda - Adding one more ALC255 pin definition for headset problem
    
    commit 392c9da24a994f238c5d7ea611c6245be4617014 upstream.
    
    We have two new Dell laptop models, they have the same ALC255 pin
    definition, but not in the pin quirk table yet, as a result, the
    headset microphone can't work. After adding the definition in the
    table, the headset microphone works well.
    
    Signed-off-by: Hui Wang <hui.wang@canonical.com>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ef3c14db4143830da8e4ed4f6b323efce790c80b
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Wed Sep 28 11:48:44 2016 +0200

    Revert "usbtmc: convert to devm_kzalloc"
    
    commit ab21b63e8aedfc73565dd9cdd51eb338341177cb upstream.
    
    This reverts commit e6c7efdcb76f11b04e3d3f71c8d764ab75c9423b.
    
    Turns out it was totally wrong.  The memory is supposed to be bound to
    the kref, as the original code was doing correctly, not the
    device/driver binding as the devm_kzalloc() would cause.
    
    This fixes an oops when read would be called after the device was
    unbound from the driver.
    
    Reported-by: Ladislav Michl <ladis@linux-mips.org>
    Cc: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 30d25aed0f9bea51323c6d12c73246dade78d316
Author: Kyle Jones <kyle@kf5jwc.us>
Date:   Fri Sep 23 13:28:37 2016 -0500

    USB: serial: cp210x: Add ID for a Juniper console
    
    commit decc5360f23e9efe0252094f47f57f254dcbb3a9 upstream.
    
    Signed-off-by: Kyle Jones <kyle@kf5jwc.us>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit be93c69e9ba41fcf501f855ba47f068e5f75b13f
Author: Ksenija Stanojevic <ksenija.stanojevic@gmail.com>
Date:   Sun Oct 2 17:42:35 2016 +0200

    Staging: fbtft: Fix bug in fbtft-core
    
    commit fc1e2c8ea85e109acf09e74789e9b852f6eed251 upstream.
    
    Commit 367e8560e8d7a62d96e9b1d644028a3816e04206 introduced a bug
    in fbtft-core where fps is always 0, this is because variable
    update_time is not assigned correctly.
    
    Signed-off-by: Ksenija Stanojevic <ksenija.stanojevic@gmail.com>
    Fixes: 367e8560e8d7 ("Staging: fbtbt: Replace timespec with ktime_t")
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 62dd9cf78b280c8cd08162f8c4a490fb76deeb23
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Mon Sep 19 19:09:51 2016 +0100

    usb: misc: legousbtower: Fix NULL pointer deference
    
    commit 2fae9e5a7babada041e2e161699ade2447a01989 upstream.
    
    This patch fixes a NULL pointer dereference caused by a race codition in
    the probe function of the legousbtower driver. It re-structures the
    probe function to only register the interface after successfully reading
    the board's firmware ID.
    
    The probe function does not deregister the usb interface after an error
    receiving the devices firmware ID. The device file registered
    (/dev/usb/legousbtower%d) may be read/written globally before the probe
    function returns. When tower_delete is called in the probe function
    (after an r/w has been initiated), core dev structures are deleted while
    the file operation functions are still running. If the 0 address is
    mappable on the machine, this vulnerability can be used to create a
    Local Priviege Escalation exploit via a write-what-where condition by
    remapping dev->interrupt_out_buffer in tower_write. A forged USB device
    and local program execution would be required for LPE. The USB device
    would have to delay the control message in tower_probe and accept
    the control urb in tower_open whilst guest code initiated a write to the
    device file as tower_delete is called from the error in tower_probe.
    
    This bug has existed since 2003. Patch tested by emulated device.
    
    Reported-by: James Patrick-Evans <james@jmp-e.com>
    Tested-by: James Patrick-Evans <james@jmp-e.com>
    Signed-off-by: James Patrick-Evans <james@jmp-e.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f1f1c35ba5496072579ba6c0493e06d8f6597acc
Author: Konstantin Shkolnyy <konstantin.shkolnyy@gmail.com>
Date:   Wed May 4 16:56:52 2016 -0500

    USB: serial: cp210x: fix hardware flow-control disable
    
    commit a377f9e906af4df9071ba8ddba60188cb4013d93 upstream.
    
    A bug in the CRTSCTS handling caused RTS to alternate between
    
    CRTSCTS=0 => "RTS is transmit active signal" and
    CRTSCTS=1 => "RTS is used for receive flow control"
    
    instead of
    
    CRTSCTS=0 => "RTS is statically active" and
    CRTSCTS=1 => "RTS is used for receive flow control"
    
    This only happened after first having enabled CRTSCTS.
    
    Signed-off-by: Konstantin Shkolnyy <konstantin.shkolnyy@gmail.com>
    Fixes: 39a66b8d22a3 ("[PATCH] USB: CP2101 Add support for flow control")
    [johan: reword commit message ]
    Signed-off-by: Johan Hovold <johan@kernel.org>
    [johan: backport to 4.4 ]
    Signed-off-by: Johan Hovold <johan@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7eb0153fc42d98d301a5ca946ed31366cd33526f
Author: Mikulas Patocka <mpatocka@redhat.com>
Date:   Tue Aug 30 16:20:55 2016 -0400

    dm log writes: fix bug with too large bios
    
    commit 7efb367320f56fc4d549875b6f3a6940018ef2e5 upstream.
    
    bio_alloc() can allocate a bio with at most BIO_MAX_PAGES (256) vector
    entries.  However, the incoming bio may have more vector entries if it
    was allocated by other means.  For example, bcache submits bios with
    more than BIO_MAX_PAGES entries.  This results in bio_alloc() failure.
    
    To avoid the failure, change the code so that it allocates bio with at
    most BIO_MAX_PAGES entries.  If the incoming bio has more entries,
    bio_add_page() will fail and a new bio will be allocated - the code that
    handles bio_add_page() failure already exists in the dm-log-writes
    target.
    
    Signed-off-by: Mikulas Patocka <mpatocka@redhat.com>
    Reviewed-by: Josef Bacik <jbacik@fb.com>
    Signed-off-by: Mike Snitzer <snitzer@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bceea9fee1c606f567a156b7dee9c9564a2f5c19
Author: Loc Ho <lho@apm.com>
Date:   Mon Feb 29 14:15:43 2016 -0700

    clk: xgene: Add missing parenthesis when clearing divider value
    
    commit 0f4c7a138dfefb0ebdbaf56e3ba2acd2958a6605 upstream.
    
    In the initial fix for non-zero divider shift value, the parenthesis
    was missing after the negate operation. This patch adds the required
    parenthesis. Otherwise, lower bits may be cleared unintentionally.
    
    Signed-off-by: Loc Ho <lho@apm.com>
    Acked-by: Toan Le <toanle@apm.com>
    Fixes: 1382ea631ddd ("clk: xgene: Fix divider with non-zero shift value")
    Signed-off-by: Stephen Boyd <sboyd@codeaurora.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0d9529e1b881ae80b40270b55dcbf7468be0099c
Author: Jann Horn <jann@thejh.net>
Date:   Fri Sep 16 00:31:22 2016 +0200

    aio: mark AIO pseudo-fs noexec
    
    commit 22f6b4d34fcf039c63a94e7670e0da24f8575a5a upstream.
    
    This ensures that do_mmap() won't implicitly make AIO memory mappings
    executable if the READ_IMPLIES_EXEC personality flag is set.  Such
    behavior is problematic because the security_mmap_file LSM hook doesn't
    catch this case, potentially permitting an attacker to bypass a W^X
    policy enforced by SELinux.
    
    I have tested the patch on my machine.
    
    To test the behavior, compile and run this:
    
        #define _GNU_SOURCE
        #include <unistd.h>
        #include <sys/personality.h>
        #include <linux/aio_abi.h>
        #include <err.h>
        #include <stdlib.h>
        #include <stdio.h>
        #include <sys/syscall.h>
    
        int main(void) {
            personality(READ_IMPLIES_EXEC);
            aio_context_t ctx = 0;
            if (syscall(__NR_io_setup, 1, &ctx))
                err(1, "io_setup");
    
            char cmd[1000];
            sprintf(cmd, "cat /proc/%d/maps | grep -F '/[aio]'",
                (int)getpid());
            system(cmd);
            return 0;
        }
    
    In the output, "rw-s" is good, "rwxs" is bad.
    
    Signed-off-by: Jann Horn <jann@thejh.net>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9d7bb7e47fbb58d8b0d89c6b686ea48caf0cffcd
Author: Marek Lindner <mareklindner@neomailbox.ch>
Date:   Mon May 2 21:58:50 2016 +0800

    batman-adv: remove unused callback from batadv_algo_ops struct
    
    commit d9f179877e50ae2681fe7b0b83e0d9f63b6165ad upstream.
    
    Reported-by: Lars Bußmann <ffsoest@kill-you.net>
    Signed-off-by: Marek Lindner <mareklindner@neomailbox.ch>
    [sven@narfation.org: rewritten commit message to make clear that it is an
     bugfix to an user reported crash]
    Signed-off-by: Sven Eckelmann <sven@narfation.org>
    Signed-off-by: Simon Wunderlich <sw@simonwunderlich.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6bec514a1e08e1949835fab6744c3fd0a7655273
Author: Jack Morgenstein <jackm@dev.mellanox.co.il>
Date:   Mon Sep 12 19:16:20 2016 +0300

    IB/mlx4: Use correct subnet-prefix in QP1 mads under SR-IOV
    
    commit 8ec07bf8a8b57d6c58927a16a0a22c0115cf2855 upstream.
    
    When sending QP1 MAD packets which use a GRH, the source GID
    (which consists of the 64-bit subnet prefix, and the 64 bit port GUID)
    must be included in the packet GRH.
    
    For SR-IOV, a GID cache is used, since the source GID needs to be the
    slave's source GID, and not the Hypervisor's GID. This cache also
    included a subnet_prefix. Unfortunately, the subnet_prefix field in
    the cache was never initialized (to the default subnet prefix 0xfe80::0).
    As a result, this field remained all zeroes.  Therefore, when SR-IOV
    was active, all QP1 packets which included a GRH had a source GID
    subnet prefix of all-zeroes.
    
    However, the subnet-prefix should initially be 0xfe80::0 (the default
    subnet prefix). In addition, if OpenSM modifies a port's subnet prefix,
    the new subnet prefix must be used in the GRH when sending QP1 packets.
    To fix this we now initialize the subnet prefix in the SR-IOV GID cache
    to the default subnet prefix. We update the cached value if/when OpenSM
    modifies the port's subnet prefix. We take this cached value when sending
    QP1 packets when SR-IOV is active.
    
    Note that the value is stored as an atomic64. This eliminates any need
    for locking when the subnet prefix is being updated.
    
    Note also that we depend on the FW generating the "port management change"
    event for tracking subnet-prefix changes performed by OpenSM. If running
    early FW (before 2.9.4630), subnet prefix changes will not be tracked (but
    the default subnet prefix still will be stored in the cache; therefore
    users who do not modify the subnet prefix will not have a problem).
    IF there is a need for such tracking also for early FW, we will add that
    capability in a subsequent patch.
    
    Fixes: 1ffeb2eb8be9 ("IB/mlx4: SR-IOV IB context objects and proxy/tunnel SQP support")
    Signed-off-by: Jack Morgenstein <jackm@dev.mellanox.co.il>
    Signed-off-by: Leon Romanovsky <leon@kernel.org>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 061a9f3e88e4fa4a2d9ecb1d2fd2975eec51008f
Author: Jack Morgenstein <jackm@dev.mellanox.co.il>
Date:   Mon Sep 12 19:16:19 2016 +0300

    IB/mlx4: Fix code indentation in QP1 MAD flow
    
    commit baa0be7026e2f7d1d40bfd45909044169e9e3c68 upstream.
    
    The indentation in the QP1 GRH flow in procedure build_mlx_header is
    really confusing. Fix it, in preparation for a commit which touches
    this code.
    
    Fixes: 1ffeb2eb8be9 ("IB/mlx4: SR-IOV IB context objects and proxy/tunnel SQP support")
    Signed-off-by: Jack Morgenstein <jackm@dev.mellanox.co.il>
    Signed-off-by: Leon Romanovsky <leon@kernel.org>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5626aff4b5f54db42cd4816cff3fb5b1f63768f9
Author: Alex Vesker <valex@mellanox.com>
Date:   Mon Sep 12 19:16:18 2016 +0300

    IB/mlx4: Fix incorrect MC join state bit-masking on SR-IOV
    
    commit e5ac40cd66c2f3cd11bc5edc658f012661b16347 upstream.
    
    Because of an incorrect bit-masking done on the join state bits, when
    handling a join request we failed to detect a difference between the
    group join state and the request join state when joining as send only
    full member (0x8). This caused the MC join request not to be sent.
    This issue is relevant only when SRIOV is enabled and SM supports
    send only full member.
    
    This fix separates scope bits and join states bits a nibble each.
    
    Fixes: b9c5d6a64358 ('IB/mlx4: Add multicast group (MCG) paravirtualization for SR-IOV')
    Signed-off-by: Alex Vesker <valex@mellanox.com>
    Signed-off-by: Leon Romanovsky <leon@kernel.org>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 87160fb51bc343793cc8f5f031a87f1a35aecb82
Author: Alex Vesker <valex@mellanox.com>
Date:   Mon Sep 12 09:55:28 2016 +0300

    IB/ipoib: Don't allow MC joins during light MC flush
    
    commit 344bacca8cd811809fc33a249f2738ab757d327f upstream.
    
    This fix solves a race between light flush and on the fly joins.
    Light flush doesn't set the device to down and unset IPOIB_OPER_UP
    flag, this means that if while flushing we have a MC join in progress
    and the QP was attached to BC MGID we can have a mismatches when
    re-attaching a QP to the BC MGID.
    
    The light flush would set the broadcast group to NULL causing an on
    the fly join to rejoin and reattach to the BC MCG as well as adding
    the BC MGID to the multicast list. The flush process would later on
    remove the BC MGID and detach it from the QP. On the next flush
    the BC MGID is present in the multicast list but not found when trying
    to detach it because of the previous double attach and single detach.
    
    [18332.714265] ------------[ cut here ]------------
    [18332.717775] WARNING: CPU: 6 PID: 3767 at drivers/infiniband/core/verbs.c:280 ib_dealloc_pd+0xff/0x120 [ib_core]
    ...
    [18332.775198] Hardware name: Red Hat KVM, BIOS Bochs 01/01/2011
    [18332.779411]  0000000000000000 ffff8800b50dfbb0 ffffffff813fed47 0000000000000000
    [18332.784960]  0000000000000000 ffff8800b50dfbf0 ffffffff8109add1 0000011832f58300
    [18332.790547]  ffff880226a596c0 ffff880032482000 ffff880032482830 ffff880226a59280
    [18332.796199] Call Trace:
    [18332.798015]  [<ffffffff813fed47>] dump_stack+0x63/0x8c
    [18332.801831]  [<ffffffff8109add1>] __warn+0xd1/0xf0
    [18332.805403]  [<ffffffff8109aebd>] warn_slowpath_null+0x1d/0x20
    [18332.809706]  [<ffffffffa025d90f>] ib_dealloc_pd+0xff/0x120 [ib_core]
    [18332.814384]  [<ffffffffa04f3d7c>] ipoib_transport_dev_cleanup+0xfc/0x1d0 [ib_ipoib]
    [18332.820031]  [<ffffffffa04ed648>] ipoib_ib_dev_cleanup+0x98/0x110 [ib_ipoib]
    [18332.825220]  [<ffffffffa04e62c8>] ipoib_dev_cleanup+0x2d8/0x550 [ib_ipoib]
    [18332.830290]  [<ffffffffa04e656f>] ipoib_uninit+0x2f/0x40 [ib_ipoib]
    [18332.834911]  [<ffffffff81772a8a>] rollback_registered_many+0x1aa/0x2c0
    [18332.839741]  [<ffffffff81772bd1>] rollback_registered+0x31/0x40
    [18332.844091]  [<ffffffff81773b18>] unregister_netdevice_queue+0x48/0x80
    [18332.848880]  [<ffffffffa04f489b>] ipoib_vlan_delete+0x1fb/0x290 [ib_ipoib]
    [18332.853848]  [<ffffffffa04df1cd>] delete_child+0x7d/0xf0 [ib_ipoib]
    [18332.858474]  [<ffffffff81520c08>] dev_attr_store+0x18/0x30
    [18332.862510]  [<ffffffff8127fe4a>] sysfs_kf_write+0x3a/0x50
    [18332.866349]  [<ffffffff8127f4e0>] kernfs_fop_write+0x120/0x170
    [18332.870471]  [<ffffffff81207198>] __vfs_write+0x28/0xe0
    [18332.874152]  [<ffffffff810e09bf>] ? percpu_down_read+0x1f/0x50
    [18332.878274]  [<ffffffff81208062>] vfs_write+0xa2/0x1a0
    [18332.881896]  [<ffffffff812093a6>] SyS_write+0x46/0xa0
    [18332.885632]  [<ffffffff810039b7>] do_syscall_64+0x57/0xb0
    [18332.889709]  [<ffffffff81883321>] entry_SYSCALL64_slow_path+0x25/0x25
    [18332.894727] ---[ end trace 09ebbe31f831ef17 ]---
    
    Fixes: ee1e2c82c245 ("IPoIB: Refresh paths instead of flushing them on SM change events")
    Signed-off-by: Alex Vesker <valex@mellanox.com>
    Signed-off-by: Leon Romanovsky <leon@kernel.org>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 23bd03de926aacbea149e3bab29f05132885177c
Author: Erez Shitrit <erezsh@mellanox.com>
Date:   Sun Aug 28 10:58:30 2016 +0300

    IB/core: Fix use after free in send_leave function
    
    commit 68c6bcdd8bd00394c234b915ab9b97c74104130c upstream.
    
    The function send_leave sets the member: group->query_id
    (group->query_id = ret) after calling the sa_query, but leave_handler
    can be executed before the setting and it might delete the group object,
    and will get a memory corruption.
    
    Additionally, this patch gets rid of group->query_id variable which is
    not used.
    
    Fixes: faec2f7b96b5 ('IB/sa: Track multicast join/leave requests')
    Signed-off-by: Erez Shitrit <erezsh@mellanox.com>
    Signed-off-by: Leon Romanovsky <leon@kernel.org>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 79b993c132a79a4eaf8a1d3489b8cced7b5adad8
Author: Erez Shitrit <erezsh@mellanox.com>
Date:   Sun Aug 28 10:58:31 2016 +0300

    IB/ipoib: Fix memory corruption in ipoib cm mode connect flow
    
    commit 546481c2816ea3c061ee9d5658eb48070f69212e upstream.
    
    When a new CM connection is being requested, ipoib driver copies data
    from the path pointer in the CM/tx object, the path object might be
    invalid at the point and memory corruption will happened later when now
    the CM driver will try using that data.
    
    The next scenario demonstrates it:
            neigh_add_path --> ipoib_cm_create_tx -->
            queue_work (pointer to path is in the cm/tx struct)
            #while the work is still in the queue,
            #the port goes down and causes the ipoib_flush_paths:
            ipoib_flush_paths --> path_free --> kfree(path)
            #at this point the work scheduled starts.
            ipoib_cm_tx_start --> copy from the (invalid)path pointer:
            (memcpy(&pathrec, &p->path->pathrec, sizeof pathrec);)
             -> memory corruption.
    
    To fix that the driver now starts the CM/tx connection only if that
    specific path exists in the general paths database.
    This check is protected with the relevant locks, and uses the gid from
    the neigh member in the CM/tx object which is valid according to the ref
    count that was taken by the CM/tx.
    
    Fixes: 839fcaba35 ('IPoIB: Connected mode experimental support')
    Signed-off-by: Erez Shitrit <erezsh@mellanox.com>
    Signed-off-by: Leon Romanovsky <leon@kernel.org>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ae9ba37c044fdad5b760d34a27ef65b54ccaa5fe
Author: Radim Krčmář <rkrcmar@redhat.com>
Date:   Mon Aug 8 20:16:23 2016 +0200

    KVM: nVMX: postpone VMCS changes on MSR_IA32_APICBASE write
    
    commit dccbfcf52cebb8963246eba5b177b77f26b34da0 upstream.
    
    If vmcs12 does not intercept APIC_BASE writes, then KVM will handle the
    write with vmcs02 as the current VMCS.
    This will incorrectly apply modifications intended for vmcs01 to vmcs02
    and L2 can use it to gain access to L0's x2APIC registers by disabling
    virtualized x2APIC while using msr bitmap that assumes enabled.
    
    Postpone execution of vmx_set_virtual_x2apic_mode until vmcs01 is the
    current VMCS.  An alternative solution would temporarily make vmcs01 the
    current VMCS, but it requires more care.
    
    Fixes: 8d14695f9542 ("x86, apicv: add virtual x2apic support")
    Reported-by: Jim Mattson <jmattson@google.com>
    Reviewed-by: Wanpeng Li <wanpeng.li@hotmail.com>
    Signed-off-by: Radim Krčmář <rkrcmar@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 564d03966e4446eae39bc9c1a5b6f607eb0eb961
Author: Wei Yongjun <weiyj.lk@gmail.com>
Date:   Wed Aug 10 03:17:09 2016 +0000

    dmaengine: at_xdmac: fix to pass correct device identity to free_irq()
    
    commit 6a8b0c6b18f62a277ffb2139d0c0253fe35d7feb upstream.
    
    free_irq() expects the same device identity that was passed to
    corresponding request_irq(), otherwise the IRQ is not freed.
    
    Fixes: e1f7c9eee707 ("dmaengine: at_xdmac: creation of the atmel eXtended DMA Controller driver")
    Signed-off-by: Wei Yongjun <weiyj.lk@gmail.com>
    Acked-by: Ludovic Desroches <ludovic.desroches@atmel.com>
    Signed-off-by: Vinod Koul <vinod.koul@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 82b7839a4063855b666f5bd2d309871cbbe21eff
Author: Michal Hocko <mhocko@suse.com>
Date:   Thu Sep 1 16:15:13 2016 -0700

    kernel/fork: fix CLONE_CHILD_CLEARTID regression in nscd
    
    commit 735f2770a770156100f534646158cb58cb8b2939 upstream.
    
    Commit fec1d0115240 ("[PATCH] Disable CLONE_CHILD_CLEARTID for abnormal
    exit") has caused a subtle regression in nscd which uses
    CLONE_CHILD_CLEARTID to clear the nscd_certainly_running flag in the
    shared databases, so that the clients are notified when nscd is
    restarted.  Now, when nscd uses a non-persistent database, clients that
    have it mapped keep thinking the database is being updated by nscd, when
    in fact nscd has created a new (anonymous) one (for non-persistent
    databases it uses an unlinked file as backend).
    
    The original proposal for the CLONE_CHILD_CLEARTID change claimed
    (https://lkml.org/lkml/2006/10/25/233):
    
    : The NPTL library uses the CLONE_CHILD_CLEARTID flag on clone() syscalls
    : on behalf of pthread_create() library calls.  This feature is used to
    : request that the kernel clear the thread-id in user space (at an address
    : provided in the syscall) when the thread disassociates itself from the
    : address space, which is done in mm_release().
    :
    : Unfortunately, when a multi-threaded process incurs a core dump (such as
    : from a SIGSEGV), the core-dumping thread sends SIGKILL signals to all of
    : the other threads, which then proceed to clear their user-space tids
    : before synchronizing in exit_mm() with the start of core dumping.  This
    : misrepresents the state of process's address space at the time of the
    : SIGSEGV and makes it more difficult for someone to debug NPTL and glibc
    : problems (misleading him/her to conclude that the threads had gone away
    : before the fault).
    :
    : The fix below is to simply avoid the CLONE_CHILD_CLEARTID action if a
    : core dump has been initiated.
    
    The resulting patch from Roland (https://lkml.org/lkml/2006/10/26/269)
    seems to have a larger scope than the original patch asked for.  It
    seems that limitting the scope of the check to core dumping should work
    for SIGSEGV issue describe above.
    
    [Changelog partly based on Andreas' description]
    Fixes: fec1d0115240 ("[PATCH] Disable CLONE_CHILD_CLEARTID for abnormal exit")
    Link: http://lkml.kernel.org/r/1471968749-26173-1-git-send-email-mhocko@kernel.org
    Signed-off-by: Michal Hocko <mhocko@suse.com>
    Tested-by: William Preston <wpreston@suse.com>
    Acked-by: Oleg Nesterov <oleg@redhat.com>
    Cc: Roland McGrath <roland@hack.frob.com>
    Cc: Andreas Schwab <schwab@suse.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit aa9d22b8bd2e49417bb26680d42593c9f77ce887
Author: Peter Ujfalusi <peter.ujfalusi@ti.com>
Date:   Tue Aug 23 10:27:19 2016 +0300

    ASoC: omap-mcpdm: Fix irq resource handling
    
    commit a8719670687c46ed2e904c0d05fa4cd7e4950cd1 upstream.
    
    Fixes: ddd17531ad908 ("ASoC: omap-mcpdm: Clean up with devm_* function")
    
    Managed irq request will not doing any good in ASoC probe level as it is
    not going to free up the irq when the driver is unbound from the sound
    card.
    
    Signed-off-by: Peter Ujfalusi <peter.ujfalusi@ti.com>
    Reported-by: Russell King <linux@armlinux.org.uk>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 70cd763eb1574cac07138be91f474a661e02d694
Author: Subash Abhinov Kasiviswanathan <subashab@codeaurora.org>
Date:   Thu Aug 25 15:16:51 2016 -0700

    sysctl: handle error writing UINT_MAX to u32 fields
    
    commit e7d316a02f683864a12389f8808570e37fb90aa3 upstream.
    
    We have scripts which write to certain fields on 3.18 kernels but this
    seems to be failing on 4.4 kernels.  An entry which we write to here is
    xfrm_aevent_rseqth which is u32.
    
      echo 4294967295  > /proc/sys/net/core/xfrm_aevent_rseqth
    
    Commit 230633d109e3 ("kernel/sysctl.c: detect overflows when converting
    to int") prevented writing to sysctl entries when integer overflow
    occurs.  However, this does not apply to unsigned integers.
    
    Heinrich suggested that we introduce a new option to handle 64 bit
    limits and set min as 0 and max as UINT_MAX.  This might not work as it
    leads to issues similar to __do_proc_doulongvec_minmax.  Alternatively,
    we would need to change the datatype of the entry to 64 bit.
    
      static int __do_proc_doulongvec_minmax(void *data, struct ctl_table
      {
          i = (unsigned long *) data;   //This cast is causing to read beyond the size of data (u32)
          vleft = table->maxlen / sizeof(unsigned long); //vleft is 0 because maxlen is sizeof(u32) which is lesser than sizeof(unsigned long) on x86_64.
    
    Introduce a new proc handler proc_douintvec.  Individual proc entries
    will need to be updated to use the new handler.
    
    [akpm@linux-foundation.org: coding-style fixes]
    Fixes: 230633d109e3 ("kernel/sysctl.c:detect overflows when converting to int")
    Link: http://lkml.kernel.org/r/1471479806-5252-1-git-send-email-subashab@codeaurora.org
    Signed-off-by: Subash Abhinov Kasiviswanathan <subashab@codeaurora.org>
    Cc: Heinrich Schuchardt <xypron.glpk@gmx.de>
    Cc: Kees Cook <keescook@chromium.org>
    Cc: "David S. Miller" <davem@davemloft.net>
    Cc: Ingo Molnar <mingo@redhat.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bef613a0bef4f45c2b73f3fddbe1f08938e0e08a
Author: Michael Ellerman <mpe@ellerman.id.au>
Date:   Fri Aug 12 21:45:52 2016 +1000

    powerpc/prom: Fix sub-processor option passed to ibm, client-architecture-support
    
    commit 66443efa83dc73775100b7442962ce2cb0d4472e upstream.
    
    When booting from an OpenFirmware which supports it, we use the
    "ibm,client-architecture-support" firmware call to communicate
    our capabilities to firmware.
    
    The format of the structure we pass to firmware is specified in
    PAPR (Power Architecture Platform Requirements), or the public version
    LoPAPR (Linux on Power Architecture Platform Reference).
    
    Referring to table 244 in LoPAPR v1.1, option vector 5 contains a 4 byte
    field at bytes 17-20 for the "Platform Facilities Enable". This is
    followed by a 1 byte field at byte 21 for "Sub-Processor Represenation
    Level".
    
    Comparing to the code, there we have the Platform Facilities
    options (OV5_PFO_*) at byte 17, but we fail to pad that field out to its
    full width of 4 bytes. This means the OV5_SUB_PROCESSORS option is
    incorrectly placed at byte 18.
    
    Fix it by adding zero bytes for bytes 18, 19, 20, and comment the bytes
    to hopefully make it clearer in future.
    
    As far as I'm aware nothing actually consumes this value at this time,
    so the effect of this bug is nil in practice.
    
    It does mean we've been incorrectly setting bit 15 of the "Platform
    Facilities Enable" option for the past ~3 1/2 years, so we should avoid
    allocating that bit to anything else in future.
    
    Fixes: df77c7992029 ("powerpc/pseries: Update ibm,architecture.vec for PAPR 2.7/POWER8")
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 32a57f4ed2f654685f200dc6ab0aed67364af570
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Mon Jul 18 16:24:37 2016 -0700

    brcmsmac: Initialize power in brcms_c_stf_ss_algo_channel_get()
    
    commit f823a2aa8f4674c095a5413b9e3ba12d82df06f2 upstream.
    
    wlc_phy_txpower_get_current() does a logical OR of power->flags, which
    presumes that power.flags was initiliazed earlier by the caller,
    unfortunately, this is not the case, so make sure we zero out the struct
    tx_power before calling into wlc_phy_txpower_get_current().
    
    Reported-by: coverity (CID 146011)
    Fixes: 5b435de0d7868 ("net: wireless: add brcm80211 drivers")
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Acked-by: Arend van Spriel <arend.vanspriel@broadcom.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3d0ef898fbbea4406e8a0b15201348bc30a2cadd
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Mon Jul 18 16:24:35 2016 -0700

    brcmsmac: Free packet if dma_mapping_error() fails in dma_rxfill
    
    commit 5c5fa1f464ac954982df1d96b9f9a5103d21aedd upstream.
    
    In case dma_mapping_error() returns an error in dma_rxfill, we would be
    leaking a packet that we allocated with brcmu_pkt_buf_get_skb().
    
    Reported-by: coverity (CID 1081819)
    Fixes: 67d0cf50bd32 ("brcmsmac: Fix WARNING caused by lack of calls to dma_mapping_error()")
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Acked-by: Arend van Spriel <arend@broadcom.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a6501617e689ad80c4d185e0d8f485e0d0b1a708
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Mon Jul 18 16:24:34 2016 -0700

    brcmfmac: Fix glob_skb leak in brcmf_sdiod_recv_chain
    
    commit 3bdae810721b33061d2e541bd78a70f86ca42af3 upstream.
    
    In case brcmf_sdiod_recv_chain() cannot complete a succeful call to
    brcmf_sdiod_buffrw, we would be leaking glom_skb and not free it as we
    should, fix this.
    
    Reported-by: coverity (CID 1164856)
    Fixes: a413e39a38573 ("brcmfmac: fix brcmf_sdcard_recv_chain() for host without sg support")
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Acked-by: Arend van Spriel <arend.vanspriel@broadcom.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 49fca97a99305c54fc6c060b492c5bc1b592b73d
Author: Wei Yongjun <weiyj.lk@gmail.com>
Date:   Fri Aug 12 11:45:18 2016 +0000

    ASoC: Intel: Skylake: Fix error return code in skl_probe()
    
    commit 979cf59acc9d634cc140aadd0d2915947ab303cc upstream.
    
    Fix to return error code -ENODEV from the error handling
    case instead of 0, as done elsewhere in this function.
    
    Fixes: 87b2bdf02278 ("ASoC: Intel: Skylake: Initialize NHLT table")
    Signed-off-by: Wei Yongjun <weiyj.lk@gmail.com>
    Acked-By: Vinod Koul <vinod.kou@intel.com>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3039eb4d8ac5074ee95d68ac2b5f5b48ae59db29
Author: Trond Myklebust <trond.myklebust@primarydata.com>
Date:   Sun Jun 26 12:39:49 2016 -0400

    pNFS/flexfiles: Fix layoutcommit after a commit to DS
    
    commit c001c87a63aa2f35358e33eb05e45e4cbcb34f54 upstream.
    
    We should always do a layoutcommit after commit to DS, except if
    the layout segment we're using has set FF_FLAGS_NO_LAYOUTCOMMIT.
    
    Fixes: d67ae825a59d ("pnfs/flexfiles: Add the FlexFile Layout Driver")
    Signed-off-by: Trond Myklebust <trond.myklebust@primarydata.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 86f09d4a9e9738b95f3890aa7cb2131a22010113
Author: Trond Myklebust <trond.myklebust@primarydata.com>
Date:   Sun Jun 26 12:27:25 2016 -0400

    pNFS/files: Fix layoutcommit after a commit to DS
    
    commit 73e6c5d854d3f7f75e8b46d3e54aeb5d83fe6b1f upstream.
    
    According to the errata
    https://www.rfc-editor.org/errata_search.php?rfc=5661&eid=2751
    we should always send layout commit after a commit to DS.
    
    Fixes: bc7d4b8fd091 ("nfs/filelayout: set layoutcommit...")
    Signed-off-by: Trond Myklebust <trond.myklebust@primarydata.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 80468ac59605410aef0e1911ac61163a0367c82f
Author: Chuck Lever <chuck.lever@oracle.com>
Date:   Wed Jun 29 13:55:22 2016 -0400

    NFS: Don't drop CB requests with invalid principals
    
    commit a4e187d83d88eeaba6252aac0a2ffe5eaa73a818 upstream.
    
    Before commit 778be232a207 ("NFS do not find client in NFSv4
    pg_authenticate"), the Linux callback server replied with
    RPC_AUTH_ERROR / RPC_AUTH_BADCRED, instead of dropping the CB
    request. Let's restore that behavior so the server has a chance to
    do something useful about it, and provide a warning that helps
    admins correct the problem.
    
    Fixes: 778be232a207 ("NFS do not find client in NFSv4 ...")
    Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
    Tested-by: Steve Wise <swise@opengridcomputing.com>
    Signed-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9c90be45e28e5f3d9b9f41c1d6e15ecd36f7d624
Author: Chuck Lever <chuck.lever@oracle.com>
Date:   Wed Jun 29 13:55:14 2016 -0400

    svc: Avoid garbage replies when pc_func() returns rpc_drop_reply
    
    commit 0533b13072f4bf35738290d2cf9e299c7bc6c42a upstream.
    
    If an RPC program does not set vs_dispatch and pc_func() returns
    rpc_drop_reply, the server sends a reply anyway containing a single
    word containing the value RPC_DROP_REPLY (in network byte-order, of
    course). This is a nonsense RPC message.
    
    Fixes: 9e701c610923 ("svcrpc: simpler request dropping")
    Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
    Tested-by: Steve Wise <swise@opengridcomputing.com>
    Signed-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f02dfdecec28169778bbd01a00f0f6196be39074
Author: Alexandre Belloni <alexandre.belloni@bootlin.com>
Date:   Wed Jun 29 19:44:51 2016 +0200

    dmaengine: at_xdmac: fix debug string
    
    commit 3935e08768ff777da6496521b1fc36f72823672c upstream.
    
    mbr_ds is an integer, don't use %pad to print it.
    
    Fixes: commit 268914f4e7a0 ("dmaengine: at_xdmac: use %pad format string for dma_addr_t")
    Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Alexandre Belloni <alexandre.belloni@free-electrons.com>
    Signed-off-by: Vinod Koul <vinod.koul@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 07dc7252685d3368a5ef77da8f28a890ca8a621b
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Thu Jul 7 11:23:59 2016 +0300

    fnic: pci_dma_mapping_error() doesn't return an error code
    
    commit dd7328e4c53649c1c7ec36bc1cf5b229b8662047 upstream.
    
    pci_dma_mapping_error() returns true on error and false on success.
    
    Fixes: fd6ddfa4c1dd ('fnic: check pci_map_single() return value')
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7d5130779a6279c4953850e39f5840a31d13fb06
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Wed Jul 13 13:08:55 2016 +0300

    avr32: off by one in at32_init_pio()
    
    commit 55f1cf83d5cf885c75267269729805852039c834 upstream.
    
    The pio_dev[] array has MAX_NR_PIO_DEVICES elements so the > should be
    >=.
    
    Fixes: 5f97f7f9400d ('[PATCH] avr32 architecture')
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4864ef93ce1b835e26f7b5ddf989496264fa4c45
Author: Sven Eckelmann <sven@narfation.org>
Date:   Wed Jun 29 19:29:30 2016 +0300

    ath9k: Fix programming of minCCA power threshold
    
    commit aaab50fcea78ae3414c3afc25aae8d0603df34d0 upstream.
    
    The function ar9003_hw_apply_minccapwr_thresh takes as second parameter not
    a pointer to the channel but a boolean value describing whether the channel
    is 2.4GHz or not. This broke (according to the origin commit) the ETSI
    regulatory compliance on 5GHz channels.
    
    Fixes: 3533bf6b15a0 ("ath9k: Fix regulatory compliance")
    Signed-off-by: Sven Eckelmann <sven@narfation.org>
    Cc: Simon Wunderlich <sw@simonwunderlich.de>
    Cc: Sujith Manoharan <c_manoha@qca.qualcomm.com>
    Signed-off-by: Kalle Valo <kvalo@qca.qualcomm.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bf5482f919caad7029be9ab3019eb9a696ddc37a
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Mon Jul 4 10:21:40 2016 -0300

    gspca: avoid unused variable warnings
    
    commit d7e92e15e92fc987640772bf110586898b5f15aa upstream.
    
    When CONFIG_INPUT is disabled, multiple gspca backend drivers
    print compile-time warnings about unused variables:
    
    media/usb/gspca/cpia1.c: In function 'sd_stopN':
    media/usb/gspca/cpia1.c:1627:13: error: unused variable 'sd' [-Werror=unused-variable]
    media/usb/gspca/konica.c: In function 'sd_stopN':
    media/usb/gspca/konica.c:246:13: error: unused variable 'sd' [-Werror=unused-variable]
    
    This annotates the variables as __maybe_unused, to let the compiler
    know that they are declared intentionally.
    
    Fixes: ee186fd96a5f ("[media] gscpa_t613: Add support for the camera button")
    Fixes: c2f644aeeba3 ("[media] gspca_cpia1: Add support for button")
    Fixes: b517af722860 ("V4L/DVB: gspca_konica: New gspca subdriver for konica chipset using cams")
    
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Hans Verkuil <hans.verkuil@cisco.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5d6700e3d62450658de92ee8f6da850bd78854e8
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Mon May 9 05:22:55 2016 -0300

    em28xx-i2c: rt_mutex_trylock() returns zero on failure
    
    commit e44c153b30c9a0580fc2b5a93f3c6d593def2278 upstream.
    
    The code is checking for negative returns but it should be checking for
    zero.
    
    Fixes: aab3125c43d8 ('[media] em28xx: add support for registering multiple i2c buses')
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@osg.samsung.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c5f519610b9636e6abee78c54e85ecb46dcc9b49
Author: Geert Uytterhoeven <geert@linux-m68k.org>
Date:   Sun Jun 5 11:17:10 2016 +0200

    NFC: fdp: Detect errors from fdp_nci_create_conn()
    
    commit fa1ce54ea38f7f83473fce62e64fefbd7ebd170e upstream.
    
    drivers/nfc/fdp/fdp.c: In function ‘fdp_nci_patch_otp’:
    drivers/nfc/fdp/fdp.c:373: warning: comparison is always false due to limited range of data type
    drivers/nfc/fdp/fdp.c: In function ‘fdp_nci_patch_ram’:
    drivers/nfc/fdp/fdp.c:444: warning: comparison is always false due to limited range of data type
    
    fdp_nci_create_conn() may return a negative error code, which is
    silently ignored by assigning it to a u8.
    
    Change conn_id from u8 to int to fix this.
    
    Fixes: a06347c04c13e380 ("NFC: Add Intel Fields Peak NFC solution driver")
    Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Samuel Ortiz <sameo@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 868b3ee358d20140da2a2225c0e98da69ff742dd
Author: striebit <shaul.triebitz@intel.com>
Date:   Tue Jun 7 15:05:26 2016 +0300

    iwlmvm: mvm: set correct state in smart-fifo configuration
    
    commit 849a9627299100ae3f0ce573fc87d2b476f3bb59 upstream.
    
    Currently the state sent in SF configuration is always
    FULL_ON.
    This commit sets the correct state (e.g. INIT_OFF
    when station is not associated).
    
    Fixes: commit f4a3ee493e69 ("iwlwifi: mvm: Always enable the smart FIFO")
    Signed-off-by: Shaul Triebitz <shaul.triebitz@intel.com>
    Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit aef1f7cf94e59ee5c09e400ddb4dae52ef3bfefe
Author: James Hogan <jhogan@kernel.org>
Date:   Mon Jul 25 16:59:54 2016 +0100

    tile: Define AT_VECTOR_SIZE_ARCH for ARCH_DLINFO
    
    commit cdf8b4633075f2171d440d2e37c9c2609019a81a upstream.
    
    AT_VECTOR_SIZE_ARCH should be defined with the maximum number of
    NEW_AUX_ENT entries that ARCH_DLINFO can contain, but it wasn't defined
    for tile at all even though ARCH_DLINFO will contain one NEW_AUX_ENT for
    the VDSO address.
    
    This shouldn't be a problem as AT_VECTOR_SIZE_BASE includes space for
    AT_BASE_PLATFORM which tile doesn't use, but lets define it now and add
    the comment above ARCH_DLINFO as found in several other architectures to
    remind future modifiers of ARCH_DLINFO to keep AT_VECTOR_SIZE_ARCH up to
    date.
    
    Fixes: 4a556f4f56da ("tile: implement gettimeofday() via vDSO")
    Signed-off-by: James Hogan <james.hogan@imgtec.com>
    Cc: Chris Metcalf <cmetcalf@mellanox.com>
    Signed-off-by: Chris Metcalf <cmetcalf@mellanox.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 284ae44a164c30d967639c3a98ca3fd9def1ce83
Author: Geliang Tang <geliangtang@163.com>
Date:   Sat Nov 7 12:43:49 2015 +0800

    pstore: drop file opened reference count
    
    commit 52d210d961a62a9662e27f14d6505d6741b2fb02 upstream.
    
    In ee1d267423a1 ("pstore: add pstore unregister") I added:
            .owner = THIS_MODULE,
    in both pstore_fs_type and pstore_file_operations to increase a reference
    count when pstore filesystem is mounted and pstore file is opened.
    
    But, it's repetitive. There is no need to increase the opened reference
    count. We only need to increase the mounted reference count. When a file
    is opened, the filesystem can't be unmounted. Hence the pstore module
    can't be unloaded either.
    
    So I drop the opened reference count in this patch.
    
    Fixes: ee1d267423a1 ("pstore: add pstore unregister")
    Signed-off-by: Geliang Tang <geliangtang@163.com>
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4042db311c0fc3ebea3f85e39adba70ef01d5756
Author: Omar Sandoval <osandov@fb.com>
Date:   Wed Jun 8 18:22:20 2016 -0700

    blk-mq: actually hook up defer list when running requests
    
    commit 52b9c330c6a8a4b5a1819bdaddf4ec76ab571e81 upstream.
    
    If ->queue_rq() returns BLK_MQ_RQ_QUEUE_OK, we use continue and skip
    over the rest of the loop body. However, dptr is assigned later in the
    loop body, and the BLK_MQ_RQ_QUEUE_OK case is exactly the case that we'd
    want it for.
    
    NVMe isn't actually using BLK_MQ_F_DEFER_ISSUE yet, nor is any other
    in-tree driver, but if the code's going to be there, it might as well
    work.
    
    Fixes: 74c450521dd8 ("blk-mq: add a 'list' parameter to ->queue_rq()")
    Signed-off-by: Omar Sandoval <osandov@fb.com>
    Signed-off-by: Jens Axboe <axboe@fb.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0e13a4948cbf910cf87f14331017adade75f7dd6
Author: Nishanth Menon <nm@ti.com>
Date:   Fri Jun 24 11:50:39 2016 -0500

    hwrng: omap - Fix assumption that runtime_get_sync will always succeed
    
    commit 61dc0a446e5d08f2de8a24b45f69a1e302bb1b1b upstream.
    
    pm_runtime_get_sync does return a error value that must be checked for
    error conditions, else, due to various reasons, the device maynot be
    enabled and the system will crash due to lack of clock to the hardware
    module.
    
    Before:
    12.562784] [00000000] *pgd=fe193835
    12.562792] Internal error: : 1406 [#1] SMP ARM
    [...]
    12.562864] CPU: 1 PID: 241 Comm: modprobe Not tainted 4.7.0-rc4-next-20160624 #2
    12.562867] Hardware name: Generic DRA74X (Flattened Device Tree)
    12.562872] task: ed51f140 ti: ed44c000 task.ti: ed44c000
    12.562886] PC is at omap4_rng_init+0x20/0x84 [omap_rng]
    12.562899] LR is at set_current_rng+0xc0/0x154 [rng_core]
    [...]
    
    After the proper checks:
    [   94.366705] omap_rng 48090000.rng: _od_fail_runtime_resume: FIXME:
    missing hwmod/omap_dev info
    [   94.375767] omap_rng 48090000.rng: Failed to runtime_get device -19
    [   94.382351] omap_rng 48090000.rng: initialization failed.
    
    Fixes: 665d92fa85b5 ("hwrng: OMAP: convert to use runtime PM")
    Cc: Paul Walmsley <paul@pwsan.com>
    Signed-off-by: Nishanth Menon <nm@ti.com>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ac5c04ea1c1236f6400bb28cd0c69842b2070531
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Tue Sep 6 14:34:05 2016 +0100

    ARM: sa1111: fix pcmcia suspend/resume
    
    commit 06dfe5cc0cc684e735cb0232fdb756d30780b05d upstream.
    
    SA1111 PCMCIA was broken when PCMCIA switched to using dev_pm_ops for
    the PCMCIA socket class.  PCMCIA used to handle suspend/resume via the
    socket hosting device, which happened at normal device suspend/resume
    time.
    
    However, the referenced commit changed this: much of the resume now
    happens much earlier, in the noirq resume handler of dev_pm_ops.
    
    However, on SA1111, the PCMCIA device is not accessible as the SA1111
    has not been resumed at _noirq time.  It's slightly worse than that,
    because the SA1111 has already been put to sleep at _noirq time, so
    suspend doesn't work properly.
    
    Fix this by converting the core SA1111 code to use dev_pm_ops as well,
    and performing its own suspend/resume at noirq time.
    
    This fixes these errors in the kernel log:
    
    pcmcia_socket pcmcia_socket0: time out after reset
    pcmcia_socket pcmcia_socket1: time out after reset
    
    and the resulting lack of PCMCIA cards after a S2RAM cycle.
    
    Fixes: d7646f7632549 ("pcmcia: use dev_pm_ops for class pcmcia_socket_class")
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f7e55f589d29c9f853d6aeab9947f89002aa89c2
Author: Wolfram Sang <wsa+renesas@sang-engineering.com>
Date:   Tue Aug 30 21:50:22 2016 +0200

    ARM: shmobile: fix regulator quirk for Gen2
    
    commit c2f321126e31cd69365e65ecd4a7c774e4fc71d2 upstream.
    
    The current implementation only works if the da9xxx devices are added
    before their drivers are registered. Only then it can apply the fixes to
    both devices. Otherwise, the driver for the first device gets probed
    before the fix for the second device can be applied. This is what
    fails when using the IP core switcher or when having the i2c master
    driver as a module.
    
    So, we need to disable both da9xxx once we detected one of them. We now
    use i2c_transfer with hardcoded i2c_messages and device addresses, so we
    don't need the da9xxx client devices to be instantiated. Because the
    fixup is used on specific boards only, the addresses are not going to
    change.
    
    Fixes: 663fbb52159cca ("ARM: shmobile: R-Car Gen2: Add da9063/da9210 regulator quirk")
    Signed-off-by: Wolfram Sang <wsa+renesas@sang-engineering.com>
    Reviewed-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Tested-by: Geert Uytterhoeven <geert+renesas@glider.be> (r8a7791/koelsch)
    Tested-by: Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
    Signed-off-by: Simon Horman <horms+renesas@verge.net.au>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0338bbade6c1b1e6524c7e74113e55043892049b
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Fri Aug 19 16:34:45 2016 +0100

    ARM: sa1100: clear reset status prior to reboot
    
    commit da60626e7d02a4f385cae80e450afc8b07035368 upstream.
    
    Clear the current reset status prior to rebooting the platform.  This
    adds the bit missing from 04fef228fb00 ("[ARM] pxa: introduce
    reset_status and clear_reset_status for driver's usage").
    
    Fixes: 04fef228fb00 ("[ARM] pxa: introduce reset_status and clear_reset_status for driver's usage")
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 63d32e3560bf313f84c66163fe0c6c088883d527
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Fri Aug 19 12:44:29 2016 +0100

    ARM: sa1100: fix 3.6864MHz clock
    
    commit 02ba38a5b6d6e0bc89c7b74651f1873055028a56 upstream.
    
    pxa_timer wants to be able to call clk_enable() etc on this clock,
    but our clk_enable() implementation expects non-NULL enable/disable
    operations.  Provide these dummy implementations.
    
    Unable to handle kernel NULL pointer dereference at virtual address 00000000
    pgd = c0204000
    [00000000] *pgd=00000000
    Internal error: Oops: 80000005 [#1] ARM
    Modules linked in:
    CPU: 0 PID: 0 Comm: swapper Not tainted 4.8.0-rc2+ #887
    Hardware name: Intel-Assabet
    task: c0644590 task.stack: c0640000
    PC is at 0x0
    LR is at clk_enable+0x40/0x58
    pc : [<00000000>]    lr : [<c021b178>]    psr: 600000d3
    sp : c0641f60  ip : c0641f4c  fp : c0641f74
    r10: c1ffc7a0  r9 : 6901b118  r8 : 00000001
    r7 : c0639a34  r6 : 0000001b  r5 : a00000d3  r4 : c0645d70
    r3 : c0645d78  r2 : 00000001  r1 : c0641ef0  r0 : c0645d70
    Flags: nZCv  IRQs off  FIQs off  Mode SVC_32  ISA ARM  Segment none
    Control: c020717f  Table: c020717f  DAC: 00000053
    Process swapper (pid: 0, stack limit = 0xc0640188)
    Stack: (0xc0641f60 to 0xc0642000)
    1f60: 00384000 c08762e4 c0641f98 c0641f78 c063308c c021b144 00000000 00000000
    1f80: 00000000 c0660b20 ffffffff c0641fa8 c0641f9c c06220ec c0633058 c0641fb8
    1fa0: c0641fac c061f114 c06220dc c0641ff4 c0641fbc c061bb68 c061f0fc ffffffff
    1fc0: ffffffff 00000000 c061b6cc c0639a34 c0660cd4 c0642038 c0639a30 c0645434
    1fe0: c0204000 c06380f8 00000000 c0641ff8 c0208048 c061b954 00000000 00000000
    Backtrace:
    [<c021b138>] (clk_enable) from [<c063308c>] (pxa_timer_nodt_init+0x40/0x120)
     r5:c08762e4 r4:00384000
    [<c063304c>] (pxa_timer_nodt_init) from [<c06220ec>] (sa1100_timer_init+0x1c/0x20)
     r6:ffffffff r5:c0660b20 r4:00000000
    [<c06220d0>] (sa1100_timer_init) from [<c061f114>] (time_init+0x24/0x2c)
    [<c061f0f0>] (time_init) from [<c061bb68>] (start_kernel+0x220/0x42c)
    [<c061b948>] (start_kernel) from [<c0208048>] (0xc0208048)
     r10:c06380f8 r8:c0204000 r7:c0645434 r6:c0639a30 r5:c0642038 r4:c0660cd4
    Code: bad PC value
    ---[ end trace 0000000000000000 ]---
    Kernel panic - not syncing: Attempted to kill the idle task!
    
    Fixes: ee3a4020f7c9 ("ARM: 8250/1: sa1100: provide OSTIMER0 clock for pxa_timer")
    Acked-by: Dmitry Eremin-Solenikov <dbaryshkov@gmail.com>
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 72f4be6850ee499cc98d8fe793f69eec61ac73d8
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Fri Aug 19 12:47:54 2016 +0100

    ARM: sa1100: register clocks early
    
    commit 198b51e8a6a31d3a6f8e9dd9cade3635d0291f26 upstream.
    
    Since we switched to use pxa_timer, we need to provide the OSTIMER0
    clock.  However, as the clock is initialised early, we need to provide
    the clock early as well, so that pxa_timer can find it.  Adding the
    clock to the clkdev table at core_initcall() time is way too late.
    
    Move the initialisation earlier.
    
    Fixes: ee3a4020f7c9 ("ARM: 8250/1: sa1100: provide OSTIMER0 clock for pxa_timer")
    Acked-by: Dmitry Eremin-Solenikov <dbaryshkov@gmail.com>
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c9aeab70fca351b908dfb868de7d323a99fb3c12
Author: Hugo Grostabussiat <bonstra@bonstra.fr.eu.org>
Date:   Tue Aug 16 20:34:07 2016 +0200

    ARM: sun5i: Fix typo in trip point temperature
    
    commit 539d5c48a4aff5a4afcff117418618b49126c54c upstream.
    
    Set cpu_alert0 temperature to 85°C instead of 850°C.
    
    Fixes: 32a5d2d170cc ("ARM: dts: sun5i: Add cpu thermal zones to dtsi")
    Signed-off-by: Hugo Grostabussiat <bonstra@bonstra.fr.eu.org>
    Acked-by: Chen-Yu Tsai <wens@csie.org>
    Signed-off-by: Maxime Ripard <maxime.ripard@free-electrons.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ba21aa15b9e5d3e5cff161c6a196df0df7b103f9
Author: Stephen Boyd <sboyd@codeaurora.org>
Date:   Mon Jul 11 14:50:07 2016 -0700

    regulator: qcom_smd: Fix voltage ranges for pm8x41
    
    commit 290284776bb281759b11faa287b8abccaf74bfcb upstream.
    
    The voltage ranges listed here are wrong. The correct ranges can
    be seen in the "native" spmi regulator driver
    qcom_spmi-regulator.c at pldo_ranges[], ftsmps_ranges[] and
    boost_ranges[] for the pldo, ftsmps, and boost type regulators.
    Port these ranges over to the RPM SMD regulator driver so that we
    list the appropriate set of supported voltages on pldos.
    
    Doing this allows us to specify a voltage like 3075000 for l24,
    whereas before that wasn't a supported voltage.
    
    Fixes: da65e367b67e ("regulator: Regulator driver for the Qualcomm RPM")
    Signed-off-by: Stephen Boyd <sboyd@codeaurora.org>
    Reviewed-by: Andy Gross <andy.gross@linaro.org>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit efc6dc794c205c255521fa0364ab6a1e7389b07e
Author: Stephen Boyd <stephen.boyd@linaro.org>
Date:   Sat Jun 25 22:52:12 2016 -0700

    regulator: qcom_spmi: Update mvs1/mvs2 switches on pm8941
    
    commit 93bfe79b03365f410aa91caf04263173c008ecdf upstream.
    
    The mvs1 and mvs2 switches are actually called 5vs1 and 5vs2 on
    some datasheets. Let's rename them to match the datasheets and
    also match the RPM based regulator driver which calls these by
    their 5vs names (see qcom_smd-regulator.c). There aren't any
    users of these regulators so far, so there aren't any concerns of
    DT ABI breakage here. While we're here making updates to the
    switches, also mandate usage of the OCP irq for these switches
    too.
    
    Cc: Bjorn Andersson <bjorn.andersson@linaro.org>
    Fixes: e92a4047419c ("regulator: Add QCOM SPMI regulator driver")
    Signed-off-by: Stephen Boyd <stephen.boyd@linaro.org>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d23a7a00c1523c23a0d5b08113c150ac89158f1a
Author: Stephen Boyd <stephen.boyd@linaro.org>
Date:   Sat Jun 25 22:52:13 2016 -0700

    regulator: qcom_spmi: Add support for get_mode/set_mode on switches
    
    commit 919163f6362ac23138d31fc8befdd52e5d7e488d upstream.
    
    The voltage switches support mode switching, so add support for
    these ops to those types of regulators.
    
    Cc: Bjorn Andersson <bjorn.andersson@linaro.org>
    Fixes: e92a4047419c ("regulator: Add QCOM SPMI regulator driver")
    Signed-off-by: Stephen Boyd <stephen.boyd@linaro.org>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7ad9ee6558f65c9d4e840b12e73fb39f2df656c0
Author: Stephen Boyd <stephen.boyd@linaro.org>
Date:   Sat Jun 25 22:52:11 2016 -0700

    regulator: qcom_spmi: Add support for S4 supply on pm8941
    
    commit c333dfe8dba7d3e47e97e1cee3c38123e19ae73c upstream.
    
    The S4 supply is sometimes called the boost regulator because it
    outputs 5V. Typically it's connected to the 5vs1 and 5vs2
    switches for use in USB OTG and HDMI applications. Add support
    for this regulator which was mistakenly left out from the initial
    submission of this driver.
    
    Cc: Bjorn Andersson <bjorn.andersson@linaro.org>
    Fixes: e92a4047419c ("regulator: Add QCOM SPMI regulator driver")
    Signed-off-by: Stephen Boyd <stephen.boyd@linaro.org>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 803e26487a03730c6afa9cd70538698f10f0e87e
Author: apronin@chromium.org <apronin@chromium.org>
Date:   Thu Jul 14 18:07:18 2016 -0700

    tpm: fix byte-order for the value read by tpm2_get_tpm_pt
    
    commit 1b0612b04090e416828c0dd5ed197b0913d834a0 upstream.
    
    The result must be converted from BE byte order, which is used by the
    TPM2 protocol. This has not popped out because tpm2_get_tpm_pt() has
    been only used for probing.
    
    Fixes: 7a1d7e6dd76a ("tpm: TPM 2.0 baseline support")
    Change-Id: I7d71cd379b1a3b7659d20a1b6008216762596590
    Signed-off-by: Andrey Pronin <apronin@chromium.org>
    Reviewed-by: Jason Gunthorpe <jgunthorpe@obsidianresearch.com>
    Reviewed-by: Jarkko Sakkinen <jarkko.sakkinen@linux.intel.com>
    Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6b502c1d73b49bd425f363765330da7fd7d46a20
Author: Nicolas Iooss <nicolas.iooss_linux@m4x.org>
Date:   Thu Aug 25 15:17:00 2016 -0700

    printk: fix parsing of "brl=" option
    
    commit ae6c33ba6e37eea3012fe2640b22400ef3f2d0f3 upstream.
    
    Commit bbeddf52adc1 ("printk: move braille console support into separate
    braille.[ch] files") moved the parsing of braille-related options into
    _braille_console_setup(), changing the type of variable str from char*
    to char**.  In this commit, memcmp(str, "brl,", 4) was correctly updated
    to memcmp(*str, "brl,", 4) but not memcmp(str, "brl=", 4).
    
    Update the code to make "brl=" option work again and replace memcmp()
    with strncmp() to make the compiler able to detect such an issue.
    
    Fixes: bbeddf52adc1 ("printk: move braille console support into separate braille.[ch] files")
    Link: http://lkml.kernel.org/r/20160823165700.28952-1-nicolas.iooss_linux@m4x.org
    Signed-off-by: Nicolas Iooss <nicolas.iooss_linux@m4x.org>
    Cc: Joe Perches <joe@perches.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 350cd19e0e2ddf45320bef52b7486b2de4dad715
Author: Marcin Nowakowski <marcin.nowakowski@mips.com>
Date:   Thu Sep 22 15:38:33 2016 +0200

    MIPS: uprobes: fix use of uninitialised variable
    
    commit ca86c9ef2b322ebf24772009fdea037688cbdac1 upstream.
    
    arch_uprobe_pre_xol needs to emulate a branch if a branch instruction
    has been replaced with a breakpoint, but in fact an uninitialised local
    variable was passed to the emulator routine instead of the original
    instruction
    
    Signed-off-by: Marcin Nowakowski <marcin.nowakowski@imgtec.com>
    Fixes: 40e084a506eb ('MIPS: Add uprobes support.')
    Cc: linux-mips@linux-mips.org
    Patchwork: https://patchwork.linux-mips.org/patch/14300/
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e267de2c1bd87f9628dd44f26a9d240cfc5612c6
Author: Paul Burton <paulburton@kernel.org>
Date:   Fri Sep 2 16:07:10 2016 +0100

    MIPS: Malta: Fix IOCU disable switch read for MIPS64
    
    commit 305723ab439e14debc1d339aa04e835d488b8253 upstream.
    
    Malta boards used with CPU emulators feature a switch to disable use of
    an IOCU. Software has to check this switch & ignore any present IOCU if
    the switch is closed. The read used to do this was unsafe for 64 bit
    kernels, as it simply casted the address 0xbf403000 to a pointer &
    dereferenced it. Whilst in a 32 bit kernel this would access kseg1, in a
    64 bit kernel this attempts to access xuseg & results in an address
    error exception.
    
    Fix by accessing a correctly formed ckseg1 address generated using the
    CKSEG1ADDR macro.
    
    Whilst modifying this code, define the name of the register and the bit
    we care about within it, which indicates whether PCI DMA is routed to
    the IOCU or straight to DRAM. The code previously checked that bit 0 was
    also set, but the least significant 7 bits of the CONFIG_GEN0 register
    contain the value of the MReqInfo signal provided to the IOCU OCP bus,
    so singling out bit 0 makes little sense & that part of the check is
    dropped.
    
    Signed-off-by: Paul Burton <paul.burton@imgtec.com>
    Fixes: b6d92b4a6bdb ("MIPS: Add option to disable software I/O coherency.")
    Cc: Matt Redfearn <matt.redfearn@imgtec.com>
    Cc: Masahiro Yamada <yamada.masahiro@socionext.com>
    Cc: Kees Cook <keescook@chromium.org>
    Cc: linux-mips@linux-mips.org
    Cc: linux-kernel@vger.kernel.org
    Patchwork: https://patchwork.linux-mips.org/patch/14187/
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bb517c45cbf5dce78aefc3e2470e96654a806627
Author: Marcin Nowakowski <marcin.nowakowski@mips.com>
Date:   Thu Sep 22 15:38:31 2016 +0200

    MIPS: fix uretprobe implementation
    
    commit db06068a4fd44a57b642b369d2a295b8448f6b65 upstream.
    
    arch_uretprobe_hijack_return_addr should replace the return address for
    a call with a trampoline address.
    
    Signed-off-by: Marcin Nowakowski <marcin.nowakowski@imgtec.com>
    Fixes: 40e084a506eb ('MIPS: Add uprobes support.')
    Cc: linux-mips@linux-mips.org
    Patchwork: https://patchwork.linux-mips.org/patch/14298/
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 824865e1f7ade5766d45f7f2a1584a0f5b00bf91
Author: Marcin Nowakowski <marcin.nowakowski@mips.com>
Date:   Thu Sep 22 15:38:32 2016 +0200

    MIPS: uprobes: remove incorrect set_orig_insn
    
    commit ddabfa5c2e33f1b495f3e0176de7057850915c0b upstream.
    
    Generic kernel code implements a weak version of set_orig_insn that
    moves cached 'insn' from arch_uprobe to the original code location when
    the trap is removed.
    MIPS variant used arch_uprobe->orig_inst which was never initialised
    properly, so this code only inserted a nop instead of the original
    instruction. With that change orig_inst can also be safely removed.
    
    Signed-off-by: Marcin Nowakowski <marcin.nowakowski@imgtec.com>
    Fixes: 40e084a506eb ('MIPS: Add uprobes support.')
    Cc: linux-mips@linux-mips.org
    Patchwork: https://patchwork.linux-mips.org/patch/14299/
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9b228c19dd2099ff0cb8f6643cede8ac9272a5e2
Author: Will Deacon <will@kernel.org>
Date:   Fri Aug 26 11:36:39 2016 +0100

    arm64: debug: avoid resetting stepping state machine when TIF_SINGLESTEP
    
    commit 3a402a709500c5a3faca2111668c33d96555e35a upstream.
    
    When TIF_SINGLESTEP is set for a task, the single-step state machine is
    enabled and we must take care not to reset it to the active-not-pending
    state if it is already in the active-pending state.
    
    Unfortunately, that's exactly what user_enable_single_step does, by
    unconditionally setting the SS bit in the SPSR for the current task.
    This causes failures in the GDB testsuite, where GDB ends up missing
    expected step traps if the instruction being stepped generates another
    trap, e.g. PTRACE_EVENT_FORK from an SVC instruction.
    
    This patch fixes the problem by preserving the current state of the
    stepping state machine when TIF_SINGLESTEP is set on the current thread.
    
    Cc: <stable@vger.kernel.org>
    Reported-by: Yao Qi <yao.qi@arm.com>
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 26eeefb1735a1bb2d15404b49f20b8e09d37988f
Author: Srinivas Ramana <sramana@codeaurora.org>
Date:   Fri Sep 30 15:03:31 2016 +0100

    ARM: 8618/1: decompressor: reset ttbcr fields to use TTBR0 on ARMv7
    
    commit 117e5e9c4cfcb7628f08de074fbfefec1bb678b7 upstream.
    
    If the bootloader uses the long descriptor format and jumps to
    kernel decompressor code, TTBCR may not be in a right state.
    Before enabling the MMU, it is required to clear the TTBCR.PD0
    field to use TTBR0 for translation table walks.
    
    The commit dbece45894d3a ("ARM: 7501/1: decompressor:
    reset ttbcr for VMSA ARMv7 cores") does the reset of TTBCR.N, but
    doesn't consider all the bits for the size of TTBCR.N.
    
    Clear TTBCR.PD0 field and reset all the three bits of TTBCR.N to
    indicate the use of TTBR0 and the correct base address width.
    
    Fixes: dbece45894d3 ("ARM: 7501/1: decompressor: reset ttbcr for VMSA ARMv7 cores")
    Acked-by: Robin Murphy <robin.murphy@arm.com>
    Signed-off-by: Srinivas Ramana <sramana@codeaurora.org>
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 05532fc5b30b656781edcf79fee658d05fe309fb
Author: James Morse <james.morse@arm.com>
Date:   Mon Sep 19 18:29:15 2016 +0100

    irqchip/gicv3: Silence noisy DEBUG_PER_CPU_MAPS warning
    
    commit 727653d6ce7103b245eb8041f55dd5885f4c3289 upstream.
    
    gic_raise_softirq() walks the list of cpus using for_each_cpu(), it calls
    gic_compute_target_list() which advances the iterator by the number of
    CPUs in the cluster.
    
    If gic_compute_target_list() reaches the last CPU it leaves the iterator
    pointing at the last CPU. This means the next time round the for_each_cpu()
    loop cpumask_next() will be called with an invalid CPU.
    
    This triggers a warning when built with CONFIG_DEBUG_PER_CPU_MAPS:
    [    3.077738] GICv3: CPU1: found redistributor 1 region 0:0x000000002f120000
    [    3.077943] CPU1: Booted secondary processor [410fd0f0]
    [    3.078542] ------------[ cut here ]------------
    [    3.078746] WARNING: CPU: 1 PID: 0 at ../include/linux/cpumask.h:121 gic_raise_softirq+0x12c/0x170
    [    3.078812] Modules linked in:
    [    3.078869]
    [    3.078930] CPU: 1 PID: 0 Comm: swapper/1 Not tainted 4.8.0-rc5+ #5188
    [    3.078994] Hardware name: Foundation-v8A (DT)
    [    3.079059] task: ffff80087a1a0080 task.stack: ffff80087a19c000
    [    3.079145] PC is at gic_raise_softirq+0x12c/0x170
    [    3.079226] LR is at gic_raise_softirq+0xa4/0x170
    [    3.079296] pc : [<ffff0000083ead24>] lr : [<ffff0000083eac9c>] pstate: 200001c9
    [    3.081139] Call trace:
    [    3.081202] Exception stack(0xffff80087a19fbe0 to 0xffff80087a19fd10)
    
    [    3.082269] [<ffff0000083ead24>] gic_raise_softirq+0x12c/0x170
    [    3.082354] [<ffff00000808e614>] smp_send_reschedule+0x34/0x40
    [    3.082433] [<ffff0000080e80a0>] resched_curr+0x50/0x88
    [    3.082512] [<ffff0000080e89d0>] check_preempt_curr+0x60/0xd0
    [    3.082593] [<ffff0000080e8a60>] ttwu_do_wakeup+0x20/0xe8
    [    3.082672] [<ffff0000080e8bb8>] ttwu_do_activate+0x90/0xc0
    [    3.082753] [<ffff0000080ea9a4>] try_to_wake_up+0x224/0x370
    [    3.082836] [<ffff0000080eabc8>] default_wake_function+0x10/0x18
    [    3.082920] [<ffff000008103134>] __wake_up_common+0x5c/0xa0
    [    3.083003] [<ffff0000081031f4>] __wake_up_locked+0x14/0x20
    [    3.083086] [<ffff000008103f80>] complete+0x40/0x60
    [    3.083168] [<ffff00000808df7c>] secondary_start_kernel+0x15c/0x1d0
    [    3.083240] [<00000000808911a4>] 0x808911a4
    [    3.113401] Detected PIPT I-cache on CPU2
    
    Avoid updating the iterator if the next call to cpumask_next() would
    cause the for_each_cpu() loop to exit.
    
    There is no change to gic_raise_softirq()'s behaviour, (cpumask_next()s
    eventual call to _find_next_bit() will return early as start >= nbits),
    this patch just silences the warning.
    
    Fixes: 021f653791ad ("irqchip: gic-v3: Initial support for GICv3")
    Signed-off-by: James Morse <james.morse@arm.com>
    Acked-by: Marc Zyngier <marc.zyngier@arm.com>
    Cc: linux-arm-kernel@lists.infradead.org
    Cc: Jason Cooper <jason@lakedaemon.net>
    Link: http://lkml.kernel.org/r/1474306155-3303-1-git-send-email-james.morse@arm.com
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 15e55673263284f68c2072c3e78036f2309fb1b9
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Mon Aug 29 11:24:10 2016 +0100

    gpio: sa1100: fix irq probing for ucb1x00
    
    commit 56beac95cb88c188d2a885825a5da131edb41fe3 upstream.
    
    ucb1x00 has used IRQ probing since it's dawn to find the GPIO interrupt
    that it's connected to.  However, commit 23393d49fb75 ("gpio: kill off
    set_irq_flags usage") broke this by disabling IRQ probing on GPIO
    interrupts.  Fix this.
    
    Fixes: 23393d49fb75 ("gpio: kill off set_irq_flags usage")
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b5f881a43e5986a60d81af8bdd9e7f470fdd95f9
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Fri Jul 15 14:15:47 2016 +0300

    usb: gadget: fsl_qe_udc: signedness bug in qe_get_frame()
    
    commit f4693b08cc901912a87369c46537b94ed4084ea0 upstream.
    
    We can't assign -EINVAL to a u16.
    
    Fixes: 3948f0e0c999 ('usb: add Freescale QE/CPM USB peripheral controller driver')
    Acked-by: Peter Chen <peter.chen@nxp.com>
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f0006eda8e69571fcd8bd657d9c89f30e211e038
Author: Yan, Zheng <zyan@redhat.com>
Date:   Fri Feb 26 16:27:13 2016 +0800

    ceph: fix race during filling readdir cache
    
    commit af5e5eb574776cdf1b756a27cc437bff257e22fe upstream.
    
    Readdir cache uses page cache to save dentry pointers. When adding
    dentry pointers to middle of a page, we need to make sure the page
    already exists. Otherwise the beginning part of the page will be
    invalid pointers.
    
    Signed-off-by: Yan, Zheng <zyan@redhat.com>
    Cc: Nikolay Borisov <kernel@kyup.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9ec153066b081132edb59998c7030f1fb1bd62a8
Author: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Date:   Wed Aug 3 22:06:43 2016 +0300

    iwlwifi: mvm: don't use ret when not initialised
    
    commit ff6e58e648ed5f3cc43891767811d5c3c88bbd41 upstream.
    
    fw-dbg code return ret but that variable was either 0
    or not initialised. Return 0 always.
    
    Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
    Fixes: 6a95126763fb ("iwlwifi: mvm: send dbg config hcmds to fw if set in tlv")
    Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 40dc71547d5833ef90d54fd076816385f2811ef5
Author: Sara Sharon <sara.sharon@intel.com>
Date:   Thu Jun 9 17:19:35 2016 +0300

    iwlwifi: pcie: fix access to scratch buffer
    
    commit d5d0689aefc59c6a5352ca25d7e6d47d03f543ce upstream.
    
    This fixes a pretty ancient bug that hasn't manifested itself
    until now.
    The scratchbuf for command queue is allocated only for 32 slots
    but is accessed with the queue write pointer - which can be
    up to 256.
    Since the scratch buf size was 16 and there are up to 256 TFDs
    we never passed a page boundary when accessing the scratch buffer,
    but when attempting to increase the size of the scratch buffer a
    panic was quick to follow when trying to access the address resulted
    in a page boundary.
    
    Signed-off-by: Sara Sharon <sara.sharon@intel.com>
    Fixes: 38c0f334b359 ("iwlwifi: use coherent DMA memory for command header")
    Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0d5b1752c87c52d25484fea7ce7c24afadd8cd1c
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Fri Aug 5 10:17:52 2016 +0200

    spi: sh-msiof: Avoid invalid clock generator parameters
    
    commit c3ccf357c3d75bd2924e049b6a991f7c0c111068 upstream.
    
    The conversion from a look-up table to a calculation for clock generator
    parameters forgot to take into account that BRDV x 1/1 is valid only if
    BRPS is x 1/1 or x 1/2, leading to undefined behavior (e.g. arbitrary
    clock rates).
    
    This limitation is documented for the MSIOF module in all supported
    SH/R-Mobile and R-Car Gen2/Gen3 ARM SoCs.
    
    Tested on r8a7791/koelsch and r8a7795/salvator-x.
    
    Fixes: 65d5665bb260b034 ("spi: sh-msiof: Update calculation of frequency dividing")
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1229b0840b6a846d326630a6aaa5deaf04d10120
Author: Michael Walle <michael@walle.cc>
Date:   Tue Jul 19 16:43:26 2016 +0200

    hwmon: (adt7411) set bit 3 in CFG1 register
    
    commit b53893aae441a034bf4dbbad42fe218561d7d81f upstream.
    
    According to the datasheet you should only write 1 to this bit. If it is
    not set, at least AIN3 will return bad values on newer silicon revisions.
    
    Fixes: d84ca5b345c2 ("hwmon: Add driver for ADT7411 voltage and temperature sensor")
    Signed-off-by: Michael Walle <michael@walle.cc>
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8e8a07f900d03c1230142749c0f01b6ef2cae8f7
Author: Guenter Roeck <linux@roeck-us.net>
Date:   Thu Jun 2 12:05:12 2016 +0100

    nvmem: Declare nvmem_cell_read() consistently
    
    commit a6c50912508d80164a5e607993b617be85a46d73 upstream.
    
    nvmem_cell_read() is declared as void * if CONFIG_NVMEM is enabled, and
    as char * otherwise. This can result in a build warning if CONFIG_NVMEM
    is not enabled and a caller asigns the result to a type other than char *
    without using a typecast. Use a consistent declaration to avoid the
    problem.
    
    Fixes: e2a5402ec7c6 ("nvmem: Add nvmem_device based consumer apis.")
    Cc: Srinivas Kandagatla <srinivas.kandagatla@linaro.org>
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Srinivas Kandagatla <srinivas.kandagatla@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6ddabc7ae55a4788c05b47a9e9c1c198bd0b64d2
Author: Quentin Armitage <quentin@armitage.org.uk>
Date:   Thu Jun 16 08:00:14 2016 +0100

    ipvs: fix bind to link-local mcast IPv6 address in backup
    
    commit 3777ed688fba82d0bd43f9fc1ebbc6abe788576d upstream.
    
    When using HEAD from
    https://git.kernel.org/cgit/utils/kernel/ipvsadm/ipvsadm.git/,
    the command:
    ipvsadm --start-daemon backup --mcast-interface eth0.60 \
        --mcast-group ff02::1:81
    fails with the error message:
    Argument list too long
    
    whereas both:
    ipvsadm --start-daemon master --mcast-interface eth0.60 \
        --mcast-group ff02::1:81
    and:
    ipvsadm --start-daemon backup --mcast-interface eth0.60 \
        --mcast-group 224.0.0.81
    are successful.
    
    The error message "Argument list too long" isn't helpful. The error occurs
    because an IPv6 address is given in backup mode.
    
    The error is in make_receive_sock() in net/netfilter/ipvs/ip_vs_sync.c,
    since it fails to set the interface on the address or the socket before
    calling inet6_bind() (via sock->ops->bind), where the test
    'if (!sk->sk_bound_dev_if)' failed.
    
    Setting sock->sk->sk_bound_dev_if on the socket before calling
    inet6_bind() resolves the issue.
    
    Fixes: d33288172e72 ("ipvs: add more mcast parameters for the sync daemon")
    Signed-off-by: Quentin Armitage <quentin@armitage.org.uk>
    Acked-by: Julian Anastasov <ja@ssi.bg>
    Signed-off-by: Simon Horman <horms@verge.net.au>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0ddf273c03d36af1b12bc2cfdd74563976c8d0b2
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Wed Jul 20 15:45:05 2016 -0700

    tools/vm/slabinfo: fix an unintentional printf
    
    commit 2d6a4d64812bb12dda53704943b61a7496d02098 upstream.
    
    The curly braces are missing here so we print stuff unintentionally.
    
    Fixes: 9da4714a2d44 ('slub: slabinfo update for cmpxchg handling')
    Link: http://lkml.kernel.org/r/20160715211243.GE19522@mwanda
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Acked-by: Christoph Lameter <cl@linux.com>
    Cc: Sergey Senozhatsky <sergey.senozhatsky@gmail.com>
    Cc: Colin Ian King <colin.king@canonical.com>
    Cc: Laura Abbott <labbott@fedoraproject.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fd0abc1fd2f398992c7796096903a38cbcbd82c5
Author: Robert Jarzmik <robert.jarzmik@free.fr>
Date:   Thu Jul 14 17:05:50 2016 +0200

    mmc: pxamci: fix potential oops
    
    commit b3802db5eb72d2a96f4aa4ff0abb937033df2acf upstream.
    
    As reported by Dan in his report in [1], there is a potential NULL
    pointer derefence if these conditions are met :
     - there is no platform_data provided, ie. host->pdata = NULL
    
    Fix this by only using the platform data ro_invert when a gpio for
    read-only is provided by the platform data.
    
    This doesn't appear yet as every pxa board provides a platform_data, and
    calls pxa_set_mci_info() with a non NULL pointer.
    
    [1] [bug report] mmc: pxamci: fix card detect with slot-gpio API.
    The commit fd546ee6a7dc ("mmc: pxamci: fix card detect with slot-gpio
    API") from Sep 26, 2015, leads to the following static checker warning:
    
            drivers/mmc/host/pxamci.c:809 pxamci_probe()
            warn: variable dereferenced before check 'host->pdata' (see line 798)
    
    Fixes: fd546ee6a7dc ("mmc: pxamci: fix card detect with slot-gpio API")
    Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Robert Jarzmik <robert.jarzmik@free.fr>
    Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2b86bd6a16074544a477410cd5d390b9b3e72958
Author: Stefan Wahren <stefan.wahren@i2se.com>
Date:   Sat Aug 27 16:19:49 2016 +0000

    drivers/perf: arm_pmu: Fix leak in error path
    
    commit 753246840d012ae34ea80a1d40bc1546c62fb957 upstream.
    
    In case of a IRQ type mismatch in of_pmu_irq_cfg() the
    device node for interrupt affinity isn't freed. So fix this
    issue by calling of_node_put().
    
    Signed-off-by: Stefan Wahren <stefan.wahren@i2se.com>
    Fixes: fa8ad7889d83 ("arm: perf: factor arm_pmu core out to drivers")
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8996a69c0ebe0e38af254317d31625fc476a93de
Author: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Date:   Tue Jun 21 01:40:48 2016 +0300

    pinctrl: Flag strict is a field in struct pinmux_ops
    
    commit 7440926ed9623dceca3310c5f437d06c859dc02b upstream.
    
    Documentation incorrectly refers to struct pinctrl_desc, where no such flag is
    available. Replace the name of the struct.
    
    Fixes: commit 8c4c2016345f ("pinctrl: move strict option to pinmux_ops")
    Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2857aac419e4e57fb3fc0f3762307b4975f0cd30
Author: Masahiro Yamada <yamada.masahiro@socionext.com>
Date:   Tue May 31 15:30:10 2016 +0900

    pinctrl: uniphier: fix .pin_dbg_show() callback
    
    commit 10ef8277ec658bf6619da9b3fd65c2db7353c2a4 upstream.
    
    Without this, reading the "pins" in the debugfs causes kernel BUG.
    
    Fixes: 6e9088920258 ("pinctrl: UniPhier: add UniPhier pinctrl core support")
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1bcafa3814f3564dc663f8ac3de84fa49bad0b35
Author: Heinrich Schuchardt <xypron.glpk@gmx.de>
Date:   Tue May 17 22:41:33 2016 +0200

    i40e: avoid null pointer dereference
    
    commit cd956722167ba4fdba9c1ce3eed251b04ea2e10f upstream.
    
    In function i40e_debug_aq parameter desc is assumed to be
    possibly NULL. Do not dereference it before checking the
    value.
    
    Fixes: f905dd62be88 ("i40e/i40evf: add max buf len to aq debug print helper")
    Signed-off-by: Heinrich Schuchardt <xypron.glpk@gmx.de>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 711a78a79254470731f2d5f83c22d68c1951ea11
Author: Mark Rutland <mark.rutland@arm.com>
Date:   Tue Jun 14 16:10:41 2016 +0100

    perf/core: Fix pmu::filter_match for SW-led groups
    
    commit 2c81a6477081966fe80b8c6daa68459bca896774 upstream.
    
    The following commit:
    
      66eb579e66ec ("perf: allow for PMU-specific event filtering")
    
    added the pmu::filter_match() callback. This was intended to
    avoid HW constraints on events from resulting in extremely
    pessimistic scheduling.
    
    However, pmu::filter_match() is only called for the leader of each event
    group. When the leader is a SW event, we do not filter the groups, and
    may fail at pmu::add() time, and when this happens we'll give up on
    scheduling any event groups later in the list until they are rotated
    ahead of the failing group.
    
    This can result in extremely sub-optimal event scheduling behaviour,
    e.g. if running the following on a big.LITTLE platform:
    
    $ taskset -c 0 ./perf stat \
     -e 'a57{context-switches,armv8_cortex_a57/config=0x11/}' \
     -e 'a53{context-switches,armv8_cortex_a53/config=0x11/}' \
     ls
    
         <not counted>      context-switches                                              (0.00%)
         <not counted>      armv8_cortex_a57/config=0x11/                                 (0.00%)
                    24      context-switches                                              (37.36%)
              57589154      armv8_cortex_a53/config=0x11/                                 (37.36%)
    
    Here the 'a53' event group was always eligible to be scheduled, but
    the 'a57' group never eligible to be scheduled, as the task was always
    affine to a Cortex-A53 CPU. The SW (group leader) event in the 'a57'
    group was eligible, but the HW event failed at pmu::add() time,
    resulting in ctx_flexible_sched_in giving up on scheduling further
    groups with HW events.
    
    One way of avoiding this is to check pmu::filter_match() on siblings
    as well as the group leader. If any of these fail their
    pmu::filter_match() call, we must skip the entire group before
    attempting to add any events.
    
    Signed-off-by: Mark Rutland <mark.rutland@arm.com>
    Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Cc: Arnaldo Carvalho de Melo <acme@kernel.org>
    Cc: Arnaldo Carvalho de Melo <acme@redhat.com>
    Cc: Jiri Olsa <jolsa@redhat.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: Will Deacon <will.deacon@arm.com>
    Fixes: 66eb579e66ec ("perf: allow for PMU-specific event filtering")
    Link: http://lkml.kernel.org/r/1465917041-15339-1-git-send-email-mark.rutland@arm.com
    [ Small readability edits. ]
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 37fcf8f421a7bafeeba71cc3c4e7bb01e909310d
Author: Johannes Berg <johannes.berg@intel.com>
Date:   Tue Jun 7 14:46:37 2016 +0200

    iwlwifi: mvm: fix a few firmware capability checks
    
    commit 280a3efa82fccc9532c968a77e5162cb9f0af497 upstream.
    
    My cleanup in "iwlwifi: prepare for higher API/CAPA bits" accidentally
    inverted a few tests - fix them.
    
    Fixes: 859d914c8f5c ("iwlwifi: prepare for higher API/CAPA bits")
    Reported-by: Sara Sharon <sara.sharon@intel.com>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d174ec8385a7daae16572788df81e7bad190f30f
Author: Cristian Birsan <cristian.birsan@microchip.com>
Date:   Fri Feb 19 10:11:56 2016 +0200

    usb: musb: fix DMA for host mode
    
    commit 4c2ba0c67394514f3f75c660c9f5d02e66a7efd4 upstream.
    
    Commit ac33cdb16681 ("usb: musb: Remove ifdefs for musb_host_rx in
    musb_host.c part5") introduces a problem setting DMA host mode.
    
    The musb_advance_schedule() is called immediately after receiving an
    endpoint RX interrupt without waiting for the DMA transfer to complete.
    
    As a consequence when the dma complete interrupt arrives the in_qh
    member of hw_ep is already null an the musb_host_rx() exits on !urb
    error case. Fix the done condition that advances the musb schedule.
    
    Signed-off-by: Cristian Birsan <cristian.birsan@microchip.com>
    Signed-off-by: Joshua Henderson <joshua.henderson@microchip.com>
    Tested-by: Ladislav Michl <ladis@linux-mips.org>
    Signed-off-by: Felipe Balbi <balbi@kernel.org>
    Cc: Tony Lindgren <tony@atomide.com>
    Cc: Adam Ford <aford173@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ff44aaa9d4438d1b3b5986476a2be8efa6987b77
Author: Cristian Birsan <cristian.birsan@microchip.com>
Date:   Thu Feb 11 08:58:17 2016 -0700

    usb: musb: Fix DMA desired mode for Mentor DMA engine
    
    commit bba40e6948b94cba71965285fbac31bd078c024a upstream.
    
    Commit 754fe4a92c07 ("usb: musb: Remove ifdefs for TX DMA for musb_host.c")
    introduces a problem setting the desired channel mode for the Mentor DMA
    engine.
    
    There is a case where an address is incorrectly assigned to the DMA
    channel desired mode when it should instead be assigned the actual mode
    value. This results in the value of channel->desired_mode not being
    correct.
    
    Acked-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Signed-off-by: Cristian Birsan <cristian.birsan@microchip.com>
    Signed-off-by: Joshua Henderson <joshua.henderson@microchip.com>
    Signed-off-by: Felipe Balbi <balbi@kernel.org>
    Cc: Adam Ford <aford173@gmail.com>
    Cc: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3e3809d03c25ffbc082e8be31b0ac1ce3e3eea10
Author: Roger Quadros <rogerq@ti.com>
Date:   Thu Sep 29 08:32:55 2016 +0100

    ARM: 8617/1: dma: fix dma_max_pfn()
    
    commit d248220f0465b818887baa9829e691fe662b2c5e upstream.
    
    Since commit 6ce0d2001692 ("ARM: dma: Use dma_pfn_offset for dma address translation"),
    dma_to_pfn() already returns the PFN with the physical memory start offset
    so we don't need to add it again.
    
    This fixes USB mass storage lock-up problem on systems that can't do DMA
    over the entire physical memory range (e.g.) Keystone 2 systems with 4GB RAM
    can only do DMA over the first 2GB. [K2E-EVM].
    
    What happens there is that without this patch SCSI layer sets a wrong
    bounce buffer limit in scsi_calculate_bounce_limit() for the USB mass
    storage device. dma_max_pfn() evaluates to 0x8fffff and bounce_limit
    is set to 0x8fffff000 whereas maximum DMA'ble physical memory on Keystone 2
    is 0x87fffffff. This results in non DMA'ble pages being given to the
    USB controller and hence the lock-up.
    
    NOTE: in the above case, USB-SCSI-device's dma_pfn_offset was showing as 0.
    This should have really been 0x780000 as on K2e, LOWMEM_START is 0x80000000
    and HIGHMEM_START is 0x800000000. DMA zone is 2GB so dma_max_pfn should be
    0x87ffff. The incorrect dma_pfn_offset for the USB storage device is because
    USB devices are not correctly inheriting the dma_pfn_offset from the
    USB host controller. This will be fixed by a separate patch.
    
    Fixes: 6ce0d2001692 ("ARM: dma: Use dma_pfn_offset for dma address translation")
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Cc: Santosh Shilimkar <santosh.shilimkar@oracle.com>
    Cc: Arnd Bergmann <arnd@arndb.de>
    Cc: Olof Johansson <olof@lixom.net>
    Cc: Catalin Marinas <catalin.marinas@arm.com>
    Cc: Linus Walleij <linus.walleij@linaro.org>
    Reported-by: Grygorii Strashko <grygorii.strashko@ti.com>
    Signed-off-by: Roger Quadros <rogerq@ti.com>
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c84cc7b9064a22aaf73c3a5fc4c073cd4d588c98
Author: Robin Murphy <robin.murphy@arm.com>
Date:   Mon Sep 26 16:50:55 2016 +0100

    ARM: 8616/1: dt: Respect property size when parsing CPUs
    
    commit ba6dea4f7cedb4b1c17e36f4087675d817c2e24b upstream.
    
    Whilst MPIDR values themselves are less than 32 bits, it is still
    perfectly valid for a DT to have #address-cells > 1 in the CPUs node,
    resulting in the "reg" property having leading zero cell(s). In that
    situation, the big-endian nature of the data conspires with the current
    behaviour of only reading the first cell to cause the kernel to think
    all CPUs have ID 0, and become resoundingly unhappy as a consequence.
    
    Take the full property length into account when parsing CPUs so as to
    be correct under any circumstances.
    
    Cc: Russell King <linux@armlinux.org.uk>
    Signed-off-by: Robin Murphy <robin.murphy@arm.com>
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 75e5de50532f91b166d9340a128ffc4752da657f
Author: Alex Deucher <alexander.deucher@amd.com>
Date:   Mon Sep 26 15:32:50 2016 -0400

    drm/radeon/si/dpm: add workaround for for Jet parts
    
    commit 670bb4fd21c966d0d2a59ad4a99bb4889f9a2987 upstream.
    
    Add clock quirks for Jet parts.
    
    Reviewed-by: Sonny Jiang <sonny.jiang@amd.com>
    Tested-by: Sonny Jiang <sonny.jiang@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a2898f8526d17f9ead10544d6654f906a315ad6a
Author: Ilia Mirkin <imirkin@alum.mit.edu>
Date:   Fri Sep 9 22:34:02 2016 -0400

    drm/nouveau/fifo/nv04: avoid ramht race against cookie insertion
    
    commit 666ca3d8f19082f40745d75f3cc7cc0200ee87e3 upstream.
    
    Signed-off-by: Ilia Mirkin <imirkin@alum.mit.edu>
    Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7ba8db47da9387dd95c3638e87772b570733f614
Author: Andy Lutomirski <luto@kernel.org>
Date:   Wed Sep 28 16:06:33 2016 -0700

    x86/boot: Initialize FPU and X86_FEATURE_ALWAYS even if we don't have CPUID
    
    commit 05fb3c199bb09f5b85de56cc3ede194ac95c5e1f upstream.
    
    Otherwise arch_task_struct_size == 0 and we die.  While we're at it,
    set X86_FEATURE_ALWAYS, too.
    
    Reported-by: David Saggiorato <david@saggiorato.net>
    Tested-by: David Saggiorato <david@saggiorato.net>
    Signed-off-by: Andy Lutomirski <luto@kernel.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Brian Gerst <brgerst@gmail.com>
    Cc: Dave Hansen <dave@sr71.net>
    Cc: Denys Vlasenko <dvlasenk@redhat.com>
    Cc: H. Peter Anvin <hpa@zytor.com>
    Cc: Josh Poimboeuf <jpoimboe@redhat.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Fixes: aaeb5c01c5b ("x86/fpu, sched: Introduce CONFIG_ARCH_WANTS_DYNAMIC_TASK_STRUCT and use it on x86")
    Link: http://lkml.kernel.org/r/8de723afbf0811071185039f9088733188b606c9.1475103911.git.luto@kernel.org
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6c0db7437f4d0a0ce9dcbecb811275d034b11b96
Author: Andy Lutomirski <luto@kernel.org>
Date:   Wed Sep 28 12:34:14 2016 -0700

    x86/init: Fix cr4_init_shadow() on CR4-less machines
    
    commit e1bfc11c5a6f40222a698a818dc269113245820e upstream.
    
    cr4_init_shadow() will panic on 486-like machines without CR4.  Fix
    it using __read_cr4_safe().
    
    Reported-by: david@saggiorato.net
    Signed-off-by: Andy Lutomirski <luto@kernel.org>
    Reviewed-by: Borislav Petkov <bp@suse.de>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Brian Gerst <brgerst@gmail.com>
    Cc: Denys Vlasenko <dvlasenk@redhat.com>
    Cc: H. Peter Anvin <hpa@zytor.com>
    Cc: Josh Poimboeuf <jpoimboe@redhat.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Fixes: 1e02ce4cccdc ("x86: Store a per-cpu shadow copy of CR4")
    Link: http://lkml.kernel.org/r/43a20f81fb504013bf613913dc25574b45336a61.1475091074.git.luto@kernel.org
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7677956e4094595732df548681ea9c4d66821bdb
Author: Sergei Miroshnichenko <sergeimir@emcraft.com>
Date:   Wed Sep 7 16:51:12 2016 +0300

    can: dev: fix deadlock reported after bus-off
    
    commit 9abefcb1aaa58b9d5aa40a8bb12c87d02415e4c8 upstream.
    
    A timer was used to restart after the bus-off state, leading to a
    relatively large can_restart() executed in an interrupt context,
    which in turn sets up pinctrl. When this happens during system boot,
    there is a high probability of grabbing the pinctrl_list_mutex,
    which is locked already by the probe() of other device, making the
    kernel suspect a deadlock condition [1].
    
    To resolve this issue, the restart_timer is replaced by a delayed
    work.
    
    [1] https://github.com/victronenergy/venus/issues/24
    
    Signed-off-by: Sergei Miroshnichenko <sergeimir@emcraft.com>
    Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a2fc10c36f74a6a6f08649f9cff432bc65a16550
Author: zhong jiang <zhongjiang@huawei.com>
Date:   Wed Sep 28 15:22:30 2016 -0700

    mm,ksm: fix endless looping in allocating memory when ksm enable
    
    commit 5b398e416e880159fe55eefd93c6588fa072cd66 upstream.
    
    I hit the following hung task when runing a OOM LTP test case with 4.1
    kernel.
    
    Call trace:
    [<ffffffc000086a88>] __switch_to+0x74/0x8c
    [<ffffffc000a1bae0>] __schedule+0x23c/0x7bc
    [<ffffffc000a1c09c>] schedule+0x3c/0x94
    [<ffffffc000a1eb84>] rwsem_down_write_failed+0x214/0x350
    [<ffffffc000a1e32c>] down_write+0x64/0x80
    [<ffffffc00021f794>] __ksm_exit+0x90/0x19c
    [<ffffffc0000be650>] mmput+0x118/0x11c
    [<ffffffc0000c3ec4>] do_exit+0x2dc/0xa74
    [<ffffffc0000c46f8>] do_group_exit+0x4c/0xe4
    [<ffffffc0000d0f34>] get_signal+0x444/0x5e0
    [<ffffffc000089fcc>] do_signal+0x1d8/0x450
    [<ffffffc00008a35c>] do_notify_resume+0x70/0x78
    
    The oom victim cannot terminate because it needs to take mmap_sem for
    write while the lock is held by ksmd for read which loops in the page
    allocator
    
    ksm_do_scan
            scan_get_next_rmap_item
                    down_read
                    get_next_rmap_item
                            alloc_rmap_item   #ksmd will loop permanently.
    
    There is no way forward because the oom victim cannot release any memory
    in 4.1 based kernel.  Since 4.6 we have the oom reaper which would solve
    this problem because it would release the memory asynchronously.
    Nevertheless we can relax alloc_rmap_item requirements and use
    __GFP_NORETRY because the allocation failure is acceptable as ksm_do_scan
    would just retry later after the lock got dropped.
    
    Such a patch would be also easy to backport to older stable kernels which
    do not have oom_reaper.
    
    While we are at it add GFP_NOWARN so the admin doesn't have to be alarmed
    by the allocation failure.
    
    Link: http://lkml.kernel.org/r/1474165570-44398-1-git-send-email-zhongjiang@huawei.com
    Signed-off-by: zhong jiang <zhongjiang@huawei.com>
    Suggested-by: Hugh Dickins <hughd@google.com>
    Suggested-by: Michal Hocko <mhocko@suse.cz>
    Acked-by: Michal Hocko <mhocko@suse.com>
    Acked-by: Hugh Dickins <hughd@google.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 05d721d61e75ec52e986af998ed145c54ed327fe
Author: Karl Beldan <kbeldan@baylibre.com>
Date:   Mon Aug 29 07:45:49 2016 +0000

    mtd: nand: davinci: Reinitialize the HW ECC engine in 4bit hwctl
    
    commit f6d7c1b5598b6407c3f1da795dd54acf99c1990c upstream.
    
    This fixes subpage writes when using 4-bit HW ECC.
    
    There has been numerous reports about ECC errors with devices using this
    driver for a while.  Also the 4-bit ECC has been reported as broken with
    subpages in [1] and with 16 bits NANDs in the driver and in mach* board
    files both in mainline and in the vendor BSPs.
    
    What I saw with 4-bit ECC on a 16bits NAND (on an LCDK) which got me to
    try reinitializing the ECC engine:
    - R/W on whole pages properly generates/checks RS code
    - try writing the 1st subpage only of a blank page, the subpage is well
      written and the RS code properly generated, re-reading the same page
      the HW detects some ECC error, reading the same page again no ECC
      error is detected
    
    Note that the ECC engine is already reinitialized in the 1-bit case.
    
    Tested on my LCDK with UBI+UBIFS using subpages.
    This could potentially get rid of the issue workarounded in [1].
    
    [1] 28c015a9daab ("mtd: davinci-nand: disable subpage write for keystone-nand")
    
    Fixes: 6a4123e581b3 ("mtd: nand: davinci_nand, 4-bit ECC for smallpage")
    Signed-off-by: Karl Beldan <kbeldan@baylibre.com>
    Acked-by: Boris Brezillon <boris.brezillon@free-electrons.com>
    Signed-off-by: Brian Norris <computersforpeace@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 8132ffc977a4d4572b57362bce70e7e4405bc081
Author: Joonwoo Park <joonwoop@codeaurora.org>
Date:   Sun Sep 11 21:14:58 2016 -0700

    cpuset: handle race between CPU hotplug and cpuset_hotplug_work
    
    commit 28b89b9e6f7b6c8fef7b3af39828722bca20cfee upstream.
    
    A discrepancy between cpu_online_mask and cpuset's effective_cpus
    mask is inevitable during hotplug since cpuset defers updating of
    effective_cpus mask using a workqueue, during which time nothing
    prevents the system from more hotplug operations.  For that reason
    guarantee_online_cpus() walks up the cpuset hierarchy until it finds
    an intersection under the assumption that top cpuset's effective_cpus
    mask intersects with cpu_online_mask even with such a race occurring.
    
    However a sequence of CPU hotplugs can open a time window, during which
    none of the effective CPUs in the top cpuset intersect with
    cpu_online_mask.
    
    For example when there are 4 possible CPUs 0-3 and only CPU0 is online:
    
      ========================  ===========================
       cpu_online_mask           top_cpuset.effective_cpus
      ========================  ===========================
       echo 1 > cpu2/online.
       CPU hotplug notifier woke up hotplug work but not yet scheduled.
          [0,2]                     [0]
    
       echo 0 > cpu0/online.
       The workqueue is still runnable.
          [2]                       [0]
      ========================  ===========================
    
      Now there is no intersection between cpu_online_mask and
      top_cpuset.effective_cpus.  Thus invoking sys_sched_setaffinity() at
      this moment can cause following:
    
       Unable to handle kernel NULL pointer dereference at virtual address 000000d0
       ------------[ cut here ]------------
       Kernel BUG at ffffffc0001389b0 [verbose debug info unavailable]
       Internal error: Oops - BUG: 96000005 [#1] PREEMPT SMP
       Modules linked in:
       CPU: 2 PID: 1420 Comm: taskset Tainted: G        W       4.4.8+ #98
       task: ffffffc06a5c4880 ti: ffffffc06e124000 task.ti: ffffffc06e124000
       PC is at guarantee_online_cpus+0x2c/0x58
       LR is at cpuset_cpus_allowed+0x4c/0x6c
       <snip>
       Process taskset (pid: 1420, stack limit = 0xffffffc06e124020)
       Call trace:
       [<ffffffc0001389b0>] guarantee_online_cpus+0x2c/0x58
       [<ffffffc00013b208>] cpuset_cpus_allowed+0x4c/0x6c
       [<ffffffc0000d61f0>] sched_setaffinity+0xc0/0x1ac
       [<ffffffc0000d6374>] SyS_sched_setaffinity+0x98/0xac
       [<ffffffc000085cb0>] el0_svc_naked+0x24/0x28
    
    The top cpuset's effective_cpus are guaranteed to be identical to
    cpu_online_mask eventually.  Hence fall back to cpu_online_mask when
    there is no intersection between top cpuset's effective_cpus and
    cpu_online_mask.
    
    Signed-off-by: Joonwoo Park <joonwoop@codeaurora.org>
    Acked-by: Li Zefan <lizefan@huawei.com>
    Cc: Tejun Heo <tj@kernel.org>
    Cc: cgroups@vger.kernel.org
    Cc: linux-kernel@vger.kernel.org
    Signed-off-by: Tejun Heo <tj@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
