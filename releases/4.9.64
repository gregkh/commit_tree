commit 563c24f65f4fb009047cf4702dd16c7c592fd2b2
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Tue Nov 21 09:23:30 2017 +0100

    Linux 4.9.64

commit 6fbd42df92170ed24688ed35d95d54c4b42e0c33
Author: Johan Hovold <johan@kernel.org>
Date:   Sun Oct 29 13:01:33 2017 +0100

    staging: greybus: spilib: fix use-after-free after deregistration
    
    commit 770b03c2ca4aa44d226cf248f86aa23e546147d0 upstream.
    
    Remove erroneous spi_master_put() after controller deregistration which
    would access the already freed spi controller.
    
    Note that spi_unregister_master() drops our only controller reference.
    
    Fixes: ba3e67001b42 ("greybus: SPI: convert to a gpbridge driver")
    Signed-off-by: Johan Hovold <johan@kernel.org>
    Reviewed-by: Rui Miguel Silva <rmfrfs@gmail.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d8b5d88d219522877b0bed1b5114dddedf042d70
Author: Rafał Miłecki <rafal@milecki.pl>
Date:   Sat Jan 7 21:36:04 2017 +0100

    brcmfmac: don't preset all channels as disabled
    
    commit 9ea0c307609fd20e03f53546b9cefbb20b96785d upstream.
    
    During init we take care of regulatory stuff by disabling all
    unavailable channels (see brcmf_construct_chaninfo) so this predisabling
    them is not really required (and this patch won't change any behavior).
    It will on the other hand allow more detailed runtime control over
    channels which is the main reason for this change.
    
    Signed-off-by: Rafał Miłecki <rafal@milecki.pl>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Cc: Lambdadroid <lambdadroid@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 54a5155afa84d39d4fa92b775213f46f334625b9
Author: Yazen Ghannam <yazen.ghannam@amd.com>
Date:   Mon Nov 6 18:46:32 2017 +0100

    x86/MCE/AMD: Always give panic severity for UC errors in kernel context
    
    commit d65dfc81bb3894fdb68cbc74bbf5fb48d2354071 upstream.
    
    The AMD severity grading function was introduced in kernel 4.1. The
    current logic can possibly give MCE_AR_SEVERITY for uncorrectable
    errors in kernel context. The system may then get stuck in a loop as
    memory_failure() will try to handle the bad kernel memory and find it
    busy.
    
    Return MCE_PANIC_SEVERITY for all UC errors IN_KERNEL context on AMD
    systems.
    
    After:
    
      b2f9d678e28c ("x86/mce: Check for faults tagged in EXTABLE_CLASS_FAULT exception table entries")
    
    was accepted in v4.6, this issue was masked because of the tail-end attempt
    at kernel mode recovery in the #MC handler.
    
    However, uncorrectable errors IN_KERNEL context should always be considered
    unrecoverable and cause a panic.
    
    Signed-off-by: Yazen Ghannam <yazen.ghannam@amd.com>
    Signed-off-by: Borislav Petkov <bp@suse.de>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: Tony Luck <tony.luck@intel.com>
    Cc: linux-edac <linux-edac@vger.kernel.org>
    Fixes: bf80bbd7dcf5 (x86/mce: Add an AMD severities-grading function)
    Link: http://lkml.kernel.org/r/20171106174633.13576-1-bp@alien8.de
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f6643fc829e03dae653106c981c7edfa4a356162
Author: Johan Hovold <johan@kernel.org>
Date:   Wed Oct 11 14:02:58 2017 +0200

    USB: serial: garmin_gps: fix memory leak on probe errors
    
    commit 74d471b598444b7f2d964930f7234779c80960a0 upstream.
    
    Make sure to free the port private data before returning after a failed
    probe attempt.
    
    Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
    Reviewed-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Johan Hovold <johan@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 579cf722f8c10858ef6ce46154d950d40feb6ddb
Author: Johan Hovold <johan@kernel.org>
Date:   Wed Oct 11 14:02:57 2017 +0200

    USB: serial: garmin_gps: fix I/O after failed probe and remove
    
    commit 19a565d9af6e0d828bd0d521d3bafd5017f4ce52 upstream.
    
    Make sure to stop any submitted interrupt and bulk-out URBs before
    returning after failed probe and when the port is being unbound to avoid
    later NULL-pointer dereferences in the completion callbacks.
    
    Also fix up the related and broken I/O cancellation on failed open and
    on close. (Note that port->write_urb was never submitted.)
    
    Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
    Reviewed-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Johan Hovold <johan@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1f9688d551e3b0c524e65905ea6d56008e7a32a1
Author: Douglas Fischer <douglas.fischer@outlook.com>
Date:   Sun Oct 29 23:29:55 2017 +0000

    USB: serial: qcserial: add pid/vid for Sierra Wireless EM7355 fw update
    
    commit 771394a54148f18926ca86414e51c69eda27d0cd upstream.
    
    Add USB PID/VID for Sierra Wireless EM7355 LTE modem QDL firmware update
    mode.
    
    Signed-off-by: Douglas Fischer <douglas.fischer@outlook.com>
    Signed-off-by: Johan Hovold <johan@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fd6a742d8bf7eac61d6351cb5d77f97a71f099bd
Author: Andrew Gabbasov <andrew_gabbasov@mentor.com>
Date:   Wed Nov 8 10:13:15 2017 -0700

    usb: gadget: f_fs: Fix use-after-free in ffs_free_inst
    
    commit cdafb6d8b8da7fde266f79b3287ac221aa841879 upstream.
    
    KASAN enabled configuration reports an error
    
    BUG: KASAN: use-after-free in ffs_free_inst+... [usb_f_fs] at addr ...
    Write of size 8 by task ...
    
    This is observed after "ffs-test" is run and interrupted. If after that
    functionfs is unmounted and g_ffs module is unloaded, that use-after-free
    occurs during g_ffs module removal.
    
    Although the report indicates ffs_free_inst() function, the actual
    use-after-free condition occurs in _ffs_free_dev() function, which
    is probably inlined into ffs_free_inst().
    
    This happens due to keeping the ffs_data reference in device structure
    during functionfs unmounting, while ffs_data itself is freed as no longer
    needed. The fix is to clear that reference in ffs_closed() function,
    which is a counterpart of ffs_ready(), where the reference is stored.
    
    Fixes: 3262ad824307 ("usb: gadget: f_fs: Stop ffs_closed NULL pointer dereference")
    Signed-off-by: Andrew Gabbasov <andrew_gabbasov@mentor.com>
    Acked-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 599973738e282af0f3f78682ce4ef4908dda6a2c
Author: Bernhard Rosenkraenzer <bernhard.rosenkranzer@linaro.org>
Date:   Fri Nov 3 16:46:02 2017 +0100

    USB: Add delay-init quirk for Corsair K70 LUX keyboards
    
    commit a0fea6027f19c62727315aba1a7fae75a9caa842 upstream.
    
    Without this patch, K70 LUX keyboards don't work, saying
    usb 3-3: unable to read config index 0 descriptor/all
    usb 3-3: can't read configurations, error -110
    usb usb3-port3: unable to enumerate USB device
    
    Signed-off-by: Bernhard Rosenkraenzer <Bernhard.Rosenkranzer@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 87ff414178cb2fc5ab30b636a3505efe248f6882
Author: Alan Stern <stern@rowland.harvard.edu>
Date:   Wed Nov 8 12:23:17 2017 -0500

    USB: usbfs: compute urb->actual_length for isochronous
    
    commit 2ef47001b3ee3ded579b7532ebdcf8680e4d8c54 upstream.
    
    The USB kerneldoc says that the actual_length field "is read in
    non-iso completion functions", but the usbfs driver uses it for all
    URB types in processcompl().  Since not all of the host controller
    drivers set actual_length for isochronous URBs, programs using usbfs
    with some host controllers don't work properly.  For example, Minas
    reports that a USB camera controlled by libusb doesn't work properly
    with a dwc2 controller.
    
    It doesn't seem worthwhile to change the HCDs and the documentation,
    since the in-kernel USB class drivers evidently don't rely on
    actual_length for isochronous transfers.  The easiest solution is for
    usbfs to calculate the actual_length value for itself, by adding up
    the lengths of the individual packets in an isochronous transfer.
    
    Signed-off-by: Alan Stern <stern@rowland.harvard.edu>
    CC: Minas Harutyunyan <Minas.Harutyunyan@synopsys.com>
    Reported-and-tested-by: wlf <wulf@rock-chips.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 11fdb41a1faac5635f9646149b4027809259ce89
Author: Eric Biggers <ebiggers@google.com>
Date:   Sun Nov 5 18:30:46 2017 -0800

    crypto: dh - Don't permit 'key' or 'g' size longer than 'p'
    
    commit ccd9888f14a8019c0bbdeeae758aba1f58693712 upstream.
    
    The "qat-dh" DH implementation assumes that 'key' and 'g' can be copied
    into a buffer with size 'p_size'.  However it was never checked that
    that was actually the case, which most likely allowed users to cause a
    buffer underflow via KEYCTL_DH_COMPUTE.
    
    Fix this by updating crypto_dh_decode_key() to verify this precondition
    for all DH implementations.
    
    Fixes: c9839143ebbf ("crypto: qat - Add DH support")
    Signed-off-by: Eric Biggers <ebiggers@google.com>
    Reviewed-by: Tudor Ambarus <tudor.ambarus@microchip.com>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2d3a0d9501566876ce0d1d9200402eb457e072e0
Author: Eric Biggers <ebiggers@google.com>
Date:   Sun Nov 5 18:30:45 2017 -0800

    crypto: dh - Don't permit 'p' to be 0
    
    commit 199512b1234f09e44d592153ec82b44212b2f0c4 upstream.
    
    If 'p' is 0 for the software Diffie-Hellman implementation, then
    dh_max_size() returns 0.  In the case of KEYCTL_DH_COMPUTE, this causes
    ZERO_SIZE_PTR to be passed to sg_init_one(), which with
    CONFIG_DEBUG_SG=y triggers the 'BUG_ON(!virt_addr_valid(buf));' in
    sg_set_buf().
    
    Fix this by making crypto_dh_decode_key() reject 0 for 'p'.  p=0 makes
    no sense for any DH implementation because 'p' is supposed to be a prime
    number.  Moreover, 'mod 0' is not mathematically defined.
    
    Bug report:
    
        kernel BUG at ./include/linux/scatterlist.h:140!
        invalid opcode: 0000 [#1] SMP KASAN
        CPU: 0 PID: 27112 Comm: syz-executor2 Not tainted 4.14.0-rc7-00010-gf5dbb5d0ce32-dirty #7
        Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.3-20171021_125229-anatol 04/01/2014
        task: ffff88006caac0c0 task.stack: ffff88006c7c8000
        RIP: 0010:sg_set_buf include/linux/scatterlist.h:140 [inline]
        RIP: 0010:sg_init_one+0x1b3/0x240 lib/scatterlist.c:156
        RSP: 0018:ffff88006c7cfb08 EFLAGS: 00010216
        RAX: 0000000000010000 RBX: ffff88006c7cfe30 RCX: 00000000000064ee
        RDX: ffffffff81cf64c3 RSI: ffffc90000d72000 RDI: ffffffff92e937e0
        RBP: ffff88006c7cfb30 R08: ffffed000d8f9fab R09: ffff88006c7cfd30
        R10: 0000000000000005 R11: ffffed000d8f9faa R12: ffff88006c7cfd30
        R13: 0000000000000000 R14: 0000000000000010 R15: ffff88006c7cfc50
        FS:  00007fce190fa700(0000) GS:ffff88003ea00000(0000) knlGS:0000000000000000
        CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
        CR2: 00007fffc6b33db8 CR3: 000000003cf64000 CR4: 00000000000006f0
        Call Trace:
         __keyctl_dh_compute+0xa95/0x19b0 security/keys/dh.c:360
         keyctl_dh_compute+0xac/0x100 security/keys/dh.c:434
         SYSC_keyctl security/keys/keyctl.c:1745 [inline]
         SyS_keyctl+0x72/0x2c0 security/keys/keyctl.c:1641
         entry_SYSCALL_64_fastpath+0x1f/0xbe
        RIP: 0033:0x4585c9
        RSP: 002b:00007fce190f9bd8 EFLAGS: 00000216 ORIG_RAX: 00000000000000fa
        RAX: ffffffffffffffda RBX: 0000000000738020 RCX: 00000000004585c9
        RDX: 000000002000d000 RSI: 0000000020000ff4 RDI: 0000000000000017
        RBP: 0000000000000046 R08: 0000000020008000 R09: 0000000000000000
        R10: 0000000000000000 R11: 0000000000000216 R12: 00007fff6e610cde
        R13: 00007fff6e610cdf R14: 00007fce190fa700 R15: 0000000000000000
        Code: 03 0f b6 14 02 48 89 f8 83 e0 07 83 c0 03 38 d0 7c 04 84 d2 75 33 5b 45 89 6c 24 14 41 5c 41 5d 41 5e 41 5f 5d c3 e8 fd 8f 68 ff <0f> 0b e8 f6 8f 68 ff 0f 0b e8 ef 8f 68 ff 0f 0b e8 e8 8f 68 ff 20
        RIP: sg_set_buf include/linux/scatterlist.h:140 [inline] RSP: ffff88006c7cfb08
        RIP: sg_init_one+0x1b3/0x240 lib/scatterlist.c:156 RSP: ffff88006c7cfb08
    
    Fixes: 802c7f1c84e4 ("crypto: dh - Add DH software implementation")
    Reviewed-by: Tudor Ambarus <tudor.ambarus@microchip.com>
    Signed-off-by: Eric Biggers <ebiggers@google.com>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e38fe6397f732b892f1cf60ea74024839d1a1291
Author: Sasha Levin <alexander.levin@verizon.com>
Date:   Thu Nov 16 21:04:58 2017 -0500

    Revert "dt-bindings: Add LEGO MINDSTORMS EV3 compatible specification"
    
    
    This reverts commit 852bf68b7a62195c3c0c63f3b11f3f30958fc220.
    
    As Ben pointed out, these drivers don't exist in <=4.9.
    
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a9a3cb25d9c1cd1fd69d4d72d9ba746434936ed2
Author: Sasha Levin <alexander.levin@verizon.com>
Date:   Thu Nov 16 21:04:38 2017 -0500

    Revert "dt-bindings: Add vendor prefix for LEGO"
    
    
    This reverts commit 04e13a5ec96db94c1cc8ce7b0b1e1b626e0c00c7.
    
    As Ben pointed out, these drivers don't exist in <=4.9.
    
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f95d6058d5cca34687efc76dff7998f82ee98534
Author: Dmitry V. Levin <ldv@altlinux.org>
Date:   Thu Feb 16 18:05:13 2017 +0300

    uapi: fix linux/rds.h userspace compilation errors
    
    
    [ Upstream commit feb0869d90e51ce8b6fd8a46588465b1b5a26d09 ]
    
    Consistently use types from linux/types.h to fix the following
    linux/rds.h userspace compilation errors:
    
    /usr/include/linux/rds.h:106:2: error: unknown type name 'uint8_t'
      uint8_t name[32];
    /usr/include/linux/rds.h:107:2: error: unknown type name 'uint64_t'
      uint64_t value;
    /usr/include/linux/rds.h:117:2: error: unknown type name 'uint64_t'
      uint64_t next_tx_seq;
    /usr/include/linux/rds.h:118:2: error: unknown type name 'uint64_t'
      uint64_t next_rx_seq;
    /usr/include/linux/rds.h:121:2: error: unknown type name 'uint8_t'
      uint8_t transport[TRANSNAMSIZ];  /* null term ascii */
    /usr/include/linux/rds.h:122:2: error: unknown type name 'uint8_t'
      uint8_t flags;
    /usr/include/linux/rds.h:129:2: error: unknown type name 'uint64_t'
      uint64_t seq;
    /usr/include/linux/rds.h:130:2: error: unknown type name 'uint32_t'
      uint32_t len;
    /usr/include/linux/rds.h:135:2: error: unknown type name 'uint8_t'
      uint8_t flags;
    /usr/include/linux/rds.h:139:2: error: unknown type name 'uint32_t'
      uint32_t sndbuf;
    /usr/include/linux/rds.h:144:2: error: unknown type name 'uint32_t'
      uint32_t rcvbuf;
    /usr/include/linux/rds.h:145:2: error: unknown type name 'uint64_t'
      uint64_t inum;
    /usr/include/linux/rds.h:153:2: error: unknown type name 'uint64_t'
      uint64_t       hdr_rem;
    /usr/include/linux/rds.h:154:2: error: unknown type name 'uint64_t'
      uint64_t       data_rem;
    /usr/include/linux/rds.h:155:2: error: unknown type name 'uint32_t'
      uint32_t       last_sent_nxt;
    /usr/include/linux/rds.h:156:2: error: unknown type name 'uint32_t'
      uint32_t       last_expected_una;
    /usr/include/linux/rds.h:157:2: error: unknown type name 'uint32_t'
      uint32_t       last_seen_una;
    /usr/include/linux/rds.h:164:2: error: unknown type name 'uint8_t'
      uint8_t  src_gid[RDS_IB_GID_LEN];
    /usr/include/linux/rds.h:165:2: error: unknown type name 'uint8_t'
      uint8_t  dst_gid[RDS_IB_GID_LEN];
    /usr/include/linux/rds.h:167:2: error: unknown type name 'uint32_t'
      uint32_t max_send_wr;
    /usr/include/linux/rds.h:168:2: error: unknown type name 'uint32_t'
      uint32_t max_recv_wr;
    /usr/include/linux/rds.h:169:2: error: unknown type name 'uint32_t'
      uint32_t max_send_sge;
    /usr/include/linux/rds.h:170:2: error: unknown type name 'uint32_t'
      uint32_t rdma_mr_max;
    /usr/include/linux/rds.h:171:2: error: unknown type name 'uint32_t'
      uint32_t rdma_mr_size;
    /usr/include/linux/rds.h:212:9: error: unknown type name 'uint64_t'
     typedef uint64_t rds_rdma_cookie_t;
    /usr/include/linux/rds.h:215:2: error: unknown type name 'uint64_t'
      uint64_t addr;
    /usr/include/linux/rds.h:216:2: error: unknown type name 'uint64_t'
      uint64_t bytes;
    /usr/include/linux/rds.h:221:2: error: unknown type name 'uint64_t'
      uint64_t cookie_addr;
    /usr/include/linux/rds.h:222:2: error: unknown type name 'uint64_t'
      uint64_t flags;
    /usr/include/linux/rds.h:228:2: error: unknown type name 'uint64_t'
      uint64_t  cookie_addr;
    /usr/include/linux/rds.h:229:2: error: unknown type name 'uint64_t'
      uint64_t  flags;
    /usr/include/linux/rds.h:234:2: error: unknown type name 'uint64_t'
      uint64_t flags;
    /usr/include/linux/rds.h:240:2: error: unknown type name 'uint64_t'
      uint64_t local_vec_addr;
    /usr/include/linux/rds.h:241:2: error: unknown type name 'uint64_t'
      uint64_t nr_local;
    /usr/include/linux/rds.h:242:2: error: unknown type name 'uint64_t'
      uint64_t flags;
    /usr/include/linux/rds.h:243:2: error: unknown type name 'uint64_t'
      uint64_t user_token;
    /usr/include/linux/rds.h:248:2: error: unknown type name 'uint64_t'
      uint64_t  local_addr;
    /usr/include/linux/rds.h:249:2: error: unknown type name 'uint64_t'
      uint64_t  remote_addr;
    /usr/include/linux/rds.h:252:4: error: unknown type name 'uint64_t'
        uint64_t compare;
    /usr/include/linux/rds.h:253:4: error: unknown type name 'uint64_t'
        uint64_t swap;
    /usr/include/linux/rds.h:256:4: error: unknown type name 'uint64_t'
        uint64_t add;
    /usr/include/linux/rds.h:259:4: error: unknown type name 'uint64_t'
        uint64_t compare;
    /usr/include/linux/rds.h:260:4: error: unknown type name 'uint64_t'
        uint64_t swap;
    /usr/include/linux/rds.h:261:4: error: unknown type name 'uint64_t'
        uint64_t compare_mask;
    /usr/include/linux/rds.h:262:4: error: unknown type name 'uint64_t'
        uint64_t swap_mask;
    /usr/include/linux/rds.h:265:4: error: unknown type name 'uint64_t'
        uint64_t add;
    /usr/include/linux/rds.h:266:4: error: unknown type name 'uint64_t'
        uint64_t nocarry_mask;
    /usr/include/linux/rds.h:269:2: error: unknown type name 'uint64_t'
      uint64_t flags;
    /usr/include/linux/rds.h:270:2: error: unknown type name 'uint64_t'
      uint64_t user_token;
    /usr/include/linux/rds.h:274:2: error: unknown type name 'uint64_t'
      uint64_t user_token;
    /usr/include/linux/rds.h:275:2: error: unknown type name 'int32_t'
      int32_t  status;
    
    Signed-off-by: Dmitry V. Levin <ldv@altlinux.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3323d07612b20fa59a7dd9a46add880b04f6c37a
Author: Dmitry V. Levin <ldv@altlinux.org>
Date:   Thu Feb 16 18:05:45 2017 +0300

    uapi: fix linux/rds.h userspace compilation error
    
    
    [ Upstream commit 1786dbf3702e33ce3afd2d3dbe630bd04b1d2e58 ]
    
    On the kernel side, sockaddr_storage is #define'd to
    __kernel_sockaddr_storage.  Replacing struct sockaddr_storage with
    struct __kernel_sockaddr_storage defined by <linux/socket.h> fixes
    the following linux/rds.h userspace compilation error:
    
    /usr/include/linux/rds.h:226:26: error: field 'dest_addr' has incomplete type
      struct sockaddr_storage dest_addr;
    
    Signed-off-by: Dmitry V. Levin <ldv@altlinux.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3f0cc54226ca6e14ae855907253aa2674aea566b
Author: Sasha Levin <alexander.levin@verizon.com>
Date:   Mon Nov 13 18:03:32 2017 -0500

    Revert "uapi: fix linux/rds.h userspace compilation errors"
    
    
    This reverts commit ad50561ba7a664bc581826c9d57d137fcf17bfa5.
    
    There was a mixup with the commit message for two upstream commit
    that have the same subject line.
    
    This revert will be followed by the two commits with proper commit
    messages.
    
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d8ce2b0874a762ccc2d68aecf7700b6003e13e87
Author: Sasha Levin <alexander.levin@verizon.com>
Date:   Mon Nov 13 17:55:20 2017 -0500

    Revert "crypto: xts - Add ECB dependency"
    
    
    This reverts commit 6145171a6bc0abdc3eca7a4b795ede467d2ba569.
    
    The commit fixes a bug that was only introduced in 4.10, thus is
    irrelevant for <=4.9.
    
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d7df7af5b9b62de017b21573ca57680b9f5d9845
Author: Paul Burton <paulburton@kernel.org>
Date:   Mon Nov 7 11:30:41 2016 +0000

    MIPS: Netlogic: Exclude netlogic,xlp-pic code from XLR builds
    
    
    [ Upstream commit 9799270affc53414da96e77e454a5616b39cdab0 ]
    
    Code in arch/mips/netlogic/common/irq.c which handles the XLP PIC fails
    to build in XLR configurations due to cpu_is_xlp9xx not being defined,
    leading to the following build failure:
    
        arch/mips/netlogic/common/irq.c: In function ‘xlp_of_pic_init’:
        arch/mips/netlogic/common/irq.c:298:2: error: implicit declaration
        of function ‘cpu_is_xlp9xx’ [-Werror=implicit-function-declaration]
          if (cpu_is_xlp9xx()) {
          ^
    
    Although the code was conditional upon CONFIG_OF which is indirectly
    selected by CONFIG_NLM_XLP_BOARD but not CONFIG_NLM_XLR_BOARD, the
    failing XLR with CONFIG_OF configuration can be configured manually or
    by randconfig.
    
    Fix the build failure by making the affected XLP PIC code conditional
    upon CONFIG_CPU_XLP which is used to guard the inclusion of
    asm/netlogic/xlp-hal/xlp.h that provides the required cpu_is_xlp9xx
    function.
    
    [ralf@linux-mips.org: Fixed up as per Jayachandran's suggestion.]
    
    Signed-off-by: Paul Burton <paul.burton@imgtec.com>
    Cc: Jayachandran C <jchandra@broadcom.com>
    Cc: linux-mips@linux-mips.org
    Patchwork: https://patchwork.linux-mips.org/patch/14524/
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ade4b22d47bbd8f48f18bd2decac8efe6245b528
Author: Paul Burton <paulburton@kernel.org>
Date:   Mon Oct 17 16:01:07 2016 +0100

    MIPS: traps: Ensure L1 & L2 ECC checking match for CM3 systems
    
    
    [ Upstream commit 35e6de38858f59b6b65dcfeaf700b5d06fc2b93d ]
    
    On systems with CM3, we must ensure that the L1 & L2 ECC enables are set
    to the same value. This is presumed by the hardware & cache corruption
    can occur when it is not the case. Support enabling & disabling the L2
    ECC checking on CM3 systems where this is controlled via a GCR, and
    ensure that it matches the state of L1 ECC checking. Remove I6400 from
    the switch statement it will no longer hit, and which was incorrect
    since the L2 ECC enable bit isn't in the CP0 ErrCtl register.
    
    Signed-off-by: Paul Burton <paul.burton@imgtec.com>
    Cc: linux-mips@linux-mips.org
    Patchwork: https://patchwork.linux-mips.org/patch/14413/
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 73b6038950cdfede71a0b2137aeb44f70f7eae55
Author: Marcin Nowakowski <marcin.nowakowski@mips.com>
Date:   Wed Nov 23 14:43:44 2016 +0100

    MIPS: init: Ensure reserved memory regions are not added to bootmem
    
    
    [ Upstream commit e89ef66d7682f031f026eee6bba03c8c2248d2a9 ]
    
    Memories managed through boot_mem_map are generally expected to define
    non-crossing areas. However, if part of a larger memory block is marked
    as reserved, it would still be added to bootmem allocator as an
    available block and could end up being overwritten by the allocator.
    
    Prevent this by explicitly marking the memory as reserved it if exists
    in the range used by bootmem allocator.
    
    Signed-off-by: Marcin Nowakowski <marcin.nowakowski@imgtec.com>
    Cc: linux-mips@linux-mips.org
    Patchwork: https://patchwork.linux-mips.org/patch/14608/
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6539d1ca4fc9e8c11cf77e90828a048b3fa1213b
Author: Marcin Nowakowski <marcin.nowakowski@mips.com>
Date:   Wed Nov 23 14:43:45 2016 +0100

    MIPS: init: Ensure bootmem does not corrupt reserved memory
    
    
    [ Upstream commit d9b5b658210f28ed9f70c757d553e679d76e2986 ]
    
    Current init code initialises bootmem allocator with all of the low
    memory that it assumes is available, but does not check for reserved
    memory block, which can lead to corruption of data that may be stored
    there.
    Move bootmem's allocation map to a location that does not cross any
    reserved regions
    
    Signed-off-by: Marcin Nowakowski <marcin.nowakowski@imgtec.com>
    Cc: linux-mips@linux-mips.org
    Patchwork: https://patchwork.linux-mips.org/patch/14609/
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3b0f619cd4b9674f2e2126c5c9dbc886412f01ab
Author: Paul Burton <paulburton@kernel.org>
Date:   Mon Nov 7 11:14:09 2016 +0000

    MIPS: End asm function prologue macros with .insn
    
    
    [ Upstream commit 08889582b8aa0bbc01a1e5a0033b9f98d2e11caa ]
    
    When building a kernel targeting a microMIPS ISA, recent GNU linkers
    will fail the link if they cannot determine that the target of a branch
    or jump is microMIPS code, with errors such as the following:
    
        mips-img-linux-gnu-ld: arch/mips/built-in.o: .text+0x542c:
        Unsupported jump between ISA modes; consider recompiling with
        interlinking enabled.
        mips-img-linux-gnu-ld: final link failed: Bad value
    
    or:
    
        ./arch/mips/include/asm/uaccess.h:1017: warning: JALX to a
        non-word-aligned address
    
    Placing anything other than an instruction at the start of a function
    written in assembly appears to trigger such errors. In order to prepare
    for allowing us to follow function prologue macros with an EXPORT_SYMBOL
    invocation, end the prologue macros (LEAD, NESTED & FEXPORT) with a
    .insn directive. This ensures that the start of the function is marked
    as code, which always makes sense for functions & safely prevents us
    from hitting the link errors described above.
    
    Signed-off-by: Paul Burton <paul.burton@imgtec.com>
    Reviewed-by: Maciej W. Rozycki <macro@imgtec.com>
    Cc: linux-mips@linux-mips.org
    Patchwork: https://patchwork.linux-mips.org/patch/14508/
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b53bab72b9d8f1f07a30774c06685cd6e57e8f69
Author: Jason Hrycay <jhrycay@gmail.com>
Date:   Tue Dec 20 14:49:27 2016 -0600

    staging: greybus: add host device function pointer checks
    
    
    [ Upstream commit f05a88a39c5b5f226e08e626998bb920723b7d85 ]
    
    Add sanity checks for cport_quiesce and cport_clear before invoking the
    callbacks as these function pointers are not required during the host
    device registration. This follows the logic implemented elsewhere for
    various other function pointers.
    
    Signed-off-by: Jason Hrycay <jhrycay@gmail.com>
    Reviewed-by: Bryan O'Donoghue <pure.logic@nexus-software.ie>
    Acked-by: Johan Hovold <johan@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1f5a7caba79eb47207c94bb43c645714bf3e8ebe
Author: Mike Kofron <mpkofron@gmail.com>
Date:   Thu Dec 29 16:35:48 2016 -0500

    staging: wilc1000: Fix endian sparse warning
    
    
    [ Upstream commit 94500d5667386119c27725fe314f6882f68580a9 ]
    
    drivers/staging/wilc1000/linux_wlan.c:995:18: warning: restricted __be16 degrades to integer
    
    Signed-off-by: Mike Kofron <mpkofron@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ca24e702ccfa7e4eb5cea019ef85823b394a38d4
Author: Jannik Becher <becher.jannik@gmail.com>
Date:   Tue Dec 20 18:59:46 2016 +0100

    staging: rtl8712: fixed little endian problem
    
    
    [ Upstream commit 502c80744fcac6b16f28699469c70db499fe2f69 ]
    
    Fixed a sparse warning.
    Using function le16_to_cpus() to avoid double assignment.
    
    Signed-off-by: Jannik Becher <becher.jannik@gmail.com>
    Tested-by: Larry Finger <Larry.Finger@lwfinger.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ef417b59c222b5cbdc079184e8170b5c87fadac1
Author: Emil Tantilov <emil.s.tantilov@intel.com>
Date:   Wed Sep 28 16:01:48 2016 -0700

    ixgbe: do not disable FEC from the driver
    
    
    [ Upstream commit 1fe954b2097bb907b4578e6a74e4c1d23785a601 ]
    
    FEC is configured by the NVM and the driver should not be
    overriding it.
    
    Signed-off-by: Emil Tantilov <emil.s.tantilov@intel.com>
    Tested-by: Krishneil Singh <krishneil.k.singh@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bc656fda2442493419c9bd63810dfbb2e9c2cdbf
Author: Emil Tantilov <emil.s.tantilov@intel.com>
Date:   Fri Nov 4 14:03:03 2016 -0700

    ixgbe: add mask for 64 RSS queues
    
    
    [ Upstream commit 2bf1a87b903bd81b1448a1cef73de59fb6c4d340 ]
    
    The indirection table was reported incorrectly for X550 and newer
    where we can support up to 64 RSS queues.
    
    Reported-by Krishneil Singh <krishneil.k.singh@intel.com>
    Signed-off-by: Emil Tantilov <emil.s.tantilov@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7316fb33f0a5df4d4bbfa53c487c5454069cb783
Author: Tony Nguyen <anthony.l.nguyen@intel.com>
Date:   Thu Nov 10 09:57:29 2016 -0800

    ixgbe: Reduce I2C retry count on X550 devices
    
    
    [ Upstream commit 3f0d646b720d541309b11e190db58086f446f41e ]
    
    A retry count of 10 is likely to run into problems on X550 devices that
    have to detect and reset unresponsive CS4227 devices. So, reduce the I2C
    retry count to 3 for X550 and above. This should avoid any possible
    regressions in existing devices.
    
    Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e15dad31b10b156f9d8c23b160f586d0e0f347d2
Author: Tony Nguyen <anthony.l.nguyen@intel.com>
Date:   Thu Nov 10 16:00:33 2016 -0800

    ixgbe: Fix reporting of 100Mb capability
    
    
    [ Upstream commit f215266470dfe86196a31fe0725a86cea77f9a18 ]
    
    BaseT adapters that are capable of supporting 100Mb are not reporting this
    capability.  This patch corrects the reporting so that 100Mb is shown as
    supported on those adapters.
    
    Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 3bed7d680acf89f231c1724ebac588c8637c2b60
Author: Emil Tantilov <emil.s.tantilov@intel.com>
Date:   Fri Nov 11 10:07:47 2016 -0800

    ixgbe: handle close/suspend race with netif_device_detach/present
    
    
    [ Upstream commit f7f37e7ff2b9b7eff7fbd035569cab35896869a3 ]
    
    When an interface is part of a namespace it is possible that
    ixgbe_close() may be called while __ixgbe_shutdown() is running
    which ends up in a double free WARN and/or a BUG in free_msi_irqs().
    
    To handle this situation we extend the rtnl_lock() to protect the
    call to netif_device_detach() and ixgbe_clear_interrupt_scheme()
    in __ixgbe_shutdown() and check for netif_device_present()
    to avoid clearing the interrupts second time in ixgbe_close();
    
    Also extend the rtnl lock in ixgbe_resume() to netif_device_attach().
    
    Signed-off-by: Emil Tantilov <emil.s.tantilov@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6a4ef8b6ceeb45dd089b3f7e2771bdcc0d822919
Author: Emil Tantilov <emil.s.tantilov@intel.com>
Date:   Wed Nov 16 09:48:02 2016 -0800

    ixgbe: fix AER error handling
    
    
    [ Upstream commit 126db13fa0e6d05c9f94e0125f61e773bd5ab079 ]
    
    Make sure that we free the IRQs in ixgbe_io_error_detected() when
    responding to an PCIe AER error and also restore them when the
    interface recovers from it.
    
    Previously it was possible to trigger BUG_ON() check in free_msix_irqs()
    in the case where we call ixgbe_remove() after a failed recovery from
    AER error because the interrupts were not freed.
    
    Signed-off-by: Emil Tantilov <emil.s.tantilov@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6c7999904f32630027f80c40ceaff38ca0c60ae0
Author: Don Skidmore <donald.c.skidmore@intel.com>
Date:   Tue Dec 13 20:34:51 2016 -0500

    ixgbe: Configure advertised speeds correctly for KR/KX backplane
    
    
    [ Upstream commit 54f6d4c42451dbd2cc7e0f0bd8fc3eddcab511fe ]
    
    This patch ensures that the advertised link speeds are configured
    for X553 KR/KX backplane.  Without this patch the link remains at
    1G when resuming from low power after being downshifted by LPLU.
    
    Signed-off-by: Don Skidmore <donald.c.skidmore@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5d820f84e169fa3e83e1f28a0cc4ca5a1770a9c4
Author: Jon Mason <jon.mason@broadcom.com>
Date:   Mon Dec 5 18:12:21 2016 -0500

    arm64: dts: NS2: reserve memory for Nitro firmware
    
    
    [ Upstream commit 0cc878d678444392ca2a31350f89f489593ef5bb ]
    
    Nitro firmware is loaded into memory by the bootloader at a specific
    location.  Set this memory range aside to prevent the kernel from using
    it.
    
    Signed-off-by: Jon Mason <jon.mason@broadcom.com>
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f6e94c2c16feee9954379744e7a6c3b45c264223
Author: Kailang Yang <kailang@realtek.com>
Date:   Wed Jan 4 14:49:07 2017 +0800

    ALSA: hda/realtek - Add new codec ID ALC299
    
    
    [ Upstream commit 28f1f9b26cee161ddd3985b3eb78e3ffada08dda ]
    
    ALC299 was similar as ALC225.
    Add headset support for ALC299.
    ALC3271 was for Dell rename.
    
    Signed-off-by: Kailang Yang <kailang@realtek.com>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0e2245ab6901c5ca2757e5cb9bd5242a092ca3b0
Author: Arvind Yadav <arvind.yadav.cs@gmail.com>
Date:   Tue Jan 3 17:00:27 2017 +0530

    gpu: drm: mgag200: mgag200_main:- Handle error from pci_iomap
    
    
    [ Upstream commit 4b0ea93f250afc6c1128e201b0a8a115ae613e47 ]
    
    Here, pci_iomap can fail, handle this case and return -ENOMEM.
    
    Signed-off-by: Arvind Yadav <arvind.yadav.cs@gmail.com>
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Link: http://patchwork.freedesktop.org/patch/msgid/1483443027-13444-1-git-send-email-arvind.yadav.cs@gmail.com
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 473286bdd58d820118ebef8a2c0733cef33ec432
Author: Alexey Khoroshilov <khoroshilov@ispras.ru>
Date:   Sat Jul 9 01:19:51 2016 +0300

    backlight: adp5520: Fix error handling in adp5520_bl_probe()
    
    
    [ Upstream commit 0eb3fba8c68275f0122f65f7316efaaf86448016 ]
    
    If adp5520_bl_setup() fails, sysfs group left unremoved.
    
    By the way, fix overcomplicated assignement of error code.
    
    Found by Linux Driver Verification project (linuxtesting.org).
    
    Signed-off-by: Alexey Khoroshilov <khoroshilov@ispras.ru>
    Acked-by: Michael Hennerich <michael.hennerich@analog.com>
    Signed-off-by: Lee Jones <lee.jones@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6aaf9ba9bde78e784bca8aaa81e1eb7b1006b98b
Author: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Date:   Wed Jul 6 19:33:05 2016 +0200

    backlight: lcd: Fix race condition during register
    
    
    [ Upstream commit cc21942bce652d1a92dae85b785378256e1df1f7 ]
    
    Once device_register is called for a device its attributes might be
    accessed. As the callbacks of a lcd device's attributes make use of the
    lcd_ops, the respective member must be setup before calling
    device_register.
    
    Signed-off-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
    Signed-off-by: Lee Jones <lee.jones@linaro.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit acc365c028597c2811480762a2cd30cdd6d0c8ac
Author: Jarkko Nikula <jarkko.nikula@bitmer.com>
Date:   Tue Dec 27 22:12:16 2016 +0200

    drm/omap: panel-sony-acx565akm.c: Add MODULE_ALIAS
    
    
    [ Upstream commit 42f7f3c4811b3149253ecf2e133832c969884466 ]
    
    Add module alias for Sony ACX565AKM LCD panel. This makes it probe on Nokia
    N900 when panel driver is built as a module.
    
    Signed-off-by: Jarkko Nikula <jarkko.nikula@bitmer.com>
    Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 5d1d893d31cec53c438407f48b314faaf405c558
Author: Takashi Iwai <tiwai@suse.de>
Date:   Wed Jan 4 12:19:15 2017 +0100

    ALSA: vx: Fix possible transfer overflow
    
    
    [ Upstream commit 874e1f6fad9a5184b67f4cee37c1335cd2cc5677 ]
    
    The pseudo DMA transfer codes in VX222 and VX-pocket driver have a
    slight bug where they check the buffer boundary wrongly, and may
    overflow.  Also, the zero sample count might be handled badly for the
    playback (although it shouldn't happen in theory).  This patch
    addresses these issues.
    
    Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=141541
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0f4ea85748bfcd3c64910bae4ff18f94849ae3f8
Author: Takashi Iwai <tiwai@suse.de>
Date:   Wed Jan 4 12:34:14 2017 +0100

    ALSA: vx: Don't try to update capture stream before running
    
    
    [ Upstream commit ed3c177d960bb5881b945ca6f784868126bb90db ]
    
    The update of stream costs significantly, and we should avoid it
    unless the stream really has started.  Check pipe->running flag
    instead of pipe->prepared.
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 9dc7637700e5157df88ab7f536f40c85c23b9160
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Wed Dec 14 17:38:52 2016 +0100

    power: supply: axp288_fuel_gauge: Read 12 bit values 2 registers at a time
    
    
    [ Upstream commit 248efcf00602f0282587999bcc221a872bd72530 ]
    
    In order for the MSB -> LSB latching to work correctly we must read the
    2 8 bit registers of a 12 bit value in one consecutive read.
    
    This fixes voltage_ocv reporting inconsistent values on my tablet.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0010542d3f79ed2c2e3be382f89201c77bcd3bc2
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Wed Dec 14 17:38:51 2016 +0100

    power: supply: axp288_fuel_gauge: Read 15 bit values 2 registers at a time
    
    
    [ Upstream commit 4949fc5e071f8e8d8122e0b16cf6a2ec1ca36258 ]
    
    In order for the MSB -> LSB latching to work correctly we must read the
    2 8 bit registers of a 15 bit value in one consecutive read.
    
    This fixes charge_full reporting 3498768 on some reads and 3354624 one
    other reads on my tablet (for the 3354624 value the raw LSB is 0x00).
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d9a5790b214527e2a73b602f1ded4f509e3fe04b
Author: Fabien Lahoudere <fabien.lahoudere@collabora.co.uk>
Date:   Tue Dec 20 09:42:44 2016 +0100

    rtc: rx8010: change lock mechanism
    
    
    [ Upstream commit 666b5d1e9f8762300a410f9548b6e370d71dd382 ]
    
    Remove spinlock and use the "rtc->ops_lock" from RTC subsystem instead.
    spin_lock_irqsave() is not needed here because we do not have hard IRQs.
    
    This patch fixes the following issue:
    
    root@GE004097290448 b850v3:~# hwclock --systohc
    root@GE004097290448 b850v3:~# hwclock --systohc
    root@GE004097290448 b850v3:~# hwclock --systohc
    root@GE004097290448 b850v3:~# hwclock --systohc
    root@GE004097290448 b850v3:~# hwclock --systohc
    [   82.108175] BUG: spinlock wrong CPU on CPU#0, hwclock/855
    [   82.113660]  lock: 0xedb4899c, .magic: dead4ead, .owner: hwclock/855, .owner_cpu: 1
    [   82.121329] CPU: 0 PID: 855 Comm: hwclock Not tainted 4.8.0-00042-g09d5410-dirty #20
    [   82.129078] Hardware name: Freescale i.MX6 Quad/DualLite (Device Tree)
    [   82.135609] Backtrace:
    [   82.138090] [<8010d378>] (dump_backtrace) from [<8010d5c0>] (show_stack+0x20/0x24)
    [   82.145664]  r7:ec936000 r6:600a0013 r5:00000000 r4:81031680
    [   82.151402] [<8010d5a0>] (show_stack) from [<80401518>] (dump_stack+0xb4/0xe8)
    [   82.158636] [<80401464>] (dump_stack) from [<8017b8b0>] (spin_dump+0x84/0xcc)
    [   82.165775]  r10:00000000 r9:ec936000 r8:81056090 r7:600a0013 r6:edb4899c r5:edb4899c
    [   82.173691]  r4:e5033e00 r3:00000000
    [   82.177308] [<8017b82c>] (spin_dump) from [<8017bcb0>] (do_raw_spin_unlock+0x108/0x130)
    [   82.185314]  r5:edb4899c r4:edb4899c
    [   82.188938] [<8017bba8>] (do_raw_spin_unlock) from [<8094b93c>] (_raw_spin_unlock_irqrestore+0x34/0x54)
    [   82.198333]  r5:edb4899c r4:600a0013
    [   82.201953] [<8094b908>] (_raw_spin_unlock_irqrestore) from [<8065b090>] (rx8010_set_time+0x14c/0x188)
    [   82.211261]  r5:00000020 r4:edb48990
    [   82.214882] [<8065af44>] (rx8010_set_time) from [<80653fe4>] (rtc_set_time+0x70/0x104)
    [   82.222801]  r7:00000051 r6:edb39da0 r5:edb39c00 r4:ec937e8c
    [   82.228535] [<80653f74>] (rtc_set_time) from [<80655774>] (rtc_dev_ioctl+0x3c4/0x674)
    [   82.236368]  r7:00000051 r6:7ecf1b74 r5:00000000 r4:edb39c00
    [   82.242106] [<806553b0>] (rtc_dev_ioctl) from [<80284034>] (do_vfs_ioctl+0xa4/0xa6c)
    [   82.249851]  r8:00000003 r7:80284a40 r6:ed1e9c80 r5:edb44e60 r4:7ecf1b74
    [   82.256642] [<80283f90>] (do_vfs_ioctl) from [<80284a40>] (SyS_ioctl+0x44/0x6c)
    [   82.263953]  r10:00000000 r9:ec936000 r8:7ecf1b74 r7:4024700a r6:ed1e9c80 r5:00000003
    [   82.271869]  r4:ed1e9c80
    [   82.274432] [<802849fc>] (SyS_ioctl) from [<80108520>] (ret_fast_syscall+0x0/0x1c)
    [   82.282005]  r9:ec936000 r8:801086c4 r7:00000036 r6:00000000 r5:00000003 r4:0008e1bc
    root@GE004097290448 b850v3:~#
    Message from syslogd@GE004097290448 at Dec  3 11:17:08 ...
     kernel:[   82.108175] BUG: spinlock wrong CPU on CPU#0, hwclock/855
    
    Message from syslogd@GE004097290448 at Dec  3 11:17:08 ...
     kernel:[   82.113660]  lock: 0xedb4899c, .magic: dead4ead, .owner: hwclock/855, .owner_cpu: 1
    hwclock --systohc
    root@GE004097290448 b850v3:~#
    
    Signed-off-by: Fabien Lahoudere <fabien.lahoudere@collabora.co.uk>
    Signed-off-by: Alexandre Belloni <alexandre.belloni@free-electrons.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cb341679a5b4301008bbcfe49f9a35c328fb1856
Author: James Smart <james.smart@broadcom.com>
Date:   Mon Dec 19 15:07:20 2016 -0800

    scsi: lpfc: Clear the VendorVersion in the PLOGI/PLOGI ACC payload
    
    
    [ Upstream commit e0165f20447c8ca1d367725ee94d8ec9f38ca275 ]
    
    Clear the VendorVersion in the PLOGI/PLOGI ACC payload
    
    Vendor version info may have been set on fabric login. Before sending
    PLOGI payloads, ensure that it's cleared.
    
    Signed-off-by: Dick Kennedy <dick.kennedy@broadcom.com>
    Signed-off-by: James Smart <james.smart@broadcom.com>
    Reviewed-by: Hannes Reinecke <hare@suse.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 235d82cb46d240fcb237ad1ab5c31a55930df97a
Author: James Smart <james.smart@broadcom.com>
Date:   Mon Dec 19 15:07:23 2016 -0800

    scsi: lpfc: Correct issue leading to oops during link reset
    
    
    [ Upstream commit e6c6acc0e0223ddaf867628d420ee196349c6fae ]
    
    Correct issue leading to oops during link reset. Missing vport pointer.
    
    [mkp: fixed typo]
    
    Signed-off-by: Dick Kennedy <dick.kennedy@broadcom.com>
    Signed-off-by: James Smart <james.smart@broadcom.com>
    Reviewed-by: Hannes Reinecke <hare@suse.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f89885d40a5f8d8294c17661be2b7359449c9752
Author: James Smart <james.smart@broadcom.com>
Date:   Mon Dec 19 15:07:24 2016 -0800

    scsi: lpfc: Correct host name in symbolic_name field
    
    
    [ Upstream commit 6c9231f604c2575be24c96d38deb70f145172f92 ]
    
    Correct host name in symbolic_name field of nameserver registrations
    
    Signed-off-by: Dick Kennedy <dick.kennedy@broadcom.com>
    Signed-off-by: James Smart <james.smart@broadcom.com>
    Reviewed-by: Hannes Reinecke <hare@suse.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b4e42f5d01160eacaa95047bdc087e0f403fa292
Author: James Smart <james.smart@broadcom.com>
Date:   Mon Dec 19 15:07:25 2016 -0800

    scsi: lpfc: FCoE VPort enable-disable does not bring up the VPort
    
    
    [ Upstream commit 104450eb08ca662e6b1d02da11aca9598e978f3e ]
    
    FCoE VPort enable-disable does not bring up the VPort.
    VPI structure needed to be initialized before being re-registered.
    
    Signed-off-by: Dick Kennedy <dick.kennedy@broadcom.com>
    Signed-off-by: James Smart <james.smart@broadcom.com>
    Reviewed-by: Hannes Reinecke <hare@suse.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 01347f537f6c5ca08969fba8c2a67e8d335b6e9e
Author: James Smart <james.smart@broadcom.com>
Date:   Mon Dec 19 15:07:30 2016 -0800

    scsi: lpfc: Add missing memory barrier
    
    
    [ Upstream commit 6b3b3bdb83b4ad51252d21bb13596db879e51850 ]
    
    On loosely ordered memory systems (PPC for example), the WQE elements
    were being updated in memory, but not necessarily flushed before the
    separate doorbell was written to hw which would cause hw to dma the
    WQE element. Thus, the hardware occasionally received partially
    updated WQE data.
    
    Add the memory barrier after updating the WQE memory.
    
    Signed-off-by: Dick Kennedy <dick.kennedy@broadcom.com>
    Signed-off-by: James Smart <james.smart@broadcom.com>
    Reviewed-by: Hannes Reinecke <hare@suse.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d9b035e70426196130502ea0818ea30b5a36ae3b
Author: Daniel Bristot de Oliveira <bristot@redhat.com>
Date:   Wed Jan 4 12:20:33 2017 +0100

    x86/irq, trace: Add __irq_entry annotation to x86's platform IRQ handlers
    
    
    [ Upstream commit c4158ff536439619fa342810cc575ae2c809f03f ]
    
    This patch adds the __irq_entry annotation to the default x86
    platform IRQ handlers. ftrace's function_graph tracer uses the
    __irq_entry annotation to notify the entry and return of IRQ
    handlers.
    
    For example, before the patch:
      354549.667252 |   3)  d..1              |  default_idle_call() {
      354549.667252 |   3)  d..1              |    arch_cpu_idle() {
      354549.667253 |   3)  d..1              |      default_idle() {
      354549.696886 |   3)  d..1              |        smp_trace_reschedule_interrupt() {
      354549.696886 |   3)  d..1              |          irq_enter() {
      354549.696886 |   3)  d..1              |            rcu_irq_enter() {
    
    After the patch:
      366416.254476 |   3)  d..1              |    arch_cpu_idle() {
      366416.254476 |   3)  d..1              |      default_idle() {
      366416.261566 |   3)  d..1  ==========> |
      366416.261566 |   3)  d..1              |        smp_trace_reschedule_interrupt() {
      366416.261566 |   3)  d..1              |          irq_enter() {
      366416.261566 |   3)  d..1              |            rcu_irq_enter() {
    
    KASAN also uses this annotation. The smp_apic_timer_interrupt()
    was already annotated.
    
    Signed-off-by: Daniel Bristot de Oliveira <bristot@redhat.com>
    Acked-by: Steven Rostedt (VMware) <rostedt@goodmis.org>
    Cc: Aaron Lu <aaron.lu@intel.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Baoquan He <bhe@redhat.com>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Claudio Fontana <claudio.fontana@huawei.com>
    Cc: Denys Vlasenko <dvlasenk@redhat.com>
    Cc: Dou Liyang <douly.fnst@cn.fujitsu.com>
    Cc: Gu Zheng <guz.fnst@cn.fujitsu.com>
    Cc: Hidehiro Kawai <hidehiro.kawai.ez@hitachi.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Nicolai Stange <nicstange@gmail.com>
    Cc: Peter Zijlstra (Intel) <peterz@infradead.org>
    Cc: Steven Rostedt <rostedt@goodmis.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: Tony Luck <tony.luck@intel.com>
    Cc: Wanpeng Li <wanpeng.li@hotmail.com>
    Cc: linux-edac@vger.kernel.org
    Link: http://lkml.kernel.org/r/059fdf437c2f0c09b13c18c8fe4e69999d3ffe69.1483528431.git.bristot@redhat.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f7d1861153d4199b5f032db4d424fe9abd0cb295
Author: Galo Navarro <anglorvaroa@gmail.com>
Date:   Tue Jan 3 23:12:09 2017 +0100

    staging: rtl8188eu: fix incorrect ERROR tags from logs
    
    
    [ Upstream commit 401579c22ccbcb54244494069973e64b1fe980d2 ]
    
    Several lifecycle events in the rtl8188eu driver are logged using the
    DBG_88E_LEVEL macro from rtw_debug.h, which is tagged as ERROR
    regardless of the actual level.  Below are dmesg excerpts after loading
    and unloading the module, the messages are misleading as there was no
    error.
    
        [517434.916239] usbcore: registered new interface driver r8188eu
        [517435.680653] R8188EU: ERROR indicate disassoc
        [517437.122606] R8188EU: ERROR assoc success
        [517797.735611] usbcore: deregistering interface driver r8188eu
        [517797.736069] R8188EU: ERROR indicate disassoc
    
    Remove the ERROR prefix from the logs.  After the patch, logs are:
    
        [517949.873976] usbcore: registered new interface driver r8188eu
        [517950.592845] R8188EU: indicate disassoc
        [517951.993973] R8188EU: assoc success
        [521778.784448] usbcore: deregistering interface driver r8188eu
        [521778.784838] R8188EU: indicate disassoc
    
    Signed-off-by: Galo Navarro <anglorvaroa@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit fe975496da30e238ebb0292ebe7c35f67f4a8e33
Author: Soheil Hassas Yeganeh <soheil@google.com>
Date:   Wed Jan 4 11:19:34 2017 -0500

    tcp: provide timestamps for partial writes
    
    
    [ Upstream commit ad02c4f547826167a709dab8a89a1caefd2c1f50 ]
    
    For TCP sockets, TX timestamps are only captured when the user data
    is successfully and fully written to the socket. In many cases,
    however, TCP writes can be partial for which no timestamp is
    collected.
    
    Collect timestamps whenever any user data is (fully or partially)
    copied into the socket. Pass tcp_write_queue_tail to tcp_tx_timestamp
    instead of the local skb pointer since it can be set to NULL on
    the error path.
    
    Note that tcp_write_queue_tail can be NULL, even if bytes have been
    copied to the socket. This is because acknowledgements are being
    processed in tcp_sendmsg(), and by the time tcp_tx_timestamp is
    called tcp_write_queue_tail can be NULL. For such cases, this patch
    does not collect any timestamps (i.e., it is best-effort).
    
    This patch is written with suggestions from Willem de Bruijn and
    Eric Dumazet.
    
    Change-log V1 -> V2:
            - Use sockc.tsflags instead of sk->sk_tsflags.
            - Use the same code path for normal writes and errors.
    
    Signed-off-by: Soheil Hassas Yeganeh <soheil@google.com>
    Acked-by: Yuchung Cheng <ycheng@google.com>
    Cc: Willem de Bruijn <willemb@google.com>
    Cc: Eric Dumazet <edumazet@google.com>
    Cc: Neal Cardwell <ncardwell@google.com>
    Cc: Martin KaFai Lau <kafai@fb.com>
    Acked-by: Willem de Bruijn <willemb@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cfb09f0571a5fa16ae00f8291f6128d4cf5bf37a
Author: Subhash Jadavani <subhashj@codeaurora.org>
Date:   Thu Dec 22 18:41:22 2016 -0800

    scsi: ufs: add capability to keep auto bkops always enabled
    
    
    [ Upstream commit 4e768e7645ec4ffa92ee163643777b261ae97142 ]
    
    UFS device requires to perform bkops (back ground operations) periodically
    but host can control (via auto-bkops parameter of device) when device can
    perform bkops based on its performance requirements. In general, host
    would like to enable the device's auto-bkops only when it's not doing any
    regular data transfer but sometimes device may not behave properly if host
    keeps the auto-bkops disabled. This change adds the capability to let the
    device auto-bkops always enabled except suspend.
    
    Reviewed-by: Sahitya Tummala <stummala@codeaurora.org>
    Signed-off-by: Subhash Jadavani <subhashj@codeaurora.org>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ea56533994fea513aac714b50a580cdcaccb0ef9
Author: Javier Martinez Canillas <javier@osg.samsung.com>
Date:   Mon Jan 2 11:04:58 2017 -0300

    scsi: ufs-qcom: Fix module autoload
    
    
    [ Upstream commit ab3dabb3e8cf077850f20610f73a0def1fed10cb ]
    
    If the driver is built as a module, autoload won't work because the module
    alias information is not filled. So user-space can't match the registered
    device with the corresponding module.
    
    Export the module alias information using the MODULE_DEVICE_TABLE() macro.
    
    Before this patch:
    
    $ modinfo drivers/scsi/ufs/ufs-qcom.ko | grep alias
    $
    
    After this patch:
    
    $ modinfo drivers/scsi/ufs/ufs-qcom.ko | grep alias
    alias:          of:N*T*Cqcom,ufshcC*
    alias:          of:N*T*Cqcom,ufshc
    
    Signed-off-by: Javier Martinez Canillas <javier@osg.samsung.com>
    Reviewed-by: Subhash Jadavani <subhashj@codeaurora.org>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 0ef1e72e73fe3ac6bf4b63f6aef24eba5ef648bd
Author: Hannu Lounento <hannu.lounento@ge.com>
Date:   Mon Jan 2 18:26:06 2017 +0100

    igb: Fix hw_dbg logging in igb_update_flash_i210
    
    
    [ Upstream commit 76ed5a8f47476e4984cc8c0c1bc4cee62650f7fd ]
    
    Fix an if statement with hw_dbg lines where the logic was inverted with
    regards to the corresponding return value used in the if statement.
    
    Signed-off-by: Hannu Lounento <hannu.lounento@ge.com>
    Signed-off-by: Peter Senna Tschudin <peter.senna@collabora.com>
    Tested-by: Aaron Brown <aaron.f.brown@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 64da1e5ea30dab48355f24c4a2a4bfdc697297cf
Author: Todd Fujinaka <todd.fujinaka@intel.com>
Date:   Tue Nov 15 08:54:26 2016 -0800

    igb: close/suspend race in netif_device_detach
    
    
    [ Upstream commit 9474933caf21a4cb5147223dca1551f527aaac36 ]
    
    Similar to ixgbe, when an interface is part of a namespace it is
    possible that igb_close() may be called while __igb_shutdown() is
    running which ends up in a double free WARN and/or a BUG in
    free_msi_irqs().
    
    Extend the rtnl_lock() to protect the call to netif_device_detach() and
    igb_clear_interrupt_scheme() in __igb_shutdown() and check for
    netif_device_present() to avoid calling igb_clear_interrupt_scheme() a
    second time in igb_close().
    
    Also extend the rtnl lock in igb_resume() to netif_device_attach().
    
    Signed-off-by: Todd Fujinaka <todd.fujinaka@intel.com>
    Acked-by: Alexander Duyck <alexander.h.duyck@intel.com>
    Tested-by: Aaron Brown <aaron.f.brown@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2aed3814969b4568d2f3f5a00e0c264bd63a5c61
Author: Aaron Sierra <asierra@xes-inc.com>
Date:   Tue Nov 29 10:03:56 2016 -0600

    igb: reset the PHY before reading the PHY ID
    
    
    [ Upstream commit 182785335447957409282ca745aa5bc3968facee ]
    
    Several people have reported firmware leaving the I210/I211 PHY's page
    select register set to something other than the default of zero. This
    causes the first accesses, PHY_IDx register reads, to access something
    else, resulting in device probe failure:
    
        igb: Intel(R) Gigabit Ethernet Network Driver - version 5.4.0-k
        igb: Copyright (c) 2007-2014 Intel Corporation.
        igb: probe of 0000:01:00.0 failed with error -2
    
    This problem began for them after a previous patch I submitted was
    applied:
    
        commit 2a3cdead8b408351fa1e3079b220fa331480ffbc
        Author: Aaron Sierra <asierra@xes-inc.com>
        Date:   Tue Nov 3 12:37:09 2015 -0600
    
            igb: Remove GS40G specific defines/functions
    
    I personally experienced this problem after attempting to PXE boot from
    I210 devices using this firmware:
    
        Intel(R) Boot Agent GE v1.5.78
        Copyright (C) 1997-2014, Intel Corporation
    
    Resetting the PHY before reading from it, ensures the page select
    register is in its default state and doesn't make assumptions about
    the PHY's register set before the PHY has been probed.
    
    Cc: Matwey V. Kornilov <matwey@sai.msu.ru>
    Cc: Chris Arges <carges@vectranetworks.com>
    Cc: Jochen Henneberg <jh@henneberg-systemdesign.com>
    Signed-off-by: Aaron Sierra <asierra@xes-inc.com>
    Tested-by: Matwey V. Kornilov <matwey@sai.msu.ru>
    Tested-by: Chris J Arges <christopherarges@gmail.com>
    Tested-by: Aaron Brown <aaron.f.brown@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 38fa955da2516bb8bf5f0a75041856016e524d7c
Author: Arvind Yadav <arvind.yadav.cs@gmail.com>
Date:   Wed Dec 21 11:00:12 2016 +0530

    drm/sti: sti_vtg: Handle return NULL error from devm_ioremap_nocache
    
    
    [ Upstream commit 1ae0d5af347df224a6e76334683f13a96d915a44 ]
    
    Here, If devm_ioremap_nocache will fail. It will return NULL.
    Kernel can run into a NULL-pointer dereference. This error check
    will avoid NULL pointer dereference.
    
    Signed-off-by: Arvind Yadav <arvind.yadav.cs@gmail.com>
    Acked-by: Vincent Abriou <vincent.abriou@st.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 02c7292bb7eeb03f08358ceb0fe5061846a4ec33
Author: Geert Uytterhoeven <geert@linux-m68k.org>
Date:   Tue Jan 3 19:09:44 2017 +0100

    ata: SATA_MV should depend on HAS_DMA
    
    
    [ Upstream commit 62989cebd367a1aae1e009e1a5b1ec046a4c8fdc ]
    
    If NO_DMA=y:
    
        ERROR: "dma_pool_alloc" [drivers/ata/sata_mv.ko] undefined!
        ERROR: "dmam_pool_create" [drivers/ata/sata_mv.ko] undefined!
        ERROR: "dma_pool_free" [drivers/ata/sata_mv.ko] undefined!
    
    Add a dependency on HAS_DMA to fix this.
    
    Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Tejun Heo <tj@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit cece64a6107c4b311c63ac0b450577ddb0057459
Author: Geert Uytterhoeven <geert@linux-m68k.org>
Date:   Tue Jan 3 19:09:45 2017 +0100

    ata: SATA_HIGHBANK should depend on HAS_DMA
    
    
    [ Upstream commit 2a736e0585e585c2566b5119af8381910a170e44 ]
    
    If NO_DMA=y:
    
        ERROR: "bad_dma_ops" [drivers/ata/sata_highbank.ko] undefined!
    
    Add a dependency on HAS_DMA to fix this.
    
    Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Tejun Heo <tj@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 1122c15f0a96c9d7bc631e92c0b47a20be480f7e
Author: Geert Uytterhoeven <geert@linux-m68k.org>
Date:   Tue Jan 3 19:09:46 2017 +0100

    ata: ATA_BMDMA should depend on HAS_DMA
    
    
    [ Upstream commit 7bc7ab1e63dfe004931502f90ce7020e375623da ]
    
    If NO_DMA=y:
    
        ERROR: "dmam_alloc_coherent" [drivers/ata/libata.ko] undefined!
    
    Add a dependency on HAS_DMA to fix this.
    
    Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Tejun Heo <tj@kernel.org>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 15a65b946c611fd1d57e9965964158b57b7a3209
Author: Tony Lindgren <tony@atomide.com>
Date:   Thu Jan 5 08:37:02 2017 -0800

    ARM: dts: omap5-uevm: Allow bootloader to configure USB Ethernet MAC
    
    
    [ Upstream commit e13a22a406f20322651b8c0847f4210bdef246d1 ]
    
    Note that with 9730 the wiring is different compared to 9514 found on
    beagleboard xm for example.
    
    On beagleboard xm we have:
    
    /sys/bus/usb/devices/1-2        hub
    /sys/bus/usb/devices/1-2.1      9514
    
    While on omap5-uevm we have:
    
    /sys/bus/usb/devices/1-2        hub
    /sys/bus/usb/devices/1-3        9730
    
    Cc: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c26fa1306c80f37dcd0f64423067598b3a7da0e7
Author: Tony Lindgren <tony@atomide.com>
Date:   Thu Jan 5 11:07:18 2017 -0800

    ARM: dts: Fix omap3 off mode pull defines
    
    
    [ Upstream commit d97556c8012015901a3ce77f46960078139cd79d ]
    
    We need to also have OFFPULLUDENABLE bit set to use the off mode pull values.
    Otherwise the line is pulled down internally if no external pull exists.
    
    This is has some documentation at:
    
    http://processors.wiki.ti.com/index.php/Optimizing_OMAP35x_and_AM/DM37x_OFF_mode_PAD_configuration
    
    Note that the value is still glitchy during off mode transitions as documented
    in spz319f.pdf "Advisory 1.45". It's best to use external pulls instead of
    relying on the internal ones for off mode and even then anything pulled up
    will get driven down momentarily on off mode restore for GPIO banks other
    than bank1.
    
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e96a11f64b8181bd0f947864f1387e1b38256d03
Author: Tony Lindgren <tony@atomide.com>
Date:   Thu Jan 5 11:08:20 2017 -0800

    ARM: OMAP2+: Fix init for multiple quirks for the same SoC
    
    
    [ Upstream commit 6e613ebf4405fc09e2a8c16ed193b47f80a3cbed ]
    
    It's possible that there are multiple quirks that need to be initialized
    for the same SoC. Fix the issue by not returning on the first match.
    
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit db458f6e6110a3d568bfdf1ff350e0fe55a84170
Author: Tony Lindgren <tony@atomide.com>
Date:   Thu Jan 5 11:10:40 2017 -0800

    ARM: dts: Fix am335x and dm814x scm syscon to probe children
    
    
    [ Upstream commit 1aa09df0854efe16b7a80358a18f0a0bebafd246 ]
    
    Without these changes children of the scn syscon
    won't probe.
    
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit f022fa1b61e5b769dd9409e92fa3ef34ae5914ad
Author: Tony Lindgren <tony@atomide.com>
Date:   Thu Jan 5 11:17:30 2017 -0800

    ARM: dts: Fix compatible for ti81xx uarts for 8250
    
    
    [ Upstream commit f62280efe8934a1275fd148ef302d1afec8cd3df ]
    
    When using 8250_omap driver, we need to specify the right
    compatible value for the UART to work on dm814x and dm816x.
    
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e17a5a8fc0bdda6ce9e18d3bf339d4dd69ad5e37
Author: Ngai-Mint Kwan <ngai-mint.kwan@intel.com>
Date:   Wed Nov 2 16:44:46 2016 -0700

    fm10k: request reset when mbx->state changes
    
    
    [ Upstream commit 2f3fc1e6200309ccf87f61dea56e57e563c4f800 ]
    
    Multiple IES API resets can cause a race condition where the mailbox
    interrupt request bits can be cleared before being handled. This can
    leave certain mailbox messages from the PF to be untreated and the PF
    will enter in some inactive state. If this situation occurs, the IES API
    will initiate a mailbox version reset which, then, trigger a mailbox
    state change. Once this mailbox transition occurs (from OPEN to CONNECT
    state), a request for reset will be returned.
    
    This ensures that PF will undergo a reset whenever IES API encounters an
    unknown global mailbox interrupt event or whenever the IES API
    terminates.
    
    Signed-off-by: Ngai-Mint Kwan <ngai-mint.kwan@intel.com>
    Signed-off-by: Jacob Keller <jacob.e.keller@intel.com>
    Tested-by: Krishneil Singh <krishneil.k.singh@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6202042b7428cc1b539c04dacba232d6c48d9981
Author: Roger Quadros <rogerq@ti.com>
Date:   Thu Dec 8 10:45:31 2016 +0200

    extcon: palmas: Check the parent instance to prevent the NULL
    
    
    [ Upstream commit 9fe172b9be532acc23e35ba693700383ab775e66 ]
    
    extcon-palmas must be child of palmas and expects parent's
    drvdata to be valid. Check for non NULL parent drvdata and
    fail if it is NULL. Not doing so will result in a NULL
    pointer dereference later in the probe() parent drvdata
    is NULL (e.g. misplaced extcon-palmas node in device tree).
    
    Signed-off-by: Roger Quadros <rogerq@ti.com>
    Signed-off-by: Chanwoo Choi <cw00.choi@samsung.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit c4a77534ce2bbc5cb0b6d8b16a10dbe9157c58e1
Author: Chanwoo Choi <cw00.choi@samsung.com>
Date:   Mon Dec 19 21:02:33 2016 +0900

    extcon: Remove potential problem when calling extcon_register_notifier()
    
    
    [ Upstream commit 01b4c9a1ae07a25d208cad0da7dd288007a22984 ]
    
    This patch removes the potential problem of extcon_register_notifier()
    when edev parameter is NULL. When edev is NULL, this function returns
    the first extcon device which includes the sepecific external connector
    of second paramter. But, it don't guarantee the same operation in all cases.
    To remove this confusion and potential problem, this patch fixes it.
    
    Signed-off-by: Chanwoo Choi <cw00.choi@samsung.com>
    Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ee61d06653fda94176813c852a547567a7887d21
Author: Leif Liddy <leif.linux@gmail.com>
Date:   Sat Jul 8 20:55:32 2017 +0200

    Bluetooth: btusb: fix QCA Rome suspend/resume
    
    commit fd865802c66bc451dc515ed89360f84376ce1a56 upstream.
    
    There's been numerous reported instances where BTUSB_QCA_ROME
    bluetooth controllers stop functioning upon resume from suspend. These
    devices seem to be losing power during suspend. Patch will detect a status
    change on resume and perform a reset.
    
    Signed-off-by: Leif Liddy <leif.linux@gmail.com>
    Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
    Cc: Kai Heng Feng <kai.heng.feng@canonical.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a5bd3edda619965bdaeb198f49b3713b4051ef39
Author: Eric Biggers <ebiggers@google.com>
Date:   Fri Nov 17 11:50:27 2017 -0800

    arm: crypto: reduce priority of bit-sliced AES cipher
    
    [ Not upstream because this is a minimal fix for a bug where arm32
      kernels can use a much slower implementation of AES than is actually
      available, potentially forcing vendors to disable encryption on their
      devices.]
    
    All the aes-bs (bit-sliced) and aes-ce (cryptographic extensions)
    algorithms had a priority of 300.  This is undesirable because it means
    an aes-bs algorithm may be used when an aes-ce algorithm is available.
    The aes-ce algorithms have much better performance (up to 10x faster).
    
    Fix it by decreasing the priority of the aes-bs algorithms to 250.
    
    This was fixed upstream by commit cc477bf64573 ("crypto: arm/aes -
    replace bit-sliced OpenSSL NEON code"), but it was just a small part of
    a complete rewrite.  This patch just fixes the priority bug for older
    kernels.
    
    Signed-off-by: Eric Biggers <ebiggers@google.com>
    Acked-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>

commit 49c1e5f032382713933a86fa1077c438b430f6fc
Author: Andrey Konovalov <andreyknvl@google.com>
Date:   Thu Nov 2 10:38:21 2017 -0400

    media: dib0700: fix invalid dvb_detach argument
    
    commit eb0c19942288569e0ae492476534d5a485fb8ab4 upstream.
    
    dvb_detach(arg) calls symbol_put_addr(arg), where arg should be a pointer
    to a function. Right now a pointer to state->dib7000p_ops is passed to
    dvb_detach(), which causes a BUG() in symbol_put_addr() as discovered by
    syzkaller. Pass state->dib7000p_ops.set_wbd_ref instead.
    
    ------------[ cut here ]------------
    kernel BUG at kernel/module.c:1081!
    invalid opcode: 0000 [#1] PREEMPT SMP KASAN
    Modules linked in:
    CPU: 1 PID: 1151 Comm: kworker/1:1 Tainted: G        W
    4.14.0-rc1-42251-gebb2c2437d80 #224
    Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS Bochs 01/01/2011
    Workqueue: usb_hub_wq hub_event
    task: ffff88006a336300 task.stack: ffff88006a7c8000
    RIP: 0010:symbol_put_addr+0x54/0x60 kernel/module.c:1083
    RSP: 0018:ffff88006a7ce210 EFLAGS: 00010246
    RAX: 0000000000000000 RBX: ffff880062a8d190 RCX: 0000000000000000
    RDX: dffffc0000000020 RSI: ffffffff85876d60 RDI: ffff880062a8d190
    RBP: ffff88006a7ce218 R08: 1ffff1000d4f9c12 R09: 1ffff1000d4f9ae4
    R10: 1ffff1000d4f9bed R11: 0000000000000000 R12: ffff880062a8d180
    R13: 00000000ffffffed R14: ffff880062a8d190 R15: ffff88006947c000
    FS:  0000000000000000(0000) GS:ffff88006c900000(0000) knlGS:0000000000000000
    CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
    CR2: 00007f6416532000 CR3: 00000000632f5000 CR4: 00000000000006e0
    Call Trace:
     stk7070p_frontend_attach+0x515/0x610
    drivers/media/usb/dvb-usb/dib0700_devices.c:1013
     dvb_usb_adapter_frontend_init+0x32b/0x660
    drivers/media/usb/dvb-usb/dvb-usb-dvb.c:286
     dvb_usb_adapter_init drivers/media/usb/dvb-usb/dvb-usb-init.c:86
     dvb_usb_init drivers/media/usb/dvb-usb/dvb-usb-init.c:162
     dvb_usb_device_init+0xf70/0x17f0 drivers/media/usb/dvb-usb/dvb-usb-init.c:277
     dib0700_probe+0x171/0x5a0 drivers/media/usb/dvb-usb/dib0700_core.c:886
     usb_probe_interface+0x35d/0x8e0 drivers/usb/core/driver.c:361
     really_probe drivers/base/dd.c:413
     driver_probe_device+0x610/0xa00 drivers/base/dd.c:557
     __device_attach_driver+0x230/0x290 drivers/base/dd.c:653
     bus_for_each_drv+0x161/0x210 drivers/base/bus.c:463
     __device_attach+0x26e/0x3d0 drivers/base/dd.c:710
     device_initial_probe+0x1f/0x30 drivers/base/dd.c:757
     bus_probe_device+0x1eb/0x290 drivers/base/bus.c:523
     device_add+0xd0b/0x1660 drivers/base/core.c:1835
     usb_set_configuration+0x104e/0x1870 drivers/usb/core/message.c:1932
     generic_probe+0x73/0xe0 drivers/usb/core/generic.c:174
     usb_probe_device+0xaf/0xe0 drivers/usb/core/driver.c:266
     really_probe drivers/base/dd.c:413
     driver_probe_device+0x610/0xa00 drivers/base/dd.c:557
     __device_attach_driver+0x230/0x290 drivers/base/dd.c:653
     bus_for_each_drv+0x161/0x210 drivers/base/bus.c:463
     __device_attach+0x26e/0x3d0 drivers/base/dd.c:710
     device_initial_probe+0x1f/0x30 drivers/base/dd.c:757
     bus_probe_device+0x1eb/0x290 drivers/base/bus.c:523
     device_add+0xd0b/0x1660 drivers/base/core.c:1835
     usb_new_device+0x7b8/0x1020 drivers/usb/core/hub.c:2457
     hub_port_connect drivers/usb/core/hub.c:4903
     hub_port_connect_change drivers/usb/core/hub.c:5009
     port_event drivers/usb/core/hub.c:5115
     hub_event+0x194d/0x3740 drivers/usb/core/hub.c:5195
     process_one_work+0xc7f/0x1db0 kernel/workqueue.c:2119
     worker_thread+0x221/0x1850 kernel/workqueue.c:2253
     kthread+0x3a1/0x470 kernel/kthread.c:231
     ret_from_fork+0x2a/0x40 arch/x86/entry/entry_64.S:431
    Code: ff ff 48 85 c0 74 24 48 89 c7 e8 48 ea ff ff bf 01 00 00 00 e8
    de 20 e3 ff 65 8b 05 b7 2f c2 7e 85 c0 75 c9 e8 f9 0b c1 ff eb c2 <0f>
    0b 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 44 00 00 48 b8 00 00
    RIP: symbol_put_addr+0x54/0x60 RSP: ffff88006a7ce210
    ---[ end trace b75b357739e7e116 ]---
    
    Signed-off-by: Andrey Konovalov <andreyknvl@google.com>
    Cc: Ben Hutchings <ben.hutchings@codethink.co.uk>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ca98a5c721703de77f7fb8bbafd0673e4a60a841
Author: Arvind Yadav <arvind.yadav.cs@gmail.com>
Date:   Mon Oct 9 20:14:48 2017 +0200

    media: imon: Fix null-ptr-deref in imon_probe
    
    commit 58fd55e838276a0c13d1dc7c387f90f25063cbf3 upstream.
    
    It seems that the return value of usb_ifnum_to_if() can be NULL and
    needs to be checked.
    
    Signed-off-by: Arvind Yadav <arvind.yadav.cs@gmail.com>
    Tested-by: Andrey Konovalov <andreyknvl@google.com>
    Signed-off-by: Sean Young <sean@mess.org>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@osg.samsung.com>
    Cc: Ben Hutchings <ben.hutchings@codethink.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
