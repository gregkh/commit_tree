commit dc824ef433c6b378e90bd87bd6a57fd607de7c32
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Thu Dec 5 15:27:18 2019 +0100

    Linux 4.4.206

commit 6a18ac2ec66f80075a1f581f7fc1bc7677a0ab35
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Fri Nov 22 19:56:40 2019 +0100

    platform/x86: hp-wmi: Fix ACPI errors caused by too small buffer
    
    commit 16245db1489cd9aa579506f64afeeeb13d825a93 upstream.
    
    The HP WMI calls may take up to 128 bytes of data as input, and
    the AML methods implementing the WMI calls, declare a couple of fields for
    accessing input in different sizes, specifycally the HWMC method contains:
    
            CreateField (Arg1, 0x80, 0x0400, D128)
    
    Even though we do not use any of the WMI command-types which need a buffer
    of this size, the APCI interpreter still tries to create it as it is
    declared in generoc code at the top of the HWMC method which runs before
    the code looks at which command-type is requested.
    
    This results in many of these errors on many different HP laptop models:
    
    [   14.459261] ACPI Error: Field [D128] at 1152 exceeds Buffer [NULL] size 160 (bits) (20170303/dsopcode-236)
    [   14.459268] ACPI Error: Method parse/execution failed [\HWMC] (Node ffff8edcc61507f8), AE_AML_BUFFER_LIMIT (20170303/psparse-543)
    [   14.459279] ACPI Error: Method parse/execution failed [\_SB.WMID.WMAA] (Node ffff8edcc61523c0), AE_AML_BUFFER_LIMIT (20170303/psparse-543)
    
    This commit increases the size of the data element of the bios_args struct
    to 128 bytes fixing these errors.
    
    Cc: stable@vger.kernel.org
    BugLink: https://bugzilla.kernel.org/show_bug.cgi?id=197007
    BugLink: https://bugzilla.kernel.org/show_bug.cgi?id=201981
    BugLink: https://bugzilla.redhat.com/show_bug.cgi?id=1520703
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ee168df277fef44597ce8c36311a986b068eb877
Author: Lionel Debieve <lionel.debieve@st.com>
Date:   Mon Apr 1 12:30:45 2019 +0200

    hwrng: stm32 - fix unbalanced pm_runtime_enable
    
    commit af0d4442dd6813de6e77309063beb064fa8e89ae upstream.
    
    No remove function implemented yet in the driver.
    Without remove function, the pm_runtime implementation
    complains when removing and probing again the driver.
    
    Signed-off-by: Lionel Debieve <lionel.debieve@st.com>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
    Signed-off-by: Mathieu Poirier <mathieu.poirier@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 2f6887ccffabd6e10ba22142d1cadfdd0faa87a5
Author: Candle Sun <candle.sun@unisoc.com>
Date:   Tue Oct 22 22:21:39 2019 +0800

    HID: core: check whether Usage Page item is after Usage ID items
    
    commit 1cb0d2aee26335d0bccf29100c7bed00ebece851 upstream.
    
    Upstream commit 58e75155009c ("HID: core: move Usage Page concatenation
    to Main item") adds support for Usage Page item after Usage ID items
    (such as keyboards manufactured by Primax).
    
    Usage Page concatenation in Main item works well for following report
    descriptor patterns:
    
        USAGE_PAGE (Keyboard)                   05 07
        USAGE_MINIMUM (Keyboard LeftControl)    19 E0
        USAGE_MAXIMUM (Keyboard Right GUI)      29 E7
        LOGICAL_MINIMUM (0)                     15 00
        LOGICAL_MAXIMUM (1)                     25 01
        REPORT_SIZE (1)                         75 01
        REPORT_COUNT (8)                        95 08
        INPUT (Data,Var,Abs)                    81 02
    
    -------------
    
        USAGE_MINIMUM (Keyboard LeftControl)    19 E0
        USAGE_MAXIMUM (Keyboard Right GUI)      29 E7
        LOGICAL_MINIMUM (0)                     15 00
        LOGICAL_MAXIMUM (1)                     25 01
        REPORT_SIZE (1)                         75 01
        REPORT_COUNT (8)                        95 08
        USAGE_PAGE (Keyboard)                   05 07
        INPUT (Data,Var,Abs)                    81 02
    
    But it makes the parser act wrong for the following report
    descriptor pattern(such as some Gamepads):
    
        USAGE_PAGE (Button)                     05 09
        USAGE (Button 1)                        09 01
        USAGE (Button 2)                        09 02
        USAGE (Button 4)                        09 04
        USAGE (Button 5)                        09 05
        USAGE (Button 7)                        09 07
        USAGE (Button 8)                        09 08
        USAGE (Button 14)                       09 0E
        USAGE (Button 15)                       09 0F
        USAGE (Button 13)                       09 0D
        USAGE_PAGE (Consumer Devices)           05 0C
        USAGE (Back)                            0a 24 02
        USAGE (HomePage)                        0a 23 02
        LOGICAL_MINIMUM (0)                     15 00
        LOGICAL_MAXIMUM (1)                     25 01
        REPORT_SIZE (1)                         75 01
        REPORT_COUNT (11)                       95 0B
        INPUT (Data,Var,Abs)                    81 02
    
    With Usage Page concatenation in Main item, parser recognizes all the
    11 Usages as consumer keys, it is not the HID device's real intention.
    
    This patch checks whether Usage Page is really defined after Usage ID
    items by comparing usage page using status.
    
    Usage Page concatenation on currently defined Usage Page will always
    do in local parsing when Usage ID items encountered.
    
    When Main item is parsing, concatenation will do again with last
    defined Usage Page if this page has not been used in the previous
    usages concatenation.
    
    Signed-off-by: Candle Sun <candle.sun@unisoc.com>
    Signed-off-by: Nianfu Bai <nianfu.bai@unisoc.com>
    Cc: Benjamin Tissoires <benjamin.tissoires@redhat.com>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Cc: Siarhei Vishniakou <svv@google.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit bdeadedaf82e168c7a5073436d45ab6d1c0029b1
Author: Dust Li <dust.li@linux.alibaba.com>
Date:   Thu Nov 28 14:29:09 2019 +0800

    net: sched: fix `tc -s class show` no bstats on class with nolock subqueues
    
    [ Upstream commit 14e54ab9143fa60794d13ea0a66c792a2046a8f3 ]
    
    When a classful qdisc's child qdisc has set the flag
    TCQ_F_CPUSTATS (pfifo_fast for example), the child qdisc's
    cpu_bstats should be passed to gnet_stats_copy_basic(),
    but many classful qdisc didn't do that. As a result,
    `tc -s class show dev DEV` always return 0 for bytes and
    packets in this case.
    
    Pass the child qdisc's cpu_bstats to gnet_stats_copy_basic()
    to fix this issue.
    
    The qstats also has this problem, but it has been fixed
    in 5dd431b6b9 ("net: sched: introduce and use qstats read...")
    and bstats still remains buggy.
    
    Fixes: 22e0f8b9322c ("net: sched: make bstats per cpu and estimator RCU safe")
    Signed-off-by: Dust Li <dust.li@linux.alibaba.com>
    Signed-off-by: Tony Lu <tonylu@linux.alibaba.com>
    Acked-by: Cong Wang <xiyou.wangcong@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 03725d91a8c949540209de629e64e3dbf65fe3f7
Author: John Rutherford <john.rutherford@dektech.com.au>
Date:   Tue Nov 26 13:52:55 2019 +1100

    tipc: fix link name length check
    
    [ Upstream commit fd567ac20cb0377ff466d3337e6e9ac5d0cb15e4 ]
    
    In commit 4f07b80c9733 ("tipc: check msg->req data len in
    tipc_nl_compat_bearer_disable") the same patch code was copied into
    routines: tipc_nl_compat_bearer_disable(),
    tipc_nl_compat_link_stat_dump() and tipc_nl_compat_link_reset_stats().
    The two link routine occurrences should have been modified to check
    the maximum link name length and not bearer name length.
    
    Fixes: 4f07b80c9733 ("tipc: check msg->reg data len in tipc_nl_compat_bearer_disable")
    Signed-off-by: John Rutherford <john.rutherford@dektech.com.au>
    Acked-by: Jon Maloy <jon.maloy@ericsson.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 265a0b98e22ce008626455217db866bb4e758838
Author: Paolo Abeni <pabeni@redhat.com>
Date:   Sun Dec 1 18:41:25 2019 +0100

    openvswitch: remove another BUG_ON()
    
    [ Upstream commit 8a574f86652a4540a2433946ba826ccb87f398cc ]
    
    If we can't build the flow del notification, we can simply delete
    the flow, no need to crash the kernel. Still keep a WARN_ON to
    preserve debuggability.
    
    Note: the BUG_ON() predates the Fixes tag, but this change
    can be applied only after the mentioned commit.
    
    v1 -> v2:
     - do not leak an skb on error
    
    Fixes: aed067783e50 ("openvswitch: Minimize ovs_flow_cmd_del critical section.")
    Signed-off-by: Paolo Abeni <pabeni@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 390dcbc1cda8c9951c159c280fb336e02173bd78
Author: Paolo Abeni <pabeni@redhat.com>
Date:   Sun Dec 1 18:41:24 2019 +0100

    openvswitch: drop unneeded BUG_ON() in ovs_flow_cmd_build_info()
    
    [ Upstream commit 8ffeb03fbba3b599690b361467bfd2373e8c450f ]
    
    All the callers of ovs_flow_cmd_build_info() already deal with
    error return code correctly, so we can handle the error condition
    in a more gracefull way. Still dump a warning to preserve
    debuggability.
    
    v1 -> v2:
     - clarify the commit message
     - clean the skb and report the error (DaveM)
    
    Fixes: ccb1352e76cf ("net: Add Open vSwitch kernel components.")
    Signed-off-by: Paolo Abeni <pabeni@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ee58887f5002721023e56100393c4aacb00d3b23
Author: Jouni Hogander <jouni.hogander@unikie.com>
Date:   Mon Nov 25 14:23:43 2019 +0200

    slip: Fix use-after-free Read in slip_open
    
    [ Upstream commit e58c1912418980f57ba2060017583067f5f71e52 ]
    
    Slip_open doesn't clean-up device which registration failed from the
    slip_devs device list. On next open after failure this list is iterated
    and freed device is accessed. Fix this by calling sl_free_netdev in error
    path.
    
    Here is the trace from the Syzbot:
    
    __dump_stack lib/dump_stack.c:77 [inline]
    dump_stack+0x197/0x210 lib/dump_stack.c:118
    print_address_description.constprop.0.cold+0xd4/0x30b mm/kasan/report.c:374
    __kasan_report.cold+0x1b/0x41 mm/kasan/report.c:506
    kasan_report+0x12/0x20 mm/kasan/common.c:634
    __asan_report_load8_noabort+0x14/0x20 mm/kasan/generic_report.c:132
    sl_sync drivers/net/slip/slip.c:725 [inline]
    slip_open+0xecd/0x11b7 drivers/net/slip/slip.c:801
    tty_ldisc_open.isra.0+0xa3/0x110 drivers/tty/tty_ldisc.c:469
    tty_set_ldisc+0x30e/0x6b0 drivers/tty/tty_ldisc.c:596
    tiocsetd drivers/tty/tty_io.c:2334 [inline]
    tty_ioctl+0xe8d/0x14f0 drivers/tty/tty_io.c:2594
    vfs_ioctl fs/ioctl.c:46 [inline]
    file_ioctl fs/ioctl.c:509 [inline]
    do_vfs_ioctl+0xdb6/0x13e0 fs/ioctl.c:696
    ksys_ioctl+0xab/0xd0 fs/ioctl.c:713
    __do_sys_ioctl fs/ioctl.c:720 [inline]
    __se_sys_ioctl fs/ioctl.c:718 [inline]
    __x64_sys_ioctl+0x73/0xb0 fs/ioctl.c:718
    do_syscall_64+0xfa/0x760 arch/x86/entry/common.c:290
    entry_SYSCALL_64_after_hwframe+0x49/0xbe
    
    Fixes: 3b5a39979daf ("slip: Fix memory leak in slip_open error path")
    Reported-by: syzbot+4d5170758f3762109542@syzkaller.appspotmail.com
    Cc: David Miller <davem@davemloft.net>
    Cc: Oliver Hartkopp <socketcan@hartkopp.net>
    Cc: Lukas Bulwahn <lukas.bulwahn@gmail.com>
    Signed-off-by: Jouni Hogander <jouni.hogander@unikie.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 63add13572d010d71eb6ed407164721930a7e634
Author: Paolo Abeni <pabeni@redhat.com>
Date:   Tue Nov 26 12:55:50 2019 +0100

    openvswitch: fix flow command message size
    
    [ Upstream commit 4e81c0b3fa93d07653e2415fa71656b080a112fd ]
    
    When user-space sets the OVS_UFID_F_OMIT_* flags, and the relevant
    flow has no UFID, we can exceed the computed size, as
    ovs_nla_put_identifier() will always dump an OVS_FLOW_ATTR_KEY
    attribute.
    Take the above in account when computing the flow command message
    size.
    
    Fixes: 74ed7ab9264c ("openvswitch: Add support for unique flow IDs.")
    Reported-by: Qi Jun Ding <qding@redhat.com>
    Signed-off-by: Paolo Abeni <pabeni@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4422c12618e96ffc61e161c6638261ec31cf7cfa
Author: Menglong Dong <dong.menglong@zte.com.cn>
Date:   Mon Nov 25 16:58:09 2019 +0800

    macvlan: schedule bc_work even if error
    
    [ Upstream commit 1d7ea55668878bb350979c377fc72509dd6f5b21 ]
    
    While enqueueing a broadcast skb to port->bc_queue, schedule_work()
    is called to add port->bc_work, which processes the skbs in
    bc_queue, to "events" work queue. If port->bc_queue is full, the
    skb will be discarded and schedule_work(&port->bc_work) won't be
    called. However, if port->bc_queue is full and port->bc_work is not
    running or pending, port->bc_queue will keep full and schedule_work()
    won't be called any more, and all broadcast skbs to macvlan will be
    discarded. This case can happen:
    
    macvlan_process_broadcast() is the pending function of port->bc_work,
    it moves all the skbs in port->bc_queue to the queue "list", and
    processes the skbs in "list". During this, new skbs will keep being
    added to port->bc_queue in macvlan_broadcast_enqueue(), and
    port->bc_queue may already full when macvlan_process_broadcast()
    return. This may happen, especially when there are a lot of real-time
    threads and the process is preempted.
    
    Fix this by calling schedule_work(&port->bc_work) even if
    port->bc_work is full in macvlan_broadcast_enqueue().
    
    Fixes: 412ca1550cbe ("macvlan: Move broadcasts into a work queue")
    Signed-off-by: Menglong Dong <dong.menglong@zte.com.cn>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b189377c808024fa849a8421fd92bcb462c44af7
Author: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Date:   Mon Mar 25 10:49:33 2019 +0100

    pwm: Clear chip_data in pwm_put()
    
    commit e926b12c611c2095c7976e2ed31753ad6eb5ff1a upstream.
    
    After a PWM is disposed by its user the per chip data becomes invalid.
    Clear the data in common code instead of the device drivers to get
    consistent behaviour. Before this patch only three of nine drivers
    cleaned up here.
    
    Signed-off-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
    Signed-off-by: Thierry Reding <thierry.reding@gmail.com>
    Signed-off-by: Lee Jones <lee.jones@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 46510ed537ad1f438882dddf2f85b979c3275b34
Author: Luca Ceresoli <luca@lucaceresoli.net>
Date:   Tue May 14 15:23:07 2019 +0200

    net: macb: fix error format in dev_err()
    
    commit f413cbb332a0b5251a790f396d0eb4ebcade5dec upstream.
    
    Errors are negative numbers. Using %u shows them as very large positive
    numbers such as 4294967277 that don't make sense. Use the %d format
    instead, and get a much nicer -19.
    
    Signed-off-by: Luca Ceresoli <luca@lucaceresoli.net>
    Fixes: b48e0bab142f ("net: macb: Migrate to devm clock interface")
    Fixes: 93b31f48b3ba ("net/macb: unify clock management")
    Fixes: 421d9df0628b ("net/macb: merge at91_ether driver into macb driver")
    Fixes: aead88bd0e99 ("net: ethernet: macb: Add support for rx_clk")
    Fixes: f5473d1d44e4 ("net: macb: Support clock management for tsu_clk")
    Acked-by: Nicolas Ferre <nicolas.ferre@microchip.com>
    Reviewed-by: Andrew Lunn <andrew@lunn.ch>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Lee Jones <lee.jones@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit be4d60b836e02d497df0f8eb176fb1d9c851b5cf
Author: Eugen Hristev <eugen.hristev@microchip.com>
Date:   Mon Apr 15 10:13:51 2019 -0400

    media: v4l2-ctrl: fix flags for DO_WHITE_BALANCE
    
    commit a0816e5088baab82aa738d61a55513114a673c8e upstream.
    
    Control DO_WHITE_BALANCE is a button, with read only and execute-on-write flags.
    Adding this control in the proper list in the fill function.
    
    After adding it here, we can see output of v4l2-ctl -L
    do_white_balance 0x0098090d (button) : flags=write-only, execute-on-write
    
    Signed-off-by: Eugen Hristev <eugen.hristev@microchip.com>
    Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    Signed-off-by: Lee Jones <lee.jones@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4609bfbf0e4b744e512235a18a53a611d3d1184f
Author: Alexander Usyskin <alexander.usyskin@intel.com>
Date:   Tue Nov 5 17:05:13 2019 +0200

    mei: bus: prefix device names on bus with the bus name
    
    commit 7a2b9e6ec84588b0be65cc0ae45a65bac431496b upstream.
    
    Add parent device name to the name of devices on bus to avoid
    device names collisions for same client UUID available
    from different MEI heads. Namely this prevents sysfs collision under
    /sys/bus/mei/device/
    
    In the device part leave just UUID other parameters that are
    required for device matching are not required here and are
    just bloating the name.
    
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Alexander Usyskin <alexander.usyskin@intel.com>
    Signed-off-by: Tomas Winkler <tomas.winkler@intel.com>
    Link: https://lore.kernel.org/r/20191105150514.14010-1-tomas.winkler@intel.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 851e8c20aa5425ebe9f12921af6a0635970c8c2e
Author: Fabio D'Urso <fabiodurso@hotmail.it>
Date:   Thu Nov 14 01:30:53 2019 +0000

    USB: serial: ftdi_sio: add device IDs for U-Blox C099-F9P
    
    commit c1a1f273d0825774c80896b8deb1c9ea1d0b91e3 upstream.
    
    This device presents itself as a USB hub with three attached devices:
     - An ACM serial port connected to the GPS module (not affected by this
       commit)
     - An FTDI serial port connected to the GPS module (1546:0502)
     - Another FTDI serial port connected to the ODIN-W2 radio module
       (1546:0503)
    
    This commit registers U-Blox's VID and the PIDs of the second and third
    devices.
    
    Datasheet: https://www.u-blox.com/sites/default/files/C099-F9P-AppBoard-Mbed-OS3-FW_UserGuide_%28UBX-18063024%29.pdf
    
    Signed-off-by: Fabio D'Urso <fabiodurso@hotmail.it>
    Cc: stable <stable@vger.kernel.org>
    Signed-off-by: Johan Hovold <johan@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 083c654f82bbb039056687de8deae08c248d577f
Author: Pan Bian <bianpan2016@163.com>
Date:   Tue Nov 5 22:49:11 2019 +0800

    staging: rtl8192e: fix potential use after free
    
    commit b7aa39a2ed0112d07fc277ebd24a08a7b2368ab9 upstream.
    
    The variable skb is released via kfree_skb() when the return value of
    _rtl92e_tx is not zero. However, after that, skb is accessed again to
    read its length, which may result in a use after free bug. This patch
    fixes the bug by moving the release operation to where skb is never
    used later.
    
    Signed-off-by: Pan Bian <bianpan2016@163.com>
    Reviewed-by: Dan Carpenter <dan.carpenter@oracle.com>
    Cc: stable <stable@vger.kernel.org>
    Link: https://lore.kernel.org/r/1572965351-6745-1-git-send-email-bianpan2016@163.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 16851325cc14ae77763e1873d7902291194b1fe1
Author: Boris Brezillon <bbrezillon@kernel.org>
Date:   Wed Jan 30 09:47:00 2019 +0100

    mtd: Remove a debug trace in mtdpart.c
    
    [ Upstream commit bda2ab56356b9acdfab150f31c4bac9846253092 ]
    
    Commit 2b6f0090a333 ("mtd: Check add_mtd_device() ret code") contained
    a leftover of the debug session that led to this bug fix. Remove this
    pr_info().
    
    Fixes: 2b6f0090a333 ("mtd: Check add_mtd_device() ret code")
    Signed-off-by: Boris Brezillon <bbrezillon@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 27cb5fbc84ed4d97a4bbcab04fb186705bac303e
Author: Gen Zhang <blackgod016574@gmail.com>
Date:   Sun May 26 10:42:40 2019 +0800

    powerpc/pseries/dlpar: Fix a missing check in dlpar_parse_cc_property()
    
    [ Upstream commit efa9ace68e487ddd29c2b4d6dd23242158f1f607 ]
    
    In dlpar_parse_cc_property(), 'prop->name' is allocated by kstrdup().
    kstrdup() may return NULL, so it should be checked and handle error.
    And prop should be freed if 'prop->name' is NULL.
    
    Signed-off-by: Gen Zhang <blackgod016574@gmail.com>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit e22387d2d7767305c3109eda585e84472dc2a8a0
Author: John Garry <john.garry@huawei.com>
Date:   Sat Jan 5 00:01:27 2019 +0800

    scsi: libsas: Check SMP PHY control function result
    
    [ Upstream commit 01929a65dfa13e18d89264ab1378854a91857e59 ]
    
    Currently the SMP PHY control execution result is checked, however the
    function result for the command is not.
    
    As such, we may be missing all potential errors, like SMP FUNCTION FAILED,
    INVALID REQUEST FRAME LENGTH, etc., meaning the PHY control request has
    failed.
    
    In some scenarios we need to ensure the function result is accepted, so add
    a check for this.
    
    Tested-by: Jian Luo <luojian5@huawei.com>
    Signed-off-by: John Garry <john.garry@huawei.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5b16614297970daad30328246c7b6611699552d0
Author: James Morse <james.morse@arm.com>
Date:   Tue Jan 29 18:48:39 2019 +0000

    ACPI / APEI: Switch estatus pool to use vmalloc memory
    
    [ Upstream commit 0ac234be1a9497498e57d958f4251f5257b116b4 ]
    
    The ghes code is careful to parse and round firmware's advertised
    memory requirements for CPER records, up to a maximum of 64K.
    However when ghes_estatus_pool_expand() does its work, it splits
    the requested size into PAGE_SIZE granules.
    
    This means if firmware generates 5K of CPER records, and correctly
    describes this in the table, __process_error() will silently fail as it
    is unable to allocate more than PAGE_SIZE.
    
    Switch the estatus pool to vmalloc() memory. On x86 vmalloc() memory
    may fault and be fixed up by vmalloc_fault(). To prevent this call
    vmalloc_sync_all() before an NMI handler could discover the memory.
    
    Signed-off-by: James Morse <james.morse@arm.com>
    Reviewed-by: Borislav Petkov <bp@suse.de>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a51e77dc47362ecad623bdab6add43b216f15ffa
Author: John Garry <john.garry@huawei.com>
Date:   Sat Jan 5 00:01:28 2019 +0800

    scsi: libsas: Support SATA PHY connection rate unmatch fixing during discovery
    
    [ Upstream commit cec9771d2e954650095aa37a6a97722c8194e7d2 ]
    
       +----------+             +----------+
       |          |             |          |
       |          |--- 3.0 G ---|          |--- 6.0 G --- SAS  disk
       |          |             |          |
       |          |--- 3.0 G ---|          |--- 6.0 G --- SAS  disk
       |initiator |             |          |
       | device   |--- 3.0 G ---| Expander |--- 6.0 G --- SAS  disk
       |          |             |          |
       |          |--- 3.0 G ---|          |--- 6.0 G --- SATA disk  -->failed to connect
       |          |             |          |
       |          |             |          |--- 6.0 G --- SATA disk  -->failed to connect
       |          |             |          |
       +----------+             +----------+
    
    According to Serial Attached SCSI - 1.1 (SAS-1.1):
    If an expander PHY attached to a SATA PHY is using a physical link rate
    greater than the maximum connection rate supported by the pathway from an
    STP initiator port, a management application client should use the SMP PHY
    CONTROL function (see 10.4.3.10) to set the PROGRAMMED MAXIMUM PHYSICAL
    LINK RATE field of the expander PHY to the maximum connection rate
    supported by the pathway from that STP initiator port.
    
    Currently libsas does not support checking if this condition occurs, nor
    rectifying when it does.
    
    Such a condition is not at all common, however it has been seen on some
    pre-silicon environments where the initiator PHY only supports a 1.5 Gbit
    maximum linkrate, mated with 12G expander PHYs and 3/6G SATA phy.
    
    This patch adds support for checking and rectifying this condition during
    initial device discovery only.
    
    We do support checking min pathway connection rate during revalidation phase,
    when new devices can be detected in the topology. However we do not
    support in the case of the the user reprogramming PHY linkrates, such that
    min pathway condition is not met/maintained.
    
    A note on root port PHY rates:
    The libsas root port PHY rates calculation is broken. Libsas sets the
    rates (min, max, and current linkrate) of a root port to the same linkrate
    of the first PHY member of that same port. In doing so, it assumes that
    all other PHYs which subsequently join the port to have the same
    negotiated linkrate, when they could actually be different.
    
    In practice this doesn't happen, as initiator and expander PHYs are
    normally initialised with consistent min/max linkrates.
    
    This has not caused an issue so far, so leave alone for now.
    
    Tested-by: Jian Luo <luojian5@huawei.com>
    Signed-off-by: John Garry <john.garry@huawei.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 8fe9970acd224e3f1dede7255ef4cc5c7ca68878
Author: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Date:   Wed Feb 27 13:37:26 2019 +0300

    net: dev: Use unsigned integer as an argument to left-shift
    
    [ Upstream commit f4d7b3e23d259c44f1f1c39645450680fcd935d6 ]
    
    1 << 31 is Undefined Behaviour according to the C standard.
    Use U type modifier to avoid theoretical overflow.
    
    Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit e6bcac89af46d7077184cd900befe7678df077f2
Author: Eric Dumazet <edumazet@google.com>
Date:   Tue Feb 12 12:26:27 2019 -0800

    net: fix possible overflow in __sk_mem_raise_allocated()
    
    [ Upstream commit 5bf325a53202b8728cf7013b72688c46071e212e ]
    
    With many active TCP sockets, fat TCP sockets could fool
    __sk_mem_raise_allocated() thanks to an overflow.
    
    They would increase their share of the memory, instead
    of decreasing it.
    
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 2798fd0b78ec9a9592dfccbfd710c5ee069a6b9b
Author: Bert Kenward <bkenward@solarflare.com>
Date:   Tue Feb 12 13:10:00 2019 +0000

    sfc: initialise found bitmap in efx_ef10_mtd_probe
    
    [ Upstream commit c65285428b6e7797f1bb063f33b0ae7e93397b7b ]
    
    The bitmap of found partitions in efx_ef10_mtd_probe was not
    initialised, causing partitions to be suppressed based off whatever
    value was in the bitmap at the start.
    
    Fixes: 3366463513f5 ("sfc: suppress duplicate nvmem partition types in efx_ef10_mtd_probe")
    Signed-off-by: Bert Kenward <bkenward@solarflare.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 287558db942427d2565e571641075cad1f91b0d3
Author: Hoang Le <hoang.h.le@dektech.com.au>
Date:   Mon Feb 11 09:18:28 2019 +0700

    tipc: fix skb may be leaky in tipc_link_input
    
    [ Upstream commit 7384b538d3aed2ed49d3575483d17aeee790fb06 ]
    
    When we free skb at tipc_data_input, we return a 'false' boolean.
    Then, skb passed to subcalling tipc_link_input in tipc_link_rcv,
    
    <snip>
    1303 int tipc_link_rcv:
    ...
    1354    if (!tipc_data_input(l, skb, l->inputq))
    1355        rc |= tipc_link_input(l, skb, l->inputq);
    </snip>
    
    Fix it by simple changing to a 'true' boolean when skb is being free-ed.
    Then, tipc_link_rcv will bypassed to subcalling tipc_link_input as above
    condition.
    
    Acked-by: Ying Xue <ying.xue@windriver.com>
    Acked-by: Jon Maloy <maloy@donjonn.com>
    Signed-off-by: Hoang Le <hoang.h.le@dektech.com.au>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 405480f60907a8c9163d0ba20858ddb6b06f6b26
Author: Johannes Berg <johannes.berg@intel.com>
Date:   Sat Jan 26 21:12:19 2019 +0100

    decnet: fix DN_IFREQ_SIZE
    
    [ Upstream commit 50c2936634bcb1db78a8ca63249236810c11a80f ]
    
    Digging through the ioctls with Al because of the previous
    patches, we found that on 64-bit decnet's dn_dev_ioctl()
    is wrong, because struct ifreq::ifr_ifru is actually 24
    bytes (not 16 as expected from struct sockaddr) due to the
    ifru_map and ifru_settings members.
    
    Clearly, decnet expects the ioctl to be called with a struct
    like
      struct ifreq_dn {
        char ifr_name[IFNAMSIZ];
        struct sockaddr_dn ifr_addr;
      };
    
    since it does
      struct ifreq *ifr = ...;
      struct sockaddr_dn *sdn = (struct sockaddr_dn *)&ifr->ifr_addr;
    
    This means that DN_IFREQ_SIZE is too big for what it wants on
    64-bit, as it is
      sizeof(struct ifreq) - sizeof(struct sockaddr) +
      sizeof(struct sockaddr_dn)
    
    This assumes that sizeof(struct sockaddr) is the size of ifr_ifru
    but that isn't true.
    
    Fix this to use offsetof(struct ifreq, ifr_ifru).
    
    This indeed doesn't really matter much - the result is that we
    copy in/out 8 bytes more than we should on 64-bit platforms. In
    case the "struct ifreq_dn" lands just on the end of a page though
    it might lead to faults.
    
    As far as I can tell, it has been like this forever, so it seems
    very likely that nobody cares.
    
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 94942f2b61e28dcad1754b5473e2344f58077022
Author: Edward Cree <ecree@solarflare.com>
Date:   Tue Jan 22 19:02:17 2019 +0000

    sfc: suppress duplicate nvmem partition types in efx_ef10_mtd_probe
    
    [ Upstream commit 3366463513f544c12c6b88c13da4462ee9e7a1a1 ]
    
    Use a bitmap to keep track of which partition types we've already seen;
     for duplicates, return -EEXIST from efx_ef10_mtd_probe_partition() and
     thus skip adding that partition.
    Duplicate partitions occur because of the A/B backup scheme used by newer
     sfc NICs.  Prior to this patch they cause sysfs_warn_dup errors because
     they have the same name, causing us not to expose any MTDs at all.
    
    Signed-off-by: Edward Cree <ecree@solarflare.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 2bc7d134284b0a116655d15beb0ee4721c2df882
Author: Konstantin Khlebnikov <khlebnikov@yandex-team.ru>
Date:   Mon Jan 14 13:38:43 2019 +0300

    net/core/neighbour: fix kmemleak minimal reference count for hash tables
    
    [ Upstream commit 01b833ab44c9e484060aad72267fc7e71beb559b ]
    
    This should be 1 for normal allocations, 0 disables leak reporting.
    
    Signed-off-by: Konstantin Khlebnikov <khlebnikov@yandex-team.ru>
    Reported-by: Cong Wang <xiyou.wangcong@gmail.com>
    Fixes: 85704cb8dcfd ("net/core/neighbour: tell kmemleak about hash tables")
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit be840860328cf9c4c0d9462d8f7379336617d05b
Author: Konstantin Khlebnikov <khlebnikov@yandex-team.ru>
Date:   Tue Jan 8 12:30:00 2019 +0300

    net/core/neighbour: tell kmemleak about hash tables
    
    [ Upstream commit 85704cb8dcfd88d351bfc87faaeba1c8214f3177 ]
    
    This fixes false-positive kmemleak reports about leaked neighbour entries:
    
    unreferenced object 0xffff8885c6e4d0a8 (size 1024):
      comm "softirq", pid 0, jiffies 4294922664 (age 167640.804s)
      hex dump (first 32 bytes):
        00 00 00 00 00 00 00 00 20 2c f3 83 ff ff ff ff  ........ ,......
        08 c0 ef 5f 84 88 ff ff 01 8c 7d 02 01 00 00 00  ..._......}.....
      backtrace:
        [<00000000748509fe>] ip6_finish_output2+0x887/0x1e40
        [<0000000036d7a0d8>] ip6_output+0x1ba/0x600
        [<0000000027ea7dba>] ip6_send_skb+0x92/0x2f0
        [<00000000d6e2111d>] udp_v6_send_skb.isra.24+0x680/0x15e0
        [<000000000668a8be>] udpv6_sendmsg+0x18c9/0x27a0
        [<000000004bd5fa90>] sock_sendmsg+0xb3/0xf0
        [<000000008227b29f>] ___sys_sendmsg+0x745/0x8f0
        [<000000008698009d>] __sys_sendmsg+0xde/0x170
        [<00000000889dacf1>] do_syscall_64+0x9b/0x400
        [<0000000081cdb353>] entry_SYSCALL_64_after_hwframe+0x49/0xbe
        [<000000005767ed39>] 0xffffffffffffffff
    
    Signed-off-by: Konstantin Khlebnikov <khlebnikov@yandex-team.ru>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 95b414b81bca2c2786f84cc8f3b39197e77f8204
Author: Gustavo A. R. Silva <gustavo@embeddedor.com>
Date:   Sat Jan 5 10:52:23 2019 -0600

    tipc: fix memory leak in tipc_nl_compat_publ_dump
    
    [ Upstream commit f87d8ad9233f115db92c6c087d58403b0009ed36 ]
    
    There is a memory leak in case genlmsg_put fails.
    
    Fix this by freeing *args* before return.
    
    Addresses-Coverity-ID: 1476406 ("Resource leak")
    Fixes: 46273cf7e009 ("tipc: fix a missing check of genlmsg_put")
    Signed-off-by: Gustavo A. R. Silva <gustavo@embeddedor.com>
    Acked-by: Ying Xue <ying.xue@windriver.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 546e4e174436e340b5db850c30b2dc205bd8d9e2
Author: Boris Brezillon <bbrezillon@kernel.org>
Date:   Wed Jan 2 15:36:54 2019 +0100

    mtd: Check add_mtd_device() ret code
    
    [ Upstream commit 2b6f0090a3335b7bdd03ca520c35591159463041 ]
    
    add_mtd_device() can fail. We should always check its return value
    and gracefully handle the failure case. Fix the call sites where this
    not done (in mtdpart.c) and add a __must_check attribute to the
    prototype to avoid this kind of mistakes.
    
    Signed-off-by: Boris Brezillon <bbrezillon@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit fa226e44179e13bf7d2fd96d16a956b7fd1db565
Author: Olof Johansson <olof@lixom.net>
Date:   Sat Jan 5 13:21:18 2019 -0800

    lib/genalloc.c: include vmalloc.h
    
    [ Upstream commit 35004f2e55807a1a1491db24ab512dd2f770a130 ]
    
    Fixes build break on most ARM/ARM64 defconfigs:
    
      lib/genalloc.c: In function 'gen_pool_add_virt':
      lib/genalloc.c:190:10: error: implicit declaration of function 'vzalloc_node'; did you mean 'kzalloc_node'?
      lib/genalloc.c:190:8: warning: assignment to 'struct gen_pool_chunk *' from 'int' makes pointer from integer without a cast [-Wint-conversion]
      lib/genalloc.c: In function 'gen_pool_destroy':
      lib/genalloc.c:254:3: error: implicit declaration of function 'vfree'; did you mean 'kfree'?
    
    Fixes: 6862d2fc8185 ('lib/genalloc.c: use vzalloc_node() to allocate the bitmap')
    Cc: Huang Shijie <sjhuang@iluvatar.ai>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Alexey Skidanov <alexey.skidanov@intel.com>
    Signed-off-by: Olof Johansson <olof@lixom.net>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit de6d2fff511a9687b7278bf31685ae4395842268
Author: Huang Shijie <sjhuang@iluvatar.ai>
Date:   Thu Jan 3 15:26:51 2019 -0800

    lib/genalloc.c: use vzalloc_node() to allocate the bitmap
    
    [ Upstream commit 6862d2fc81859f88c1f3f660886427893f2b4f3f ]
    
    Some devices may have big memory on chip, such as over 1G.  In some
    cases, the nbytes maybe bigger then 4M which is the bounday of the
    memory buddy system (4K default).
    
    So use vzalloc_node() to allocate the bitmap.  Also use vfree to free
    it.
    
    Link: http://lkml.kernel.org/r/20181225015701.6289-1-sjhuang@iluvatar.ai
    Signed-off-by: Huang Shijie <sjhuang@iluvatar.ai>
    Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
    Cc: Alexey Skidanov <alexey.skidanov@intel.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a7965e6aa6ead68442f67bb3b5d5e3777b3c0222
Author: Junxiao Bi <junxiao.bi@oracle.com>
Date:   Fri Dec 28 00:32:53 2018 -0800

    ocfs2: clear journal dirty flag after shutdown journal
    
    [ Upstream commit d85400af790dba2aa294f0a77e712f166681f977 ]
    
    Dirty flag of the journal should be cleared at the last stage of umount,
    if do it before jbd2_journal_destroy(), then some metadata in uncommitted
    transaction could be lost due to io error, but as dirty flag of journal
    was already cleared, we can't find that until run a full fsck.  This may
    cause system panic or other corruption.
    
    Link: http://lkml.kernel.org/r/20181121020023.3034-3-junxiao.bi@oracle.com
    Signed-off-by: Junxiao Bi <junxiao.bi@oracle.com>
    Reviewed-by: Yiwen Jiang <jiangyiwen@huawei.com>
    Reviewed-by: Joseph Qi <jiangqi903@gmail.com>
    Cc: Jun Piao <piaojun@huawei.com>
    Cc: Changwei Ge <ge.changwei@h3c.com>
    Cc: Joel Becker <jlbec@evilplan.org>
    Cc: Mark Fasheh <mfasheh@versity.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 84ae6096e925cc894c0b11f21bf5817f6cd3fd09
Author: Kangjie Lu <kjlu@umn.edu>
Date:   Wed Dec 26 00:09:04 2018 -0600

    tipc: fix a missing check of genlmsg_put
    
    [ Upstream commit 46273cf7e009231d2b6bc10a926e82b8928a9fb2 ]
    
    genlmsg_put could fail. The fix inserts a check of its return value, and
    if it fails, returns -EMSGSIZE.
    
    Signed-off-by: Kangjie Lu <kjlu@umn.edu>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 0c97734b244ad96515df73ef4d95df8129fd6c0f
Author: Kangjie Lu <kjlu@umn.edu>
Date:   Tue Dec 25 22:23:19 2018 -0600

    atl1e: checking the status of atl1e_write_phy_reg
    
    [ Upstream commit ff07d48d7bc0974d4f96a85a4df14564fb09f1ef ]
    
    atl1e_write_phy_reg() could fail. The fix issues an error message when
    it fails.
    
    Signed-off-by: Kangjie Lu <kjlu@umn.edu>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b801a2820eda33e6ad76adf312aa2518d21d9e5d
Author: Kangjie Lu <kjlu@umn.edu>
Date:   Tue Dec 25 20:57:14 2018 -0600

    net: stmicro: fix a missing check of clk_prepare
    
    [ Upstream commit f86a3b83833e7cfe558ca4d70b64ebc48903efec ]
    
    clk_prepare() could fail, so let's check its status, and if it fails,
    return its error code upstream.
    
    Signed-off-by: Kangjie Lu <kjlu@umn.edu>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a67d613688de361d4f1e79eab0827cdcf3847439
Author: Richard Weinberger <richard@nod.at>
Date:   Tue Oct 30 12:58:12 2018 +0100

    um: Make GCOV depend on !KCOV
    
    [ Upstream commit 550ed0e2036663b35cec12374b835444f9c60454 ]
    
    Both do more or less the same thing and are mutually exclusive.
    If both are enabled the build will fail.
    Sooner or later we can kill UML's GCOV.
    
    Signed-off-by: Richard Weinberger <richard@nod.at>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 88b903fedb6d43443a80a7033b17e0424f072ccc
Author: Aditya Pakki <pakki001@umn.edu>
Date:   Sun Dec 23 19:42:38 2018 -0600

    net/net_namespace: Check the return value of register_pernet_subsys()
    
    [ Upstream commit 0eb987c874dc93f9c9d85a6465dbde20fdd3884c ]
    
    In net_ns_init(), register_pernet_subsys() could fail while registering
    network namespace subsystems. The fix checks the return value and
    sends a panic() on failure.
    
    Signed-off-by: Aditya Pakki <pakki001@umn.edu>
    Reviewed-by: Kirill Tkhai <ktkhai@virtuozzo.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 0df349316d149a002a2996e59374d0c75e4b95e2
Author: Kangjie Lu <kjlu@umn.edu>
Date:   Fri Dec 21 00:29:19 2018 -0600

    regulator: tps65910: fix a missing check of return value
    
    [ Upstream commit cd07e3701fa6a4c68f8493ee1d12caa18d46ec6a ]
    
    tps65910_reg_set_bits() may fail. The fix checks if it fails, and if so,
    returns with its error code.
    
    Signed-off-by: Kangjie Lu <kjlu@umn.edu>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d04e4286035c99279dcb5309e7b52a7860ba4ff7
Author: Luc Van Oostenryck <luc.vanoostenryck@gmail.com>
Date:   Thu Dec 20 17:23:39 2018 +0100

    drbd: fix print_st_err()'s prototype to match the definition
    
    [ Upstream commit 2c38f035117331eb78d0504843c79ea7c7fabf37 ]
    
    print_st_err() is defined with its 4th argument taking an
    'enum drbd_state_rv' but its prototype use an int for it.
    
    Fix this by using 'enum drbd_state_rv' in the prototype too.
    
    Signed-off-by: Luc Van Oostenryck <luc.vanoostenryck@gmail.com>
    Signed-off-by: Roland Kammerer <roland.kammerer@linbit.com>
    Signed-off-by: Lars Ellenberg <lars.ellenberg@linbit.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit bdf15725f68a4413f4f1884a90f5740e64627518
Author: Lars Ellenberg <lars.ellenberg@linbit.com>
Date:   Thu Dec 20 17:23:35 2018 +0100

    drbd: reject attach of unsuitable uuids even if connected
    
    [ Upstream commit fe43ed97bba3b11521abd934b83ed93143470e4f ]
    
    Multiple failure scenario:
    a) all good
       Connected Primary/Secondary UpToDate/UpToDate
    b) lose disk on Primary,
       Connected Primary/Secondary Diskless/UpToDate
    c) continue to write to the device,
       changes only make it to the Secondary storage.
    d) lose disk on Secondary,
       Connected Primary/Secondary Diskless/Diskless
    e) now try to re-attach on Primary
    
    This would have succeeded before, even though that is clearly the
    wrong data set to attach to (missing the modifications from c).
    Because we only compared our "effective" and the "to-be-attached"
    data generation uuid tags if (device->state.conn < C_CONNECTED).
    
    Fix: change that constraint to (device->state.pdsk != D_UP_TO_DATE)
    compare the uuids, and reject the attach.
    
    This patch also tries to improve the reverse scenario:
    first lose Secondary, then Primary disk,
    then try to attach the disk on Secondary.
    
    Before this patch, the attach on the Secondary succeeds, but since commit
    drbd: disconnect, if the wrong UUIDs are attached on a connected peer
    the Primary will notice unsuitable data, and drop the connection hard.
    
    Though unfortunately at a point in time during the handshake where
    we cannot easily abort the attach on the peer without more
    refactoring of the handshake.
    
    We now reject any attach to "unsuitable" uuids,
    as long as we can see a Primary role,
    unless we already have access to "good" data.
    
    Signed-off-by: Lars Ellenberg <lars.ellenberg@linbit.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 3d4ac541f5e62fc0b095086ac4b115ceec865e65
Author: Benjamin Herrenschmidt <benh@kernel.crashing.org>
Date:   Tue Dec 11 13:27:33 2018 +1100

    powerpc/44x/bamboo: Fix PCI range
    
    [ Upstream commit 3cfb9ebe906b51f2942b1e251009bb251efd2ba6 ]
    
    The bamboo dts has a bug: it uses a non-naturally aligned range
    for PCI memory space. This isnt' supported by the code, thus
    causing PCI to break on this system.
    
    This is due to the fact that while the chip memory map has 1G
    reserved for PCI memory, it's only 512M aligned. The code doesn't
    know how to split that into 2 different PMMs and fails, so limit
    the region to 512M.
    
    Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5855158b884ab9859c1b6284954beaf36822509e
Author: Christophe Leroy <christophe.leroy@c-s.fr>
Date:   Fri Dec 14 15:23:33 2018 +0000

    powerpc/mm: Make NULL pointer deferences explicit on bad page faults.
    
    [ Upstream commit 49a502ea23bf9dec47f8f3c3960909ff409cd1bb ]
    
    As several other arches including x86, this patch makes it explicit
    that a bad page fault is a NULL pointer dereference when the fault
    address is lower than PAGE_SIZE
    
    In the mean time, this page makes all bad_page_fault() messages
    shorter so that they remain on one single line. And it prefixes them
    by "BUG: " so that they get easily grepped.
    
    Signed-off-by: Christophe Leroy <christophe.leroy@c-s.fr>
    [mpe: Avoid pr_cont()]
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b3e9c6c877622c6a1a6ccf7879af49850cc24cde
Author: Christophe Leroy <christophe.leroy@c-s.fr>
Date:   Fri Dec 14 10:27:47 2018 +0000

    powerpc/prom: fix early DEBUG messages
    
    [ Upstream commit b18f0ae92b0a1db565c3e505fa87b6971ad3b641 ]
    
    This patch fixes early DEBUG messages in prom.c:
    - Use %px instead of %p to see the addresses
    - Cast memblock_phys_mem_size() with (unsigned long long) to
    avoid build failure when phys_addr_t is not 64 bits.
    
    Signed-off-by: Christophe Leroy <christophe.leroy@c-s.fr>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 9e20d2528e39382d30562d7c8d0028ca30a6cd59
Author: Kyle Roeschley <kyle.roeschley@ni.com>
Date:   Wed Dec 5 09:43:13 2018 +0200

    ath6kl: Fix off by one error in scan completion
    
    [ Upstream commit 5803c12816c43bd09e5f4247dd9313c2d9a2c41b ]
    
    When ath6kl was reworked to share code between regular and scheduled scans
    in commit 3b8ffc6a22ba ("ath6kl: Configure probed SSID list consistently"),
    probed SSID entry changed from 1-index to 0-indexed. However,
    ath6kl_cfg80211_scan_complete_event() was missed in that change. Fix its
    indexing so that we correctly clear out the probed SSID list.
    
    Signed-off-by: Kyle Roeschley <kyle.roeschley@ni.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 9325be593dec582a1a949d15d49507ea390e7749
Author: Kyle Roeschley <kyle.roeschley@ni.com>
Date:   Wed Dec 5 09:43:11 2018 +0200

    ath6kl: Only use match sets when firmware supports it
    
    [ Upstream commit fb376a495fbdb886f38cfaf5a3805401b9e46f13 ]
    
    Commit dd45b7598f1c ("ath6kl: Include match ssid list in scheduled scan")
    merged the probed and matched SSID lists before sending them to the
    firmware. In the process, it assumed match set support is always available
    in ath6kl_set_probed_ssids, which breaks scans for hidden SSIDs. Now, check
    that the firmware supports matching SSIDs in scheduled scans before setting
    MATCH_SSID_FLAG.
    
    Fixes: dd45b7598f1c ("ath6kl: Include match ssid list in scheduled scan")
    Signed-off-by: Kyle Roeschley <kyle.roeschley@ni.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 75bdc879fd3d069c82a51321d90fe0e5118906aa
Author: Varun Prakash <varun@chelsio.com>
Date:   Wed Dec 19 15:42:50 2018 +0530

    scsi: csiostor: fix incorrect dma device in case of vport
    
    [ Upstream commit 9934613edcb40b92a216122876cd3b7e76d08390 ]
    
    In case of ->vport_create() call scsi_add_host_with_dma() instead of
    scsi_add_host() to pass correct dma device.
    
    Signed-off-by: Varun Prakash <varun@chelsio.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4bd358ff41686e85e92b8c12d3ebca8bbb935d65
Author: Anatoliy Glagolev <glagolig@gmail.com>
Date:   Thu Dec 6 16:48:45 2018 -0700

    scsi: qla2xxx: deadlock by configfs_depend_item
    
    [ Upstream commit 17b18eaa6f59044a5172db7d07149e31ede0f920 ]
    
    The intent of invoking configfs_depend_item in commit 7474f52a82d51
    ("tcm_qla2xxx: Perform configfs depend/undepend for base_tpg")
    was to prevent a physical Fibre Channel port removal when
    virtual (NPIV) ports announced through that physical port are active.
    The change does not work as expected: it makes enabled physical port
    dependent on target configfs subsystem (the port's parent), something
    the configfs guarantees anyway.
    
    Besides, scheduling work in a worker thread and waiting for the work's
    completion is not really a valid workaround for the requirement not to call
    configfs_depend_item from a configfs callback: the call occasionally
    deadlocks.
    
    Thus, removing configfs_depend_item calls does not break anything and fixes
    the deadlock problem.
    
    Signed-off-by: Anatoliy Glagolev <glagolig@gmail.com>
    Acked-by: Himanshu Madhani <hmadhani@marvell.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 04fccc75712c4a62b17444e0955f6c4087ceeaab
Author: Bart Van Assche <bvanassche@acm.org>
Date:   Mon Dec 17 13:20:36 2018 -0800

    RDMA/srp: Propagate ib_post_send() failures to the SCSI mid-layer
    
    [ Upstream commit 2ee00f6a98c36f7e4ba07cc33f24cc5a69060cc9 ]
    
    This patch avoids that the SCSI mid-layer keeps retrying forever if
    ib_post_send() fails. This was discovered while testing immediate
    data support and passing a too large num_sge value to ib_post_send().
    
    Cc: Sergey Gorenko <sergeygo@mellanox.com>
    Cc: Max Gurtovoy <maxg@mellanox.com>
    Cc: Laurence Oberman <loberman@redhat.com>
    Signed-off-by: Bart Van Assche <bvanassche@acm.org>
    Signed-off-by: Doug Ledford <dledford@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b73fbb8034703997d8cfd7e53d8cbaaf1b452c46
Author: Geert Uytterhoeven <geert@linux-m68k.org>
Date:   Mon Dec 3 13:20:47 2018 +0100

    openrisc: Fix broken paths to arch/or32
    
    [ Upstream commit 57ce8ba0fd3a95bf29ed741df1c52bd591bf43ff ]
    
    OpenRISC was mainlined as "openrisc", not "or32".
    vmlinux.lds is generated from vmlinux.lds.S.
    
    Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Stafford Horne <shorne@gmail.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4f5897e03e23298ea969503363a8641d4812ce26
Author: Alexander Shiyan <shc_work@mail.ru>
Date:   Wed Dec 19 14:19:20 2018 +0300

    serial: max310x: Fix tx_empty() callback
    
    [ Upstream commit a8da3c7873ea57acb8f9cea58c0af477522965aa ]
    
    Function max310x_tx_empty() accesses the IRQSTS register, which is
    cleared by IC when reading, so if there is an interrupt status, we
    will lose it. This patch implement the transmitter check only by
    the current FIFO level.
    
    Signed-off-by: Alexander Shiyan <shc_work@mail.ru>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit f1f6e74a6ddf7e4341f64aa4c7f03cb5c711b699
Author: Kangjie Lu <kjlu@umn.edu>
Date:   Tue Dec 18 23:04:13 2018 -0600

    drivers/regulator: fix a missing check of return value
    
    [ Upstream commit 966e927bf8cc6a44f8b72582a1d6d3ffc73b12ad ]
    
    If palmas_smps_read() fails, we should not use the read data in "reg"
    which may contain random value. The fix inserts a check for the return
    value of palmas_smps_read(): If it fails, we return the error code
    upstream and stop using "reg".
    
    Signed-off-by: Kangjie Lu <kjlu@umn.edu>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 1d9fc0ba46c0d7bad8da695d825ef5237ff8d0a2
Author: Christophe Leroy <christophe.leroy@c-s.fr>
Date:   Fri Nov 16 17:31:08 2018 +0000

    powerpc/xmon: fix dump_segments()
    
    [ Upstream commit 32c8c4c621897199e690760c2d57054f8b84b6e6 ]
    
    mfsrin() takes segment num from bits 31-28 (IBM bits 0-3).
    
    Signed-off-by: Christophe Leroy <christophe.leroy@c-s.fr>
    [mpe: Clarify bit numbering]
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 23f53171bec2190d3bda773b93281531235e83a6
Author: Christophe Leroy <christophe.leroy@c-s.fr>
Date:   Fri Nov 16 17:27:42 2018 +0000

    powerpc/book3s/32: fix number of bats in p/v_block_mapped()
    
    [ Upstream commit e93ba1b7eb5b188c749052df7af1c90821c5f320 ]
    
    This patch fixes the loop in p_block_mapped() and v_block_mapped()
    to scan the entire bat_addrs[] array.
    
    Signed-off-by: Christophe Leroy <christophe.leroy@c-s.fr>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 14c64742749eb79e5a3465223b485ce6a4523143
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Mon Dec 17 10:05:36 2018 +0300

    IB/qib: Fix an error code in qib_sdma_verbs_send()
    
    [ Upstream commit 5050ae5fa3d54c8e83e1e447cc7e3591110a7f57 ]
    
    We accidentally return success on this error path.
    
    Fixes: f931551bafe1 ("IB/qib: Add new qib driver for QLogic PCIe InfiniBand adapters")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 46455c53f90f96ee174101d1cf9e36ec21620c9c
Author: Nick Bowler <nbowler@draconx.ca>
Date:   Mon Dec 17 09:35:27 2018 -0800

    xfs: Align compat attrlist_by_handle with native implementation.
    
    [ Upstream commit c456d64449efe37da50832b63d91652a85ea1d20 ]
    
    While inspecting the ioctl implementations, I noticed that the compat
    implementation of XFS_IOC_ATTRLIST_BY_HANDLE does not do exactly the
    same thing as the native implementation.  Specifically, the "cursor"
    does not appear to be written out to userspace on the compat path,
    like it is on the native path.
    
    This adjusts the compat implementation to copy out the cursor just
    like the native implementation does.  The attrlist cursor does not
    require any special compat handling.  This fixes xfstests xfs/269
    on both IA-32 and x32 userspace, when running on an amd64 kernel.
    
    Signed-off-by: Nick Bowler <nbowler@draconx.ca>
    Fixes: 0facef7fb053b ("xfs: in _attrlist_by_handle, copy the cursor back to userspace")
    Reviewed-by: Darrick J. Wong <darrick.wong@oracle.com>
    Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 84c5f3d78a3eac25847472a6f4c0e27a2e8a8d5a
Author: Bob Peterson <rpeterso@redhat.com>
Date:   Tue Dec 18 08:29:32 2018 -0600

    gfs2: take jdata unstuff into account in do_grow
    
    [ Upstream commit bc0205612bbd4dd4026d4ba6287f5643c37366ec ]
    
    Before this patch, function do_grow would not reserve enough journal
    blocks in the transaction to unstuff jdata files while growing them.
    This patch adds the logic to add one more block if the file to grow
    is jdata.
    
    Signed-off-by: Bob Peterson <rpeterso@redhat.com>
    Reviewed-by: Andreas Gruenbacher <agruenba@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 957d7c195962adffeb7beb043a4b8ce6afb5c2b4
Author: Peter Hutterer <peter.hutterer@who-t.net>
Date:   Thu Dec 13 11:28:51 2018 +1000

    HID: doc: fix wrong data structure reference for UHID_OUTPUT
    
    [ Upstream commit 46b14eef59a8157138dc02f916a7f97c73b3ec53 ]
    
    Signed-off-by: Peter Hutterer <peter.hutterer@who-t.net>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 083fbc6fe64c8e60c97e9650b8ab41922db0e059
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Thu Dec 13 14:41:11 2018 +0100

    pinctrl: sh-pfc: sh7734: Fix shifted values in IPSR10
    
    [ Upstream commit 054f2400f706327f96770219c3065b5131f8f154 ]
    
    Some values in the Peripheral Function Select Register 10 descriptor are
    shifted by one position, which may cause a peripheral function to be
    programmed incorrectly.
    
    Fixing this makes all HSCIF0 pins use Function 4 (value 3), like was
    already the case for the HSCK0 pin in field IP10[5:3].
    
    Fixes: ac1ebc2190f575fc ("sh-pfc: Add sh7734 pinmux support")
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Reviewed-by: Simon Horman <horms+renesas@verge.net.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 17c3d108f1e6ad0e56110e2062aa8ce72eeaac10
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Thu Dec 13 14:09:56 2018 +0100

    pinctrl: sh-pfc: sh7264: Fix PFCR3 and PFCR0 register configuration
    
    [ Upstream commit 1b99d0c80bbe1810572c2cb77b90f67886adfa8d ]
    
    The Port F Control Register 3 (PFCR3) contains only a single field.
    However, counting from left to right, it is the fourth field, not the
    first field.
    Insert the missing dummy configuration values (3 fields of 16 values) to
    fix this.
    
    The descriptor for the Port F Control Register 0 (PFCR0) lacks the
    description for the 4th field (PF0 Mode, PF0MD[2:0]).
    Add the missing configuration values to fix this.
    
    Fixes: a8d42fc4217b1ea1 ("sh-pfc: Add sh7264 pinmux support")
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Reviewed-by: Simon Horman <horms+renesas@verge.net.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 2d4b497aa859f4ba4ec21c0ef4f78018f050d36e
Author: Michael Mueller <mimu@linux.ibm.com>
Date:   Fri Nov 30 15:32:06 2018 +0100

    KVM: s390: unregister debug feature on failing arch init
    
    [ Upstream commit 308c3e6673b012beecb96ef04cc65f4a0e7cdd99 ]
    
    Make sure the debug feature and its allocated resources get
    released upon unsuccessful architecture initialization.
    
    A related indication of the issue will be reported as kernel
    message.
    
    Signed-off-by: Michael Mueller <mimu@linux.ibm.com>
    Reviewed-by: Cornelia Huck <cohuck@redhat.com>
    Reviewed-by: Pierre Morel <pmorel@linux.ibm.com>
    Reviewed-by: David Hildenbrand <david@redhat.com>
    Message-Id: <20181130143215.69496-2-mimu@linux.ibm.com>
    Signed-off-by: Christian Borntraeger <borntraeger@de.ibm.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit fd2c3d2f6dc26502913b98f728e19e849302bf01
Author: Ross Lagerwall <ross.lagerwall@citrix.com>
Date:   Fri Dec 14 12:55:45 2018 +0000

    xen/pciback: Check dev_data before using it
    
    [ Upstream commit 1669907e3d1abfa3f7586e2d55dbbc117b5adba2 ]
    
    If pcistub_init_device fails, the release function will be called with
    dev_data set to NULL.  Check it before using it to avoid a NULL pointer
    dereference.
    
    Signed-off-by: Ross Lagerwall <ross.lagerwall@citrix.com>
    Reviewed-by: Boris Ostrovsky <boris.ostrovsky@oracle.com>
    Signed-off-by: Boris Ostrovsky <boris.ostrovsky@oracle.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 562b5ed381680e9804efd1f86bb23e86459798d0
Author: Josef Bacik <jbacik@fb.com>
Date:   Mon Dec 3 10:20:32 2018 -0500

    btrfs: only track ref_heads in delayed_ref_updates
    
    [ Upstream commit 158ffa364bf723fa1ef128060646d23dc3942994 ]
    
    We use this number to figure out how many delayed refs to run, but
    __btrfs_run_delayed_refs really only checks every time we need a new
    delayed ref head, so we always run at least one ref head completely no
    matter what the number of items on it.  Fix the accounting to only be
    adjusted when we add/remove a ref head.
    
    In addition to using this number to limit the number of delayed refs
    run, a future patch is also going to use it to calculate the amount of
    space required for delayed refs space reservation.
    
    Reviewed-by: Nikolay Borisov <nborisov@suse.com>
    Signed-off-by: Josef Bacik <jbacik@fb.com>
    Signed-off-by: David Sterba <dsterba@suse.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d40979429b760ae7b9b916445cb01534c9815b9e
Author: Lepton Wu <ytht.net@gmail.com>
Date:   Tue Dec 11 11:12:55 2018 -0800

    VSOCK: bind to random port for VMADDR_PORT_ANY
    
    [ Upstream commit 8236b08cf50f85bbfaf48910a0b3ee68318b7c4b ]
    
    The old code always starts from fixed port for VMADDR_PORT_ANY. Sometimes
    when VMM crashed, there is still orphaned vsock which is waiting for
    close timer, then it could cause connection time out for new started VM
    if they are trying to connect to same port with same guest cid since the
    new packets could hit that orphaned vsock. We could also fix this by doing
    more in vhost_vsock_reset_orphans, but any way, it should be better to start
    from a random local port instead of a fixed one.
    
    Signed-off-by: Lepton Wu <ytht.net@gmail.com>
    Reviewed-by: Jorgen Hansen <jhansen@vmware.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit f644328e9f1b6ad812fe2b5e2bcf292f3a43d24c
Author: Krzysztof Kozlowski <krzk@kernel.org>
Date:   Thu Dec 6 10:45:49 2018 +0100

    gpiolib: Fix return value of gpio_to_desc() stub if !GPIOLIB
    
    [ Upstream commit c5510b8dafce5f3f5a039c9b262ebcae0092c462 ]
    
    If CONFIG_GPOILIB is not set, the stub of gpio_to_desc() should return
    the same type of error as regular version: NULL.  All the callers
    compare the return value of gpio_to_desc() against NULL, so returned
    ERR_PTR would be treated as non-error case leading to dereferencing of
    error value.
    
    Fixes: 79a9becda894 ("gpiolib: export descriptor-based GPIO interface")
    Signed-off-by: Krzysztof Kozlowski <krzk@kernel.org>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit f235bb01d1fb5b3dcbbe6c37db8f2f767af155f6
Author: Masahiro Yamada <yamada.masahiro@socionext.com>
Date:   Fri Dec 7 20:33:53 2018 +0900

    microblaze: move "... is ready" messages to arch/microblaze/Makefile
    
    [ Upstream commit 2e14f94cf4bc2f15ca5362e81ca3a987c79e3062 ]
    
    To prepare for more fixes, move this to arch/microblaze/Makefile.
    Otherwise, the same "... is ready" would be printed multiple times.
    
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Signed-off-by: Michal Simek <michal.simek@xilinx.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit ba39f52ffbc9608dd03eea16537bcd23a09fe1f8
Author: Masahiro Yamada <yamada.masahiro@socionext.com>
Date:   Fri Dec 7 20:33:52 2018 +0900

    microblaze: adjust the help to the real behavior
    
    [ Upstream commit bafcc61d998c1ca18f556d92a0e95335ac68c7da ]
    
    "make ARCH=microblaze help" mentions simpleImage.<dt>.unstrip,
    but it is not a real Make target. It does not work because Makefile
    assumes "system.unstrip" is the name of DT.
    
    $ make ARCH=microblaze CROSS_COMPILE=microblaze-linux- simpleImage.system.unstrip
      [ snip ]
    make[1]: *** No rule to make target 'arch/microblaze/boot/dts/system.unstrip.dtb', needed by 'arch/microblaze/boot/dts/system.dtb'.  Stop.
    make: *** [Makefile;1060: arch/microblaze/boot/dts] Error 2
    make: *** Waiting for unfinished jobs....
    
    simpleImage.<dt> works like a phony target that generates multiple
    images. Reflect the real behavior. I removed the DT directory path
    information because it is already explained a few lines below.
    
    While I am here, I deleted the redundant *_defconfig explanation.
    
    The top-level Makefile caters to list available defconfig files:
    
      mmu_defconfig            - Build for mmu
      nommu_defconfig          - Build for nommu
    
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Signed-off-by: Michal Simek <michal.simek@xilinx.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b53834869411c300a33f0e11c829d312f210ba48
Author: Pan Bian <bianpan2016@163.com>
Date:   Wed Nov 28 11:20:03 2018 +0800

    ubi: Do not drop UBI device reference before using
    
    [ Upstream commit e542087701f09418702673631a908429feb3eae0 ]
    
    The UBI device reference is dropped but then the device is used as a
    parameter of ubi_err. The bug is introduced in changing ubi_err's
    behavior. The old ubi_err does not require a UBI device as its first
    parameter, but the new one does.
    
    Fixes: 32608703310 ("UBI: Extend UBI layer debug/messaging capabilities")
    Signed-off-by: Pan Bian <bianpan2016@163.com>
    Reviewed-by: Boris Brezillon <boris.brezillon@bootlin.com>
    Signed-off-by: Richard Weinberger <richard@nod.at>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 05d90b19b7032521c59c80b6e36a8035e21a1a5c
Author: Pan Bian <bianpan2016@163.com>
Date:   Wed Nov 28 10:57:33 2018 +0800

    ubi: Put MTD device after it is not used
    
    [ Upstream commit b95f83ab762dd6211351b9140f99f43644076ca8 ]
    
    The MTD device reference is dropped via put_mtd_device, however its
    field ->index is read and passed to ubi_msg. To fix this, the patch
    moves the reference dropping after calling ubi_msg.
    
    Signed-off-by: Pan Bian <bianpan2016@163.com>
    Reviewed-by: Boris Brezillon <boris.brezillon@bootlin.com>
    Signed-off-by: Richard Weinberger <richard@nod.at>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit bae8fde48bef10076b0da595ce884566adf4ba3b
Author: Darrick J. Wong <darrick.wong@oracle.com>
Date:   Wed Dec 12 15:18:52 2018 -0800

    xfs: require both realtime inodes to mount
    
    [ Upstream commit 64bafd2f1e484e27071e7584642005d56516cb77 ]
    
    Since mkfs always formats the filesystem with the realtime bitmap and
    summary inodes immediately after the root directory, we should expect
    that both of them are present and loadable, even if there isn't a
    realtime volume attached.  There's no reason to skip this if rbmino ==
    NULLFSINO; in fact, this causes an immediate crash if the there /is/ a
    realtime volume and someone writes to it.
    
    Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
    Reviewed-by: Bill O'Donnell <billodo@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5f6225f9ba03316f5b64cd88c0b5f969dbe832c4
Author: Pan Bian <bianpan2016@163.com>
Date:   Thu Nov 29 18:48:10 2018 +0800

    rtl818x: fix potential use after free
    
    [ Upstream commit afbb1947db94eacc5a13302eee88a9772fb78935 ]
    
    entry is released via usb_put_urb just after calling usb_submit_urb.
    However, entry is used if the submission fails, resulting in a use after
    free bug. The patch fixes this.
    
    Signed-off-by: Pan Bian <bianpan2016@163.com>
    ACKed-by: Larry Finger <Larry.Finger@lwfinger.net>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 3a011f62e67e38bbc48ca3d816cc32b00b90a1ad
Author: Brian Norris <briannorris@chromium.org>
Date:   Mon Dec 3 14:26:55 2018 -0800

    mwifiex: debugfs: correct histogram spacing, formatting
    
    [ Upstream commit 4cb777c64e030778c569f605398d7604d8aabc0f ]
    
    Currently, snippets of this file look like:
    
    rx rates (in Mbps): 0=1M   1=2M2=5.5M  3=11M   4=6M   5=9M  6=12M
    7=18M  8=24M  9=36M  10=48M  11=54M12-27=MCS0-15(BW20) 28-43=MCS0-15(BW40)
    44-53=MCS0-9(VHT:BW20)54-63=MCS0-9(VHT:BW40)64-73=MCS0-9(VHT:BW80)
    ...
    noise_flr[--96dBm] = 22
    noise_flr[--95dBm] = 149
    noise_flr[--94dBm] = 9
    noise_flr[--93dBm] = 2
    
    We're missing some spaces, and we're adding a minus sign ('-') on values
    that are already negative signed integers.
    
    Signed-off-by: Brian Norris <briannorris@chromium.org>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit fe0bde850b042ef2719d32c790a0eb872d969a9a
Author: Pan Bian <bianpan2016@163.com>
Date:   Thu Nov 29 18:25:19 2018 +0800

    mwifiex: fix potential NULL dereference and use after free
    
    [ Upstream commit 1dcd9429212b98bea87fc6ec92fb50bf5953eb47 ]
    
    There are two defects: (1) passing a NULL bss to
    mwifiex_save_hidden_ssid_channels will result in NULL dereference,
    (2) using bss after dropping the reference to it via cfg80211_put_bss.
    To fix them, the patch moves the buggy code to the branch that bss is
    not NULL and puts it before cfg80211_put_bss.
    
    Signed-off-by: Pan Bian <bianpan2016@163.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a7d82370253ca12f8c32f6992f8e27e1fbce7468
Author: Eric Biggers <ebiggers@google.com>
Date:   Thu Dec 6 15:55:41 2018 -0800

    crypto: user - support incremental algorithm dumps
    
    [ Upstream commit 0ac6b8fb23c724b015d9ca70a89126e8d1563166 ]
    
    CRYPTO_MSG_GETALG in NLM_F_DUMP mode sometimes doesn't return all
    registered crypto algorithms, because it doesn't support incremental
    dumps.  crypto_dump_report() only permits itself to be called once, yet
    the netlink subsystem allocates at most ~64 KiB for the skb being dumped
    to.  Thus only the first recvmsg() returns data, and it may only include
    a subset of the crypto algorithms even if the user buffer passed to
    recvmsg() is large enough to hold all of them.
    
    Fix this by using one of the arguments in the netlink_callback structure
    to keep track of the current position in the algorithm list.  Then
    userspace can do multiple recvmsg() on the socket after sending the dump
    request.  This is the way netlink dumps work elsewhere in the kernel;
    it's unclear why this was different (probably just an oversight).
    
    Also fix an integer overflow when calculating the dump buffer size hint.
    
    Fixes: a38f7907b926 ("crypto: Add userspace configuration API")
    Signed-off-by: Eric Biggers <ebiggers@google.com>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 54878c24f874c1624a40e871580b4aa35d8ba37d
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Sat Dec 8 13:59:24 2018 +0100

    ACPI / LPSS: Ignore acpi_device_fix_up_power() return value
    
    [ Upstream commit 1a2fa02f7489dc4d746f2a15fb77b3ce1affade8 ]
    
    Ignore acpi_device_fix_up_power() return value. If we return an error
    we end up with acpi_default_enumeration() still creating a platform-
    device for the device and we end up with the device still being used
    but without the special LPSS related handling which is not useful.
    
    Specicifically ignoring the error fixes the touchscreen no longer
    working after a suspend/resume on a Prowise PT301 tablet.
    
    This tablet has a broken _PS0 method on the touchscreen's I2C controller,
    causing acpi_device_fix_up_power() to fail, causing fallback to standard
    platform-dev handling and specifically causing acpi_lpss_save/restore_ctx
    to not run.
    
    The I2C controllers _PS0 method does actually turn on the device, but then
    does some more nonsense which fails when run during early boot trying to
    use I2C opregion handling on another not-yet registered I2C controller.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 57c2251bea0ae292d9d366287fe8c5e30e5c1e91
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Mon Dec 10 22:58:38 2018 +0100

    ARM: ks8695: fix section mismatch warning
    
    [ Upstream commit 4aa64677330beeeed721b4b122884dabad845d66 ]
    
    WARNING: vmlinux.o(.text+0x13250): Section mismatch in reference from the function acs5k_i2c_init() to the (unknown reference) .init.data:(unknown)
    The function acs5k_i2c_init() references
    the (unknown reference) __initdata (unknown).
    This is often because acs5k_i2c_init lacks a __initdata
    annotation or the annotation of (unknown) is wrong.
    
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Olof Johansson <olof@lixom.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 587c7c9fc221b90c1c13a46b9be0df340dd564d3
Author: Thomas Meyer <thomas@m3y3r.de>
Date:   Sun Dec 2 21:52:11 2018 +0100

    PM / AVS: SmartReflex: NULL check before some freeing functions is not needed
    
    [ Upstream commit 14d338a857f05f894ba3badd9e6d3039c68b8180 ]
    
    NULL check before some freeing functions is not needed.
    
    Signed-off-by: Thomas Meyer <thomas@m3y3r.de>
    Reviewed-by: Kevin Hilman <khilman@baylibre.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit eba36263e51f23caac650f04252f77bf859c1bfa
Author: Suzuki K Poulose <Suzuki.Poulose@arm.com>
Date:   Mon Dec 10 18:07:33 2018 +0000

    arm64: smp: Handle errors reported by the firmware
    
    [ Upstream commit f357b3a7e17af7736d67d8267edc1ed3d1dd9391 ]
    
    The __cpu_up() routine ignores the errors reported by the firmware
    for a CPU bringup operation and looks for the error status set by the
    booting CPU. If the CPU never entered the kernel, we could end up
    in assuming stale error status, which otherwise would have been
    set/cleared appropriately by the booting CPU.
    
    Reported-by: Steve Capper <steve.capper@arm.com>
    Cc: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Suzuki K Poulose <suzuki.poulose@arm.com>
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a241fea4387f842da08f69c62a998d8eaf0f272e
Author: Helge Deller <deller@gmx.de>
Date:   Thu Nov 15 21:06:34 2018 +0100

    parisc: Fix HP SDC hpa address output
    
    [ Upstream commit c4bff35ca1bfba886da6223c9fed76a2b1382b8e ]
    
    Show the hpa address of the HP SDC instead of a hashed value, e.g.:
    HP SDC: HP SDC at 0xf0201000, IRQ 23 (NMI IRQ 24)
    
    Signed-off-by: Helge Deller <deller@gmx.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 2e5fc8e8324b9db3bcf49953d038033ff188ffae
Author: Helge Deller <deller@gmx.de>
Date:   Thu Nov 15 21:09:59 2018 +0100

    parisc: Fix serio address output
    
    [ Upstream commit 785145171d17af2554128becd6a7c8f89e101141 ]
    
    We want the hpa addresses printed in the serio modules, not some
    virtual ioremap()ed address, e.g.:
    
     serio: gsc-ps2-keyboard port at 0xf0108000 irq 22 @ 2:0:11
     serio: gsc-ps2-mouse port at 0xf0108100 irq 22 @ 2:0:12
    
    Signed-off-by: Helge Deller <deller@gmx.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit dafd8cb04ddcce84d11d32fc0622780bee352f65
Author: Fabio Estevam <festevam@gmail.com>
Date:   Wed Dec 5 16:10:01 2018 -0200

    ARM: dts: imx53-voipac-dmm-668: Fix memory node duplication
    
    [ Upstream commit 998a84c27a7f3f9133d32af64e19c05cec161a1a ]
    
    imx53-voipac-dmm-668 has two memory nodes, but the correct representation
    would be to use a single one with two reg entries - one for each RAM chip
    select, so fix it accordingly.
    
    Reported-by: Marco Franchi <marco.franchi@nxp.com>
    Signed-off-by: Fabio Estevam <festevam@gmail.com>
    Signed-off-by: Marco Franchi <marco.franchi@nxp.com>
    Signed-off-by: Shawn Guo <shawnguo@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit f08acf3f0edf1328286074af02ab5992a2776766
Author: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Date:   Wed Nov 28 10:04:16 2018 +0100

    ARM: debug-imx: only define DEBUG_IMX_UART_PORT if needed
    
    [ Upstream commit 7c41ea57beb2aee96fa63091a457b1a2826f3c42 ]
    
    If debugging on i.MX is enabled DEBUG_IMX_UART_PORT defines which UART
    is used for the debug output. If however debugging is off don't only
    hide the then unused config item but drop it completely by using a
    dependency instead of a conditional prompt.
    
    This fixes DEBUG_IMX_UART_PORT being present in the kernel config even
    if DEBUG_LL is disabled.
    
    Signed-off-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
    Signed-off-by: Shawn Guo <shawnguo@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 82eaafb0ae1f78b5cb6f81727e9ec1f795468e87
Author: James Smart <jsmart2021@gmail.com>
Date:   Thu Nov 29 16:09:40 2018 -0800

    scsi: lpfc: Fix dif and first burst use in write commands
    
    [ Upstream commit 7c4042a4d0b7532cfbc90478fd3084b2dab5849e ]
    
    When dif and first burst is used in a write command wqe, the driver was not
    properly setting fields in the io command request. This resulted in no dif
    bytes being sent and invalid xfer_rdy's, resulting in the io being aborted
    by the hardware.
    
    Correct the wqe initializaton when both dif and first burst are used.
    
    Signed-off-by: Dick Kennedy <dick.kennedy@broadcom.com>
    Signed-off-by: James Smart <jsmart2021@gmail.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 2c2e31f88e1a1d64eec3fe6786198e03790961b7
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Thu Nov 7 10:48:47 2019 +0300

    block: drbd: remove a stray unlock in __drbd_send_protocol()
    
    [ Upstream commit 8e9c523016cf9983b295e4bc659183d1fa6ef8e0 ]
    
    There are two callers of this function and they both unlock the mutex so
    this ends up being a double unlock.
    
    Fixes: 44ed167da748 ("drbd: rcu_read_lock() and rcu_dereference() for tconn->net_conf")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 12f9404d01d4ca3bbabab334f1933004bdd93715
Author: Ilya Leoshkevich <iii@linux.ibm.com>
Date:   Tue Nov 5 21:17:06 2019 -0800

    scripts/gdb: fix debugging modules compiled with hot/cold partitioning
    
    [ Upstream commit 8731acc5068eb3f422a45c760d32198175c756f8 ]
    
    gcc's -freorder-blocks-and-partition option makes it group frequently
    and infrequently used code in .text.hot and .text.unlikely sections
    respectively.  At least when building modules on s390, this option is
    used by default.
    
    gdb assumes that all code is located in .text section, and that .text
    section is located at module load address.  With such modules this is no
    longer the case: there is code in .text.hot and .text.unlikely, and
    either of them might precede .text.
    
    Fix by explicitly telling gdb the addresses of code sections.
    
    It might be tempting to do this for all sections, not only the ones in
    the white list.  Unfortunately, gdb appears to have an issue, when
    telling it about e.g. loadable .note.gnu.build-id section causes it to
    think that non-loadable .note.Linux section is loaded at address 0,
    which in turn causes NULL pointers to be resolved to bogus symbols.  So
    keep using the white list approach for the time being.
    
    Link: http://lkml.kernel.org/r/20191028152734.13065-1-iii@linux.ibm.com
    Signed-off-by: Ilya Leoshkevich <iii@linux.ibm.com>
    Reviewed-by: Jan Kiszka <jan.kiszka@siemens.com>
    Cc: Kieran Bingham <kbingham@kernel.org>
    Cc: Heiko Carstens <heiko.carstens@de.ibm.com>
    Cc: Vasily Gorbik <gor@linux.ibm.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 6c9623eb961eccb686f4bba7da835678acfee013
Author: Jeroen Hofstee <jhofstee@victronenergy.com>
Date:   Tue Oct 1 21:01:20 2019 +0000

    can: c_can: D_CAN: c_can_chip_config(): perform a sofware reset on open
    
    [ Upstream commit 23c5a9488f076bab336177cd1d1a366bd8ddf087 ]
    
    When the CAN interface is closed it the hardwre is put in power down
    mode, but does not reset the error counters / state. Reset the D_CAN on
    open, so the reported state and the actual state match.
    
    According to [1], the C_CAN module doesn't have the software reset.
    
    [1] http://www.bosch-semiconductors.com/media/ip_modules/pdf_2/c_can_fd8/users_manual_c_can_fd8_r210_1.pdf
    
    Signed-off-by: Jeroen Hofstee <jhofstee@victronenergy.com>
    Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit ef6546a20076aa873dd7fc925be01199b9b0eb1e
Author: Jeroen Hofstee <jhofstee@victronenergy.com>
Date:   Wed Sep 25 08:58:45 2019 +0000

    can: peak_usb: report bus recovery as well
    
    [ Upstream commit 128a1b87d3ceb2ba449d5aadb222fe22395adeb0 ]
    
    While the state changes are reported when the error counters increase
    and decrease, there is no event when the bus recovers and the error
    counters decrease again. So add those as well.
    
    Change the state going downward to be ERROR_PASSIVE -> ERROR_WARNING ->
    ERROR_ACTIVE instead of directly to ERROR_ACTIVE again.
    
    Signed-off-by: Jeroen Hofstee <jhofstee@victronenergy.com>
    Cc: Stephane Grosjean <s.grosjean@peak-system.com>
    Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a389194e8ec6111ad2c4ef286019e574ae5cf78b
Author: Randy Dunlap <rdunlap@infradead.org>
Date:   Tue Oct 22 20:57:06 2019 -0700

    reset: fix reset_control_ops kerneldoc comment
    
    [ Upstream commit f430c7ed8bc22992ed528b518da465b060b9223f ]
    
    Add a missing short description to the reset_control_ops documentation.
    
    Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
    [p.zabel@pengutronix.de: rebased and updated commit message]
    Signed-off-by: Philipp Zabel <p.zabel@pengutronix.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 6f7912a79bc2a61f86ff9967322464cfd2aba763
Author: Marek Szyprowski <m.szyprowski@samsung.com>
Date:   Fri Oct 25 11:02:01 2019 +0200

    clk: samsung: exynos5420: Preserve PLL configuration during suspend/resume
    
    [ Upstream commit e9323b664ce29547d996195e8a6129a351c39108 ]
    
    Properly save and restore all top PLL related configuration registers
    during suspend/resume cycle. So far driver only handled EPLL and RPLL
    clocks, all other were reset to default values after suspend/resume cycle.
    This caused for example lower G3D (MALI Panfrost) performance after system
    resume, even if performance governor has been selected.
    
    Reported-by: Reported-by: Marian Mihailescu <mihailescu2m@gmail.com>
    Fixes: 773424326b51 ("clk: samsung: exynos5420: add more registers to restore list")
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Sylwester Nawrocki <s.nawrocki@samsung.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 6629de98a6d67e8ee6bbb6290168fb556940fdb0
Author: Russell King <rmk+kernel@armlinux.org.uk>
Date:   Wed Oct 23 14:46:44 2019 +0100

    ASoC: kirkwood: fix external clock probe defer
    
    [ Upstream commit 4523817d51bc3b2ef38da768d004fda2c8bc41de ]
    
    When our call to get the external clock fails, we forget to clean up
    the enabled internal clock correctly.  Enable the clock after we have
    obtained all our resources.
    
    Fixes: 84aac6c79bfd ("ASoC: kirkwood: fix loss of external clock at probe time")
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Link: https://lore.kernel.org/r/E1iNGyK-0004oF-6A@rmk-PC.armlinux.org.uk
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a17c0a6f97c0b07131d2cf2d531c0af09c1ed811
Author: Xiaojun Sang <xsang@codeaurora.org>
Date:   Mon Oct 21 10:54:32 2019 +0100

    ASoC: compress: fix unsigned integer overflow check
    
    [ Upstream commit d3645b055399538415586ebaacaedebc1e5899b0 ]
    
    Parameter fragments and fragment_size are type of u32. U32_MAX is
    the correct check.
    
    Signed-off-by: Xiaojun Sang <xsang@codeaurora.org>
    Signed-off-by: Srinivas Kandagatla <srinivas.kandagatla@linaro.org>
    Acked-by: Vinod Koul <vkoul@kernel.org>
    Link: https://lore.kernel.org/r/20191021095432.5639-1-srinivas.kandagatla@linaro.org
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>
