commit 43598c571e7ed29e4c81e35b4a870fe6b9f8d58e
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Sun Nov 24 08:23:35 2019 +0100

    Linux 4.14.156

commit ee2df37dd9a392260387c6d392d053c8f0538c0f
Author: Takeshi Saito <takeshi.saito.xv@renesas.com>
Date:   Wed May 15 20:23:46 2019 +0200

    mmc: tmio: fix SCC error handling to avoid false positive CRC error
    
    [ Upstream commit 51b72656bb39fdcb8f3174f4007bcc83ad1d275f ]
    
    If an SCC error occurs during a read/write command execution, a false
    positive CRC error message is output.
    
    mmcblk0: response CRC error sending r/w cmd command, card status 0x900
    
    check_scc_error() checks SCC_RVSREQ.RVSERR bit. RVSERR detects a
    correction error in the next (up or down) delay tap position. However,
    since the command is successful, only retuning needs to be executed.
    This has been confirmed by HW engineers.
    
    Thus, on SCC error, set retuning flag instead of setting an error code.
    
    Fixes: b85fb0a1c8ae ("mmc: tmio: Fix SCC error detection")
    Signed-off-by: Takeshi Saito <takeshi.saito.xv@renesas.com>
    [wsa: updated comment and commit message, removed some braces]
    Signed-off-by: Wolfram Sang <wsa+renesas@sang-engineering.com>
    Reviewed-by: Simon Horman <horms+renesas@verge.net.au>
    Reviewed-by: Yoshihiro Shimoda <yoshihiro.shimoda.uh@renesas.com>
    Cc: stable@vger.kernel.org
    Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit cd3cac5198777cabf5ab6a8226148431e42a0ddf
Author: Michael Ellerman <mpe@ellerman.id.au>
Date:   Wed Oct 17 23:39:41 2018 +1100

    powerpc/time: Fix clockevent_decrementer initalisation for PR KVM
    
    [ Upstream commit b4d16ab58c41ff0125822464bdff074cebd0fe47 ]
    
    In the recent commit 8b78fdb045de ("powerpc/time: Use
    clockevents_register_device(), fixing an issue with large
    decrementer") we changed the way we initialise the decrementer
    clockevent(s).
    
    We no longer initialise the mult & shift values of
    decrementer_clockevent itself.
    
    This has the effect of breaking PR KVM, because it uses those values
    in kvmppc_emulate_dec(). The symptom is guest kernels spin forever
    mid-way through boot.
    
    For now fix it by assigning back to decrementer_clockevent the mult
    and shift values.
    
    Fixes: 8b78fdb045de ("powerpc/time: Use clockevents_register_device(), fixing an issue with large decrementer")
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d09d148cad42abf45addbf6f1d39733e2993d899
Author: Alan Mikhak <alan.mikhak@sifive.com>
Date:   Thu May 23 14:18:00 2019 -0700

    tools: PCI: Fix broken pcitest compilation
    
    [ Upstream commit 8a5e0af240e07dd3d4897eb8ff52aab757da7fab ]
    
    pcitest is currently broken due to the following compiler error
    and related warning. Fix by changing the run_test() function
    signature to return an integer result.
    
    pcitest.c: In function run_test:
    pcitest.c:143:9: warning: return with a value, in function
    returning void
      return (ret < 0) ? ret : 1 - ret; /* return 0 if test succeeded */
    
    pcitest.c: In function main:
    pcitest.c:232:9: error: void value not ignored as it ought to be
      return run_test(test);
    
    Fixes: fef31ecaaf2c ("tools: PCI: Fix compilation warnings")
    Signed-off-by: Alan Mikhak <alan.mikhak@sifive.com>
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Reviewed-by: Paul Walmsley <paul.walmsley@sifive.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 1dee3a3efdb877419639f3cafb1f91cfcf9c11ab
Author: Roger Quadros <rogerq@ti.com>
Date:   Wed Dec 5 19:27:44 2018 +0200

    ARM: dts: omap5: Fix dual-role mode on Super-Speed port
    
    [ Upstream commit a763ecc15d0e37c3a15ff6825183061209832685 ]
    
    OMAP5's Super-Speed USB port has a software mailbox register
    that needs to be fed with VBUS and ID events from an external
    VBUS/ID comparator.
    
    Without this, Host role will not work correctly.
    
    Fixes: 656c1a65ab55 ("ARM: dts: omap5: enable OTG role for DWC3 controller")
    Reported-by: H. Nikolaus Schaller <hns@goldelico.com>
    Signed-off-by: Roger Quadros <rogerq@ti.com>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 75f10bdb5595455425d6c5a0381379d89967c40b
Author: Ido Schimmel <idosch@mellanox.com>
Date:   Thu Oct 11 07:47:52 2018 +0000

    mlxsw: spectrum_switchdev: Check notification relevance based on upper device
    
    [ Upstream commit 5050f6ae253ad1307af3486c26fc4f94287078b7 ]
    
    VxLAN FDB updates are sent with the VxLAN device which is not our upper
    and will therefore be ignored by current code.
    
    Solve this by checking whether the upper device (bridge) is our upper.
    
    Signed-off-by: Ido Schimmel <idosch@mellanox.com>
    Reviewed-by: Petr Machata <petrm@mellanox.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 74c0a15d28d1320bb8bfc88213579e45963ab665
Author: Huibin Hong <huibin.hong@rock-chips.com>
Date:   Wed Oct 10 11:00:32 2018 +0200

    spi: rockchip: initialize dma_slave_config properly
    
    [ Upstream commit dd8fd2cbc73f8650f651da71fc61a6e4f30c1566 ]
    
    The rxconf and txconf structs are allocated on the
    stack, so make sure we zero them before filling out
    the relevant fields.
    
    Signed-off-by: Huibin Hong <huibin.hong@rock-chips.com>
    Signed-off-by: Emil Renner Berthing <kernel@esmil.dk>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 28b6a09fbf23d2616af88b13b5654e89bda74777
Author: Felix Fietkau <nbd@nbd.name>
Date:   Sat Oct 6 19:35:05 2018 +0200

    mac80211: minstrel: fix sampling/reporting of CCK rates in HT mode
    
    [ Upstream commit 972b66b86f85f4e8201db454f4c3e9d990cf9836 ]
    
    Long/short preamble selection cannot be sampled separately, since it
    depends on the BSS state. Because of that, sampling attempts to
    currently not used preamble modes are not counted in the statistics,
    which leads to CCK rates being sampled too often.
    
    Fix statistics accounting for long/short preamble by increasing the
    index where necessary.
    Fix excessive CCK rate sampling by dropping unsupported sample attempts.
    
    This improves throughput on 2.4 GHz channels
    
    Signed-off-by: Felix Fietkau <nbd@nbd.name>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 21082313c028bb0ff4eae44029e202dbcb81814b
Author: Felix Fietkau <nbd@nbd.name>
Date:   Sat Oct 6 19:35:04 2018 +0200

    mac80211: minstrel: fix CCK rate group streams value
    
    [ Upstream commit 80df9be67c44cb636bbc92caeddad8caf334c53c ]
    
    Fixes a harmless underflow issue when CCK rates are actively being used
    
    Signed-off-by: Felix Fietkau <nbd@nbd.name>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit cc29bec8bbfb682bd49f7efa9225c50a6c7235fe
Author: Felix Fietkau <nbd@nbd.name>
Date:   Sat Oct 6 19:35:03 2018 +0200

    mac80211: minstrel: fix using short preamble CCK rates on HT clients
    
    [ Upstream commit 37439f2d6e43ae79e22be9be159f0af157468f82 ]
    
    mi->supported[MINSTREL_CCK_GROUP] needs to be updated
    short preamble rates need to be marked as supported regardless of
    whether it's currently enabled. Its state can change at any time without
    a rate_update call.
    
    Fixes: 782dda00ab8e ("mac80211: minstrel_ht: move short preamble check out of get_rate")
    Signed-off-by: Felix Fietkau <nbd@nbd.name>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit da8f0b1fa0b1329a5b75d460ff12840c26ad310b
Author: zhong jiang <zhongjiang@huawei.com>
Date:   Thu Oct 4 13:02:53 2018 +0800

    misc: cxl: Fix possible null pointer dereference
    
    [ Upstream commit 3dac3583bf1a61db6aaf31dfd752c677a4400afd ]
    
    It is not safe to dereference an object before a null test. It is
    not needed and just remove them. Ftrace can be used instead.
    
    Signed-off-by: zhong jiang <zhongjiang@huawei.com>
    Acked-by: Andrew Donnellan <andrew.donnellan@au1.ibm.com>
    Acked-by: Frederic Barrat <fbarrat@linux.ibm.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b72443ac86e762f31681861dac3f6b4e58ee7e38
Author: Pablo Neira Ayuso <pablo@netfilter.org>
Date:   Tue Oct 9 20:06:36 2018 +0200

    netfilter: nft_compat: do not dump private area
    
    [ Upstream commit d701d8117200399d85e63a737d2e4e897932f3b6 ]
    
    Zero pad private area, otherwise we expose private kernel pointer to
    userspace. This patch also zeroes the tail area after the ->matchsize
    and ->targetsize that results from XT_ALIGN().
    
    Fixes: 0ca743a55991 ("netfilter: nf_tables: add compatibility layer for x_tables")
    Reported-by: Florian Westphal <fw@strlen.de>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 31f3c76efc6273c55a59363ad3a37d2b0a5a0b80
Author: Nicolin Chen <nicoleotsuka@gmail.com>
Date:   Sat Sep 29 14:44:06 2018 -0700

    hwmon: (ina3221) Fix INA3221_CONFIG_MODE macros
    
    [ Upstream commit 791ebc9d34e9d212fc03742c31654b017d385926 ]
    
    The three INA3221_CONFIG_MODE macros are not correctly defined here.
    The MODE3-1 bits are located at BIT 2-0 according to the datasheet.
    
    So this patch just fixes them by shifting all of them with a correct
    offset. However, this isn't a crital bug fix as the driver does not
    use any of them at this point.
    
    Signed-off-by: Nicolin Chen <nicoleotsuka@gmail.com>
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit fdb7d2fc03eac8b19435bc28b020160351903cf6
Author: Thierry Reding <treding@nvidia.com>
Date:   Fri Sep 21 12:10:47 2018 +0200

    hwmon: (pwm-fan) Silence error on probe deferral
    
    [ Upstream commit 9f67f7583e77fe5dc57aab3a6159c2642544eaad ]
    
    Probe deferrals aren't actual errors, so silence the error message in
    case the PWM cannot yet be acquired.
    
    Signed-off-by: Thierry Reding <treding@nvidia.com>
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 216bbe2f33fde45902ecbafd21c1dc935a2cf8d0
Author: Linus Walleij <linus.walleij@linaro.org>
Date:   Wed Oct 10 20:39:18 2018 +0200

    pinctrl: gemini: Fix up TVC clock group
    
    [ Upstream commit a85c928f6a7856a09e47d9b37faa3407c7ac6a8e ]
    
    The previous fix made the TVC clock get muxed in on the
    D-Link DIR-685 instead of giving nagging warnings of this
    not working. Not good. We didn't want that, as it breaks
    video.
    
    Create a specific group for the TVC CLK, and break out
    a specific GPIO group for it on the SL3516 so we can use
    that line as GPIO if we don't need the TVC CLK.
    
    Fixes: d17f477c5bc6 ("pinctrl: gemini: Mask and set properly")
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit fff32b6c51beefb45a3ef798529552965373f90e
Author: Colin Ian King <colin.king@canonical.com>
Date:   Wed Sep 5 15:54:01 2018 +0100

    orangefs: rate limit the client not running info message
    
    [ Upstream commit 2978d873471005577e7b68a528b4f256a529b030 ]
    
    Currently accessing various /sys/fs/orangefs files will spam the
    kernel log with the following info message when the client is not
    running:
    
    [  491.489284] sysfs_service_op_show: Client not running :-5:
    
    Rate limit this info message to make it less spammy.
    
    Signed-off-by: Colin Ian King <colin.king@canonical.com>
    Signed-off-by: Mike Marshall <hubcap@omnibond.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 57cae03f53fc4b6c647520532f4d5822f80bcdb3
Author: Timothy E Baldwin <T.E.Baldwin99@members.leeds.ac.uk>
Date:   Mon Oct 8 19:26:48 2018 +0100

    ARM: 8802/1: Call syscall_trace_exit even when system call skipped
    
    [ Upstream commit f18aef742c8fbd68e280dff0a63ba0ca6ee8ad85 ]
    
    On at least x86 and ARM64, and as documented in the ptrace man page
    a skipped system call will still cause a syscall exit ptrace stop.
    
    Previous to this commit 32-bit ARM did not, resulting in strace
    being confused when seccomp skips system calls.
    
    This change also impacts programs that use ptrace to skip system calls.
    
    Fixes: ad75b51459ae ("ARM: 7579/1: arch/allow a scno of -1 to not cause a SIGILL")
    Signed-off-by: Timothy E Baldwin <T.E.Baldwin99@members.leeds.ac.uk>
    Signed-off-by: Eugene Syromyatnikov <evgsyr@gmail.com>
    Reviewed-by: Kees Cook <keescook@chromium.org>
    Tested-by: Kees Cook <keescook@chromium.org>
    Tested-by: Eugene Syromyatnikov <evgsyr@gmail.com>
    Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 58fd14e758b652d02212304093133d45b68f1f37
Author: Trent Piepho <tpiepho@impinj.com>
Date:   Thu Sep 20 19:18:34 2018 +0000

    spi: spidev: Fix OF tree warning logic
    
    [ Upstream commit 605b3bec73cbd74b4ac937b580cd0b47d1300484 ]
    
    spidev will make a big fuss if a device tree node binds a device by
    using "spidev" as the node's compatible property.
    
    However, the logic for this isn't looking for "spidev" in the
    compatible, but rather checking that the device is NOT compatible with
    spidev's list of devices.
    
    This causes a false positive if a device not named "rohm,dh2228fv", etc.
    binds to spidev, even if a means other than putting "spidev" in the
    device tree was used.  E.g., the sysfs driver_override attribute.
    
    Signed-off-by: Trent Piepho <tpiepho@impinj.com>
    Reviewed-by: Jan KundrÃ¡t <jan.kundrat@cesnet.cz>
    Tested-by: Jan KundrÃ¡t <jan.kundrat@cesnet.cz>
    Reviewed-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 596b42285406eb1622ec9f892e17cdf49760f7bb
Author: Linus Walleij <linus.walleij@linaro.org>
Date:   Tue Oct 9 10:11:53 2018 +0200

    pinctrl: gemini: Mask and set properly
    
    [ Upstream commit d17f477c5bc6b4a5dd9f51ae263870da132a8e89 ]
    
    The code was written under the assumption that the
    regmap_update_bits() would mask the bits in the mask and
    set the bits in the value.
    
    It missed the points that it will not set bits in the value
    unless these are also masked in the mask. Set value bits
    that are not in the mask will simply be ignored.
    
    Fixes: 06351d133dea ("pinctrl: add a Gemini SoC pin controller")
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 9d736a3533741f35df9579521dc454ab08d232c8
Author: Hieu Tran Dang <dangtranhieu2012@gmail.com>
Date:   Tue Oct 2 18:06:36 2018 +0700

    spi: fsl-lpspi: Prevent FIFO under/overrun by default
    
    [ Upstream commit de8978c388c66b8fca192213ec9f0727e964c652 ]
    
    Certain devices don't work well when a transmit FIFO underrun or
    receive FIFO overrun occurs. Example is the SAF400x radio chip when
    running at high speed which leads to garbage being sent to/received from
    the chip. In which case, it should stall waiting for further data to be
    available before proceeding. This patch unset the NOSTALL bit in CFGR1
    by default to prevent this issue.
    
    Signed-off-by: Hieu Tran Dang <dangtranhieu2012@gmail.com>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4d7ddcdbdf436932493274073efac62ec2523868
Author: Marek Vasut <marex@denx.de>
Date:   Thu Oct 4 00:52:52 2018 +0200

    gpio: syscon: Fix possible NULL ptr usage
    
    [ Upstream commit 70728c29465bc4bfa7a8c14304771eab77e923c7 ]
    
    The priv->data->set can be NULL while flags contains GPIO_SYSCON_FEAT_OUT
    and chip->set is valid pointer. This happens in case the controller uses
    the default GPIO setter. Always use chip->set to access the setter to avoid
    possible NULL pointer dereferencing.
    
    Signed-off-by: Marek Vasut <marex@denx.de>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit f1dda24adacd9fc99764a8767c927d3d33e630fc
Author: Bjorn Helgaas <bhelgaas@google.com>
Date:   Thu Sep 27 09:21:55 2018 -0500

    x86/kexec: Correct KEXEC_BACKUP_SRC_END off-by-one error
    
    [ Upstream commit 51fbf14f2528a8c6401290e37f1c893a2412f1d3 ]
    
    The only use of KEXEC_BACKUP_SRC_END is as an argument to
    walk_system_ram_res():
    
      int crash_load_segments(struct kimage *image)
      {
        ...
        walk_system_ram_res(KEXEC_BACKUP_SRC_START, KEXEC_BACKUP_SRC_END,
                            image, determine_backup_region);
    
    walk_system_ram_res() expects "start, end" arguments that are inclusive,
    i.e., the range to be walked includes both the start and end addresses.
    
    KEXEC_BACKUP_SRC_END was previously defined as (640 * 1024UL), which is the
    first address *past* the desired 0-640KB range.
    
    Define KEXEC_BACKUP_SRC_END as (640 * 1024UL - 1) so the KEXEC_BACKUP_SRC
    region is [0-0x9ffff], not [0-0xa0000].
    
    Fixes: dd5f726076cc ("kexec: support for kexec on panic using new system call")
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Signed-off-by: Borislav Petkov <bp@suse.de>
    CC: "H. Peter Anvin" <hpa@zytor.com>
    CC: Andrew Morton <akpm@linux-foundation.org>
    CC: Brijesh Singh <brijesh.singh@amd.com>
    CC: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    CC: Ingo Molnar <mingo@redhat.com>
    CC: Lianbo Jiang <lijiang@redhat.com>
    CC: Takashi Iwai <tiwai@suse.de>
    CC: Thomas Gleixner <tglx@linutronix.de>
    CC: Tom Lendacky <thomas.lendacky@amd.com>
    CC: Vivek Goyal <vgoyal@redhat.com>
    CC: baiyaowei@cmss.chinamobile.com
    CC: bhe@redhat.com
    CC: dan.j.williams@intel.com
    CC: dyoung@redhat.com
    CC: kexec@lists.infradead.org
    Link: http://lkml.kernel.org/r/153805811578.1157.6948388946904655969.stgit@bhelgaas-glaptop.roam.corp.google.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit cf205535189770ec61025722a6b426fe28b6bef8
Author: Colin Ian King <colin.king@canonical.com>
Date:   Sat Oct 6 14:01:42 2018 -0400

    media: cx231xx: fix potential sign-extension overflow on large shift
    
    [ Upstream commit 32ae592036d7aeaabcccb2b1715373a68639a768 ]
    
    Shifting the u8 value[3] by an int can lead to sign-extension
    overflow. For example, if value[3] is 0xff and the shift is 24 then it
    is promoted to int and then the top bit is sign-extended so that all
    upper 32 bits are set.  Fix this by casting value[3] to a u32 before
    the shift.
    
    Detected by CoverityScan, CID#1016522 ("Unintended sign extension")
    
    Fixes: e0d3bafd0258 ("V4L/DVB (10954): Add cx231xx USB driver")
    
    Signed-off-by: Colin Ian King <colin.king@canonical.com>
    Signed-off-by: Hans Verkuil <hverkuil@xs4all.nl>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit e30c1d9fc20112cf0b4d7ffaf9a0471d0d0a7f49
Author: Tim Smith <tim.smith@citrix.com>
Date:   Mon Oct 8 12:15:40 2018 -0500

    GFS2: Flush the GFS2 delete workqueue before stopping the kernel threads
    
    [ Upstream commit 1eb8d7387908022951792a46fa040ad3942b3b08 ]
    
    Flushing the workqueue can cause operations to happen which might
    call gfs2_log_reserve(), or get stuck waiting for locks taken by such
    operations.  gfs2_log_reserve() can io_schedule(). If this happens, it
    will never wake because the only thing which can wake it is gfs2_logd()
    which was already stopped.
    
    This causes umount of a gfs2 filesystem to wedge permanently if, for
    example, the umount immediately follows a large delete operation.
    
    When this occured, the following stack trace was obtained from the
    umount command
    
    [<ffffffff81087968>] flush_workqueue+0x1c8/0x520
    [<ffffffffa0666e29>] gfs2_make_fs_ro+0x69/0x160 [gfs2]
    [<ffffffffa0667279>] gfs2_put_super+0xa9/0x1c0 [gfs2]
    [<ffffffff811b7edf>] generic_shutdown_super+0x6f/0x100
    [<ffffffff811b7ff7>] kill_block_super+0x27/0x70
    [<ffffffffa0656a71>] gfs2_kill_sb+0x71/0x80 [gfs2]
    [<ffffffff811b792b>] deactivate_locked_super+0x3b/0x70
    [<ffffffff811b79b9>] deactivate_super+0x59/0x60
    [<ffffffff811d2998>] cleanup_mnt+0x58/0x80
    [<ffffffff811d2a12>] __cleanup_mnt+0x12/0x20
    [<ffffffff8108c87d>] task_work_run+0x7d/0xa0
    [<ffffffff8106d7d9>] exit_to_usermode_loop+0x73/0x98
    [<ffffffff81003961>] syscall_return_slowpath+0x41/0x50
    [<ffffffff815a594c>] int_ret_from_sys_call+0x25/0x8f
    [<ffffffffffffffff>] 0xffffffffffffffff
    
    Signed-off-by: Tim Smith <tim.smith@citrix.com>
    Signed-off-by: Mark Syms <mark.syms@citrix.com>
    Signed-off-by: Bob Peterson <rpeterso@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5e63d5649ae3d47b9a2185544fbe71ed66882be4
Author: Wenwen Wang <wang6495@umn.edu>
Date:   Thu Oct 4 11:44:02 2018 -0400

    media: isif: fix a NULL pointer dereference bug
    
    [ Upstream commit a26ac6c1bed951b2066cc4b2257facd919e35c0b ]
    
    In isif_probe(), there is a while loop to get the ISIF base address and
    linearization table0 and table1 address. In the loop body, the function
    platform_get_resource() is called to get the resource. If
    platform_get_resource() returns NULL, the loop is terminated and the
    execution goes to 'fail_nobase_res'. Suppose the loop is terminated at the
    first iteration because platform_get_resource() returns NULL and the
    execution goes to 'fail_nobase_res'. Given that there is another while loop
    at 'fail_nobase_res' and i equals to 0, one iteration of the second while
    loop will be executed. However, the second while loop does not check the
    return value of platform_get_resource(). This can cause a NULL pointer
    dereference bug if the return value is a NULL pointer.
    
    This patch avoids the above issue by adding a check in the second while
    loop after the call to platform_get_resource().
    
    Signed-off-by: Wenwen Wang <wang6495@umn.edu>
    Signed-off-by: Hans Verkuil <hverkuil@xs4all.nl>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 695583334b6b7f82c39ee124edfbfa48145ed571
Author: He Zhe <zhe.he@windriver.com>
Date:   Sun Sep 30 00:45:53 2018 +0800

    printk: Give error on attempt to set log buffer length to over 2G
    
    [ Upstream commit e6fe3e5b7d16e8f146a4ae7fe481bc6e97acde1e ]
    
    The current printk() is ready to handle log buffer size up to 2G.
    Give an explicit error for users who want to use larger log buffer.
    
    Also fix printk formatting to show the 2G as a positive number.
    
    Link: http://lkml.kernel.org/r/20181008135916.gg4kkmoki5bgtco5@pathway.suse.cz
    Cc: rostedt@goodmis.org
    Cc: linux-kernel@vger.kernel.org
    Suggested-by: Sergey Senozhatsky <sergey.senozhatsky@gmail.com>
    Signed-off-by: He Zhe <zhe.he@windriver.com>
    Reviewed-by: Sergey Senozhatsky <sergey.senozhatsky@gmail.com>
    [pmladek: Fixed to the really safe limit 2GB.]
    Signed-off-by: Petr Mladek <pmladek@suse.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 1faf8a9c7614303a5d29a047bbc9cc00c9412d67
Author: Vignesh R <vigneshr@ti.com>
Date:   Sat Jun 30 16:03:16 2018 +0530

    mfd: ti_am335x_tscadc: Keep ADC interface on if child is wakeup capable
    
    [ Upstream commit c974ac771479327b5424f60d58845e31daddadea ]
    
    If a child device like touchscreen is wakeup capable, then keep ADC
    interface on, so that a touching resistive screen will generate wakeup
    event to the system.
    
    Signed-off-by: Vignesh R <vigneshr@ti.com>
    Signed-off-by: Lee Jones <lee.jones@linaro.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 0f07c78437601b01eb2a75589561bea050a045e7
Author: Nathan Chancellor <natechancellor@gmail.com>
Date:   Fri Sep 21 13:21:31 2018 -0700

    backlight: lm3639: Unconditionally call led_classdev_unregister
    
    [ Upstream commit 7cea645ae9c5a54aa7904fddb2cdf250acd63a6c ]
    
    Clang warns that the address of a pointer will always evaluated as true
    in a boolean context.
    
    drivers/video/backlight/lm3639_bl.c:403:14: warning: address of
    'pchip->cdev_torch' will always evaluate to 'true'
    [-Wpointer-bool-conversion]
            if (&pchip->cdev_torch)
            ~~   ~~~~~~~^~~~~~~~~~
    drivers/video/backlight/lm3639_bl.c:405:14: warning: address of
    'pchip->cdev_flash' will always evaluate to 'true'
    [-Wpointer-bool-conversion]
            if (&pchip->cdev_flash)
            ~~   ~~~~~~~^~~~~~~~~~
    2 warnings generated.
    
    These statements have been present since 2012, introduced by
    commit 0f59858d5119 ("backlight: add new lm3639 backlight
    driver"). Given that they have been called unconditionally since
    then presumably without any issues, removing the always true if
    statements to fix the warnings without any real world changes.
    
    Link: https://github.com/ClangBuiltLinux/linux/issues/119
    Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
    Reviewed-by: Daniel Thompson <daniel.thompson@linaro.org>
    Signed-off-by: Lee Jones <lee.jones@linaro.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 27647dde3018985379d58feacf2fc3f11e91b478
Author: Borislav Petkov <bp@suse.de>
Date:   Mon Oct 8 10:05:20 2018 +0200

    proc/vmcore: Fix i386 build error of missing copy_oldmem_page_encrypted()
    
    [ Upstream commit cf089611f4c446285046fcd426d90c18f37d2905 ]
    
    Lianbo reported a build error with a particular 32-bit config, see Link
    below for details.
    
    Provide a weak copy_oldmem_page_encrypted() function which architectures
    can override, in the same manner other functionality in that file is
    supplied.
    
    Reported-by: Lianbo Jiang <lijiang@redhat.com>
    Signed-off-by: Borislav Petkov <bp@suse.de>
    CC: x86@kernel.org
    Link: http://lkml.kernel.org/r/710b9d95-2f70-eadf-c4a1-c3dc80ee4ebb@redhat.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c0be5255a16a4b0fa08363eb6acc72886052affe
Author: Vasily Gorbik <gor@linux.ibm.com>
Date:   Fri Nov 17 13:02:36 2017 +0100

    s390/kasan: avoid vdso instrumentation
    
    [ Upstream commit 348498458505e202df41b6b9a78da448d39298b7 ]
    
    vdso is mapped into user space processes, which won't have kasan
    shodow mapped.
    
    Reviewed-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
    Signed-off-by: Vasily Gorbik <gor@linux.ibm.com>
    Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit ebf4b548902e52724de640b546acc07b2fc17ff4
Author: Rajmohan Mani <rajmohan.mani@intel.com>
Date:   Fri Oct 5 12:22:17 2018 -0400

    media: dw9714: Fix error handling in probe function
    
    [ Upstream commit f9a0b14240a2d0bd196d35e8aac73df6eabd6382 ]
    
    Fixed the case where v4l2_async_unregister_subdev()
    is called unnecessarily in the error handling path
    in probe function.
    
    Signed-off-by: Rajmohan Mani <rajmohan.mani@intel.com>
    Signed-off-by: Sakari Ailus <sakari.ailus@linux.intel.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5750a2d4939d6f82bfd7edf1a77e3844898ac3cf
Author: Shenghui Wang <shhuiw@foxmail.com>
Date:   Mon Oct 8 20:41:15 2018 +0800

    bcache: recal cached_dev_sectors on detach
    
    [ Upstream commit 46010141da6677b81cc77f9b47f8ac62bd1cbfd3 ]
    
    Recal cached_dev_sectors on cached_dev detached, as recal done on
    cached_dev attached.
    
    Update the cached_dev_sectors before bcache_device_detach called
    as bcache_device_detach will set bcache_device->c to NULL.
    
    Signed-off-by: Shenghui Wang <shhuiw@foxmail.com>
    Signed-off-by: Coly Li <colyli@suse.de>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 784505c2378a1d96a4c97d2ec055ececfdcf4914
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Mon Oct 8 13:14:35 2018 +0200

    reset: Fix potential use-after-free in __of_reset_control_get()
    
    [ Upstream commit b790c8ea5593d6dc3580adfad8e117eeb56af874 ]
    
    Calling of_node_put() decreases the reference count of a device tree
    object, and may free some data.
    
    However, the of_phandle_args structure embedding it is passed to
    reset_controller_dev.of_xlate() after that, so it may still be accessed.
    
    Move the call to of_node_put() down to fix this.
    
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    [p.zabel@pengutronix.de: moved of_node_put after mutex_unlock]
    Signed-off-by: Philipp Zabel <p.zabel@pengutronix.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit e5379b2bc7e11c157a4a1d9e7fb81f52b79c66b1
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Mon Oct 8 12:57:36 2018 +0200

    fbdev: sbuslib: integer overflow in sbusfb_ioctl_helper()
    
    [ Upstream commit e5017716adb8aa5c01c52386c1b7470101ffe9c5 ]
    
    The "index + count" addition can overflow.  Both come directly from the
    user.  This bug leads to an information leak.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Cc: Peter Malone <peter.malone@gmail.com>
    Cc: Philippe Ombredanne <pombredanne@nexb.com>
    Cc: Mathieu Malaterre <malat@debian.org>
    Signed-off-by: Bartlomiej Zolnierkiewicz <b.zolnierkie@samsung.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c2ddc149cdf3d87a141eb4bd56fbfb543784778f
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Mon Oct 8 12:57:36 2018 +0200

    fbdev: sbuslib: use checked version of put_user()
    
    [ Upstream commit d8bad911e5e55e228d59c0606ff7e6b8131ca7bf ]
    
    I'm not sure why the code assumes that only the first put_user() needs
    an access_ok() check.  I have made all the put_user() and get_user()
    calls checked.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Cc: Philippe Ombredanne <pombredanne@nexb.com>
    Cc: Mathieu Malaterre <malat@debian.org>
    Cc: Peter Malone <peter.malone@gmail.com>,
    Signed-off-by: Bartlomiej Zolnierkiewicz <b.zolnierkie@samsung.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 1fb543f3890f991484c1b2328ee0a4521a5b2a4f
Author: Masaharu Hayakawa <masaharu.hayakawa.ry@renesas.com>
Date:   Thu Aug 30 01:32:07 2018 +0200

    mmc: tmio: Fix SCC error detection
    
    [ Upstream commit b85fb0a1c8aeaaa40d08945d51a6656b512173f0 ]
    
    SDR104, HS200 and HS400 need to check for SCC error. If SCC error is
    detected, retuning is necessary.
    
    Signed-off-by: Masaharu Hayakawa <masaharu.hayakawa.ry@renesas.com>
    [Niklas: update commit message]
    Signed-off-by: Niklas Söderlund <niklas.soderlund+renesas@ragnatech.se>
    Reviewed-by: Wolfram Sang <wsa+renesas@sang-engineering.com>
    Tested-by: Wolfram Sang <wsa+renesas@sang-engineering.com>
    Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit bfbcef70a60178af1d18052e5a02e89a53ba8ab9
Author: Andy Lutomirski <luto@kernel.org>
Date:   Tue Sep 18 16:08:52 2018 -0700

    x86/fsgsbase/64: Fix ptrace() to read the FS/GS base accurately
    
    [ Upstream commit 07e1d88adaaeab247b300926f78cc3f950dbeda3 ]
    
    On 64-bit kernels ptrace can read the FS/GS base using the register access
    APIs (PTRACE_PEEKUSER, etc.) or PTRACE_ARCH_PRCTL.
    
    Make both of these mechanisms return the actual FS/GS base.
    
    This will improve debuggability by providing the correct information
    to ptracer such as GDB.
    
    [ chang: Rebased and revised patch description. ]
    [ mingo: Revised the changelog some more. ]
    
    Signed-off-by: Andy Lutomirski <luto@kernel.org>
    Signed-off-by: Chang S. Bae <chang.seok.bae@intel.com>
    Cc: Andy Lutomirski <luto@amacapital.net>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Brian Gerst <brgerst@gmail.com>
    Cc: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: Denys Vlasenko <dvlasenk@redhat.com>
    Cc: H. Peter Anvin <hpa@zytor.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Markus T Metzger <markus.t.metzger@intel.com>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Ravi Shankar <ravi.v.shankar@intel.com>
    Cc: Rik van Riel <riel@surriel.com>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Link: http://lkml.kernel.org/r/1537312139-5580-2-git-send-email-chang.seok.bae@intel.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit fa315cc7cb6cbb76b47c06441787b3aa85514312
Author: Sara Sharon <sara.sharon@intel.com>
Date:   Sun Jul 1 14:52:06 2018 +0300

    iwlwifi: mvm: don't send keys when entering D3
    
    [ Upstream commit 8c7fd6a365eb5b2647b2c01918730d0a485b9f85 ]
    
    In the past, we needed to program the keys when entering D3. This was
    since we replaced the image. However, now that there is a single
    image, this is no longer needed.  Note that RSC is sent separately in
    a new command.  This solves issues with newer devices that support PN
    offload. Since driver re-sent the keys, the PN got zeroed and the
    receiver dropped the next packets, until PN caught up again.
    
    Signed-off-by: Sara Sharon <sara.sharon@intel.com>
    Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4b9d1ab7112cfe9c3011acb661d98bad6c15a6dd
Author: Ronald Tschalär <ronald@innovation.ch>
Date:   Sun Sep 30 19:53:13 2018 -0700

    ACPI / SBS: Fix rare oops when removing modules
    
    [ Upstream commit 757c968c442397f1249bb775a7c8c03842e3e0c7 ]
    
    There was a small race when removing the sbshc module where
    smbus_alarm() had queued acpi_smbus_callback() for deferred execution
    but it hadn't been run yet, so that when it did run hc had been freed
    and the module unloaded, resulting in an invalid paging request.
    
    A similar race existed when removing the sbs module with regards to
    acpi_sbs_callback() (which is called from acpi_smbus_callback()).
    
    We therefore need to ensure no callbacks are pending or executing before
    the cleanups are done and the modules are removed.
    
    Signed-off-by: Ronald TschalÃ¤r <ronald@innovation.ch>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 3dc925644961b2e71ee5c6a8f10c11bd5443290e
Author: Li RongQing <lirongqing@baidu.com>
Date:   Sun Oct 7 10:22:42 2018 +0800

    xfrm: use correct size to initialise sp->ovec
    
    [ Upstream commit f1193e915748291fb205a908db33bd3debece6e2 ]
    
    This place should want to initialize array, not a element,
    so it should be sizeof(array) instead of sizeof(element)
    
    but now this array only has one element, so no error in
    this condition that XFRM_MAX_OFFLOAD_DEPTH is 1
    
    Signed-off-by: Li RongQing <lirongqing@baidu.com>
    Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b154510584140eb0c3fa0dca7ed8fa8782c5d3ef
Author: Radu Solea <radu.solea@nxp.com>
Date:   Tue Oct 2 19:01:52 2018 +0000

    crypto: mxs-dcp - Fix AES issues
    
    [ Upstream commit fadd7a6e616b89c7f4f7bfa7b824f290bab32c3c ]
    
    The DCP driver does not obey cryptlen, when doing android CTS this
    results in passing to hardware input stream lengths which are not
    multiple of block size.
    
    Add a check to prevent future erroneous stream lengths from reaching the
    hardware and adjust the scatterlist walking code to obey cryptlen.
    
    Also properly copy-out the IV for chaining.
    
    Signed-off-by: Radu Solea <radu.solea@nxp.com>
    Signed-off-by: Franck LENORMAND <franck.lenormand@nxp.com>
    Signed-off-by: Leonard Crestez <leonard.crestez@nxp.com>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c0933fa586b472a381310a5e911d27811087c889
Author: Radu Solea <radu.solea@nxp.com>
Date:   Tue Oct 2 19:01:50 2018 +0000

    crypto: mxs-dcp - Fix SHA null hashes and output length
    
    [ Upstream commit c709eebaf5c5faa8a0f140355f9cfe67e8f7afb1 ]
    
    DCP writes at least 32 bytes in the output buffer instead of hash length
    as documented. Add intermediate buffer to prevent write out of bounds.
    
    When requested to produce null hashes DCP fails to produce valid output.
    Add software workaround to bypass hardware and return valid output.
    
    Signed-off-by: Radu Solea <radu.solea@nxp.com>
    Signed-off-by: Leonard Crestez <leonard.crestez@nxp.com>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 348d69f0d53f394461adc8ef4baa7b7f4a408848
Author: Wolfram Sang <wsa+renesas@sang-engineering.com>
Date:   Fri Sep 14 17:43:28 2018 +0200

    dmaengine: rcar-dmac: set scatter/gather max segment size
    
    [ Upstream commit 97d49c59e219acac576e16293a6b8cb99302f62f ]
    
    Fix warning when running with CONFIG_DMA_API_DEBUG_SG=y by allocating a
    device_dma_parameters structure and filling in the max segment size.
    
    Signed-off-by: Wolfram Sang <wsa+renesas@sang-engineering.com>
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4251e64c2287dad32381eee6357860184dc35044
Author: Borislav Petkov <bp@suse.de>
Date:   Fri Oct 5 15:13:07 2018 +0200

    x86/olpc: Fix build error with CONFIG_MFD_CS5535=m
    
    [ Upstream commit fa112cf1e8bc693d5a666b1c479a2859c8b6e0f1 ]
    
    When building a 32-bit config which has the above MFD item as module
    but OLPC_XO1_PM is enabled =y - which is bool, btw - the kernel fails
    building with:
    
      ld: arch/x86/platform/olpc/olpc-xo1-pm.o: in function `xo1_pm_remove':
      /home/boris/kernel/linux/arch/x86/platform/olpc/olpc-xo1-pm.c:159: undefined reference to `mfd_cell_disable'
      ld: arch/x86/platform/olpc/olpc-xo1-pm.o: in function `xo1_pm_probe':
      /home/boris/kernel/linux/arch/x86/platform/olpc/olpc-xo1-pm.c:133: undefined reference to `mfd_cell_enable'
      make: *** [Makefile:1030: vmlinux] Error 1
    
    Force MFD_CS5535 to y if OLPC_XO1_PM is enabled.
    
    Signed-off-by: Borislav Petkov <bp@suse.de>
    Cc: Lubomir Rintel <lkundrak@v3.sk>
    Cc: x86@kernel.org
    Link: http://lkml.kernel.org/r/20181005131750.GA5366@zn.tnic
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 0c43276429a07b1bc7a210b5e782e04dbe454c27
Author: Lianbo Jiang <lijiang@redhat.com>
Date:   Sun Sep 30 11:10:31 2018 +0800

    kexec: Allocate decrypted control pages for kdump if SME is enabled
    
    [ Upstream commit 9cf38d5559e813cccdba8b44c82cc46ba48d0896 ]
    
    When SME is enabled in the first kernel, it needs to allocate decrypted
    pages for kdump because when the kdump kernel boots, these pages need to
    be accessed decrypted in the initial boot stage, before SME is enabled.
    
     [ bp: clean up text. ]
    
    Signed-off-by: Lianbo Jiang <lijiang@redhat.com>
    Signed-off-by: Borislav Petkov <bp@suse.de>
    Reviewed-by: Tom Lendacky <thomas.lendacky@amd.com>
    Cc: kexec@lists.infradead.org
    Cc: tglx@linutronix.de
    Cc: mingo@redhat.com
    Cc: hpa@zytor.com
    Cc: akpm@linux-foundation.org
    Cc: dan.j.williams@intel.com
    Cc: bhelgaas@google.com
    Cc: baiyaowei@cmss.chinamobile.com
    Cc: tiwai@suse.de
    Cc: brijesh.singh@amd.com
    Cc: dyoung@redhat.com
    Cc: bhe@redhat.com
    Cc: jroedel@suse.de
    Link: https://lkml.kernel.org/r/20180930031033.22110-3-lijiang@redhat.com
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d26bd1ce5d3925d1cf9abb2f41f928b29cb77819
Author: Suman Anna <s-anna@ti.com>
Date:   Fri Sep 14 19:37:22 2018 -0500

    remoteproc: Check for NULL firmwares in sysfs interface
    
    [ Upstream commit faeadbb64094757150a8c2a3175ca418dbdd472c ]
    
    The remoteproc framework provides a sysfs file 'firmware'
    for modifying the firmware image name from userspace. Add
    an additional check to ensure NULL firmwares are errored
    out right away, rather than getting a delayed error while
    requesting a firmware during the start of a remoteproc
    later on.
    
    Tested-by: Arnaud Pouliquen <arnaud.pouliquen@st.com>
    Signed-off-by: Suman Anna <s-anna@ti.com>
    Signed-off-by: Bjorn Andersson <bjorn.andersson@linaro.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5611a2b8a713b52d7c4eeddf1844d22d1f863720
Author: Julian Sax <jsbc@gmx.de>
Date:   Fri Oct 5 11:48:31 2018 -0700

    Input: silead - try firmware reload after unsuccessful resume
    
    [ Upstream commit dde27443211062e841806feaf690674b7c3a599f ]
    
    A certain silead controller (Chip ID: 0x56810000) loses its firmware
    after suspend, causing the resume to fail. This patch tries to load
    the firmware, should a resume error occur and retries the resuming.
    
    Signed-off-by: Julian Sax <jsbc@gmx.de>
    Acked-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5e40cfbeaf3b56cabc45be2f28c99a45788a64f1
Author: Martin Kepplinger <martink@posteo.de>
Date:   Fri Oct 5 11:44:45 2018 -0700

    Input: st1232 - set INPUT_PROP_DIRECT property
    
    [ Upstream commit 20bbb312079494a406c10c90932e3c80837c9d94 ]
    
    This is how userspace checks for touchscreen devices most reliably.
    
    Signed-off-by: Martin Kepplinger <martink@posteo.de>
    Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c14493c19528f5cee3e432a5adb53f289fcfd46c
Author: Hans Verkuil <hans.verkuil@cisco.com>
Date:   Fri Oct 5 08:51:45 2018 -0400

    media: cec-gpio: select correct Signal Free Time
    
    [ Upstream commit c439d5c1e13dbf66cff53455432f21d4d0536c51 ]
    
    If a receive is in progress or starts before the transmit has
    a chance, then lower the Signal Free Time of the upcoming transmit
    to no more than CEC_SIGNAL_FREE_TIME_NEW_INITIATOR.
    
    This is per the specification requirements.
    
    Signed-off-by: Hans Verkuil <hans.verkuil@cisco.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit bf4dc7348166a4c2c909b946da5e13652539eecf
Author: Rami Rosen <ramirose@gmail.com>
Date:   Fri Oct 5 00:03:10 2018 +0300

    dmaengine: ioat: fix prototype of ioat_enumerate_channels
    
    [ Upstream commit f4d34aa8c887a8a2d23ef546da0efa10e3f77241 ]
    
    Signed-off-by: Rami Rosen <ramirose@gmail.com>
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d9871d9c527b690b5a78c8a76b3f4f94fa03980d
Author: Olga Kornievskaia <kolga@netapp.com>
Date:   Thu Oct 4 14:45:00 2018 -0400

    NFSv4.x: fix lock recovery during delegation recall
    
    [ Upstream commit 44f411c353bf6d98d5a34f8f1b8605d43b2e50b8 ]
    
    Running "./nfstest_delegation --runtest recall26" uncovers that
    client doesn't recover the lock when we have an appending open,
    where the initial open got a write delegation.
    
    Instead of checking for the passed in open context against
    the file lock's open context. Check that the state is the same.
    
    Signed-off-by: Olga Kornievskaia <kolga@netapp.com>
    Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c371855df52b9601a8db8a69ba96abd185107301
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Mon Oct 1 10:43:47 2018 -0700

    i2c: brcmstb: Allow enabling the driver on DSL SoCs
    
    [ Upstream commit e1eba2ea54a2de0e4c58d87270d25706bb77b844 ]
    
    ARCH_BCM_63XX which is used by ARM-based DSL SoCs from Broadcom uses the
    same controller, make it possible to select the STB driver and update
    the Kconfig and help text a bit.
    
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 71307cd1164c1e99aaf3ad23059debaa4fff2402
Author: Marek Szyprowski <m.szyprowski@samsung.com>
Date:   Tue Oct 2 13:52:10 2018 +0200

    clk: samsung: Use clk_hw API for calling clk framework from clk notifiers
    
    [ Upstream commit 1da220e3a5d22fccda0bc8542997abc1d1741268 ]
    
    clk_notifier_register() documentation states, that the provided notifier
    callbacks associated with the notifier must not re-enter into the clk
    framework by calling any top-level clk APIs. Fix this by replacing
    clk_get_rate() calls with clk_hw_get_rate(), which is safe in this
    context.
    
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Sylwester Nawrocki <snawrocki@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 9cfe234df9ffd03252d84626b8bb29d52e494df0
Author: Joonyoung Shim <jy0922.shim@samsung.com>
Date:   Mon Sep 24 13:00:56 2018 +0200

    clk: samsung: exynos5420: Define CLK_SECKEY gate clock only or Exynos5420
    
    [ Upstream commit d32dd2a1a0f80edad158c9a1ba5f47650d9504a0 ]
    
    The bit of GATE_BUS_PERIS1 for CLK_SECKEY is just reserved on
    exynos5422/5800, not exynos5420. Define gate clk for exynos5420 to
    handle the bit only on exynos5420.
    
    Signed-off-by: Joonyoung Shim <jy0922.shim@samsung.com>
    [m.szyprow: rewrote commit subject]
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Sylwester Nawrocki <snawrocki@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit f39e28ef0b6953db2750caad4bc3a01933fdf516
Author: Sergey Matyukevich <sergey.matyukevich.os@quantenna.com>
Date:   Fri Oct 5 10:11:40 2018 +0000

    qtnfmac: drop error reports for out-of-bounds key indexes
    
    [ Upstream commit 35da3fe63b8647ce3cc52fccdf186a60710815fb ]
    
    On disconnect wireless core attempts to remove all the supported keys.
    Following cfg80211_ops conventions, firmware returns -ENOENT code
    for the out-of-bound key indexes. This is a normal behavior,
    so no need to report errors for this case.
    
    Signed-off-by: Sergey Matyukevich <sergey.matyukevich.os@quantenna.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 565493cd08f876fccc6e857365862ff69a0533d5
Author: Sergey Matyukevich <sergey.matyukevich.os@quantenna.com>
Date:   Fri Oct 5 10:11:36 2018 +0000

    qtnfmac: pass sgi rate info flag to wireless core
    
    [ Upstream commit d5657b709e2a92a0e581109010765d1d485580df ]
    
    SGI should be passed to wireless core as a part of rate structure.
    Otherwise wireless core performs incorrect rate calculation when
    SGI is enabled in hardware but not reported to host.
    
    Signed-off-by: Sergey Matyukevich <sergey.matyukevich.os@quantenna.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a8b87a1ca9da29ffacd9e518d1581f359c9b4cb3
Author: Chung-Hsien Hsu <stanley.hsu@cypress.com>
Date:   Thu Sep 27 14:59:49 2018 +0000

    brcmfmac: fix full timeout waiting for action frame on-channel tx
    
    [ Upstream commit fbf07000960d9c8a13fdc17c6de0230d681c7543 ]
    
    The driver sends an action frame down and waits for a completion signal
    triggered by the received BRCMF_E_ACTION_FRAME_OFF_CHAN_COMPLETE event
    to continue the process. However, the action frame could be transmitted
    either on the current channel or on an off channel. For the on-channel
    case, only BRCMF_E_ACTION_FRAME_COMPLETE event will be received when
    the frame is transmitted, which make the driver always wait a full
    timeout duration. This patch has the completion signal be triggered by
    receiving the BRCMF_E_ACTION_FRAME_COMPLETE event for the on-channel
    case.
    
    This change fixes WFA p2p certification 5.1.19 failure.
    
    Signed-off-by: Chung-Hsien Hsu <stanley.hsu@cypress.com>
    Signed-off-by: Chi-Hsien Lin <chi-hsien.lin@cypress.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 9dc57cbdc1f1ff226ad8cdb2026f88303d623964
Author: Chung-Hsien Hsu <stanley.hsu@cypress.com>
Date:   Thu Sep 27 14:59:44 2018 +0000

    brcmfmac: reduce timeout for action frame scan
    
    [ Upstream commit edb6d6885bef82d1eac432dbeca9fbf4ec349d7e ]
    
    Finding a common channel to send an action frame out is required for
    some action types. Since a loop with several scan retry is used to find
    the channel, a short wait time could be considered for each attempt.
    This patch reduces the wait time from 1500 to 450 msec for each action
    frame scan.
    
    This patch fixes the WFA p2p certification 5.1.20 failure caused by the
    long action frame send time.
    
    Signed-off-by: Chung-Hsien Hsu <stanley.hsu@cypress.com>
    Signed-off-by: Chi-Hsien Lin <chi-hsien.lin@cypress.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 73267b435c31868c61770a8371765e5e552b5174
Author: Borislav Petkov <bp@suse.de>
Date:   Thu Oct 4 19:22:27 2018 +0200

    cpu/SMT: State SMT is disabled even with nosmt and without "=force"
    
    [ Upstream commit d0e7d14455d41163126afecd0fcce935463cc512 ]
    
    When booting with "nosmt=force" a message is issued into dmesg to
    confirm that SMT has been force-disabled but such a message is not
    issued when only "nosmt" is on the kernel command line.
    
    Fix that.
    
    Signed-off-by: Borislav Petkov <bp@suse.de>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Link: http://lkml.kernel.org/r/20181004172227.10094-1-bp@alien8.de
    Signed-off-by: Ingo Molnar <mingo@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 8660ea2737942aebc4299feeffb492f7f09f5812
Author: Ricardo Ribalda Delgado <ricardo.ribalda@gmail.com>
Date:   Thu Oct 4 15:34:45 2018 +0200

    mtd: physmap_of: Release resources on error
    
    [ Upstream commit ef0de747f7ad179c7698a5b0e28db05f18ecbf57 ]
    
    During probe, if there was an error the memory region and the memory
    map were not properly released.This can lead a system unusable if
    deferred probe is in use.
    
    Replace mem_request and map with devm_ioremap_resource
    
    Signed-off-by: Ricardo Ribalda Delgado <ricardo.ribalda@gmail.com>
    Signed-off-by: Boris Brezillon <boris.brezillon@bootlin.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4d5cc2f0b26217522daa623ca84c044ecfe31c17
Author: Johan Hovold <johan@kernel.org>
Date:   Sun Sep 30 18:03:11 2018 +0200

    USB: serial: cypress_m8: fix interrupt-out transfer length
    
    [ Upstream commit 56445eef55cb5904096fed7a73cf87b755dfffc7 ]
    
    Fix interrupt-out transfer length which was being set to the
    transfer-buffer length rather than the size of the outgoing packet.
    
    Note that no slab data was leaked as the whole transfer buffer is always
    cleared before each transfer.
    
    Fixes: 9aa8dae7b1fa ("cypress_m8: use usb_fill_int_urb where appropriate")
    Signed-off-by: Johan Hovold <johan@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 145fd9a5f66212231b4d50153acefee579c187b6
Author: Cameron Kaiser <spectre@floodgap.com>
Date:   Tue Jul 31 07:39:21 2018 -0700

    KVM: PPC: Book3S PR: Exiting split hack mode needs to fixup both PC and LR
    
    [ Upstream commit 1006284c5e411872333967b1970c2ca46a9e225f ]
    
    When an OS (currently only classic Mac OS) is running in KVM-PR and makes a
    linked jump from code with split hack addressing enabled into code that does
    not, LR is not correctly updated and reflects the previously munged PC.
    
    To fix this, this patch undoes the address munge when exiting split
    hack mode so that code relying on LR being a proper address will now
    execute. This does not affect OS X or other operating systems running
    on KVM-PR.
    
    Signed-off-by: Cameron Kaiser <spectre@floodgap.com>
    Signed-off-by: Paul Mackerras <paulus@ozlabs.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 3b37711c9e7f20a79ca9a0c6fa3a9aac6ca17a9a
Author: Michael Pobega <mpobega@neverware.com>
Date:   Thu Oct 4 14:58:21 2018 -0400

    ALSA: hda/sigmatel - Disable automute for Elo VuPoint
    
    [ Upstream commit d153135e93a50cdb6f1b52e238909e9965b56056 ]
    
    The Elo VuPoint 15MX has two headphone jacks of which neither work by
    default. Disabling automute allows ALSA to work normally with the
    speakers & left headphone jack.
    
    Future pin configuration changes may be required in the future to get
    the right headphone jack working in tandem.
    
    Signed-off-by: Michael Pobega <mpobega@neverware.com>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 99730f861962cbc549d271adf29aa6a47d62d0ec
Author: Jacopo Mondi <jacopo+renesas@jmondi.org>
Date:   Mon Sep 17 07:30:54 2018 -0400

    media: i2c: adv748x: Support probing a single output
    
    [ Upstream commit eccf442ce156ec2b4e06b1239d5fdcb0c732f63f ]
    
    Currently the adv748x driver will fail to probe unless both of its
    output endpoints (TXA and TXB) are connected.
    
    Make the driver support probing provided that there is at least one
    input, and one output connected and protect the clean-up function from
    accessing un-initialized fields.
    
    Following patches will fix other uses of un-initialized TXs in the driver,
    such as power management functions.
    
    Tested-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
    Signed-off-by: Jacopo Mondi <jacopo+renesas@jmondi.org>
    Signed-off-by: Kieran Bingham <kieran.bingham+renesas@ideasonboard.com>
    Signed-off-by: Hans Verkuil <hans.verkuil@cisco.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 71e8281e081236a715afefdb92b3ea510d9c3d52
Author: Nathan Chancellor <natechancellor@gmail.com>
Date:   Fri Sep 21 06:00:45 2018 -0400

    media: pxa_camera: Fix check for pdev->dev.of_node
    
    [ Upstream commit 44d7f1a77d8c84f8e42789b5475b74ae0e6d4758 ]
    
    Clang warns that the address of a pointer will always evaluated as true
    in a boolean context.
    
    drivers/media/platform/pxa_camera.c:2400:17: warning: address of
    'pdev->dev.of_node' will always evaluate to 'true'
    [-Wpointer-bool-conversion]
            if (&pdev->dev.of_node && !pcdev->pdata) {
                 ~~~~~~~~~~^~~~~~~ ~~
    1 warning generated.
    
    Judging from the rest of the kernel, it seems like this was an error and
    just the value of of_node should be checked rather than the address.
    
    Reported-by: Nick Desaulniers <ndesaulniers@google.com>
    Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
    Reviewed-by: Nick Desaulniers <ndesaulniers@google.com>
    Signed-off-by: Hans Verkuil <hans.verkuil@cisco.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 86f049f29a2d8d7daa573c51a93d73d7c0f5f4aa
Author: Matthias Reichl <hias@horus.com>
Date:   Tue Aug 28 09:49:42 2018 -0400

    media: rc: ir-rc6-decoder: enable toggle bit for Kathrein RCU-676 remote
    
    [ Upstream commit 85e4af0a7ae2f146769b7475ae531bf8a3f3afb4 ]
    
    The Kathrein RCU-676 remote uses the 32-bit rc6 protocol and toggles
    bit 15 (0x8000) on repeated button presses, like MCE remotes.
    
    Add it's customer code 0x80460000 to the 32-bit rc6 toggle
    handling code to get proper scancodes and toggle reports.
    
    Signed-off-by: Matthias Reichl <hias@horus.com>
    Signed-off-by: Sean Young <sean@mess.org>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit e57ae05d10f8e6e57c94bfcf8e36cb5f105a7ff8
Author: Nathan Chancellor <natechancellor@gmail.com>
Date:   Wed Oct 3 19:37:54 2018 -0700

    ata: ep93xx: Use proper enums for directions
    
    [ Upstream commit 6adde4a36f1b6a562a1057fbb1065007851050e7 ]
    
    Clang warns when one enumerated type is implicitly converted to another.
    
    drivers/ata/pata_ep93xx.c:662:36: warning: implicit conversion from
    enumeration type 'enum dma_data_direction' to different enumeration type
    'enum dma_transfer_direction' [-Wenum-conversion]
            drv_data->dma_rx_data.direction = DMA_FROM_DEVICE;
                                            ~ ^~~~~~~~~~~~~~~
    drivers/ata/pata_ep93xx.c:670:36: warning: implicit conversion from
    enumeration type 'enum dma_data_direction' to different enumeration type
    'enum dma_transfer_direction' [-Wenum-conversion]
            drv_data->dma_tx_data.direction = DMA_TO_DEVICE;
                                            ~ ^~~~~~~~~~~~~
    drivers/ata/pata_ep93xx.c:681:19: warning: implicit conversion from
    enumeration type 'enum dma_data_direction' to different enumeration type
    'enum dma_transfer_direction' [-Wenum-conversion]
            conf.direction = DMA_FROM_DEVICE;
                           ~ ^~~~~~~~~~~~~~~
    drivers/ata/pata_ep93xx.c:692:19: warning: implicit conversion from
    enumeration type 'enum dma_data_direction' to different enumeration type
    'enum dma_transfer_direction' [-Wenum-conversion]
            conf.direction = DMA_TO_DEVICE;
                           ~ ^~~~~~~~~~~~~
    
    Use the equivalent valued enums from the expected type so that Clang no
    longer warns about a conversion.
    
    DMA_TO_DEVICE = DMA_MEM_TO_DEV = 1
    DMA_FROM_DEVICE = DMA_DEV_TO_MEM = 2
    
    Acked-by: Bartlomiej Zolnierkiewicz <b.zolnierkie@samsung.com>
    Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 991d57ecd8bc0db05186a4ecb2341748b1b7e97e
Author: Anton Blanchard <anton@ozlabs.org>
Date:   Tue Oct 2 09:01:04 2018 +1000

    powerpc/time: Use clockevents_register_device(), fixing an issue with large decrementer
    
    [ Upstream commit 8b78fdb045de60a4eb35460092bbd3cffa925353 ]
    
    We currently cap the decrementer clockevent at 4 seconds, even on systems
    with large decrementer support. Fix this by converting the code to use
    clockevents_register_device() which calculates the upper bound based on
    the max_delta passed in.
    
    Signed-off-by: Anton Blanchard <anton@ozlabs.org>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b0cf701d8713986a354bd43f8f85808a65f2957c
Author: Bob Moore <robert.moore@intel.com>
Date:   Wed Oct 3 11:45:38 2018 -0700

    ACPICA: Never run _REG on system_memory and system_IO
    
    [ Upstream commit 8b1cafdcb4b75c5027c52f1e82b47ebe727ad7ed ]
    
    These address spaces are defined by the ACPI spec to be
    "always available", and thus _REG should never be run on them.
    Provides compatibility with other ACPI implementations.
    
    Signed-off-by: Bob Moore <robert.moore@intel.com>
    Signed-off-by: Erik Schmauss <erik.schmauss@intel.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit df0fa028d4f79fe4a7790f03d4461ccfcf3763be
Author: Nathan Chancellor <natechancellor@gmail.com>
Date:   Mon Sep 24 12:57:16 2018 -0700

    IB/mlx4: Avoid implicit enumerated type conversion
    
    [ Upstream commit b56511c15713ba6c7572e77a41f7ddba9c1053ec ]
    
    Clang warns when one enumerated type is implicitly converted to another.
    
    drivers/infiniband/hw/mlx4/mad.c:1811:41: warning: implicit conversion
    from enumeration type 'enum mlx4_ib_qp_flags' to different enumeration
    type 'enum ib_qp_create_flags' [-Wenum-conversion]
                    qp_init_attr.init_attr.create_flags = MLX4_IB_SRIOV_TUNNEL_QP;
                                                        ~ ^~~~~~~~~~~~~~~~~~~~~~~
    
    drivers/infiniband/hw/mlx4/mad.c:1819:41: warning: implicit conversion
    from enumeration type 'enum mlx4_ib_qp_flags' to different enumeration
    type 'enum ib_qp_create_flags' [-Wenum-conversion]
                    qp_init_attr.init_attr.create_flags = MLX4_IB_SRIOV_SQP;
                                                        ~ ^~~~~~~~~~~~~~~~~
    
    The type mlx4_ib_qp_flags explicitly provides supplemental values to the
    type ib_qp_create_flags. Make that clear to Clang by changing the
    create_flags type to u32.
    
    Reported-by: Nick Desaulniers <ndesaulniers@google.com>
    Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit de4f2ad656dbc84e897d959f6076e73c145850d8
Author: Wei Yongjun <weiyongjun1@huawei.com>
Date:   Sat Sep 29 03:55:16 2018 +0000

    IB/mthca: Fix error return code in __mthca_init_one()
    
    [ Upstream commit 39f2495618c5e980d2873ea3f2d1877dd253e07a ]
    
    Fix to return a negative error code from the mthca_cmd_init() error
    handling case instead of 0, as done elsewhere in this function.
    
    Fixes: 80fd8238734c ("[PATCH] IB/mthca: Encapsulate command interface init")
    Signed-off-by: Wei Yongjun <weiyongjun1@huawei.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 2778c84d3754966ee3da5f1eef8a4717fbfface2
Author: Radoslaw Tyl <radoslawx.tyl@intel.com>
Date:   Mon Sep 24 09:24:20 2018 +0200

    ixgbe: Fix crash with VFs and flow director on interface flap
    
    [ Upstream commit 5d826d209164b0752c883607be4cdbbcf7cab494 ]
    
    This patch fix crash when we have restore flow director filters after reset
    adapter. In ixgbe_fdir_filter_restore() filter->action is outside of the
    rx_ring array, as it has a VF identifier in the upper 32 bits.
    
    Signed-off-by: Radoslaw Tyl <radoslawx.tyl@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 01b71317fedfbf6a6c56a77713e3ba28b1c13e00
Author: Nathan Chancellor <natechancellor@gmail.com>
Date:   Fri Sep 21 03:13:59 2018 -0700

    i40e: Use proper enum in i40e_ndo_set_vf_link_state
    
    [ Upstream commit 43ade6ad18416b8fd5bb3c9e9789faa666527eec ]
    
    Clang warns when one enumerated type is converted implicitly to another.
    
    drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c:4214:42: warning:
    implicit conversion from enumeration type 'enum i40e_aq_link_speed' to
    different enumeration type 'enum virtchnl_link_speed'
          [-Wenum-conversion]
                    pfe.event_data.link_event.link_speed = I40E_LINK_SPEED_40GB;
                                                         ~ ^~~~~~~~~~~~~~~~~~~~
    1 warning generated.
    
    Use the proper enum from virtchnl_link_speed, which has the same value
    as I40E_LINK_SPEED_40GB, VIRTCHNL_LINK_SPEED_40GB. This appears to be
    missed by commit ff3f4cc267f6 ("virtchnl: finish conversion to virtchnl
    interface").
    
    Link: https://github.com/ClangBuiltLinux/linux/issues/81
    Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 1b262d5d5ab87a24fdad8c4ad30f23f79d1bc720
Author: Radoslaw Tyl <radoslawx.tyl@intel.com>
Date:   Wed Sep 5 09:00:51 2018 +0200

    ixgbe: Fix ixgbe TX hangs with XDP_TX beyond queue limit
    
    [ Upstream commit 8d7179b1e2d64b3493c0114916486fe92e6109a9 ]
    
    We have Tx hang when number Tx and XDP queues are more than 64.
    In XDP always is MTQC == 0x0 (64TxQs). We need more space for Tx queues.
    
    Signed-off-by: Radoslaw Tyl <radoslawx.tyl@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b6ba15616007f9fe0b10eb6e8f0a9ac014e68a6f
Author: NeilBrown <neilb@suse.com>
Date:   Wed Oct 3 15:04:41 2018 +1000

    md: allow metadata updates while suspending an array - fix
    
    [ Upstream commit 059421e041eb461fb2b3e81c9adaec18ef03ca3c ]
    
    Commit 35bfc52187f6 ("md: allow metadata update while suspending.")
    added support for allowing md_check_recovery() to still perform
    metadata updates while the array is entering the 'suspended' state.
    This is needed to allow the processes of entering the state to
    complete.
    
    Unfortunately, the patch doesn't really work.  The test for
    "mddev->suspended" at the start of md_check_recovery() means that the
    function doesn't try to do anything at all while entering suspend.
    
    This patch moves the code of updating the metadata while suspending to
    *before* the test on mddev->suspended.
    
    Reported-by: Jeff Mahoney <jeffm@suse.com>
    Fixes: 35bfc52187f6 ("md: allow metadata update while suspending.")
    Signed-off-by: NeilBrown <neilb@suse.com>
    Signed-off-by: Shaohua Li <shli@fb.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 2f41366258fde1ba0b7822e4b841206ff26d9236
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Mon Sep 10 23:22:16 2018 +0300

    clocksource/drivers/sh_cmt: Fix clocksource width for 32-bit machines
    
    [ Upstream commit 37e7742c55ba856eaec7e35673ee370f36eb17f3 ]
    
    The driver seems to abuse *unsigned long* not only for the (32-bit)
    register values but also for the 'sh_cmt_channel::total_cycles' which
    needs to always be 64-bit -- as a result, the clocksource's mask is
    needlessly clamped down to 32-bits on the 32-bit machines...
    
    Fixes: 19bdc9d061bc ("clocksource: sh_cmt clocksource support")
    Reported-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Reviewed-by: Simon Horman <horms+renesas@verge.net.au>
    Reviewed-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Signed-off-by: Daniel Lezcano <daniel.lezcano@linaro.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a2667a032c6207c9d058678d4f5f8422e20603aa
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Sat Sep 8 23:54:05 2018 +0300

    clocksource/drivers/sh_cmt: Fixup for 64-bit machines
    
    [ Upstream commit 22627c6f3ed3d9d0df13eec3c831b08f8186c38e ]
    
    When trying to use CMT for clockevents on R-Car gen3 SoCs, I noticed
    that 'max_delta_ns' for the broadcast timer (CMT) was shown as 1000 in
    /proc/timer_list. It turned out that when calculating it, the driver did
    1 << 32 (causing what I think was undefined behavior) resulting in a zero
    delta, later clamped to 1000 by cev_delta2ns(). The root cause turned out
    to be that the driver abused *unsigned long* for the CMT register values
    (which are 16/32-bit), so that the calculation of 'ch->max_match_value'
    in sh_cmt_setup_channel() used the wrong branch. Using more proper 'u32'
    instead fixed 'max_delta_ns' and even fixed the switching an active
    clocksource to CMT (which caused the system to turn non-interactive
    before).
    
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Reviewed-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Signed-off-by: Daniel Lezcano <daniel.lezcano@linaro.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c0b2af64f99e6f548121aaeac172211968f5b1eb
Author: Gustavo Pimentel <gustavo.pimentel@synopsys.com>
Date:   Thu Aug 23 13:34:53 2018 +0200

    tools: PCI: Fix compilation warnings
    
    [ Upstream commit fef31ecaaf2c5c54db85b35e893bf8abec96b93f ]
    
    Current compilation produces the following warnings:
    
    tools/pci/pcitest.c: In function 'run_test':
    tools/pci/pcitest.c:56:9: warning: unused variable 'time'
    [-Wunused-variable]
      double time;
             ^~~~
    tools/pci/pcitest.c:55:25: warning: unused variable 'end'
    [-Wunused-variable]
      struct timespec start, end;
                             ^~~
    tools/pci/pcitest.c:55:18: warning: unused variable 'start'
    [-Wunused-variable]
      struct timespec start, end;
                      ^~~~~
    tools/pci/pcitest.c:146:1: warning: control reaches end of non-void
    function [-Wreturn-type]
     }
     ^
    
    Fix them:
     - remove unused variables
     - change function return from int to void, since it's not used
    
    Signed-off-by: Gustavo Pimentel <gustavo.pimentel@synopsys.com>
    [lorenzo.pieralisi@arm.com: rewrote the commit log]
    Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
    Reviewed-by: Kishon Vijay Abraham I <kishon@ti.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 7896a8171e18b1a738d710d69490f748202270b7
Author: Chen Yu <yu.c.chen@intel.com>
Date:   Fri Sep 21 14:26:38 2018 +0800

    PM / hibernate: Check the success of generating md5 digest before hibernation
    
    [ Upstream commit 749fa17093ff67b31dea864531a3698b6a95c26c ]
    
    Currently if get_e820_md5() fails, then it will hibernate nevertheless.
    Actually the error code should be propagated to upper caller so that
    the hibernation could be aware of the result and terminates the process
    if md5 digest fails.
    
    Suggested-by: Thomas Gleixner <tglx@linutronix.de>
    Acked-by: Pavel Machek <pavel@ucw.cz>
    Signed-off-by: Chen Yu <yu.c.chen@intel.com>
    Acked-by: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 191cda60bf0877656e77608650c7294bae2594e4
Author: Nathan Chancellor <natechancellor@gmail.com>
Date:   Thu Sep 20 16:30:25 2018 -0700

    mtd: rawnand: sh_flctl: Use proper enum for flctl_dma_fifo0_transfer
    
    [ Upstream commit e2bfa4ca23d9b5a7bdfcf21319fad9b59e38a05c ]
    
    Clang warns when one enumerated type is converted implicitly to another:
    
    drivers/mtd/nand/raw/sh_flctl.c:483:46: warning: implicit conversion
    from enumeration type 'enum dma_transfer_direction' to different
    enumeration type 'enum dma_data_direction' [-Wenum-conversion]
                    flctl_dma_fifo0_transfer(flctl, buf, rlen, DMA_DEV_TO_MEM) > 0)
                    ~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~
    drivers/mtd/nand/raw/sh_flctl.c:542:46: warning: implicit conversion
    from enumeration type 'enum dma_transfer_direction' to different
    enumeration type 'enum dma_data_direction' [-Wenum-conversion]
                    flctl_dma_fifo0_transfer(flctl, buf, rlen, DMA_MEM_TO_DEV) > 0)
                    ~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~
    2 warnings generated.
    
    Use the proper enums from dma_data_direction to satisfy Clang.
    
    DMA_MEM_TO_DEV = DMA_TO_DEVICE = 1
    DMA_DEV_TO_MEM = DMA_FROM_DEVICE = 2
    
    Reported-by: Nick Desaulniers <ndesaulniers@google.com>
    Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
    Reviewed-by: Nick Desaulniers <ndesaulniers@google.com>
    Signed-off-by: Miquel Raynal <miquel.raynal@bootlin.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 3578651713e5d4e620ebff7671da1fd2cc692a4f
Author: Tudor Ambarus <tudor.ambarus@microchip.com>
Date:   Tue Oct 2 16:00:36 2018 +0300

    ARM: dts: at91: at91sam9x5cm: fix addressable nand flash size
    
    [ Upstream commit 6f270d88a0c4a11725afd8fd2001ae408733afbf ]
    
    at91sam9x5cm comes with a 2Gb NAND flash. Fix the rootfs size to
    match this limit.
    
    Signed-off-by: Tudor Ambarus <tudor.ambarus@microchip.com>
    Signed-off-by: Ludovic Desroches <ludovic.desroches@microchip.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit e041a6e677394d64edb09b6340a8f3b33c476ca7
Author: Tudor Ambarus <tudor.ambarus@microchip.com>
Date:   Tue Oct 2 16:00:35 2018 +0300

    ARM: dts: at91: sama5d4_xplained: fix addressable nand flash size
    
    [ Upstream commit df90fc64367ffdb6f1b5c0f0c4940d44832b0174 ]
    
    sama5d4_xplained comes with a 4Gb NAND flash. Increase the rootfs
    size to match this limit.
    
    Signed-off-by: Tudor Ambarus <tudor.ambarus@microchip.com>
    Signed-off-by: Ludovic Desroches <ludovic.desroches@microchip.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 41a4901469907cc6b75b492152798077e3170e89
Author: zhong jiang <zhongjiang@huawei.com>
Date:   Wed Sep 26 20:09:32 2018 +0800

    powerpc/xive: Move a dereference below a NULL test
    
    [ Upstream commit cd5ff94577e004e0a4457e70d0ef3a030f4010b8 ]
    
    Move the dereference of xc below the NULL test.
    
    Signed-off-by: zhong jiang <zhongjiang@huawei.com>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5c07e4774cf83ae0ad403c3221d78110d4e7eaf8
Author: Naveen N. Rao <naveen.n.rao@linux.vnet.ibm.com>
Date:   Thu Sep 27 13:40:58 2018 +0530

    powerpc/pseries: Fix how we iterate over the DTL entries
    
    [ Upstream commit 9258227e9dd1da8feddb07ad9702845546a581c9 ]
    
    When CONFIG_VIRT_CPU_ACCOUNTING_NATIVE is not set, we look up dtl_idx in
    the lppaca to determine the number of entries in the buffer. Since
    lppaca is in big endian, we need to do an endian conversion before using
    this in our calculation to determine the number of entries in the
    buffer. Without this, we do not iterate over the existing entries in the
    DTL buffer properly.
    
    Fixes: 7c105b63bd98 ("powerpc: Add CONFIG_CPU_LITTLE_ENDIAN kernel config option.")
    Signed-off-by: Naveen N. Rao <naveen.n.rao@linux.vnet.ibm.com>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4d1af1c64fb83053212775be4ca0abaa6b2788e8
Author: Naveen N. Rao <naveen.n.rao@linux.vnet.ibm.com>
Date:   Thu Sep 27 13:40:57 2018 +0530

    powerpc/pseries: Fix DTL buffer registration
    
    [ Upstream commit db787af1b8a6b4be428ee2ea7d409dafcaa4a43c ]
    
    When CONFIG_VIRT_CPU_ACCOUNTING_NATIVE is not set, we register the DTL
    buffer for a cpu when the associated file under powerpc/dtl in debugfs
    is opened. When doing so, we need to set the size of the buffer being
    registered in the second u32 word of the buffer. This needs to be in big
    endian, but we are not doing the conversion resulting in the below error
    showing up in dmesg:
    
            dtl_start: DTL registration for cpu 0 (hw 0) failed with -4
    
    Fix this in the obvious manner.
    
    Fixes: 7c105b63bd98 ("powerpc: Add CONFIG_CPU_LITTLE_ENDIAN kernel config option.")
    Signed-off-by: Naveen N. Rao <naveen.n.rao@linux.vnet.ibm.com>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 2781da76bd354fc8e9d31cec3ad3a0a017361f4e
Author: Nathan Chancellor <natechancellor@gmail.com>
Date:   Sun Sep 30 20:47:38 2018 -0700

    cxgb4: Use proper enum in IEEE_FAUX_SYNC
    
    [ Upstream commit 258b6d141878530ba1f8fc44db683822389de914 ]
    
    Clang warns when one enumerated type is implicitly converted to another.
    
    drivers/net/ethernet/chelsio/cxgb4/cxgb4_dcb.c:390:4: warning: implicit
    conversion from enumeration type 'enum cxgb4_dcb_state' to different
    enumeration type 'enum cxgb4_dcb_state_input' [-Wenum-conversion]
                            IEEE_FAUX_SYNC(dev, dcb);
                            ^~~~~~~~~~~~~~~~~~~~~~~~
    drivers/net/ethernet/chelsio/cxgb4/cxgb4_dcb.h:70:10: note: expanded
    from macro 'IEEE_FAUX_SYNC'
                                                CXGB4_DCB_STATE_FW_ALLSYNCED);
                                                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~
    
    Use the equivalent value of the expected type to silence Clang while
    resulting in no functional change.
    
    CXGB4_DCB_STATE_FW_ALLSYNCED = CXGB4_DCB_INPUT_FW_ALLSYNCED = 3
    
    Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
    Reviewed-by: Nick Desaulniers <ndesaulniers@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 30069fcd345543d4717f48d9c0f87a6ce942e032
Author: Nathan Chancellor <natechancellor@gmail.com>
Date:   Sun Sep 30 20:51:43 2018 -0700

    cxgb4: Use proper enum in cxgb4_dcb_handle_fw_update
    
    [ Upstream commit 3b0b8f0d9a259f6a428af63e7a77547325f8e081 ]
    
    Clang warns when one enumerated type is implicitly converted to another.
    
    drivers/net/ethernet/chelsio/cxgb4/cxgb4_dcb.c:303:7: warning: implicit
    conversion from enumeration type 'enum cxgb4_dcb_state' to different
    enumeration type 'enum cxgb4_dcb_state_input' [-Wenum-conversion]
                             ? CXGB4_DCB_STATE_FW_ALLSYNCED
                               ^~~~~~~~~~~~~~~~~~~~~~~~~~~~
    drivers/net/ethernet/chelsio/cxgb4/cxgb4_dcb.c:304:7: warning: implicit
    conversion from enumeration type 'enum cxgb4_dcb_state' to different
    enumeration type 'enum cxgb4_dcb_state_input' [-Wenum-conversion]
                             : CXGB4_DCB_STATE_FW_INCOMPLETE);
                               ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    2 warnings generated.
    
    Use the equivalent value of the expected type to silence Clang while
    resulting in no functional change.
    
    CXGB4_DCB_STATE_FW_INCOMPLETE = CXGB4_DCB_INPUT_FW_INCOMPLETE = 2
    CXGB4_DCB_STATE_FW_ALLSYNCED = CXGB4_DCB_INPUT_FW_ALLSYNCED = 3
    
    Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
    Reviewed-by: Nick Desaulniers <ndesaulniers@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 36be9cd26716a923275e47c8912b28449d63fb1f
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Mon Oct 1 19:44:41 2018 +0300

    mei: samples: fix a signedness bug in amt_host_if_call()
    
    [ Upstream commit 185647813cac080453cb73a2e034a8821049f2a7 ]
    
    "out_buf_sz" needs to be signed for the error handling to work.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 711b32942cea36da666624977eeebd1aea2bcd7d
Author: Chuck Lever <chuck.lever@oracle.com>
Date:   Mon Oct 1 14:25:36 2018 -0400

    sunrpc: Fix connect metrics
    
    [ Upstream commit 3968a8a5310404c2f0b9e4d9f28cab13a12bc4fd ]
    
    For TCP, the logic in xprt_connect_status is currently never invoked
    to record a successful connection. Commit 2a4919919a97 ("SUNRPC:
    Return EAGAIN instead of ENOTCONN when waking up xprt->pending")
    changed the way TCP xprt's are awoken after a connect succeeds.
    
    Instead, change connection-oriented transports to bump connect_count
    and compute connect_time the moment that XPRT_CONNECTED is set.
    
    Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
    Signed-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 4bec32f211ff4a6269a35089559fab2559ce7602
Author: Nishanth Menon <nm@ti.com>
Date:   Mon Aug 27 19:50:56 2018 -0500

    clk: keystone: Enable TISCI clocks if K3_ARCH
    
    [ Upstream commit 2f149e6e14bcb5e581e49307b54aafcd6f74a74f ]
    
    K3_ARCH uses TISCI for clocks as well. Enable the same
    for the driver support.
    
    Signed-off-by: Nishanth Menon <nm@ti.com>
    Acked-by: Santosh Shilimkar <ssantosh@kernel.org>
    Signed-off-by: Stephen Boyd <sboyd@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 3610daee861f4b4a2758fc7087c53b5842c34f6e
Author: Gabriel Krisman Bertazi <krisman@collabora.co.uk>
Date:   Tue Oct 2 12:43:51 2018 -0400

    ext4: fix build error when DX_DEBUG is defined
    
    [ Upstream commit 799578ab16e86b074c184ec5abbda0bc698c7b0b ]
    
    Enabling DX_DEBUG triggers the build error below.  info is an attribute
    of  the dxroot structure.
    
    linux/fs/ext4/namei.c:2264:12: error: ‘info’
    undeclared (first use in this function); did you mean ‘insl’?
                      info->indirect_levels));
    
    Fixes: e08ac99fa2a2 ("ext4: add largedir feature")
    Signed-off-by: Gabriel Krisman Bertazi <krisman@collabora.co.uk>
    Signed-off-by: Theodore Ts'o <tytso@mit.edu>
    Reviewed-by: Lukas Czerner <lczerner@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b9ca94b6fc778a58356e00784b96aec4338569be
Author: Nathan Chancellor <natechancellor@gmail.com>
Date:   Tue Sep 11 16:20:25 2018 -0700

    dmaengine: timb_dma: Use proper enum in td_prep_slave_sg
    
    [ Upstream commit 5e621f5d538985f010035c6f3e28c22829d36db1 ]
    
    Clang warns when implicitly converting from one enumerated type to
    another. Avoid this by using the equivalent value from the expected
    type.
    
    drivers/dma/timb_dma.c:548:27: warning: implicit conversion from
    enumeration type 'enum dma_transfer_direction' to different enumeration
    type 'enum dma_data_direction' [-Wenum-conversion]
                    td_desc->desc_list_len, DMA_MEM_TO_DEV);
                                            ^~~~~~~~~~~~~~
    1 warning generated.
    
    Reported-by: Nick Desaulniers <ndesaulniers@google.com>
    Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
    Reviewed-by: Nick Desaulniers <ndesaulniers@google.com>
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 3794a32dbc6cf86d3cfcb697662a5054960f3176
Author: Nathan Chancellor <natechancellor@gmail.com>
Date:   Tue Sep 11 16:40:20 2018 -0700

    dmaengine: ep93xx: Return proper enum in ep93xx_dma_chan_direction
    
    [ Upstream commit 9524d6b265f9b2b9a61fceb2ee2ce1c2a83e39ca ]
    
    Clang warns when implicitly converting from one enumerated type to
    another. Avoid this by using the equivalent value from the expected
    type.
    
    In file included from drivers/dma/ep93xx_dma.c:30:
    ./include/linux/platform_data/dma-ep93xx.h:88:10: warning: implicit
    conversion from enumeration type 'enum dma_data_direction' to different
    enumeration type 'enum dma_transfer_direction' [-Wenum-conversion]
                    return DMA_NONE;
                    ~~~~~~ ^~~~~~~~
    1 warning generated.
    
    Reported-by: Nick Desaulniers <ndesaulniers@google.com>
    Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
    Reviewed-by: Nick Desaulniers <ndesaulniers@google.com>
    Signed-off-by: Vinod Koul <vkoul@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 67697026c0dec36e6bd09e26838724ddc8af3c0e
Author: Alexey Kardashevskiy <aik@ozlabs.ru>
Date:   Mon Sep 10 18:29:09 2018 +1000

    KVM: PPC: Inform the userspace about TCE update failures
    
    [ Upstream commit f7960e299f13f069d6f3d4e157d91bfca2669677 ]
    
    We return H_TOO_HARD from TCE update handlers when we think that
    the next handler (realmode -> virtual mode -> user mode) has a chance to
    handle the request; H_HARDWARE/H_CLOSED otherwise.
    
    This changes the handlers to return H_TOO_HARD on every error giving
    the userspace an opportunity to handle any request or at least log
    them all.
    
    Signed-off-by: Alexey Kardashevskiy <aik@ozlabs.ru>
    Reviewed-by: David Gibson <david@gibson.dropbear.id.au>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b14bef1238754ec0ff46ac682cad26c3b04a64b7
Author: Guenter Roeck <linux@roeck-us.net>
Date:   Sun Sep 23 06:54:11 2018 -0700

    watchdog: w83627hf_wdt: Support NCT6796D, NCT6797D, NCT6798D
    
    [ Upstream commit 57cbf0e3a0fd48e5ad8f3884562e8dde4827c1c8 ]
    
    The watchdog controller on NCT6796D, NCT6797D, and NCT6798D is compatible
    with the wtachdog controller on other Nuvoton chips.
    
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Reviewed-by: Wim Van Sebroeck <wim@linux-watchdog.org>
    Signed-off-by: Wim Van Sebroeck <wim@linux-watchdog.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c642963035a94af894402d998b58983b13d1f2c0
Author: Miquel Raynal <miquel.raynal@bootlin.com>
Date:   Mon Oct 1 16:13:47 2018 +0200

    irqchip/irq-mvebu-icu: Fix wrong private data retrieval
    
    [ Upstream commit 2b4dab69dcca13c5be2ddaf1337ae4accd087de6 ]
    
    The irq_domain structure has an host_data pointer that just stores
    private data. It is meant to not be touched by the IRQ core. However,
    when it comes to MSI, the MSI layer adds its own private data there
    with a structure that also has a host_data pointer.
    
    Because this IRQ domain is an MSI domain, to access private data we
    should do a d->host_data->host_data, also wrapped as
    'platform_msi_get_host_data()'.
    
    This bug was lying there silently because the 'icu' structure retrieved
    this way was just called by dev_err(), only producing a
    '(NULL device *):' output on the console.
    
    Reviewed-by: Thomas Petazzoni <thomas.petazzoni@bootlin.com>
    Signed-off-by: Miquel Raynal <miquel.raynal@bootlin.com>
    Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a6ee16520c0a16916f9514211518c0972b05edaf
Author: Andrew Zaborowski <andrew.zaborowski@intel.com>
Date:   Mon Sep 24 18:10:22 2018 +0200

    nl80211: Fix a GET_KEY reply attribute
    
    [ Upstream commit efdfce7270de85a8706d1ea051bef3a7486809ff ]
    
    Use the NL80211_KEY_IDX attribute inside the NL80211_ATTR_KEY in
    NL80211_CMD_GET_KEY responses to comply with nl80211_key_policy.
    This is unlikely to affect existing userspace.
    
    Signed-off-by: Andrew Zaborowski <andrew.zaborowski@intel.com>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit cd51659e864b2c9e8d844f9ddde6b84df39da856
Author: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Date:   Tue Sep 11 12:42:05 2018 -0700

    usb: dwc3: gadget: Check ENBLSLPM before sending ep command
    
    [ Upstream commit 87dd96111b0bb8e616fcbd74dbf4bb4182f2c596 ]
    
    When operating in USB 2.0 speeds (HS/FS), if GUSB2PHYCFG.ENBLSLPM or
    GUSB2PHYCFG.SUSPHY is set, it must be cleared before issuing an endpoint
    command.
    
    Current implementation only save and restore GUSB2PHYCFG.SUSPHY
    configuration. We must save and clear both GUSB2PHYCFG.ENBLSLPM and
    GUSB2PHYCFG.SUSPHY settings. Restore them after the command is
    completed.
    
    DWC_usb3 3.30a and DWC_usb31 1.90a programming guide section 3.2.2
    
    Signed-off-by: Thinh Nguyen <thinhn@synopsys.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5e57274c63b332cf3a73277db7fc48ada598c2df
Author: Jia-Ju Bai <baijiaju1990@gmail.com>
Date:   Sat Sep 15 11:04:40 2018 +0800

    usb: gadget: udc: fotg210-udc: Fix a sleep-in-atomic-context bug in fotg210_get_status()
    
    [ Upstream commit 2337a77c1cc86bc4e504ecf3799f947659c86026 ]
    
    The driver may sleep in an interrupt handler.
    The function call path (from bottom to top) in Linux-4.17 is:
    
    [FUNC] fotg210_ep_queue(GFP_KERNEL)
    drivers/usb/gadget/udc/fotg210-udc.c, 744:
            fotg210_ep_queue in fotg210_get_status
    drivers/usb/gadget/udc/fotg210-udc.c, 768:
            fotg210_get_status in fotg210_setup_packet
    drivers/usb/gadget/udc/fotg210-udc.c, 949:
            fotg210_setup_packet in fotg210_irq (interrupt handler)
    
    To fix this bug, GFP_KERNEL is replaced with GFP_ATOMIC.
    If possible, spin_unlock() and spin_lock() around fotg210_ep_queue()
    can be also removed.
    
    This bug is found by my static analysis tool DSAC.
    
    Signed-off-by: Jia-Ju Bai <baijiaju1990@gmail.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 78e2b71efdb2eecf216fdc40ea55d6d1a8716169
Author: Simon Wunderlich <sw@simonwunderlich.de>
Date:   Mon Oct 1 17:26:59 2018 +0300

    ath9k: fix reporting calculated new FFT upper max
    
    [ Upstream commit 4fb5837ac2bd46a85620b297002c704e9958f64d ]
    
    Since the debug print code is outside of the loop, it shouldn't use the loop
    iterator anymore but instead print the found maximum index.
    
    Cc: Nick Kossifidis <mickflemm@gmail.com>
    Signed-off-by: Simon Wunderlich <sw@simonwunderlich.de>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 7ce00c576f5ec4319083e66aef6befdea23a61b1
Author: Florian Fainelli <f.fainelli@gmail.com>
Date:   Mon Oct 1 10:33:02 2018 -0700

    ata: ahci_brcm: Allow using driver or DSL SoCs
    
    [ Upstream commit 7fb44929cb0e5cdcde143e1ca3ca57b5b8247db0 ]
    
    The Broadcom STB AHCI controller is the same as the one found on DSL
    SoCs, so we will utilize the same driver on these systems as well.
    
    Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 1ab0274c2eec3c74edbe4603fb00db07ae72bd02
Author: Ben Greear <greearb@candelatech.com>
Date:   Thu Sep 6 19:46:20 2018 +0300

    ath10k: fix vdev-start timeout on error
    
    [ Upstream commit 833fd34d743c728afe6d127ef7bee67e7d9199a8 ]
    
    The vdev-start-response message should cause the
    completion to fire, even in the error case.  Otherwise,
    the user still gets no useful information and everything
    is blocked until the timeout period.
    
    Add some warning text to print out the invalid status
    code to aid debugging, and propagate failure code.
    
    Signed-off-by: Ben Greear <greearb@candelatech.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit dc4d24291c4a0a203702fba27c289805ae19b0d0
Author: Anshuman Khandual <anshuman.khandual@arm.com>
Date:   Sat Sep 22 21:09:55 2018 +0530

    arm64/numa: Report correct memblock range for the dummy node
    
    [ Upstream commit 77cfe950901e5c13aca2df6437a05f39dd9a929b ]
    
    The dummy node ID is marked into all memory ranges on the system. So the
    dummy node really extends the entire memblock.memory. Hence report correct
    extent information for the dummy node using memblock range helper functions
    instead of the range [0LLU, PFN_PHYS(max_pfn) - 1)].
    
    Fixes: 1a2db30034 ("arm64, numa: Add NUMA support for arm64 platforms")
    Acked-by: Punit Agrawal <punit.agrawal@arm.com>
    Signed-off-by: Anshuman Khandual <anshuman.khandual@arm.com>
    Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c1997d7041c75a82502cbd895f223e532bccc931
Author: Suzuki K Poulose <suzuki.poulose@arm.com>
Date:   Wed Sep 26 17:32:37 2018 +0100

    kvm: arm/arm64: Fix stage2_flush_memslot for 4 level page table
    
    [ Upstream commit d2db7773ba864df6b4e19643dfc54838550d8049 ]
    
    So far we have only supported 3 level page table with fixed IPA of
    40bits, where PUD is folded. With 4 level page tables, we need
    to check if the PUD entry is valid or not. Fix stage2_flush_memslot()
    to do this check, before walking down the table.
    
    Acked-by: Christoffer Dall <cdall@kernel.org>
    Acked-by: Marc Zyngier <marc.zyngier@arm.com>
    Reviewed-by: Eric Auger <eric.auger@redhat.com>
    Signed-off-by: Suzuki K Poulose <suzuki.poulose@arm.com>
    Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 1a41082b01127d33048446f8b82beb32c7bdf580
Author: Robin Murphy <robin.murphy@arm.com>
Date:   Thu Sep 6 17:59:50 2018 +0100

    iommu/io-pgtable-arm: Fix race handling in split_blk_unmap()
    
    [ Upstream commit 85c7a0f1ef624ef58173ef52ea77780257bdfe04 ]
    
    In removing the pagetable-wide lock, we gained the possibility of the
    vanishingly unlikely case where we have a race between two concurrent
    unmappers splitting the same block entry. The logic to handle this is
    fairly straightforward - whoever loses the race frees their partial
    next-level table and instead dereferences the winner's newly-installed
    entry in order to fall back to a regular unmap, which intentionally
    echoes the pre-existing case of recursively splitting a 1GB block down
    to 4KB pages by installing a full table of 2MB blocks first.
    
    Unfortunately, the chump who implemented that logic failed to update the
    condition check for that fallback, meaning that if said race occurs at
    the last level (where the loser's unmap_idx is valid) then the unmap
    won't actually happen. Fix that to properly account for both the race
    and recursive cases.
    
    Fixes: 2c3d273eabe8 ("iommu/io-pgtable-arm: Support lockless operation")
    Signed-off-by: Robin Murphy <robin.murphy@arm.com>
    [will: re-jig control flow to avoid duplicate cmpxchg test]
    Signed-off-by: Will Deacon <will.deacon@arm.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 73289863ed4adb2afdac324be6efae8459305a8d
Author: Dennis Dalessandro <dennis.dalessandro@intel.com>
Date:   Wed Sep 26 10:55:53 2018 -0700

    IB/hfi1: Ensure ucast_dlid access doesnt exceed bounds
    
    [ Upstream commit 3144533bf667c8e53bb20656b78295960073e57b ]
    
    The dlid assignment made by looking into the u_ucast_dlid array does not
    do an explicit check for the size of the array. The code path to arrive at
    def_port, the index value is long and complicated so its best to just have
    an explicit check here.
    
    Signed-off-by: Dennis Dalessandro <dennis.dalessandro@intel.com>
    Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 5320b434be4bd94b04b535f46087f4db140fb8e5
Author: Trond Myklebust <trond.myklebust@hammerspace.com>
Date:   Sat Sep 8 22:09:48 2018 -0400

    SUNRPC: Fix priority queue fairness
    
    [ Upstream commit f42f7c283078ce3c1e8368b140e270755b1ae313 ]
    
    Fix up the priority queue to not batch by owner, but by queue, so that
    we allow '1 << priority' elements to be dequeued before switching to
    the next priority queue.
    The owner field is still used to wake up requests in round robin order
    by owner to avoid single processes hogging the RPC layer by loading the
    queues.
    
    Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 375d917188a104b23b41e7887cc87b837d84fcde
Author: Philipp Rossak <embed3d@gmail.com>
Date:   Wed Aug 1 11:48:01 2018 +0200

    ARM: dts: sun8i: h3-h5: ir register size should be the whole memory block
    
    [ Upstream commit 6c700289a3e84d5d3f2a95cf27732a7f7fce105b ]
    
    The size of the register should be the size of the whole memory block,
    not just the registers, that are needed.
    
    Signed-off-by: Philipp Rossak <embed3d@gmail.com>
    Acked-by: Maxime Ripard <maxime.ripard@bootlin.com>
    Signed-off-by: Chen-Yu Tsai <wens@csie.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 715119d3f15464bb5f02a64f78c606ed2d1eb483
Author: Jaegeuk Kim <jaegeuk@kernel.org>
Date:   Tue Sep 25 15:25:21 2018 -0700

    f2fs: return correct errno in f2fs_gc
    
    [ Upstream commit 61f7725aa148ee870436a29d3a24d5c00ab7e9af ]
    
    This fixes overriding error number in f2fs_gc.
    
    Reviewed-by: Chao Yu <yuchao0@huawei.com>
    Signed-off-by: Jaegeuk Kim <jaegeuk@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit ba02192598b897105762d30f673805e84aa9971d
Author: Yunsheng Lin <linyunsheng@huawei.com>
Date:   Wed Sep 26 19:28:37 2018 +0100

    net: hns3: Fix for netdev not up problem when setting mtu
    
    [ Upstream commit 93d8daf460183871a965dae339839d9e35d44309 ]
    
    Currently hns3_nic_change_mtu will try to down the netdev before
    setting mtu, and it does not up the netdev when the setting fails,
    which causes netdev not up problem.
    
    This patch fixes it by not returning when the setting fails.
    
    Fixes: a8e8b7ff3517 ("net: hns3: Add support to change MTU in HNS3 hardware")
    Signed-off-by: Yunsheng Lin <linyunsheng@huawei.com>
    Signed-off-by: Peng Li <lipeng321@huawei.com>
    Signed-off-by: Salil Mehta <salil.mehta@huawei.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit c26aff78aa2bf3b4449cef83057276ed55a0d7f4
Author: H. Nikolaus Schaller <hns@goldelico.com>
Date:   Fri Sep 28 17:54:00 2018 +0200

    ARM: dts: omap5: enable OTG role for DWC3 controller
    
    [ Upstream commit 656c1a65ab555ee5c7cd0d6aee8ab82ca3c1795f ]
    
    Since SMPS10 and OTG cable detection extcon are described here, and
    work to enable OTG power when an OTG cable is plugged in, we can
    define OTG mode in the controller (which is disabled by default in
    omap5.dtsi).
    
    Tested on OMAP5EVM and Pyra.
    
    Suggested-by: Roger Quadros <rogerq@ti.com>
    Signed-off-by: H. Nikolaus Schaller <hns@goldelico.com>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 358455734dd7c1a1fba346cab22f4184b0ce899b
Author: Vignesh R <vigneshr@ti.com>
Date:   Fri Sep 28 11:34:42 2018 +0530

    ARM: dts: dra7: Enable workaround for errata i870 in PCIe host mode
    
    [ Upstream commit b830526f304764753fcb8b4a563a94080e982a6c ]
    
    Add ti,syscon-unaligned-access property to PCIe RC nodes to set
    appropriate bits in CTRL_CORE_SMA_SW_7 register to enable workaround for
    errata i870.
    
    Signed-off-by: Vignesh R <vigneshr@ti.com>
    Signed-off-by: Tony Lindgren <tony@atomide.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 296269bc53129ec17fff615c534341e66c3c1b3c
Author: YueHaibing <yuehaibing@huawei.com>
Date:   Wed Sep 26 17:18:14 2018 +0800

    net: xen-netback: fix return type of ndo_start_xmit function
    
    [ Upstream commit a9ca7f17c6d240e269a24cbcd76abf9a940309dd ]
    
    The method ndo_start_xmit() is defined as returning an 'netdev_tx_t',
    which is a typedef for an enum type, so make sure the implementation in
    this driver has returns 'netdev_tx_t' value, and change the function
    return type to netdev_tx_t.
    
    Found by coccinelle.
    
    Signed-off-by: YueHaibing <yuehaibing@huawei.com>
    Acked-by: Wei Liu <wei.liu2@citrix.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 7af18b25bce0827335ab8b70b6887fb325c6fb76
Author: YueHaibing <yuehaibing@huawei.com>
Date:   Wed Sep 26 17:15:38 2018 +0800

    net: ovs: fix return type of ndo_start_xmit function
    
    [ Upstream commit eddf11e18dff0e8671e06ce54e64cfc843303ab9 ]
    
    The method ndo_start_xmit() is defined as returning an 'netdev_tx_t',
    which is a typedef for an enum type, so make sure the implementation in
    this driver has returns 'netdev_tx_t' value, and change the function
    return type to netdev_tx_t.
    
    Found by coccinelle.
    
    Signed-off-by: YueHaibing <yuehaibing@huawei.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 50df719a6c82b1aeccbbd55f895ef0d7f2943718
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Sun Jul 21 22:19:56 2019 +0200

    fbdev: Ditch fb_edid_add_monspecs
    
    commit 3b8720e63f4a1fc6f422a49ecbaa3b59c86d5aaf upstream.
    
    It's dead code ever since
    
    commit 34280340b1dc74c521e636f45cd728f9abf56ee2
    Author: Geert Uytterhoeven <geert+renesas@glider.be>
    Date:   Fri Dec 4 17:01:43 2015 +0100
    
        fbdev: Remove unused SH-Mobile HDMI driver
    
    Also with this gone we can remove the cea_modes db. This entire thing
    is massively incomplete anyway, compared to the CEA parsing that
    drm_edid.c does.
    
    Acked-by: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Tavis Ormandy <taviso@gmail.com>
    Signed-off-by: Daniel Vetter <daniel.vetter@intel.com>
    Signed-off-by: Bartlomiej Zolnierkiewicz <b.zolnierkie@samsung.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20190721201956.941-1-daniel.vetter@ffwll.ch
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 6bdcda5c99a51458f0c24a5a42ef88a7d2db2d6e
Author: Pavel Tatashin <pasha.tatashin@soleen.com>
Date:   Tue Nov 19 17:10:06 2019 -0500

    arm64: uaccess: Ensure PAN is re-enabled after unhandled uaccess fault
    
    commit 94bb804e1e6f0a9a77acf20d7c70ea141c6c821e upstream.
    
    A number of our uaccess routines ('__arch_clear_user()' and
    '__arch_copy_{in,from,to}_user()') fail to re-enable PAN if they
    encounter an unhandled fault whilst accessing userspace.
    
    For CPUs implementing both hardware PAN and UAO, this bug has no effect
    when both extensions are in use by the kernel.
    
    For CPUs implementing hardware PAN but not UAO, this means that a kernel
    using hardware PAN may execute portions of code with PAN inadvertently
    disabled, opening us up to potential security vulnerabilities that rely
    on userspace access from within the kernel which would usually be
    prevented by this mechanism. In other words, parts of the kernel run the
    same way as they would on a CPU without PAN implemented/emulated at all.
    
    For CPUs not implementing hardware PAN and instead relying on software
    emulation via 'CONFIG_ARM64_SW_TTBR0_PAN=y', the impact is unfortunately
    much worse. Calling 'schedule()' with software PAN disabled means that
    the next task will execute in the kernel using the page-table and ASID
    of the previous process even after 'switch_mm()', since the actual
    hardware switch is deferred until return to userspace. At this point, or
    if there is a intermediate call to 'uaccess_enable()', the page-table
    and ASID of the new process are installed. Sadly, due to the changes
    introduced by KPTI, this is not an atomic operation and there is a very
    small window (two instructions) where the CPU is configured with the
    page-table of the old task and the ASID of the new task; a speculative
    access in this state is disastrous because it would corrupt the TLB
    entries for the new task with mappings from the previous address space.
    
    As Pavel explains:
    
      | I was able to reproduce memory corruption problem on Broadcom's SoC
      | ARMv8-A like this:
      |
      | Enable software perf-events with PERF_SAMPLE_CALLCHAIN so userland's
      | stack is accessed and copied.
      |
      | The test program performed the following on every CPU and forking
      | many processes:
      |
      |     unsigned long *map = mmap(NULL, PAGE_SIZE, PROT_READ|PROT_WRITE,
      |                               MAP_SHARED | MAP_ANONYMOUS, -1, 0);
      |     map[0] = getpid();
      |     sched_yield();
      |     if (map[0] != getpid()) {
      |             fprintf(stderr, "Corruption detected!");
      |     }
      |     munmap(map, PAGE_SIZE);
      |
      | From time to time I was getting map[0] to contain pid for a
      | different process.
    
    Ensure that PAN is re-enabled when returning after an unhandled user
    fault from our uaccess routines.
    
    Cc: Catalin Marinas <catalin.marinas@arm.com>
    Reviewed-by: Mark Rutland <mark.rutland@arm.com>
    Tested-by: Mark Rutland <mark.rutland@arm.com>
    Cc: <stable@vger.kernel.org>
    Fixes: 338d4f49d6f7 ("arm64: kernel: Add support for Privileged Access Never")
    Signed-off-by: Pavel Tatashin <pasha.tatashin@soleen.com>
    [will: rewrote commit message]
    Signed-off-by: Will Deacon <will@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 630ca7d4c08948e25ae4d6dc8c6f1fa783b56a41
Author: David Hildenbrand <david@redhat.com>
Date:   Tue Nov 5 21:17:10 2019 -0800

    mm/memory_hotplug: fix updating the node span
    
    commit 656d571193262a11c2daa4012e53e4d645bbce56 upstream.
    
    We recently started updating the node span based on the zone span to
    avoid touching uninitialized memmaps.
    
    Currently, we will always detect the node span to start at 0, meaning a
    node can easily span too many pages.  pgdat_is_empty() will still work
    correctly if all zones span no pages.  We should skip over all zones
    without spanned pages and properly handle the first detected zone that
    spans pages.
    
    Unfortunately, in contrast to the zone span (/proc/zoneinfo), the node
    span cannot easily be inspected and tested.  The node span gives no real
    guarantees when an architecture supports memory hotplug, meaning it can
    easily contain holes or span pages of different nodes.
    
    The node span is not really used after init on architectures that
    support memory hotplug.
    
    E.g., we use it in mm/memory_hotplug.c:try_offline_node() and in
    mm/kmemleak.c:kmemleak_scan().  These users seem to be fine.
    
    Link: http://lkml.kernel.org/r/20191027222714.5313-1-david@redhat.com
    Fixes: 00d6c019b5bc ("mm/memory_hotplug: don't access uninitialized memmaps in shrink_pgdat_span()")
    Signed-off-by: David Hildenbrand <david@redhat.com>
    Cc: Michal Hocko <mhocko@suse.com>
    Cc: Oscar Salvador <osalvador@suse.de>
    Cc: Stephen Rothwell <sfr@canb.auug.org.au>
    Cc: Dan Williams <dan.j.williams@intel.com>
    Cc: Pavel Tatashin <pasha.tatashin@soleen.com>
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit b55841e18213b42e6ee380e0cc1c03c9b406fce0
Author: David Hildenbrand <david@redhat.com>
Date:   Fri Oct 18 20:19:33 2019 -0700

    mm/memory_hotplug: don't access uninitialized memmaps in shrink_pgdat_span()
    
    commit 00d6c019b5bc175cee3770e0e659f2b5f4804ea5 upstream.
    
    We might use the nid of memmaps that were never initialized.  For
    example, if the memmap was poisoned, we will crash the kernel in
    pfn_to_nid() right now.  Let's use the calculated boundaries of the
    separate zones instead.  This now also avoids having to iterate over a
    whole bunch of subsections again, after shrinking one zone.
    
    Before commit d0dc12e86b31 ("mm/memory_hotplug: optimize memory
    hotplug"), the memmap was initialized to 0 and the node was set to the
    right value.  After that commit, the node might be garbage.
    
    We'll have to fix shrink_zone_span() next.
    
    Link: http://lkml.kernel.org/r/20191006085646.5768-4-david@redhat.com
    Fixes: f1dd2cd13c4b ("mm, memory_hotplug: do not associate hotadded memory to zones until online")      [d0dc12e86b319]
    Signed-off-by: David Hildenbrand <david@redhat.com>
    Reported-by: Aneesh Kumar K.V <aneesh.kumar@linux.ibm.com>
    Cc: Oscar Salvador <osalvador@suse.de>
    Cc: David Hildenbrand <david@redhat.com>
    Cc: Michal Hocko <mhocko@suse.com>
    Cc: Pavel Tatashin <pasha.tatashin@soleen.com>
    Cc: Dan Williams <dan.j.williams@intel.com>
    Cc: Wei Yang <richardw.yang@linux.intel.com>
    Cc: Alexander Duyck <alexander.h.duyck@linux.intel.com>
    Cc: Alexander Potapenko <glider@google.com>
    Cc: Andy Lutomirski <luto@kernel.org>
    Cc: Anshuman Khandual <anshuman.khandual@arm.com>
    Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org>
    Cc: Borislav Petkov <bp@alien8.de>
    Cc: Catalin Marinas <catalin.marinas@arm.com>
    Cc: Christian Borntraeger <borntraeger@de.ibm.com>
    Cc: Christophe Leroy <christophe.leroy@c-s.fr>
    Cc: Damian Tometzki <damian.tometzki@gmail.com>
    Cc: Dave Hansen <dave.hansen@linux.intel.com>
    Cc: Fenghua Yu <fenghua.yu@intel.com>
    Cc: Gerald Schaefer <gerald.schaefer@de.ibm.com>
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Cc: Halil Pasic <pasic@linux.ibm.com>
    Cc: Heiko Carstens <heiko.carstens@de.ibm.com>
    Cc: "H. Peter Anvin" <hpa@zytor.com>
    Cc: Ingo Molnar <mingo@redhat.com>
    Cc: Ira Weiny <ira.weiny@intel.com>
    Cc: Jason Gunthorpe <jgg@ziepe.ca>
    Cc: Jun Yao <yaojun8558363@gmail.com>
    Cc: Logan Gunthorpe <logang@deltatee.com>
    Cc: Mark Rutland <mark.rutland@arm.com>
    Cc: Masahiro Yamada <yamada.masahiro@socionext.com>
    Cc: "Matthew Wilcox (Oracle)" <willy@infradead.org>
    Cc: Mel Gorman <mgorman@techsingularity.net>
    Cc: Michael Ellerman <mpe@ellerman.id.au>
    Cc: Mike Rapoport <rppt@linux.ibm.com>
    Cc: Pankaj Gupta <pagupta@redhat.com>
    Cc: Paul Mackerras <paulus@samba.org>
    Cc: Pavel Tatashin <pavel.tatashin@microsoft.com>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Qian Cai <cai@lca.pw>
    Cc: Rich Felker <dalias@libc.org>
    Cc: Robin Murphy <robin.murphy@arm.com>
    Cc: Steve Capper <steve.capper@arm.com>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: Tom Lendacky <thomas.lendacky@amd.com>
    Cc: Tony Luck <tony.luck@intel.com>
    Cc: Vasily Gorbik <gor@linux.ibm.com>
    Cc: Vlastimil Babka <vbabka@suse.cz>
    Cc: Wei Yang <richard.weiyang@gmail.com>
    Cc: Will Deacon <will@kernel.org>
    Cc: Yoshinori Sato <ysato@users.sourceforge.jp>
    Cc: Yu Zhao <yuzhao@google.com>
    Cc: <stable@vger.kernel.org>    [4.13+]
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a99fc917708665d730332fe20c910e832d8526d3
Author: Matthew Wilcox (Oracle) <willy@infradead.org>
Date:   Tue May 14 16:05:45 2019 -0400

    idr: Fix idr_get_next race with idr_remove
    
    commit 5c089fd0c73411f2170ab795c9ffc16718c7d007 upstream.
    
    If the entry is deleted from the IDR between the call to
    radix_tree_iter_find() and rcu_dereference_raw(), idr_get_next()
    will return NULL, which will end the iteration prematurely.  We should
    instead continue to the next entry in the IDR.  This only happens if the
    iteration is protected by the RCU lock.  Most IDR users use a spinlock
    or semaphore to exclude simultaneous modifications.  It was noticed once
    the PID allocator was converted to use the IDR, as it uses the RCU lock,
    but there may be other users elsewhere in the kernel.
    
    We can't use the normal pattern of calling radix_tree_deref_retry()
    (which catches both a retry entry in a leaf node and a node entry in
    the root) as the IDR supports storing entries which are unaligned,
    which will trigger an infinite loop if they are encountered.  Instead,
    we have to explicitly check whether the entry is a retry entry.
    
    Fixes: 0a835c4f090a ("Reimplement IDR and IDA using the radix tree")
    Reported-by: Brendan Gregg <bgregg@netflix.com>
    Tested-by: Brendan Gregg <bgregg@netflix.com>
    Signed-off-by: Matthew Wilcox (Oracle) <willy@infradead.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a4ead70898f7cd29b681448d2c27b92cfb01ec9a
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Wed Nov 13 21:28:31 2019 +0300

    net: cdc_ncm: Signedness bug in cdc_ncm_set_dgram_size()
    
    commit a56dcc6b455830776899ce3686735f1172e12243 upstream.
    
    This code is supposed to test for negative error codes and partial
    reads, but because sizeof() is size_t (unsigned) type then negative
    error codes are type promoted to high positive values and the condition
    doesn't work as expected.
    
    Fixes: 332f989a3b00 ("CDC-NCM: handle incomplete transfer of MTU")
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Nobuhiro Iwamatsu <nobuhiro1.iwamatsu@toshiba.co.jp>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d3a72ae0afff35dd65df15bcac59d086b9067fca
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Thu Nov 21 14:51:46 2019 +0100

    Revert "OPP: Protect dev_list with opp_table lock"
    
    This reverts commit 714ab224a8db6e8255c61a42613de9349ceb0bba which is
    commit 3d2556992a878a2210d3be498416aee39e0c32aa upstream.
    
    Turns out to break the build on the odroid machines, so it needs to be
    reverted.
    
    Reported-by: Viresh Kumar <viresh.kumar@linaro.org>
    Reported-by: "kernelci.org bot" <bot@kernelci.org>
    Cc: Niklas Cassel <niklas.cassel@linaro.org>
    Cc: Sasha Levin <sashal@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit e01dc7dda8836c90eaac6a51bd7df422e945910a
Author: Julia Lawall <Julia.Lawall@lip6.fr>
Date:   Sat Feb 23 14:20:36 2019 +0100

    tee: optee: add missing of_node_put after of_device_is_available
    
    commit c7c0d8df0b94a67377555a550b8d66ee2ad2f4ed upstream.
    
    Add an of_node_put when a tested device node is not available.
    
    The semantic patch that fixes this problem is as follows
    (http://coccinelle.lip6.fr):
    
    // <smpl>
    @@
    identifier f;
    local idexpression e;
    expression x;
    @@
    
    e = f(...);
    ... when != of_node_put(e)
        when != x = e
        when != e = x
        when any
    if (<+...of_device_is_available(e)...+>) {
      ... when != of_node_put(e)
    (
      return e;
    |
    + of_node_put(e);
      return ...;
    )
    }
    // </smpl>
    
    Fixes: db878f76b9ff ("tee: optee: take DT status property into account")
    Signed-off-by: Julia Lawall <Julia.Lawall@lip6.fr>
    Signed-off-by: Jens Wiklander <jens.wiklander@linaro.org>
    Cc: Nobuhiro Iwamatsu <nobuhiro1.iwamatsu@toshiba.co.jp>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 723aef6434dd82e8b4ded65eabafccab9174c5fc
Author: Leilk Liu <leilk.liu@mediatek.com>
Date:   Wed Oct 31 16:49:16 2018 +0800

    spi: mediatek: use correct mata->xfer_len when in fifo transfer
    
    commit a4d8f64f7267a88d4688f5c216926f5f6cafbae6 upstream.
    
    when xfer_len is greater than 64 bytes and use fifo mode
    to transfer, the actual length from the third time is mata->xfer_len
    but not len in mtk_spi_interrupt().
    
    Signed-off-by: Leilk Liu <leilk.liu@mediatek.com>
    Signed-off-by: Mark Brown <broonie@kernel.org>
    Cc: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
